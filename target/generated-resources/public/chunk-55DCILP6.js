import{G as Fd,H as Nd,K as jd,M as Gd,N as Zd,Q as Vd,Z as Hd,_ as Wd,aa as of,da as af,g as Id}from"./chunk-NKKV3KXS.js";import{Bc as Kd,Ec as Xd,Fc as Yd,Lc as Jd,Oc as Qd,Rc as tf,bd as ef,dc as Od,hd as rf,kc as Ud,oc as $d,od as nf,sd as sf,uc as qd}from"./chunk-HBCL52P7.js";import{A as Rd,m as Bd,z as zd}from"./chunk-HA3FE6NY.js";import{$c as vh,Ac as qa,Bc as _l,Cc as yh,Gc as Td,Jc as Pd,Pb as $a,Qb as wu,S as xd,Ta as wd,Vg as Mc,Yc as Sd,Z as bd,Zc as Il,cb as Cd,db as Md,dc as Ld,jc as gh,je as kd,ke as Ed,kg as Dd,mg as Cc,oc as ml,od as iu,pd as ru,qe as Ad,w as vd}from"./chunk-PQ6EZO2H.js";import{a as kr,b as Al,e as mh,g as _h,i as eo}from"./chunk-GHMOB5KC.js";var Lc=mh((xh,lf)=>{eo();(function($t,gt){typeof xh=="object"&&typeof lf<"u"?gt(xh):typeof define=="function"&&define.amd?define(["exports"],gt):($t=typeof globalThis<"u"?globalThis:$t||self,gt($t.leaflet={}))})(xh,function($t){"use strict";var gt="1.9.4";function Vt(s){var f,w,E,N;for(w=1,E=arguments.length;w<E;w++){N=arguments[w];for(f in N)s[f]=N[f]}return s}var G=Object.create||function(){function s(){}return function(f){return s.prototype=f,new s}}();function S(s,f){var w=Array.prototype.slice;if(s.bind)return s.bind.apply(s,w.call(arguments,1));var E=w.call(arguments,2);return function(){return s.apply(f,E.length?E.concat(w.call(arguments)):arguments)}}var u=0;function rt(s){return"_leaflet_id"in s||(s._leaflet_id=++u),s._leaflet_id}function Qt(s,f,w){var E,N,it,Pt;return Pt=function(){E=!1,N&&(it.apply(w,N),N=!1)},it=function(){E?N=arguments:(s.apply(w,arguments),setTimeout(Pt,f),E=!0)},it}function se(s,f,w){var E=f[1],N=f[0],it=E-N;return s===E&&w?s:((s-N)%it+it)%it+N}function Kt(){return!1}function re(s,f){if(f===!1)return s;var w=Math.pow(10,f===void 0?6:f);return Math.round(s*w)/w}function _t(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")}function ge(s){return _t(s).split(/\s+/)}function Ae(s,f){Object.prototype.hasOwnProperty.call(s,"options")||(s.options=s.options?G(s.options):{});for(var w in f)s.options[w]=f[w];return s.options}function pi(s,f,w){var E=[];for(var N in s)E.push(encodeURIComponent(w?N.toUpperCase():N)+"="+encodeURIComponent(s[N]));return(!f||f.indexOf("?")===-1?"?":"&")+E.join("&")}var Ze=/\{ *([\w_ -]+) *\}/g;function gi(s,f){return s.replace(Ze,function(w,E){var N=f[E];if(N===void 0)throw new Error("No value provided for variable "+w);return typeof N=="function"&&(N=N(f)),N})}var Bi=Array.isArray||function(s){return Object.prototype.toString.call(s)==="[object Array]"};function Wi(s,f){for(var w=0;w<s.length;w++)if(s[w]===f)return w;return-1}var Ei="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Ri(s){return window["webkit"+s]||window["moz"+s]||window["ms"+s]}var Pn=0;function Fn(s){var f=+new Date,w=Math.max(0,16-(f-Pn));return Pn=f+w,window.setTimeout(s,w)}var Bs=window.requestAnimationFrame||Ri("RequestAnimationFrame")||Fn,Ds=window.cancelAnimationFrame||Ri("CancelAnimationFrame")||Ri("CancelRequestAnimationFrame")||function(s){window.clearTimeout(s)};function dr(s,f,w){if(w&&Bs===Fn)s.call(f);else return Bs.call(window,S(s,f))}function Ki(s){s&&Ds.call(window,s)}var _r={__proto__:null,extend:Vt,create:G,bind:S,get lastId(){return u},stamp:rt,throttle:Qt,wrapNum:se,falseFn:Kt,formatNum:re,trim:_t,splitWords:ge,setOptions:Ae,getParamString:pi,template:gi,isArray:Bi,indexOf:Wi,emptyImageUrl:Ei,requestFn:Bs,cancelFn:Ds,requestAnimFrame:dr,cancelAnimFrame:Ki};function wr(){}wr.extend=function(s){var f=function(){Ae(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},w=f.__super__=this.prototype,E=G(w);E.constructor=f,f.prototype=E;for(var N in this)Object.prototype.hasOwnProperty.call(this,N)&&N!=="prototype"&&N!=="__super__"&&(f[N]=this[N]);return s.statics&&Vt(f,s.statics),s.includes&&(is(s.includes),Vt.apply(null,[E].concat(s.includes))),Vt(E,s),delete E.statics,delete E.includes,E.options&&(E.options=w.options?G(w.options):{},Vt(E.options,s.options)),E._initHooks=[],E.callInitHooks=function(){if(!this._initHooksCalled){w.callInitHooks&&w.callInitHooks.call(this),this._initHooksCalled=!0;for(var it=0,Pt=E._initHooks.length;it<Pt;it++)E._initHooks[it].call(this)}},f},wr.include=function(s){var f=this.prototype.options;return Vt(this.prototype,s),s.options&&(this.prototype.options=f,this.mergeOptions(s.options)),this},wr.mergeOptions=function(s){return Vt(this.prototype.options,s),this},wr.addInitHook=function(s){var f=Array.prototype.slice.call(arguments,1),w=typeof s=="function"?s:function(){this[s].apply(this,f)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(w),this};function is(s){if(!(typeof L>"u"||!L||!L.Mixin)){s=Bi(s)?s:[s];for(var f=0;f<s.length;f++)s[f]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var gr={on:function(s,f,w){if(typeof s=="object")for(var E in s)this._on(E,s[E],f);else{s=ge(s);for(var N=0,it=s.length;N<it;N++)this._on(s[N],f,w)}return this},off:function(s,f,w){if(!arguments.length)delete this._events;else if(typeof s=="object")for(var E in s)this._off(E,s[E],f);else{s=ge(s);for(var N=arguments.length===1,it=0,Pt=s.length;it<Pt;it++)N?this._off(s[it]):this._off(s[it],f,w)}return this},_on:function(s,f,w,E){if(typeof f!="function"){console.warn("wrong listener type: "+typeof f);return}if(this._listens(s,f,w)===!1){w===this&&(w=void 0);var N={fn:f,ctx:w};E&&(N.once=!0),this._events=this._events||{},this._events[s]=this._events[s]||[],this._events[s].push(N)}},_off:function(s,f,w){var E,N,it;if(this._events&&(E=this._events[s],!!E)){if(arguments.length===1){if(this._firingCount)for(N=0,it=E.length;N<it;N++)E[N].fn=Kt;delete this._events[s];return}if(typeof f!="function"){console.warn("wrong listener type: "+typeof f);return}var Pt=this._listens(s,f,w);if(Pt!==!1){var Xt=E[Pt];this._firingCount&&(Xt.fn=Kt,this._events[s]=E=E.slice()),E.splice(Pt,1)}}},fire:function(s,f,w){if(!this.listens(s,w))return this;var E=Vt({},f,{type:s,target:this,sourceTarget:f&&f.sourceTarget||this});if(this._events){var N=this._events[s];if(N){this._firingCount=this._firingCount+1||1;for(var it=0,Pt=N.length;it<Pt;it++){var Xt=N[it],le=Xt.fn;Xt.once&&this.off(s,le,Xt.ctx),le.call(Xt.ctx||this,E)}this._firingCount--}}return w&&this._propagateEvent(E),this},listens:function(s,f,w,E){typeof s!="string"&&console.warn('"string" type argument expected');var N=f;typeof f!="function"&&(E=!!f,N=void 0,w=void 0);var it=this._events&&this._events[s];if(it&&it.length&&this._listens(s,N,w)!==!1)return!0;if(E){for(var Pt in this._eventParents)if(this._eventParents[Pt].listens(s,f,w,E))return!0}return!1},_listens:function(s,f,w){if(!this._events)return!1;var E=this._events[s]||[];if(!f)return!!E.length;w===this&&(w=void 0);for(var N=0,it=E.length;N<it;N++)if(E[N].fn===f&&E[N].ctx===w)return N;return!1},once:function(s,f,w){if(typeof s=="object")for(var E in s)this._on(E,s[E],f,!0);else{s=ge(s);for(var N=0,it=s.length;N<it;N++)this._on(s[N],f,w,!0)}return this},addEventParent:function(s){return this._eventParents=this._eventParents||{},this._eventParents[rt(s)]=s,this},removeEventParent:function(s){return this._eventParents&&delete this._eventParents[rt(s)],this},_propagateEvent:function(s){for(var f in this._eventParents)this._eventParents[f].fire(s.type,Vt({layer:s.target,propagatedFrom:s.target},s),!0)}};gr.addEventListener=gr.on,gr.removeEventListener=gr.clearAllEventListeners=gr.off,gr.addOneTimeEventListener=gr.once,gr.fireEvent=gr.fire,gr.hasEventListeners=gr.listens;var Nn=wr.extend(gr);function ei(s,f,w){this.x=w?Math.round(s):s,this.y=w?Math.round(f):f}var io=Math.trunc||function(s){return s>0?Math.floor(s):Math.ceil(s)};ei.prototype={clone:function(){return new ei(this.x,this.y)},add:function(s){return this.clone()._add(Ye(s))},_add:function(s){return this.x+=s.x,this.y+=s.y,this},subtract:function(s){return this.clone()._subtract(Ye(s))},_subtract:function(s){return this.x-=s.x,this.y-=s.y,this},divideBy:function(s){return this.clone()._divideBy(s)},_divideBy:function(s){return this.x/=s,this.y/=s,this},multiplyBy:function(s){return this.clone()._multiplyBy(s)},_multiplyBy:function(s){return this.x*=s,this.y*=s,this},scaleBy:function(s){return new ei(this.x*s.x,this.y*s.y)},unscaleBy:function(s){return new ei(this.x/s.x,this.y/s.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=io(this.x),this.y=io(this.y),this},distanceTo:function(s){s=Ye(s);var f=s.x-this.x,w=s.y-this.y;return Math.sqrt(f*f+w*w)},equals:function(s){return s=Ye(s),s.x===this.x&&s.y===this.y},contains:function(s){return s=Ye(s),Math.abs(s.x)<=Math.abs(this.x)&&Math.abs(s.y)<=Math.abs(this.y)},toString:function(){return"Point("+re(this.x)+", "+re(this.y)+")"}};function Ye(s,f,w){return s instanceof ei?s:Bi(s)?new ei(s[0],s[1]):s==null?s:typeof s=="object"&&"x"in s&&"y"in s?new ei(s.x,s.y):new ei(s,f,w)}function bi(s,f){if(s)for(var w=f?[s,f]:s,E=0,N=w.length;E<N;E++)this.extend(w[E])}bi.prototype={extend:function(s){var f,w;if(!s)return this;if(s instanceof ei||typeof s[0]=="number"||"x"in s)f=w=Ye(s);else if(s=ti(s),f=s.min,w=s.max,!f||!w)return this;return!this.min&&!this.max?(this.min=f.clone(),this.max=w.clone()):(this.min.x=Math.min(f.x,this.min.x),this.max.x=Math.max(w.x,this.max.x),this.min.y=Math.min(f.y,this.min.y),this.max.y=Math.max(w.y,this.max.y)),this},getCenter:function(s){return Ye((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,s)},getBottomLeft:function(){return Ye(this.min.x,this.max.y)},getTopRight:function(){return Ye(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(s){var f,w;return typeof s[0]=="number"||s instanceof ei?s=Ye(s):s=ti(s),s instanceof bi?(f=s.min,w=s.max):f=w=s,f.x>=this.min.x&&w.x<=this.max.x&&f.y>=this.min.y&&w.y<=this.max.y},intersects:function(s){s=ti(s);var f=this.min,w=this.max,E=s.min,N=s.max,it=N.x>=f.x&&E.x<=w.x,Pt=N.y>=f.y&&E.y<=w.y;return it&&Pt},overlaps:function(s){s=ti(s);var f=this.min,w=this.max,E=s.min,N=s.max,it=N.x>f.x&&E.x<w.x,Pt=N.y>f.y&&E.y<w.y;return it&&Pt},isValid:function(){return!!(this.min&&this.max)},pad:function(s){var f=this.min,w=this.max,E=Math.abs(f.x-w.x)*s,N=Math.abs(f.y-w.y)*s;return ti(Ye(f.x-E,f.y-N),Ye(w.x+E,w.y+N))},equals:function(s){return s?(s=ti(s),this.min.equals(s.getTopLeft())&&this.max.equals(s.getBottomRight())):!1}};function ti(s,f){return!s||s instanceof bi?s:new bi(s,f)}function $i(s,f){if(s)for(var w=f?[s,f]:s,E=0,N=w.length;E<N;E++)this.extend(w[E])}$i.prototype={extend:function(s){var f=this._southWest,w=this._northEast,E,N;if(s instanceof wi)E=s,N=s;else if(s instanceof $i){if(E=s._southWest,N=s._northEast,!E||!N)return this}else return s?this.extend(mi(s)||Ii(s)):this;return!f&&!w?(this._southWest=new wi(E.lat,E.lng),this._northEast=new wi(N.lat,N.lng)):(f.lat=Math.min(E.lat,f.lat),f.lng=Math.min(E.lng,f.lng),w.lat=Math.max(N.lat,w.lat),w.lng=Math.max(N.lng,w.lng)),this},pad:function(s){var f=this._southWest,w=this._northEast,E=Math.abs(f.lat-w.lat)*s,N=Math.abs(f.lng-w.lng)*s;return new $i(new wi(f.lat-E,f.lng-N),new wi(w.lat+E,w.lng+N))},getCenter:function(){return new wi((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new wi(this.getNorth(),this.getWest())},getSouthEast:function(){return new wi(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(s){typeof s[0]=="number"||s instanceof wi||"lat"in s?s=mi(s):s=Ii(s);var f=this._southWest,w=this._northEast,E,N;return s instanceof $i?(E=s.getSouthWest(),N=s.getNorthEast()):E=N=s,E.lat>=f.lat&&N.lat<=w.lat&&E.lng>=f.lng&&N.lng<=w.lng},intersects:function(s){s=Ii(s);var f=this._southWest,w=this._northEast,E=s.getSouthWest(),N=s.getNorthEast(),it=N.lat>=f.lat&&E.lat<=w.lat,Pt=N.lng>=f.lng&&E.lng<=w.lng;return it&&Pt},overlaps:function(s){s=Ii(s);var f=this._southWest,w=this._northEast,E=s.getSouthWest(),N=s.getNorthEast(),it=N.lat>f.lat&&E.lat<w.lat,Pt=N.lng>f.lng&&E.lng<w.lng;return it&&Pt},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(s,f){return s?(s=Ii(s),this._southWest.equals(s.getSouthWest(),f)&&this._northEast.equals(s.getNorthEast(),f)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Ii(s,f){return s instanceof $i?s:new $i(s,f)}function wi(s,f,w){if(isNaN(s)||isNaN(f))throw new Error("Invalid LatLng object: ("+s+", "+f+")");this.lat=+s,this.lng=+f,w!==void 0&&(this.alt=+w)}wi.prototype={equals:function(s,f){if(!s)return!1;s=mi(s);var w=Math.max(Math.abs(this.lat-s.lat),Math.abs(this.lng-s.lng));return w<=(f===void 0?1e-9:f)},toString:function(s){return"LatLng("+re(this.lat,s)+", "+re(this.lng,s)+")"},distanceTo:function(s){return jn.distance(this,mi(s))},wrap:function(){return jn.wrapLatLng(this)},toBounds:function(s){var f=180*s/40075017,w=f/Math.cos(Math.PI/180*this.lat);return Ii([this.lat-f,this.lng-w],[this.lat+f,this.lng+w])},clone:function(){return new wi(this.lat,this.lng,this.alt)}};function mi(s,f,w){return s instanceof wi?s:Bi(s)&&typeof s[0]!="object"?s.length===3?new wi(s[0],s[1],s[2]):s.length===2?new wi(s[0],s[1]):null:s==null?s:typeof s=="object"&&"lat"in s?new wi(s.lat,"lng"in s?s.lng:s.lon,s.alt):f===void 0?null:new wi(s,f,w)}var Wr={latLngToPoint:function(s,f){var w=this.projection.project(s),E=this.scale(f);return this.transformation._transform(w,E)},pointToLatLng:function(s,f){var w=this.scale(f),E=this.transformation.untransform(s,w);return this.projection.unproject(E)},project:function(s){return this.projection.project(s)},unproject:function(s){return this.projection.unproject(s)},scale:function(s){return 256*Math.pow(2,s)},zoom:function(s){return Math.log(s/256)/Math.LN2},getProjectedBounds:function(s){if(this.infinite)return null;var f=this.projection.bounds,w=this.scale(s),E=this.transformation.transform(f.min,w),N=this.transformation.transform(f.max,w);return new bi(E,N)},infinite:!1,wrapLatLng:function(s){var f=this.wrapLng?se(s.lng,this.wrapLng,!0):s.lng,w=this.wrapLat?se(s.lat,this.wrapLat,!0):s.lat,E=s.alt;return new wi(w,f,E)},wrapLatLngBounds:function(s){var f=s.getCenter(),w=this.wrapLatLng(f),E=f.lat-w.lat,N=f.lng-w.lng;if(E===0&&N===0)return s;var it=s.getSouthWest(),Pt=s.getNorthEast(),Xt=new wi(it.lat-E,it.lng-N),le=new wi(Pt.lat-E,Pt.lng-N);return new $i(Xt,le)}},jn=Vt({},Wr,{wrapLng:[-180,180],R:6371e3,distance:function(s,f){var w=Math.PI/180,E=s.lat*w,N=f.lat*w,it=Math.sin((f.lat-s.lat)*w/2),Pt=Math.sin((f.lng-s.lng)*w/2),Xt=it*it+Math.cos(E)*Math.cos(N)*Pt*Pt,le=2*Math.atan2(Math.sqrt(Xt),Math.sqrt(1-Xt));return this.R*le}}),nr=6378137,ro={R:nr,MAX_LATITUDE:85.0511287798,project:function(s){var f=Math.PI/180,w=this.MAX_LATITUDE,E=Math.max(Math.min(w,s.lat),-w),N=Math.sin(E*f);return new ei(this.R*s.lng*f,this.R*Math.log((1+N)/(1-N))/2)},unproject:function(s){var f=180/Math.PI;return new wi((2*Math.atan(Math.exp(s.y/this.R))-Math.PI/2)*f,s.x*f/this.R)},bounds:function(){var s=nr*Math.PI;return new bi([-s,-s],[s,s])}()};function yr(s,f,w,E){if(Bi(s)){this._a=s[0],this._b=s[1],this._c=s[2],this._d=s[3];return}this._a=s,this._b=f,this._c=w,this._d=E}yr.prototype={transform:function(s,f){return this._transform(s.clone(),f)},_transform:function(s,f){return f=f||1,s.x=f*(this._a*s.x+this._b),s.y=f*(this._c*s.y+this._d),s},untransform:function(s,f){return f=f||1,new ei((s.x/f-this._b)/this._a,(s.y/f-this._d)/this._c)}};function _s(s,f,w,E){return new yr(s,f,w,E)}var ji=Vt({},jn,{code:"EPSG:3857",projection:ro,transformation:function(){var s=.5/(Math.PI*ro.R);return _s(s,.5,-s,.5)}()}),rs=Vt({},ji,{code:"EPSG:900913"});function cn(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function zs(s,f){var w="",E,N,it,Pt,Xt,le;for(E=0,it=s.length;E<it;E++){for(Xt=s[E],N=0,Pt=Xt.length;N<Pt;N++)le=Xt[N],w+=(N?"L":"M")+le.x+" "+le.y;w+=f?Se.svg?"z":"x":""}return w||"M0 0"}var fr=document.documentElement.style,Er="ActiveXObject"in window,Rr=Er&&!document.addEventListener,ns="msLaunchUri"in navigator&&!("documentMode"in document),Gn=Ge("webkit"),zo=Ge("android"),Rs=Ge("android 2")||Ge("android 3"),gs=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),no=zo&&Ge("Google")&&gs<537&&!("AudioNode"in window),Zn=!!window.opera,Kr=!ns&&Ge("chrome"),Vn=Ge("gecko")&&!Gn&&!Zn&&!Er,Xo=!Kr&&Ge("safari"),Yo=Ge("phantom"),Un="OTransition"in fr,Gt=navigator.platform.indexOf("Win")===0,J=Er&&"transition"in fr,tt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Rs,lt="MozPerspective"in fr,vt=!window.L_DISABLE_3D&&(J||tt||lt)&&!Un&&!Yo,Et=typeof orientation<"u"||Ge("mobile"),Nt=Et&&Gn,ee=Et&&tt,Rt=!window.PointerEvent&&window.MSPointerEvent,fe=!!(window.PointerEvent||Rt),ce="ontouchstart"in window||!!window.TouchEvent,qt=!window.L_NO_TOUCH&&(ce||fe),ye=Et&&Zn,At=Et&&Vn,Ie=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,$e=function(){var s=!1;try{var f=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("testPassiveEventSupport",Kt,f),window.removeEventListener("testPassiveEventSupport",Kt,f)}catch{}return s}(),Be=function(){return!!document.createElement("canvas").getContext}(),je=!!(document.createElementNS&&cn("svg").createSVGRect),Je=!!je&&function(){var s=document.createElement("div");return s.innerHTML="<svg/>",(s.firstChild&&s.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Oi=!je&&function(){try{var s=document.createElement("div");s.innerHTML='<v:shape adj="1"/>';var f=s.firstChild;return f.style.behavior="url(#default#VML)",f&&typeof f.adj=="object"}catch{return!1}}(),Ai=navigator.platform.indexOf("Mac")===0,Ti=navigator.platform.indexOf("Linux")===0;function Ge(s){return navigator.userAgent.toLowerCase().indexOf(s)>=0}var Se={ie:Er,ielt9:Rr,edge:ns,webkit:Gn,android:zo,android23:Rs,androidStock:no,opera:Zn,chrome:Kr,gecko:Vn,safari:Xo,phantom:Yo,opera12:Un,win:Gt,ie3d:J,webkit3d:tt,gecko3d:lt,any3d:vt,mobile:Et,mobileWebkit:Nt,mobileWebkit3d:ee,msPointer:Rt,pointer:fe,touch:qt,touchNative:ce,mobileOpera:ye,mobileGecko:At,retina:Ie,passiveEvents:$e,canvas:Be,svg:je,vml:Oi,inlineSvg:Je,mac:Ai,linux:Ti},sr=Se.msPointer?"MSPointerDown":"pointerdown",Le=Se.msPointer?"MSPointerMove":"pointermove",vr=Se.msPointer?"MSPointerUp":"pointerup",Gi=Se.msPointer?"MSPointerCancel":"pointercancel",$n={touchstart:sr,touchmove:Le,touchend:vr,touchcancel:Gi},Os={touchstart:Xi,touchmove:Sn,touchend:Sn,touchcancel:Sn},Pe={},ni=!1;function ui(s,f,w){return f==="touchstart"&&ys(),Os[f]?(w=Os[f].bind(this,w),s.addEventListener($n[f],w,!1),w):(console.warn("wrong event specified:",f),Kt)}function pn(s,f,w){if(!$n[f]){console.warn("wrong event specified:",f);return}s.removeEventListener($n[f],w,!1)}function La(s){Pe[s.pointerId]=s}function ss(s){Pe[s.pointerId]&&(Pe[s.pointerId]=s)}function si(s){delete Pe[s.pointerId]}function ys(){ni||(document.addEventListener(sr,La,!0),document.addEventListener(Le,ss,!0),document.addEventListener(vr,si,!0),document.addEventListener(Gi,si,!0),ni=!0)}function Sn(s,f){if(f.pointerType!==(f.MSPOINTER_TYPE_MOUSE||"mouse")){f.touches=[];for(var w in Pe)f.touches.push(Pe[w]);f.changedTouches=[f],s(f)}}function Xi(s,f){f.MSPOINTER_TYPE_TOUCH&&f.pointerType===f.MSPOINTER_TYPE_TOUCH&&Ve(f),Sn(s,f)}function Jo(s){var f={},w,E;for(E in s)w=s[E],f[E]=w&&w.bind?w.bind(s):w;return s=f,f.type="dblclick",f.detail=2,f.isTrusted=!1,f._simulated=!0,f}var Qo=200;function vs(s,f){s.addEventListener("dblclick",f);var w=0,E;function N(it){if(it.detail!==1){E=it.detail;return}if(!(it.pointerType==="mouse"||it.sourceCapabilities&&!it.sourceCapabilities.firesTouchEvents)){var Pt=He(it);if(!(Pt.some(function(le){return le instanceof HTMLLabelElement&&le.attributes.for})&&!Pt.some(function(le){return le instanceof HTMLInputElement||le instanceof HTMLSelectElement}))){var Xt=Date.now();Xt-w<=Qo?(E++,E===2&&f(Jo(it))):E=1,w=Xt}}}return s.addEventListener("click",N),{dblclick:f,simDblclick:N}}function ta(s,f){s.removeEventListener("dblclick",f.dblclick),s.removeEventListener("click",f.simDblclick)}var Or=Fo(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),zi=Fo(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ha=zi==="webkitTransition"||zi==="OTransition"?zi+"End":"transitionend";function Ro(s){return typeof s=="string"?document.getElementById(s):s}function Fs(s,f){var w=s.style[f]||s.currentStyle&&s.currentStyle[f];if((!w||w==="auto")&&document.defaultView){var E=document.defaultView.getComputedStyle(s,null);w=E?E[f]:null}return w==="auto"?null:w}function yi(s,f,w){var E=document.createElement(s);return E.className=f||"",w&&w.appendChild(E),E}function Si(s){var f=s.parentNode;f&&f.removeChild(s)}function ea(s){for(;s.firstChild;)s.removeChild(s.firstChild)}function Ns(s){var f=s.parentNode;f&&f.lastChild!==s&&f.appendChild(s)}function js(s){var f=s.parentNode;f&&f.firstChild!==s&&f.insertBefore(s,f.firstChild)}function Gs(s,f){if(s.classList!==void 0)return s.classList.contains(f);var w=Ta(s);return w.length>0&&new RegExp("(^|\\s)"+f+"(\\s|$)").test(w)}function hi(s,f){if(s.classList!==void 0)for(var w=ge(f),E=0,N=w.length;E<N;E++)s.classList.add(w[E]);else if(!Gs(s,f)){var it=Ta(s);Zs(s,(it?it+" ":"")+f)}}function Ji(s,f){s.classList!==void 0?s.classList.remove(f):Zs(s,_t((" "+Ta(s)+" ").replace(" "+f+" "," ")))}function Zs(s,f){s.className.baseVal===void 0?s.className=f:s.className.baseVal=f}function Ta(s){return s.correspondingElement&&(s=s.correspondingElement),s.className.baseVal===void 0?s.className:s.className.baseVal}function dn(s,f){"opacity"in s.style?s.style.opacity=f:"filter"in s.style&&Oo(s,f)}function Oo(s,f){var w=!1,E="DXImageTransform.Microsoft.Alpha";try{w=s.filters.item(E)}catch{if(f===1)return}f=Math.round(f*100),w?(w.Enabled=f!==100,w.Opacity=f):s.style.filter+=" progid:"+E+"(opacity="+f+")"}function Fo(s){for(var f=document.documentElement.style,w=0;w<s.length;w++)if(s[w]in f)return s[w];return!1}function xs(s,f,w){var E=f||new ei(0,0);s.style[Or]=(Se.ie3d?"translate("+E.x+"px,"+E.y+"px)":"translate3d("+E.x+"px,"+E.y+"px,0)")+(w?" scale("+w+")":"")}function er(s,f){s._leaflet_pos=f,Se.any3d?xs(s,f):(s.style.left=f.x+"px",s.style.top=f.y+"px")}function os(s){return s._leaflet_pos||new ei(0,0)}var Vs,Xr,ci;if("onselectstart"in document)Vs=function(){oi(window,"selectstart",Ve)},Xr=function(){ii(window,"selectstart",Ve)};else{var fn=Fo(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Vs=function(){if(fn){var s=document.documentElement.style;ci=s[fn],s[fn]="none"}},Xr=function(){fn&&(document.documentElement.style[fn]=ci,ci=void 0)}}function qn(){oi(window,"dragstart",Ve)}function as(){ii(window,"dragstart",Ve)}var No,ia;function Yr(s){for(;s.tabIndex===-1;)s=s.parentNode;s.style&&(kn(),No=s,ia=s.style.outlineStyle,s.style.outlineStyle="none",oi(window,"keydown",kn))}function kn(){No&&(No.style.outlineStyle=ia,No=void 0,ia=void 0,ii(window,"keydown",kn))}function di(s){do s=s.parentNode;while((!s.offsetWidth||!s.offsetHeight)&&s!==document.body);return s}function so(s){var f=s.getBoundingClientRect();return{x:f.width/s.offsetWidth||1,y:f.height/s.offsetHeight||1,boundingClientRect:f}}var Pa={__proto__:null,TRANSFORM:Or,TRANSITION:zi,TRANSITION_END:Ha,get:Ro,getStyle:Fs,create:yi,remove:Si,empty:ea,toFront:Ns,toBack:js,hasClass:Gs,addClass:hi,removeClass:Ji,setClass:Zs,getClass:Ta,setOpacity:dn,testProp:Fo,setTransform:xs,setPosition:er,getPosition:os,get disableTextSelection(){return Vs},get enableTextSelection(){return Xr},disableImageDrag:qn,enableImageDrag:as,preventOutline:Yr,restoreOutline:kn,getSizedParentNode:di,getScale:so};function oi(s,f,w,E){if(f&&typeof f=="object")for(var N in f)Fi(s,N,f[N],w);else{f=ge(f);for(var it=0,Pt=f.length;it<Pt;it++)Fi(s,f[it],w,E)}return this}var Zi="_leaflet_events";function ii(s,f,w,E){if(arguments.length===1)Cr(s),delete s[Zi];else if(f&&typeof f=="object")for(var N in f)jo(s,N,f[N],w);else if(f=ge(f),arguments.length===2)Cr(s,function(Xt){return Wi(f,Xt)!==-1});else for(var it=0,Pt=f.length;it<Pt;it++)jo(s,f[it],w,E);return this}function Cr(s,f){for(var w in s[Zi]){var E=w.split(/\d/)[0];(!f||f(E))&&jo(s,E,null,null,w)}}var or={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Fi(s,f,w,E){var N=f+rt(w)+(E?"_"+rt(E):"");if(s[Zi]&&s[Zi][N])return this;var it=function(Xt){return w.call(E||s,Xt||window.event)},Pt=it;!Se.touchNative&&Se.pointer&&f.indexOf("touch")===0?it=ui(s,f,it):Se.touch&&f==="dblclick"?it=vs(s,it):"addEventListener"in s?f==="touchstart"||f==="touchmove"||f==="wheel"||f==="mousewheel"?s.addEventListener(or[f]||f,it,Se.passiveEvents?{passive:!1}:!1):f==="mouseenter"||f==="mouseleave"?(it=function(Xt){Xt=Xt||window.event,Jr(s,Xt)&&Pt(Xt)},s.addEventListener(or[f],it,!1)):s.addEventListener(f,Pt,!1):s.attachEvent("on"+f,it),s[Zi]=s[Zi]||{},s[Zi][N]=it}function jo(s,f,w,E,N){N=N||f+rt(w)+(E?"_"+rt(E):"");var it=s[Zi]&&s[Zi][N];if(!it)return this;!Se.touchNative&&Se.pointer&&f.indexOf("touch")===0?pn(s,f,it):Se.touch&&f==="dblclick"?ta(s,it):"removeEventListener"in s?s.removeEventListener(or[f]||f,it,!1):s.detachEvent("on"+f,it),s[Zi][N]=null}function ai(s){return s.stopPropagation?s.stopPropagation():s.originalEvent?s.originalEvent._stopped=!0:s.cancelBubble=!0,this}function ir(s){return Fi(s,"wheel",ai),this}function Qe(s){return oi(s,"mousedown touchstart dblclick contextmenu",ai),s._leaflet_disable_click=!0,this}function Ve(s){return s.preventDefault?s.preventDefault():s.returnValue=!1,this}function mn(s){return Ve(s),ai(s),this}function He(s){if(s.composedPath)return s.composedPath();for(var f=[],w=s.target;w;)f.push(w),w=w.parentNode;return f}function Us(s,f){if(!f)return new ei(s.clientX,s.clientY);var w=so(f),E=w.boundingClientRect;return new ei((s.clientX-E.left)/w.x-f.clientLeft,(s.clientY-E.top)/w.y-f.clientTop)}var Fr=Se.linux&&Se.chrome?window.devicePixelRatio:Se.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function oo(s){return Se.edge?s.wheelDeltaY/2:s.deltaY&&s.deltaMode===0?-s.deltaY/Fr:s.deltaY&&s.deltaMode===1?-s.deltaY*20:s.deltaY&&s.deltaMode===2?-s.deltaY*60:s.deltaX||s.deltaZ?0:s.wheelDelta?(s.wheelDeltaY||s.wheelDelta)/2:s.detail&&Math.abs(s.detail)<32765?-s.detail*20:s.detail?s.detail/-32765*60:0}function Jr(s,f){var w=f.relatedTarget;if(!w)return!0;try{for(;w&&w!==s;)w=w.parentNode}catch{return!1}return w!==s}var Wa={__proto__:null,on:oi,off:ii,stopPropagation:ai,disableScrollPropagation:ir,disableClickPropagation:Qe,preventDefault:Ve,stop:mn,getPropagationPath:He,getMousePosition:Us,getWheelDelta:oo,isExternalTarget:Jr,addListener:oi,removeListener:ii},Hn=Nn.extend({run:function(s,f,w,E){this.stop(),this._el=s,this._inProgress=!0,this._duration=w||.25,this._easeOutPower=1/Math.max(E||.5,.2),this._startPos=os(s),this._offset=f.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=dr(this._animate,this),this._step()},_step:function(s){var f=+new Date-this._startTime,w=this._duration*1e3;f<w?this._runFrame(this._easeOut(f/w),s):(this._runFrame(1),this._complete())},_runFrame:function(s,f){var w=this._startPos.add(this._offset.multiplyBy(s));f&&w._round(),er(this._el,w),this.fire("step")},_complete:function(){Ki(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(s){return 1-Math.pow(1-s,this._easeOutPower)}}),vi=Nn.extend({options:{crs:ji,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(s,f){f=Ae(this,f),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(s),this._initLayout(),this._onResize=S(this._onResize,this),this._initEvents(),f.maxBounds&&this.setMaxBounds(f.maxBounds),f.zoom!==void 0&&(this._zoom=this._limitZoom(f.zoom)),f.center&&f.zoom!==void 0&&this.setView(mi(f.center),f.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=zi&&Se.any3d&&!Se.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),oi(this._proxy,Ha,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(s,f,w){if(f=f===void 0?this._zoom:this._limitZoom(f),s=this._limitCenter(mi(s),f,this.options.maxBounds),w=w||{},this._stop(),this._loaded&&!w.reset&&w!==!0){w.animate!==void 0&&(w.zoom=Vt({animate:w.animate},w.zoom),w.pan=Vt({animate:w.animate,duration:w.duration},w.pan));var E=this._zoom!==f?this._tryAnimatedZoom&&this._tryAnimatedZoom(s,f,w.zoom):this._tryAnimatedPan(s,w.pan);if(E)return clearTimeout(this._sizeTimer),this}return this._resetView(s,f,w.pan&&w.pan.noMoveStart),this},setZoom:function(s,f){return this._loaded?this.setView(this.getCenter(),s,{zoom:f}):(this._zoom=s,this)},zoomIn:function(s,f){return s=s||(Se.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+s,f)},zoomOut:function(s,f){return s=s||(Se.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-s,f)},setZoomAround:function(s,f,w){var E=this.getZoomScale(f),N=this.getSize().divideBy(2),it=s instanceof ei?s:this.latLngToContainerPoint(s),Pt=it.subtract(N).multiplyBy(1-1/E),Xt=this.containerPointToLatLng(N.add(Pt));return this.setView(Xt,f,{zoom:w})},_getBoundsCenterZoom:function(s,f){f=f||{},s=s.getBounds?s.getBounds():Ii(s);var w=Ye(f.paddingTopLeft||f.padding||[0,0]),E=Ye(f.paddingBottomRight||f.padding||[0,0]),N=this.getBoundsZoom(s,!1,w.add(E));if(N=typeof f.maxZoom=="number"?Math.min(f.maxZoom,N):N,N===1/0)return{center:s.getCenter(),zoom:N};var it=E.subtract(w).divideBy(2),Pt=this.project(s.getSouthWest(),N),Xt=this.project(s.getNorthEast(),N),le=this.unproject(Pt.add(Xt).divideBy(2).add(it),N);return{center:le,zoom:N}},fitBounds:function(s,f){if(s=Ii(s),!s.isValid())throw new Error("Bounds are not valid.");var w=this._getBoundsCenterZoom(s,f);return this.setView(w.center,w.zoom,f)},fitWorld:function(s){return this.fitBounds([[-90,-180],[90,180]],s)},panTo:function(s,f){return this.setView(s,this._zoom,{pan:f})},panBy:function(s,f){if(s=Ye(s).round(),f=f||{},!s.x&&!s.y)return this.fire("moveend");if(f.animate!==!0&&!this.getSize().contains(s))return this._resetView(this.unproject(this.project(this.getCenter()).add(s)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Hn,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),f.noMoveStart||this.fire("movestart"),f.animate!==!1){hi(this._mapPane,"leaflet-pan-anim");var w=this._getMapPanePos().subtract(s).round();this._panAnim.run(this._mapPane,w,f.duration||.25,f.easeLinearity)}else this._rawPanBy(s),this.fire("move").fire("moveend");return this},flyTo:function(s,f,w){if(w=w||{},w.animate===!1||!Se.any3d)return this.setView(s,f,w);this._stop();var E=this.project(this.getCenter()),N=this.project(s),it=this.getSize(),Pt=this._zoom;s=mi(s),f=f===void 0?Pt:f;var Xt=Math.max(it.x,it.y),le=Xt*this.getZoomScale(Pt,f),Ce=N.distanceTo(E)||1,ze=1.42,qe=ze*ze;function fi(Pi){var Lo=Pi?-1:1,fa=Pi?le:Xt,To=le*le-Xt*Xt+Lo*qe*qe*Ce*Ce,Po=2*fa*qe*Ce,ma=To/Po,Ur=Math.sqrt(ma*ma+1)-ma,ul=Ur<1e-9?-18:Math.log(Ur);return ul}function Pr(Pi){return(Math.exp(Pi)-Math.exp(-Pi))/2}function rr(Pi){return(Math.exp(Pi)+Math.exp(-Pi))/2}function rn(Pi){return Pr(Pi)/rr(Pi)}var Vr=fi(0);function Co(Pi){return Xt*(rr(Vr)/rr(Vr+ze*Pi))}function Mo(Pi){return Xt*(rr(Vr)*rn(Vr+ze*Pi)-Pr(Vr))/qe}function Dn(Pi){return 1-Math.pow(1-Pi,1.5)}var Js=Date.now(),da=(fi(1)-Vr)/ze,Ni=w.duration?1e3*w.duration:1e3*da*.8;function ps(){var Pi=(Date.now()-Js)/Ni,Lo=Dn(Pi)*da;Pi<=1?(this._flyToFrame=dr(ps,this),this._move(this.unproject(E.add(N.subtract(E).multiplyBy(Mo(Lo)/Ce)),Pt),this.getScaleZoom(Xt/Co(Lo),Pt),{flyTo:!0})):this._move(s,f)._moveEnd(!0)}return this._moveStart(!0,w.noMoveStart),ps.call(this),this},flyToBounds:function(s,f){var w=this._getBoundsCenterZoom(s,f);return this.flyTo(w.center,w.zoom,f)},setMaxBounds:function(s){return s=Ii(s),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),s.isValid()?(this.options.maxBounds=s,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(s){var f=this.options.minZoom;return this.options.minZoom=s,this._loaded&&f!==s&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(s):this},setMaxZoom:function(s){var f=this.options.maxZoom;return this.options.maxZoom=s,this._loaded&&f!==s&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(s):this},panInsideBounds:function(s,f){this._enforcingBounds=!0;var w=this.getCenter(),E=this._limitCenter(w,this._zoom,Ii(s));return w.equals(E)||this.panTo(E,f),this._enforcingBounds=!1,this},panInside:function(s,f){f=f||{};var w=Ye(f.paddingTopLeft||f.padding||[0,0]),E=Ye(f.paddingBottomRight||f.padding||[0,0]),N=this.project(this.getCenter()),it=this.project(s),Pt=this.getPixelBounds(),Xt=ti([Pt.min.add(w),Pt.max.subtract(E)]),le=Xt.getSize();if(!Xt.contains(it)){this._enforcingBounds=!0;var Ce=it.subtract(Xt.getCenter()),ze=Xt.extend(it).getSize().subtract(le);N.x+=Ce.x<0?-ze.x:ze.x,N.y+=Ce.y<0?-ze.y:ze.y,this.panTo(this.unproject(N),f),this._enforcingBounds=!1}return this},invalidateSize:function(s){if(!this._loaded)return this;s=Vt({animate:!1,pan:!0},s===!0?{animate:!0}:s);var f=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var w=this.getSize(),E=f.divideBy(2).round(),N=w.divideBy(2).round(),it=E.subtract(N);return!it.x&&!it.y?this:(s.animate&&s.pan?this.panBy(it):(s.pan&&this._rawPanBy(it),this.fire("move"),s.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(S(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:f,newSize:w}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(s){if(s=this._locateOptions=Vt({timeout:1e4,watch:!1},s),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var f=S(this._handleGeolocationResponse,this),w=S(this._handleGeolocationError,this);return s.watch?this._locationWatchId=navigator.geolocation.watchPosition(f,w,s):navigator.geolocation.getCurrentPosition(f,w,s),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(s){if(this._container._leaflet_id){var f=s.code,w=s.message||(f===1?"permission denied":f===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:f,message:"Geolocation error: "+w+"."})}},_handleGeolocationResponse:function(s){if(this._container._leaflet_id){var f=s.coords.latitude,w=s.coords.longitude,E=new wi(f,w),N=E.toBounds(s.coords.accuracy*2),it=this._locateOptions;if(it.setView){var Pt=this.getBoundsZoom(N);this.setView(E,it.maxZoom?Math.min(Pt,it.maxZoom):Pt)}var Xt={latlng:E,bounds:N,timestamp:s.timestamp};for(var le in s.coords)typeof s.coords[le]=="number"&&(Xt[le]=s.coords[le]);this.fire("locationfound",Xt)}},addHandler:function(s,f){if(!f)return this;var w=this[s]=new f(this);return this._handlers.push(w),this.options[s]&&w.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Si(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Ki(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var s;for(s in this._layers)this._layers[s].remove();for(s in this._panes)Si(this._panes[s]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(s,f){var w="leaflet-pane"+(s?" leaflet-"+s.replace("Pane","")+"-pane":""),E=yi("div",w,f||this._mapPane);return s&&(this._panes[s]=E),E},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var s=this.getPixelBounds(),f=this.unproject(s.getBottomLeft()),w=this.unproject(s.getTopRight());return new $i(f,w)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(s,f,w){s=Ii(s),w=Ye(w||[0,0]);var E=this.getZoom()||0,N=this.getMinZoom(),it=this.getMaxZoom(),Pt=s.getNorthWest(),Xt=s.getSouthEast(),le=this.getSize().subtract(w),Ce=ti(this.project(Xt,E),this.project(Pt,E)).getSize(),ze=Se.any3d?this.options.zoomSnap:1,qe=le.x/Ce.x,fi=le.y/Ce.y,Pr=f?Math.max(qe,fi):Math.min(qe,fi);return E=this.getScaleZoom(Pr,E),ze&&(E=Math.round(E/(ze/100))*(ze/100),E=f?Math.ceil(E/ze)*ze:Math.floor(E/ze)*ze),Math.max(N,Math.min(it,E))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new ei(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(s,f){var w=this._getTopLeftPoint(s,f);return new bi(w,w.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(s){return this.options.crs.getProjectedBounds(s===void 0?this.getZoom():s)},getPane:function(s){return typeof s=="string"?this._panes[s]:s},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(s,f){var w=this.options.crs;return f=f===void 0?this._zoom:f,w.scale(s)/w.scale(f)},getScaleZoom:function(s,f){var w=this.options.crs;f=f===void 0?this._zoom:f;var E=w.zoom(s*w.scale(f));return isNaN(E)?1/0:E},project:function(s,f){return f=f===void 0?this._zoom:f,this.options.crs.latLngToPoint(mi(s),f)},unproject:function(s,f){return f=f===void 0?this._zoom:f,this.options.crs.pointToLatLng(Ye(s),f)},layerPointToLatLng:function(s){var f=Ye(s).add(this.getPixelOrigin());return this.unproject(f)},latLngToLayerPoint:function(s){var f=this.project(mi(s))._round();return f._subtract(this.getPixelOrigin())},wrapLatLng:function(s){return this.options.crs.wrapLatLng(mi(s))},wrapLatLngBounds:function(s){return this.options.crs.wrapLatLngBounds(Ii(s))},distance:function(s,f){return this.options.crs.distance(mi(s),mi(f))},containerPointToLayerPoint:function(s){return Ye(s).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(s){return Ye(s).add(this._getMapPanePos())},containerPointToLatLng:function(s){var f=this.containerPointToLayerPoint(Ye(s));return this.layerPointToLatLng(f)},latLngToContainerPoint:function(s){return this.layerPointToContainerPoint(this.latLngToLayerPoint(mi(s)))},mouseEventToContainerPoint:function(s){return Us(s,this._container)},mouseEventToLayerPoint:function(s){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(s))},mouseEventToLatLng:function(s){return this.layerPointToLatLng(this.mouseEventToLayerPoint(s))},_initContainer:function(s){var f=this._container=Ro(s);if(f){if(f._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");oi(f,"scroll",this._onScroll,this),this._containerId=rt(f)},_initLayout:function(){var s=this._container;this._fadeAnimated=this.options.fadeAnimation&&Se.any3d,hi(s,"leaflet-container"+(Se.touch?" leaflet-touch":"")+(Se.retina?" leaflet-retina":"")+(Se.ielt9?" leaflet-oldie":"")+(Se.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var f=Fs(s,"position");f!=="absolute"&&f!=="relative"&&f!=="fixed"&&f!=="sticky"&&(s.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var s=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),er(this._mapPane,new ei(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(hi(s.markerPane,"leaflet-zoom-hide"),hi(s.shadowPane,"leaflet-zoom-hide"))},_resetView:function(s,f,w){er(this._mapPane,new ei(0,0));var E=!this._loaded;this._loaded=!0,f=this._limitZoom(f),this.fire("viewprereset");var N=this._zoom!==f;this._moveStart(N,w)._move(s,f)._moveEnd(N),this.fire("viewreset"),E&&this.fire("load")},_moveStart:function(s,f){return s&&this.fire("zoomstart"),f||this.fire("movestart"),this},_move:function(s,f,w,E){f===void 0&&(f=this._zoom);var N=this._zoom!==f;return this._zoom=f,this._lastCenter=s,this._pixelOrigin=this._getNewPixelOrigin(s),E?w&&w.pinch&&this.fire("zoom",w):((N||w&&w.pinch)&&this.fire("zoom",w),this.fire("move",w)),this},_moveEnd:function(s){return s&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Ki(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(s){er(this._mapPane,this._getMapPanePos().subtract(s))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(s){this._targets={},this._targets[rt(this._container)]=this;var f=s?ii:oi;f(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&f(window,"resize",this._onResize,this),Se.any3d&&this.options.transform3DLimit&&(s?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Ki(this._resizeRequest),this._resizeRequest=dr(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var s=this._getMapPanePos();Math.max(Math.abs(s.x),Math.abs(s.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(s,f){for(var w=[],E,N=f==="mouseout"||f==="mouseover",it=s.target||s.srcElement,Pt=!1;it;){if(E=this._targets[rt(it)],E&&(f==="click"||f==="preclick")&&this._draggableMoved(E)){Pt=!0;break}if(E&&E.listens(f,!0)&&(N&&!Jr(it,s)||(w.push(E),N))||it===this._container)break;it=it.parentNode}return!w.length&&!Pt&&!N&&this.listens(f,!0)&&(w=[this]),w},_isClickDisabled:function(s){for(;s&&s!==this._container;){if(s._leaflet_disable_click)return!0;s=s.parentNode}},_handleDOMEvent:function(s){var f=s.target||s.srcElement;if(!(!this._loaded||f._leaflet_disable_events||s.type==="click"&&this._isClickDisabled(f))){var w=s.type;w==="mousedown"&&Yr(f),this._fireDOMEvent(s,w)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(s,f,w){if(s.type==="click"){var E=Vt({},s);E.type="preclick",this._fireDOMEvent(E,E.type,w)}var N=this._findEventTargets(s,f);if(w){for(var it=[],Pt=0;Pt<w.length;Pt++)w[Pt].listens(f,!0)&&it.push(w[Pt]);N=it.concat(N)}if(N.length){f==="contextmenu"&&Ve(s);var Xt=N[0],le={originalEvent:s};if(s.type!=="keypress"&&s.type!=="keydown"&&s.type!=="keyup"){var Ce=Xt.getLatLng&&(!Xt._radius||Xt._radius<=10);le.containerPoint=Ce?this.latLngToContainerPoint(Xt.getLatLng()):this.mouseEventToContainerPoint(s),le.layerPoint=this.containerPointToLayerPoint(le.containerPoint),le.latlng=Ce?Xt.getLatLng():this.layerPointToLatLng(le.layerPoint)}for(Pt=0;Pt<N.length;Pt++)if(N[Pt].fire(f,le,!0),le.originalEvent._stopped||N[Pt].options.bubblingMouseEvents===!1&&Wi(this._mouseEvents,f)!==-1)return}},_draggableMoved:function(s){return s=s.dragging&&s.dragging.enabled()?s:this,s.dragging&&s.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var s=0,f=this._handlers.length;s<f;s++)this._handlers[s].disable()},whenReady:function(s,f){return this._loaded?s.call(f||this,{target:this}):this.on("load",s,f),this},_getMapPanePos:function(){return os(this._mapPane)||new ei(0,0)},_moved:function(){var s=this._getMapPanePos();return s&&!s.equals([0,0])},_getTopLeftPoint:function(s,f){var w=s&&f!==void 0?this._getNewPixelOrigin(s,f):this.getPixelOrigin();return w.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(s,f){var w=this.getSize()._divideBy(2);return this.project(s,f)._subtract(w)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(s,f,w){var E=this._getNewPixelOrigin(w,f);return this.project(s,f)._subtract(E)},_latLngBoundsToNewLayerBounds:function(s,f,w){var E=this._getNewPixelOrigin(w,f);return ti([this.project(s.getSouthWest(),f)._subtract(E),this.project(s.getNorthWest(),f)._subtract(E),this.project(s.getSouthEast(),f)._subtract(E),this.project(s.getNorthEast(),f)._subtract(E)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(s){return this.latLngToLayerPoint(s).subtract(this._getCenterLayerPoint())},_limitCenter:function(s,f,w){if(!w)return s;var E=this.project(s,f),N=this.getSize().divideBy(2),it=new bi(E.subtract(N),E.add(N)),Pt=this._getBoundsOffset(it,w,f);return Math.abs(Pt.x)<=1&&Math.abs(Pt.y)<=1?s:this.unproject(E.add(Pt),f)},_limitOffset:function(s,f){if(!f)return s;var w=this.getPixelBounds(),E=new bi(w.min.add(s),w.max.add(s));return s.add(this._getBoundsOffset(E,f))},_getBoundsOffset:function(s,f,w){var E=ti(this.project(f.getNorthEast(),w),this.project(f.getSouthWest(),w)),N=E.min.subtract(s.min),it=E.max.subtract(s.max),Pt=this._rebound(N.x,-it.x),Xt=this._rebound(N.y,-it.y);return new ei(Pt,Xt)},_rebound:function(s,f){return s+f>0?Math.round(s-f)/2:Math.max(0,Math.ceil(s))-Math.max(0,Math.floor(f))},_limitZoom:function(s){var f=this.getMinZoom(),w=this.getMaxZoom(),E=Se.any3d?this.options.zoomSnap:1;return E&&(s=Math.round(s/E)*E),Math.max(f,Math.min(w,s))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Ji(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(s,f){var w=this._getCenterOffset(s)._trunc();return(f&&f.animate)!==!0&&!this.getSize().contains(w)?!1:(this.panBy(w,f),!0)},_createAnimProxy:function(){var s=this._proxy=yi("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(s),this.on("zoomanim",function(f){var w=Or,E=this._proxy.style[w];xs(this._proxy,this.project(f.center,f.zoom),this.getZoomScale(f.zoom,1)),E===this._proxy.style[w]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Si(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var s=this.getCenter(),f=this.getZoom();xs(this._proxy,this.project(s,f),this.getZoomScale(f,1))},_catchTransitionEnd:function(s){this._animatingZoom&&s.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(s,f,w){if(this._animatingZoom)return!0;if(w=w||{},!this._zoomAnimated||w.animate===!1||this._nothingToAnimate()||Math.abs(f-this._zoom)>this.options.zoomAnimationThreshold)return!1;var E=this.getZoomScale(f),N=this._getCenterOffset(s)._divideBy(1-1/E);return w.animate!==!0&&!this.getSize().contains(N)?!1:(dr(function(){this._moveStart(!0,w.noMoveStart||!1)._animateZoom(s,f,!0)},this),!0)},_animateZoom:function(s,f,w,E){this._mapPane&&(w&&(this._animatingZoom=!0,this._animateToCenter=s,this._animateToZoom=f,hi(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:s,zoom:f,noUpdate:E}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(S(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Ji(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function gl(s,f){return new vi(s,f)}var Nr=wr.extend({options:{position:"topright"},initialize:function(s){Ae(this,s)},getPosition:function(){return this.options.position},setPosition:function(s){var f=this._map;return f&&f.removeControl(this),this.options.position=s,f&&f.addControl(this),this},getContainer:function(){return this._container},addTo:function(s){this.remove(),this._map=s;var f=this._container=this.onAdd(s),w=this.getPosition(),E=s._controlCorners[w];return hi(f,"leaflet-control"),w.indexOf("bottom")!==-1?E.insertBefore(f,E.firstChild):E.appendChild(f),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Si(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(s){this._map&&s&&s.screenX>0&&s.screenY>0&&this._map.getContainer().focus()}}),ls=function(s){return new Nr(s)};vi.include({addControl:function(s){return s.addTo(this),this},removeControl:function(s){return s.remove(),this},_initControlPos:function(){var s=this._controlCorners={},f="leaflet-",w=this._controlContainer=yi("div",f+"control-container",this._container);function E(N,it){var Pt=f+N+" "+f+it;s[N+it]=yi("div",Pt,w)}E("top","left"),E("top","right"),E("bottom","left"),E("bottom","right")},_clearControlPos:function(){for(var s in this._controlCorners)Si(this._controlCorners[s]);Si(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var li=Nr.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(s,f,w,E){return w<E?-1:E<w?1:0}},initialize:function(s,f,w){Ae(this,w),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var E in s)this._addLayer(s[E],E);for(E in f)this._addLayer(f[E],E,!0)},onAdd:function(s){this._initLayout(),this._update(),this._map=s,s.on("zoomend",this._checkDisabledLayers,this);for(var f=0;f<this._layers.length;f++)this._layers[f].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(s){return Nr.prototype.addTo.call(this,s),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var s=0;s<this._layers.length;s++)this._layers[s].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(s,f){return this._addLayer(s,f),this._map?this._update():this},addOverlay:function(s,f){return this._addLayer(s,f,!0),this._map?this._update():this},removeLayer:function(s){s.off("add remove",this._onLayerChange,this);var f=this._getLayer(rt(s));return f&&this._layers.splice(this._layers.indexOf(f),1),this._map?this._update():this},expand:function(){hi(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var s=this._map.getSize().y-(this._container.offsetTop+50);return s<this._section.clientHeight?(hi(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=s+"px"):Ji(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Ji(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var s="leaflet-control-layers",f=this._container=yi("div",s),w=this.options.collapsed;f.setAttribute("aria-haspopup",!0),Qe(f),ir(f);var E=this._section=yi("section",s+"-list");w&&(this._map.on("click",this.collapse,this),oi(f,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var N=this._layersLink=yi("a",s+"-toggle",f);N.href="#",N.title="Layers",N.setAttribute("role","button"),oi(N,{keydown:function(it){it.keyCode===13&&this._expandSafely()},click:function(it){Ve(it),this._expandSafely()}},this),w||this.expand(),this._baseLayersList=yi("div",s+"-base",E),this._separator=yi("div",s+"-separator",E),this._overlaysList=yi("div",s+"-overlays",E),f.appendChild(E)},_getLayer:function(s){for(var f=0;f<this._layers.length;f++)if(this._layers[f]&&rt(this._layers[f].layer)===s)return this._layers[f]},_addLayer:function(s,f,w){this._map&&s.on("add remove",this._onLayerChange,this),this._layers.push({layer:s,name:f,overlay:w}),this.options.sortLayers&&this._layers.sort(S(function(E,N){return this.options.sortFunction(E.layer,N.layer,E.name,N.name)},this)),this.options.autoZIndex&&s.setZIndex&&(this._lastZIndex++,s.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ea(this._baseLayersList),ea(this._overlaysList),this._layerControlInputs=[];var s,f,w,E,N=0;for(w=0;w<this._layers.length;w++)E=this._layers[w],this._addItem(E),f=f||E.overlay,s=s||!E.overlay,N+=E.overlay?0:1;return this.options.hideSingleBase&&(s=s&&N>1,this._baseLayersList.style.display=s?"":"none"),this._separator.style.display=f&&s?"":"none",this},_onLayerChange:function(s){this._handlingClick||this._update();var f=this._getLayer(rt(s.target)),w=f.overlay?s.type==="add"?"overlayadd":"overlayremove":s.type==="add"?"baselayerchange":null;w&&this._map.fire(w,f)},_createRadioElement:function(s,f){var w='<input type="radio" class="leaflet-control-layers-selector" name="'+s+'"'+(f?' checked="checked"':"")+"/>",E=document.createElement("div");return E.innerHTML=w,E.firstChild},_addItem:function(s){var f=document.createElement("label"),w=this._map.hasLayer(s.layer),E;s.overlay?(E=document.createElement("input"),E.type="checkbox",E.className="leaflet-control-layers-selector",E.defaultChecked=w):E=this._createRadioElement("leaflet-base-layers_"+rt(this),w),this._layerControlInputs.push(E),E.layerId=rt(s.layer),oi(E,"click",this._onInputClick,this);var N=document.createElement("span");N.innerHTML=" "+s.name;var it=document.createElement("span");f.appendChild(it),it.appendChild(E),it.appendChild(N);var Pt=s.overlay?this._overlaysList:this._baseLayersList;return Pt.appendChild(f),this._checkDisabledLayers(),f},_onInputClick:function(){if(!this._preventClick){var s=this._layerControlInputs,f,w,E=[],N=[];this._handlingClick=!0;for(var it=s.length-1;it>=0;it--)f=s[it],w=this._getLayer(f.layerId).layer,f.checked?E.push(w):f.checked||N.push(w);for(it=0;it<N.length;it++)this._map.hasLayer(N[it])&&this._map.removeLayer(N[it]);for(it=0;it<E.length;it++)this._map.hasLayer(E[it])||this._map.addLayer(E[it]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var s=this._layerControlInputs,f,w,E=this._map.getZoom(),N=s.length-1;N>=0;N--)f=s[N],w=this._getLayer(f.layerId).layer,f.disabled=w.options.minZoom!==void 0&&E<w.options.minZoom||w.options.maxZoom!==void 0&&E>w.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var s=this._section;this._preventClick=!0,oi(s,"click",Ve),this.expand();var f=this;setTimeout(function(){ii(s,"click",Ve),f._preventClick=!1})}}),ar=function(s,f,w){return new li(s,f,w)},Wn=Nr.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(s){var f="leaflet-control-zoom",w=yi("div",f+" leaflet-bar"),E=this.options;return this._zoomInButton=this._createButton(E.zoomInText,E.zoomInTitle,f+"-in",w,this._zoomIn),this._zoomOutButton=this._createButton(E.zoomOutText,E.zoomOutTitle,f+"-out",w,this._zoomOut),this._updateDisabled(),s.on("zoomend zoomlevelschange",this._updateDisabled,this),w},onRemove:function(s){s.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(s){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(s.shiftKey?3:1))},_zoomOut:function(s){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(s.shiftKey?3:1))},_createButton:function(s,f,w,E,N){var it=yi("a",w,E);return it.innerHTML=s,it.href="#",it.title=f,it.setAttribute("role","button"),it.setAttribute("aria-label",f),Qe(it),oi(it,"click",mn),oi(it,"click",N,this),oi(it,"click",this._refocusOnMap,this),it},_updateDisabled:function(){var s=this._map,f="leaflet-disabled";Ji(this._zoomInButton,f),Ji(this._zoomOutButton,f),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||s._zoom===s.getMinZoom())&&(hi(this._zoomOutButton,f),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||s._zoom===s.getMaxZoom())&&(hi(this._zoomInButton,f),this._zoomInButton.setAttribute("aria-disabled","true"))}});vi.mergeOptions({zoomControl:!0}),vi.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Wn,this.addControl(this.zoomControl))});var ra=function(s){return new Wn(s)},$s=Nr.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(s){var f="leaflet-control-scale",w=yi("div",f),E=this.options;return this._addScales(E,f+"-line",w),s.on(E.updateWhenIdle?"moveend":"move",this._update,this),s.whenReady(this._update,this),w},onRemove:function(s){s.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(s,f,w){s.metric&&(this._mScale=yi("div",f,w)),s.imperial&&(this._iScale=yi("div",f,w))},_update:function(){var s=this._map,f=s.getSize().y/2,w=s.distance(s.containerPointToLatLng([0,f]),s.containerPointToLatLng([this.options.maxWidth,f]));this._updateScales(w)},_updateScales:function(s){this.options.metric&&s&&this._updateMetric(s),this.options.imperial&&s&&this._updateImperial(s)},_updateMetric:function(s){var f=this._getRoundNum(s),w=f<1e3?f+" m":f/1e3+" km";this._updateScale(this._mScale,w,f/s)},_updateImperial:function(s){var f=s*3.2808399,w,E,N;f>5280?(w=f/5280,E=this._getRoundNum(w),this._updateScale(this._iScale,E+" mi",E/w)):(N=this._getRoundNum(f),this._updateScale(this._iScale,N+" ft",N/f))},_updateScale:function(s,f,w){s.style.width=Math.round(this.options.maxWidth*w)+"px",s.innerHTML=f},_getRoundNum:function(s){var f=Math.pow(10,(Math.floor(s)+"").length-1),w=s/f;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:1,f*w}}),lr=function(s){return new $s(s)},ao='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Kn=Nr.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Se.inlineSvg?ao+" ":"")+"Leaflet</a>"},initialize:function(s){Ae(this,s),this._attributions={}},onAdd:function(s){s.attributionControl=this,this._container=yi("div","leaflet-control-attribution"),Qe(this._container);for(var f in s._layers)s._layers[f].getAttribution&&this.addAttribution(s._layers[f].getAttribution());return this._update(),s.on("layeradd",this._addAttribution,this),this._container},onRemove:function(s){s.off("layeradd",this._addAttribution,this)},_addAttribution:function(s){s.layer.getAttribution&&(this.addAttribution(s.layer.getAttribution()),s.layer.once("remove",function(){this.removeAttribution(s.layer.getAttribution())},this))},setPrefix:function(s){return this.options.prefix=s,this._update(),this},addAttribution:function(s){return s?(this._attributions[s]||(this._attributions[s]=0),this._attributions[s]++,this._update(),this):this},removeAttribution:function(s){return s?(this._attributions[s]&&(this._attributions[s]--,this._update()),this):this},_update:function(){if(this._map){var s=[];for(var f in this._attributions)this._attributions[f]&&s.push(f);var w=[];this.options.prefix&&w.push(this.options.prefix),s.length&&w.push(s.join(", ")),this._container.innerHTML=w.join(' <span aria-hidden="true">|</span> ')}}});vi.mergeOptions({attributionControl:!0}),vi.addInitHook(function(){this.options.attributionControl&&new Kn().addTo(this)});var Go=function(s){return new Kn(s)};Nr.Layers=li,Nr.Zoom=Wn,Nr.Scale=$s,Nr.Attribution=Kn,ls.layers=ar,ls.zoom=ra,ls.scale=lr,ls.attribution=Go;var Mr=wr.extend({initialize:function(s){this._map=s},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Mr.addTo=function(s,f){return s.addHandler(f,this),this};var bs={Events:gr},Xn=Se.touch?"touchstart mousedown":"mousedown",us=Nn.extend({options:{clickTolerance:3},initialize:function(s,f,w,E){Ae(this,E),this._element=s,this._dragStartTarget=f||s,this._preventOutline=w},enable:function(){this._enabled||(oi(this._dragStartTarget,Xn,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(us._dragging===this&&this.finishDrag(!0),ii(this._dragStartTarget,Xn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(s){if(this._enabled&&(this._moved=!1,!Gs(this._element,"leaflet-zoom-anim"))){if(s.touches&&s.touches.length!==1){us._dragging===this&&this.finishDrag();return}if(!(us._dragging||s.shiftKey||s.which!==1&&s.button!==1&&!s.touches)&&(us._dragging=this,this._preventOutline&&Yr(this._element),qn(),Vs(),!this._moving)){this.fire("down");var f=s.touches?s.touches[0]:s,w=di(this._element);this._startPoint=new ei(f.clientX,f.clientY),this._startPos=os(this._element),this._parentScale=so(w);var E=s.type==="mousedown";oi(document,E?"mousemove":"touchmove",this._onMove,this),oi(document,E?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(s){if(this._enabled){if(s.touches&&s.touches.length>1){this._moved=!0;return}var f=s.touches&&s.touches.length===1?s.touches[0]:s,w=new ei(f.clientX,f.clientY)._subtract(this._startPoint);!w.x&&!w.y||Math.abs(w.x)+Math.abs(w.y)<this.options.clickTolerance||(w.x/=this._parentScale.x,w.y/=this._parentScale.y,Ve(s),this._moved||(this.fire("dragstart"),this._moved=!0,hi(document.body,"leaflet-dragging"),this._lastTarget=s.target||s.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),hi(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(w),this._moving=!0,this._lastEvent=s,this._updatePosition())}},_updatePosition:function(){var s={originalEvent:this._lastEvent};this.fire("predrag",s),er(this._element,this._newPos),this.fire("drag",s)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(s){Ji(document.body,"leaflet-dragging"),this._lastTarget&&(Ji(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),ii(document,"mousemove touchmove",this._onMove,this),ii(document,"mouseup touchend touchcancel",this._onUp,this),as(),Xr();var f=this._moved&&this._moving;this._moving=!1,us._dragging=!1,f&&this.fire("dragend",{noInertia:s,distance:this._newPos.distanceTo(this._startPos)})}});function yl(s,f,w){var E,N=[1,4,2,8],it,Pt,Xt,le,Ce,ze,qe,fi;for(it=0,ze=s.length;it<ze;it++)s[it]._code=Gr(s[it],f);for(Xt=0;Xt<4;Xt++){for(qe=N[Xt],E=[],it=0,ze=s.length,Pt=ze-1;it<ze;Pt=it++)le=s[it],Ce=s[Pt],le._code&qe?Ce._code&qe||(fi=Xa(Ce,le,qe,f,w),fi._code=Gr(fi,f),E.push(fi)):(Ce._code&qe&&(fi=Xa(Ce,le,qe,f,w),fi._code=Gr(fi,f),E.push(fi)),E.push(le));s=E}return s}function Ar(s,f){var w,E,N,it,Pt,Xt,le,Ce,ze;if(!s||s.length===0)throw new Error("latlngs not passed");Yi(s)||(console.warn("latlngs are not flat! Only the first ring will be used"),s=s[0]);var qe=mi([0,0]),fi=Ii(s),Pr=fi.getNorthWest().distanceTo(fi.getSouthWest())*fi.getNorthEast().distanceTo(fi.getNorthWest());Pr<1700&&(qe=qs(s));var rr=s.length,rn=[];for(w=0;w<rr;w++){var Vr=mi(s[w]);rn.push(f.project(mi([Vr.lat-qe.lat,Vr.lng-qe.lng])))}for(Xt=le=Ce=0,w=0,E=rr-1;w<rr;E=w++)N=rn[w],it=rn[E],Pt=N.y*it.x-it.y*N.x,le+=(N.x+it.x)*Pt,Ce+=(N.y+it.y)*Pt,Xt+=Pt*3;Xt===0?ze=rn[0]:ze=[le/Xt,Ce/Xt];var Co=f.unproject(Ye(ze));return mi([Co.lat+qe.lat,Co.lng+qe.lng])}function qs(s){for(var f=0,w=0,E=0,N=0;N<s.length;N++){var it=mi(s[N]);f+=it.lat,w+=it.lng,E++}return mi([f/E,w/E])}var _n={__proto__:null,clipPolygon:yl,polygonCenter:Ar,centroid:qs};function jr(s,f){if(!f||!s.length)return s.slice();var w=f*f;return s=Lr(s,w),s=lo(s,w),s}function Sa(s,f,w){return Math.sqrt(En(s,f,w,!0))}function na(s,f,w){return En(s,f,w)}function lo(s,f){var w=s.length,E=typeof Uint8Array<"u"?Uint8Array:Array,N=new E(w);N[0]=N[w-1]=1,sa(s,N,f,0,w-1);var it,Pt=[];for(it=0;it<w;it++)N[it]&&Pt.push(s[it]);return Pt}function sa(s,f,w,E,N){var it=0,Pt,Xt,le;for(Xt=E+1;Xt<=N-1;Xt++)le=En(s[Xt],s[E],s[N],!0),le>it&&(Pt=Xt,it=le);it>w&&(f[Pt]=1,sa(s,f,w,E,Pt),sa(s,f,w,Pt,N))}function Lr(s,f){for(var w=[s[0]],E=1,N=0,it=s.length;E<it;E++)ws(s[E],s[N])>f&&(w.push(s[E]),N=E);return N<it-1&&w.push(s[it-1]),w}var Ir;function Ka(s,f,w,E,N){var it=E?Ir:Gr(s,w),Pt=Gr(f,w),Xt,le,Ce;for(Ir=Pt;;){if(!(it|Pt))return[s,f];if(it&Pt)return!1;Xt=it||Pt,le=Xa(s,f,Xt,w,N),Ce=Gr(le,w),Xt===it?(s=le,it=Ce):(f=le,Pt=Ce)}}function Xa(s,f,w,E,N){var it=f.x-s.x,Pt=f.y-s.y,Xt=E.min,le=E.max,Ce,ze;return w&8?(Ce=s.x+it*(le.y-s.y)/Pt,ze=le.y):w&4?(Ce=s.x+it*(Xt.y-s.y)/Pt,ze=Xt.y):w&2?(Ce=le.x,ze=s.y+Pt*(le.x-s.x)/it):w&1&&(Ce=Xt.x,ze=s.y+Pt*(Xt.x-s.x)/it),new ei(Ce,ze,N)}function Gr(s,f){var w=0;return s.x<f.min.x?w|=1:s.x>f.max.x&&(w|=2),s.y<f.min.y?w|=4:s.y>f.max.y&&(w|=8),w}function ws(s,f){var w=f.x-s.x,E=f.y-s.y;return w*w+E*E}function En(s,f,w,E){var N=f.x,it=f.y,Pt=w.x-N,Xt=w.y-it,le=Pt*Pt+Xt*Xt,Ce;return le>0&&(Ce=((s.x-N)*Pt+(s.y-it)*Xt)/le,Ce>1?(N=w.x,it=w.y):Ce>0&&(N+=Pt*Ce,it+=Xt*Ce)),Pt=s.x-N,Xt=s.y-it,E?Pt*Pt+Xt*Xt:new ei(N,it)}function Yi(s){return!Bi(s[0])||typeof s[0][0]!="object"&&typeof s[0][0]<"u"}function ka(s){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Yi(s)}function oa(s,f){var w,E,N,it,Pt,Xt,le,Ce;if(!s||s.length===0)throw new Error("latlngs not passed");Yi(s)||(console.warn("latlngs are not flat! Only the first ring will be used"),s=s[0]);var ze=mi([0,0]),qe=Ii(s),fi=qe.getNorthWest().distanceTo(qe.getSouthWest())*qe.getNorthEast().distanceTo(qe.getNorthWest());fi<1700&&(ze=qs(s));var Pr=s.length,rr=[];for(w=0;w<Pr;w++){var rn=mi(s[w]);rr.push(f.project(mi([rn.lat-ze.lat,rn.lng-ze.lng])))}for(w=0,E=0;w<Pr-1;w++)E+=rr[w].distanceTo(rr[w+1])/2;if(E===0)Ce=rr[0];else for(w=0,it=0;w<Pr-1;w++)if(Pt=rr[w],Xt=rr[w+1],N=Pt.distanceTo(Xt),it+=N,it>E){le=(it-E)/N,Ce=[Xt.x-le*(Xt.x-Pt.x),Xt.y-le*(Xt.y-Pt.y)];break}var Vr=f.unproject(Ye(Ce));return mi([Vr.lat+ze.lat,Vr.lng+ze.lng])}var An={__proto__:null,simplify:jr,pointToSegmentDistance:Sa,closestPointOnSegment:na,clipSegment:Ka,_getEdgeIntersection:Xa,_getBitCode:Gr,_sqClosestPointOnSegment:En,isFlat:Yi,_flat:ka,polylineCenter:oa},gn={project:function(s){return new ei(s.lng,s.lat)},unproject:function(s){return new wi(s.y,s.x)},bounds:new bi([-180,-90],[180,90])},Zo={R:6378137,R_MINOR:6356752314245179e-9,bounds:new bi([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(s){var f=Math.PI/180,w=this.R,E=s.lat*f,N=this.R_MINOR/w,it=Math.sqrt(1-N*N),Pt=it*Math.sin(E),Xt=Math.tan(Math.PI/4-E/2)/Math.pow((1-Pt)/(1+Pt),it/2);return E=-w*Math.log(Math.max(Xt,1e-10)),new ei(s.lng*f*w,E)},unproject:function(s){for(var f=180/Math.PI,w=this.R,E=this.R_MINOR/w,N=Math.sqrt(1-E*E),it=Math.exp(-s.y/w),Pt=Math.PI/2-2*Math.atan(it),Xt=0,le=.1,Ce;Xt<15&&Math.abs(le)>1e-7;Xt++)Ce=N*Math.sin(Pt),Ce=Math.pow((1-Ce)/(1+Ce),N/2),le=Math.PI/2-2*Math.atan(it*Ce)-Pt,Pt+=le;return new wi(Pt*f,s.x*f/w)}},Hs={__proto__:null,LonLat:gn,Mercator:Zo,SphericalMercator:ro},aa=Vt({},jn,{code:"EPSG:3395",projection:Zo,transformation:function(){var s=.5/(Math.PI*Zo.R);return _s(s,.5,-s,.5)}()}),In=Vt({},jn,{code:"EPSG:4326",projection:gn,transformation:_s(1/180,1,-1/180,.5)}),Qr=Vt({},Wr,{projection:gn,transformation:_s(1,0,-1,0),scale:function(s){return Math.pow(2,s)},zoom:function(s){return Math.log(s)/Math.LN2},distance:function(s,f){var w=f.lng-s.lng,E=f.lat-s.lat;return Math.sqrt(w*w+E*E)},infinite:!0});Wr.Earth=jn,Wr.EPSG3395=aa,Wr.EPSG3857=ji,Wr.EPSG900913=rs,Wr.EPSG4326=In,Wr.Simple=Qr;var Zr=Nn.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(s){return s.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(s){return s&&s.removeLayer(this),this},getPane:function(s){return this._map.getPane(s?this.options[s]||s:this.options.pane)},addInteractiveTarget:function(s){return this._map._targets[rt(s)]=this,this},removeInteractiveTarget:function(s){return delete this._map._targets[rt(s)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(s){var f=s.target;if(f.hasLayer(this)){if(this._map=f,this._zoomAnimated=f._zoomAnimated,this.getEvents){var w=this.getEvents();f.on(w,this),this.once("remove",function(){f.off(w,this)},this)}this.onAdd(f),this.fire("add"),f.fire("layeradd",{layer:this})}}});vi.include({addLayer:function(s){if(!s._layerAdd)throw new Error("The provided object is not a Layer.");var f=rt(s);return this._layers[f]?this:(this._layers[f]=s,s._mapToAdd=this,s.beforeAdd&&s.beforeAdd(this),this.whenReady(s._layerAdd,s),this)},removeLayer:function(s){var f=rt(s);return this._layers[f]?(this._loaded&&s.onRemove(this),delete this._layers[f],this._loaded&&(this.fire("layerremove",{layer:s}),s.fire("remove")),s._map=s._mapToAdd=null,this):this},hasLayer:function(s){return rt(s)in this._layers},eachLayer:function(s,f){for(var w in this._layers)s.call(f,this._layers[w]);return this},_addLayers:function(s){s=s?Bi(s)?s:[s]:[];for(var f=0,w=s.length;f<w;f++)this.addLayer(s[f])},_addZoomLimit:function(s){(!isNaN(s.options.maxZoom)||!isNaN(s.options.minZoom))&&(this._zoomBoundLayers[rt(s)]=s,this._updateZoomLevels())},_removeZoomLimit:function(s){var f=rt(s);this._zoomBoundLayers[f]&&(delete this._zoomBoundLayers[f],this._updateZoomLevels())},_updateZoomLevels:function(){var s=1/0,f=-1/0,w=this._getZoomSpan();for(var E in this._zoomBoundLayers){var N=this._zoomBoundLayers[E].options;s=N.minZoom===void 0?s:Math.min(s,N.minZoom),f=N.maxZoom===void 0?f:Math.max(f,N.maxZoom)}this._layersMaxZoom=f===-1/0?void 0:f,this._layersMinZoom=s===1/0?void 0:s,w!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Bn=Zr.extend({initialize:function(s,f){Ae(this,f),this._layers={};var w,E;if(s)for(w=0,E=s.length;w<E;w++)this.addLayer(s[w])},addLayer:function(s){var f=this.getLayerId(s);return this._layers[f]=s,this._map&&this._map.addLayer(s),this},removeLayer:function(s){var f=s in this._layers?s:this.getLayerId(s);return this._map&&this._layers[f]&&this._map.removeLayer(this._layers[f]),delete this._layers[f],this},hasLayer:function(s){var f=typeof s=="number"?s:this.getLayerId(s);return f in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(s){var f=Array.prototype.slice.call(arguments,1),w,E;for(w in this._layers)E=this._layers[w],E[s]&&E[s].apply(E,f);return this},onAdd:function(s){this.eachLayer(s.addLayer,s)},onRemove:function(s){this.eachLayer(s.removeLayer,s)},eachLayer:function(s,f){for(var w in this._layers)s.call(f,this._layers[w]);return this},getLayer:function(s){return this._layers[s]},getLayers:function(){var s=[];return this.eachLayer(s.push,s),s},setZIndex:function(s){return this.invoke("setZIndex",s)},getLayerId:function(s){return rt(s)}}),Ya=function(s,f){return new Bn(s,f)},tn=Bn.extend({addLayer:function(s){return this.hasLayer(s)?this:(s.addEventParent(this),Bn.prototype.addLayer.call(this,s),this.fire("layeradd",{layer:s}))},removeLayer:function(s){return this.hasLayer(s)?(s in this._layers&&(s=this._layers[s]),s.removeEventParent(this),Bn.prototype.removeLayer.call(this,s),this.fire("layerremove",{layer:s})):this},setStyle:function(s){return this.invoke("setStyle",s)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var s=new $i;for(var f in this._layers){var w=this._layers[f];s.extend(w.getBounds?w.getBounds():w.getLatLng())}return s}}),Bl=function(s,f){return new tn(s,f)},Cs=wr.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(s){Ae(this,s)},createIcon:function(s){return this._createIcon("icon",s)},createShadow:function(s){return this._createIcon("shadow",s)},_createIcon:function(s,f){var w=this._getIconUrl(s);if(!w){if(s==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var E=this._createImg(w,f&&f.tagName==="IMG"?f:null);return this._setIconStyles(E,s),(this.options.crossOrigin||this.options.crossOrigin==="")&&(E.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),E},_setIconStyles:function(s,f){var w=this.options,E=w[f+"Size"];typeof E=="number"&&(E=[E,E]);var N=Ye(E),it=Ye(f==="shadow"&&w.shadowAnchor||w.iconAnchor||N&&N.divideBy(2,!0));s.className="leaflet-marker-"+f+" "+(w.className||""),it&&(s.style.marginLeft=-it.x+"px",s.style.marginTop=-it.y+"px"),N&&(s.style.width=N.x+"px",s.style.height=N.y+"px")},_createImg:function(s,f){return f=f||document.createElement("img"),f.src=s,f},_getIconUrl:function(s){return Se.retina&&this.options[s+"RetinaUrl"]||this.options[s+"Url"]}});function la(s){return new Cs(s)}var Vo=Cs.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(s){return typeof Vo.imagePath!="string"&&(Vo.imagePath=this._detectIconPath()),(this.options.imagePath||Vo.imagePath)+Cs.prototype._getIconUrl.call(this,s)},_stripUrl:function(s){var f=function(w,E,N){var it=E.exec(w);return it&&it[N]};return s=f(s,/^url\((['"])?(.+)\1\)$/,2),s&&f(s,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var s=yi("div","leaflet-default-icon-path",document.body),f=Fs(s,"background-image")||Fs(s,"backgroundImage");if(document.body.removeChild(s),f=this._stripUrl(f),f)return f;var w=document.querySelector('link[href$="leaflet.css"]');return w?w.href.substring(0,w.href.length-11-1):""}}),Ja=Mr.extend({initialize:function(s){this._marker=s},addHooks:function(){var s=this._marker._icon;this._draggable||(this._draggable=new us(s,s,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),hi(s,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Ji(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(s){var f=this._marker,w=f._map,E=this._marker.options.autoPanSpeed,N=this._marker.options.autoPanPadding,it=os(f._icon),Pt=w.getPixelBounds(),Xt=w.getPixelOrigin(),le=ti(Pt.min._subtract(Xt).add(N),Pt.max._subtract(Xt).subtract(N));if(!le.contains(it)){var Ce=Ye((Math.max(le.max.x,it.x)-le.max.x)/(Pt.max.x-le.max.x)-(Math.min(le.min.x,it.x)-le.min.x)/(Pt.min.x-le.min.x),(Math.max(le.max.y,it.y)-le.max.y)/(Pt.max.y-le.max.y)-(Math.min(le.min.y,it.y)-le.min.y)/(Pt.min.y-le.min.y)).multiplyBy(E);w.panBy(Ce,{animate:!1}),this._draggable._newPos._add(Ce),this._draggable._startPos._add(Ce),er(f._icon,this._draggable._newPos),this._onDrag(s),this._panRequest=dr(this._adjustPan.bind(this,s))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(s){this._marker.options.autoPan&&(Ki(this._panRequest),this._panRequest=dr(this._adjustPan.bind(this,s)))},_onDrag:function(s){var f=this._marker,w=f._shadow,E=os(f._icon),N=f._map.layerPointToLatLng(E);w&&er(w,E),f._latlng=N,s.latlng=N,s.oldLatLng=this._oldLatLng,f.fire("move",s).fire("drag",s)},_onDragEnd:function(s){Ki(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",s)}}),Uo=Zr.extend({options:{icon:new Vo,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(s,f){Ae(this,f),this._latlng=mi(s)},onAdd:function(s){this._zoomAnimated=this._zoomAnimated&&s.options.markerZoomAnimation,this._zoomAnimated&&s.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(s){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&s.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(s){var f=this._latlng;return this._latlng=mi(s),this.update(),this.fire("move",{oldLatLng:f,latlng:this._latlng})},setZIndexOffset:function(s){return this.options.zIndexOffset=s,this.update()},getIcon:function(){return this.options.icon},setIcon:function(s){return this.options.icon=s,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var s=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(s)}return this},_initIcon:function(){var s=this.options,f="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),w=s.icon.createIcon(this._icon),E=!1;w!==this._icon&&(this._icon&&this._removeIcon(),E=!0,s.title&&(w.title=s.title),w.tagName==="IMG"&&(w.alt=s.alt||"")),hi(w,f),s.keyboard&&(w.tabIndex="0",w.setAttribute("role","button")),this._icon=w,s.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&oi(w,"focus",this._panOnFocus,this);var N=s.icon.createShadow(this._shadow),it=!1;N!==this._shadow&&(this._removeShadow(),it=!0),N&&(hi(N,f),N.alt=""),this._shadow=N,s.opacity<1&&this._updateOpacity(),E&&this.getPane().appendChild(this._icon),this._initInteraction(),N&&it&&this.getPane(s.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ii(this._icon,"focus",this._panOnFocus,this),Si(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Si(this._shadow),this._shadow=null},_setPos:function(s){this._icon&&er(this._icon,s),this._shadow&&er(this._shadow,s),this._zIndex=s.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(s){this._icon&&(this._icon.style.zIndex=this._zIndex+s)},_animateZoom:function(s){var f=this._map._latLngToNewLayerPoint(this._latlng,s.zoom,s.center).round();this._setPos(f)},_initInteraction:function(){if(this.options.interactive&&(hi(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Ja)){var s=this.options.draggable;this.dragging&&(s=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Ja(this),s&&this.dragging.enable()}},setOpacity:function(s){return this.options.opacity=s,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var s=this.options.opacity;this._icon&&dn(this._icon,s),this._shadow&&dn(this._shadow,s)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var s=this._map;if(s){var f=this.options.icon.options,w=f.iconSize?Ye(f.iconSize):Ye(0,0),E=f.iconAnchor?Ye(f.iconAnchor):Ye(0,0);s.panInside(this._latlng,{paddingTopLeft:E,paddingBottomRight:w.subtract(E)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Qa(s,f){return new Uo(s,f)}var Br=Zr.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(s){this._renderer=s.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(s){return Ae(this,s),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&s&&Object.prototype.hasOwnProperty.call(s,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),ua=Br.extend({options:{fill:!0,radius:10},initialize:function(s,f){Ae(this,f),this._latlng=mi(s),this._radius=this.options.radius},setLatLng:function(s){var f=this._latlng;return this._latlng=mi(s),this.redraw(),this.fire("move",{oldLatLng:f,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(s){return this.options.radius=this._radius=s,this.redraw()},getRadius:function(){return this._radius},setStyle:function(s){var f=s&&s.radius||this._radius;return Br.prototype.setStyle.call(this,s),this.setRadius(f),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var s=this._radius,f=this._radiusY||s,w=this._clickTolerance(),E=[s+w,f+w];this._pxBounds=new bi(this._point.subtract(E),this._point.add(E))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(s){return s.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function tl(s,f){return new ua(s,f)}var Ms=ua.extend({initialize:function(s,f,w){if(typeof f=="number"&&(f=Vt({},w,{radius:f})),Ae(this,f),this._latlng=mi(s),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(s){return this._mRadius=s,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var s=[this._radius,this._radiusY||this._radius];return new $i(this._map.layerPointToLatLng(this._point.subtract(s)),this._map.layerPointToLatLng(this._point.add(s)))},setStyle:Br.prototype.setStyle,_project:function(){var s=this._latlng.lng,f=this._latlng.lat,w=this._map,E=w.options.crs;if(E.distance===jn.distance){var N=Math.PI/180,it=this._mRadius/jn.R/N,Pt=w.project([f+it,s]),Xt=w.project([f-it,s]),le=Pt.add(Xt).divideBy(2),Ce=w.unproject(le).lat,ze=Math.acos((Math.cos(it*N)-Math.sin(f*N)*Math.sin(Ce*N))/(Math.cos(f*N)*Math.cos(Ce*N)))/N;(isNaN(ze)||ze===0)&&(ze=it/Math.cos(Math.PI/180*f)),this._point=le.subtract(w.getPixelOrigin()),this._radius=isNaN(ze)?0:le.x-w.project([Ce,s-ze]).x,this._radiusY=le.y-Pt.y}else{var qe=E.unproject(E.project(this._latlng).subtract([this._mRadius,0]));this._point=w.latLngToLayerPoint(this._latlng),this._radius=this._point.x-w.latLngToLayerPoint(qe).x}this._updateBounds()}});function uo(s,f,w){return new Ms(s,f,w)}var yn=Br.extend({options:{smoothFactor:1,noClip:!1},initialize:function(s,f){Ae(this,f),this._setLatLngs(s)},getLatLngs:function(){return this._latlngs},setLatLngs:function(s){return this._setLatLngs(s),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(s){for(var f=1/0,w=null,E=En,N,it,Pt=0,Xt=this._parts.length;Pt<Xt;Pt++)for(var le=this._parts[Pt],Ce=1,ze=le.length;Ce<ze;Ce++){N=le[Ce-1],it=le[Ce];var qe=E(s,N,it,!0);qe<f&&(f=qe,w=E(s,N,it))}return w&&(w.distance=Math.sqrt(f)),w},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return oa(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(s,f){return f=f||this._defaultShape(),s=mi(s),f.push(s),this._bounds.extend(s),this.redraw()},_setLatLngs:function(s){this._bounds=new $i,this._latlngs=this._convertLatLngs(s)},_defaultShape:function(){return Yi(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(s){for(var f=[],w=Yi(s),E=0,N=s.length;E<N;E++)w?(f[E]=mi(s[E]),this._bounds.extend(f[E])):f[E]=this._convertLatLngs(s[E]);return f},_project:function(){var s=new bi;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,s),this._bounds.isValid()&&s.isValid()&&(this._rawPxBounds=s,this._updateBounds())},_updateBounds:function(){var s=this._clickTolerance(),f=new ei(s,s);this._rawPxBounds&&(this._pxBounds=new bi([this._rawPxBounds.min.subtract(f),this._rawPxBounds.max.add(f)]))},_projectLatlngs:function(s,f,w){var E=s[0]instanceof wi,N=s.length,it,Pt;if(E){for(Pt=[],it=0;it<N;it++)Pt[it]=this._map.latLngToLayerPoint(s[it]),w.extend(Pt[it]);f.push(Pt)}else for(it=0;it<N;it++)this._projectLatlngs(s[it],f,w)},_clipPoints:function(){var s=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(s))){if(this.options.noClip){this._parts=this._rings;return}var f=this._parts,w,E,N,it,Pt,Xt,le;for(w=0,N=0,it=this._rings.length;w<it;w++)for(le=this._rings[w],E=0,Pt=le.length;E<Pt-1;E++)Xt=Ka(le[E],le[E+1],s,E,!0),Xt&&(f[N]=f[N]||[],f[N].push(Xt[0]),(Xt[1]!==le[E+1]||E===Pt-2)&&(f[N].push(Xt[1]),N++))}},_simplifyPoints:function(){for(var s=this._parts,f=this.options.smoothFactor,w=0,E=s.length;w<E;w++)s[w]=jr(s[w],f)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(s,f){var w,E,N,it,Pt,Xt,le=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(s))return!1;for(w=0,it=this._parts.length;w<it;w++)for(Xt=this._parts[w],E=0,Pt=Xt.length,N=Pt-1;E<Pt;N=E++)if(!(!f&&E===0)&&Sa(s,Xt[N],Xt[E])<=le)return!0;return!1}});function Dl(s,f){return new yn(s,f)}yn._flat=ka;var vn=yn.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ar(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(s){var f=yn.prototype._convertLatLngs.call(this,s),w=f.length;return w>=2&&f[0]instanceof wi&&f[0].equals(f[w-1])&&f.pop(),f},_setLatLngs:function(s){yn.prototype._setLatLngs.call(this,s),Yi(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Yi(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var s=this._renderer._bounds,f=this.options.weight,w=new ei(f,f);if(s=new bi(s.min.subtract(w),s.max.add(w)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(s))){if(this.options.noClip){this._parts=this._rings;return}for(var E=0,N=this._rings.length,it;E<N;E++)it=yl(this._rings[E],s,!0),it.length&&this._parts.push(it)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(s){var f=!1,w,E,N,it,Pt,Xt,le,Ce;if(!this._pxBounds||!this._pxBounds.contains(s))return!1;for(it=0,le=this._parts.length;it<le;it++)for(w=this._parts[it],Pt=0,Ce=w.length,Xt=Ce-1;Pt<Ce;Xt=Pt++)E=w[Pt],N=w[Xt],E.y>s.y!=N.y>s.y&&s.x<(N.x-E.x)*(s.y-E.y)/(N.y-E.y)+E.x&&(f=!f);return f||yn.prototype._containsPoint.call(this,s,!0)}});function vl(s,f){return new vn(s,f)}var hs=tn.extend({initialize:function(s,f){Ae(this,f),this._layers={},s&&this.addData(s)},addData:function(s){var f=Bi(s)?s:s.features,w,E,N;if(f){for(w=0,E=f.length;w<E;w++)N=f[w],(N.geometries||N.geometry||N.features||N.coordinates)&&this.addData(N);return this}var it=this.options;if(it.filter&&!it.filter(s))return this;var Pt=ho(s,it);return Pt?(Pt.feature=fo(s),Pt.defaultOptions=Pt.options,this.resetStyle(Pt),it.onEachFeature&&it.onEachFeature(s,Pt),this.addLayer(Pt)):this},resetStyle:function(s){return s===void 0?this.eachLayer(this.resetStyle,this):(s.options=Vt({},s.defaultOptions),this._setLayerStyle(s,this.options.style),this)},setStyle:function(s){return this.eachLayer(function(f){this._setLayerStyle(f,s)},this)},_setLayerStyle:function(s,f){s.setStyle&&(typeof f=="function"&&(f=f(s.feature)),s.setStyle(f))}});function ho(s,f){var w=s.type==="Feature"?s.geometry:s,E=w?w.coordinates:null,N=[],it=f&&f.pointToLayer,Pt=f&&f.coordsToLatLng||Ci,Xt,le,Ce,ze;if(!E&&!w)return null;switch(w.type){case"Point":return Xt=Pt(E),Ws(it,s,Xt,f);case"MultiPoint":for(Ce=0,ze=E.length;Ce<ze;Ce++)Xt=Pt(E[Ce]),N.push(Ws(it,s,Xt,f));return new tn(N);case"LineString":case"MultiLineString":return le=co(E,w.type==="LineString"?0:1,Pt),new yn(le,f);case"Polygon":case"MultiPolygon":return le=co(E,w.type==="Polygon"?1:2,Pt),new vn(le,f);case"GeometryCollection":for(Ce=0,ze=w.geometries.length;Ce<ze;Ce++){var qe=ho({geometry:w.geometries[Ce],type:"Feature",properties:s.properties},f);qe&&N.push(qe)}return new tn(N);case"FeatureCollection":for(Ce=0,ze=w.features.length;Ce<ze;Ce++){var fi=ho(w.features[Ce],f);fi&&N.push(fi)}return new tn(N);default:throw new Error("Invalid GeoJSON object.")}}function Ws(s,f,w,E){return s?s(f,w):new Uo(w,E&&E.markersInheritOptions&&E)}function Ci(s){return new wi(s[1],s[0],s[2])}function co(s,f,w){for(var E=[],N=0,it=s.length,Pt;N<it;N++)Pt=f?co(s[N],f-1,w):(w||Ci)(s[N]),E.push(Pt);return E}function Yn(s,f){return s=mi(s),s.alt!==void 0?[re(s.lng,f),re(s.lat,f),re(s.alt,f)]:[re(s.lng,f),re(s.lat,f)]}function po(s,f,w,E){for(var N=[],it=0,Pt=s.length;it<Pt;it++)N.push(f?po(s[it],Yi(s[it])?0:f-1,w,E):Yn(s[it],E));return!f&&w&&N.length>0&&N.push(N[0].slice()),N}function Ks(s,f){return s.feature?Vt({},s.feature,{geometry:f}):fo(f)}function fo(s){return s.type==="Feature"||s.type==="FeatureCollection"?s:{type:"Feature",properties:{},geometry:s}}var Ea={toGeoJSON:function(s){return Ks(this,{type:"Point",coordinates:Yn(this.getLatLng(),s)})}};Uo.include(Ea),Ms.include(Ea),ua.include(Ea),yn.include({toGeoJSON:function(s){var f=!Yi(this._latlngs),w=po(this._latlngs,f?1:0,!1,s);return Ks(this,{type:(f?"Multi":"")+"LineString",coordinates:w})}}),vn.include({toGeoJSON:function(s){var f=!Yi(this._latlngs),w=f&&!Yi(this._latlngs[0]),E=po(this._latlngs,w?2:f?1:0,!0,s);return f||(E=[E]),Ks(this,{type:(w?"Multi":"")+"Polygon",coordinates:E})}}),Bn.include({toMultiPoint:function(s){var f=[];return this.eachLayer(function(w){f.push(w.toGeoJSON(s).geometry.coordinates)}),Ks(this,{type:"MultiPoint",coordinates:f})},toGeoJSON:function(s){var f=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(f==="MultiPoint")return this.toMultiPoint(s);var w=f==="GeometryCollection",E=[];return this.eachLayer(function(N){if(N.toGeoJSON){var it=N.toGeoJSON(s);if(w)E.push(it.geometry);else{var Pt=fo(it);Pt.type==="FeatureCollection"?E.push.apply(E,Pt.features):E.push(Pt)}}}),w?Ks(this,{geometries:E,type:"GeometryCollection"}):{type:"FeatureCollection",features:E}}});function Aa(s,f){return new hs(s,f)}var mo=Aa,_o=Zr.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(s,f,w){this._url=s,this._bounds=Ii(f),Ae(this,w)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(hi(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Si(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(s){return this.options.opacity=s,this._image&&this._updateOpacity(),this},setStyle:function(s){return s.opacity&&this.setOpacity(s.opacity),this},bringToFront:function(){return this._map&&Ns(this._image),this},bringToBack:function(){return this._map&&js(this._image),this},setUrl:function(s){return this._url=s,this._image&&(this._image.src=s),this},setBounds:function(s){return this._bounds=Ii(s),this._map&&this._reset(),this},getEvents:function(){var s={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(s.zoomanim=this._animateZoom),s},setZIndex:function(s){return this.options.zIndex=s,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var s=this._url.tagName==="IMG",f=this._image=s?this._url:yi("img");if(hi(f,"leaflet-image-layer"),this._zoomAnimated&&hi(f,"leaflet-zoom-animated"),this.options.className&&hi(f,this.options.className),f.onselectstart=Kt,f.onmousemove=Kt,f.onload=S(this.fire,this,"load"),f.onerror=S(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(f.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),s){this._url=f.src;return}f.src=this._url,f.alt=this.options.alt},_animateZoom:function(s){var f=this._map.getZoomScale(s.zoom),w=this._map._latLngBoundsToNewLayerBounds(this._bounds,s.zoom,s.center).min;xs(this._image,w,f)},_reset:function(){var s=this._image,f=new bi(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),w=f.getSize();er(s,f.min),s.style.width=w.x+"px",s.style.height=w.y+"px"},_updateOpacity:function(){dn(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var s=this.options.errorOverlayUrl;s&&this._url!==s&&(this._url=s,this._image.src=s)},getCenter:function(){return this._bounds.getCenter()}}),el=function(s,f,w){return new _o(s,f,w)},il=_o.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var s=this._url.tagName==="VIDEO",f=this._image=s?this._url:yi("video");if(hi(f,"leaflet-image-layer"),this._zoomAnimated&&hi(f,"leaflet-zoom-animated"),this.options.className&&hi(f,this.options.className),f.onselectstart=Kt,f.onmousemove=Kt,f.onloadeddata=S(this.fire,this,"load"),s){for(var w=f.getElementsByTagName("source"),E=[],N=0;N<w.length;N++)E.push(w[N].src);this._url=w.length>0?E:[f.src];return}Bi(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(f.style,"objectFit")&&(f.style.objectFit="fill"),f.autoplay=!!this.options.autoplay,f.loop=!!this.options.loop,f.muted=!!this.options.muted,f.playsInline=!!this.options.playsInline;for(var it=0;it<this._url.length;it++){var Pt=yi("source");Pt.src=this._url[it],f.appendChild(Pt)}}});function rl(s,f,w){return new il(s,f,w)}var xl=_o.extend({_initImage:function(){var s=this._image=this._url;hi(s,"leaflet-image-layer"),this._zoomAnimated&&hi(s,"leaflet-zoom-animated"),this.options.className&&hi(s,this.options.className),s.onselectstart=Kt,s.onmousemove=Kt}});function ha(s,f,w){return new xl(s,f,w)}var Jn=Zr.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(s,f){s&&(s instanceof wi||Bi(s))?(this._latlng=mi(s),Ae(this,f)):(Ae(this,s),this._source=f),this.options.content&&(this._content=this.options.content)},openOn:function(s){return s=arguments.length?s:this._source._map,s.hasLayer(this)||s.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(s){return this._map?this.close():(arguments.length?this._source=s:s=this._source,this._prepareOpen(),this.openOn(s._map)),this},onAdd:function(s){this._zoomAnimated=s._zoomAnimated,this._container||this._initLayout(),s._fadeAnimated&&dn(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),s._fadeAnimated&&dn(this._container,1),this.bringToFront(),this.options.interactive&&(hi(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(s){s._fadeAnimated?(dn(this._container,0),this._removeTimeout=setTimeout(S(Si,void 0,this._container),200)):Si(this._container),this.options.interactive&&(Ji(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(s){return this._latlng=mi(s),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(s){return this._content=s,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var s={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(s.zoomanim=this._animateZoom),s},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Ns(this._container),this},bringToBack:function(){return this._map&&js(this._container),this},_prepareOpen:function(s){var f=this._source;if(!f._map)return!1;if(f instanceof tn){f=null;var w=this._source._layers;for(var E in w)if(w[E]._map){f=w[E];break}if(!f)return!1;this._source=f}if(!s)if(f.getCenter)s=f.getCenter();else if(f.getLatLng)s=f.getLatLng();else if(f.getBounds)s=f.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(s),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var s=this._contentNode,f=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof f=="string")s.innerHTML=f;else{for(;s.hasChildNodes();)s.removeChild(s.firstChild);s.appendChild(f)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var s=this._map.latLngToLayerPoint(this._latlng),f=Ye(this.options.offset),w=this._getAnchor();this._zoomAnimated?er(this._container,s.add(w)):f=f.add(s).add(w);var E=this._containerBottom=-f.y,N=this._containerLeft=-Math.round(this._containerWidth/2)+f.x;this._container.style.bottom=E+"px",this._container.style.left=N+"px"}},_getAnchor:function(){return[0,0]}});vi.include({_initOverlay:function(s,f,w,E){var N=f;return N instanceof s||(N=new s(E).setContent(f)),w&&N.setLatLng(w),N}}),Zr.include({_initOverlay:function(s,f,w,E){var N=w;return N instanceof s?(Ae(N,E),N._source=this):(N=f&&!E?f:new s(E,this),N.setContent(w)),N}});var ca=Jn.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(s){return s=arguments.length?s:this._source._map,!s.hasLayer(this)&&s._popup&&s._popup.options.autoClose&&s.removeLayer(s._popup),s._popup=this,Jn.prototype.openOn.call(this,s)},onAdd:function(s){Jn.prototype.onAdd.call(this,s),s.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Br||this._source.on("preclick",ai))},onRemove:function(s){Jn.prototype.onRemove.call(this,s),s.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Br||this._source.off("preclick",ai))},getEvents:function(){var s=Jn.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(s.preclick=this.close),this.options.keepInView&&(s.moveend=this._adjustPan),s},_initLayout:function(){var s="leaflet-popup",f=this._container=yi("div",s+" "+(this.options.className||"")+" leaflet-zoom-animated"),w=this._wrapper=yi("div",s+"-content-wrapper",f);if(this._contentNode=yi("div",s+"-content",w),Qe(f),ir(this._contentNode),oi(f,"contextmenu",ai),this._tipContainer=yi("div",s+"-tip-container",f),this._tip=yi("div",s+"-tip",this._tipContainer),this.options.closeButton){var E=this._closeButton=yi("a",s+"-close-button",f);E.setAttribute("role","button"),E.setAttribute("aria-label","Close popup"),E.href="#close",E.innerHTML='<span aria-hidden="true">&#215;</span>',oi(E,"click",function(N){Ve(N),this.close()},this)}},_updateLayout:function(){var s=this._contentNode,f=s.style;f.width="",f.whiteSpace="nowrap";var w=s.offsetWidth;w=Math.min(w,this.options.maxWidth),w=Math.max(w,this.options.minWidth),f.width=w+1+"px",f.whiteSpace="",f.height="";var E=s.offsetHeight,N=this.options.maxHeight,it="leaflet-popup-scrolled";N&&E>N?(f.height=N+"px",hi(s,it)):Ji(s,it),this._containerWidth=this._container.offsetWidth},_animateZoom:function(s){var f=this._map._latLngToNewLayerPoint(this._latlng,s.zoom,s.center),w=this._getAnchor();er(this._container,f.add(w))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var s=this._map,f=parseInt(Fs(this._container,"marginBottom"),10)||0,w=this._container.offsetHeight+f,E=this._containerWidth,N=new ei(this._containerLeft,-w-this._containerBottom);N._add(os(this._container));var it=s.layerPointToContainerPoint(N),Pt=Ye(this.options.autoPanPadding),Xt=Ye(this.options.autoPanPaddingTopLeft||Pt),le=Ye(this.options.autoPanPaddingBottomRight||Pt),Ce=s.getSize(),ze=0,qe=0;it.x+E+le.x>Ce.x&&(ze=it.x+E-Ce.x+le.x),it.x-ze-Xt.x<0&&(ze=it.x-Xt.x),it.y+w+le.y>Ce.y&&(qe=it.y+w-Ce.y+le.y),it.y-qe-Xt.y<0&&(qe=it.y-Xt.y),(ze||qe)&&(this.options.keepInView&&(this._autopanning=!0),s.fire("autopanstart").panBy([ze,qe]))}},_getAnchor:function(){return Ye(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Ia=function(s,f){return new ca(s,f)};vi.mergeOptions({closePopupOnClick:!0}),vi.include({openPopup:function(s,f,w){return this._initOverlay(ca,s,f,w).openOn(this),this},closePopup:function(s){return s=arguments.length?s:this._popup,s&&s.close(),this}}),Zr.include({bindPopup:function(s,f){return this._popup=this._initOverlay(ca,this._popup,s,f),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(s){return this._popup&&(this instanceof tn||(this._popup._source=this),this._popup._prepareOpen(s||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(s){return this._popup&&this._popup.setContent(s),this},getPopup:function(){return this._popup},_openPopup:function(s){if(!(!this._popup||!this._map)){mn(s);var f=s.layer||s.target;if(this._popup._source===f&&!(f instanceof Br)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(s.latlng);return}this._popup._source=f,this.openPopup(s.latlng)}},_movePopup:function(s){this._popup.setLatLng(s.latlng)},_onKeyPress:function(s){s.originalEvent.keyCode===13&&this._openPopup(s)}});var go=Jn.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(s){Jn.prototype.onAdd.call(this,s),this.setOpacity(this.options.opacity),s.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(s){Jn.prototype.onRemove.call(this,s),s.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var s=Jn.prototype.getEvents.call(this);return this.options.permanent||(s.preclick=this.close),s},_initLayout:function(){var s="leaflet-tooltip",f=s+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=yi("div",f),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+rt(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(s){var f,w,E=this._map,N=this._container,it=E.latLngToContainerPoint(E.getCenter()),Pt=E.layerPointToContainerPoint(s),Xt=this.options.direction,le=N.offsetWidth,Ce=N.offsetHeight,ze=Ye(this.options.offset),qe=this._getAnchor();Xt==="top"?(f=le/2,w=Ce):Xt==="bottom"?(f=le/2,w=0):Xt==="center"?(f=le/2,w=Ce/2):Xt==="right"?(f=0,w=Ce/2):Xt==="left"?(f=le,w=Ce/2):Pt.x<it.x?(Xt="right",f=0,w=Ce/2):(Xt="left",f=le+(ze.x+qe.x)*2,w=Ce/2),s=s.subtract(Ye(f,w,!0)).add(ze).add(qe),Ji(N,"leaflet-tooltip-right"),Ji(N,"leaflet-tooltip-left"),Ji(N,"leaflet-tooltip-top"),Ji(N,"leaflet-tooltip-bottom"),hi(N,"leaflet-tooltip-"+Xt),er(N,s)},_updatePosition:function(){var s=this._map.latLngToLayerPoint(this._latlng);this._setPosition(s)},setOpacity:function(s){this.options.opacity=s,this._container&&dn(this._container,s)},_animateZoom:function(s){var f=this._map._latLngToNewLayerPoint(this._latlng,s.zoom,s.center);this._setPosition(f)},_getAnchor:function(){return Ye(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Xs=function(s,f){return new go(s,f)};vi.include({openTooltip:function(s,f,w){return this._initOverlay(go,s,f,w).openOn(this),this},closeTooltip:function(s){return s.close(),this}}),Zr.include({bindTooltip:function(s,f){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(go,this._tooltip,s,f),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(s){if(!(!s&&this._tooltipHandlersAdded)){var f=s?"off":"on",w={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?w.add=this._openTooltip:(w.mouseover=this._openTooltip,w.mouseout=this.closeTooltip,w.click=this._openTooltip,this._map?this._addFocusListeners():w.add=this._addFocusListeners),this._tooltip.options.sticky&&(w.mousemove=this._moveTooltip),this[f](w),this._tooltipHandlersAdded=!s}},openTooltip:function(s){return this._tooltip&&(this instanceof tn||(this._tooltip._source=this),this._tooltip._prepareOpen(s)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(s){return this._tooltip&&this._tooltip.setContent(s),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(s){var f=typeof s.getElement=="function"&&s.getElement();f&&(oi(f,"focus",function(){this._tooltip._source=s,this.openTooltip()},this),oi(f,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(s){var f=typeof s.getElement=="function"&&s.getElement();f&&f.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(s){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var f=this;this._map.once("moveend",function(){f._openOnceFlag=!1,f._openTooltip(s)});return}this._tooltip._source=s.layer||s.target,this.openTooltip(this._tooltip.options.sticky?s.latlng:void 0)}},_moveTooltip:function(s){var f=s.latlng,w,E;this._tooltip.options.sticky&&s.originalEvent&&(w=this._map.mouseEventToContainerPoint(s.originalEvent),E=this._map.containerPointToLayerPoint(w),f=this._map.layerPointToLatLng(E)),this._tooltip.setLatLng(f)}});var Ba=Cs.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(s){var f=s&&s.tagName==="DIV"?s:document.createElement("div"),w=this.options;if(w.html instanceof Element?(ea(f),f.appendChild(w.html)):f.innerHTML=w.html!==!1?w.html:"",w.bgPos){var E=Ye(w.bgPos);f.style.backgroundPosition=-E.x+"px "+-E.y+"px"}return this._setIconStyles(f,"icon"),f},createShadow:function(){return null}});function yo(s){return new Ba(s)}Cs.Default=Vo;var Ls=Zr.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Se.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(s){Ae(this,s)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(s){s._addZoomLimit(this)},onRemove:function(s){this._removeAllTiles(),Si(this._container),s._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Ns(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(js(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(s){return this.options.opacity=s,this._updateOpacity(),this},setZIndex:function(s){return this.options.zIndex=s,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var s=this._clampZoom(this._map.getZoom());s!==this._tileZoom&&(this._tileZoom=s,this._updateLevels()),this._update()}return this},getEvents:function(){var s={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=Qt(this._onMoveEnd,this.options.updateInterval,this)),s.move=this._onMove),this._zoomAnimated&&(s.zoomanim=this._animateZoom),s},createTile:function(){return document.createElement("div")},getTileSize:function(){var s=this.options.tileSize;return s instanceof ei?s:new ei(s,s)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(s){for(var f=this.getPane().children,w=-s(-1/0,1/0),E=0,N=f.length,it;E<N;E++)it=f[E].style.zIndex,f[E]!==this._container&&it&&(w=s(w,+it));isFinite(w)&&(this.options.zIndex=w+s(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Se.ielt9){dn(this._container,this.options.opacity);var s=+new Date,f=!1,w=!1;for(var E in this._tiles){var N=this._tiles[E];if(!(!N.current||!N.loaded)){var it=Math.min(1,(s-N.loaded)/200);dn(N.el,it),it<1?f=!0:(N.active?w=!0:this._onOpaqueTile(N),N.active=!0)}}w&&!this._noPrune&&this._pruneTiles(),f&&(Ki(this._fadeFrame),this._fadeFrame=dr(this._updateOpacity,this))}},_onOpaqueTile:Kt,_initContainer:function(){this._container||(this._container=yi("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var s=this._tileZoom,f=this.options.maxZoom;if(s!==void 0){for(var w in this._levels)w=Number(w),this._levels[w].el.children.length||w===s?(this._levels[w].el.style.zIndex=f-Math.abs(s-w),this._onUpdateLevel(w)):(Si(this._levels[w].el),this._removeTilesAtZoom(w),this._onRemoveLevel(w),delete this._levels[w]);var E=this._levels[s],N=this._map;return E||(E=this._levels[s]={},E.el=yi("div","leaflet-tile-container leaflet-zoom-animated",this._container),E.el.style.zIndex=f,E.origin=N.project(N.unproject(N.getPixelOrigin()),s).round(),E.zoom=s,this._setZoomTransform(E,N.getCenter(),N.getZoom()),Kt(E.el.offsetWidth),this._onCreateLevel(E)),this._level=E,E}},_onUpdateLevel:Kt,_onRemoveLevel:Kt,_onCreateLevel:Kt,_pruneTiles:function(){if(this._map){var s,f,w=this._map.getZoom();if(w>this.options.maxZoom||w<this.options.minZoom){this._removeAllTiles();return}for(s in this._tiles)f=this._tiles[s],f.retain=f.current;for(s in this._tiles)if(f=this._tiles[s],f.current&&!f.active){var E=f.coords;this._retainParent(E.x,E.y,E.z,E.z-5)||this._retainChildren(E.x,E.y,E.z,E.z+2)}for(s in this._tiles)this._tiles[s].retain||this._removeTile(s)}},_removeTilesAtZoom:function(s){for(var f in this._tiles)this._tiles[f].coords.z===s&&this._removeTile(f)},_removeAllTiles:function(){for(var s in this._tiles)this._removeTile(s)},_invalidateAll:function(){for(var s in this._levels)Si(this._levels[s].el),this._onRemoveLevel(Number(s)),delete this._levels[s];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(s,f,w,E){var N=Math.floor(s/2),it=Math.floor(f/2),Pt=w-1,Xt=new ei(+N,+it);Xt.z=+Pt;var le=this._tileCoordsToKey(Xt),Ce=this._tiles[le];return Ce&&Ce.active?(Ce.retain=!0,!0):(Ce&&Ce.loaded&&(Ce.retain=!0),Pt>E?this._retainParent(N,it,Pt,E):!1)},_retainChildren:function(s,f,w,E){for(var N=2*s;N<2*s+2;N++)for(var it=2*f;it<2*f+2;it++){var Pt=new ei(N,it);Pt.z=w+1;var Xt=this._tileCoordsToKey(Pt),le=this._tiles[Xt];if(le&&le.active){le.retain=!0;continue}else le&&le.loaded&&(le.retain=!0);w+1<E&&this._retainChildren(N,it,w+1,E)}},_resetView:function(s){var f=s&&(s.pinch||s.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),f,f)},_animateZoom:function(s){this._setView(s.center,s.zoom,!0,s.noUpdate)},_clampZoom:function(s){var f=this.options;return f.minNativeZoom!==void 0&&s<f.minNativeZoom?f.minNativeZoom:f.maxNativeZoom!==void 0&&f.maxNativeZoom<s?f.maxNativeZoom:s},_setView:function(s,f,w,E){var N=Math.round(f);this.options.maxZoom!==void 0&&N>this.options.maxZoom||this.options.minZoom!==void 0&&N<this.options.minZoom?N=void 0:N=this._clampZoom(N);var it=this.options.updateWhenZooming&&N!==this._tileZoom;(!E||it)&&(this._tileZoom=N,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),N!==void 0&&this._update(s),w||this._pruneTiles(),this._noPrune=!!w),this._setZoomTransforms(s,f)},_setZoomTransforms:function(s,f){for(var w in this._levels)this._setZoomTransform(this._levels[w],s,f)},_setZoomTransform:function(s,f,w){var E=this._map.getZoomScale(w,s.zoom),N=s.origin.multiplyBy(E).subtract(this._map._getNewPixelOrigin(f,w)).round();Se.any3d?xs(s.el,N,E):er(s.el,N)},_resetGrid:function(){var s=this._map,f=s.options.crs,w=this._tileSize=this.getTileSize(),E=this._tileZoom,N=this._map.getPixelWorldBounds(this._tileZoom);N&&(this._globalTileRange=this._pxBoundsToTileRange(N)),this._wrapX=f.wrapLng&&!this.options.noWrap&&[Math.floor(s.project([0,f.wrapLng[0]],E).x/w.x),Math.ceil(s.project([0,f.wrapLng[1]],E).x/w.y)],this._wrapY=f.wrapLat&&!this.options.noWrap&&[Math.floor(s.project([f.wrapLat[0],0],E).y/w.x),Math.ceil(s.project([f.wrapLat[1],0],E).y/w.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(s){var f=this._map,w=f._animatingZoom?Math.max(f._animateToZoom,f.getZoom()):f.getZoom(),E=f.getZoomScale(w,this._tileZoom),N=f.project(s,this._tileZoom).floor(),it=f.getSize().divideBy(E*2);return new bi(N.subtract(it),N.add(it))},_update:function(s){var f=this._map;if(f){var w=this._clampZoom(f.getZoom());if(s===void 0&&(s=f.getCenter()),this._tileZoom!==void 0){var E=this._getTiledPixelBounds(s),N=this._pxBoundsToTileRange(E),it=N.getCenter(),Pt=[],Xt=this.options.keepBuffer,le=new bi(N.getBottomLeft().subtract([Xt,-Xt]),N.getTopRight().add([Xt,-Xt]));if(!(isFinite(N.min.x)&&isFinite(N.min.y)&&isFinite(N.max.x)&&isFinite(N.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ce in this._tiles){var ze=this._tiles[Ce].coords;(ze.z!==this._tileZoom||!le.contains(new ei(ze.x,ze.y)))&&(this._tiles[Ce].current=!1)}if(Math.abs(w-this._tileZoom)>1){this._setView(s,w);return}for(var qe=N.min.y;qe<=N.max.y;qe++)for(var fi=N.min.x;fi<=N.max.x;fi++){var Pr=new ei(fi,qe);if(Pr.z=this._tileZoom,!!this._isValidTile(Pr)){var rr=this._tiles[this._tileCoordsToKey(Pr)];rr?rr.current=!0:Pt.push(Pr)}}if(Pt.sort(function(Vr,Co){return Vr.distanceTo(it)-Co.distanceTo(it)}),Pt.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var rn=document.createDocumentFragment();for(fi=0;fi<Pt.length;fi++)this._addTile(Pt[fi],rn);this._level.el.appendChild(rn)}}}},_isValidTile:function(s){var f=this._map.options.crs;if(!f.infinite){var w=this._globalTileRange;if(!f.wrapLng&&(s.x<w.min.x||s.x>w.max.x)||!f.wrapLat&&(s.y<w.min.y||s.y>w.max.y))return!1}if(!this.options.bounds)return!0;var E=this._tileCoordsToBounds(s);return Ii(this.options.bounds).overlaps(E)},_keyToBounds:function(s){return this._tileCoordsToBounds(this._keyToTileCoords(s))},_tileCoordsToNwSe:function(s){var f=this._map,w=this.getTileSize(),E=s.scaleBy(w),N=E.add(w),it=f.unproject(E,s.z),Pt=f.unproject(N,s.z);return[it,Pt]},_tileCoordsToBounds:function(s){var f=this._tileCoordsToNwSe(s),w=new $i(f[0],f[1]);return this.options.noWrap||(w=this._map.wrapLatLngBounds(w)),w},_tileCoordsToKey:function(s){return s.x+":"+s.y+":"+s.z},_keyToTileCoords:function(s){var f=s.split(":"),w=new ei(+f[0],+f[1]);return w.z=+f[2],w},_removeTile:function(s){var f=this._tiles[s];f&&(Si(f.el),delete this._tiles[s],this.fire("tileunload",{tile:f.el,coords:this._keyToTileCoords(s)}))},_initTile:function(s){hi(s,"leaflet-tile");var f=this.getTileSize();s.style.width=f.x+"px",s.style.height=f.y+"px",s.onselectstart=Kt,s.onmousemove=Kt,Se.ielt9&&this.options.opacity<1&&dn(s,this.options.opacity)},_addTile:function(s,f){var w=this._getTilePos(s),E=this._tileCoordsToKey(s),N=this.createTile(this._wrapCoords(s),S(this._tileReady,this,s));this._initTile(N),this.createTile.length<2&&dr(S(this._tileReady,this,s,null,N)),er(N,w),this._tiles[E]={el:N,coords:s,current:!0},f.appendChild(N),this.fire("tileloadstart",{tile:N,coords:s})},_tileReady:function(s,f,w){f&&this.fire("tileerror",{error:f,tile:w,coords:s});var E=this._tileCoordsToKey(s);w=this._tiles[E],w&&(w.loaded=+new Date,this._map._fadeAnimated?(dn(w.el,0),Ki(this._fadeFrame),this._fadeFrame=dr(this._updateOpacity,this)):(w.active=!0,this._pruneTiles()),f||(hi(w.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:w.el,coords:s})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Se.ielt9||!this._map._fadeAnimated?dr(this._pruneTiles,this):setTimeout(S(this._pruneTiles,this),250)))},_getTilePos:function(s){return s.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(s){var f=new ei(this._wrapX?se(s.x,this._wrapX):s.x,this._wrapY?se(s.y,this._wrapY):s.y);return f.z=s.z,f},_pxBoundsToTileRange:function(s){var f=this.getTileSize();return new bi(s.min.unscaleBy(f).floor(),s.max.unscaleBy(f).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var s in this._tiles)if(!this._tiles[s].loaded)return!1;return!0}});function $o(s){return new Ls(s)}var Tr=Ls.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(s,f){this._url=s,f=Ae(this,f),f.detectRetina&&Se.retina&&f.maxZoom>0?(f.tileSize=Math.floor(f.tileSize/2),f.zoomReverse?(f.zoomOffset--,f.minZoom=Math.min(f.maxZoom,f.minZoom+1)):(f.zoomOffset++,f.maxZoom=Math.max(f.minZoom,f.maxZoom-1)),f.minZoom=Math.max(0,f.minZoom)):f.zoomReverse?f.minZoom=Math.min(f.maxZoom,f.minZoom):f.maxZoom=Math.max(f.minZoom,f.maxZoom),typeof f.subdomains=="string"&&(f.subdomains=f.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(s,f){return this._url===s&&f===void 0&&(f=!0),this._url=s,f||this.redraw(),this},createTile:function(s,f){var w=document.createElement("img");return oi(w,"load",S(this._tileOnLoad,this,f,w)),oi(w,"error",S(this._tileOnError,this,f,w)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(w.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(w.referrerPolicy=this.options.referrerPolicy),w.alt="",w.src=this.getTileUrl(s),w},getTileUrl:function(s){var f={r:Se.retina?"@2x":"",s:this._getSubdomain(s),x:s.x,y:s.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var w=this._globalTileRange.max.y-s.y;this.options.tms&&(f.y=w),f["-y"]=w}return gi(this._url,Vt(f,this.options))},_tileOnLoad:function(s,f){Se.ielt9?setTimeout(S(s,this,null,f),0):s(null,f)},_tileOnError:function(s,f,w){var E=this.options.errorTileUrl;E&&f.getAttribute("src")!==E&&(f.src=E),s(w,f)},_onTileRemove:function(s){s.tile.onload=null},_getZoomForUrl:function(){var s=this._tileZoom,f=this.options.maxZoom,w=this.options.zoomReverse,E=this.options.zoomOffset;return w&&(s=f-s),s+E},_getSubdomain:function(s){var f=Math.abs(s.x+s.y)%this.options.subdomains.length;return this.options.subdomains[f]},_abortLoading:function(){var s,f;for(s in this._tiles)if(this._tiles[s].coords.z!==this._tileZoom&&(f=this._tiles[s].el,f.onload=Kt,f.onerror=Kt,!f.complete)){f.src=Ei;var w=this._tiles[s].coords;Si(f),delete this._tiles[s],this.fire("tileabort",{tile:f,coords:w})}},_removeTile:function(s){var f=this._tiles[s];if(f)return f.el.setAttribute("src",Ei),Ls.prototype._removeTile.call(this,s)},_tileReady:function(s,f,w){if(!(!this._map||w&&w.getAttribute("src")===Ei))return Ls.prototype._tileReady.call(this,s,f,w)}});function nl(s,f){return new Tr(s,f)}var sl=Tr.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(s,f){this._url=s;var w=Vt({},this.defaultWmsParams);for(var E in f)E in this.options||(w[E]=f[E]);f=Ae(this,f);var N=f.detectRetina&&Se.retina?2:1,it=this.getTileSize();w.width=it.x*N,w.height=it.y*N,this.wmsParams=w},onAdd:function(s){this._crs=this.options.crs||s.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var f=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[f]=this._crs.code,Tr.prototype.onAdd.call(this,s)},getTileUrl:function(s){var f=this._tileCoordsToNwSe(s),w=this._crs,E=ti(w.project(f[0]),w.project(f[1])),N=E.min,it=E.max,Pt=(this._wmsVersion>=1.3&&this._crs===In?[N.y,N.x,it.y,it.x]:[N.x,N.y,it.x,it.y]).join(","),Xt=Tr.prototype.getTileUrl.call(this,s);return Xt+pi(this.wmsParams,Xt,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Pt},setParams:function(s,f){return Vt(this.wmsParams,s),f||this.redraw(),this}});function ol(s,f){return new sl(s,f)}Tr.WMS=sl,nl.wms=ol;var Dr=Zr.extend({options:{padding:.1},initialize:function(s){Ae(this,s),rt(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),hi(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var s={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(s.zoomanim=this._onAnimZoom),s},_onAnimZoom:function(s){this._updateTransform(s.center,s.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(s,f){var w=this._map.getZoomScale(f,this._zoom),E=this._map.getSize().multiplyBy(.5+this.options.padding),N=this._map.project(this._center,f),it=E.multiplyBy(-w).add(N).subtract(this._map._getNewPixelOrigin(s,f));Se.any3d?xs(this._container,it,w):er(this._container,it)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var s in this._layers)this._layers[s]._reset()},_onZoomEnd:function(){for(var s in this._layers)this._layers[s]._project()},_updatePaths:function(){for(var s in this._layers)this._layers[s]._update()},_update:function(){var s=this.options.padding,f=this._map.getSize(),w=this._map.containerPointToLayerPoint(f.multiplyBy(-s)).round();this._bounds=new bi(w,w.add(f.multiplyBy(1+s*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),vo=Dr.extend({options:{tolerance:0},getEvents:function(){var s=Dr.prototype.getEvents.call(this);return s.viewprereset=this._onViewPreReset,s},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Dr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var s=this._container=document.createElement("canvas");oi(s,"mousemove",this._onMouseMove,this),oi(s,"click dblclick mousedown mouseup contextmenu",this._onClick,this),oi(s,"mouseout",this._handleMouseOut,this),s._leaflet_disable_events=!0,this._ctx=s.getContext("2d")},_destroyContainer:function(){Ki(this._redrawRequest),delete this._ctx,Si(this._container),ii(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var s;this._redrawBounds=null;for(var f in this._layers)s=this._layers[f],s._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Dr.prototype._update.call(this);var s=this._bounds,f=this._container,w=s.getSize(),E=Se.retina?2:1;er(f,s.min),f.width=E*w.x,f.height=E*w.y,f.style.width=w.x+"px",f.style.height=w.y+"px",Se.retina&&this._ctx.scale(2,2),this._ctx.translate(-s.min.x,-s.min.y),this.fire("update")}},_reset:function(){Dr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(s){this._updateDashArray(s),this._layers[rt(s)]=s;var f=s._order={layer:s,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=f),this._drawLast=f,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(s){this._requestRedraw(s)},_removePath:function(s){var f=s._order,w=f.next,E=f.prev;w?w.prev=E:this._drawLast=E,E?E.next=w:this._drawFirst=w,delete s._order,delete this._layers[rt(s)],this._requestRedraw(s)},_updatePath:function(s){this._extendRedrawBounds(s),s._project(),s._update(),this._requestRedraw(s)},_updateStyle:function(s){this._updateDashArray(s),this._requestRedraw(s)},_updateDashArray:function(s){if(typeof s.options.dashArray=="string"){var f=s.options.dashArray.split(/[, ]+/),w=[],E,N;for(N=0;N<f.length;N++){if(E=Number(f[N]),isNaN(E))return;w.push(E)}s.options._dashArray=w}else s.options._dashArray=s.options.dashArray},_requestRedraw:function(s){this._map&&(this._extendRedrawBounds(s),this._redrawRequest=this._redrawRequest||dr(this._redraw,this))},_extendRedrawBounds:function(s){if(s._pxBounds){var f=(s.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new bi,this._redrawBounds.extend(s._pxBounds.min.subtract([f,f])),this._redrawBounds.extend(s._pxBounds.max.add([f,f]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var s=this._redrawBounds;if(s){var f=s.getSize();this._ctx.clearRect(s.min.x,s.min.y,f.x,f.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var s,f=this._redrawBounds;if(this._ctx.save(),f){var w=f.getSize();this._ctx.beginPath(),this._ctx.rect(f.min.x,f.min.y,w.x,w.y),this._ctx.clip()}this._drawing=!0;for(var E=this._drawFirst;E;E=E.next)s=E.layer,(!f||s._pxBounds&&s._pxBounds.intersects(f))&&s._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(s,f){if(this._drawing){var w,E,N,it,Pt=s._parts,Xt=Pt.length,le=this._ctx;if(Xt){for(le.beginPath(),w=0;w<Xt;w++){for(E=0,N=Pt[w].length;E<N;E++)it=Pt[w][E],le[E?"lineTo":"moveTo"](it.x,it.y);f&&le.closePath()}this._fillStroke(le,s)}}},_updateCircle:function(s){if(!(!this._drawing||s._empty())){var f=s._point,w=this._ctx,E=Math.max(Math.round(s._radius),1),N=(Math.max(Math.round(s._radiusY),1)||E)/E;N!==1&&(w.save(),w.scale(1,N)),w.beginPath(),w.arc(f.x,f.y/N,E,0,Math.PI*2,!1),N!==1&&w.restore(),this._fillStroke(w,s)}},_fillStroke:function(s,f){var w=f.options;w.fill&&(s.globalAlpha=w.fillOpacity,s.fillStyle=w.fillColor||w.color,s.fill(w.fillRule||"evenodd")),w.stroke&&w.weight!==0&&(s.setLineDash&&s.setLineDash(f.options&&f.options._dashArray||[]),s.globalAlpha=w.opacity,s.lineWidth=w.weight,s.strokeStyle=w.color,s.lineCap=w.lineCap,s.lineJoin=w.lineJoin,s.stroke())},_onClick:function(s){for(var f=this._map.mouseEventToLayerPoint(s),w,E,N=this._drawFirst;N;N=N.next)w=N.layer,w.options.interactive&&w._containsPoint(f)&&(!(s.type==="click"||s.type==="preclick")||!this._map._draggableMoved(w))&&(E=w);this._fireEvent(E?[E]:!1,s)},_onMouseMove:function(s){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var f=this._map.mouseEventToLayerPoint(s);this._handleMouseHover(s,f)}},_handleMouseOut:function(s){var f=this._hoveredLayer;f&&(Ji(this._container,"leaflet-interactive"),this._fireEvent([f],s,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(s,f){if(!this._mouseHoverThrottled){for(var w,E,N=this._drawFirst;N;N=N.next)w=N.layer,w.options.interactive&&w._containsPoint(f)&&(E=w);E!==this._hoveredLayer&&(this._handleMouseOut(s),E&&(hi(this._container,"leaflet-interactive"),this._fireEvent([E],s,"mouseover"),this._hoveredLayer=E)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,s),this._mouseHoverThrottled=!0,setTimeout(S(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(s,f,w){this._map._fireDOMEvent(f,w||f.type,s)},_bringToFront:function(s){var f=s._order;if(f){var w=f.next,E=f.prev;if(w)w.prev=E;else return;E?E.next=w:w&&(this._drawFirst=w),f.prev=this._drawLast,this._drawLast.next=f,f.next=null,this._drawLast=f,this._requestRedraw(s)}},_bringToBack:function(s){var f=s._order;if(f){var w=f.next,E=f.prev;if(E)E.next=w;else return;w?w.prev=E:E&&(this._drawLast=E),f.prev=null,f.next=this._drawFirst,this._drawFirst.prev=f,this._drawFirst=f,this._requestRedraw(s)}}});function pa(s){return Se.canvas?new vo(s):null}var Ts=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(s){return document.createElement("<lvml:"+s+' class="lvml">')}}catch{}return function(s){return document.createElement("<"+s+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),xo={_initContainer:function(){this._container=yi("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Dr.prototype._update.call(this),this.fire("update"))},_initPath:function(s){var f=s._container=Ts("shape");hi(f,"leaflet-vml-shape "+(this.options.className||"")),f.coordsize="1 1",s._path=Ts("path"),f.appendChild(s._path),this._updateStyle(s),this._layers[rt(s)]=s},_addPath:function(s){var f=s._container;this._container.appendChild(f),s.options.interactive&&s.addInteractiveTarget(f)},_removePath:function(s){var f=s._container;Si(f),s.removeInteractiveTarget(f),delete this._layers[rt(s)]},_updateStyle:function(s){var f=s._stroke,w=s._fill,E=s.options,N=s._container;N.stroked=!!E.stroke,N.filled=!!E.fill,E.stroke?(f||(f=s._stroke=Ts("stroke")),N.appendChild(f),f.weight=E.weight+"px",f.color=E.color,f.opacity=E.opacity,E.dashArray?f.dashStyle=Bi(E.dashArray)?E.dashArray.join(" "):E.dashArray.replace(/( *, *)/g," "):f.dashStyle="",f.endcap=E.lineCap.replace("butt","flat"),f.joinstyle=E.lineJoin):f&&(N.removeChild(f),s._stroke=null),E.fill?(w||(w=s._fill=Ts("fill")),N.appendChild(w),w.color=E.fillColor||E.color,w.opacity=E.fillOpacity):w&&(N.removeChild(w),s._fill=null)},_updateCircle:function(s){var f=s._point.round(),w=Math.round(s._radius),E=Math.round(s._radiusY||w);this._setPath(s,s._empty()?"M0 0":"AL "+f.x+","+f.y+" "+w+","+E+" 0,"+65535*360)},_setPath:function(s,f){s._path.v=f},_bringToFront:function(s){Ns(s._container)},_bringToBack:function(s){js(s._container)}},bo=Se.vml?Ts:cn,cs=Dr.extend({_initContainer:function(){this._container=bo("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=bo("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Si(this._container),ii(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Dr.prototype._update.call(this);var s=this._bounds,f=s.getSize(),w=this._container;(!this._svgSize||!this._svgSize.equals(f))&&(this._svgSize=f,w.setAttribute("width",f.x),w.setAttribute("height",f.y)),er(w,s.min),w.setAttribute("viewBox",[s.min.x,s.min.y,f.x,f.y].join(" ")),this.fire("update")}},_initPath:function(s){var f=s._path=bo("path");s.options.className&&hi(f,s.options.className),s.options.interactive&&hi(f,"leaflet-interactive"),this._updateStyle(s),this._layers[rt(s)]=s},_addPath:function(s){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(s._path),s.addInteractiveTarget(s._path)},_removePath:function(s){Si(s._path),s.removeInteractiveTarget(s._path),delete this._layers[rt(s)]},_updatePath:function(s){s._project(),s._update()},_updateStyle:function(s){var f=s._path,w=s.options;f&&(w.stroke?(f.setAttribute("stroke",w.color),f.setAttribute("stroke-opacity",w.opacity),f.setAttribute("stroke-width",w.weight),f.setAttribute("stroke-linecap",w.lineCap),f.setAttribute("stroke-linejoin",w.lineJoin),w.dashArray?f.setAttribute("stroke-dasharray",w.dashArray):f.removeAttribute("stroke-dasharray"),w.dashOffset?f.setAttribute("stroke-dashoffset",w.dashOffset):f.removeAttribute("stroke-dashoffset")):f.setAttribute("stroke","none"),w.fill?(f.setAttribute("fill",w.fillColor||w.color),f.setAttribute("fill-opacity",w.fillOpacity),f.setAttribute("fill-rule",w.fillRule||"evenodd")):f.setAttribute("fill","none"))},_updatePoly:function(s,f){this._setPath(s,zs(s._parts,f))},_updateCircle:function(s){var f=s._point,w=Math.max(Math.round(s._radius),1),E=Math.max(Math.round(s._radiusY),1)||w,N="a"+w+","+E+" 0 1,0 ",it=s._empty()?"M0 0":"M"+(f.x-w)+","+f.y+N+w*2+",0 "+N+-w*2+",0 ";this._setPath(s,it)},_setPath:function(s,f){s._path.setAttribute("d",f)},_bringToFront:function(s){Ns(s._path)},_bringToBack:function(s){js(s._path)}});Se.vml&&cs.include(xo);function wo(s){return Se.svg||Se.vml?new cs(s):null}vi.include({getRenderer:function(s){var f=s.options.renderer||this._getPaneRenderer(s.options.pane)||this.options.renderer||this._renderer;return f||(f=this._renderer=this._createRenderer()),this.hasLayer(f)||this.addLayer(f),f},_getPaneRenderer:function(s){if(s==="overlayPane"||s===void 0)return!1;var f=this._paneRenderers[s];return f===void 0&&(f=this._createRenderer({pane:s}),this._paneRenderers[s]=f),f},_createRenderer:function(s){return this.options.preferCanvas&&pa(s)||wo(s)}});var qo=vn.extend({initialize:function(s,f){vn.prototype.initialize.call(this,this._boundsToLatLngs(s),f)},setBounds:function(s){return this.setLatLngs(this._boundsToLatLngs(s))},_boundsToLatLngs:function(s){return s=Ii(s),[s.getSouthWest(),s.getNorthWest(),s.getNorthEast(),s.getSouthEast()]}});function en(s,f){return new qo(s,f)}cs.create=bo,cs.pointsToPath=zs,hs.geometryToLayer=ho,hs.coordsToLatLng=Ci,hs.coordsToLatLngs=co,hs.latLngToCoords=Yn,hs.latLngsToCoords=po,hs.getFeature=Ks,hs.asFeature=fo,vi.mergeOptions({boxZoom:!0});var Ke=Mr.extend({initialize:function(s){this._map=s,this._container=s._container,this._pane=s._panes.overlayPane,this._resetStateTimeout=0,s.on("unload",this._destroy,this)},addHooks:function(){oi(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ii(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Si(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(s){if(!s.shiftKey||s.which!==1&&s.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Vs(),qn(),this._startPoint=this._map.mouseEventToContainerPoint(s),oi(document,{contextmenu:mn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(s){this._moved||(this._moved=!0,this._box=yi("div","leaflet-zoom-box",this._container),hi(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(s);var f=new bi(this._point,this._startPoint),w=f.getSize();er(this._box,f.min),this._box.style.width=w.x+"px",this._box.style.height=w.y+"px"},_finish:function(){this._moved&&(Si(this._box),Ji(this._container,"leaflet-crosshair")),Xr(),as(),ii(document,{contextmenu:mn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(s){if(!(s.which!==1&&s.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(S(this._resetState,this),0);var f=new $i(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(f).fire("boxzoomend",{boxZoomBounds:f})}},_onKeyDown:function(s){s.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});vi.addInitHook("addHandler","boxZoom",Ke),vi.mergeOptions({doubleClickZoom:!0});var Ps=Mr.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(s){var f=this._map,w=f.getZoom(),E=f.options.zoomDelta,N=s.originalEvent.shiftKey?w-E:w+E;f.options.doubleClickZoom==="center"?f.setZoom(N):f.setZoomAround(s.containerPoint,N)}});vi.addInitHook("addHandler","doubleClickZoom",Ps),vi.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var xn=Mr.extend({addHooks:function(){if(!this._draggable){var s=this._map;this._draggable=new us(s._mapPane,s._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),s.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),s.on("zoomend",this._onZoomEnd,this),s.whenReady(this._onZoomEnd,this))}hi(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Ji(this._map._container,"leaflet-grab"),Ji(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var s=this._map;if(s._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var f=Ii(this._map.options.maxBounds);this._offsetLimit=ti(this._map.latLngToContainerPoint(f.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(f.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;s.fire("movestart").fire("dragstart"),s.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(s){if(this._map.options.inertia){var f=this._lastTime=+new Date,w=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(w),this._times.push(f),this._prunePositions(f)}this._map.fire("move",s).fire("drag",s)},_prunePositions:function(s){for(;this._positions.length>1&&s-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var s=this._map.getSize().divideBy(2),f=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=f.subtract(s).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(s,f){return s-(s-f)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var s=this._draggable._newPos.subtract(this._draggable._startPos),f=this._offsetLimit;s.x<f.min.x&&(s.x=this._viscousLimit(s.x,f.min.x)),s.y<f.min.y&&(s.y=this._viscousLimit(s.y,f.min.y)),s.x>f.max.x&&(s.x=this._viscousLimit(s.x,f.max.x)),s.y>f.max.y&&(s.y=this._viscousLimit(s.y,f.max.y)),this._draggable._newPos=this._draggable._startPos.add(s)}},_onPreDragWrap:function(){var s=this._worldWidth,f=Math.round(s/2),w=this._initialWorldOffset,E=this._draggable._newPos.x,N=(E-f+w)%s+f-w,it=(E+f+w)%s-f-w,Pt=Math.abs(N+w)<Math.abs(it+w)?N:it;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Pt},_onDragEnd:function(s){var f=this._map,w=f.options,E=!w.inertia||s.noInertia||this._times.length<2;if(f.fire("dragend",s),E)f.fire("moveend");else{this._prunePositions(+new Date);var N=this._lastPos.subtract(this._positions[0]),it=(this._lastTime-this._times[0])/1e3,Pt=w.easeLinearity,Xt=N.multiplyBy(Pt/it),le=Xt.distanceTo([0,0]),Ce=Math.min(w.inertiaMaxSpeed,le),ze=Xt.multiplyBy(Ce/le),qe=Ce/(w.inertiaDeceleration*Pt),fi=ze.multiplyBy(-qe/2).round();!fi.x&&!fi.y?f.fire("moveend"):(fi=f._limitOffset(fi,f.options.maxBounds),dr(function(){f.panBy(fi,{duration:qe,easeLinearity:Pt,noMoveStart:!0,animate:!0})}))}}});vi.addInitHook("addHandler","dragging",xn),vi.mergeOptions({keyboard:!0,keyboardPanDelta:80});var ri=Mr.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(s){this._map=s,this._setPanDelta(s.options.keyboardPanDelta),this._setZoomDelta(s.options.zoomDelta)},addHooks:function(){var s=this._map._container;s.tabIndex<=0&&(s.tabIndex="0"),oi(s,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),ii(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var s=document.body,f=document.documentElement,w=s.scrollTop||f.scrollTop,E=s.scrollLeft||f.scrollLeft;this._map._container.focus(),window.scrollTo(E,w)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(s){var f=this._panKeys={},w=this.keyCodes,E,N;for(E=0,N=w.left.length;E<N;E++)f[w.left[E]]=[-1*s,0];for(E=0,N=w.right.length;E<N;E++)f[w.right[E]]=[s,0];for(E=0,N=w.down.length;E<N;E++)f[w.down[E]]=[0,s];for(E=0,N=w.up.length;E<N;E++)f[w.up[E]]=[0,-1*s]},_setZoomDelta:function(s){var f=this._zoomKeys={},w=this.keyCodes,E,N;for(E=0,N=w.zoomIn.length;E<N;E++)f[w.zoomIn[E]]=s;for(E=0,N=w.zoomOut.length;E<N;E++)f[w.zoomOut[E]]=-s},_addHooks:function(){oi(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){ii(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(s){if(!(s.altKey||s.ctrlKey||s.metaKey)){var f=s.keyCode,w=this._map,E;if(f in this._panKeys){if(!w._panAnim||!w._panAnim._inProgress)if(E=this._panKeys[f],s.shiftKey&&(E=Ye(E).multiplyBy(3)),w.options.maxBounds&&(E=w._limitOffset(Ye(E),w.options.maxBounds)),w.options.worldCopyJump){var N=w.wrapLatLng(w.unproject(w.project(w.getCenter()).add(E)));w.panTo(N)}else w.panBy(E)}else if(f in this._zoomKeys)w.setZoom(w.getZoom()+(s.shiftKey?3:1)*this._zoomKeys[f]);else if(f===27&&w._popup&&w._popup.options.closeOnEscapeKey)w.closePopup();else return;mn(s)}}});vi.addInitHook("addHandler","keyboard",ri),vi.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Ys=Mr.extend({addHooks:function(){oi(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){ii(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(s){var f=oo(s),w=this._map.options.wheelDebounceTime;this._delta+=f,this._lastMousePos=this._map.mouseEventToContainerPoint(s),this._startTime||(this._startTime=+new Date);var E=Math.max(w-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(S(this._performZoom,this),E),mn(s)},_performZoom:function(){var s=this._map,f=s.getZoom(),w=this._map.options.zoomSnap||0;s._stop();var E=this._delta/(this._map.options.wheelPxPerZoomLevel*4),N=4*Math.log(2/(1+Math.exp(-Math.abs(E))))/Math.LN2,it=w?Math.ceil(N/w)*w:N,Pt=s._limitZoom(f+(this._delta>0?it:-it))-f;this._delta=0,this._startTime=null,Pt&&(s.options.scrollWheelZoom==="center"?s.setZoom(f+Pt):s.setZoomAround(this._lastMousePos,f+Pt))}});vi.addInitHook("addHandler","scrollWheelZoom",Ys);var al=600;vi.mergeOptions({tapHold:Se.touchNative&&Se.safari&&Se.mobile,tapTolerance:15});var Ss=Mr.extend({addHooks:function(){oi(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ii(this._map._container,"touchstart",this._onDown,this)},_onDown:function(s){if(clearTimeout(this._holdTimeout),s.touches.length===1){var f=s.touches[0];this._startPos=this._newPos=new ei(f.clientX,f.clientY),this._holdTimeout=setTimeout(S(function(){this._cancel(),this._isTapValid()&&(oi(document,"touchend",Ve),oi(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",f))},this),al),oi(document,"touchend touchcancel contextmenu",this._cancel,this),oi(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function s(){ii(document,"touchend",Ve),ii(document,"touchend touchcancel",s)},_cancel:function(){clearTimeout(this._holdTimeout),ii(document,"touchend touchcancel contextmenu",this._cancel,this),ii(document,"touchmove",this._onMove,this)},_onMove:function(s){var f=s.touches[0];this._newPos=new ei(f.clientX,f.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(s,f){var w=new MouseEvent(s,{bubbles:!0,cancelable:!0,view:window,screenX:f.screenX,screenY:f.screenY,clientX:f.clientX,clientY:f.clientY});w._simulated=!0,f.target.dispatchEvent(w)}});vi.addInitHook("addHandler","tapHold",Ss),vi.mergeOptions({touchZoom:Se.touch,bounceAtZoomLimits:!0});var ur=Mr.extend({addHooks:function(){hi(this._map._container,"leaflet-touch-zoom"),oi(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Ji(this._map._container,"leaflet-touch-zoom"),ii(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(s){var f=this._map;if(!(!s.touches||s.touches.length!==2||f._animatingZoom||this._zooming)){var w=f.mouseEventToContainerPoint(s.touches[0]),E=f.mouseEventToContainerPoint(s.touches[1]);this._centerPoint=f.getSize()._divideBy(2),this._startLatLng=f.containerPointToLatLng(this._centerPoint),f.options.touchZoom!=="center"&&(this._pinchStartLatLng=f.containerPointToLatLng(w.add(E)._divideBy(2))),this._startDist=w.distanceTo(E),this._startZoom=f.getZoom(),this._moved=!1,this._zooming=!0,f._stop(),oi(document,"touchmove",this._onTouchMove,this),oi(document,"touchend touchcancel",this._onTouchEnd,this),Ve(s)}},_onTouchMove:function(s){if(!(!s.touches||s.touches.length!==2||!this._zooming)){var f=this._map,w=f.mouseEventToContainerPoint(s.touches[0]),E=f.mouseEventToContainerPoint(s.touches[1]),N=w.distanceTo(E)/this._startDist;if(this._zoom=f.getScaleZoom(N,this._startZoom),!f.options.bounceAtZoomLimits&&(this._zoom<f.getMinZoom()&&N<1||this._zoom>f.getMaxZoom()&&N>1)&&(this._zoom=f._limitZoom(this._zoom)),f.options.touchZoom==="center"){if(this._center=this._startLatLng,N===1)return}else{var it=w._add(E)._divideBy(2)._subtract(this._centerPoint);if(N===1&&it.x===0&&it.y===0)return;this._center=f.unproject(f.project(this._pinchStartLatLng,this._zoom).subtract(it),this._zoom)}this._moved||(f._moveStart(!0,!1),this._moved=!0),Ki(this._animRequest);var Pt=S(f._move,f,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=dr(Pt,this,!0),Ve(s)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Ki(this._animRequest),ii(document,"touchmove",this._onTouchMove,this),ii(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});vi.addInitHook("addHandler","touchZoom",ur),vi.BoxZoom=Ke,vi.DoubleClickZoom=Ps,vi.Drag=xn,vi.Keyboard=ri,vi.ScrollWheelZoom=Ys,vi.TapHold=Ss,vi.TouchZoom=ur,$t.Bounds=bi,$t.Browser=Se,$t.CRS=Wr,$t.Canvas=vo,$t.Circle=Ms,$t.CircleMarker=ua,$t.Class=wr,$t.Control=Nr,$t.DivIcon=Ba,$t.DivOverlay=Jn,$t.DomEvent=Wa,$t.DomUtil=Pa,$t.Draggable=us,$t.Evented=Nn,$t.FeatureGroup=tn,$t.GeoJSON=hs,$t.GridLayer=Ls,$t.Handler=Mr,$t.Icon=Cs,$t.ImageOverlay=_o,$t.LatLng=wi,$t.LatLngBounds=$i,$t.Layer=Zr,$t.LayerGroup=Bn,$t.LineUtil=An,$t.Map=vi,$t.Marker=Uo,$t.Mixin=bs,$t.Path=Br,$t.Point=ei,$t.PolyUtil=_n,$t.Polygon=vn,$t.Polyline=yn,$t.Popup=ca,$t.PosAnimation=Hn,$t.Projection=Hs,$t.Rectangle=qo,$t.Renderer=Dr,$t.SVG=cs,$t.SVGOverlay=xl,$t.TileLayer=Tr,$t.Tooltip=go,$t.Transformation=yr,$t.Util=_r,$t.VideoOverlay=il,$t.bind=S,$t.bounds=ti,$t.canvas=pa,$t.circle=uo,$t.circleMarker=tl,$t.control=ls,$t.divIcon=yo,$t.extend=Vt,$t.featureGroup=Bl,$t.geoJSON=Aa,$t.geoJson=mo,$t.gridLayer=$o,$t.icon=la,$t.imageOverlay=el,$t.latLng=mi,$t.latLngBounds=Ii,$t.layerGroup=Ya,$t.map=gl,$t.marker=Qa,$t.point=Ye,$t.polygon=vl,$t.polyline=Dl,$t.popup=Ia,$t.rectangle=en,$t.setOptions=Ae,$t.stamp=rt,$t.svg=wo,$t.svgOverlay=ha,$t.tileLayer=nl,$t.tooltip=Xs,$t.transformation=_s,$t.version=gt,$t.videoOverlay=rl;var ll=window.L;$t.noConflict=function(){return window.L=ll,this},window.L=$t})});var hf=mh((uf,Tc)=>{eo();(function($t,gt){typeof define=="function"&&define.amd?define(["leaflet"],gt):typeof modules=="object"&&Tc.exports?Tc.exports=gt(Lc()):gt(L)})(uf,function($t){"use strict";return $t.TileLayer.Provider=$t.TileLayer.extend({initialize:function(gt,Vt){var G=$t.TileLayer.Provider.providers,S=gt.split("."),u=S[0],rt=S[1];if(!G[u])throw"No such provider ("+u+")";var Qt={url:G[u].url,options:G[u].options};if(rt&&"variants"in G[u]){if(!(rt in G[u].variants))throw"No such variant of "+u+" ("+rt+")";var se=G[u].variants[rt],Kt;typeof se=="string"?Kt={variant:se}:Kt=se.options,Qt={url:se.url||Qt.url,options:$t.Util.extend({},Qt.options,Kt)}}var re=function(ge){return ge.indexOf("{attribution.")===-1?ge:ge.replace(/\{attribution.(\w*)\}/g,function(Ae,pi){return re(G[pi].options.attribution)})};Qt.options.attribution=re(Qt.options.attribution);var _t=$t.Util.extend({},Qt.options,Vt);$t.TileLayer.prototype.initialize.call(this,Qt.url,_t)}}),$t.TileLayer.Provider.providers={OpenStreetMap:{url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",options:{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},variants:{Mapnik:{},DE:{url:"https://tile.openstreetmap.de/{z}/{x}/{y}.png",options:{maxZoom:18}},CH:{url:"https://tile.osm.ch/switzerland/{z}/{x}/{y}.png",options:{maxZoom:18,bounds:[[45,5],[48,11]]}},France:{url:"https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",options:{maxZoom:20,attribution:"&copy; OpenStreetMap France | {attribution.OpenStreetMap}"}},HOT:{url:"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",options:{attribution:'{attribution.OpenStreetMap}, Tiles style by <a href="https://www.hotosm.org/" target="_blank">Humanitarian OpenStreetMap Team</a> hosted by <a href="https://openstreetmap.fr/" target="_blank">OpenStreetMap France</a>'}},BZH:{url:"https://tile.openstreetmap.bzh/br/{z}/{x}/{y}.png",options:{attribution:'{attribution.OpenStreetMap}, Tiles courtesy of <a href="http://www.openstreetmap.bzh/" target="_blank">Breton OpenStreetMap Team</a>',bounds:[[46.2,-5.5],[50,.7]]}}}},MapTilesAPI:{url:"https://maptiles.p.rapidapi.com/{variant}/{z}/{x}/{y}.png?rapidapi-key={apikey}",options:{attribution:'&copy; <a href="http://www.maptilesapi.com/">MapTiles API</a>, {attribution.OpenStreetMap}',variant:"en/map/v1",apikey:"<insert your api key here>",maxZoom:19},variants:{OSMEnglish:{options:{variant:"en/map/v1"}},OSMFrancais:{options:{variant:"fr/map/v1"}},OSMEspagnol:{options:{variant:"es/map/v1"}}}},OpenSeaMap:{url:"https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",options:{attribution:'Map data: &copy; <a href="http://www.openseamap.org">OpenSeaMap</a> contributors'}},OPNVKarte:{url:"https://tileserver.memomaps.de/tilegen/{z}/{x}/{y}.png",options:{maxZoom:18,attribution:'Map <a href="https://memomaps.de/">memomaps.de</a> <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, map data {attribution.OpenStreetMap}'}},OpenTopoMap:{url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",options:{maxZoom:17,attribution:'Map data: {attribution.OpenStreetMap}, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}},OpenRailwayMap:{url:"https://{s}.tiles.openrailwaymap.org/standard/{z}/{x}/{y}.png",options:{maxZoom:19,attribution:'Map data: {attribution.OpenStreetMap} | Map style: &copy; <a href="https://www.OpenRailwayMap.org">OpenRailwayMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}},OpenFireMap:{url:"http://openfiremap.org/hytiles/{z}/{x}/{y}.png",options:{maxZoom:19,attribution:'Map data: {attribution.OpenStreetMap} | Map style: &copy; <a href="http://www.openfiremap.org">OpenFireMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}},SafeCast:{url:"https://s3.amazonaws.com/te512.safecast.org/{z}/{x}/{y}.png",options:{maxZoom:16,attribution:'Map data: {attribution.OpenStreetMap} | Map style: &copy; <a href="https://blog.safecast.org/about/">SafeCast</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}},Stadia:{url:"https://tiles.stadiamaps.com/tiles/{variant}/{z}/{x}/{y}{r}.{ext}",options:{minZoom:0,maxZoom:20,attribution:'&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> {attribution.OpenStreetMap}',variant:"alidade_smooth",ext:"png"},variants:{AlidadeSmooth:"alidade_smooth",AlidadeSmoothDark:"alidade_smooth_dark",OSMBright:"osm_bright",Outdoors:"outdoors",StamenToner:{options:{attribution:'&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> {attribution.OpenStreetMap}',variant:"stamen_toner"}},StamenTonerBackground:{options:{attribution:'&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> {attribution.OpenStreetMap}',variant:"stamen_toner_background"}},StamenTonerLines:{options:{attribution:'&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> {attribution.OpenStreetMap}',variant:"stamen_toner_lines"}},StamenTonerLabels:{options:{attribution:'&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> {attribution.OpenStreetMap}',variant:"stamen_toner_labels"}},StamenTonerLite:{options:{attribution:'&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> {attribution.OpenStreetMap}',variant:"stamen_toner_lite"}},StamenWatercolor:{url:"https://tiles.stadiamaps.com/tiles/{variant}/{z}/{x}/{y}.{ext}",options:{attribution:'&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> {attribution.OpenStreetMap}',variant:"stamen_watercolor",ext:"jpg",minZoom:1,maxZoom:16}},StamenTerrain:{options:{attribution:'&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> {attribution.OpenStreetMap}',variant:"stamen_terrain",minZoom:0,maxZoom:18}},StamenTerrainBackground:{options:{attribution:'&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> {attribution.OpenStreetMap}',variant:"stamen_terrain_background",minZoom:0,maxZoom:18}},StamenTerrainLabels:{options:{attribution:'&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> {attribution.OpenStreetMap}',variant:"stamen_terrain_labels",minZoom:0,maxZoom:18}},StamenTerrainLines:{options:{attribution:'&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> {attribution.OpenStreetMap}',variant:"stamen_terrain_lines",minZoom:0,maxZoom:18}}}},Thunderforest:{url:"https://{s}.tile.thunderforest.com/{variant}/{z}/{x}/{y}.png?apikey={apikey}",options:{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, {attribution.OpenStreetMap}',variant:"cycle",apikey:"<insert your api key here>",maxZoom:22},variants:{OpenCycleMap:"cycle",Transport:{options:{variant:"transport"}},TransportDark:{options:{variant:"transport-dark"}},SpinalMap:{options:{variant:"spinal-map"}},Landscape:"landscape",Outdoors:"outdoors",Pioneer:"pioneer",MobileAtlas:"mobile-atlas",Neighbourhood:"neighbourhood"}},CyclOSM:{url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",options:{maxZoom:20,attribution:'<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: {attribution.OpenStreetMap}'}},Jawg:{url:"https://{s}.tile.jawg.io/{variant}/{z}/{x}/{y}{r}.png?access-token={accessToken}",options:{attribution:'<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> {attribution.OpenStreetMap}',minZoom:0,maxZoom:22,subdomains:"abcd",variant:"jawg-terrain",accessToken:"<insert your access token here>"},variants:{Streets:"jawg-streets",Terrain:"jawg-terrain",Sunny:"jawg-sunny",Dark:"jawg-dark",Light:"jawg-light",Matrix:"jawg-matrix"}},MapBox:{url:"https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}{r}?access_token={accessToken}",options:{attribution:'&copy; <a href="https://www.mapbox.com/about/maps/" target="_blank">Mapbox</a> {attribution.OpenStreetMap} <a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a>',tileSize:512,maxZoom:18,zoomOffset:-1,id:"mapbox/streets-v11",accessToken:"<insert your access token here>"}},MapTiler:{url:"https://api.maptiler.com/maps/{variant}/{z}/{x}/{y}{r}.{ext}?key={key}",options:{attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',variant:"streets",ext:"png",key:"<insert your MapTiler Cloud API key here>",tileSize:512,zoomOffset:-1,minZoom:0,maxZoom:21},variants:{Streets:"streets",Basic:"basic",Bright:"bright",Pastel:"pastel",Positron:"positron",Hybrid:{options:{variant:"hybrid",ext:"jpg"}},Toner:"toner",Topo:"topo",Voyager:"voyager"}},TomTom:{url:"https://{s}.api.tomtom.com/map/1/tile/{variant}/{style}/{z}/{x}/{y}.{ext}?key={apikey}",options:{variant:"basic",maxZoom:22,attribution:'<a href="https://tomtom.com" target="_blank">&copy;  1992 - '+new Date().getFullYear()+" TomTom.</a> ",subdomains:"abcd",style:"main",ext:"png",apikey:"<insert your API key here>"},variants:{Basic:"basic",Hybrid:"hybrid",Labels:"labels"}},Esri:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/{variant}/MapServer/tile/{z}/{y}/{x}",options:{variant:"World_Street_Map",attribution:"Tiles &copy; Esri"},variants:{WorldStreetMap:{options:{attribution:"{attribution.Esri} &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012"}},DeLorme:{options:{variant:"Specialty/DeLorme_World_Base_Map",minZoom:1,maxZoom:11,attribution:"{attribution.Esri} &mdash; Copyright: &copy;2012 DeLorme"}},WorldTopoMap:{options:{variant:"World_Topo_Map",attribution:"{attribution.Esri} &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community"}},WorldImagery:{options:{variant:"World_Imagery",attribution:"{attribution.Esri} &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}},WorldTerrain:{options:{variant:"World_Terrain_Base",maxZoom:13,attribution:"{attribution.Esri} &mdash; Source: USGS, Esri, TANA, DeLorme, and NPS"}},WorldShadedRelief:{options:{variant:"World_Shaded_Relief",maxZoom:13,attribution:"{attribution.Esri} &mdash; Source: Esri"}},WorldPhysical:{options:{variant:"World_Physical_Map",maxZoom:8,attribution:"{attribution.Esri} &mdash; Source: US National Park Service"}},OceanBasemap:{options:{variant:"Ocean/World_Ocean_Base",maxZoom:13,attribution:"{attribution.Esri} &mdash; Sources: GEBCO, NOAA, CHS, OSU, UNH, CSUMB, National Geographic, DeLorme, NAVTEQ, and Esri"}},NatGeoWorldMap:{options:{variant:"NatGeo_World_Map",maxZoom:16,attribution:"{attribution.Esri} &mdash; National Geographic, Esri, DeLorme, NAVTEQ, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, iPC"}},WorldGrayCanvas:{options:{variant:"Canvas/World_Light_Gray_Base",maxZoom:16,attribution:"{attribution.Esri} &mdash; Esri, DeLorme, NAVTEQ"}}}},OpenWeatherMap:{url:"http://{s}.tile.openweathermap.org/map/{variant}/{z}/{x}/{y}.png?appid={apiKey}",options:{maxZoom:19,attribution:'Map data &copy; <a href="http://openweathermap.org">OpenWeatherMap</a>',apiKey:"<insert your api key here>",opacity:.5},variants:{Clouds:"clouds",CloudsClassic:"clouds_cls",Precipitation:"precipitation",PrecipitationClassic:"precipitation_cls",Rain:"rain",RainClassic:"rain_cls",Pressure:"pressure",PressureContour:"pressure_cntr",Wind:"wind",Temperature:"temp",Snow:"snow"}},HERE:{url:"https://{s}.{base}.maps.api.here.com/maptile/2.1/{type}/{mapID}/{variant}/{z}/{x}/{y}/{size}/{format}?app_id={app_id}&app_code={app_code}&lg={language}",options:{attribution:"Map &copy; 1987-"+new Date().getFullYear()+' <a href="http://developer.here.com">HERE</a>',subdomains:"1234",mapID:"newest",app_id:"<insert your app_id here>",app_code:"<insert your app_code here>",base:"base",variant:"normal.day",maxZoom:20,type:"maptile",language:"eng",format:"png8",size:"256"},variants:{normalDay:"normal.day",normalDayCustom:"normal.day.custom",normalDayGrey:"normal.day.grey",normalDayMobile:"normal.day.mobile",normalDayGreyMobile:"normal.day.grey.mobile",normalDayTransit:"normal.day.transit",normalDayTransitMobile:"normal.day.transit.mobile",normalDayTraffic:{options:{variant:"normal.traffic.day",base:"traffic",type:"traffictile"}},normalNight:"normal.night",normalNightMobile:"normal.night.mobile",normalNightGrey:"normal.night.grey",normalNightGreyMobile:"normal.night.grey.mobile",normalNightTransit:"normal.night.transit",normalNightTransitMobile:"normal.night.transit.mobile",reducedDay:"reduced.day",reducedNight:"reduced.night",basicMap:{options:{type:"basetile"}},mapLabels:{options:{type:"labeltile",format:"png"}},trafficFlow:{options:{base:"traffic",type:"flowtile"}},carnavDayGrey:"carnav.day.grey",hybridDay:{options:{base:"aerial",variant:"hybrid.day"}},hybridDayMobile:{options:{base:"aerial",variant:"hybrid.day.mobile"}},hybridDayTransit:{options:{base:"aerial",variant:"hybrid.day.transit"}},hybridDayGrey:{options:{base:"aerial",variant:"hybrid.grey.day"}},hybridDayTraffic:{options:{variant:"hybrid.traffic.day",base:"traffic",type:"traffictile"}},pedestrianDay:"pedestrian.day",pedestrianNight:"pedestrian.night",satelliteDay:{options:{base:"aerial",variant:"satellite.day"}},terrainDay:{options:{base:"aerial",variant:"terrain.day"}},terrainDayMobile:{options:{base:"aerial",variant:"terrain.day.mobile"}}}},HEREv3:{url:"https://{s}.{base}.maps.ls.hereapi.com/maptile/2.1/{type}/{mapID}/{variant}/{z}/{x}/{y}/{size}/{format}?apiKey={apiKey}&lg={language}",options:{attribution:"Map &copy; 1987-"+new Date().getFullYear()+' <a href="http://developer.here.com">HERE</a>',subdomains:"1234",mapID:"newest",apiKey:"<insert your apiKey here>",base:"base",variant:"normal.day",maxZoom:20,type:"maptile",language:"eng",format:"png8",size:"256"},variants:{normalDay:"normal.day",normalDayCustom:"normal.day.custom",normalDayGrey:"normal.day.grey",normalDayMobile:"normal.day.mobile",normalDayGreyMobile:"normal.day.grey.mobile",normalDayTransit:"normal.day.transit",normalDayTransitMobile:"normal.day.transit.mobile",normalNight:"normal.night",normalNightMobile:"normal.night.mobile",normalNightGrey:"normal.night.grey",normalNightGreyMobile:"normal.night.grey.mobile",normalNightTransit:"normal.night.transit",normalNightTransitMobile:"normal.night.transit.mobile",reducedDay:"reduced.day",reducedNight:"reduced.night",basicMap:{options:{type:"basetile"}},mapLabels:{options:{type:"labeltile",format:"png"}},trafficFlow:{options:{base:"traffic",type:"flowtile"}},carnavDayGrey:"carnav.day.grey",hybridDay:{options:{base:"aerial",variant:"hybrid.day"}},hybridDayMobile:{options:{base:"aerial",variant:"hybrid.day.mobile"}},hybridDayTransit:{options:{base:"aerial",variant:"hybrid.day.transit"}},hybridDayGrey:{options:{base:"aerial",variant:"hybrid.grey.day"}},pedestrianDay:"pedestrian.day",pedestrianNight:"pedestrian.night",satelliteDay:{options:{base:"aerial",variant:"satellite.day"}},terrainDay:{options:{base:"aerial",variant:"terrain.day"}},terrainDayMobile:{options:{base:"aerial",variant:"terrain.day.mobile"}}}},FreeMapSK:{url:"https://{s}.freemap.sk/T/{z}/{x}/{y}.jpeg",options:{minZoom:8,maxZoom:16,subdomains:"abcd",bounds:[[47.204642,15.996093],[49.830896,22.576904]],attribution:'{attribution.OpenStreetMap}, visualization CC-By-SA 2.0 <a href="http://freemap.sk">Freemap.sk</a>'}},MtbMap:{url:"http://tile.mtbmap.cz/mtbmap_tiles/{z}/{x}/{y}.png",options:{attribution:"{attribution.OpenStreetMap} &amp; USGS"}},CartoDB:{url:"https://{s}.basemaps.cartocdn.com/{variant}/{z}/{x}/{y}{r}.png",options:{attribution:'{attribution.OpenStreetMap} &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:20,variant:"light_all"},variants:{Positron:"light_all",PositronNoLabels:"light_nolabels",PositronOnlyLabels:"light_only_labels",DarkMatter:"dark_all",DarkMatterNoLabels:"dark_nolabels",DarkMatterOnlyLabels:"dark_only_labels",Voyager:"rastertiles/voyager",VoyagerNoLabels:"rastertiles/voyager_nolabels",VoyagerOnlyLabels:"rastertiles/voyager_only_labels",VoyagerLabelsUnder:"rastertiles/voyager_labels_under"}},HikeBike:{url:"https://tiles.wmflabs.org/{variant}/{z}/{x}/{y}.png",options:{maxZoom:19,attribution:"{attribution.OpenStreetMap}",variant:"hikebike"},variants:{HikeBike:{},HillShading:{options:{maxZoom:15,variant:"hillshading"}}}},BasemapAT:{url:"https://mapsneu.wien.gv.at/basemap/{variant}/{type}/google3857/{z}/{y}/{x}.{format}",options:{maxZoom:19,attribution:'Datenquelle: <a href="https://www.basemap.at">basemap.at</a>',type:"normal",format:"png",bounds:[[46.35877,8.782379],[49.037872,17.189532]],variant:"geolandbasemap"},variants:{basemap:{options:{maxZoom:20,variant:"geolandbasemap"}},grau:"bmapgrau",overlay:"bmapoverlay",terrain:{options:{variant:"bmapgelaende",type:"grau",format:"jpeg"}},surface:{options:{variant:"bmapoberflaeche",type:"grau",format:"jpeg"}},highdpi:{options:{variant:"bmaphidpi",format:"jpeg"}},orthofoto:{options:{maxZoom:20,variant:"bmaporthofoto30cm",format:"jpeg"}}}},nlmaps:{url:"https://service.pdok.nl/brt/achtergrondkaart/wmts/v2_0/{variant}/EPSG:3857/{z}/{x}/{y}.png",options:{minZoom:6,maxZoom:19,bounds:[[50.5,3.25],[54,7.6]],attribution:'Kaartgegevens &copy; <a href="https://www.kadaster.nl">Kadaster</a>'},variants:{standaard:"standaard",pastel:"pastel",grijs:"grijs",water:"water",luchtfoto:{url:"https://service.pdok.nl/hwh/luchtfotorgb/wmts/v1_0/Actueel_ortho25/EPSG:3857/{z}/{x}/{y}.jpeg"}}},NASAGIBS:{url:"https://map1.vis.earthdata.nasa.gov/wmts-webmerc/{variant}/default/{time}/{tilematrixset}{maxZoom}/{z}/{y}/{x}.{format}",options:{attribution:'Imagery provided by services from the Global Imagery Browse Services (GIBS), operated by the NASA/GSFC/Earth Science Data and Information System (<a href="https://earthdata.nasa.gov">ESDIS</a>) with funding provided by NASA/HQ.',bounds:[[-85.0511287776,-179.999999975],[85.0511287776,179.999999975]],minZoom:1,maxZoom:9,format:"jpg",time:"",tilematrixset:"GoogleMapsCompatible_Level"},variants:{ModisTerraTrueColorCR:"MODIS_Terra_CorrectedReflectance_TrueColor",ModisTerraBands367CR:"MODIS_Terra_CorrectedReflectance_Bands367",ViirsEarthAtNight2012:{options:{variant:"VIIRS_CityLights_2012",maxZoom:8}},ModisTerraLSTDay:{options:{variant:"MODIS_Terra_Land_Surface_Temp_Day",format:"png",maxZoom:7,opacity:.75}},ModisTerraSnowCover:{options:{variant:"MODIS_Terra_NDSI_Snow_Cover",format:"png",maxZoom:8,opacity:.75}},ModisTerraAOD:{options:{variant:"MODIS_Terra_Aerosol",format:"png",maxZoom:6,opacity:.75}},ModisTerraChlorophyll:{options:{variant:"MODIS_Terra_Chlorophyll_A",format:"png",maxZoom:7,opacity:.75}}}},NLS:{url:"https://nls-{s}.tileserver.com/nls/{z}/{x}/{y}.jpg",options:{attribution:'<a href="http://geo.nls.uk/maps/">National Library of Scotland Historic Maps</a>',bounds:[[49.6,-12],[61.7,3]],minZoom:1,maxZoom:18,subdomains:"0123"}},JusticeMap:{url:"https://www.justicemap.org/tile/{size}/{variant}/{z}/{x}/{y}.png",options:{attribution:'<a href="http://www.justicemap.org/terms.php">Justice Map</a>',size:"county",bounds:[[14,-180],[72,-56]]},variants:{income:"income",americanIndian:"indian",asian:"asian",black:"black",hispanic:"hispanic",multi:"multi",nonWhite:"nonwhite",white:"white",plurality:"plural"}},GeoportailFrance:{url:"https://wxs.ign.fr/{apikey}/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE={style}&TILEMATRIXSET=PM&FORMAT={format}&LAYER={variant}&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",options:{attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',bounds:[[-75,-180],[81,180]],minZoom:2,maxZoom:18,apikey:"choisirgeoportail",format:"image/png",style:"normal",variant:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2"},variants:{plan:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2",parcels:{options:{variant:"CADASTRALPARCELS.PARCELLAIRE_EXPRESS",style:"PCI vecteur",maxZoom:20}},orthos:{options:{maxZoom:19,format:"image/jpeg",variant:"ORTHOIMAGERY.ORTHOPHOTOS"}}}},OneMapSG:{url:"https://maps-{s}.onemap.sg/v3/{variant}/{z}/{x}/{y}.png",options:{variant:"Default",minZoom:11,maxZoom:18,bounds:[[1.56073,104.11475],[1.16,103.502]],attribution:'<img src="https://docs.onemap.sg/maps/images/oneMap64-01.png" style="height:20px;width:20px;"/> New OneMap | Map data &copy; contributors, <a href="http://SLA.gov.sg">Singapore Land Authority</a>'},variants:{Default:"Default",Night:"Night",Original:"Original",Grey:"Grey",LandLot:"LandLot"}},USGS:{url:"https://basemap.nationalmap.gov/arcgis/rest/services/USGSTopo/MapServer/tile/{z}/{y}/{x}",options:{maxZoom:20,attribution:'Tiles courtesy of the <a href="https://usgs.gov/">U.S. Geological Survey</a>'},variants:{USTopo:{},USImagery:{url:"https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryOnly/MapServer/tile/{z}/{y}/{x}"},USImageryTopo:{url:"https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryTopo/MapServer/tile/{z}/{y}/{x}"}}},WaymarkedTrails:{url:"https://tile.waymarkedtrails.org/{variant}/{z}/{x}/{y}.png",options:{maxZoom:18,attribution:'Map data: {attribution.OpenStreetMap} | Map style: &copy; <a href="https://waymarkedtrails.org">waymarkedtrails.org</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'},variants:{hiking:"hiking",cycling:"cycling",mtb:"mtb",slopes:"slopes",riding:"riding",skating:"skating"}},OpenAIP:{url:"https://{s}.tile.maps.openaip.net/geowebcache/service/tms/1.0.0/openaip_basemap@EPSG%3A900913@png/{z}/{x}/{y}.{ext}",options:{attribution:'<a href="https://www.openaip.net/">openAIP Data</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-NC-SA</a>)',ext:"png",minZoom:4,maxZoom:14,tms:!0,detectRetina:!0,subdomains:"12"}},OpenSnowMap:{url:"https://tiles.opensnowmap.org/{variant}/{z}/{x}/{y}.png",options:{minZoom:9,maxZoom:18,attribution:'Map data: {attribution.OpenStreetMap} & ODbL, &copy; <a href="https://www.opensnowmap.org/iframes/data.html">www.opensnowmap.org</a> <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'},variants:{pistes:"pistes"}},AzureMaps:{url:"https://atlas.microsoft.com/map/tile?api-version={apiVersion}&tilesetId={variant}&x={x}&y={y}&zoom={z}&language={language}&subscription-key={subscriptionKey}",options:{attribution:"See https://docs.microsoft.com/en-us/rest/api/maps/render-v2/get-map-tile for details.",apiVersion:"2.0",variant:"microsoft.imagery",subscriptionKey:"<insert your subscription key here>",language:"en-US"},variants:{MicrosoftImagery:"microsoft.imagery",MicrosoftBaseDarkGrey:"microsoft.base.darkgrey",MicrosoftBaseRoad:"microsoft.base.road",MicrosoftBaseHybridRoad:"microsoft.base.hybrid.road",MicrosoftTerraMain:"microsoft.terra.main",MicrosoftWeatherInfraredMain:{url:"https://atlas.microsoft.com/map/tile?api-version={apiVersion}&tilesetId={variant}&x={x}&y={y}&zoom={z}&timeStamp={timeStamp}&language={language}&subscription-key={subscriptionKey}",options:{timeStamp:"2021-05-08T09:03:00Z",attribution:"See https://docs.microsoft.com/en-us/rest/api/maps/render-v2/get-map-tile#uri-parameters for details.",variant:"microsoft.weather.infrared.main"}},MicrosoftWeatherRadarMain:{url:"https://atlas.microsoft.com/map/tile?api-version={apiVersion}&tilesetId={variant}&x={x}&y={y}&zoom={z}&timeStamp={timeStamp}&language={language}&subscription-key={subscriptionKey}",options:{timeStamp:"2021-05-08T09:03:00Z",attribution:"See https://docs.microsoft.com/en-us/rest/api/maps/render-v2/get-map-tile#uri-parameters for details.",variant:"microsoft.weather.radar.main"}}}},SwissFederalGeoportal:{url:"https://wmts.geo.admin.ch/1.0.0/{variant}/default/current/3857/{z}/{x}/{y}.jpeg",options:{attribution:'&copy; <a href="https://www.swisstopo.admin.ch/">swisstopo</a>',minZoom:2,maxZoom:18,bounds:[[45.398181,5.140242],[48.230651,11.47757]]},variants:{NationalMapColor:"ch.swisstopo.pixelkarte-farbe",NationalMapGrey:"ch.swisstopo.pixelkarte-grau",SWISSIMAGE:{options:{variant:"ch.swisstopo.swissimage",maxZoom:19}}}}},$t.tileLayer.provider=function(gt,Vt){return new $t.TileLayer.Provider(gt,Vt)},$t})});var pf=mh((Pc,Sc)=>{eo();(function($t,gt){typeof Pc=="object"&&typeof Sc<"u"?Sc.exports=gt():typeof define=="function"&&define.amd?define(gt):($t=typeof globalThis<"u"?globalThis:$t||self,$t.maplibregl=gt())})(Pc,function(){"use strict";var $t={},gt={};function Vt(S,u,rt){if(gt[S]=rt,S==="index"){var Qt="var sharedModule = {}; ("+gt.shared+")(sharedModule); ("+gt.worker+")(sharedModule);",se={};return gt.shared(se),gt.index($t,se),typeof window<"u"&&$t.setWorkerUrl(window.URL.createObjectURL(new Blob([Qt],{type:"text/javascript"}))),$t}}Vt("shared",["exports"],function(S){"use strict";function u(n,e,r,o){return new(r||(r=Promise))(function(c,_){function g(k){try{T(o.next(k))}catch(B){_(B)}}function b(k){try{T(o.throw(k))}catch(B){_(B)}}function T(k){var B;k.done?c(k.value):(B=k.value,B instanceof r?B:new r(function(z){z(B)})).then(g,b)}T((o=o.apply(n,e||[])).next())})}function rt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Qt,se;function Kt(){if(se)return Qt;function n(e,r){this.x=e,this.y=r}return se=1,Qt=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,o=e.y-this.y;return r*r+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),o=Math.sin(e),c=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=c,this},_rotateAround:function(e,r){var o=Math.cos(e),c=Math.sin(e),_=r.y+c*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-c*(this.y-r.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},Qt}typeof SuppressedError=="function"&&SuppressedError;var re,_t,ge=rt(Kt()),Ae=function(){if(_t)return re;function n(e,r,o,c){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=o,this.p2y=c}return _t=1,re=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,c=0;c<8;c++){var _=this.sampleCurveX(o)-e;if(Math.abs(_)<r)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=_/g}var b=0,T=1;for(o=e,c=0;c<20&&(_=this.sampleCurveX(o),!(Math.abs(_-e)<r));c++)e>_?b=o:T=o,o=.5*(T-b)+b;return o},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},re}(),pi=rt(Ae);let Ze,gi;function Bi(){return Ze==null&&(Ze=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ze}function Wi(){if(gi==null&&(gi=!1,Bi())){let e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<5*5;o++){let c=4*o;e.fillStyle=`rgb(${c},${c+1},${c+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}let r=e.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&r[o]!==o){gi=!0;break}}}return gi||!1}var Ei=1e-6,Ri=typeof Float32Array<"u"?Float32Array:Array;function Pn(){var n=new Ri(9);return Ri!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Fn(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Bs(){var n=new Ri(3);return Ri!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Ds(n){return Math.hypot(n[0],n[1],n[2])}function dr(n,e,r){var o=new Ri(3);return o[0]=n,o[1]=e,o[2]=r,o}function Ki(n,e,r){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n}function _r(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function wr(n,e,r){var o=e[0],c=e[1],_=e[2],g=r[0],b=r[1],T=r[2];return n[0]=c*T-_*b,n[1]=_*g-o*T,n[2]=o*b-c*g,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var is,gr=Ds;function Nn(n,e,r){var o=e[0],c=e[1],_=e[2],g=e[3];return n[0]=r[0]*o+r[4]*c+r[8]*_+r[12]*g,n[1]=r[1]*o+r[5]*c+r[9]*_+r[13]*g,n[2]=r[2]*o+r[6]*c+r[10]*_+r[14]*g,n[3]=r[3]*o+r[7]*c+r[11]*_+r[15]*g,n}function ei(){var n=new Ri(4);return Ri!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function io(n,e,r,o){var c=.5*Math.PI/180;e*=c,r*=c,o*=c;var _=Math.sin(e),g=Math.cos(e),b=Math.sin(r),T=Math.cos(r),k=Math.sin(o),B=Math.cos(o);return n[0]=_*T*B-g*b*k,n[1]=g*b*B+_*T*k,n[2]=g*T*k-_*b*B,n[3]=g*T*B+_*b*k,n}function Ye(){var n=new Ri(2);return Ri!=Float32Array&&(n[0]=0,n[1]=0),n}function bi(n,e){var r=new Ri(2);return r[0]=n,r[1]=e,r}Bs(),is=new Ri(4),Ri!=Float32Array&&(is[0]=0,is[1]=0,is[2]=0,is[3]=0),Bs(),dr(1,0,0),dr(0,1,0),ei(),ei(),Pn(),Ye();let ti=8192;function $i(n,e,r){return e*(ti/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}function Ii(n,e){return(n%e+e)%e}function wi(n,e,r){return n*(1-r)+e*r}function mi(n){if(n<=0)return 0;if(n>=1)return 1;let e=n*n,r=e*n;return 4*(n<.5?r:3*(n-e)+r-.75)}function Wr(n,e,r,o){let c=new pi(n,e,r,o);return _=>c.solve(_)}let jn=Wr(.25,.1,.25,1);function nr(n,e,r){return Math.min(r,Math.max(e,n))}function ro(n,e,r){let o=r-e,c=((n-e)%o+o)%o+e;return c===e?r:c}function yr(n,...e){for(let r of e)for(let o in r)n[o]=r[o];return n}let _s=1;function ji(n,e,r){let o={};for(let c in n)o[c]=e.call(this,n[c],c,n);return o}function rs(n,e,r){let o={};for(let c in n)e.call(this,n[c],c,n)&&(o[c]=n[c]);return o}function cn(n){return Array.isArray(n)?n.map(cn):typeof n=="object"&&n?ji(n,cn):n}let zs={};function fr(n){zs[n]||(typeof console<"u"&&console.warn(n),zs[n]=!0)}function Er(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function Rr(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let ns=null;function Gn(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}let zo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Rs(n,e,r,o,c){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let _=new VideoFrame(n,{timestamp:0});try{let g=_?.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);let b=g.startsWith("BGR"),T=new Uint8ClampedArray(o*c*4);if(yield _.copyTo(T,function(k,B,z,V,H){let K=4*Math.max(1,0),Y=(Math.max(0,z)-z)*V*4+K,at=4*V,ft=Math.max(0,B),zt=Math.max(0,z);return{rect:{x:ft,y:zt,width:Math.min(k.width,B+V)-ft,height:Math.min(k.height,z+H)-zt},layout:[{offset:Y,stride:at}]}}(n,e,r,o,c)),b)for(let k=0;k<T.length;k+=4){let B=T[k];T[k]=T[k+2],T[k+2]=B}return T}finally{_.close()}})}let gs,no;function Zn(n,e,r,o){return n.addEventListener(e,r,o),{unsubscribe:()=>{n.removeEventListener(e,r,o)}}}function Kr(n){return n*Math.PI/180}function Vn(n){return n/Math.PI*180}let Xo={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Yo={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Un="AbortError";function Gt(){return new Error(Un)}let J={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function tt(n){return J.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}let lt="global-dispatcher";class vt extends Error{constructor(e,r,o,c){super(`AJAXError: ${r} (${e}): ${o}`),this.status=e,this.statusText=r,this.url=o,this.body=c}}let Et=()=>Rr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Nt=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){let o=tt(n.url);if(o)return o(n,e);if(Rr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:lt},e)}if(!(/^file:/.test(r=n.url)||/^file:/.test(Et())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,c){return u(this,void 0,void 0,function*(){let _=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Et(),signal:c.signal}),g,b;o.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{g=yield fetch(_)}catch(k){throw new vt(0,k.message,o.url,new Blob)}if(!g.ok){let k=yield g.blob();throw new vt(g.status,g.statusText,o.url,k)}b=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();let T=yield b;if(c.signal.aborted)throw Gt();return{data:T,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(n,e);if(Rr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:lt},e)}var r;return function(o,c){return new Promise((_,g)=>{var b;let T=new XMLHttpRequest;T.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(T.responseType="arraybuffer");for(let k in o.headers)T.setRequestHeader(k,o.headers[k]);o.type==="json"&&(T.responseType="text",!((b=o.headers)===null||b===void 0)&&b.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=o.credentials==="include",T.onerror=()=>{g(new Error(T.statusText))},T.onload=()=>{if(!c.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let k=T.response;if(o.type==="json")try{k=JSON.parse(T.response)}catch(B){return void g(B)}_({data:k,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{let k=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});g(new vt(T.status,T.statusText,o.url,k))}},c.signal.addEventListener("abort",()=>{T.abort(),g(Gt())}),T.send(o.body)})}(n,e)};function ee(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;let e=new URL(n),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Rt(n,e,r){r[n]&&r[n].indexOf(e)!==-1||(r[n]=r[n]||[],r[n].push(e))}function fe(n,e,r){if(r&&r[n]){let o=r[n].indexOf(e);o!==-1&&r[n].splice(o,1)}}class ce{constructor(e,r={}){yr(this,r),this.type=e}}class qt extends ce{constructor(e,r={}){super("error",yr({error:e},r))}}class ye{on(e,r){return this._listeners=this._listeners||{},Rt(e,r,this._listeners),{unsubscribe:()=>{this.off(e,r)}}}off(e,r){return fe(e,r,this._listeners),fe(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Rt(e,r,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,r){typeof e=="string"&&(e=new ce(e,r||{}));let o=e.type;if(this.listens(o)){e.target=this;let c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(let b of c)b.call(this,e);let _=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(let b of _)fe(o,b,this._oneTimeListeners),b.call(this,e);let g=this._eventedParent;g&&(yr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof qt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var At={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let Ie=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function $e(n,e){let r={};for(let o in n)o!=="ref"&&(r[o]=n[o]);return Ie.forEach(o=>{o in e&&(r[o]=e[o])}),r}function Be(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!Be(n[r],e[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(let r in n)if(!Be(n[r],e[r]))return!1;return!0}return n===e}function je(n,e){n.push(e)}function Je(n,e,r){je(r,{command:"addSource",args:[n,e[n]]})}function Oi(n,e,r){je(e,{command:"removeSource",args:[n]}),r[n]=!0}function Ai(n,e,r,o){Oi(n,r,o),Je(n,e,r)}function Ti(n,e,r){let o;for(o in n[r])if(Object.prototype.hasOwnProperty.call(n[r],o)&&o!=="data"&&!Be(n[r][o],e[r][o]))return!1;for(o in e[r])if(Object.prototype.hasOwnProperty.call(e[r],o)&&o!=="data"&&!Be(n[r][o],e[r][o]))return!1;return!0}function Ge(n,e,r,o,c,_){n=n||{},e=e||{};for(let g in n)Object.prototype.hasOwnProperty.call(n,g)&&(Be(n[g],e[g])||r.push({command:_,args:[o,g,e[g],c]}));for(let g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(n,g)&&(Be(n[g],e[g])||r.push({command:_,args:[o,g,e[g],c]}))}function Se(n){return n.id}function sr(n,e){return n[e.id]=e,n}class Le{constructor(e,r,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function vr(n,...e){for(let r of e)for(let o in r)n[o]=r[o];return n}class Gi extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class $n{constructor(e,r=[]){this.parent=e,this.bindings={};for(let[o,c]of r)this.bindings[o]=c}concat(e){return new $n(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let Os={kind:"null"},Pe={kind:"number"},ni={kind:"string"},ui={kind:"boolean"},pn={kind:"color"},La={kind:"projectionDefinition"},ss={kind:"object"},si={kind:"value"},ys={kind:"collator"},Sn={kind:"formatted"},Xi={kind:"padding"},Jo={kind:"colorArray"},Qo={kind:"numberArray"},vs={kind:"resolvedImage"},ta={kind:"variableAnchorOffsetCollection"};function Or(n,e){return{kind:"array",itemType:n,N:e}}function zi(n){if(n.kind==="array"){let e=zi(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}let Ha=[Os,Pe,ni,ui,pn,La,Sn,ss,Or(si),Xi,Qo,Jo,vs,ta];function Ro(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ro(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(let r of Ha)if(!Ro(r,e))return null}}return`Expected ${zi(n)} but found ${zi(e)} instead.`}function Fs(n,e){return e.some(r=>r.kind===n.kind)}function yi(n,e){return e.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function Si(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}let ea=.96422,Ns=.82521,js=4/29,Gs=6/29,hi=3*Gs*Gs,Ji=Gs*Gs*Gs,Zs=Math.PI/180,Ta=180/Math.PI;function dn(n){return(n%=360)<0&&(n+=360),n}function Oo([n,e,r,o]){let c,_,g=xs((.2225045*(n=Fo(n))+.7168786*(e=Fo(e))+.0606169*(r=Fo(r)))/1);n===e&&e===r?c=_=g:(c=xs((.4360747*n+.3850649*e+.1430804*r)/ea),_=xs((.0139322*n+.0971045*e+.7141733*r)/Ns));let b=116*g-16;return[b<0?0:b,500*(c-g),200*(g-_),o]}function Fo(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function xs(n){return n>Ji?Math.pow(n,1/3):n/hi+js}function er([n,e,r,o]){let c=(n+16)/116,_=isNaN(e)?c:c+e/500,g=isNaN(r)?c:c-r/200;return c=1*Vs(c),_=ea*Vs(_),g=Ns*Vs(g),[os(3.1338561*_-1.6168667*c-.4906146*g),os(-.9787684*_+1.9161415*c+.033454*g),os(.0719453*_-.2289914*c+1.4052427*g),o]}function os(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Vs(n){return n>Gs?n*n*n:hi*(n-js)}let Xr=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function ci(n,e){return Xr(n,e)?n[e]:void 0}function fn(n){return parseInt(n.padEnd(2,n),16)/255}function qn(n,e){return as(e?n/100:n,0,1)}function as(n,e,r){return Math.min(Math.max(e,n),r)}function No(n){return!n.some(Number.isNaN)}let ia={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Yr(n,e,r){return n+r*(e-n)}function kn(n,e,r){return n.map((o,c)=>Yr(o,e[c],r))}class di{constructor(e,r,o,c=1,_=!0){this.r=e,this.g=r,this.b=o,this.a=c,_||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,r,o,c]))}static parse(e){if(e instanceof di)return e;if(typeof e!="string")return;let r=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];let c=ci(ia,o);if(c){let[g,b,T]=c;return[g/255,b/255,T/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){let g=o.length<6?1:2,b=1;return[fn(o.slice(b,b+=g)),fn(o.slice(b,b+=g)),fn(o.slice(b,b+=g)),fn(o.slice(b,b+g)||"ff")]}if(o.startsWith("rgb")){let g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){let[b,T,k,B,z,V,H,K,Y,at,ft,zt]=g,wt=[B||" ",H||" ",at].join("");if(wt==="  "||wt==="  /"||wt===",,"||wt===",,,"){let U=[k,V,Y].join(""),st=U==="%%%"?100:U===""?255:0;if(st){let Mt=[as(+T/st,0,1),as(+z/st,0,1),as(+K/st,0,1),ft?qn(+ft,zt):1];if(No(Mt))return Mt}}return}}let _=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){let[g,b,T,k,B,z,V,H,K]=_,Y=[T||" ",B||" ",V].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){let at=[+b,as(+k,0,100),as(+z,0,100),H?qn(+H,K):1];if(No(at))return function([ft,zt,wt,U]){function st(Mt){let ae=(Mt+ft/30)%12,ve=zt*Math.min(wt,1-wt);return wt-ve*Math.max(-1,Math.min(ae-3,9-ae,1))}return ft=dn(ft),zt/=100,wt/=100,[st(0),st(8),st(4),U]}(at)}}}(e);return r?new di(...r,!1):void 0}get rgb(){let{r:e,g:r,b:o,a:c}=this,_=c||1/0;return this.overwriteGetter("rgb",[e/_,r/_,o/_,c])}get hcl(){return this.overwriteGetter("hcl",function(e){let[r,o,c,_]=Oo(e),g=Math.sqrt(o*o+c*c);return[Math.round(1e4*g)?dn(Math.atan2(c,o)*Ta):NaN,g,r,_]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Oo(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){let[e,r,o,c]=this.rgb;return`rgba(${[e,r,o].map(_=>Math.round(255*_)).join(",")},${c})`}static interpolate(e,r,o,c="rgb"){switch(c){case"rgb":{let[_,g,b,T]=kn(e.rgb,r.rgb,o);return new di(_,g,b,T,!1)}case"hcl":{let[_,g,b,T]=e.hcl,[k,B,z,V]=r.hcl,H,K;if(isNaN(_)||isNaN(k))isNaN(_)?isNaN(k)?H=NaN:(H=k,b!==1&&b!==0||(K=B)):(H=_,z!==1&&z!==0||(K=g));else{let wt=k-_;k>_&&wt>180?wt-=360:k<_&&_-k>180&&(wt+=360),H=_+o*wt}let[Y,at,ft,zt]=function([wt,U,st,Mt]){return wt=isNaN(wt)?0:wt*Zs,er([st,Math.cos(wt)*U,Math.sin(wt)*U,Mt])}([H,K??Yr(g,B,o),Yr(b,z,o),Yr(T,V,o)]);return new di(Y,at,ft,zt,!1)}case"lab":{let[_,g,b,T]=er(kn(e.lab,r.lab,o));return new di(_,g,b,T,!1)}}}}di.black=new di(0,0,0,1),di.white=new di(1,1,1,1),di.transparent=new di(0,0,0,0),di.red=new di(1,0,0,1);class so{constructor(e,r,o){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let Pa=["bottom","center","top"];class oi{constructor(e,r,o,c,_,g){this.text=e,this.image=r,this.scale=o,this.fontStack=c,this.textColor=_,this.verticalAlign=g}}class Zi{constructor(e){this.sections=e}static fromString(e){return new Zi([new oi(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Zi?e:Zi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ii{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ii)return e;if(typeof e=="number")return new ii([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(let r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new ii(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o){return new ii(kn(e.values,r.values,o))}}class Cr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Cr)return e;if(typeof e=="number")return new Cr([e]);if(Array.isArray(e)){for(let r of e)if(typeof r!="number")return;return new Cr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o){return new Cr(kn(e.values,r.values,o))}}class or{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof or)return e;if(typeof e=="string"){let o=di.parse(e);return o?new or([o]):void 0}if(!Array.isArray(e))return;let r=[];for(let o of e){if(typeof o!="string")return;let c=di.parse(o);if(!c)return;r.push(c)}return new or(r)}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o,c="rgb"){let _=[];if(e.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let g=0;g<e.values.length;g++)_.push(di.interpolate(e.values[g],r.values[g],o,c));return new or(_)}}class Fi extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}let jo=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ai{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ai)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){let o=e[r],c=e[r+1];if(typeof o!="string"||!jo.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new ai(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,o){let c=e.values,_=r.values;if(c.length!==_.length)throw new Fi(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${r.toString()}`);let g=[];for(let b=0;b<c.length;b+=2){if(c[b]!==_[b])throw new Fi(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${c[b]}, to[${b}]: ${_[b]}`);g.push(c[b]);let[T,k]=c[b+1],[B,z]=_[b+1];g.push([Yr(T,B,o),Yr(k,z,o)])}return new ai(g)}}class ir{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ir({name:e,available:!1}):null}}class Qe{constructor(e,r,o){this.from=e,this.to=r,this.transition=o}static interpolate(e,r,o){return new Qe(e,r,o)}static parse(e){return e instanceof Qe?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Qe(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Qe(e.from,e.to,e.transition):typeof e=="string"?new Qe(e,e,1):void 0}}function Ve(n,e,r,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,r,o]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function mn(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Qe||n instanceof di||n instanceof so||n instanceof Zi||n instanceof ii||n instanceof Cr||n instanceof or||n instanceof ai||n instanceof ir)return!0;if(Array.isArray(n)){for(let e of n)if(!mn(e))return!1;return!0}if(typeof n=="object"){for(let e in n)if(!mn(n[e]))return!1;return!0}return!1}function He(n){if(n===null)return Os;if(typeof n=="string")return ni;if(typeof n=="boolean")return ui;if(typeof n=="number")return Pe;if(n instanceof di)return pn;if(n instanceof Qe)return La;if(n instanceof so)return ys;if(n instanceof Zi)return Sn;if(n instanceof ii)return Xi;if(n instanceof Cr)return Qo;if(n instanceof or)return Jo;if(n instanceof ai)return ta;if(n instanceof ir)return vs;if(Array.isArray(n)){let e=n.length,r;for(let o of n){let c=He(o);if(r){if(r===c)continue;r=si;break}r=c}return Or(r||si,e)}return ss}function Us(n){let e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof di||n instanceof Qe||n instanceof Zi||n instanceof ii||n instanceof Cr||n instanceof or||n instanceof ai||n instanceof ir?n.toString():JSON.stringify(n)}class Fr{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!mn(e[1]))return r.error("invalid value");let o=e[1],c=He(o),_=r.expectedType;return c.kind!=="array"||c.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(c=_),new Fr(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let oo={string:ni,number:Pe,boolean:ui,object:ss};class Jr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o,c=1,_=e[0];if(_==="array"){let b,T;if(e.length>2){let k=e[1];if(typeof k!="string"||!(k in oo)||k==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);b=oo[k],c++}else b=si;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);T=e[2],c++}o=Or(b,T)}else{if(!oo[_])throw new Error(`Types doesn't contain name = ${_}`);o=oo[_]}let g=[];for(;c<e.length;c++){let b=r.parse(e[c],c,si);if(!b)return null;g.push(b)}return new Jr(o,g)}evaluate(e){for(let r=0;r<this.args.length;r++){let o=this.args[r].evaluate(e);if(!Ro(this.type,He(o)))return o;if(r===this.args.length-1)throw new Fi(`Expected value to be of type ${zi(this.type)}, but found ${zi(He(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}let Wa={"to-boolean":ui,"to-color":pn,"to-number":Pe,"to-string":ni};class Hn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o=e[0];if(!Wa[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return r.error("Expected one argument.");let c=Wa[o],_=[];for(let g=1;g<e.length;g++){let b=r.parse(e[g],g,si);if(!b)return null;_.push(b)}return new Hn(c,_)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,o;for(let c of this.args){if(r=c.evaluate(e),o=null,r instanceof di)return r;if(typeof r=="string"){let _=e.parseColor(r);if(_)return _}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ve(r[0],r[1],r[2],r[3]),!o))return new di(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Fi(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(let o of this.args){r=o.evaluate(e);let c=ii.parse(r);if(c)return c}throw new Fi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(let o of this.args){r=o.evaluate(e);let c=Cr.parse(r);if(c)return c}throw new Fi(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(let o of this.args){r=o.evaluate(e);let c=or.parse(r);if(c)return c}throw new Fi(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(let o of this.args){r=o.evaluate(e);let c=ai.parse(r);if(c)return c}throw new Fi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(let o of this.args){if(r=o.evaluate(e),r===null)return 0;let c=Number(r);if(!isNaN(c))return c}throw new Fi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Zi.fromString(Us(this.args[0].evaluate(e)));case"resolvedImage":return ir.fromString(Us(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Us(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}let vi=["Unknown","Point","LineString","Polygon"];class gl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?vi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache.get(e);return r||(r=di.parse(e),this._parseColorCache.set(e,r)),r}}class Nr{constructor(e,r,o=[],c,_=new $n,g=[]){this.registry=e,this.path=o,this.key=o.map(b=>`[${b}]`).join(""),this.scope=_,this.errors=g,this.expectedType=c,this._isConstant=r}parse(e,r,o,c,_={}){return r?this.concat(r,o,c)._parse(e,_):this._parse(e,_)}_parse(e,r){function o(c,_,g){return g==="assert"?new Jr(_,[c]):g==="coerce"?new Hn(_,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let _=this.registry[c];if(_){let g=_.parse(e,this);if(!g)return null;if(this.expectedType){let b=this.expectedType,T=g.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value"){if(b.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(b.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(b.kind)&&["value","number","array"].includes(T.kind)||b.kind==="colorArray"&&["value","string","array"].includes(T.kind)||b.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))g=o(g,b,r.typeAnnotation||"coerce");else if(this.checkSubtype(b,T))return null}else g=o(g,b,r.typeAnnotation||"assert")}if(!(g instanceof Fr)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){let b=new gl;try{g=new Fr(g.type,g.evaluate(b))}catch(T){return this.error(T.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,o){let c=typeof e=="number"?this.path.concat(e):this.path,_=o?this.scope.concat(o):this.scope;return new Nr(this.registry,this._isConstant,c,r||null,_,this.errors)}error(e,...r){let o=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new Gi(o,e))}checkSubtype(e,r){let o=Ro(e,r);return o&&this.error(o),o}}class ls{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let o=[];for(let _=1;_<e.length-1;_+=2){let g=e[_];if(typeof g!="string")return r.error(`Expected string, but found ${typeof g} instead.`,_);if(/[^a-zA-Z0-9_]/.test(g))return r.error("Variable names must contain only alphanumeric characters or '_'.",_);let b=r.parse(e[_+1],_+1);if(!b)return null;o.push([g,b])}let c=r.parse(e[e.length-1],e.length-1,r.expectedType,o);return c?new ls(o,c):null}outputDefined(){return this.result.outputDefined()}}class li{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let o=e[1];return r.scope.has(o)?new li(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class ar{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=r.parse(e[1],1,Pe),c=r.parse(e[2],2,Or(r.expectedType||si));return o&&c?new ar(c.type.itemType,o,c):null}evaluate(e){let r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new Fi(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new Fi(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new Fi(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Wn{constructor(e,r){this.type=ui,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=r.parse(e[1],1,si),c=r.parse(e[2],2,si);return o&&c?Fs(o.type,[ui,ni,Pe,Os,si])?new Wn(o,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${zi(o.type)} instead`):null}evaluate(e){let r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!yi(r,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${zi(He(r))} instead.`);if(!yi(o,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${zi(He(o))} instead.`);return o.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ra{constructor(e,r,o){this.type=Pe,this.needle=e,this.haystack=r,this.fromIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=r.parse(e[1],1,si),c=r.parse(e[2],2,si);if(!o||!c)return null;if(!Fs(o.type,[ui,ni,Pe,Os,si]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${zi(o.type)} instead`);if(e.length===4){let _=r.parse(e[3],3,Pe);return _?new ra(o,c,_):null}return new ra(o,c)}evaluate(e){let r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!yi(r,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${zi(He(r))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(e)),yi(o,["string"])){let _=o.indexOf(r,c);return _===-1?-1:[...o.slice(0,_)].length}if(yi(o,["array"]))return o.indexOf(r,c);throw new Fi(`Expected second argument to be of type array or string, but found ${zi(He(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class $s{constructor(e,r,o,c,_,g){this.inputType=e,this.type=r,this.input=o,this.cases=c,this.outputs=_,this.otherwise=g}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let o,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);let _={},g=[];for(let k=2;k<e.length-1;k+=2){let B=e[k],z=e[k+1];Array.isArray(B)||(B=[B]);let V=r.concat(k);if(B.length===0)return V.error("Expected at least one branch label.");for(let K of B){if(typeof K!="number"&&typeof K!="string")return V.error("Branch labels must be numbers or strings.");if(typeof K=="number"&&Math.abs(K)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof K=="number"&&Math.floor(K)!==K)return V.error("Numeric branch labels must be integer values.");if(o){if(V.checkSubtype(o,He(K)))return null}else o=He(K);if(_[String(K)]!==void 0)return V.error("Branch labels must be unique.");_[String(K)]=g.length}let H=r.parse(z,k,c);if(!H)return null;c=c||H.type,g.push(H)}let b=r.parse(e[1],1,si);if(!b)return null;let T=r.parse(e[e.length-1],e.length-1,c);return T?b.type.kind!=="value"&&r.concat(1).checkSubtype(o,b.type)?null:new $s(o,c,b,_,g,T):null}evaluate(e){let r=this.input.evaluate(e);return(He(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class lr{constructor(e,r,o){this.type=e,this.branches=r,this.otherwise=o}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);let c=[];for(let g=1;g<e.length-1;g+=2){let b=r.parse(e[g],g,ui);if(!b)return null;let T=r.parse(e[g+1],g+1,o);if(!T)return null;c.push([b,T]),o=o||T.type}let _=r.parse(e[e.length-1],e.length-1,o);if(!_)return null;if(!o)throw new Error("Can't infer output type");return new lr(o,c,_)}evaluate(e){for(let[r,o]of this.branches)if(r.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[r,o]of this.branches)e(r),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ao{constructor(e,r,o,c){this.type=e,this.input=r,this.beginIndex=o,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=r.parse(e[1],1,si),c=r.parse(e[2],2,Pe);if(!o||!c)return null;if(!Fs(o.type,[Or(si),ni,si]))return r.error(`Expected first argument to be of type array or string, but found ${zi(o.type)} instead`);if(e.length===4){let _=r.parse(e[3],3,Pe);return _?new ao(o.type,o,c,_):null}return new ao(o.type,o,c)}evaluate(e){let r=this.input.evaluate(e),o=this.beginIndex.evaluate(e),c;if(this.endIndex&&(c=this.endIndex.evaluate(e)),yi(r,["string"]))return[...r].slice(o,c).join("");if(yi(r,["array"]))return r.slice(o,c);throw new Fi(`Expected first argument to be of type array or string, but found ${zi(He(r))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Kn(n,e){let r=n.length-1,o,c,_=0,g=r,b=0;for(;_<=g;)if(b=Math.floor((_+g)/2),o=n[b],c=n[b+1],o<=e){if(b===r||e<c)return b;_=b+1}else{if(!(o>e))throw new Fi("Input is not a number.");g=b-1}return 0}class Go{constructor(e,r,o){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(let[c,_]of o)this.labels.push(c),this.outputs.push(_)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");let o=r.parse(e[1],1,Pe);if(!o)return null;let c=[],_=null;r.expectedType&&r.expectedType.kind!=="value"&&(_=r.expectedType);for(let g=1;g<e.length;g+=2){let b=g===1?-1/0:e[g],T=e[g+1],k=g,B=g+1;if(typeof b!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(c.length&&c[c.length-1][0]>=b)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);let z=r.parse(T,B,_);if(!z)return null;_=_||z.type,c.push([b,z])}return new Go(_,o,c)}evaluate(e){let r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);let c=this.input.evaluate(e);if(c<=r[0])return o[0].evaluate(e);let _=r.length;return c>=r[_-1]?o[_-1].evaluate(e):o[Kn(r,c)].evaluate(e)}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Mr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var bs,Xn,us=function(){if(Xn)return bs;function n(e,r,o,c){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=o,this.p2y=c}return Xn=1,bs=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,c=0;c<8;c++){var _=this.sampleCurveX(o)-e;if(Math.abs(_)<r)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=_/g}var b=0,T=1;for(o=e,c=0;c<20&&(_=this.sampleCurveX(o),!(Math.abs(_-e)<r));c++)e>_?b=o:T=o,o=.5*(T-b)+b;return o},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},bs}(),yl=Mr(us);class Ar{constructor(e,r,o,c,_){this.type=e,this.operator=r,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(let[g,b]of _)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(e,r,o,c){let _=0;if(e.name==="exponential")_=qs(r,e.base,o,c);else if(e.name==="linear")_=qs(r,1,o,c);else if(e.name==="cubic-bezier"){let g=e.controlPoints;_=new yl(g[0],g[1],g[2],g[3]).solve(qs(r,1,o,c))}return _}static parse(e,r){let[o,c,_,...g]=e;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){let k=c[1];if(typeof k!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:k}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{let k=c.slice(1);if(k.length!==4||k.some(B=>typeof B!="number"||B<0||B>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:k}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(_=r.parse(_,2,Pe),!_)return null;let b=[],T=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||r.expectedType==Jo?r.expectedType&&r.expectedType.kind!=="value"&&(T=r.expectedType):T=pn;for(let k=0;k<g.length;k+=2){let B=g[k],z=g[k+1],V=k+3,H=k+4;if(typeof B!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(b.length&&b[b.length-1][0]>=B)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);let K=r.parse(z,H,T);if(!K)return null;T=T||K.type,b.push([B,K])}return Si(T,Pe)||Si(T,La)||Si(T,pn)||Si(T,Xi)||Si(T,Qo)||Si(T,Jo)||Si(T,ta)||Si(T,Or(Pe))?new Ar(T,o,c,_,b):r.error(`Type ${zi(T)} is not interpolatable.`)}evaluate(e){let r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);let c=this.input.evaluate(e);if(c<=r[0])return o[0].evaluate(e);let _=r.length;if(c>=r[_-1])return o[_-1].evaluate(e);let g=Kn(r,c),b=Ar.interpolationFactor(this.interpolation,c,r[g],r[g+1]),T=o[g].evaluate(e),k=o[g+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Yr(T,k,b);case"color":return di.interpolate(T,k,b);case"padding":return ii.interpolate(T,k,b);case"colorArray":return or.interpolate(T,k,b);case"numberArray":return Cr.interpolate(T,k,b);case"variableAnchorOffsetCollection":return ai.interpolate(T,k,b);case"array":return kn(T,k,b);case"projectionDefinition":return Qe.interpolate(T,k,b)}case"interpolate-hcl":switch(this.type.kind){case"color":return di.interpolate(T,k,b,"hcl");case"colorArray":return or.interpolate(T,k,b,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return di.interpolate(T,k,b,"lab");case"colorArray":return or.interpolate(T,k,b,"lab")}}}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function qs(n,e,r,o){let c=o-r,_=n-r;return c===0?0:e===1?_/c:(Math.pow(e,_)-1)/(Math.pow(e,c)-1)}let _n={color:di.interpolate,number:Yr,padding:ii.interpolate,numberArray:Cr.interpolate,colorArray:or.interpolate,variableAnchorOffsetCollection:ai.interpolate,array:kn};class jr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o=null,c=r.expectedType;c&&c.kind!=="value"&&(o=c);let _=[];for(let b of e.slice(1)){let T=r.parse(b,1+_.length,o,void 0,{typeAnnotation:"omit"});if(!T)return null;o=o||T.type,_.push(T)}if(!o)throw new Error("No output type");let g=c&&_.some(b=>Ro(c,b.type));return new jr(g?si:o,_)}evaluate(e){let r,o=null,c=0;for(let _ of this.args)if(c++,o=_.evaluate(e),o&&o instanceof ir&&!o.available&&(r||(r=o.name),o=null,c===this.args.length&&(o=r)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function Sa(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function na(n,e,r,o){return o.compare(e,r)===0}function lo(n,e,r){let o=n!=="=="&&n!=="!=";return class cf{constructor(_,g,b){this.type=ui,this.lhs=_,this.rhs=g,this.collator=b,this.hasUntypedArgument=_.type.kind==="value"||g.type.kind==="value"}static parse(_,g){if(_.length!==3&&_.length!==4)return g.error("Expected two or three arguments.");let b=_[0],T=g.parse(_[1],1,si);if(!T)return null;if(!Sa(b,T.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${zi(T.type)}'.`);let k=g.parse(_[2],2,si);if(!k)return null;if(!Sa(b,k.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${zi(k.type)}'.`);if(T.type.kind!==k.type.kind&&T.type.kind!=="value"&&k.type.kind!=="value")return g.error(`Cannot compare types '${zi(T.type)}' and '${zi(k.type)}'.`);o&&(T.type.kind==="value"&&k.type.kind!=="value"?T=new Jr(k.type,[T]):T.type.kind!=="value"&&k.type.kind==="value"&&(k=new Jr(T.type,[k])));let B=null;if(_.length===4){if(T.type.kind!=="string"&&k.type.kind!=="string"&&T.type.kind!=="value"&&k.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(B=g.parse(_[3],3,ys),!B)return null}return new cf(T,k,B)}evaluate(_){let g=this.lhs.evaluate(_),b=this.rhs.evaluate(_);if(o&&this.hasUntypedArgument){let T=He(g),k=He(b);if(T.kind!==k.kind||T.kind!=="string"&&T.kind!=="number")throw new Fi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${T.kind}, ${k.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){let T=He(g),k=He(b);if(T.kind!=="string"||k.kind!=="string")return e(_,g,b)}return this.collator?r(_,g,b,this.collator.evaluate(_)):e(_,g,b)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}let sa=lo("==",function(n,e,r){return e===r},na),Lr=lo("!=",function(n,e,r){return e!==r},function(n,e,r,o){return!na(0,e,r,o)}),Ir=lo("<",function(n,e,r){return e<r},function(n,e,r,o){return o.compare(e,r)<0}),Ka=lo(">",function(n,e,r){return e>r},function(n,e,r,o){return o.compare(e,r)>0}),Xa=lo("<=",function(n,e,r){return e<=r},function(n,e,r,o){return o.compare(e,r)<=0}),Gr=lo(">=",function(n,e,r){return e>=r},function(n,e,r,o){return o.compare(e,r)>=0});class ws{constructor(e,r,o){this.type=ys,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");let o=e[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");let c=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,ui);if(!c)return null;let _=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,ui);if(!_)return null;let g=null;return o.locale&&(g=r.parse(o.locale,1,ni),!g)?null:new ws(c,_,g)}evaluate(e){return new so(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class En{constructor(e,r,o,c,_){this.type=ni,this.number=e,this.locale=r,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=_}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");let o=r.parse(e[1],1,Pe);if(!o)return null;let c=e[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let _=null;if(c.locale&&(_=r.parse(c.locale,1,ni),!_))return null;let g=null;if(c.currency&&(g=r.parse(c.currency,1,ni),!g))return null;let b=null;if(c["min-fraction-digits"]&&(b=r.parse(c["min-fraction-digits"],1,Pe),!b))return null;let T=null;return c["max-fraction-digits"]&&(T=r.parse(c["max-fraction-digits"],1,Pe),!T)?null:new En(o,_,g,b,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Yi{constructor(e){this.type=Sn,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o=e[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");let c=[],_=!1;for(let g=1;g<=e.length-1;++g){let b=e[g];if(_&&typeof b=="object"&&!Array.isArray(b)){_=!1;let T=null;if(b["font-scale"]&&(T=r.parse(b["font-scale"],1,Pe),!T))return null;let k=null;if(b["text-font"]&&(k=r.parse(b["text-font"],1,Or(ni)),!k))return null;let B=null;if(b["text-color"]&&(B=r.parse(b["text-color"],1,pn),!B))return null;let z=null;if(b["vertical-align"]){if(typeof b["vertical-align"]=="string"&&!Pa.includes(b["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${b["vertical-align"]}' instead.`);if(z=r.parse(b["vertical-align"],1,ni),!z)return null}let V=c[c.length-1];V.scale=T,V.font=k,V.textColor=B,V.verticalAlign=z}else{let T=r.parse(e[g],1,si);if(!T)return null;let k=T.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,c.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Yi(c)}evaluate(e){return new Zi(this.sections.map(r=>{let o=r.content.evaluate(e);return He(o)===vs?new oi("",o,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new oi(Us(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)}))}eachChild(e){for(let r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor),r.verticalAlign&&e(r.verticalAlign)}outputDefined(){return!1}}class ka{constructor(e){this.type=vs,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");let o=r.parse(e[1],1,ni);return o?new ka(o):r.error("No image name provided.")}evaluate(e){let r=this.input.evaluate(e),o=ir.fromString(r);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(r)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class oa{constructor(e){this.type=Pe,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);let o=r.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${zi(o.type)} instead.`):new oa(o):null}evaluate(e){let r=this.input.evaluate(e);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Fi(`Expected value to be of type string or array, but found ${zi(He(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}let An=8192;function gn(n,e){let r=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*An),Math.round(o*c*An)]}function Zo(n,e){let r=Math.pow(2,e.z);return[(c=(n[0]/An+e.x)/r,360*c-180),(o=(n[1]/An+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,c}function Hs(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function aa(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function In(n,e,r){let o=n[0]-e[0],c=n[1]-e[1],_=n[0]-r[0],g=n[1]-r[1];return o*g-_*c==0&&o*_<=0&&c*g<=0}function Qr(n,e,r,o){return(c=[o[0]-r[0],o[1]-r[1]])[0]*(_=[e[0]-n[0],e[1]-n[1]])[1]-c[1]*_[0]!=0&&!(!Cs(n,e,r,o)||!Cs(r,o,n,e));var c,_}function Zr(n,e,r){for(let o of r)for(let c=0;c<o.length-1;++c)if(Qr(n,e,o[c],o[c+1]))return!0;return!1}function Bn(n,e,r=!1){let o=!1;for(let b of e)for(let T=0;T<b.length-1;T++){if(In(n,b[T],b[T+1]))return r;(_=b[T])[1]>(c=n)[1]!=(g=b[T+1])[1]>c[1]&&c[0]<(g[0]-_[0])*(c[1]-_[1])/(g[1]-_[1])+_[0]&&(o=!o)}var c,_,g;return o}function Ya(n,e){for(let r of e)if(Bn(n,r))return!0;return!1}function tn(n,e){for(let r of n)if(!Bn(r,e))return!1;for(let r=0;r<n.length-1;++r)if(Zr(n[r],n[r+1],e))return!1;return!0}function Bl(n,e){for(let r of e)if(tn(n,r))return!0;return!1}function Cs(n,e,r,o){let c=o[0]-r[0],_=o[1]-r[1],g=(n[0]-r[0])*_-c*(n[1]-r[1]),b=(e[0]-r[0])*_-c*(e[1]-r[1]);return g>0&&b<0||g<0&&b>0}function la(n,e,r){let o=[];for(let c=0;c<n.length;c++){let _=[];for(let g=0;g<n[c].length;g++){let b=gn(n[c][g],r);Hs(e,b),_.push(b)}o.push(_)}return o}function Vo(n,e,r){let o=[];for(let c=0;c<n.length;c++){let _=la(n[c],e,r);o.push(_)}return o}function Ja(n,e,r,o){if(n[0]<r[0]||n[0]>r[2]){let c=.5*o,_=n[0]-r[0]>c?-o:r[0]-n[0]>c?o:0;_===0&&(_=n[0]-r[2]>c?-o:r[2]-n[0]>c?o:0),n[0]+=_}Hs(e,n)}function Uo(n,e,r,o){let c=Math.pow(2,o.z)*An,_=[o.x*An,o.y*An],g=[];for(let b of n)for(let T of b){let k=[T.x+_[0],T.y+_[1]];Ja(k,e,r,c),g.push(k)}return g}function Qa(n,e,r,o){let c=Math.pow(2,o.z)*An,_=[o.x*An,o.y*An],g=[];for(let T of n){let k=[];for(let B of T){let z=[B.x+_[0],B.y+_[1]];Hs(e,z),k.push(z)}g.push(k)}if(e[2]-e[0]<=c/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(let T of g)for(let k of T)Ja(k,e,r,c)}var b;return g}class Br{constructor(e,r){this.type=ui,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(mn(e[1])){let o=e[1];if(o.type==="FeatureCollection"){let c=[];for(let _ of o.features){let{type:g,coordinates:b}=_.geometry;g==="Polygon"&&c.push(b),g==="MultiPolygon"&&c.push(...b)}if(c.length)return new Br(o,{type:"MultiPolygon",coordinates:c})}else if(o.type==="Feature"){let c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Br(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Br(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){let c=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(o.type==="Polygon"){let b=la(o.coordinates,_,g),T=Uo(r.geometry(),c,_,g);if(!aa(c,_))return!1;for(let k of T)if(!Bn(k,b))return!1}if(o.type==="MultiPolygon"){let b=Vo(o.coordinates,_,g),T=Uo(r.geometry(),c,_,g);if(!aa(c,_))return!1;for(let k of T)if(!Ya(k,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){let c=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(o.type==="Polygon"){let b=la(o.coordinates,_,g),T=Qa(r.geometry(),c,_,g);if(!aa(c,_))return!1;for(let k of T)if(!tn(k,b))return!1}if(o.type==="MultiPolygon"){let b=Vo(o.coordinates,_,g),T=Qa(r.geometry(),c,_,g);if(!aa(c,_))return!1;for(let k of T)if(!Bl(k,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ua=class{constructor(n=[],e=(r,o)=>r<o?-1:r>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;let n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){let{data:e,compare:r}=this,o=e[n];for(;n>0;){let c=n-1>>1,_=e[c];if(r(o,_)>=0)break;e[n]=_,n=c}e[n]=o}_down(n){let{data:e,compare:r}=this,o=this.length>>1,c=e[n];for(;n<o;){let _=1+(n<<1),g=_+1;if(g<this.length&&r(e[g],e[_])<0&&(_=g),r(e[_],c)>=0)break;e[n]=e[_],n=_}e[n]=c}};function tl(n,e,r=0,o=n.length-1,c=uo){for(;o>r;){if(o-r>600){let T=o-r+1,k=e-r+1,B=Math.log(T),z=.5*Math.exp(2*B/3),V=.5*Math.sqrt(B*z*(T-z)/T)*(k-T/2<0?-1:1);tl(n,e,Math.max(r,Math.floor(e-k*z/T+V)),Math.min(o,Math.floor(e+(T-k)*z/T+V)),c)}let _=n[e],g=r,b=o;for(Ms(n,r,e),c(n[o],_)>0&&Ms(n,r,o);g<b;){for(Ms(n,g,b),g++,b--;c(n[g],_)<0;)g++;for(;c(n[b],_)>0;)b--}c(n[r],_)===0?Ms(n,r,b):(b++,Ms(n,b,o)),b<=e&&(r=b+1),e<=b&&(o=b-1)}}function Ms(n,e,r){let o=n[e];n[e]=n[r],n[r]=o}function uo(n,e){return n<e?-1:n>e?1:0}function yn(n,e){if(n.length<=1)return[n];let r=[],o,c;for(let _ of n){let g=vn(_);g!==0&&(_.area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(o&&r.push(o),o=[_]):o.push(_))}if(o&&r.push(o),e>1)for(let _=0;_<r.length;_++)r[_].length<=e||(tl(r[_],e,1,r[_].length-1,Dl),r[_]=r[_].slice(0,e));return r}function Dl(n,e){return e.area-n.area}function vn(n){let e=0;for(let r,o,c=0,_=n.length,g=_-1;c<_;g=c++)r=n[c],o=n[g],e+=(o.x-r.x)*(r.y+o.y);return e}let vl=1/298.257223563,hs=vl*(2-vl),ho=Math.PI/180;class Ws{constructor(e){let r=6378.137*ho*1e3,o=Math.cos(e*ho),c=1/(1-hs*(1-o*o)),_=Math.sqrt(c);this.kx=r*_*o,this.ky=r*_*c*(1-hs)}distance(e,r){let o=this.wrap(e[0]-r[0])*this.kx,c=(e[1]-r[1])*this.ky;return Math.sqrt(o*o+c*c)}pointOnLine(e,r){let o,c,_,g,b=1/0;for(let T=0;T<e.length-1;T++){let k=e[T][0],B=e[T][1],z=this.wrap(e[T+1][0]-k)*this.kx,V=(e[T+1][1]-B)*this.ky,H=0;z===0&&V===0||(H=(this.wrap(r[0]-k)*this.kx*z+(r[1]-B)*this.ky*V)/(z*z+V*V),H>1?(k=e[T+1][0],B=e[T+1][1]):H>0&&(k+=z/this.kx*H,B+=V/this.ky*H)),z=this.wrap(r[0]-k)*this.kx,V=(r[1]-B)*this.ky;let K=z*z+V*V;K<b&&(b=K,o=k,c=B,_=T,g=H)}return{point:[o,c],index:_,t:Math.max(0,Math.min(1,g))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Ci(n,e){return e[0]-n[0]}function co(n){return n[1]-n[0]+1}function Yn(n,e){return n[1]>=n[0]&&n[1]<e}function po(n,e){if(n[0]>n[1])return[null,null];let r=co(n);if(e){if(r===2)return[n,null];let c=Math.floor(r/2);return[[n[0],n[0]+c],[n[0]+c,n[1]]]}if(r===1)return[n,null];let o=Math.floor(r/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function Ks(n,e){if(!Yn(e,n.length))return[1/0,1/0,-1/0,-1/0];let r=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Hs(r,n[o]);return r}function fo(n){let e=[1/0,1/0,-1/0,-1/0];for(let r of n)for(let o of r)Hs(e,o);return e}function Ea(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Aa(n,e,r){if(!Ea(n)||!Ea(e))return NaN;let o=0,c=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(c=n[1]-e[3]),n[3]<e[1]&&(c=e[1]-n[3]),r.distance([0,0],[o,c])}function mo(n,e,r){let o=r.pointOnLine(e,n);return r.distance(n,o.point)}function _o(n,e,r,o,c){let _=Math.min(mo(n,[r,o],c),mo(e,[r,o],c)),g=Math.min(mo(r,[n,e],c),mo(o,[n,e],c));return Math.min(_,g)}function el(n,e,r,o,c){if(!Yn(e,n.length)||!Yn(o,r.length))return 1/0;let _=1/0;for(let g=e[0];g<e[1];++g){let b=n[g],T=n[g+1];for(let k=o[0];k<o[1];++k){let B=r[k],z=r[k+1];if(Qr(b,T,B,z))return 0;_=Math.min(_,_o(b,T,B,z,c))}}return _}function il(n,e,r,o,c){if(!Yn(e,n.length)||!Yn(o,r.length))return NaN;let _=1/0;for(let g=e[0];g<=e[1];++g)for(let b=o[0];b<=o[1];++b)if(_=Math.min(_,c.distance(n[g],r[b])),_===0)return _;return _}function rl(n,e,r){if(Bn(n,e,!0))return 0;let o=1/0;for(let c of e){let _=c[0],g=c[c.length-1];if(_!==g&&(o=Math.min(o,mo(n,[g,_],r)),o===0))return o;let b=r.pointOnLine(c,n);if(o=Math.min(o,r.distance(n,b.point)),o===0)return o}return o}function xl(n,e,r,o){if(!Yn(e,n.length))return NaN;for(let _=e[0];_<=e[1];++_)if(Bn(n[_],r,!0))return 0;let c=1/0;for(let _=e[0];_<e[1];++_){let g=n[_],b=n[_+1];for(let T of r)for(let k=0,B=T.length,z=B-1;k<B;z=k++){let V=T[z],H=T[k];if(Qr(g,b,V,H))return 0;c=Math.min(c,_o(g,b,V,H,o))}}return c}function ha(n,e){for(let r of n)for(let o of r)if(Bn(o,e,!0))return!0;return!1}function Jn(n,e,r,o=1/0){let c=fo(n),_=fo(e);if(o!==1/0&&Aa(c,_,r)>=o)return o;if(aa(c,_)){if(ha(n,e))return 0}else if(ha(e,n))return 0;let g=1/0;for(let b of n)for(let T=0,k=b.length,B=k-1;T<k;B=T++){let z=b[B],V=b[T];for(let H of e)for(let K=0,Y=H.length,at=Y-1;K<Y;at=K++){let ft=H[at],zt=H[K];if(Qr(z,V,ft,zt))return 0;g=Math.min(g,_o(z,V,ft,zt,r))}}return g}function ca(n,e,r,o,c,_){if(!_)return;let g=Aa(Ks(o,_),c,r);g<e&&n.push([g,_,[0,0]])}function Ia(n,e,r,o,c,_,g){if(!_||!g)return;let b=Aa(Ks(o,_),Ks(c,g),r);b<e&&n.push([b,_,g])}function go(n,e,r,o,c=1/0){let _=Math.min(o.distance(n[0],r[0][0]),c);if(_===0)return _;let g=new ua([[0,[0,n.length-1],[0,0]]],Ci),b=fo(r);for(;g.length>0;){let T=g.pop();if(T[0]>=_)continue;let k=T[1],B=e?50:100;if(co(k)<=B){if(!Yn(k,n.length))return NaN;if(e){let z=xl(n,k,r,o);if(isNaN(z)||z===0)return z;_=Math.min(_,z)}else for(let z=k[0];z<=k[1];++z){let V=rl(n[z],r,o);if(_=Math.min(_,V),_===0)return 0}}else{let z=po(k,e);ca(g,_,o,n,b,z[0]),ca(g,_,o,n,b,z[1])}}return _}function Xs(n,e,r,o,c,_=1/0){let g=Math.min(_,c.distance(n[0],r[0]));if(g===0)return g;let b=new ua([[0,[0,n.length-1],[0,r.length-1]]],Ci);for(;b.length>0;){let T=b.pop();if(T[0]>=g)continue;let k=T[1],B=T[2],z=e?50:100,V=o?50:100;if(co(k)<=z&&co(B)<=V){if(!Yn(k,n.length)&&Yn(B,r.length))return NaN;let H;if(e&&o)H=el(n,k,r,B,c),g=Math.min(g,H);else if(e&&!o){let K=n.slice(k[0],k[1]+1);for(let Y=B[0];Y<=B[1];++Y)if(H=mo(r[Y],K,c),g=Math.min(g,H),g===0)return g}else if(!e&&o){let K=r.slice(B[0],B[1]+1);for(let Y=k[0];Y<=k[1];++Y)if(H=mo(n[Y],K,c),g=Math.min(g,H),g===0)return g}else H=il(n,k,r,B,c),g=Math.min(g,H)}else{let H=po(k,e),K=po(B,o);Ia(b,g,c,n,r,H[0],K[0]),Ia(b,g,c,n,r,H[0],K[1]),Ia(b,g,c,n,r,H[1],K[0]),Ia(b,g,c,n,r,H[1],K[1])}}return g}function Ba(n){return n.type==="MultiPolygon"?n.coordinates.map(e=>({type:"Polygon",coordinates:e})):n.type==="MultiLineString"?n.coordinates.map(e=>({type:"LineString",coordinates:e})):n.type==="MultiPoint"?n.coordinates.map(e=>({type:"Point",coordinates:e})):[n]}class yo{constructor(e,r){this.type=Pe,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(mn(e[1])){let o=e[1];if(o.type==="FeatureCollection")return new yo(o,o.features.map(c=>Ba(c.geometry)).flat());if(o.type==="Feature")return new yo(o,Ba(o.geometry));if("type"in o&&"coordinates"in o)return new yo(o,Ba(o))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){let c=r.geometry(),_=c.flat().map(T=>Zo([T.x,T.y],r.canonical));if(c.length===0)return NaN;let g=new Ws(_[0][1]),b=1/0;for(let T of o){switch(T.type){case"Point":b=Math.min(b,Xs(_,!1,[T.coordinates],!1,g,b));break;case"LineString":b=Math.min(b,Xs(_,!1,T.coordinates,!0,g,b));break;case"Polygon":b=Math.min(b,go(_,!1,T.coordinates,g,b))}if(b===0)return b}return b}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){let c=r.geometry(),_=c.flat().map(T=>Zo([T.x,T.y],r.canonical));if(c.length===0)return NaN;let g=new Ws(_[0][1]),b=1/0;for(let T of o){switch(T.type){case"Point":b=Math.min(b,Xs(_,!0,[T.coordinates],!1,g,b));break;case"LineString":b=Math.min(b,Xs(_,!0,T.coordinates,!0,g,b));break;case"Polygon":b=Math.min(b,go(_,!0,T.coordinates,g,b))}if(b===0)return b}return b}(e,this.geometries);if(e.geometryType()==="Polygon")return function(r,o){let c=r.geometry();if(c.length===0||c[0].length===0)return NaN;let _=yn(c,0).map(T=>T.map(k=>k.map(B=>Zo([B.x,B.y],r.canonical)))),g=new Ws(_[0][0][0][1]),b=1/0;for(let T of o)for(let k of _){switch(T.type){case"Point":b=Math.min(b,go([T.coordinates],!1,k,g,b));break;case"LineString":b=Math.min(b,go(T.coordinates,!0,k,g,b));break;case"Polygon":b=Math.min(b,Jn(k,T.coordinates,g,b))}if(b===0)return b}return b}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ls{constructor(e){this.type=si,this.key=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);let o=e[1];return o==null?r.error("Global state property must be defined."):typeof o!="string"?r.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Ls(o)}evaluate(e){var r;let o=(r=e.globals)===null||r===void 0?void 0:r.globalState;return o&&Object.keys(o).length!==0?ci(o,this.key):null}eachChild(){}outputDefined(){return!1}}let $o={"==":sa,"!=":Lr,">":Ka,"<":Ir,">=":Gr,"<=":Xa,array:Jr,at:ar,boolean:Jr,case:lr,coalesce:jr,collator:ws,format:Yi,image:ka,in:Wn,"index-of":ra,interpolate:Ar,"interpolate-hcl":Ar,"interpolate-lab":Ar,length:oa,let:ls,literal:Fr,match:$s,number:Jr,"number-format":En,object:Jr,slice:ao,step:Go,string:Jr,"to-boolean":Hn,"to-color":Hn,"to-number":Hn,"to-string":Hn,var:li,within:Br,distance:yo,"global-state":Ls};class Tr{constructor(e,r,o,c){this.name=e,this.type=r,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){let o=e[0],c=Tr.definitions[o];if(!c)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);let _=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,b=g.filter(([k])=>!Array.isArray(k)||k.length===e.length-1),T=null;for(let[k,B]of b){T=new Nr(r.registry,vo,r.path,null,r.scope);let z=[],V=!1;for(let H=1;H<e.length;H++){let K=e[H],Y=Array.isArray(k)?k[H-1]:k.type,at=T.parse(K,1+z.length,Y);if(!at){V=!0;break}z.push(at)}if(!V)if(Array.isArray(k)&&k.length!==z.length)T.error(`Expected ${k.length} arguments, but found ${z.length} instead.`);else{for(let H=0;H<z.length;H++){let K=Array.isArray(k)?k[H]:k.type,Y=z[H];T.concat(H+1).checkSubtype(K,Y.type)}if(T.errors.length===0)return new Tr(o,_,B,z)}}if(b.length===1)r.errors.push(...T.errors);else{let k=(b.length?b:g).map(([z])=>{return V=z,Array.isArray(V)?`(${V.map(zi).join(", ")})`:`(${zi(V.type)}...)`;var V}).join(" | "),B=[];for(let z=1;z<e.length;z++){let V=r.parse(e[z],1+B.length);if(!V)return null;B.push(zi(V.type))}r.error(`Expected arguments of type ${k}, but found (${B.join(", ")}) instead.`)}return null}static register(e,r){Tr.definitions=r;for(let o in r)e[o]=Tr}}function nl(n,[e,r,o,c]){e=e.evaluate(n),r=r.evaluate(n),o=o.evaluate(n);let _=c?c.evaluate(n):1,g=Ve(e,r,o,_);if(g)throw new Fi(g);return new di(e/255,r/255,o/255,_,!1)}function sl(n,e){return n in e}function ol(n,e){let r=e[n];return r===void 0?null:r}function Dr(n){return{type:n}}function vo(n){if(n instanceof li)return vo(n.boundExpression);if(n instanceof Tr&&n.name==="error"||n instanceof ws||n instanceof Br||n instanceof yo||n instanceof Ls)return!1;let e=n instanceof Hn||n instanceof Jr,r=!0;return n.eachChild(o=>{r=e?r&&vo(o):r&&o instanceof Fr}),!!r&&pa(n)&&xo(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function pa(n){if(n instanceof Tr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Br||n instanceof yo)return!1;let e=!0;return n.eachChild(r=>{e&&!pa(r)&&(e=!1)}),e}function Ts(n){if(n instanceof Tr&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(r=>{e&&!Ts(r)&&(e=!1)}),e}function xo(n,e){if(n instanceof Tr&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(o=>{r&&!xo(o,e)&&(r=!1)}),r}function bo(n){return{result:"success",value:n}}function cs(n){return{result:"error",value:n}}function wo(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function qo(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function en(n){return!!n.expression&&n.expression.interpolated}function Ke(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Ps(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&He(n)===ss}function xn(n){return n}function ri(n,e){let r=n.stops&&typeof n.stops[0][0]=="object",o=r||!(r||n.property!==void 0),c=n.type||(en(e)?"exponential":"interval"),_=function(B){switch(B.type){case"color":return di.parse;case"padding":return ii.parse;case"numberArray":return Cr.parse;case"colorArray":return or.parse;default:return null}}(e);if(_&&((n=vr({},n)).stops&&(n.stops=n.stops.map(B=>[B[0],_(B[1])])),n.default=_(n.default?n.default:e.default)),n.colorSpace&&(g=n.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var g;let b=function(B){switch(B){case"exponential":return ur;case"interval":return Ss;case"categorical":return al;case"identity":return ll;default:throw new Error(`Unknown function type "${B}"`)}}(c),T,k;if(c==="categorical"){T=Object.create(null);for(let B of n.stops)T[B[0]]=B[1];k=typeof n.stops[0][0]}if(r){let B={},z=[];for(let K=0;K<n.stops.length;K++){let Y=n.stops[K],at=Y[0].zoom;B[at]===void 0&&(B[at]={zoom:at,type:n.type,property:n.property,default:n.default,stops:[]},z.push(at)),B[at].stops.push([Y[0].value,Y[1]])}let V=[];for(let K of z)V.push([B[K].zoom,ri(B[K],e)]);let H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:Ar.interpolationFactor.bind(void 0,H),zoomStops:V.map(K=>K[0]),evaluate:({zoom:K},Y)=>ur({stops:V,base:n.base},e,K).evaluate(K,Y)}}if(o){let B=c==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:B,interpolationFactor:Ar.interpolationFactor.bind(void 0,B),zoomStops:n.stops.map(z=>z[0]),evaluate:({zoom:z})=>b(n,e,z,T,k)}}return{kind:"source",evaluate(B,z){let V=z&&z.properties?z.properties[n.property]:void 0;return V===void 0?Ys(n.default,e.default):b(n,e,V,T,k)}}}function Ys(n,e,r){return n!==void 0?n:e!==void 0?e:r!==void 0?r:void 0}function al(n,e,r,o,c){return Ys(typeof r===c?o[r]:void 0,n.default,e.default)}function Ss(n,e,r){if(Ke(r)!=="number")return Ys(n.default,e.default);let o=n.stops.length;if(o===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[o-1][0])return n.stops[o-1][1];let c=Kn(n.stops.map(_=>_[0]),r);return n.stops[c][1]}function ur(n,e,r){let o=n.base!==void 0?n.base:1;if(Ke(r)!=="number")return Ys(n.default,e.default);let c=n.stops.length;if(c===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[c-1][0])return n.stops[c-1][1];let _=Kn(n.stops.map(B=>B[0]),r),g=function(B,z,V,H){let K=H-V,Y=B-V;return K===0?0:z===1?Y/K:(Math.pow(z,Y)-1)/(Math.pow(z,K)-1)}(r,o,n.stops[_][0],n.stops[_+1][0]),b=n.stops[_][1],T=n.stops[_+1][1],k=_n[e.type]||xn;return typeof b.evaluate=="function"?{evaluate(...B){let z=b.evaluate.apply(void 0,B),V=T.evaluate.apply(void 0,B);if(z!==void 0&&V!==void 0)return k(z,V,g,n.colorSpace)}}:k(b,T,g,n.colorSpace)}function ll(n,e,r){switch(e.type){case"color":r=di.parse(r);break;case"formatted":r=Zi.fromString(r.toString());break;case"resolvedImage":r=ir.fromString(r.toString());break;case"padding":r=ii.parse(r);break;case"colorArray":r=or.parse(r);break;case"numberArray":r=Cr.parse(r);break;default:Ke(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Ys(r,n.default,e.default)}Tr.register($o,{error:[{kind:"error"},[ni],(n,[e])=>{throw new Fi(e.evaluate(n))}],typeof:[ni,[si],(n,[e])=>zi(He(e.evaluate(n)))],"to-rgba":[Or(Pe,4),[pn],(n,[e])=>{let[r,o,c,_]=e.evaluate(n).rgb;return[255*r,255*o,255*c,_]}],rgb:[pn,[Pe,Pe,Pe],nl],rgba:[pn,[Pe,Pe,Pe,Pe],nl],has:{type:ui,overloads:[[[ni],(n,[e])=>sl(e.evaluate(n),n.properties())],[[ni,ss],(n,[e,r])=>sl(e.evaluate(n),r.evaluate(n))]]},get:{type:si,overloads:[[[ni],(n,[e])=>ol(e.evaluate(n),n.properties())],[[ni,ss],(n,[e,r])=>ol(e.evaluate(n),r.evaluate(n))]]},"feature-state":[si,[ni],(n,[e])=>ol(e.evaluate(n),n.featureState||{})],properties:[ss,[],n=>n.properties()],"geometry-type":[ni,[],n=>n.geometryType()],id:[si,[],n=>n.id()],zoom:[Pe,[],n=>n.globals.zoom],"heatmap-density":[Pe,[],n=>n.globals.heatmapDensity||0],elevation:[Pe,[],n=>n.globals.elevation||0],"line-progress":[Pe,[],n=>n.globals.lineProgress||0],accumulated:[si,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Pe,Dr(Pe),(n,e)=>{let r=0;for(let o of e)r+=o.evaluate(n);return r}],"*":[Pe,Dr(Pe),(n,e)=>{let r=1;for(let o of e)r*=o.evaluate(n);return r}],"-":{type:Pe,overloads:[[[Pe,Pe],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[Pe],(n,[e])=>-e.evaluate(n)]]},"/":[Pe,[Pe,Pe],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[Pe,[Pe,Pe],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[Pe,[],()=>Math.LN2],pi:[Pe,[],()=>Math.PI],e:[Pe,[],()=>Math.E],"^":[Pe,[Pe,Pe],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[Pe,[Pe],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Pe,[Pe],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Pe,[Pe],(n,[e])=>Math.log(e.evaluate(n))],log2:[Pe,[Pe],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Pe,[Pe],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Pe,[Pe],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Pe,[Pe],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Pe,[Pe],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Pe,[Pe],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Pe,[Pe],(n,[e])=>Math.atan(e.evaluate(n))],min:[Pe,Dr(Pe),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[Pe,Dr(Pe),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[Pe,[Pe],(n,[e])=>Math.abs(e.evaluate(n))],round:[Pe,[Pe],(n,[e])=>{let r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Pe,[Pe],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Pe,[Pe],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[ui,[ni,si],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[ui,[si],(n,[e])=>n.id()===e.value],"filter-type-==":[ui,[ni],(n,[e])=>n.geometryType()===e.value],"filter-<":[ui,[ni,si],(n,[e,r])=>{let o=n.properties()[e.value],c=r.value;return typeof o==typeof c&&o<c}],"filter-id-<":[ui,[si],(n,[e])=>{let r=n.id(),o=e.value;return typeof r==typeof o&&r<o}],"filter->":[ui,[ni,si],(n,[e,r])=>{let o=n.properties()[e.value],c=r.value;return typeof o==typeof c&&o>c}],"filter-id->":[ui,[si],(n,[e])=>{let r=n.id(),o=e.value;return typeof r==typeof o&&r>o}],"filter-<=":[ui,[ni,si],(n,[e,r])=>{let o=n.properties()[e.value],c=r.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[ui,[si],(n,[e])=>{let r=n.id(),o=e.value;return typeof r==typeof o&&r<=o}],"filter->=":[ui,[ni,si],(n,[e,r])=>{let o=n.properties()[e.value],c=r.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[ui,[si],(n,[e])=>{let r=n.id(),o=e.value;return typeof r==typeof o&&r>=o}],"filter-has":[ui,[si],(n,[e])=>e.value in n.properties()],"filter-has-id":[ui,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[ui,[Or(ni)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[ui,[Or(si)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[ui,[ni,Or(si)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[ui,[ni,Or(si)],(n,[e,r])=>function(o,c,_,g){for(;_<=g;){let b=_+g>>1;if(c[b]===o)return!0;c[b]>o?g=b-1:_=b+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ui,overloads:[[[ui,ui],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[Dr(ui),(n,e)=>{for(let r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:ui,overloads:[[[ui,ui],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[Dr(ui),(n,e)=>{for(let r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[ui,[ui],(n,[e])=>!e.evaluate(n)],"is-supported-script":[ui,[ni],(n,[e])=>{let r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[ni,[ni],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[ni,[ni],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[ni,Dr(si),(n,e)=>e.map(r=>Us(r.evaluate(n))).join("")],"resolved-locale":[ni,[ys],(n,[e])=>e.evaluate(n).resolvedLocale()]});class s{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new gl,this._defaultValue=r?function(o){if(o.type==="color"&&Ps(o.default))return new di(0,0,0,0);switch(o.type){case"color":return di.parse(o.default)||null;case"padding":return ii.parse(o.default)||null;case"numberArray":return Cr.parse(o.default)||null;case"colorArray":return or.parse(o.default)||null;case"variableAnchorOffsetCollection":return ai.parse(o.default)||null;case"projectionDefinition":return Qe.parse(o.default)||null;default:return o.default===void 0?null:o.default}}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,o,c,_,g){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,r,o,c,_,g){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=g||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function f(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in $o}function w(n,e){let r=new Nr($o,vo,[],e?function(c){let _={color:pn,string:ni,number:Pe,enum:ni,boolean:ui,formatted:Sn,padding:Xi,numberArray:Qo,colorArray:Jo,projectionDefinition:La,resolvedImage:vs,variableAnchorOffsetCollection:ta};return c.type==="array"?Or(_[c.value]||si,c.length):_[c.type]}(e):void 0),o=r.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?bo(new s(o,e)):cs(r.errors)}class E{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Ts(r.expression),this.globalStateRefs=le(r.expression)}evaluateWithoutErrorHandling(e,r,o,c,_,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,c,_,g)}evaluate(e,r,o,c,_,g){return this._styleExpression.evaluate(e,r,o,c,_,g)}}class N{constructor(e,r,o,c){this.kind=e,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Ts(r.expression),this.globalStateRefs=le(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,r,o,c,_,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,c,_,g)}evaluate(e,r,o,c,_,g){return this._styleExpression.evaluate(e,r,o,c,_,g)}interpolationFactor(e,r,o){return this.interpolationType?Ar.interpolationFactor(this.interpolationType,e,r,o):0}}function it(n,e){let r=w(n,e);if(r.result==="error")return r;let o=r.value.expression,c=pa(o);if(!c&&!wo(e))return cs([new Gi("","data expressions not supported")]);let _=xo(o,["zoom"]);if(!_&&!qo(e))return cs([new Gi("","zoom expressions not supported")]);let g=Xt(o);return g||_?g instanceof Gi?cs([g]):g instanceof Ar&&!en(e)?cs([new Gi("",'"interpolate" expressions cannot be used with this property')]):bo(g?new N(c?"camera":"composite",r.value,g.labels,g instanceof Ar?g.interpolation:void 0):new E(c?"constant":"source",r.value)):cs([new Gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Pt{constructor(e,r){this._parameters=e,this._specification=r,vr(this,ri(this._parameters,this._specification))}static deserialize(e){return new Pt(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Xt(n){let e=null;if(n instanceof ls)e=Xt(n.result);else if(n instanceof jr){for(let r of n.args)if(e=Xt(r),e)break}else(n instanceof Go||n instanceof Ar)&&n.input instanceof Tr&&n.input.name==="zoom"&&(e=n);return e instanceof Gi||n.eachChild(r=>{let o=Xt(r);o instanceof Gi?e=o:!e&&o?e=new Gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Gi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function le(n,e=new Set){return n instanceof Ls&&e.add(n.key),n.eachChild(r=>{le(r,e)}),e}function Ce(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(let e of n.slice(1))if(!Ce(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}let ze={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function qe(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ce(n)||(n=rr(n));let e=w(n,ze);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,c)=>e.value.evaluate(r,o,{},c),needGeometry:Pr(n),getGlobalStateRefs:()=>le(e.value.expression)}}function fi(n,e){return n<e?-1:n>e?1:0}function Pr(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Pr(n[e]))return!0;return!1}function rr(n){if(!n)return!0;let e=n[0];return n.length<=1?e!=="any":e==="=="?rn(n[1],n[2],"=="):e==="!="?Mo(rn(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?rn(n[1],n[2],e):e==="any"?(r=n.slice(1),["any"].concat(r.map(rr))):e==="all"?["all"].concat(n.slice(1).map(rr)):e==="none"?["all"].concat(n.slice(1).map(rr).map(Mo)):e==="in"?Vr(n[1],n.slice(2)):e==="!in"?Mo(Vr(n[1],n.slice(2))):e==="has"?Co(n[1]):e!=="!has"||Mo(Co(n[1]));var r}function rn(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function Vr(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort(fi)]]:["filter-in-small",n,["literal",e]]}}function Co(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Mo(n){return["!",n]}function Dn(n){let e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let c="[";for(let _ of n)c+=`${Dn(_)},`;return`${c}]`}let r=Object.keys(n).sort(),o="{";for(let c=0;c<r.length;c++)o+=`${JSON.stringify(r[c])}:${Dn(n[r[c]])},`;return`${o}}`}function Js(n){let e="";for(let r of Ie)e+=`/${Dn(n[r])}`;return e}function da(n){let e=n.value;return e?[new Le(n.key,e,"constants have been deprecated as of v8")]:[]}function Ni(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function ps(n){if(Array.isArray(n))return n.map(ps);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){let e={};for(let r in n)e[r]=ps(n[r]);return e}return Ni(n)}function Pi(n){let e=n.key,r=n.value,o=n.valueSpec||{},c=n.objectElementValidators||{},_=n.style,g=n.styleSpec,b=n.validateSpec,T=[],k=Ke(r);if(k!=="object")return[new Le(e,r,`object expected, ${k} found`)];for(let B in r){let z=B.split(".")[0],V=ci(o,z)||o["*"],H;if(ci(c,z))H=c[z];else if(ci(o,z))H=b;else if(c["*"])H=c["*"];else{if(!o["*"]){T.push(new Le(e,r[B],`unknown property "${B}"`));continue}H=b}T=T.concat(H({key:(e&&`${e}.`)+B,value:r[B],valueSpec:V,style:_,styleSpec:g,object:r,objectKey:B,validateSpec:b},r))}for(let B in o)c[B]||o[B].required&&o[B].default===void 0&&r[B]===void 0&&T.push(new Le(e,r,`missing required property "${B}"`));return T}function Lo(n){let e=n.value,r=n.valueSpec,o=n.style,c=n.styleSpec,_=n.key,g=n.arrayElementValidator||n.validateSpec;if(Ke(e)!=="array")return[new Le(_,e,`array expected, ${Ke(e)} found`)];if(r.length&&e.length!==r.length)return[new Le(_,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Le(_,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let b={type:r.value,values:r.values};c.$version<7&&(b.function=r.function),Ke(r.value)==="object"&&(b=r.value);let T=[];for(let k=0;k<e.length;k++)T=T.concat(g({array:e,arrayIndex:k,value:e[k],valueSpec:b,validateSpec:n.validateSpec,style:o,styleSpec:c,key:`${_}[${k}]`}));return T}function fa(n){let e=n.key,r=n.value,o=n.valueSpec,c=Ke(r);return c==="number"&&r!=r&&(c="NaN"),c!=="number"?[new Le(e,r,`number expected, ${c} found`)]:"minimum"in o&&r<o.minimum?[new Le(e,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new Le(e,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function To(n){let e=n.valueSpec,r=Ni(n.value.type),o,c,_,g={},b=r!=="categorical"&&n.value.property===void 0,T=!b,k=Ke(n.value.stops)==="array"&&Ke(n.value.stops[0])==="array"&&Ke(n.value.stops[0][0])==="object",B=Pi({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(H){if(r==="identity")return[new Le(H.key,H.value,'identity function may not have a "stops" property')];let K=[],Y=H.value;return K=K.concat(Lo({key:H.key,value:Y,valueSpec:H.valueSpec,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:z})),Ke(Y)==="array"&&Y.length===0&&K.push(new Le(H.key,Y,"array must have at least one stop")),K},default:function(H){return H.validateSpec({key:H.key,value:H.value,valueSpec:e,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec})}}});return r==="identity"&&b&&B.push(new Le(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||B.push(new Le(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!en(n.valueSpec)&&B.push(new Le(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(T&&!wo(n.valueSpec)?B.push(new Le(n.key,n.value,"property functions not supported")):b&&!qo(n.valueSpec)&&B.push(new Le(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!k||n.value.property!==void 0||B.push(new Le(n.key,n.value,'"property" property is required')),B;function z(H){let K=[],Y=H.value,at=H.key;if(Ke(Y)!=="array")return[new Le(at,Y,`array expected, ${Ke(Y)} found`)];if(Y.length!==2)return[new Le(at,Y,`array length 2 expected, length ${Y.length} found`)];if(k){if(Ke(Y[0])!=="object")return[new Le(at,Y,`object expected, ${Ke(Y[0])} found`)];if(Y[0].zoom===void 0)return[new Le(at,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new Le(at,Y,"object stop key must have value")];if(_&&_>Ni(Y[0].zoom))return[new Le(at,Y[0].zoom,"stop zoom values must appear in ascending order")];Ni(Y[0].zoom)!==_&&(_=Ni(Y[0].zoom),c=void 0,g={}),K=K.concat(Pi({key:`${at}[0]`,value:Y[0],valueSpec:{zoom:{}},validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:fa,value:V}}))}else K=K.concat(V({key:`${at}[0]`,value:Y[0],validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec},Y));return f(ps(Y[1]))?K.concat([new Le(`${at}[1]`,Y[1],"expressions are not allowed in function stops.")]):K.concat(H.validateSpec({key:`${at}[1]`,value:Y[1],valueSpec:e,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec}))}function V(H,K){let Y=Ke(H.value),at=Ni(H.value),ft=H.value!==null?H.value:K;if(o){if(Y!==o)return[new Le(H.key,ft,`${Y} stop domain type must match previous stop domain type ${o}`)]}else o=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean")return[new Le(H.key,ft,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&r!=="categorical"){let zt=`number expected, ${Y} found`;return wo(e)&&r===void 0&&(zt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Le(H.key,ft,zt)]}return r!=="categorical"||Y!=="number"||isFinite(at)&&Math.floor(at)===at?r!=="categorical"&&Y==="number"&&c!==void 0&&at<c?[new Le(H.key,ft,"stop domain values must appear in ascending order")]:(c=at,r==="categorical"&&at in g?[new Le(H.key,ft,"stop domain values must be unique")]:(g[at]=!0,[])):[new Le(H.key,ft,`integer expected, found ${at}`)]}}function Po(n){let e=(n.expressionContext==="property"?it:w)(ps(n.value),n.valueSpec);if(e.result==="error")return e.value.map(o=>new Le(`${n.key}${o.key}`,n.value,o.message));let r=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new Le(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Ts(r))return[new Le(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Ts(r))return[new Le(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!xo(r,["zoom","feature-state"]))return[new Le(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!pa(r))return[new Le(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ma(n){let e=n.key,r=n.value,o=Ke(r);return o!=="string"?[new Le(e,r,`color expected, ${o} found`)]:di.parse(String(r))?[]:[new Le(e,r,`color expected, "${r}" found`)]}function Ur(n){let e=n.key,r=n.value,o=n.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(Ni(r))===-1&&c.push(new Le(e,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(Ni(r))===-1&&c.push(new Le(e,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function ul(n){return Ce(ps(n.value))?Po(vr({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):hl(n)}function hl(n){let e=n.value,r=n.key;if(Ke(e)!=="array")return[new Le(r,e,`array expected, ${Ke(e)} found`)];let o=n.styleSpec,c,_=[];if(e.length<1)return[new Le(r,e,"filter array must have at least 1 element")];switch(_=_.concat(Ur({key:`${r}[0]`,value:e[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),Ni(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ni(e[1])==="$type"&&_.push(new Le(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&_.push(new Le(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Ke(e[1]),c!=="string"&&_.push(new Le(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let g=2;g<e.length;g++)c=Ke(e[g]),Ni(e[1])==="$type"?_=_.concat(Ur({key:`${r}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&_.push(new Le(`${r}[${g}]`,e[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)_=_.concat(hl({key:`${r}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":c=Ke(e[1]),e.length!==2?_.push(new Le(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&_.push(new Le(`${r}[1]`,e[1],`string expected, ${c} found`))}return _}function zl(n,e){let r=n.key,o=n.validateSpec,c=n.style,_=n.styleSpec,g=n.value,b=n.objectKey,T=_[`${e}_${n.layerType}`];if(!T)return[];let k=b.match(/^(.*)-transition$/);if(e==="paint"&&k&&T[k[1]]&&T[k[1]].transition)return o({key:r,value:g,valueSpec:_.transition,style:c,styleSpec:_});let B=n.valueSpec||T[b];if(!B)return[new Le(r,g,`unknown property "${b}"`)];let z;if(Ke(g)==="string"&&wo(B)&&!B.tokens&&(z=/^{([^}]+)}$/.exec(g)))return[new Le(r,g,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];let V=[];return n.layerType==="symbol"&&(b==="text-field"&&c&&!c.glyphs&&V.push(new Le(r,g,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Ps(ps(g))&&Ni(g.type)==="identity"&&V.push(new Le(r,g,'"text-font" does not support identity functions'))),V.concat(o({key:n.key,value:g,valueSpec:B,style:c,styleSpec:_,expressionContext:"property",propertyType:e,propertyKey:b}))}function Da(n){return zl(n,"paint")}function _a(n){return zl(n,"layout")}function zn(n){let e=[],r=n.value,o=n.key,c=n.style,_=n.styleSpec;if(Ke(r)!=="object")return[new Le(o,r,`object expected, ${Ke(r)} found`)];r.type||r.ref||e.push(new Le(o,r,'either "type" or "ref" is required'));let g=Ni(r.type),b=Ni(r.ref);if(r.id){let T=Ni(r.id);for(let k=0;k<n.arrayIndex;k++){let B=c.layers[k];Ni(B.id)===T&&e.push(new Le(o,r.id,`duplicate layer id "${r.id}", previously used at line ${B.id.__line__}`))}}if("ref"in r){let T;["type","source","source-layer","filter","layout"].forEach(k=>{k in r&&e.push(new Le(o,r[k],`"${k}" is prohibited for ref layers`))}),c.layers.forEach(k=>{Ni(k.id)===b&&(T=k)}),T?T.ref?e.push(new Le(o,r.ref,"ref cannot reference another ref layer")):g=Ni(T.type):e.push(new Le(o,r.ref,`ref layer "${b}" not found`))}else if(g!=="background")if(r.source){let T=c.sources&&c.sources[r.source],k=T&&Ni(T.type);T?k==="vector"&&g==="raster"?e.push(new Le(o,r.source,`layer "${r.id}" requires a raster source`)):k!=="raster-dem"&&g==="hillshade"||k!=="raster-dem"&&g==="color-relief"?e.push(new Le(o,r.source,`layer "${r.id}" requires a raster-dem source`)):k==="raster"&&g!=="raster"?e.push(new Le(o,r.source,`layer "${r.id}" requires a vector source`)):k!=="vector"||r["source-layer"]?k==="raster-dem"&&g!=="hillshade"&&g!=="color-relief"?e.push(new Le(o,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):g!=="line"||!r.paint||!r.paint["line-gradient"]||k==="geojson"&&T.lineMetrics||e.push(new Le(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Le(o,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Le(o,r.source,`source "${r.source}" not found`))}else e.push(new Le(o,r,'missing required property "source"'));return e=e.concat(Pi({key:o,value:r,valueSpec:_.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:r.type,valueSpec:_.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:ul,layout:T=>Pi({layer:r,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":k=>_a(vr({layerType:g},k))}}),paint:T=>Pi({layer:r,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":k=>Da(vr({layerType:g},k))}})}})),e}function ds(n){let e=n.value,r=n.key,o=Ke(e);return o!=="string"?[new Le(r,e,`string expected, ${o} found`)]:[]}let Rl={promoteId:function({key:n,value:e}){if(Ke(e)==="string")return ds({key:n,value:e});{let r=[];for(let o in e)r.push(...ds({key:`${n}.${o}`,value:e[o]}));return r}}};function nu(n){let e=n.value,r=n.key,o=n.styleSpec,c=n.style,_=n.validateSpec;if(!e.type)return[new Le(r,e,'"type" is required')];let g=Ni(e.type),b;switch(g){case"vector":case"raster":return b=Pi({key:r,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:Rl,validateSpec:_}),b;case"raster-dem":return b=function(T){var k;let B=(k=T.sourceName)!==null&&k!==void 0?k:"",z=T.value,V=T.styleSpec,H=V.source_raster_dem,K=T.style,Y=[],at=Ke(z);if(z===void 0)return Y;if(at!=="object")return Y.push(new Le("source_raster_dem",z,`object expected, ${at} found`)),Y;let ft=Ni(z.encoding)==="custom",zt=["redFactor","greenFactor","blueFactor","baseShift"],wt=T.value.encoding?`"${T.value.encoding}"`:"Default";for(let U in z)!ft&&zt.includes(U)?Y.push(new Le(U,z[U],`In "${B}": "${U}" is only valid when "encoding" is set to "custom". ${wt} encoding found`)):H[U]?Y=Y.concat(T.validateSpec({key:U,value:z[U],valueSpec:H[U],validateSpec:T.validateSpec,style:K,styleSpec:V})):Y.push(new Le(U,z[U],`unknown property "${U}"`));return Y}({sourceName:r,value:e,style:n.style,styleSpec:o,validateSpec:_}),b;case"geojson":if(b=Pi({key:r,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:_,objectElementValidators:Rl}),e.cluster)for(let T in e.clusterProperties){let[k,B]=e.clusterProperties[T],z=typeof k=="string"?[k,["accumulated"],["get",T]]:k;b.push(...Po({key:`${r}.${T}.map`,value:B,expressionContext:"cluster-map"})),b.push(...Po({key:`${r}.${T}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return b;case"video":return Pi({key:r,value:e,valueSpec:o.source_video,style:c,validateSpec:_,styleSpec:o});case"image":return Pi({key:r,value:e,valueSpec:o.source_image,style:c,validateSpec:_,styleSpec:o});case"canvas":return[new Le(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ur({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function su(n){let e=n.value,r=n.styleSpec,o=r.light,c=n.style,_=[],g=Ke(e);if(e===void 0)return _;if(g!=="object")return _=_.concat([new Le("light",e,`object expected, ${g} found`)]),_;for(let b in e){let T=b.match(/^(.*)-transition$/);_=_.concat(T&&o[T[1]]&&o[T[1]].transition?n.validateSpec({key:b,value:e[b],valueSpec:r.transition,validateSpec:n.validateSpec,style:c,styleSpec:r}):o[b]?n.validateSpec({key:b,value:e[b],valueSpec:o[b],validateSpec:n.validateSpec,style:c,styleSpec:r}):[new Le(b,e[b],`unknown property "${b}"`)])}return _}function Qs(n){let e=n.value,r=n.styleSpec,o=r.sky,c=n.style,_=Ke(e);if(e===void 0)return[];if(_!=="object")return[new Le("sky",e,`object expected, ${_} found`)];let g=[];for(let b in e)g=g.concat(o[b]?n.validateSpec({key:b,value:e[b],valueSpec:o[b],style:c,styleSpec:r}):[new Le(b,e[b],`unknown property "${b}"`)]);return g}function za(n){let e=n.value,r=n.styleSpec,o=r.terrain,c=n.style,_=[],g=Ke(e);if(e===void 0)return _;if(g!=="object")return _=_.concat([new Le("terrain",e,`object expected, ${g} found`)]),_;for(let b in e)_=_.concat(o[b]?n.validateSpec({key:b,value:e[b],valueSpec:o[b],validateSpec:n.validateSpec,style:c,styleSpec:r}):[new Le(b,e[b],`unknown property "${b}"`)]);return _}function bl(n){let e=[],r=n.value,o=n.key;if(Array.isArray(r)){let c=[],_=[];for(let g in r)r[g].id&&c.includes(r[g].id)&&e.push(new Le(o,r,`all the sprites' ids must be unique, but ${r[g].id} is duplicated`)),c.push(r[g].id),r[g].url&&_.includes(r[g].url)&&e.push(new Le(o,r,`all the sprites' URLs must be unique, but ${r[g].url} is duplicated`)),_.push(r[g].url),e=e.concat(Pi({key:`${o}[${g}]`,value:r[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return ds({key:o,value:r})}function ou(n){return e=n.value,e&&e.constructor===Object?[]:[new Le(n.key,n.value,`object expected, ${Ke(n.value)} found`)];var e}let Ol={"*":()=>[],array:Lo,boolean:function(n){let e=n.value,r=n.key,o=Ke(e);return o!=="boolean"?[new Le(r,e,`boolean expected, ${o} found`)]:[]},number:fa,color:ma,constants:da,enum:Ur,filter:ul,function:To,layer:zn,object:Pi,source:nu,light:su,sky:Qs,terrain:za,projection:function(n){let e=n.value,r=n.styleSpec,o=r.projection,c=n.style,_=Ke(e);if(e===void 0)return[];if(_!=="object")return[new Le("projection",e,`object expected, ${_} found`)];let g=[];for(let b in e)g=g.concat(o[b]?n.validateSpec({key:b,value:e[b],valueSpec:o[b],style:c,styleSpec:r}):[new Le(b,e[b],`unknown property "${b}"`)]);return g},projectionDefinition:function(n){let e=n.key,r=n.value;r=r instanceof String?r.valueOf():r;let o=Ke(r);return o!=="array"||function(c){return Array.isArray(c)&&c.length===3&&typeof c[0]=="string"&&typeof c[1]=="string"&&typeof c[2]=="number"}(r)||function(c){return!!["interpolate","step","literal"].includes(c[0])}(r)?["array","string"].includes(o)?[]:[new Le(e,r,`projection expected, invalid type "${o}" found`)]:[new Le(e,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:ds,formatted:function(n){return ds(n).length===0?[]:Po(n)},resolvedImage:function(n){return ds(n).length===0?[]:Po(n)},padding:function(n){let e=n.key,r=n.value;if(Ke(r)==="array"){if(r.length<1||r.length>4)return[new Le(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];let o={type:"number"},c=[];for(let _=0;_<r.length;_++)c=c.concat(n.validateSpec({key:`${e}[${_}]`,value:r[_],validateSpec:n.validateSpec,valueSpec:o}));return c}return fa({key:e,value:r,valueSpec:{}})},numberArray:function(n){let e=n.key,r=n.value;if(Ke(r)==="array"){let o={type:"number"};if(r.length<1)return[new Le(e,r,"array length at least 1 expected, length 0 found")];let c=[];for(let _=0;_<r.length;_++)c=c.concat(n.validateSpec({key:`${e}[${_}]`,value:r[_],validateSpec:n.validateSpec,valueSpec:o}));return c}return fa({key:e,value:r,valueSpec:{}})},colorArray:function(n){let e=n.key,r=n.value;if(Ke(r)==="array"){if(r.length<1)return[new Le(e,r,"array length at least 1 expected, length 0 found")];let o=[];for(let c=0;c<r.length;c++)o=o.concat(ma({key:`${e}[${c}]`,value:r[c]}));return o}return ma({key:e,value:r})},variableAnchorOffsetCollection:function(n){let e=n.key,r=n.value,o=Ke(r),c=n.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new Le(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let g=0;g<r.length;g+=2)_=_.concat(Ur({key:`${e}[${g}]`,value:r[g],valueSpec:c.layout_symbol["text-anchor"]})),_=_.concat(Lo({key:`${e}[${g+1}]`,value:r[g+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:c}));return _},sprite:bl,state:ou};function ga(n){let e=n.value,r=n.valueSpec,o=n.styleSpec;return n.validateSpec=ga,r.expression&&Ps(Ni(e))?To(n):r.expression&&f(ps(e))?Po(n):r.type&&Ol[r.type]?Ol[r.type](n):Pi(vr({},n,{valueSpec:r.type?o[r.type]:r}))}function So(n){let e=n.value,r=n.key,o=ds(n);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Le(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Le(r,e,'"glyphs" url must include a "{range}" token'))),o}function Qn(n,e=At){let r=[];return r=r.concat(ga({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:ga,objectElementValidators:{glyphs:So,"*":()=>[]}})),n.constants&&(r=r.concat(da({key:"constants",value:n.constants}))),au(r)}function ks(n){return function(e){return n(Al(kr({},e),{validateSpec:ga}))}}function au(n){return[].concat(n).sort((e,r)=>e.line-r.line)}function nn(n){return function(...e){return au(n.apply(this,e))}}Qn.source=nn(ks(nu)),Qn.sprite=nn(ks(bl)),Qn.glyphs=nn(ks(So)),Qn.light=nn(ks(su)),Qn.sky=nn(ks(Qs)),Qn.terrain=nn(ks(za)),Qn.state=nn(ks(ou)),Qn.layer=nn(ks(zn)),Qn.filter=nn(ks(ul)),Qn.paintProperty=nn(ks(Da)),Qn.layoutProperty=nn(ks(_a));let ya=Qn,Lu=ya.light,wl=ya.sky,lu=ya.paintProperty,Fl=ya.layoutProperty;function cl(n,e){let r=!1;if(e&&e.length)for(let o of e)n.fire(new qt(new Error(o.message))),r=!0;return r}class Ra{constructor(e,r,o){let c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;let g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(r=g[1])+2*(o=g[2]);for(let T=0;T<this.d*this.d;T++){let k=g[3+T],B=g[3+T+1];c.push(k===B?null:g.subarray(k,B))}let b=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],b),this.bboxes=g.subarray(b),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=o,this.scale=r/e,this.uid=0;let _=o/r*e;this.min=-_,this.max=e+_}insert(e,r,o,c,_){this._forEachCell(r,o,c,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,o,c,_,g){this.cells[_].push(g)}query(e,r,o,c,_){let g=this.min,b=this.max;if(e<=g&&r<=g&&b<=o&&b<=c&&!_)return Array.prototype.slice.call(this.keys);{let T=[];return this._forEachCell(e,r,o,c,this._queryCell,T,{},_),T}}_queryCell(e,r,o,c,_,g,b,T){let k=this.cells[_];if(k!==null){let B=this.keys,z=this.bboxes;for(let V=0;V<k.length;V++){let H=k[V];if(b[H]===void 0){let K=4*H;(T?T(z[K+0],z[K+1],z[K+2],z[K+3]):e<=z[K+2]&&r<=z[K+3]&&o>=z[K+0]&&c>=z[K+1])?(b[H]=!0,g.push(B[H])):b[H]=!1}}}}_forEachCell(e,r,o,c,_,g,b,T){let k=this._convertToCellCoord(e),B=this._convertToCellCoord(r),z=this._convertToCellCoord(o),V=this._convertToCellCoord(c);for(let H=k;H<=z;H++)for(let K=B;K<=V;K++){let Y=this.d*K+H;if((!T||T(this._convertFromCellCoord(H),this._convertFromCellCoord(K),this._convertFromCellCoord(H+1),this._convertFromCellCoord(K+1)))&&_.call(this,e,r,o,c,Y,g,b,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let e=this.cells,r=3+this.cells.length+1+1,o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;let c=new Int32Array(r+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let _=r;for(let g=0;g<e.length;g++){let b=e[g];c[3+g]=_,c.set(b,_),_+=b.length}return c[3+e.length]=_,c.set(this.keys,_),_+=this.keys.length,c[3+e.length+1]=_,c.set(this.bboxes,_),_+=this.bboxes.length,c.buffer}static serialize(e,r){let o=e.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(e){return new Ra(e.buffer)}}let to={};function De(n,e,r={}){if(to[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),to[n]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}De("Object",Object),De("Set",Set),De("TransferableGridIndex",Ra),De("Color",di),De("Error",Error),De("AJAXError",vt),De("ResolvedImage",ir),De("StylePropertyFunction",Pt),De("StyleExpression",s,{omit:["_evaluator"]}),De("ZoomDependentExpression",N),De("ZoomConstantExpression",E),De("CompoundExpression",Tr,{omit:["_evaluate"]});for(let n in $o)$o[n]._classRegistryKey||De(`Expression_${n}`,$o[n]);function Nl(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Oa(n){return n.$name||n.constructor._classRegistryKey}function Ho(n){return!function(e){if(e===null||typeof e!="object")return!1;let r=Oa(e);return!(!r||r==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Nl(n)||Gn(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Wo(n,e){if(Ho(n))return(Nl(n)||Gn(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){let _=[];for(let g of n)_.push(Wo(g,e));return _}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);let r=Oa(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!to[r])throw new Error(`${r} is not registered.`);let{klass:o}=to[r],c=o.serialize?o.serialize(n,e):{};if(o.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let _ in n){if(!n.hasOwnProperty(_)||to[r].omit.indexOf(_)>=0)continue;let g=n[_];c[_]=to[r].shallow.indexOf(_)>=0?g:Wo(g,e)}n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(c.$name=r),c}function Fa(n){if(Ho(n))return n;if(Array.isArray(n))return n.map(Fa);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);let e=Oa(n)||"Object";if(!to[e])throw new Error(`can't deserialize unregistered class ${e}`);let{klass:r}=to[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(n);let o=Object.create(r.prototype);for(let c of Object.keys(n)){if(c==="$name")continue;let _=n[c];o[c]=to[e].shallow.indexOf(c)>=0?_:Fa(_)}return o}class jl{constructor(){this.first=!0}update(e,r){let o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}let xi={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function xr(n){for(let e of n)if(Ml(e.charCodeAt(0)))return!0;return!1}function ko(n){for(let e of n)if(!Gl(e.charCodeAt(0)))return!1;return!0}function Cl(n){let e=n.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(e.join("|"),"u")}let Tu=Cl(["Arab","Dupl","Mong","Ougr","Syrc"]);function Gl(n){return!Tu.test(String.fromCodePoint(n))}let Zl=Cl(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Ml(n){return!(n!==746&&n!==747&&(n<4352||!(xi["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||xi["CJK Compatibility"](n)||xi["CJK Strokes"](n)||!(!xi["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||xi["Enclosed CJK Letters and Months"](n)||xi["Ideographic Description Characters"](n)||xi.Kanbun(n)||xi.Katakana(n)&&n!==12540||!(!xi["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!xi["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||xi["Vertical Forms"](n)||xi["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Zl.test(String.fromCodePoint(n)))))}function Vl(n){return!(Ml(n)||function(e){return!!(xi["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||xi["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||xi["Letterlike Symbols"](e)||xi["Number Forms"](e)||xi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||xi["Control Pictures"](e)&&e!==9251||xi["Optical Character Recognition"](e)||xi["Enclosed Alphanumerics"](e)||xi["Geometric Shapes"](e)||xi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||xi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||xi["CJK Symbols and Punctuation"](e)||xi.Katakana(e)||xi["Private Use Area"](e)||xi["CJK Compatibility Forms"](e)||xi["Small Form Variants"](e)||xi["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}let l=Cl(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function p(n){return l.test(String.fromCodePoint(n))}function y(n,e){return!(!e&&p(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||xi.Khmer(n))}function x(n){for(let e of n)if(p(e.charCodeAt(0)))return!0;return!1}let M=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(M.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return u(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;let r=n.pluginURL,o=new Promise(_=>{this.loadScriptResolve=_});e(r);let c=new Promise(_=>setTimeout(()=>_(),this.TIMEOUT));if(yield Promise.race([o,c]),this.isParsed()){let _={pluginStatus:"loaded",pluginURL:r};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class A{constructor(e,r){this.zoom=e,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new jl,this.transition=r.transition||{},this.globalState=r.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new jl,this.transition={},this.globalState={})}isSupportedScript(e){return function(r,o){for(let c of r)if(!y(c.charCodeAt(0),o))return!1;return!0}(e,M.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let e=this.zoom,r=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class R{constructor(e,r){this.property=e,this.value=r,this.expression=function(o,c){if(Ps(o))return new Pt(o,c);if(f(o)){let _=it(o,c);if(_.result==="error")throw new Error(_.value.map(g=>`${g.key}: ${g.message}`).join(", "));return _.value}{let _=o;return c.type==="color"&&typeof o=="string"?_=di.parse(o):c.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?c.type!=="numberArray"||typeof o!="number"&&!Array.isArray(o)?c.type!=="colorArray"||typeof o!="string"&&!Array.isArray(o)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(o)?_=ai.parse(o):c.type==="projectionDefinition"&&typeof o=="string"&&(_=Qe.parse(o)):_=or.parse(o):_=Cr.parse(o):_=ii.parse(o),{globalStateRefs:new Set,kind:"constant",evaluate:()=>_}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,r,o){return this.property.possiblyEvaluate(this,e,r,o)}}class j{constructor(e){this.property=e,this.value=new R(e,void 0)}transitioned(e,r){return new et(this.property,this.value,r,yr({},e.transition,this.transition),e.now)}untransitioned(){return new et(this.property,this.value,null,{},0)}}class W{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return cn(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new j(this._values[e].property)),this._values[e].value=new R(this._values[e].property,r===null?void 0:cn(r))}getTransition(e){return cn(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new j(this._values[e].property)),this._values[e].transition=cn(r)||void 0}serialize(){let e={};for(let r of Object.keys(this._values)){let o=this.getValue(r);o!==void 0&&(e[r]=o);let c=this.getTransition(r);c!==void 0&&(e[`${r}-transition`]=c)}return e}transitioned(e,r){let o=new Tt(this._properties);for(let c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,r._values[c]);return o}untransitioned(){let e=new Tt(this._properties);for(let r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class et{constructor(e,r,o,c,_){this.property=e,this.value=r,this.begin=_+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,r,o){let c=e.now||0,_=this.value.possiblyEvaluate(e,r,o),g=this.prior;if(g){if(c>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(c<this.begin)return g.possiblyEvaluate(e,r,o);{let b=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,r,o),_,mi(b))}}return _}}class Tt{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,o){let c=new Ut(this._properties);for(let _ of Object.keys(this._values))c._values[_]=this._values[_].possiblyEvaluate(e,r,o);return c}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class kt{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return cn(this._values[e].value)}setValue(e,r){this._values[e]=new R(this._values[e].property,r===null?void 0:cn(r))}serialize(){let e={};for(let r of Object.keys(this._values)){let o=this.getValue(r);o!==void 0&&(e[r]=o)}return e}possiblyEvaluate(e,r,o){let c=new Ut(this._properties);for(let _ of Object.keys(this._values))c._values[_]=this._values[_].possiblyEvaluate(e,r,o);return c}}class ie{constructor(e,r,o){this.property=e,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,o,c){return this.property.evaluate(this.value,this.parameters,e,r,o,c)}}class Ut{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class jt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,o){let c=_n[this.specification.type];return c?c(e,r,o):e}}class de{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,o,c){return new ie(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},o,c)}:e.expression,r)}interpolate(e,r,o){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ie(this,{kind:"constant",value:void 0},e.parameters);let c=_n[this.specification.type];if(c){let _=c(e.value.value,r.value.value,o);return new ie(this,{kind:"constant",value:_},e.parameters)}return e}evaluate(e,r,o,c,_,g){return e.kind==="constant"?e.value:e.evaluate(r,o,c,_,g)}}class Fe extends de{possiblyEvaluate(e,r,o,c){if(e.value===void 0)return new ie(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){let _=e.expression.evaluate(r,null,{},o,c),g=e.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,b=this._calculate(g,g,g,r);return new ie(this,{kind:"constant",value:b},r)}if(e.expression.kind==="camera"){let _=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new ie(this,{kind:"constant",value:_},r)}return new ie(this,e.expression,r)}evaluate(e,r,o,c,_,g){if(e.kind==="source"){let b=e.evaluate(r,o,c,_,g);return this._calculate(b,b,b,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},o,c),e.evaluate({zoom:Math.floor(r.zoom)},o,c),e.evaluate({zoom:Math.floor(r.zoom)+1},o,c),r):e.value}_calculate(e,r,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class Mi{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){let _=e.expression.evaluate(r,null,{},o,c);return this._calculate(_,_,_,r)}return this._calculate(e.expression.evaluate(new A(Math.floor(r.zoom-1),r)),e.expression.evaluate(new A(Math.floor(r.zoom),r)),e.expression.evaluate(new A(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:o,to:r}}interpolate(e){return e}}class bt{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,c){return!!e.expression.evaluate(r,null,{},o,c)}interpolate(){return!1}}class St{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let r in e){let o=e[r];o.specification.overridable&&this.overridableProperties.push(r);let c=this.defaultPropertyValues[r]=new R(o,void 0),_=this.defaultTransitionablePropertyValues[r]=new j(o);this.defaultTransitioningPropertyValues[r]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}De("DataDrivenProperty",de),De("DataConstantProperty",jt),De("CrossFadedDataDrivenProperty",Fe),De("CrossFadedProperty",Mi),De("ColorRampProperty",bt);let Zt="-transition";class Jt extends ye{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=qe(e.filter)),r.layout&&(this._unevaluatedLayout=new kt(r.layout)),r.paint)){this._transitionablePaint=new W(r.paint);for(let o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(let o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ut(r.paint)}}setFilter(e){this.filter=e,this._featureFilter=qe(e)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){let e=new Set;if(this._unevaluatedLayout)for(let r in this._unevaluatedLayout._values){let o=this._unevaluatedLayout._values[r];for(let c of o.getGlobalStateRefs())e.add(c)}for(let r of this._featureFilter.getGlobalStateRefs())e.add(r);return e}setLayoutProperty(e,r,o={}){r!=null&&this._validate(Fl,`layers.${this.id}.layout.${e}`,e,r,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Zt)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,o={}){if(r!=null&&this._validate(lu,`layers.${this.id}.paint.${e}`,e,r,o))return!1;if(e.endsWith(Zt))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{let c=this._transitionablePaint._values[e],_=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),b=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);let T=this._transitionablePaint._values[e].value;return T.isDataDriven()||g||_||this._handleOverridablePaintPropertyUpdate(e,b,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){let e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),rs(e,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(e,r,o,c,_={}){return(!_||_.validate!==!1)&&cl(this,e.call(ya,{key:r,layerType:this.type,objectKey:o,value:c,styleSpec:At,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let e in this.paint._values){let r=this.paint.get(e);if(r instanceof ie&&wo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let Ht={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class oe{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class q{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Q(n,e=1){let r=0,o=0;return{members:n.map(c=>{let _=Ht[c.type].BYTES_PER_ELEMENT,g=r=ut(r,Math.max(e,_)),b=c.components||1;return o=Math.max(o,_),r+=_*b,{name:c.name,type:c.type,components:b,offset:g}}),size:ut(r,Math.max(o,e)),alignment:e}}function ut(n,e){return Math.ceil(n/e)*e}class ot extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){let o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){let c=2*e;return this.int16[c+0]=r,this.int16[c+1]=o,e}}ot.prototype.bytesPerElement=4,De("StructArrayLayout2i4",ot);class ht extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,r,o)}emplace(e,r,o,c){let _=3*e;return this.int16[_+0]=r,this.int16[_+1]=o,this.int16[_+2]=c,e}}ht.prototype.bytesPerElement=6,De("StructArrayLayout3i6",ht);class pt extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,c){let _=this.length;return this.resize(_+1),this.emplace(_,e,r,o,c)}emplace(e,r,o,c,_){let g=4*e;return this.int16[g+0]=r,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+3]=_,e}}pt.prototype.bytesPerElement=8,De("StructArrayLayout4i8",pt);class Dt extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,c,_,g){let b=this.length;return this.resize(b+1),this.emplace(b,e,r,o,c,_,g)}emplace(e,r,o,c,_,g,b){let T=6*e;return this.int16[T+0]=r,this.int16[T+1]=o,this.int16[T+2]=c,this.int16[T+3]=_,this.int16[T+4]=g,this.int16[T+5]=b,e}}Dt.prototype.bytesPerElement=12,De("StructArrayLayout2i4i12",Dt);class Bt extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,c,_,g){let b=this.length;return this.resize(b+1),this.emplace(b,e,r,o,c,_,g)}emplace(e,r,o,c,_,g,b){let T=4*e,k=8*e;return this.int16[T+0]=r,this.int16[T+1]=o,this.uint8[k+4]=c,this.uint8[k+5]=_,this.uint8[k+6]=g,this.uint8[k+7]=b,e}}Bt.prototype.bytesPerElement=8,De("StructArrayLayout2i4ub8",Bt);class Ft extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){let o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){let c=2*e;return this.float32[c+0]=r,this.float32[c+1]=o,e}}Ft.prototype.bytesPerElement=8,De("StructArrayLayout2f8",Ft);class Yt extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,c,_,g,b,T,k,B){let z=this.length;return this.resize(z+1),this.emplace(z,e,r,o,c,_,g,b,T,k,B)}emplace(e,r,o,c,_,g,b,T,k,B,z){let V=10*e;return this.uint16[V+0]=r,this.uint16[V+1]=o,this.uint16[V+2]=c,this.uint16[V+3]=_,this.uint16[V+4]=g,this.uint16[V+5]=b,this.uint16[V+6]=T,this.uint16[V+7]=k,this.uint16[V+8]=B,this.uint16[V+9]=z,e}}Yt.prototype.bytesPerElement=20,De("StructArrayLayout10ui20",Yt);class Wt extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,c,_,g,b,T,k,B,z,V){let H=this.length;return this.resize(H+1),this.emplace(H,e,r,o,c,_,g,b,T,k,B,z,V)}emplace(e,r,o,c,_,g,b,T,k,B,z,V,H){let K=12*e;return this.int16[K+0]=r,this.int16[K+1]=o,this.int16[K+2]=c,this.int16[K+3]=_,this.uint16[K+4]=g,this.uint16[K+5]=b,this.uint16[K+6]=T,this.uint16[K+7]=k,this.int16[K+8]=B,this.int16[K+9]=z,this.int16[K+10]=V,this.int16[K+11]=H,e}}Wt.prototype.bytesPerElement=24,De("StructArrayLayout4i4ui4i24",Wt);class we extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,r,o)}emplace(e,r,o,c){let _=3*e;return this.float32[_+0]=r,this.float32[_+1]=o,this.float32[_+2]=c,e}}we.prototype.bytesPerElement=12,De("StructArrayLayout3f12",we);class d extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}d.prototype.bytesPerElement=4,De("StructArrayLayout1ul4",d);class t extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,c,_,g,b,T,k){let B=this.length;return this.resize(B+1),this.emplace(B,e,r,o,c,_,g,b,T,k)}emplace(e,r,o,c,_,g,b,T,k,B){let z=10*e,V=5*e;return this.int16[z+0]=r,this.int16[z+1]=o,this.int16[z+2]=c,this.int16[z+3]=_,this.int16[z+4]=g,this.int16[z+5]=b,this.uint32[V+3]=T,this.uint16[z+8]=k,this.uint16[z+9]=B,e}}t.prototype.bytesPerElement=20,De("StructArrayLayout6i1ul2ui20",t);class i extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,c,_,g){let b=this.length;return this.resize(b+1),this.emplace(b,e,r,o,c,_,g)}emplace(e,r,o,c,_,g,b){let T=6*e;return this.int16[T+0]=r,this.int16[T+1]=o,this.int16[T+2]=c,this.int16[T+3]=_,this.int16[T+4]=g,this.int16[T+5]=b,e}}i.prototype.bytesPerElement=12,De("StructArrayLayout2i2i2i12",i);class a extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,c,_){let g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,c,_)}emplace(e,r,o,c,_,g){let b=4*e,T=8*e;return this.float32[b+0]=r,this.float32[b+1]=o,this.float32[b+2]=c,this.int16[T+6]=_,this.int16[T+7]=g,e}}a.prototype.bytesPerElement=16,De("StructArrayLayout2f1f2i16",a);class h extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,c,_,g){let b=this.length;return this.resize(b+1),this.emplace(b,e,r,o,c,_,g)}emplace(e,r,o,c,_,g,b){let T=16*e,k=4*e,B=8*e;return this.uint8[T+0]=r,this.uint8[T+1]=o,this.float32[k+1]=c,this.float32[k+2]=_,this.int16[B+6]=g,this.int16[B+7]=b,e}}h.prototype.bytesPerElement=16,De("StructArrayLayout2ub2f2i16",h);class m extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,r,o)}emplace(e,r,o,c){let _=3*e;return this.uint16[_+0]=r,this.uint16[_+1]=o,this.uint16[_+2]=c,e}}m.prototype.bytesPerElement=6,De("StructArrayLayout3ui6",m);class v extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,c,_,g,b,T,k,B,z,V,H,K,Y,at,ft){let zt=this.length;return this.resize(zt+1),this.emplace(zt,e,r,o,c,_,g,b,T,k,B,z,V,H,K,Y,at,ft)}emplace(e,r,o,c,_,g,b,T,k,B,z,V,H,K,Y,at,ft,zt){let wt=24*e,U=12*e,st=48*e;return this.int16[wt+0]=r,this.int16[wt+1]=o,this.uint16[wt+2]=c,this.uint16[wt+3]=_,this.uint32[U+2]=g,this.uint32[U+3]=b,this.uint32[U+4]=T,this.uint16[wt+10]=k,this.uint16[wt+11]=B,this.uint16[wt+12]=z,this.float32[U+7]=V,this.float32[U+8]=H,this.uint8[st+36]=K,this.uint8[st+37]=Y,this.uint8[st+38]=at,this.uint32[U+10]=ft,this.int16[wt+22]=zt,e}}v.prototype.bytesPerElement=48,De("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",v);class C extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,c,_,g,b,T,k,B,z,V,H,K,Y,at,ft,zt,wt,U,st,Mt,ae,ve,pe,me,Me,be){let Te=this.length;return this.resize(Te+1),this.emplace(Te,e,r,o,c,_,g,b,T,k,B,z,V,H,K,Y,at,ft,zt,wt,U,st,Mt,ae,ve,pe,me,Me,be)}emplace(e,r,o,c,_,g,b,T,k,B,z,V,H,K,Y,at,ft,zt,wt,U,st,Mt,ae,ve,pe,me,Me,be,Te){let _e=32*e,Oe=16*e;return this.int16[_e+0]=r,this.int16[_e+1]=o,this.int16[_e+2]=c,this.int16[_e+3]=_,this.int16[_e+4]=g,this.int16[_e+5]=b,this.int16[_e+6]=T,this.int16[_e+7]=k,this.uint16[_e+8]=B,this.uint16[_e+9]=z,this.uint16[_e+10]=V,this.uint16[_e+11]=H,this.uint16[_e+12]=K,this.uint16[_e+13]=Y,this.uint16[_e+14]=at,this.uint16[_e+15]=ft,this.uint16[_e+16]=zt,this.uint16[_e+17]=wt,this.uint16[_e+18]=U,this.uint16[_e+19]=st,this.uint16[_e+20]=Mt,this.uint16[_e+21]=ae,this.uint16[_e+22]=ve,this.uint32[Oe+12]=pe,this.float32[Oe+13]=me,this.float32[Oe+14]=Me,this.uint16[_e+30]=be,this.uint16[_e+31]=Te,e}}C.prototype.bytesPerElement=64,De("StructArrayLayout8i15ui1ul2f2ui64",C);class P extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}P.prototype.bytesPerElement=4,De("StructArrayLayout1f4",P);class I extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,r,o)}emplace(e,r,o,c){let _=3*e;return this.uint16[6*e+0]=r,this.float32[_+1]=o,this.float32[_+2]=c,e}}I.prototype.bytesPerElement=12,De("StructArrayLayout1ui2f12",I);class D extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){let c=this.length;return this.resize(c+1),this.emplace(c,e,r,o)}emplace(e,r,o,c){let _=4*e;return this.uint32[2*e+0]=r,this.uint16[_+2]=o,this.uint16[_+3]=c,e}}D.prototype.bytesPerElement=8,De("StructArrayLayout1ul2ui8",D);class F extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){let o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){let c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=o,e}}F.prototype.bytesPerElement=4,De("StructArrayLayout2ui4",F);class O extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}O.prototype.bytesPerElement=2,De("StructArrayLayout1ui2",O);class Z extends q{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,c){let _=this.length;return this.resize(_+1),this.emplace(_,e,r,o,c)}emplace(e,r,o,c,_){let g=4*e;return this.float32[g+0]=r,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=_,e}}Z.prototype.bytesPerElement=16,De("StructArrayLayout4f16",Z);class X extends oe{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ge(this.anchorPointX,this.anchorPointY)}}X.prototype.size=20;class nt extends t{get(e){return new X(this,e)}}De("CollisionBoxArray",nt);class ct extends oe{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ct.prototype.size=48;class dt extends v{get(e){return new ct(this,e)}}De("PlacedSymbolArray",dt);class mt extends oe{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}mt.prototype.size=64;class Ct extends C{get(e){return new mt(this,e)}}De("SymbolInstanceArray",Ct);class yt extends P{getoffsetX(e){return this.float32[1*e+0]}}De("GlyphOffsetArray",yt);class Lt extends ht{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}De("SymbolLineVertexArray",Lt);class It extends oe{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}It.prototype.size=12;class xt extends I{get(e){return new It(this,e)}}De("TextAnchorOffsetArray",xt);class Ot extends oe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ot.prototype.size=8;class ue extends D{get(e){return new Ot(this,e)}}De("FeatureIndexArray",ue);class te extends ot{}class ne extends ot{}class he extends ot{}class Ee extends Dt{}class ke extends Bt{}class xe extends Ft{}class Re extends Yt{}class _i extends Wt{}class Di extends we{}class hr extends d{}class Vi extends i{}class cr extends h{}class qi extends m{}class Ui extends F{}let Hi=Q([{name:"a_pos",components:2,type:"Int16"}],4),{members:bn}=Hi;class ki{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,r,o,c){let _=this.segments[this.segments.length-1];return e>ki.MAX_VERTEX_ARRAY_LENGTH&&fr(`Max vertices per segment is ${ki.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${ki.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+e>ki.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==c?this.createNewSegment(r,o,c):_}createNewSegment(e,r,o){let c={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(c.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(c),c}getOrCreateLatestSegment(e,r,o){return this.prepareSegment(0,e,r,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let e of this.segments)for(let r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,o,c){return new ki([{vertexOffset:e,primitiveOffset:r,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function sn(n,e){return 256*(n=nr(Math.floor(n),0,255))+nr(Math.floor(e),0,255)}ki.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,De("SegmentVector",ki);let wn=Q([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Na,ja,Ga,Ko={exports:{}},Ul={exports:{}},$l={exports:{}},Ll=function(){if(Ga)return Ko.exports;Ga=1;var n=(Na||(Na=1,Ul.exports=function(r,o){var c,_,g,b,T,k,B,z;for(_=r.length-(c=3&r.length),g=o,T=3432918353,k=461845907,z=0;z<_;)B=255&r.charCodeAt(z)|(255&r.charCodeAt(++z))<<8|(255&r.charCodeAt(++z))<<16|(255&r.charCodeAt(++z))<<24,++z,g=27492+(65535&(b=5*(65535&(g=(g^=B=(65535&(B=(B=(65535&B)*T+(((B>>>16)*T&65535)<<16)&4294967295)<<15|B>>>17))*k+(((B>>>16)*k&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(B=0,c){case 3:B^=(255&r.charCodeAt(z+2))<<16;case 2:B^=(255&r.charCodeAt(z+1))<<8;case 1:g^=B=(65535&(B=(B=(65535&(B^=255&r.charCodeAt(z)))*T+(((B>>>16)*T&65535)<<16)&4294967295)<<15|B>>>17))*k+(((B>>>16)*k&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),Ul.exports),e=(ja||(ja=1,$l.exports=function(r,o){for(var c,_=r.length,g=o^_,b=0;_>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(b)|(255&r.charCodeAt(++b))<<8|(255&r.charCodeAt(++b))<<16|(255&r.charCodeAt(++b))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),_-=4,++b;switch(_){case 3:g^=(255&r.charCodeAt(b+2))<<16;case 2:g^=(255&r.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),$l.exports);return Ko.exports=n,Ko.exports.murmur3=n,Ko.exports.murmur2=e,Ko.exports}(),fs=rt(Ll);class Eo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,o,c){this.ids.push(Za(e)),this.positions.push(r,o,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let r=Za(e),o=0,c=this.ids.length-1;for(;o<c;){let g=o+c>>1;this.ids[g]>=r?c=g:o=g+1}let _=[];for(;this.ids[o]===r;)_.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return _}static serialize(e,r){let o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return pl(o,c,0,o.length-1),r&&r.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){let r=new Eo;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Za(n){let e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:fs(String(n))}function pl(n,e,r,o){for(;r<o;){let c=n[r+o>>1],_=r-1,g=o+1;for(;;){do _++;while(n[_]<c);do g--;while(n[g]>c);if(_>=g)break;br(n,_,g),br(e,3*_,3*g),br(e,3*_+1,3*g+1),br(e,3*_+2,3*g+2)}g-r<o-g?(pl(n,e,r,g),r=g+1):(pl(n,e,g+1,o),o=g)}}function br(n,e,r){let o=n[e];n[e]=n[r],n[r]=o}De("FeaturePositionMap",Eo);class Qi{constructor(e,r){this.gl=e.gl,this.location=r}}class ts extends Qi{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class $r extends Qi{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Yu extends Qi{constructor(e,r){super(e,r),this.current=di.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}let Bh=new Float32Array(16);function Pu(n){return[sn(255*n.r,255*n.g),sn(255*n.b,255*n.a)]}class ql{constructor(e,r,o){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=o}setUniform(e,r,o){e.set(o.constantOr(this.value))}getBinding(e,r,o){return this.type==="color"?new Yu(e,r):new ts(e,r)}}class Tl{constructor(e,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,o,c){let _=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&e.set(_)}getBinding(e,r,o){return o.substr(0,9)==="u_pattern"?new $r(e,r):new ts(e,r)}}class va{constructor(e,r,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,o,c,_){let g=this.paintVertexArray.length,b=this.expression.evaluate(new A(0),r,{},c,[],_);this.paintVertexArray.resize(e),this._setPaintValue(g,e,b)}updatePaintArray(e,r,o,c){let _=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(e,r,_)}_setPaintValue(e,r,o){if(this.type==="color"){let c=Pu(o);for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cn{constructor(e,r,o,c,_,g){this.expression=e,this.uniformNames=r.map(b=>`u_${b}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=r.map(b=>({name:`a_${b}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,r,o,c,_){let g=this.expression.evaluate(new A(this.zoom),r,{},c,[],_),b=this.expression.evaluate(new A(this.zoom+1),r,{},c,[],_),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,g,b)}updatePaintArray(e,r,o,c){let _=this.expression.evaluate({zoom:this.zoom},o,c),g=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(e,r,_,g)}_setPaintValue(e,r,o,c){if(this.type==="color"){let _=Pu(o),g=Pu(c);for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,_[0],_[1],g[0],g[1])}else{for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){let o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=nr(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,r,o){return new ts(e,r)}}class xa{constructor(e,r,o,c,_,g){this.expression=e,this.type=r,this.useIntegerZoom=o,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,r,o){let c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(e,r,o,c,_){this._setPaintValues(e,r,o.patterns&&o.patterns[this.layerId],_)}_setPaintValues(e,r,o,c){if(!c||!o)return;let{min:_,mid:g,max:b}=o,T=c[_],k=c[g],B=c[b];if(T&&k&&B)for(let z=e;z<r;z++)this.zoomInPaintVertexArray.emplace(z,k.tl[0],k.tl[1],k.br[0],k.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],k.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,k.tl[0],k.tl[1],k.br[0],k.br[1],B.tl[0],B.tl[1],B.br[0],B.br[1],k.pixelRatio,B.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,wn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,wn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Su{constructor(e,r,o){this.binders={},this._buffers=[];let c=[];for(let _ in e.paint._values){if(!o(_))continue;let g=e.paint.get(_);if(!(g instanceof ie&&wo(g.property.specification)))continue;let b=ku(_,e.type),T=g.value,k=g.property.specification.type,B=g.property.useIntegerZoom,z=g.property.specification["property-type"],V=z==="cross-faded"||z==="cross-faded-data-driven";if(T.kind==="constant")this.binders[_]=V?new Tl(T.value,b):new ql(T.value,b,k),c.push(`/u_${_}`);else if(T.kind==="source"||V){let H=Eu(_,k,"source");this.binders[_]=V?new xa(T,k,B,r,H,e.id):new va(T,b,k,H),c.push(`/a_${_}`)}else{let H=Eu(_,k,"composite");this.binders[_]=new Cn(T,b,k,B,r,H),c.push(`/z_${_}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){let r=this.binders[e];return r instanceof va||r instanceof Cn?r.maxValue:0}populatePaintArrays(e,r,o,c,_){for(let g in this.binders){let b=this.binders[g];(b instanceof va||b instanceof Cn||b instanceof xa)&&b.populatePaintArray(e,r,o,c,_)}}setConstantPatternPositions(e,r){for(let o in this.binders){let c=this.binders[o];c instanceof Tl&&c.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,o,c,_){let g=!1;for(let b in e){let T=r.getPositions(b);for(let k of T){let B=o.feature(k.index);for(let z in this.binders){let V=this.binders[z];if((V instanceof va||V instanceof Cn||V instanceof xa)&&V.expression.isStateDependent===!0){let H=c.paint.get(z);V.expression=H.value,V.updatePaintArray(k.start,k.end,B,e[b],_),g=!0}}}}return g}defines(){let e=[];for(let r in this.binders){let o=this.binders[r];(o instanceof ql||o instanceof Tl)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){let e=[];for(let r in this.binders){let o=this.binders[r];if(o instanceof va||o instanceof Cn)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name);else if(o instanceof xa)for(let c=0;c<wn.members.length;c++)e.push(wn.members[c].name)}return e}getBinderUniforms(){let e=[];for(let r in this.binders){let o=this.binders[r];if(o instanceof ql||o instanceof Tl||o instanceof Cn)for(let c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){let o=[];for(let c in this.binders){let _=this.binders[c];if(_ instanceof ql||_ instanceof Tl||_ instanceof Cn){for(let g of _.uniformNames)if(r[g]){let b=_.getBinding(e,r[g],g);o.push({name:g,property:c,binding:b})}}}return o}setUniforms(e,r,o,c){for(let{name:_,property:g,binding:b}of r)this.binders[g].setUniform(b,c,o.get(g),_)}updatePaintBuffers(e){this._buffers=[];for(let r in this.binders){let o=this.binders[r];if(e&&o instanceof xa){let c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof va||o instanceof Cn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(let r in this.binders){let o=this.binders[r];(o instanceof va||o instanceof Cn||o instanceof xa)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let r=this.binders[e];(r instanceof va||r instanceof Cn||r instanceof xa)&&r.destroy()}}}class Va{constructor(e,r,o=()=>!0){this.programConfigurations={};for(let c of e)this.programConfigurations[c.id]=new Su(c,r,o);this.needsUpload=!1,this._featureMap=new Eo,this._bufferOffset=0}populatePaintArrays(e,r,o,c,_,g){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,c,_,g);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,o,c){for(let _ of o)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,r,_,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}function ku(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function Eu(n,e,r){let o={color:{source:Ft,composite:Z},number:{source:P,composite:Ft}},c=function(_){return{"line-pattern":{source:Re,composite:Re},"fill-pattern":{source:Re,composite:Re},"fill-extrusion-pattern":{source:Re,composite:Re}}[_]}(n);return c&&c[r]||o[e][r]}De("ConstantBinder",ql),De("CrossFadedConstantBinder",Tl),De("SourceExpressionBinder",va),De("CrossFadedCompositeBinder",xa),De("CompositeExpressionBinder",Cn),De("ProgramConfiguration",Su,{omit:["_buffers"]}),De("ProgramConfigurationSet",Va);let Hl=Math.pow(2,14)-1,Bc=-Hl-1;function Wl(n){let e=ti/n.extent,r=n.loadGeometry();for(let o=0;o<r.length;o++){let c=r[o];for(let _=0;_<c.length;_++){let g=c[_],b=Math.round(g.x*e),T=Math.round(g.y*e);g.x=nr(b,Bc,Hl),g.y=nr(T,Bc,Hl),(b<g.x||b>g.x+1||T<g.y||T>g.y+1)&&fr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Kl(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Wl(n):[]}}let Dc=-32768;function yf(n,e,r,o,c){n.emplaceBack(Dc+8*e+o,Dc+8*r+c)}class Dh{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ne,this.indexArray=new qi,this.segments=new ki,this.programConfigurations=new Va(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){let c=this.layers[0],_=[],g=null,b=!1,T=c.type==="heatmap";if(c.type==="circle"){let B=c;g=B.layout.get("circle-sort-key"),b=!g.isConstant(),T=T||B.paint.get("circle-pitch-alignment")==="map"}let k=T?r.subdivisionGranularity.circle:1;for(let{feature:B,id:z,index:V,sourceLayerIndex:H}of e){let K=this.layers[0]._featureFilter.needGeometry,Y=Kl(B,K);if(!this.layers[0]._featureFilter.filter(new A(this.zoom,{globalState:this.globalState}),Y,o))continue;let at=b?g.evaluate(Y,{},o):void 0,ft={id:z,properties:B.properties,type:B.type,sourceLayerIndex:H,index:V,geometry:K?Y.geometry:Wl(B),patterns:{},sortKey:at};_.push(ft)}b&&_.sort((B,z)=>B.sortKey-z.sortKey);for(let B of _){let{geometry:z,index:V,sourceLayerIndex:H}=B,K=e[V].feature;this.addFeature(B,z,V,o,k),r.featureIndex.insert(K,z,V,H,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,c,_=1){let g;switch(_){case 1:g=[0,7];break;case 3:g=[0,2,5,7];break;case 5:g=[0,1,3,4,6,7];break;case 7:g=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}let b=g.length;for(let T of r)for(let k of T){let B=k.x,z=k.y;if(B<0||B>=ti||z<0||z>=ti)continue;let V=this.segments.prepareSegment(b*b,this.layoutVertexArray,this.indexArray,e.sortKey),H=V.vertexLength;for(let K=0;K<b;K++)for(let Y=0;Y<b;Y++)yf(this.layoutVertexArray,B,z,g[Y],g[K]);for(let K=0;K<b-1;K++)for(let Y=0;Y<b-1;Y++){let at=H+K*b+Y,ft=H+(K+1)*b+Y;this.indexArray.emplaceBack(at,ft+1,at+1),this.indexArray.emplaceBack(at,ft,ft+1)}V.vertexLength+=b*b,V.primitiveLength+=(b-1)*(b-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c)}}function zc(n,e){for(let r=0;r<n.length;r++)if(uu(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(uu(n,e[r]))return!0;return!!zh(n,e)}function vf(n,e,r){return!!uu(n,e)||!!Rh(e,n,r)}function Rc(n,e){if(n.length===1)return Fc(e,n[0]);for(let r=0;r<e.length;r++){let o=e[r];for(let c=0;c<o.length;c++)if(uu(n,o[c]))return!0}for(let r=0;r<n.length;r++)if(Fc(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(zh(n,e[r]))return!0;return!1}function xf(n,e,r){if(n.length>1){if(zh(n,e))return!0;for(let o=0;o<e.length;o++)if(Rh(e[o],n,r))return!0}for(let o=0;o<n.length;o++)if(Rh(n[o],e,r))return!0;return!1}function zh(n,e){if(n.length===0||e.length===0)return!1;for(let r=0;r<n.length-1;r++){let o=n[r],c=n[r+1];for(let _=0;_<e.length-1;_++)if(bf(o,c,e[_],e[_+1]))return!0}return!1}function bf(n,e,r,o){return Er(n,r,o)!==Er(e,r,o)&&Er(n,e,r)!==Er(n,e,o)}function Rh(n,e,r){let o=r*r;if(e.length===1)return n.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(Oc(n,e[c-1],e[c])<o)return!0;return!1}function Oc(n,e,r){let o=e.distSqr(r);if(o===0)return n.distSqr(e);let c=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/o;return n.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function Fc(n,e){let r,o,c,_=!1;for(let g=0;g<n.length;g++){r=n[g];for(let b=0,T=r.length-1;b<r.length;T=b++)o=r[b],c=r[T],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(_=!_)}return _}function uu(n,e){let r=!1;for(let o=0,c=n.length-1;o<n.length;c=o++){let _=n[o],g=n[c];_.y>e.y!=g.y>e.y&&e.x<(g.x-_.x)*(e.y-_.y)/(g.y-_.y)+_.x&&(r=!r)}return r}function wf(n,e,r){let o=r[0],c=r[2];if(n.x<o.x&&e.x<o.x||n.x>c.x&&e.x>c.x||n.y<o.y&&e.y<o.y||n.y>c.y&&e.y>c.y)return!1;let _=Er(n,e,r[0]);return _!==Er(n,e,r[1])||_!==Er(n,e,r[2])||_!==Er(n,e,r[3])}function Au(n,e,r){let o=e.paint.get(n).value;return o.kind==="constant"?o.value:r.programConfigurations.get(e.id).getMaxValue(n)}function Ju(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Qu(n,e,r,o,c){if(!e[0]&&!e[1])return n;let _=ge.convert(e)._mult(c);r==="viewport"&&_._rotate(-o);let g=[];for(let b=0;b<n.length;b++)g.push(n[b].sub(_));return g}let Nc,jc;De("CircleBucket",Dh,{omit:["layers"]});var Cf={get paint(){return jc=jc||new St({"circle-radius":new de(At.paint_circle["circle-radius"]),"circle-color":new de(At.paint_circle["circle-color"]),"circle-blur":new de(At.paint_circle["circle-blur"]),"circle-opacity":new de(At.paint_circle["circle-opacity"]),"circle-translate":new jt(At.paint_circle["circle-translate"]),"circle-translate-anchor":new jt(At.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jt(At.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jt(At.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new de(At.paint_circle["circle-stroke-width"]),"circle-stroke-color":new de(At.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new de(At.paint_circle["circle-stroke-opacity"])})},get layout(){return Nc=Nc||new St({"circle-sort-key":new de(At.layout_circle["circle-sort-key"])})}};class Mf extends Jt{constructor(e){super(e,Cf)}createBucket(e){return new Dh(e)}queryRadius(e){let r=e;return Au("circle-radius",this,r)+Au("circle-stroke-width",this,r)+Ju(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:c,transform:_,pixelsToTileUnits:g,unwrappedTileID:b,getElevation:T}){let k=Qu(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,g),B=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),z=this.paint.get("circle-pitch-alignment")==="map",V=z?k:function(K,Y,at,ft){return K.map(zt=>Gc(zt,Y,at,ft))}(k,_,b,T),H=z?B*g:B;for(let K of c)for(let Y of K){let at=z?Y:Gc(Y,_,b,T),ft=H,zt=_.projectTileCoordinates(Y.x,Y.y,b,T).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ft*=zt/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ft*=_.cameraToCenterDistance/zt),vf(V,at,ft))return!0}return!1}}function Gc(n,e,r,o){let c=e.projectTileCoordinates(n.x,n.y,r,o).point;return new ge((.5*c.x+.5)*e.width,(.5*-c.y+.5)*e.height)}class Zc extends Dh{}let Vc;De("HeatmapBucket",Zc,{omit:["layers"]});var Lf={get paint(){return Vc=Vc||new St({"heatmap-radius":new de(At.paint_heatmap["heatmap-radius"]),"heatmap-weight":new de(At.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jt(At.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bt(At.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jt(At.paint_heatmap["heatmap-opacity"])})}};function Oh(n,{width:e,height:r},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*r*o}`)}else c=new Uint8Array(e*r*o);return n.width=e,n.height=r,n.data=c,n}function Uc(n,{width:e,height:r},o){if(e===n.width&&r===n.height)return;let c=Oh({},{width:e,height:r},o);Fh(n,c,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,r)},o),n.width=e,n.height=r,n.data=c.data}function Fh(n,e,r,o,c,_){if(c.width===0||c.height===0)return e;if(c.width>n.width||c.height>n.height||r.x>n.width-c.width||r.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");let g=n.data,b=e.data;if(g===b)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<c.height;T++){let k=((r.y+T)*n.width+r.x)*_,B=((o.y+T)*e.width+o.x)*_;for(let z=0;z<c.width*_;z++)b[B+z]=g[k+z]}return e}class Iu{constructor(e,r){Oh(this,e,1,r)}resize(e){Uc(this,e,1)}clone(){return new Iu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,c,_){Fh(e,r,o,c,_,1)}}class Es{constructor(e,r){Oh(this,e,4,r)}resize(e){Uc(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Es({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,c,_){Fh(e,r,o,c,_,4)}setPixel(e,r,o){let c=4*(e*this.width+r);this.data[c+0]=Math.round(255*o.r/o.a),this.data[c+1]=Math.round(255*o.g/o.a),this.data[c+2]=Math.round(255*o.b/o.a),this.data[c+3]=Math.round(255*o.a)}}function $c(n){let e={},r=n.resolution||256,o=n.clips?n.clips.length:1,c=n.image||new Es({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);let _=(g,b,T)=>{e[n.evaluationKey]=T;let k=n.expression.evaluate(e);c.setPixel(g/4/r,b/4,k)};if(n.clips)for(let g=0,b=0;g<o;++g,b+=4*r)for(let T=0,k=0;T<r;T++,k+=4){let B=T/(r-1),{start:z,end:V}=n.clips[g];_(b,k,z*(1-B)+V*B)}else for(let g=0,b=0;g<r;g++,b+=4)_(0,b,g/(r-1));return c}De("AlphaImage",Iu),De("RGBAImage",Es);let Nh="big-fb";class Tf extends Jt{createBucket(e){return new Zc(e)}constructor(e){super(e,Lf),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$c({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Nh)&&this.heatmapFbos.delete(Nh)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let qc;var Pf={get paint(){return qc=qc||new St({"hillshade-illumination-direction":new jt(At.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new jt(At.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new jt(At.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jt(At.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jt(At.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jt(At.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jt(At.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new jt(At.paint_hillshade["hillshade-method"])})}};class Sf extends Jt{constructor(e){super(e,Pf),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,c=this.paint.get("hillshade-shadow-color").values,_=Math.max(e.length,r.length,o.length,c.length);e=e.concat(Array(_-e.length).fill(e.at(-1))),r=r.concat(Array(_-r.length).fill(r.at(-1))),o=o.concat(Array(_-o.length).fill(o.at(-1))),c=c.concat(Array(_-c.length).fill(c.at(-1)));let g=r.map(Kr);return{directionRadians:e.map(Kr),altitudeRadians:g,shadowColor:c,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Hc;var kf={get paint(){return Hc=Hc||new St({"color-relief-opacity":new jt(At["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new bt(At["paint_color-relief"]["color-relief-color"])})}};class jh{constructor(e,r,o,c){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(r,c)}update(e,r,o){let{width:c,height:_}=e,g=!(this.size&&this.size[0]===c&&this.size[1]===_||o),{context:b}=this,{gl:T}=b;if(this.useMipmap=!!(r&&r.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!r||r.premultiply!==!1)),g)this.size=[c,_],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Gn(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,c,_,0,this.format,T.UNSIGNED_BYTE,e.data);else{let{x:k,y:B}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Gn(e)?T.texSubImage2D(T.TEXTURE_2D,0,k,B,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,k,B,c,_,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),b.pixelStoreUnpackFlipY.setDefault(),b.pixelStoreUnpack.setDefault(),b.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,r,o){let{context:c}=this,{gl:_}=c;_.bindTexture(_.TEXTURE_2D,this.texture),o!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=_.LINEAR),e!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,e),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,o||e),this.filter=e),r!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,r),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Wc{constructor(e,r,o,c=1,_=1,g=1,b=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void fr(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;let T=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=_,this.blueFactor=g,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<T;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(T,k)]=this.data[this._idx(T-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,T)]=this.data[this._idx(k,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<T;k++)for(let B=0;B<T;B++){let z=this.get(k,B);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(e,r){let o=new Uint8Array(this.data.buffer),c=4*this._idx(e,r);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,o){return e*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return Kc(e,this.getUnpackVector())}getPixels(){return new Es({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,_=r*this.dim+this.dim,g=o*this.dim,b=o*this.dim+this.dim;switch(r){case-1:c=_-1;break;case 1:_=c+1}switch(o){case-1:g=b-1;break;case 1:b=g+1}let T=-r*this.dim,k=-o*this.dim;for(let B=g;B<b;B++)for(let z=c;z<_;z++)this.data[this._idx(z,B)]=e.data[this._idx(z+T,B+k)]}}function Kc(n,e){let r=e[0],o=e[1],c=e[2],_=e[3],g=Math.min(r,o,c),b=Math.round((n+_)/g);return{r:Math.floor(b*g/r)%256,g:Math.floor(b*g/o)%256,b:Math.floor(b*g/c)%256}}De("DEMData",Wc);class Ef extends Jt{constructor(e){super(e,kf)}_createColorRamp(e){let r={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof E&&o._styleExpression.expression instanceof Ar){this.colorRampExpression=o;let g=o._styleExpression.expression;r.elevationStops=g.labels,r.colorStops=[];for(let b of r.elevationStops)r.colorStops.push(g.evaluate({globals:{elevation:b}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[di.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=e)return r;let c={elevationStops:[],colorStops:[]},_=(r.elevationStops.length-1)/(e-1);for(let g=0;g<r.elevationStops.length-.5;g+=_)c.elevationStops.push(r.elevationStops[Math.round(g)]),c.colorStops.push(r.colorStops[Math.round(g)]);return fr(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),c}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,r,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;let c=this._createColorRamp(r),_=new Es({width:c.colorStops.length,height:1}),g=new Es({width:c.colorStops.length,height:1});for(let b=0;b<c.elevationStops.length;b++){let T=Kc(c.elevationStops[b],o);g.setPixel(0,b,new di(T.r/255,T.g/255,T.b/255,1)),_.setPixel(0,b,c.colorStops[b])}return this.colorRampTextures={elevationTexture:new jh(e,g,e.gl.RGBA),colorTexture:new jh(e,_,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}let Af=Q([{name:"a_pos",components:2,type:"Int16"}],4),{members:If}=Af;function Gh(n,e,r){let o=r.patternDependencies,c=!1;for(let _ of e){let g=_.paint.get(`${n}-pattern`);g.isConstant()||(c=!0);let b=g.constantOr(null);b&&(c=!0,o[b.to]=!0,o[b.from]=!0)}return c}function Zh(n,e,r,o,c){let _=c.patternDependencies;for(let g of e){let b=g.paint.get(`${n}-pattern`).value;if(b.kind!=="constant"){let T=b.evaluate({zoom:o-1},r,{},c.availableImages),k=b.evaluate({zoom:o},r,{},c.availableImages),B=b.evaluate({zoom:o+1},r,{},c.availableImages);T=T&&T.name?T.name:T,k=k&&k.name?k.name:k,B=B&&B.name?B.name:B,_[T]=!0,_[k]=!0,_[B]=!0,r.patterns[g.id]={min:T,mid:k,max:B}}}return r}function Xc(n,e,r,o,c){let _;if(c===function(g,b,T,k){let B=0;for(let z=b,V=T-k;z<T;z+=k)B+=(g[V]-g[z])*(g[z+1]+g[V+1]),V=z;return B}(n,e,r,o)>0)for(let g=e;g<r;g+=o)_=tp(g/o|0,n[g],n[g+1],_);else for(let g=r-o;g>=e;g-=o)_=tp(g/o|0,n[g],n[g+1],_);return _&&hu(_,_.next)&&(Ru(_),_=_.next),_}function Xl(n,e){if(!n)return n;e||(e=n);let r,o=n;do if(r=!1,o.steiner||!hu(o,o.next)&&Sr(o.prev,o,o.next)!==0)o=o.next;else{if(Ru(o),o=e=o.prev,o===o.next)break;r=!0}while(r||o!==e);return e}function Bu(n,e,r,o,c,_,g){if(!n)return;!g&&_&&function(T,k,B,z){let V=T;do V.z===0&&(V.z=Vh(V.x,V.y,k,B,z)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==T);V.prevZ.nextZ=null,V.prevZ=null,function(H){let K,Y=1;do{let at,ft=H;H=null;let zt=null;for(K=0;ft;){K++;let wt=ft,U=0;for(let Mt=0;Mt<Y&&(U++,wt=wt.nextZ,wt);Mt++);let st=Y;for(;U>0||st>0&&wt;)U!==0&&(st===0||!wt||ft.z<=wt.z)?(at=ft,ft=ft.nextZ,U--):(at=wt,wt=wt.nextZ,st--),zt?zt.nextZ=at:H=at,at.prevZ=zt,zt=at;ft=wt}zt.nextZ=null,Y*=2}while(K>1)}(V)}(n,o,c,_);let b=n;for(;n.prev!==n.next;){let T=n.prev,k=n.next;if(_?Df(n,o,c,_):Bf(n))e.push(T.i,n.i,k.i),Ru(n),n=k.next,b=k.next;else if((n=k)===b){g?g===1?Bu(n=zf(Xl(n),e),e,r,o,c,_,2):g===2&&Rf(n,e,r,o,c,_):Bu(Xl(n),e,r,o,c,_,1);break}}}function Bf(n){let e=n.prev,r=n,o=n.next;if(Sr(e,r,o)>=0)return!1;let c=e.x,_=r.x,g=o.x,b=e.y,T=r.y,k=o.y,B=Math.min(c,_,g),z=Math.min(b,T,k),V=Math.max(c,_,g),H=Math.max(b,T,k),K=o.next;for(;K!==e;){if(K.x>=B&&K.x<=V&&K.y>=z&&K.y<=H&&Du(c,b,_,T,g,k,K.x,K.y)&&Sr(K.prev,K,K.next)>=0)return!1;K=K.next}return!0}function Df(n,e,r,o){let c=n.prev,_=n,g=n.next;if(Sr(c,_,g)>=0)return!1;let b=c.x,T=_.x,k=g.x,B=c.y,z=_.y,V=g.y,H=Math.min(b,T,k),K=Math.min(B,z,V),Y=Math.max(b,T,k),at=Math.max(B,z,V),ft=Vh(H,K,e,r,o),zt=Vh(Y,at,e,r,o),wt=n.prevZ,U=n.nextZ;for(;wt&&wt.z>=ft&&U&&U.z<=zt;){if(wt.x>=H&&wt.x<=Y&&wt.y>=K&&wt.y<=at&&wt!==c&&wt!==g&&Du(b,B,T,z,k,V,wt.x,wt.y)&&Sr(wt.prev,wt,wt.next)>=0||(wt=wt.prevZ,U.x>=H&&U.x<=Y&&U.y>=K&&U.y<=at&&U!==c&&U!==g&&Du(b,B,T,z,k,V,U.x,U.y)&&Sr(U.prev,U,U.next)>=0))return!1;U=U.nextZ}for(;wt&&wt.z>=ft;){if(wt.x>=H&&wt.x<=Y&&wt.y>=K&&wt.y<=at&&wt!==c&&wt!==g&&Du(b,B,T,z,k,V,wt.x,wt.y)&&Sr(wt.prev,wt,wt.next)>=0)return!1;wt=wt.prevZ}for(;U&&U.z<=zt;){if(U.x>=H&&U.x<=Y&&U.y>=K&&U.y<=at&&U!==c&&U!==g&&Du(b,B,T,z,k,V,U.x,U.y)&&Sr(U.prev,U,U.next)>=0)return!1;U=U.nextZ}return!0}function zf(n,e){let r=n;do{let o=r.prev,c=r.next.next;!hu(o,c)&&Jc(o,r,r.next,c)&&zu(o,c)&&zu(c,o)&&(e.push(o.i,r.i,c.i),Ru(r),Ru(r.next),r=n=c),r=r.next}while(r!==n);return Xl(r)}function Rf(n,e,r,o,c,_){let g=n;do{let b=g.next.next;for(;b!==g.prev;){if(g.i!==b.i&&Gf(g,b)){let T=Qc(g,b);return g=Xl(g,g.next),T=Xl(T,T.next),Bu(g,e,r,o,c,_,0),void Bu(T,e,r,o,c,_,0)}b=b.next}g=g.next}while(g!==n)}function Of(n,e){let r=n.x-e.x;return r===0&&(r=n.y-e.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function Ff(n,e){let r=function(c,_){let g=_,b=c.x,T=c.y,k,B=-1/0;if(hu(c,g))return g;do{if(hu(c,g.next))return g.next;if(T<=g.y&&T>=g.next.y&&g.next.y!==g.y){let Y=g.x+(T-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(Y<=b&&Y>B&&(B=Y,k=g.x<g.next.x?g:g.next,Y===b))return k}g=g.next}while(g!==_);if(!k)return null;let z=k,V=k.x,H=k.y,K=1/0;g=k;do{if(b>=g.x&&g.x>=V&&b!==g.x&&Yc(T<H?b:B,T,V,H,T<H?B:b,T,g.x,g.y)){let Y=Math.abs(T-g.y)/(b-g.x);zu(g,c)&&(Y<K||Y===K&&(g.x>k.x||g.x===k.x&&Nf(k,g)))&&(k=g,K=Y)}g=g.next}while(g!==z);return k}(n,e);if(!r)return e;let o=Qc(r,n);return Xl(o,o.next),Xl(r,r.next)}function Nf(n,e){return Sr(n.prev,n,e.prev)<0&&Sr(e.next,n,n.next)<0}function Vh(n,e,r,o,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function jf(n){let e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function Yc(n,e,r,o,c,_,g,b){return(c-g)*(e-b)>=(n-g)*(_-b)&&(n-g)*(o-b)>=(r-g)*(e-b)&&(r-g)*(_-b)>=(c-g)*(o-b)}function Du(n,e,r,o,c,_,g,b){return!(n===g&&e===b)&&Yc(n,e,r,o,c,_,g,b)}function Gf(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,o){let c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==o.i&&c.next.i!==o.i&&Jc(c,c.next,r,o))return!0;c=c.next}while(c!==r);return!1}(n,e)&&(zu(n,e)&&zu(e,n)&&function(r,o){let c=r,_=!1,g=(r.x+o.x)/2,b=(r.y+o.y)/2;do c.y>b!=c.next.y>b&&c.next.y!==c.y&&g<(c.next.x-c.x)*(b-c.y)/(c.next.y-c.y)+c.x&&(_=!_),c=c.next;while(c!==r);return _}(n,e)&&(Sr(n.prev,n,e.prev)||Sr(n,e.prev,e))||hu(n,e)&&Sr(n.prev,n,n.next)>0&&Sr(e.prev,e,e.next)>0)}function Sr(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function hu(n,e){return n.x===e.x&&n.y===e.y}function Jc(n,e,r,o){let c=eh(Sr(n,e,r)),_=eh(Sr(n,e,o)),g=eh(Sr(r,o,n)),b=eh(Sr(r,o,e));return c!==_&&g!==b||!(c!==0||!th(n,r,e))||!(_!==0||!th(n,o,e))||!(g!==0||!th(r,n,o))||!(b!==0||!th(r,e,o))}function th(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function eh(n){return n>0?1:n<0?-1:0}function zu(n,e){return Sr(n.prev,n,n.next)<0?Sr(n,e,n.next)>=0&&Sr(n,n.prev,e)>=0:Sr(n,e,n.prev)<0||Sr(n,n.next,e)<0}function Qc(n,e){let r=Uh(n.i,n.x,n.y),o=Uh(e.i,e.x,e.y),c=n.next,_=e.prev;return n.next=e,e.prev=n,r.next=c,c.prev=r,o.next=r,r.prev=o,_.next=o,o.prev=_,o}function tp(n,e,r,o){let c=Uh(n,e,r);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function Ru(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Uh(n,e,r){return{i:n,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class cu{constructor(e,r){if(r>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=r}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class ih{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}ih.noSubdivision=new ih({fill:new cu(0,0),line:new cu(0,0),tile:new cu(0,0),stencil:new cu(0,0),circle:1}),De("SubdivisionGranularityExpression",cu),De("SubdivisionGranularitySetting",ih);let pu=-32768,Ou=32767;class Zf{constructor(e,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=ti/e,this._canonical=r}_getKey(e,r){return(e+=32768)<<16|r+32768}_vertexToIndex(e,r){if(e<-32768||r<-32768||e>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let o=0|Math.round(e),c=0|Math.round(r),_=this._getKey(o,c);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);let g=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,g),this._vertexBuffer.push(o,c),g}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(c,_){let g=[];for(let b=0;b<_.length;b+=3){let T=_[b],k=_[b+1],B=_[b+2],z=c[2*T],V=c[2*T+1];(c[2*k]-z)*(c[2*B+1]-V)-(c[2*k+1]-V)*(c[2*B]-z)>0?(g.push(T),g.push(B),g.push(k)):(g.push(T),g.push(k),g.push(B))}return g}(this._vertexBuffer,e);let r=[],o=e.length;for(let c=0;c<o;c+=3){let _=[e[c+0],e[c+1],e[c+2]],g=[this._vertexBuffer[2*e[c+0]+0],this._vertexBuffer[2*e[c+0]+1],this._vertexBuffer[2*e[c+1]+0],this._vertexBuffer[2*e[c+1]+1],this._vertexBuffer[2*e[c+2]+0],this._vertexBuffer[2*e[c+2]+1]],b=1/0,T=1/0,k=-1/0,B=-1/0;for(let Y=0;Y<3;Y++){let at=g[2*Y],ft=g[2*Y+1];b=Math.min(b,at),k=Math.max(k,at),T=Math.min(T,ft),B=Math.max(B,ft)}if(b===k||T===B)continue;let z=Math.floor(b/this._granularityCellSize),V=Math.ceil(k/this._granularityCellSize),H=Math.floor(T/this._granularityCellSize),K=Math.ceil(B/this._granularityCellSize);if(z!==V||H!==K)for(let Y=H;Y<K;Y++){let at=this._scanlineGenerateVertexRingForCellRow(Y,g,_);Vf(this._vertexBuffer,at,r)}else r.push(..._)}return r}_scanlineGenerateVertexRingForCellRow(e,r,o){let c=e*this._granularityCellSize,_=c+this._granularityCellSize,g=[];for(let b=0;b<3;b++){let T=r[2*b],k=r[2*b+1],B=r[2*(b+1)%6],z=r[(2*(b+1)+1)%6],V=r[2*(b+2)%6],H=r[(2*(b+2)+1)%6],K=B-T,Y=z-k,at=K===0,ft=Y===0,zt=(c-k)/Y,wt=(_-k)/Y,U=Math.min(zt,wt),st=Math.max(zt,wt);if(!ft&&(U>=1||st<=0)||ft&&(k<c||k>_)){z>=c&&z<=_&&g.push(o[(b+1)%3]);continue}!ft&&U>0&&g.push(this._vertexToIndex(T+K*U,k+Y*U));let Mt=T+K*Math.max(U,0),ae=T+K*Math.min(st,1);at||this._generateIntraEdgeVertices(g,T,k,B,z,Mt,ae),!ft&&st<1&&g.push(this._vertexToIndex(T+K*st,k+Y*st)),(ft||z>=c&&z<=_)&&g.push(o[(b+1)%3]),!ft&&(z<=c||z>=_)&&this._generateInterEdgeVertices(g,T,k,B,z,V,H,ae,c,_)}return g}_generateIntraEdgeVertices(e,r,o,c,_,g,b){let T=c-r,k=_-o,B=k===0,z=B?Math.min(r,c):Math.min(g,b),V=B?Math.max(r,c):Math.max(g,b),H=Math.floor(z/this._granularityCellSize)+1,K=Math.ceil(V/this._granularityCellSize)-1;if(B?r<c:g<b)for(let Y=H;Y<=K;Y++){let at=Y*this._granularityCellSize;e.push(this._vertexToIndex(at,o+k*(at-r)/T))}else for(let Y=K;Y>=H;Y--){let at=Y*this._granularityCellSize;e.push(this._vertexToIndex(at,o+k*(at-r)/T))}}_generateInterEdgeVertices(e,r,o,c,_,g,b,T,k,B){let z=_-o,V=g-c,H=b-_,K=(k-_)/H,Y=(B-_)/H,at=Math.min(K,Y),ft=Math.max(K,Y),zt=c+V*at,wt=Math.floor(Math.min(zt,T)/this._granularityCellSize)+1,U=Math.ceil(Math.max(zt,T)/this._granularityCellSize)-1,st=T<zt,Mt=H===0;if(Mt&&(b===k||b===B))return;if(Mt||at>=1||ft<=0){let ve=o-b,pe=g+(r-g)*Math.min((k-b)/ve,(B-b)/ve);wt=Math.floor(Math.min(pe,T)/this._granularityCellSize)+1,U=Math.ceil(Math.max(pe,T)/this._granularityCellSize)-1,st=T<pe}let ae=z>0?B:k;if(st)for(let ve=wt;ve<=U;ve++)e.push(this._vertexToIndex(ve*this._granularityCellSize,ae));else for(let ve=U;ve>=wt;ve--)e.push(this._vertexToIndex(ve*this._granularityCellSize,ae))}_generateOutline(e){let r=[];for(let o of e){let c=Yl(o,this._granularity,!0),_=this._pointArrayToIndices(c),g=[];for(let b=1;b<_.length;b++)g.push(_[b-1]),g.push(_[b]);r.push(g)}return r}_handlePoles(e){let r=!1,o=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(r||o)&&this._fillPoles(e,r,o)}_ensureNoPoleVertices(){let e=this._vertexBuffer;for(let r=0;r<e.length;r+=2){let o=e[r+1];o===pu&&(e[r+1]=-32767),o===Ou&&(e[r+1]=32766)}}_generatePoleQuad(e,r,o,c,_,g){c>_!=(g===pu)?(e.push(r),e.push(o),e.push(this._vertexToIndex(c,g)),e.push(o),e.push(this._vertexToIndex(_,g)),e.push(this._vertexToIndex(c,g))):(e.push(o),e.push(r),e.push(this._vertexToIndex(c,g)),e.push(this._vertexToIndex(_,g)),e.push(o),e.push(this._vertexToIndex(c,g)))}_fillPoles(e,r,o){let c=this._vertexBuffer,_=ti,g=e.length;for(let b=2;b<g;b+=3){let T=e[b-2],k=e[b-1],B=e[b],z=c[2*T],V=c[2*T+1],H=c[2*k],K=c[2*k+1],Y=c[2*B],at=c[2*B+1];r&&(V===0&&K===0&&this._generatePoleQuad(e,T,k,z,H,pu),K===0&&at===0&&this._generatePoleQuad(e,k,B,H,Y,pu),at===0&&V===0&&this._generatePoleQuad(e,B,T,Y,z,pu)),o&&(V===_&&K===_&&this._generatePoleQuad(e,T,k,z,H,Ou),K===_&&at===_&&this._generatePoleQuad(e,k,B,H,Y,Ou),at===_&&V===_&&this._generatePoleQuad(e,B,T,Y,z,Ou))}}_initializeVertices(e){for(let r=0;r<e.length;r+=2)this._vertexToIndex(e[r],e[r+1])}subdividePolygonInternal(e,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:o,holeIndices:c}=function(b){let T=[],k=[];for(let B of b)if(B.length!==0){B!==b[0]&&T.push(k.length/2);for(let z=0;z<B.length;z++)k.push(B[z].x),k.push(B[z].y)}return{flattened:k,holeIndices:T}}(e),_;this._initializeVertices(o);try{let b=function(k,B,z=2){let V=B&&B.length,H=V?B[0]*z:k.length,K=Xc(k,0,H,z,!0),Y=[];if(!K||K.next===K.prev)return Y;let at,ft,zt;if(V&&(K=function(wt,U,st,Mt){let ae=[];for(let ve=0,pe=U.length;ve<pe;ve++){let me=Xc(wt,U[ve]*Mt,ve<pe-1?U[ve+1]*Mt:wt.length,Mt,!1);me===me.next&&(me.steiner=!0),ae.push(jf(me))}ae.sort(Of);for(let ve=0;ve<ae.length;ve++)st=Ff(ae[ve],st);return st}(k,B,K,z)),k.length>80*z){at=1/0,ft=1/0;let wt=-1/0,U=-1/0;for(let st=z;st<H;st+=z){let Mt=k[st],ae=k[st+1];Mt<at&&(at=Mt),ae<ft&&(ft=ae),Mt>wt&&(wt=Mt),ae>U&&(U=ae)}zt=Math.max(wt-at,U-ft),zt=zt!==0?32767/zt:0}return Bu(K,Y,z,at,ft,zt,0),Y}(o,c),T=this._convertIndices(o,b);_=this._subdivideTrianglesScanline(T)}catch(b){console.error(b)}let g=[];return r&&(g=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:g}}_convertIndices(e,r){let o=[];for(let c=0;c<r.length;c++)o.push(this._vertexToIndex(e[2*r[c]],e[2*r[c]+1]));return o}_pointArrayToIndices(e){let r=[];for(let o=0;o<e.length;o++){let c=e[o];r.push(this._vertexToIndex(c.x,c.y))}return r}}function ep(n,e,r,o=!0){return new Zf(r,e).subdividePolygonInternal(n,o)}function Yl(n,e,r=!1){if(!n||n.length<1)return[];if(n.length<2)return[];let o=n[0],c=n[n.length-1],_=r&&(o.x!==c.x||o.y!==c.y);if(e<2)return _?[...n,n[0]]:[...n];let g=Math.floor(ti/e),b=[];b.push(new ge(n[0].x,n[0].y));let T=n.length,k=_?T:T-1;for(let B=0;B<k;B++){let z=n[B],V=B<T-1?n[B+1]:n[0],H=z.x,K=z.y,Y=V.x,at=V.y,ft=H!==Y,zt=K!==at;if(!ft&&!zt)continue;let wt=Y-H,U=at-K,st=Math.abs(wt),Mt=Math.abs(U),ae=H,ve=K;for(;;){let me=wt>0?(Math.floor(ae/g)+1)*g:(Math.ceil(ae/g)-1)*g,Me=U>0?(Math.floor(ve/g)+1)*g:(Math.ceil(ve/g)-1)*g,be=Math.abs(ae-me),Te=Math.abs(ve-Me),_e=Math.abs(ae-Y),Oe=Math.abs(ve-at),We=ft?be/st:Number.POSITIVE_INFINITY,Ue=zt?Te/Mt:Number.POSITIVE_INFINITY;if((_e<=be||!ft)&&(Oe<=Te||!zt))break;if(We<Ue&&ft||!zt){ae=me,ve+=U*We;let Ne=new ge(ae,Math.round(ve));b[b.length-1].x===Ne.x&&b[b.length-1].y===Ne.y||b.push(Ne)}else{ae+=wt*Ue,ve=Me;let Ne=new ge(Math.round(ae),ve);b[b.length-1].x===Ne.x&&b[b.length-1].y===Ne.y||b.push(Ne)}}let pe=new ge(Y,at);b[b.length-1].x===pe.x&&b[b.length-1].y===pe.y||b.push(pe)}return b}function Vf(n,e,r){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,c=n[2*e[0]];for(let T=1;T<e.length;T++){let k=n[2*e[T]];k<c&&(c=k,o=T)}let _=e.length,g=o,b=(g+1)%_;for(;;){let T=g-1>=0?g-1:_-1,k=(b+1)%_,B=n[2*e[T]],z=n[2*e[k]],V=n[2*e[g]],H=n[2*e[g]+1],K=n[2*e[b]+1],Y=!1;if(B<z)Y=!0;else if(B>z)Y=!1;else{let at=K-H,ft=-(n[2*e[b]]-V),zt=H<K?1:-1;((B-V)*at+(n[2*e[T]+1]-H)*ft)*zt>((z-V)*at+(n[2*e[k]+1]-H)*ft)*zt&&(Y=!0)}if(Y){let at=e[T],ft=e[g],zt=e[b];at!==ft&&at!==zt&&ft!==zt&&r.push(zt,ft,at),g--,g<0&&(g=_-1)}else{let at=e[k],ft=e[g],zt=e[b];at!==ft&&at!==zt&&ft!==zt&&r.push(zt,ft,at),b++,b>=_&&(b=0)}if(T===k)break}}function ip(n,e,r,o,c,_,g,b,T){let k=c.length/2,B=g&&b&&T;if(k<ki.MAX_VERTEX_ARRAY_LENGTH){let z=e.prepareSegment(k,r,o),V=z.vertexLength;for(let Y=0;Y<_.length;Y+=3)o.emplaceBack(V+_[Y],V+_[Y+1],V+_[Y+2]);let H,K;z.vertexLength+=k,z.primitiveLength+=_.length/3,B&&(K=g.prepareSegment(k,r,b),H=K.vertexLength,K.vertexLength+=k);for(let Y=0;Y<c.length;Y+=2)n(c[Y],c[Y+1]);if(B)for(let Y=0;Y<T.length;Y++){let at=T[Y];for(let ft=1;ft<at.length;ft+=2)b.emplaceBack(H+at[ft-1],H+at[ft]);K.primitiveLength+=at.length/2}}else(function(z,V,H,K,Y,at){let ft=[];for(let Mt=0;Mt<K.length/2;Mt++)ft.push(-1);let zt={count:0},wt=0,U=z.getOrCreateLatestSegment(V,H),st=U.vertexLength;for(let Mt=2;Mt<Y.length;Mt+=3){let ae=Y[Mt-2],ve=Y[Mt-1],pe=Y[Mt],me=ft[ae]<wt,Me=ft[ve]<wt,be=ft[pe]<wt;U.vertexLength+((me?1:0)+(Me?1:0)+(be?1:0))>ki.MAX_VERTEX_ARRAY_LENGTH&&(U=z.createNewSegment(V,H),wt=zt.count,me=!0,Me=!0,be=!0,st=0);let Te=Fu(ft,K,at,zt,ae,me,U),_e=Fu(ft,K,at,zt,ve,Me,U),Oe=Fu(ft,K,at,zt,pe,be,U);H.emplaceBack(st+Te-wt,st+_e-wt,st+Oe-wt),U.primitiveLength++}})(e,r,o,c,_,n),B&&function(z,V,H,K,Y,at){let ft=[];for(let Mt=0;Mt<K.length/2;Mt++)ft.push(-1);let zt={count:0},wt=0,U=z.getOrCreateLatestSegment(V,H),st=U.vertexLength;for(let Mt=0;Mt<Y.length;Mt++){let ae=Y[Mt];for(let ve=1;ve<Y[Mt].length;ve+=2){let pe=ae[ve-1],me=ae[ve],Me=ft[pe]<wt,be=ft[me]<wt;U.vertexLength+((Me?1:0)+(be?1:0))>ki.MAX_VERTEX_ARRAY_LENGTH&&(U=z.createNewSegment(V,H),wt=zt.count,Me=!0,be=!0,st=0);let Te=Fu(ft,K,at,zt,pe,Me,U),_e=Fu(ft,K,at,zt,me,be,U);H.emplaceBack(st+Te-wt,st+_e-wt),U.primitiveLength++}}}(g,r,b,c,T,n),e.forceNewSegmentOnNextPrepare(),g?.forceNewSegmentOnNextPrepare()}function Fu(n,e,r,o,c,_,g){if(_){let b=o.count;return r(e[2*c],e[2*c+1]),n[c]=o.count,o.count++,g.vertexLength++,b}return n[c]}class $h{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new he,this.indexArray=new qi,this.indexArray2=new Ui,this.programConfigurations=new Va(e.layers,e.zoom),this.segments=new ki,this.segments2=new ki,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=Gh("fill",this.layers,r);let c=this.layers[0].layout.get("fill-sort-key"),_=!c.isConstant(),g=[];for(let{feature:b,id:T,index:k,sourceLayerIndex:B}of e){let z=this.layers[0]._featureFilter.needGeometry,V=Kl(b,z);if(!this.layers[0]._featureFilter.filter(new A(this.zoom,{globalState:this.globalState}),V,o))continue;let H=_?c.evaluate(V,{},o,r.availableImages):void 0,K={id:T,properties:b.properties,type:b.type,sourceLayerIndex:B,index:k,geometry:z?V.geometry:Wl(b),patterns:{},sortKey:H};g.push(K)}_&&g.sort((b,T)=>b.sortKey-T.sortKey);for(let b of g){let{geometry:T,index:k,sourceLayerIndex:B}=b;if(this.hasPattern){let z=Zh("fill",this.layers,b,this.zoom,r);this.patternFeatures.push(z)}else this.addFeature(b,T,k,o,{},r.subdivisionGranularity);r.featureIndex.insert(e[k].feature,T,k,B,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(let c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,If),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,o,c,_,g){for(let b of yn(r,500)){let T=ep(b,c,g.fill.getGranularityForZoomLevel(c.z)),k=this.layoutVertexArray;ip((B,z)=>{k.emplaceBack(B,z)},this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,_,c)}}let rp,np;De("FillBucket",$h,{omit:["layers","patternFeatures"]});var Uf={get paint(){return np=np||new St({"fill-antialias":new jt(At.paint_fill["fill-antialias"]),"fill-opacity":new de(At.paint_fill["fill-opacity"]),"fill-color":new de(At.paint_fill["fill-color"]),"fill-outline-color":new de(At.paint_fill["fill-outline-color"]),"fill-translate":new jt(At.paint_fill["fill-translate"]),"fill-translate-anchor":new jt(At.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fe(At.paint_fill["fill-pattern"])})},get layout(){return rp=rp||new St({"fill-sort-key":new de(At.layout_fill["fill-sort-key"])})}};class $f extends Jt{constructor(e){super(e,Uf)}recalculate(e,r){super.recalculate(e,r);let o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new $h(e)}queryRadius(){return Ju(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:r,transform:o,pixelsToTileUnits:c}){return Rc(Qu(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,c),r)}isTileClipped(){return!0}}let qf=Q([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Hf=Q([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Wf}=qf;var qh,sp,Hh,op,Wh,ap,lp,rh={};function up(){if(sp)return qh;sp=1;var n=Kt();function e(c,_,g,b,T){this.properties={},this.extent=g,this.type=0,this._pbf=c,this._geometry=-1,this._keys=b,this._values=T,c.readFields(r,this,_)}function r(c,_,g){c==1?_.id=g.readVarint():c==2?function(b,T){for(var k=b.readVarint()+b.pos;b.pos<k;){var B=T._keys[b.readVarint()],z=T._values[b.readVarint()];T.properties[B]=z}}(g,_):c==3?_.type=g.readVarint():c==4&&(_._geometry=g.pos)}function o(c){for(var _,g,b=0,T=0,k=c.length,B=k-1;T<k;B=T++)b+=((g=c[B]).x-(_=c[T]).x)*(_.y+g.y);return b}return qh=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var _,g=c.readVarint()+c.pos,b=1,T=0,k=0,B=0,z=[];c.pos<g;){if(T<=0){var V=c.readVarint();b=7&V,T=V>>3}if(T--,b===1||b===2)k+=c.readSVarint(),B+=c.readSVarint(),b===1&&(_&&z.push(_),_=[]),_.push(new n(k,B));else{if(b!==7)throw new Error("unknown command "+b);_&&_.push(_[0].clone())}}return _&&z.push(_),z},e.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var _=c.readVarint()+c.pos,g=1,b=0,T=0,k=0,B=1/0,z=-1/0,V=1/0,H=-1/0;c.pos<_;){if(b<=0){var K=c.readVarint();g=7&K,b=K>>3}if(b--,g===1||g===2)(T+=c.readSVarint())<B&&(B=T),T>z&&(z=T),(k+=c.readSVarint())<V&&(V=k),k>H&&(H=k);else if(g!==7)throw new Error("unknown command "+g)}return[B,V,z,H]},e.prototype.toGeoJSON=function(c,_,g){var b,T,k=this.extent*Math.pow(2,g),B=this.extent*c,z=this.extent*_,V=this.loadGeometry(),H=e.types[this.type];function K(ft){for(var zt=0;zt<ft.length;zt++){var wt=ft[zt];ft[zt]=[360*(wt.x+B)/k-180,360/Math.PI*Math.atan(Math.exp((180-360*(wt.y+z)/k)*Math.PI/180))-90]}}switch(this.type){case 1:var Y=[];for(b=0;b<V.length;b++)Y[b]=V[b][0];K(V=Y);break;case 2:for(b=0;b<V.length;b++)K(V[b]);break;case 3:for(V=function(ft){var zt=ft.length;if(zt<=1)return[ft];for(var wt,U,st=[],Mt=0;Mt<zt;Mt++){var ae=o(ft[Mt]);ae!==0&&(U===void 0&&(U=ae<0),U===ae<0?(wt&&st.push(wt),wt=[ft[Mt]]):wt.push(ft[Mt]))}return wt&&st.push(wt),st}(V),b=0;b<V.length;b++)for(T=0;T<V[b].length;T++)K(V[b][T])}V.length===1?V=V[0]:H="Multi"+H;var at={type:"Feature",geometry:{type:H,coordinates:V},properties:this.properties};return"id"in this&&(at.id=this.id),at},qh}function hp(){if(op)return Hh;op=1;var n=up();function e(o,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(r,this,c),this.length=this._features.length}function r(o,c,_){o===15?c.version=_.readVarint():o===1?c.name=_.readString():o===5?c.extent=_.readVarint():o===2?c._features.push(_.pos):o===3?c._keys.push(_.readString()):o===4&&c._values.push(function(g){for(var b=null,T=g.readVarint()+g.pos;g.pos<T;){var k=g.readVarint()>>3;b=k===1?g.readString():k===2?g.readFloat():k===3?g.readDouble():k===4?g.readVarint64():k===5?g.readVarint():k===6?g.readSVarint():k===7?g.readBoolean():null}return b}(_))}return Hh=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var c=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,c,this.extent,this._keys,this._values)},Hh}function cp(){return lp||(lp=1,rh.VectorTile=function(){if(ap)return Wh;ap=1;var n=hp();function e(r,o,c){if(r===3){var _=new n(c,c.readVarint()+c.pos);_.length&&(o[_.name]=_)}}return Wh=function(r,o){this.layers=r.readFields(e,{},o)},Wh}(),rh.VectorTileFeature=up(),rh.VectorTileLayer=hp()),rh}var Nu=rt(cp());let Kf=Nu.VectorTileFeature.types,Kh=Math.pow(2,13);function ju(n,e,r,o,c,_,g,b){n.emplaceBack(e,r,2*Math.floor(o*Kh)+g,c*Kh*2,_*Kh*2,Math.round(b))}class Xh{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ee,this.centroidVertexArray=new te,this.indexArray=new qi,this.programConfigurations=new Va(e.layers,e.zoom),this.segments=new ki,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.features=[],this.hasPattern=Gh("fill-extrusion",this.layers,r);for(let{feature:c,id:_,index:g,sourceLayerIndex:b}of e){let T=this.layers[0]._featureFilter.needGeometry,k=Kl(c,T);if(!this.layers[0]._featureFilter.filter(new A(this.zoom,{globalState:this.globalState}),k,o))continue;let B={id:_,sourceLayerIndex:b,index:g,geometry:T?k.geometry:Wl(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Zh("fill-extrusion",this.layers,B,this.zoom,r)):this.addFeature(B,B.geometry,g,o,{},r.subdivisionGranularity),r.featureIndex.insert(c,B.geometry,g,b,this.index,!0)}}addFeatures(e,r,o){for(let c of this.features){let{geometry:_}=c;this.addFeature(c,_,c.index,r,o,e.subdivisionGranularity)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wf),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Hf.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,o,c,_,g){for(let b of yn(r,500)){let T={x:0,y:0,sampleCount:0},k=this.layoutVertexArray.length;this.processPolygon(T,c,e,b,g);let B=this.layoutVertexArray.length-k,z=Math.floor(T.x/T.sampleCount),V=Math.floor(T.y/T.sampleCount);for(let H=0;H<B;H++)this.centroidVertexArray.emplaceBack(z,V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,_,c)}processPolygon(e,r,o,c,_){if(c.length<1||pp(c[0]))return;for(let z of c)z.length!==0&&Xf(e,z);let g={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},b=_.fill.getGranularityForZoomLevel(r.z),T=Kf[o.type]==="Polygon";for(let z of c){if(z.length===0||pp(z))continue;let V=Yl(z,b,T);this._generateSideFaces(V,g)}if(!T)return;let k=ep(c,r,b,!1),B=this.layoutVertexArray;ip((z,V)=>{ju(B,z,V,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,k.verticesFlattened,k.indicesTriangles)}_generateSideFaces(e,r){let o=0;for(let c=1;c<e.length;c++){let _=e[c],g=e[c-1];if(Yf(_,g))continue;r.segment.vertexLength+4>ki.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let b=_.sub(g)._perp()._unit(),T=g.dist(_);o+T>32768&&(o=0),ju(this.layoutVertexArray,_.x,_.y,b.x,b.y,0,0,o),ju(this.layoutVertexArray,_.x,_.y,b.x,b.y,0,1,o),o+=T,ju(this.layoutVertexArray,g.x,g.y,b.x,b.y,0,0,o),ju(this.layoutVertexArray,g.x,g.y,b.x,b.y,0,1,o);let k=r.segment.vertexLength;this.indexArray.emplaceBack(k,k+2,k+1),this.indexArray.emplaceBack(k+1,k+2,k+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Xf(n,e){for(let r=0;r<e.length;r++){let o=e[r];r===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function Yf(n,e){return n.x===e.x&&(n.x<0||n.x>ti)||n.y===e.y&&(n.y<0||n.y>ti)}function pp(n){return n.every(e=>e.x<0)||n.every(e=>e.x>ti)||n.every(e=>e.y<0)||n.every(e=>e.y>ti)}let dp;De("FillExtrusionBucket",Xh,{omit:["layers","features"]});var Jf={get paint(){return dp=dp||new St({"fill-extrusion-opacity":new jt(At["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new de(At["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jt(At["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jt(At["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fe(At["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new de(At["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new de(At["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jt(At["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Qf extends Jt{constructor(e){super(e,Jf)}createBucket(e){return new Xh(e)}queryRadius(){return Ju(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:c,transform:_,pixelsToTileUnits:g,pixelPosMatrix:b}){let T=Qu(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,g),k=this.paint.get("fill-extrusion-height").evaluate(r,o),B=this.paint.get("fill-extrusion-base").evaluate(r,o),z=function(H,K){let Y=[];for(let at of H){let ft=[at.x,at.y,0,1];Nn(ft,ft,K),Y.push(new ge(ft[0]/ft[3],ft[1]/ft[3]))}return Y}(T,b),V=function(H,K,Y,at){let ft=[],zt=[],wt=at[8]*K,U=at[9]*K,st=at[10]*K,Mt=at[11]*K,ae=at[8]*Y,ve=at[9]*Y,pe=at[10]*Y,me=at[11]*Y;for(let Me of H){let be=[],Te=[];for(let _e of Me){let Oe=_e.x,We=_e.y,Ue=at[0]*Oe+at[4]*We+at[12],Ne=at[1]*Oe+at[5]*We+at[13],Li=at[2]*Oe+at[6]*We+at[14],mr=at[3]*Oe+at[7]*We+at[15],qr=Li+st,On=mr+Mt,Io=Ue+ae,As=Ne+ve,Mn=Li+pe,pr=mr+me,an=new ge((Ue+wt)/On,(Ne+U)/On);an.z=qr/On,be.push(an);let Ln=new ge(Io/pr,As/pr);Ln.z=Mn/pr,Te.push(Ln)}ft.push(be),zt.push(Te)}return[ft,zt]}(c,B,k,b);return function(H,K,Y){let at=1/0;Rc(Y,K)&&(at=fp(Y,K[0]));for(let ft=0;ft<K.length;ft++){let zt=K[ft],wt=H[ft];for(let U=0;U<zt.length-1;U++){let st=zt[U],Mt=[st,zt[U+1],wt[U+1],wt[U],st];zc(Y,Mt)&&(at=Math.min(at,fp(Y,Mt)))}}return at!==1/0&&at}(V[0],V[1],z)}}function Gu(n,e){return n.x*e.x+n.y*e.y}function fp(n,e){if(n.length===1){let r=0,o=e[r++],c;for(;!c||o.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){let _=e[r],g=n[0],b=c.sub(o),T=_.sub(o),k=g.sub(o),B=Gu(b,b),z=Gu(b,T),V=Gu(T,T),H=Gu(k,b),K=Gu(k,T),Y=B*V-z*z,at=(V*H-z*K)/Y,ft=(B*K-z*H)/Y,zt=o.z*(1-at-ft)+c.z*at+_.z*ft;if(isFinite(zt))return zt}return 1/0}{let r=1/0;for(let o of e)r=Math.min(r,o.z);return r}}let tm=Q([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:em}=tm,im=Q([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:rm}=im,nm=Nu.VectorTileFeature.types,sm=Math.cos(Math.PI/180*37.5),mp=Math.pow(2,14)/.5;class Yh{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ke,this.layoutVertexArray2=new xe,this.indexArray=new qi,this.programConfigurations=new Va(e.layers,e.zoom),this.segments=new ki,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,o){this.hasPattern=Gh("line",this.layers,r);let c=this.layers[0].layout.get("line-sort-key"),_=!c.isConstant(),g=[];for(let{feature:b,id:T,index:k,sourceLayerIndex:B}of e){let z=this.layers[0]._featureFilter.needGeometry,V=Kl(b,z);if(!this.layers[0]._featureFilter.filter(new A(this.zoom,{globalState:this.globalState}),V,o))continue;let H=_?c.evaluate(V,{},o):void 0,K={id:T,properties:b.properties,type:b.type,sourceLayerIndex:B,index:k,geometry:z?V.geometry:Wl(b),patterns:{},sortKey:H};g.push(K)}_&&g.sort((b,T)=>b.sortKey-T.sortKey);for(let b of g){let{geometry:T,index:k,sourceLayerIndex:B}=b;if(this.hasPattern){let z=Zh("line",this.layers,b,this.zoom,r);this.patternFeatures.push(z)}else this.addFeature(b,T,k,o,{},r.subdivisionGranularity);r.featureIndex.insert(e[k].feature,T,k,B,this.index)}}update(e,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,o)}addFeatures(e,r,o){for(let c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,rm)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,em),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,o,c,_,g){let b=this.layers[0].layout,T=b.get("line-join").evaluate(e,{}),k=b.get("line-cap"),B=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let V of r)this.addLine(V,e,T,k,B,z,c,g);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,_,c)}addLine(e,r,o,c,_,g,b,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Yl(e,b?T.line.getGranularityForZoomLevel(b.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let wt=0;wt<e.length-1;wt++)this.totalDistance+=e[wt].dist(e[wt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let k=nm[r.type]==="Polygon",B=e.length;for(;B>=2&&e[B-1].equals(e[B-2]);)B--;let z=0;for(;z<B-1&&e[z].equals(e[z+1]);)z++;if(B<(k?3:2))return;o==="bevel"&&(_=1.05);let V=this.overscaling<=16?122880/(512*this.overscaling):0,H=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray),K,Y,at,ft,zt;this.e1=this.e2=-1,k&&(K=e[B-2],zt=e[z].sub(K)._unit()._perp());for(let wt=z;wt<B;wt++){if(at=wt===B-1?k?e[z+1]:void 0:e[wt+1],at&&e[wt].equals(at))continue;zt&&(ft=zt),K&&(Y=K),K=e[wt],zt=at?at.sub(K)._unit()._perp():ft,ft=ft||zt;let U=ft.add(zt);U.x===0&&U.y===0||U._unit();let st=ft.x*zt.x+ft.y*zt.y,Mt=U.x*zt.x+U.y*zt.y,ae=Mt!==0?1/Mt:1/0,ve=2*Math.sqrt(2-2*Mt),pe=Mt<sm&&Y&&at,me=ft.x*zt.y-ft.y*zt.x>0;if(pe&&wt>z){let Te=K.dist(Y);if(Te>2*V){let _e=K.sub(K.sub(Y)._mult(V/Te)._round());this.updateDistance(Y,_e),this.addCurrentVertex(_e,ft,0,0,H),Y=_e}}let Me=Y&&at,be=Me?o:k?"butt":c;if(Me&&be==="round"&&(ae<g?be="miter":ae<=2&&(be="fakeround")),be==="miter"&&ae>_&&(be="bevel"),be==="bevel"&&(ae>2&&(be="flipbevel"),ae<_&&(be="miter")),Y&&this.updateDistance(Y,K),be==="miter")U._mult(ae),this.addCurrentVertex(K,U,0,0,H);else if(be==="flipbevel"){if(ae>100)U=zt.mult(-1);else{let Te=ae*ft.add(zt).mag()/ft.sub(zt).mag();U._perp()._mult(Te*(me?-1:1))}this.addCurrentVertex(K,U,0,0,H),this.addCurrentVertex(K,U.mult(-1),0,0,H)}else if(be==="bevel"||be==="fakeround"){let Te=-Math.sqrt(ae*ae-1),_e=me?Te:0,Oe=me?0:Te;if(Y&&this.addCurrentVertex(K,ft,_e,Oe,H),be==="fakeround"){let We=Math.round(180*ve/Math.PI/20);for(let Ue=1;Ue<We;Ue++){let Ne=Ue/We;if(Ne!==.5){let mr=Ne-.5;Ne+=Ne*mr*(Ne-1)*((1.0904+st*(st*(3.55645-1.43519*st)-3.2452))*mr*mr+(.848013+st*(.215638*st-1.06021)))}let Li=zt.sub(ft)._mult(Ne)._add(ft)._unit()._mult(me?-1:1);this.addHalfVertex(K,Li.x,Li.y,!1,me,0,H)}}at&&this.addCurrentVertex(K,zt,-_e,-Oe,H)}else if(be==="butt")this.addCurrentVertex(K,U,0,0,H);else if(be==="square"){let Te=Y?1:-1;this.addCurrentVertex(K,U,Te,Te,H)}else be==="round"&&(Y&&(this.addCurrentVertex(K,ft,0,0,H),this.addCurrentVertex(K,ft,1,1,H,!0)),at&&(this.addCurrentVertex(K,zt,-1,-1,H,!0),this.addCurrentVertex(K,zt,0,0,H)));if(pe&&wt<B-1){let Te=K.dist(at);if(Te>2*V){let _e=K.add(at.sub(K)._mult(V/Te)._round());this.updateDistance(K,_e),this.addCurrentVertex(_e,zt,0,0,H),K=_e}}}}addCurrentVertex(e,r,o,c,_,g=!1){let b=r.y*c-r.x,T=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*o,r.y-r.x*o,g,!1,o,_),this.addHalfVertex(e,b,T,g,!0,-c,_),this.distance>mp/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,o,c,_,g))}addHalfVertex({x:e,y:r},o,c,_,g,b,T){let k=.5*(this.lineClips?this.scaledDistance*(mp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(_?1:0),(r<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(b===0?0:b<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let B=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,B,this.e2),T.primitiveLength++),g?this.e2=B:this.e1=B}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let _p,gp;De("LineBucket",Yh,{omit:["layers","patternFeatures"]});var yp={get paint(){return gp=gp||new St({"line-opacity":new de(At.paint_line["line-opacity"]),"line-color":new de(At.paint_line["line-color"]),"line-translate":new jt(At.paint_line["line-translate"]),"line-translate-anchor":new jt(At.paint_line["line-translate-anchor"]),"line-width":new de(At.paint_line["line-width"]),"line-gap-width":new de(At.paint_line["line-gap-width"]),"line-offset":new de(At.paint_line["line-offset"]),"line-blur":new de(At.paint_line["line-blur"]),"line-dasharray":new Mi(At.paint_line["line-dasharray"]),"line-pattern":new Fe(At.paint_line["line-pattern"]),"line-gradient":new bt(At.paint_line["line-gradient"])})},get layout(){return _p=_p||new St({"line-cap":new jt(At.layout_line["line-cap"]),"line-join":new de(At.layout_line["line-join"]),"line-miter-limit":new jt(At.layout_line["line-miter-limit"]),"line-round-limit":new jt(At.layout_line["line-round-limit"]),"line-sort-key":new de(At.layout_line["line-sort-key"])})}};class om extends de{possiblyEvaluate(e,r){return r=new A(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,o,c){return r=yr({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,o,c)}}let nh;class am extends Jt{constructor(e){super(e,yp),this.gradientVersion=0,nh||(nh=new om(yp.paint.properties["line-width"].specification),nh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){let r=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Go,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=nh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Yh(e)}queryRadius(e){let r=e,o=vp(Au("line-width",this,r),Au("line-gap-width",this,r)),c=Au("line-offset",this,r);return o/2+Math.abs(c)+Ju(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:o,geometry:c,transform:_,pixelsToTileUnits:g}){let b=Qu(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,g),T=g/2*vp(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),k=this.paint.get("line-offset").evaluate(r,o);return k&&(c=function(B,z){let V=[];for(let H=0;H<B.length;H++){let K=B[H],Y=[];for(let at=0;at<K.length;at++){let ft=K[at-1],zt=K[at],wt=K[at+1],U=at===0?new ge(0,0):zt.sub(ft)._unit()._perp(),st=at===K.length-1?new ge(0,0):wt.sub(zt)._unit()._perp(),Mt=U._add(st)._unit(),ae=Mt.x*st.x+Mt.y*st.y;ae!==0&&Mt._mult(1/ae),Y.push(Mt._mult(z)._add(zt))}V.push(Y)}return V}(c,k*g)),function(B,z,V){for(let H=0;H<z.length;H++){let K=z[H];if(B.length>=3){for(let Y=0;Y<K.length;Y++)if(uu(B,K[Y]))return!0}if(xf(B,K,V))return!0}return!1}(b,c,T)}isTileClipped(){return!0}}function vp(n,e){return e>0?e+2*n:n}let lm=Q([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),um=Q([{name:"a_projected_pos",components:3,type:"Float32"}],4);Q([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let hm=Q([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Q([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let xp=Q([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cm=Q([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function pm(n,e,r){return n.sections.forEach(o=>{o.text=function(c,_,g){let b=_.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?c=c.toLocaleUpperCase():b==="lowercase"&&(c=c.toLocaleLowerCase()),M.applyArabicShaping&&(c=M.applyArabicShaping(c)),c}(o.text,e,r)}),n}Q([{name:"triangle",components:3,type:"Uint16"}]),Q([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Q([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Q([{type:"Float32",name:"offsetX"}]),Q([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Q([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let Zu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var bp,Jh,wp,on=24,Qh={};function dm(){return bp||(bp=1,Qh.read=function(n,e,r,o,c){var _,g,b=8*c-o-1,T=(1<<b)-1,k=T>>1,B=-7,z=r?c-1:0,V=r?-1:1,H=n[e+z];for(z+=V,_=H&(1<<-B)-1,H>>=-B,B+=b;B>0;_=256*_+n[e+z],z+=V,B-=8);for(g=_&(1<<-B)-1,_>>=-B,B+=o;B>0;g=256*g+n[e+z],z+=V,B-=8);if(_===0)_=1-k;else{if(_===T)return g?NaN:1/0*(H?-1:1);g+=Math.pow(2,o),_-=k}return(H?-1:1)*g*Math.pow(2,_-o)},Qh.write=function(n,e,r,o,c,_){var g,b,T,k=8*_-c-1,B=(1<<k)-1,z=B>>1,V=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=o?0:_-1,K=o?1:-1,Y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,g=B):(g=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-g))<1&&(g--,T*=2),(e+=g+z>=1?V/T:V*Math.pow(2,1-z))*T>=2&&(g++,T/=2),g+z>=B?(b=0,g=B):g+z>=1?(b=(e*T-1)*Math.pow(2,c),g+=z):(b=e*Math.pow(2,z-1)*Math.pow(2,c),g=0));c>=8;n[r+H]=255&b,H+=K,b/=256,c-=8);for(g=g<<c|b,k+=c;k>0;n[r+H]=255&g,H+=K,g/=256,k-=8);n[r+H-K]|=128*Y}),Qh}function Cp(){if(wp)return Jh;wp=1,Jh=e;var n=dm();function e(U){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(U)?U:new Uint8Array(U||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=4294967296,o=1/r,c=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function _(U){return U.type===e.Bytes?U.readVarint()+U.pos:U.pos+1}function g(U,st,Mt){return Mt?4294967296*st+(U>>>0):4294967296*(st>>>0)+(U>>>0)}function b(U,st,Mt){var ae=st<=16383?1:st<=2097151?2:st<=268435455?3:Math.floor(Math.log(st)/(7*Math.LN2));Mt.realloc(ae);for(var ve=Mt.pos-1;ve>=U;ve--)Mt.buf[ve+ae]=Mt.buf[ve]}function T(U,st){for(var Mt=0;Mt<U.length;Mt++)st.writeVarint(U[Mt])}function k(U,st){for(var Mt=0;Mt<U.length;Mt++)st.writeSVarint(U[Mt])}function B(U,st){for(var Mt=0;Mt<U.length;Mt++)st.writeFloat(U[Mt])}function z(U,st){for(var Mt=0;Mt<U.length;Mt++)st.writeDouble(U[Mt])}function V(U,st){for(var Mt=0;Mt<U.length;Mt++)st.writeBoolean(U[Mt])}function H(U,st){for(var Mt=0;Mt<U.length;Mt++)st.writeFixed32(U[Mt])}function K(U,st){for(var Mt=0;Mt<U.length;Mt++)st.writeSFixed32(U[Mt])}function Y(U,st){for(var Mt=0;Mt<U.length;Mt++)st.writeFixed64(U[Mt])}function at(U,st){for(var Mt=0;Mt<U.length;Mt++)st.writeSFixed64(U[Mt])}function ft(U,st){return(U[st]|U[st+1]<<8|U[st+2]<<16)+16777216*U[st+3]}function zt(U,st,Mt){U[Mt]=st,U[Mt+1]=st>>>8,U[Mt+2]=st>>>16,U[Mt+3]=st>>>24}function wt(U,st){return(U[st]|U[st+1]<<8|U[st+2]<<16)+(U[st+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(U,st,Mt){for(Mt=Mt||this.length;this.pos<Mt;){var ae=this.readVarint(),ve=ae>>3,pe=this.pos;this.type=7&ae,U(ve,st,this),this.pos===pe&&this.skip(ae)}return st},readMessage:function(U,st){return this.readFields(U,st,this.readVarint()+this.pos)},readFixed32:function(){var U=ft(this.buf,this.pos);return this.pos+=4,U},readSFixed32:function(){var U=wt(this.buf,this.pos);return this.pos+=4,U},readFixed64:function(){var U=ft(this.buf,this.pos)+ft(this.buf,this.pos+4)*r;return this.pos+=8,U},readSFixed64:function(){var U=ft(this.buf,this.pos)+wt(this.buf,this.pos+4)*r;return this.pos+=8,U},readFloat:function(){var U=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,U},readDouble:function(){var U=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,U},readVarint:function(U){var st,Mt,ae=this.buf;return st=127&(Mt=ae[this.pos++]),Mt<128?st:(st|=(127&(Mt=ae[this.pos++]))<<7,Mt<128?st:(st|=(127&(Mt=ae[this.pos++]))<<14,Mt<128?st:(st|=(127&(Mt=ae[this.pos++]))<<21,Mt<128?st:function(ve,pe,me){var Me,be,Te=me.buf;if(Me=(112&(be=Te[me.pos++]))>>4,be<128||(Me|=(127&(be=Te[me.pos++]))<<3,be<128)||(Me|=(127&(be=Te[me.pos++]))<<10,be<128)||(Me|=(127&(be=Te[me.pos++]))<<17,be<128)||(Me|=(127&(be=Te[me.pos++]))<<24,be<128)||(Me|=(1&(be=Te[me.pos++]))<<31,be<128))return g(ve,Me,pe);throw new Error("Expected varint not more than 10 bytes")}(st|=(15&(Mt=ae[this.pos]))<<28,U,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var U=this.readVarint();return U%2==1?(U+1)/-2:U/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var U=this.readVarint()+this.pos,st=this.pos;return this.pos=U,U-st>=12&&c?function(Mt,ae,ve){return c.decode(Mt.subarray(ae,ve))}(this.buf,st,U):function(Mt,ae,ve){for(var pe="",me=ae;me<ve;){var Me,be,Te,_e=Mt[me],Oe=null,We=_e>239?4:_e>223?3:_e>191?2:1;if(me+We>ve)break;We===1?_e<128&&(Oe=_e):We===2?(192&(Me=Mt[me+1]))==128&&(Oe=(31&_e)<<6|63&Me)<=127&&(Oe=null):We===3?(be=Mt[me+2],(192&(Me=Mt[me+1]))==128&&(192&be)==128&&((Oe=(15&_e)<<12|(63&Me)<<6|63&be)<=2047||Oe>=55296&&Oe<=57343)&&(Oe=null)):We===4&&(be=Mt[me+2],Te=Mt[me+3],(192&(Me=Mt[me+1]))==128&&(192&be)==128&&(192&Te)==128&&((Oe=(15&_e)<<18|(63&Me)<<12|(63&be)<<6|63&Te)<=65535||Oe>=1114112)&&(Oe=null)),Oe===null?(Oe=65533,We=1):Oe>65535&&(Oe-=65536,pe+=String.fromCharCode(Oe>>>10&1023|55296),Oe=56320|1023&Oe),pe+=String.fromCharCode(Oe),me+=We}return pe}(this.buf,st,U)},readBytes:function(){var U=this.readVarint()+this.pos,st=this.buf.subarray(this.pos,U);return this.pos=U,st},readPackedVarint:function(U,st){if(this.type!==e.Bytes)return U.push(this.readVarint(st));var Mt=_(this);for(U=U||[];this.pos<Mt;)U.push(this.readVarint(st));return U},readPackedSVarint:function(U){if(this.type!==e.Bytes)return U.push(this.readSVarint());var st=_(this);for(U=U||[];this.pos<st;)U.push(this.readSVarint());return U},readPackedBoolean:function(U){if(this.type!==e.Bytes)return U.push(this.readBoolean());var st=_(this);for(U=U||[];this.pos<st;)U.push(this.readBoolean());return U},readPackedFloat:function(U){if(this.type!==e.Bytes)return U.push(this.readFloat());var st=_(this);for(U=U||[];this.pos<st;)U.push(this.readFloat());return U},readPackedDouble:function(U){if(this.type!==e.Bytes)return U.push(this.readDouble());var st=_(this);for(U=U||[];this.pos<st;)U.push(this.readDouble());return U},readPackedFixed32:function(U){if(this.type!==e.Bytes)return U.push(this.readFixed32());var st=_(this);for(U=U||[];this.pos<st;)U.push(this.readFixed32());return U},readPackedSFixed32:function(U){if(this.type!==e.Bytes)return U.push(this.readSFixed32());var st=_(this);for(U=U||[];this.pos<st;)U.push(this.readSFixed32());return U},readPackedFixed64:function(U){if(this.type!==e.Bytes)return U.push(this.readFixed64());var st=_(this);for(U=U||[];this.pos<st;)U.push(this.readFixed64());return U},readPackedSFixed64:function(U){if(this.type!==e.Bytes)return U.push(this.readSFixed64());var st=_(this);for(U=U||[];this.pos<st;)U.push(this.readSFixed64());return U},skip:function(U){var st=7&U;if(st===e.Varint)for(;this.buf[this.pos++]>127;);else if(st===e.Bytes)this.pos=this.readVarint()+this.pos;else if(st===e.Fixed32)this.pos+=4;else{if(st!==e.Fixed64)throw new Error("Unimplemented type: "+st);this.pos+=8}},writeTag:function(U,st){this.writeVarint(U<<3|st)},realloc:function(U){for(var st=this.length||16;st<this.pos+U;)st*=2;if(st!==this.length){var Mt=new Uint8Array(st);Mt.set(this.buf),this.buf=Mt,this.length=st}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(U){this.realloc(4),zt(this.buf,U,this.pos),this.pos+=4},writeSFixed32:function(U){this.realloc(4),zt(this.buf,U,this.pos),this.pos+=4},writeFixed64:function(U){this.realloc(8),zt(this.buf,-1&U,this.pos),zt(this.buf,Math.floor(U*o),this.pos+4),this.pos+=8},writeSFixed64:function(U){this.realloc(8),zt(this.buf,-1&U,this.pos),zt(this.buf,Math.floor(U*o),this.pos+4),this.pos+=8},writeVarint:function(U){(U=+U||0)>268435455||U<0?function(st,Mt){var ae,ve;if(st>=0?(ae=st%4294967296|0,ve=st/4294967296|0):(ve=~(-st/4294967296),4294967295^(ae=~(-st%4294967296))?ae=ae+1|0:(ae=0,ve=ve+1|0)),st>=18446744073709552e3||st<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Mt.realloc(10),function(pe,me,Me){Me.buf[Me.pos++]=127&pe|128,pe>>>=7,Me.buf[Me.pos++]=127&pe|128,pe>>>=7,Me.buf[Me.pos++]=127&pe|128,pe>>>=7,Me.buf[Me.pos++]=127&pe|128,Me.buf[Me.pos]=127&(pe>>>=7)}(ae,0,Mt),function(pe,me){var Me=(7&pe)<<4;me.buf[me.pos++]|=Me|((pe>>>=3)?128:0),pe&&(me.buf[me.pos++]=127&pe|((pe>>>=7)?128:0),pe&&(me.buf[me.pos++]=127&pe|((pe>>>=7)?128:0),pe&&(me.buf[me.pos++]=127&pe|((pe>>>=7)?128:0),pe&&(me.buf[me.pos++]=127&pe|((pe>>>=7)?128:0),pe&&(me.buf[me.pos++]=127&pe)))))}(ve,Mt)}(U,this):(this.realloc(4),this.buf[this.pos++]=127&U|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=U>>>7&127))))},writeSVarint:function(U){this.writeVarint(U<0?2*-U-1:2*U)},writeBoolean:function(U){this.writeVarint(!!U)},writeString:function(U){U=String(U),this.realloc(4*U.length),this.pos++;var st=this.pos;this.pos=function(ae,ve,pe){for(var me,Me,be=0;be<ve.length;be++){if((me=ve.charCodeAt(be))>55295&&me<57344){if(!Me){me>56319||be+1===ve.length?(ae[pe++]=239,ae[pe++]=191,ae[pe++]=189):Me=me;continue}if(me<56320){ae[pe++]=239,ae[pe++]=191,ae[pe++]=189,Me=me;continue}me=Me-55296<<10|me-56320|65536,Me=null}else Me&&(ae[pe++]=239,ae[pe++]=191,ae[pe++]=189,Me=null);me<128?ae[pe++]=me:(me<2048?ae[pe++]=me>>6|192:(me<65536?ae[pe++]=me>>12|224:(ae[pe++]=me>>18|240,ae[pe++]=me>>12&63|128),ae[pe++]=me>>6&63|128),ae[pe++]=63&me|128)}return pe}(this.buf,U,this.pos);var Mt=this.pos-st;Mt>=128&&b(st,Mt,this),this.pos=st-1,this.writeVarint(Mt),this.pos+=Mt},writeFloat:function(U){this.realloc(4),n.write(this.buf,U,this.pos,!0,23,4),this.pos+=4},writeDouble:function(U){this.realloc(8),n.write(this.buf,U,this.pos,!0,52,8),this.pos+=8},writeBytes:function(U){var st=U.length;this.writeVarint(st),this.realloc(st);for(var Mt=0;Mt<st;Mt++)this.buf[this.pos++]=U[Mt]},writeRawMessage:function(U,st){this.pos++;var Mt=this.pos;U(st,this);var ae=this.pos-Mt;ae>=128&&b(Mt,ae,this),this.pos=Mt-1,this.writeVarint(ae),this.pos+=ae},writeMessage:function(U,st,Mt){this.writeTag(U,e.Bytes),this.writeRawMessage(st,Mt)},writePackedVarint:function(U,st){st.length&&this.writeMessage(U,T,st)},writePackedSVarint:function(U,st){st.length&&this.writeMessage(U,k,st)},writePackedBoolean:function(U,st){st.length&&this.writeMessage(U,V,st)},writePackedFloat:function(U,st){st.length&&this.writeMessage(U,B,st)},writePackedDouble:function(U,st){st.length&&this.writeMessage(U,z,st)},writePackedFixed32:function(U,st){st.length&&this.writeMessage(U,H,st)},writePackedSFixed32:function(U,st){st.length&&this.writeMessage(U,K,st)},writePackedFixed64:function(U,st){st.length&&this.writeMessage(U,Y,st)},writePackedSFixed64:function(U,st){st.length&&this.writeMessage(U,at,st)},writeBytesField:function(U,st){this.writeTag(U,e.Bytes),this.writeBytes(st)},writeFixed32Field:function(U,st){this.writeTag(U,e.Fixed32),this.writeFixed32(st)},writeSFixed32Field:function(U,st){this.writeTag(U,e.Fixed32),this.writeSFixed32(st)},writeFixed64Field:function(U,st){this.writeTag(U,e.Fixed64),this.writeFixed64(st)},writeSFixed64Field:function(U,st){this.writeTag(U,e.Fixed64),this.writeSFixed64(st)},writeVarintField:function(U,st){this.writeTag(U,e.Varint),this.writeVarint(st)},writeSVarintField:function(U,st){this.writeTag(U,e.Varint),this.writeSVarint(st)},writeStringField:function(U,st){this.writeTag(U,e.Bytes),this.writeString(st)},writeFloatField:function(U,st){this.writeTag(U,e.Fixed32),this.writeFloat(st)},writeDoubleField:function(U,st){this.writeTag(U,e.Fixed64),this.writeDouble(st)},writeBooleanField:function(U,st){this.writeVarintField(U,!!st)}},Jh}var Pl,tc=rt(Cp());function fm(n,e,r){n===1&&r.readMessage(mm,e)}function mm(n,e,r){if(n===3){let{id:o,bitmap:c,width:_,height:g,left:b,top:T,advance:k}=r.readMessage(_m,{});e.push({id:o,bitmap:new Iu({width:_+6,height:g+6},c),metrics:{width:_,height:g,left:b,top:T,advance:k}})}}function _m(n,e,r){n===1?e.id=r.readVarint():n===2?e.bitmap=r.readBytes():n===3?e.width=r.readVarint():n===4?e.height=r.readVarint():n===5?e.left=r.readSVarint():n===6?e.top=r.readSVarint():n===7&&(e.advance=r.readVarint())}function Mp(n){let e=0,r=0;for(let g of n)e+=g.w*g.h,r=Math.max(r,g.w);n.sort((g,b)=>b.h-g.h);let o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],c=0,_=0;for(let g of n)for(let b=o.length-1;b>=0;b--){let T=o[b];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,_=Math.max(_,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===T.w&&g.h===T.h){let k=o.pop();b<o.length&&(o[b]=k)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(o.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:c,h:_,fill:e/(c*_)||0}}class ec{constructor(e,{pixelRatio:r,version:o,stretchX:c,stretchY:_,content:g,textFitWidth:b,textFitHeight:T}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=_,this.content=g,this.version=o,this.textFitWidth=b,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Lp{constructor(e,r){let o={},c={};this.haveRenderCallbacks=[];let _=[];this.addImages(e,o,_),this.addImages(r,c,_);let{w:g,h:b}=Mp(_),T=new Es({width:g||1,height:b||1});for(let k in e){let B=e[k],z=o[k].paddedRect;Es.copy(B.data,T,{x:0,y:0},{x:z.x+1,y:z.y+1},B.data)}for(let k in r){let B=r[k],z=c[k].paddedRect,V=z.x+1,H=z.y+1,K=B.data.width,Y=B.data.height;Es.copy(B.data,T,{x:0,y:0},{x:V,y:H},B.data),Es.copy(B.data,T,{x:0,y:Y-1},{x:V,y:H-1},{width:K,height:1}),Es.copy(B.data,T,{x:0,y:0},{x:V,y:H+Y},{width:K,height:1}),Es.copy(B.data,T,{x:K-1,y:0},{x:V-1,y:H},{width:1,height:Y}),Es.copy(B.data,T,{x:0,y:0},{x:V+K,y:H},{width:1,height:Y})}this.image=T,this.iconPositions=o,this.patternPositions=c}addImages(e,r,o){for(let c in e){let _=e[c],g={x:0,y:0,w:_.data.width+2,h:_.data.height+2};o.push(g),r[c]=new ec(g,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),r)}patchUpdatedImage(e,r,o){if(!e||!r||e.version===r.version)return;e.version=r.version;let[c,_]=e.tl;o.update(r.data,void 0,{x:c,y:_})}}De("ImagePosition",ec),De("ImageAtlas",Lp),S.an=void 0,(Pl=S.an||(S.an={}))[Pl.none=0]="none",Pl[Pl.horizontal=1]="horizontal",Pl[Pl.vertical=2]="vertical",Pl[Pl.horizontalOnly=3]="horizontalOnly";class Vu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(e,r,o){let c=new Vu;return c.scale=e||1,c.fontStack=r,c.verticalAlign=o||"bottom",c}static forImage(e,r){let o=new Vu;return o.imageName=e,o.verticalAlign=r||"bottom",o}}class du{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){let o=new du;for(let c=0;c<e.sections.length;c++){let _=e.sections[c];_.image?o.addImageSection(_):o.addTextSection(_,r)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let o=0;o<e.length;o++){let c=e.charCodeAt(o+1)||null,_=e.charCodeAt(o-1)||null;r+=c&&Vl(c)&&!Zu[e[o+1]]||_&&Vl(_)&&!Zu[e[o-1]]||!Zu[e[o]]?e[o]:Zu[e[o]]}return r}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&oh[this.text.charCodeAt(o)];o++)e++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&oh[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){let o=new du;return o.text=this.text.substring(e,r),o.sectionIndex=this.sectionIndex.slice(e,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}getMaxImageSize(e){let r=0,o=0;for(let c=0;c<this.length();c++){let _=this.getSection(c);if(_.imageName){let g=e[_.imageName];if(!g)continue;let b=g.displaySize;r=Math.max(r,b[0]),o=Math.max(o,b[1])}}return{maxImageWidth:r,maxImageHeight:o}}addTextSection(e,r){this.text+=e.text,this.sections.push(Vu.forText(e.scale,e.fontStack||r,e.verticalAlign));let o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){let r=e.image?e.image.name:"";if(r.length===0)return void fr("Can't add FormattedSection with an empty image.");let o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Vu.forImage(r,e.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):fr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function sh(n,e,r,o,c,_,g,b,T,k,B,z,V,H,K){let Y=du.fromFeature(n,c),at;z===S.an.vertical&&Y.verticalizePunctuation();let{processBidirectionalText:ft,processStyledBidirectionalText:zt}=M;if(ft&&Y.sections.length===1){at=[];let st=ft(Y.toString(),ic(Y,k,_,e,o,H));for(let Mt of st){let ae=new du;ae.text=Mt,ae.sections=Y.sections;for(let ve=0;ve<Mt.length;ve++)ae.sectionIndex.push(0);at.push(ae)}}else if(zt){at=[];let st=zt(Y.text,Y.sectionIndex,ic(Y,k,_,e,o,H));for(let Mt of st){let ae=new du;ae.text=Mt[0],ae.sectionIndex=Mt[1],ae.sections=Y.sections,at.push(ae)}}else at=function(st,Mt){let ae=[],ve=st.text,pe=0;for(let me of Mt)ae.push(st.substring(pe,me)),pe=me;return pe<ve.length&&ae.push(st.substring(pe,ve.length)),ae}(Y,ic(Y,k,_,e,o,H));let wt=[],U={positionedLines:wt,text:Y.toString(),top:B[1],bottom:B[1],left:B[0],right:B[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(st,Mt,ae,ve,pe,me,Me,be,Te,_e,Oe,We){let Ue=0,Ne=0,Li=0,mr=0,qr=be==="right"?1:be==="left"?0:.5,On=on/We,Io=0;for(let pr of pe){pr.trim();let an=pr.getMaxScale(),Ln={positionedGlyphs:[],lineOffset:0};st.positionedLines[Io]=Ln;let Tn=Ln.positionedGlyphs,ms=0;if(!pr.length()){Ne+=me,++Io;continue}let Bo=xm(ve,pr,On);for(let Is=0;Is<pr.length();Is++){let Hr=pr.getSection(Is),un=pr.getSectionIndex(Is),hn=pr.getCharCode(Is),zr=bm(Te,Oe,hn),tr;if(Hr.imageName){if(st.iconsInText=!0,Hr.scale=Hr.scale*On,tr=Cm(Hr,zr,an,Bo,ve),!tr)continue;ms=Math.max(ms,tr.imageOffset)}else if(tr=wm(Hr,hn,zr,Bo,Mt,ae),!tr)continue;let{rect:ba,metrics:gu,baselineOffset:wa}=tr;Tn.push({glyph:hn,imageName:Hr.imageName,x:Ue,y:Ne+wa+-17,vertical:zr,scale:Hr.scale,fontStack:Hr.fontStack,sectionIndex:un,metrics:gu,rect:ba}),zr?(st.verticalizable=!0,Ue+=(Hr.imageName?gu.advance:on)*Hr.scale+_e):Ue+=gu.advance*Hr.scale+_e}Tn.length!==0&&(Li=Math.max(Ue-_e,Li),Mm(Tn,0,Tn.length-1,qr)),Ue=0,Ln.lineOffset=Math.max(ms,(an-1)*on);let ln=me*an+ms;Ne+=ln,mr=Math.max(ln,mr),++Io}let{horizontalAlign:As,verticalAlign:Mn}=rc(Me);(function(pr,an,Ln,Tn,ms,Bo,ln,Is,Hr){let un=(an-Ln)*ms,hn=0;hn=Bo!==ln?-Is*Tn- -17:-Tn*Hr*ln+.5*ln;for(let zr of pr)for(let tr of zr.positionedGlyphs)tr.x+=un,tr.y+=hn})(st.positionedLines,qr,As,Mn,Li,mr,me,Ne,pe.length),st.top+=-Mn*Ne,st.bottom=st.top+Ne,st.left+=-As*Li,st.right=st.left+Li}(U,e,r,o,at,g,b,T,z,k,V,K),!function(st){for(let Mt of st)if(Mt.positionedGlyphs.length!==0)return!1;return!0}(wt)&&U}let oh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gm={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},ym={40:!0};function Tp(n,e,r,o,c,_){if(e.imageName){let g=o[e.imageName];return g?g.displaySize[0]*e.scale*on/_+c:0}{let g=r[e.fontStack],b=g&&g[n];return b?b.metrics.advance*e.scale+c:0}}function Pp(n,e,r,o){let c=Math.pow(n-e,2);return o?n<e?c/2:2*c:c+Math.abs(r)*r}function vm(n,e,r){let o=0;return n===10&&(o-=1e4),r&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Sp(n,e,r,o,c,_){let g=null,b=Pp(e,r,c,_);for(let T of o){let k=Pp(e-T.x,r,c,_)+T.badness;k<=b&&(g=T,b=k)}return{index:n,x:e,priorBreak:g,badness:b}}function kp(n){return n?kp(n.priorBreak).concat(n.index):[]}function ic(n,e,r,o,c,_){if(!n)return[];let g=[],b=function(z,V,H,K,Y,at){let ft=0;for(let zt=0;zt<z.length();zt++){let wt=z.getSection(zt);ft+=Tp(z.getCharCode(zt),wt,K,Y,V,at)}return ft/Math.max(1,Math.ceil(ft/H))}(n,e,r,o,c,_),T=n.text.indexOf("\u200B")>=0,k=0;for(let z=0;z<n.length();z++){let V=n.getSection(z),H=n.getCharCode(z);if(oh[H]||(k+=Tp(H,V,o,c,e,_)),z<n.length()-1){let K=!((B=H)<11904)&&(!!xi["CJK Compatibility Forms"](B)||!!xi["CJK Compatibility"](B)||!!xi["CJK Strokes"](B)||!!xi["CJK Symbols and Punctuation"](B)||!!xi["Enclosed CJK Letters and Months"](B)||!!xi["Halfwidth and Fullwidth Forms"](B)||!!xi["Ideographic Description Characters"](B)||!!xi["Vertical Forms"](B)||Zl.test(String.fromCodePoint(B)));(gm[H]||K||V.imageName||z!==n.length()-2&&ym[n.getCharCode(z+1)])&&g.push(Sp(z+1,k,b,g,vm(H,n.getCharCode(z+1),K&&T),!1))}}var B;return kp(Sp(n.length(),k,b,g,0,!0))}function rc(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function xm(n,e,r){let o=e.getMaxScale()*on,{maxImageWidth:c,maxImageHeight:_}=e.getMaxImageSize(n),g=Math.max(o,_*r);return{verticalLineContentWidth:Math.max(o,c*r),horizontalLineContentHeight:g}}function Ep(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function bm(n,e,r){return!(n===S.an.horizontal||!e&&!Ml(r)||e&&(oh[r]||(o=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function wm(n,e,r,o,c,_){let g=_[n.fontStack],b=function(k,B,z,V){if(k&&k.rect)return k;let H=B[z.fontStack],K=H&&H[V];return K?{rect:null,metrics:K.metrics}:null}(g&&g[e],c,n,e);if(b===null)return null;let T;if(r)T=o.verticalLineContentWidth-n.scale*on;else{let k=Ep(n.verticalAlign);T=(o.horizontalLineContentHeight-n.scale*on)*k}return{rect:b.rect,metrics:b.metrics,baselineOffset:T}}function Cm(n,e,r,o,c){let _=c[n.imageName];if(!_)return null;let g=_.paddedRect,b=_.displaySize,T={width:b[0],height:b[1],left:1,top:-3,advance:e?b[1]:b[0]},k;if(e)k=o.verticalLineContentWidth-b[1]*n.scale;else{let B=Ep(n.verticalAlign);k=(o.horizontalLineContentHeight-b[1]*n.scale)*B}return{rect:g,metrics:T,baselineOffset:k,imageOffset:(e?b[0]:b[1])*n.scale-on*r}}function Mm(n,e,r,o){if(o===0)return;let c=n[r],_=(n[r].x+c.metrics.advance*c.scale)*o;for(let g=e;g<=r;g++)n[g].x-=_}function Lm(n,e,r){let{horizontalAlign:o,verticalAlign:c}=rc(r),_=e[0]-n.displaySize[0]*o,g=e[1]-n.displaySize[1]*c;return{image:n,top:g,bottom:g+n.displaySize[1],left:_,right:_+n.displaySize[0]}}function Ap(n){var e,r;let o=n.left,c=n.top,_=n.right-o,g=n.bottom-c,b=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",T=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",k=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(T==="proportional"){if(b==="stretchOnly"&&_/g<k||b==="proportional"){let B=Math.ceil(g*k);o*=B/_,_=B}}else if(b==="proportional"&&T==="stretchOnly"&&k!==0&&_/g>k){let B=Math.ceil(_/k);c*=B/g,g=B}return{x1:o,y1:c,x2:o+_,y2:c+g}}function Ip(n,e,r,o,c,_){let g=n.image,b;if(g.content){let at=g.content,ft=g.pixelRatio||1;b=[at[0]/ft,at[1]/ft,g.displaySize[0]-at[2]/ft,g.displaySize[1]-at[3]/ft]}let T=e.left*_,k=e.right*_,B,z,V,H;r==="width"||r==="both"?(H=c[0]+T-o[3],z=c[0]+k+o[1]):(H=c[0]+(T+k-g.displaySize[0])/2,z=H+g.displaySize[0]);let K=e.top*_,Y=e.bottom*_;return r==="height"||r==="both"?(B=c[1]+K-o[0],V=c[1]+Y+o[2]):(B=c[1]+(K+Y-g.displaySize[1])/2,V=B+g.displaySize[1]),{image:g,top:B,right:z,bottom:V,left:H,collisionPadding:b}}let dl=128,Sl=32640;function Bp(n,e){let{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new A(n+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:o,interpolationType:c}=r,_=0;for(;_<o.length&&o[_]<=n;)_++;_=Math.max(0,_-1);let g=_;for(;g<o.length&&o[g]<n+1;)g++;g=Math.min(o.length-1,g);let b=o[_],T=o[g];return r.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:c}:{kind:"camera",minZoom:b,maxZoom:T,minSize:r.evaluate(new A(b)),maxSize:r.evaluate(new A(T)),interpolationType:c}}}function nc(n,e,r){let o="never",c=n.get(e);return c?o=c:n.get(r)&&(o="always"),o}let Tm=Nu.VectorTileFeature.types,Pm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ah(n,e,r,o,c,_,g,b,T,k,B,z,V){let H=b?Math.min(Sl,Math.round(b[0])):0,K=b?Math.min(Sl,Math.round(b[1])):0;n.emplaceBack(e,r,Math.round(32*o),Math.round(32*c),_,g,(H<<1)+(T?1:0),K,16*k,16*B,256*z,256*V)}function sc(n,e,r){n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r)}function Sm(n){for(let e of n.sections)if(x(e.text))return!0;return!1}class oc{constructor(e){this.layoutVertexArray=new _i,this.indexArray=new qi,this.programConfigurations=e,this.segments=new ki,this.dynamicLayoutVertexArray=new Di,this.opacityVertexArray=new hr,this.hasVisibleVertices=!1,this.placedSymbolArray=new dt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,um.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Pm,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}De("SymbolBuffers",oc);class ac{constructor(e,r,o){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new o,this.segments=new ki,this.collisionVertexArray=new cr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,hm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}De("CollisionBuffers",ac);class fu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bp(this.zoom,r["text-size"]),this.iconSizeData=Bp(this.zoom,r["icon-size"]);let o=this.layers[0].layout,c=o.get("symbol-sort-key"),_=o.get("symbol-z-order");this.canOverlap=nc(o,"text-overlap","text-allow-overlap")!=="never"||nc(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(g=>S.an[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new oc(new Va(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new oc(new Va(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new yt,this.lineVertexArray=new Lt,this.symbolInstances=new Ct,this.textAnchorOffsets=new xt}calculateGlyphDependencies(e,r,o,c,_){for(let g=0;g<e.length;g++)if(r[e.charCodeAt(g)]=!0,(o||c)&&_){let b=Zu[e.charAt(g)];b&&(r[b.charCodeAt(0)]=!0)}}populate(e,r,o){let c=this.layers[0],_=c.layout,g=_.get("text-font"),b=_.get("text-field"),T=_.get("icon-image"),k=(b.value.kind!=="constant"||b.value.value instanceof Zi&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),B=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,z=_.get("symbol-sort-key");if(this.features=[],!k&&!B)return;let V=r.iconDependencies,H=r.glyphDependencies,K=r.availableImages,Y=new A(this.zoom,{globalState:this.globalState});for(let{feature:at,id:ft,index:zt,sourceLayerIndex:wt}of e){let U=c._featureFilter.needGeometry,st=Kl(at,U);if(!c._featureFilter.filter(Y,st,o))continue;let Mt,ae;if(U||(st.geometry=Wl(at)),k){let pe=c.getValueAndResolveTokens("text-field",st,o,K),me=Zi.factory(pe),Me=this.hasRTLText=this.hasRTLText||Sm(me);(!Me||M.getRTLTextPluginStatus()==="unavailable"||Me&&M.isParsed())&&(Mt=pm(me,c,st))}if(B){let pe=c.getValueAndResolveTokens("icon-image",st,o,K);ae=pe instanceof ir?pe:ir.fromString(pe)}if(!Mt&&!ae)continue;let ve=this.sortFeaturesByKey?z.evaluate(st,{},o):void 0;if(this.features.push({id:ft,text:Mt,icon:ae,index:zt,sourceLayerIndex:wt,geometry:st.geometry,properties:at.properties,type:Tm[at.type],sortKey:ve}),ae&&(V[ae.name]=!0),Mt){let pe=g.evaluate(st,{},o).join(","),me=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.an.vertical)>=0;for(let Me of Mt.sections)if(Me.image)V[Me.image.name]=!0;else{let be=xr(Mt.toString()),Te=Me.fontStack||pe,_e=H[Te]=H[Te]||{};this.calculateGlyphDependencies(Me.text,_e,me,this.allowVerticalPlacement,be)}}}_.get("symbol-placement")==="line"&&(this.features=function(at){let ft={},zt={},wt=[],U=0;function st(pe){wt.push(at[pe]),U++}function Mt(pe,me,Me){let be=zt[pe];return delete zt[pe],zt[me]=be,wt[be].geometry[0].pop(),wt[be].geometry[0]=wt[be].geometry[0].concat(Me[0]),be}function ae(pe,me,Me){let be=ft[me];return delete ft[me],ft[pe]=be,wt[be].geometry[0].shift(),wt[be].geometry[0]=Me[0].concat(wt[be].geometry[0]),be}function ve(pe,me,Me){let be=Me?me[0][me[0].length-1]:me[0][0];return`${pe}:${be.x}:${be.y}`}for(let pe=0;pe<at.length;pe++){let me=at[pe],Me=me.geometry,be=me.text?me.text.toString():null;if(!be){st(pe);continue}let Te=ve(be,Me),_e=ve(be,Me,!0);if(Te in zt&&_e in ft&&zt[Te]!==ft[_e]){let Oe=ae(Te,_e,Me),We=Mt(Te,_e,wt[Oe].geometry);delete ft[Te],delete zt[_e],zt[ve(be,wt[We].geometry,!0)]=We,wt[Oe].geometry=null}else Te in zt?Mt(Te,_e,Me):_e in ft?ae(Te,_e,Me):(st(pe),ft[Te]=U-1,zt[_e]=U-1)}return wt.filter(pe=>pe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((at,ft)=>at.sortKey-ft.sortKey)}update(e,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){let o=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(r[e.segment+1]),_=e.dist(r[e.segment]),g={};for(let b=e.segment+1;b<r.length;b++)g[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:c},b<r.length-1&&(c+=r[b+1].dist(r[b]));for(let b=e.segment||0;b>=0;b--)g[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:_},b>0&&(_+=r[b-1].dist(r[b]));for(let b=0;b<r.length;b++){let T=g[b];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,r,o,c,_,g,b,T,k,B,z,V){let H=e.indexArray,K=e.layoutVertexArray,Y=e.segments.prepareSegment(4*r.length,K,H,this.canOverlap?g.sortKey:void 0),at=this.glyphOffsetArray.length,ft=Y.vertexLength,zt=this.allowVerticalPlacement&&b===S.an.vertical?Math.PI/2:0,wt=g.text&&g.text.sections;for(let U=0;U<r.length;U++){let{tl:st,tr:Mt,bl:ae,br:ve,tex:pe,pixelOffsetTL:me,pixelOffsetBR:Me,minFontScaleX:be,minFontScaleY:Te,glyphOffset:_e,isSDF:Oe,sectionIndex:We}=r[U],Ue=Y.vertexLength,Ne=_e[1];ah(K,T.x,T.y,st.x,Ne+st.y,pe.x,pe.y,o,Oe,me.x,me.y,be,Te),ah(K,T.x,T.y,Mt.x,Ne+Mt.y,pe.x+pe.w,pe.y,o,Oe,Me.x,me.y,be,Te),ah(K,T.x,T.y,ae.x,Ne+ae.y,pe.x,pe.y+pe.h,o,Oe,me.x,Me.y,be,Te),ah(K,T.x,T.y,ve.x,Ne+ve.y,pe.x+pe.w,pe.y+pe.h,o,Oe,Me.x,Me.y,be,Te),sc(e.dynamicLayoutVertexArray,T,zt),H.emplaceBack(Ue,Ue+2,Ue+1),H.emplaceBack(Ue+1,Ue+2,Ue+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_e[0]),U!==r.length-1&&We===r[U+1].sectionIndex||e.programConfigurations.populatePaintArrays(K.length,g,g.index,{},V,wt&&wt[We])}e.placedSymbolArray.emplaceBack(T.x,T.y,at,this.glyphOffsetArray.length-at,ft,k,B,T.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],b,0,!1,0,z)}_addCollisionDebugVertex(e,r,o,c,_,g){return r.emplaceBack(0,0),e.emplaceBack(o.x,o.y,c,_,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,r,o,c,_,g,b){let T=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),k=T.vertexLength,B=_.layoutVertexArray,z=_.collisionVertexArray,V=b.anchorX,H=b.anchorY;this._addCollisionDebugVertex(B,z,g,V,H,new ge(e,r)),this._addCollisionDebugVertex(B,z,g,V,H,new ge(o,r)),this._addCollisionDebugVertex(B,z,g,V,H,new ge(o,c)),this._addCollisionDebugVertex(B,z,g,V,H,new ge(e,c)),T.vertexLength+=4;let K=_.indexArray;K.emplaceBack(k,k+1),K.emplaceBack(k+1,k+2),K.emplaceBack(k+2,k+3),K.emplaceBack(k+3,k),T.primitiveLength+=4}addDebugCollisionBoxes(e,r,o,c){for(let _=e;_<r;_++){let g=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ac(Vi,xp.members,Ui),this.iconCollisionBox=new ac(Vi,xp.members,Ui);for(let e=0;e<this.symbolInstances.length;e++){let r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,o,c,_,g,b,T,k){let B={};for(let z=r;z<o;z++){let V=e.get(z);B.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.textFeatureIndex=V.featureIndex;break}for(let z=c;z<_;z++){let V=e.get(z);B.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.verticalTextFeatureIndex=V.featureIndex;break}for(let z=g;z<b;z++){let V=e.get(z);B.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.iconFeatureIndex=V.featureIndex;break}for(let z=T;z<k;z++){let V=e.get(z);B.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.verticalIconFeatureIndex=V.featureIndex;break}return B}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){let o=e.placedSymbolArray.get(r),c=o.vertexStartIndex+4*o.numGlyphs;for(let _=o.vertexStartIndex;_<c;_+=4)e.indexArray.emplaceBack(_,_+2,_+1),e.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(e),o=Math.cos(e),c=[],_=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);let T=this.symbolInstances.get(b);c.push(0|Math.round(r*T.anchorX+o*T.anchorY)),_.push(T.featureIndex)}return g.sort((b,T)=>c[b]-c[T]||_[T]-_[b]),g}addToSortKeyRanges(e,r){let o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,_,g)=>{c>=0&&g.indexOf(c)===_&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Dp,zp;De("SymbolBucket",fu,{omit:["layers","collisionBoxArray","features","compareText"]}),fu.MAX_GLYPHS=65535,fu.addDynamicAttributes=sc;var lc={get paint(){return zp=zp||new St({"icon-opacity":new de(At.paint_symbol["icon-opacity"]),"icon-color":new de(At.paint_symbol["icon-color"]),"icon-halo-color":new de(At.paint_symbol["icon-halo-color"]),"icon-halo-width":new de(At.paint_symbol["icon-halo-width"]),"icon-halo-blur":new de(At.paint_symbol["icon-halo-blur"]),"icon-translate":new jt(At.paint_symbol["icon-translate"]),"icon-translate-anchor":new jt(At.paint_symbol["icon-translate-anchor"]),"text-opacity":new de(At.paint_symbol["text-opacity"]),"text-color":new de(At.paint_symbol["text-color"],{runtimeType:pn,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new de(At.paint_symbol["text-halo-color"]),"text-halo-width":new de(At.paint_symbol["text-halo-width"]),"text-halo-blur":new de(At.paint_symbol["text-halo-blur"]),"text-translate":new jt(At.paint_symbol["text-translate"]),"text-translate-anchor":new jt(At.paint_symbol["text-translate-anchor"])})},get layout(){return Dp=Dp||new St({"symbol-placement":new jt(At.layout_symbol["symbol-placement"]),"symbol-spacing":new jt(At.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jt(At.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new de(At.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jt(At.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jt(At.layout_symbol["icon-allow-overlap"]),"icon-overlap":new jt(At.layout_symbol["icon-overlap"]),"icon-ignore-placement":new jt(At.layout_symbol["icon-ignore-placement"]),"icon-optional":new jt(At.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jt(At.layout_symbol["icon-rotation-alignment"]),"icon-size":new de(At.layout_symbol["icon-size"]),"icon-text-fit":new jt(At.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jt(At.layout_symbol["icon-text-fit-padding"]),"icon-image":new de(At.layout_symbol["icon-image"]),"icon-rotate":new de(At.layout_symbol["icon-rotate"]),"icon-padding":new de(At.layout_symbol["icon-padding"]),"icon-keep-upright":new jt(At.layout_symbol["icon-keep-upright"]),"icon-offset":new de(At.layout_symbol["icon-offset"]),"icon-anchor":new de(At.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jt(At.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jt(At.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jt(At.layout_symbol["text-rotation-alignment"]),"text-field":new de(At.layout_symbol["text-field"]),"text-font":new de(At.layout_symbol["text-font"]),"text-size":new de(At.layout_symbol["text-size"]),"text-max-width":new de(At.layout_symbol["text-max-width"]),"text-line-height":new jt(At.layout_symbol["text-line-height"]),"text-letter-spacing":new de(At.layout_symbol["text-letter-spacing"]),"text-justify":new de(At.layout_symbol["text-justify"]),"text-radial-offset":new de(At.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jt(At.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new de(At.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new de(At.layout_symbol["text-anchor"]),"text-max-angle":new jt(At.layout_symbol["text-max-angle"]),"text-writing-mode":new jt(At.layout_symbol["text-writing-mode"]),"text-rotate":new de(At.layout_symbol["text-rotate"]),"text-padding":new jt(At.layout_symbol["text-padding"]),"text-keep-upright":new jt(At.layout_symbol["text-keep-upright"]),"text-transform":new de(At.layout_symbol["text-transform"]),"text-offset":new de(At.layout_symbol["text-offset"]),"text-allow-overlap":new jt(At.layout_symbol["text-allow-overlap"]),"text-overlap":new jt(At.layout_symbol["text-overlap"]),"text-ignore-placement":new jt(At.layout_symbol["text-ignore-placement"]),"text-optional":new jt(At.layout_symbol["text-optional"])})}};class Rp{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Os,this.defaultValue=e}evaluate(e){if(e.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}De("FormatSectionOverride",Rp,{omit:["defaultValue"]});class lh extends Jt{constructor(e){super(e,lc)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let o=this.layout.get("text-writing-mode");if(o){let c=[];for(let _ of o)c.indexOf(_)<0&&c.push(_);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,o,c){let _=this.layout.get(e).evaluate(r,{},o,c),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||f(g.value)||!_?_:function(b,T){return T.replace(/{([^{}]+)}/g,(k,B)=>b&&B in b?String(b[B]):"")}(r.properties,_)}createBucket(e){return new fu(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let e of lc.paint.overridableProperties){if(!lh.hasPaintOverride(this.layout,e))continue;let r=this.paint.get(e),o=new Rp(r),c=new s(o,r.property.specification),_=null;_=r.value.kind==="constant"||r.value.kind==="source"?new E("source",c):new N("composite",c,r.value.zoomStops),this.paint._values[e]=new ie(r.property,_,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&lh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){let o=e.get("text-field"),c=lc.paint.properties[r],_=!1,g=b=>{for(let T of b)if(c.overrides&&c.overrides.hasOverride(T))return void(_=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Zi)g(o.value.value.sections);else if(o.value.kind==="source"){let b=k=>{_||(k instanceof Fr&&He(k.value)===Sn?g(k.value.sections):k instanceof Yi?g(k.sections):k.eachChild(b))},T=o.value;T._styleExpression&&b(T._styleExpression.expression)}return _}}let Op;var km={get paint(){return Op=Op||new St({"background-color":new jt(At.paint_background["background-color"]),"background-pattern":new Mi(At.paint_background["background-pattern"]),"background-opacity":new jt(At.paint_background["background-opacity"])})}};class Em extends Jt{constructor(e){super(e,km)}}let Fp;var Am={get paint(){return Fp=Fp||new St({"raster-opacity":new jt(At.paint_raster["raster-opacity"]),"raster-hue-rotate":new jt(At.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jt(At.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jt(At.paint_raster["raster-brightness-max"]),"raster-saturation":new jt(At.paint_raster["raster-saturation"]),"raster-contrast":new jt(At.paint_raster["raster-contrast"]),"raster-resampling":new jt(At.paint_raster["raster-resampling"]),"raster-fade-duration":new jt(At.paint_raster["raster-fade-duration"])})}};class Im extends Jt{constructor(e){super(e,Am)}}class Bm extends Jt{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Dm{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let zm={once:!0},uc=63710088e-1;class kl{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new kl(ro(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let r=Math.PI/180,o=this.lat*r,c=e.lat*r,_=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return uc*Math.acos(Math.min(_,1))}static convert(e){if(e instanceof kl)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new kl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new kl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let Np=2*Math.PI*uc;function jp(n){return Np*Math.cos(n*Math.PI/180)}function Gp(n){return(180+n)/360}function Zp(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Vp(n,e){return n/jp(e)}function hc(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Up(n,e){return n*jp(hc(e))}class Uu{constructor(e,r,o=0){this.x=+e,this.y=+r,this.z=+o}static fromLngLat(e,r=0){let o=kl.convert(e);return new Uu(Gp(o.lng),Zp(o.lat),Vp(r,o.lat))}toLngLat(){return new kl(360*this.x-180,hc(this.y))}toAltitude(){return Up(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Np*(e=hc(this.y),1/Math.cos(e*Math.PI/180));var e}}function $p(n,e,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class cc{constructor(e,r,o){if(!function(c,_,g){return!(c<0||c>25||g<0||g>=Math.pow(2,c)||_<0||_>=Math.pow(2,c))}(e,r,o))throw new Error(`x=${r}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=o,this.key=mu(0,e,e,r,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,o){let c=(g=this.y,b=this.z,T=$p(256*(_=this.x),256*(g=Math.pow(2,b)-g-1),b),k=$p(256*(_+1),256*(g+1),b),T[0]+","+T[1]+","+k[0]+","+k[1]);var _,g,b,T,k;let B=function(z,V,H){let K,Y="";for(let at=z;at>0;at--)K=1<<at-1,Y+=(V&K?1:0)+(H&K?2:0);return Y}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,B).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){let r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){let r=Math.pow(2,this.z);return new ge((e.x*r-this.x)*ti,(e.y*r-this.y)*ti)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qp{constructor(e,r){this.wrap=e,this.canonical=r,this.key=mu(e,r.z,r.z,r.x,r.y)}}class Ao{constructor(e,r,o,c,_){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=r,this.canonical=new cc(o,+c,+_),this.key=mu(r,e,o,c,_)}clone(){return new Ao(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);let r=this.canonical.z-e;return e>this.canonical.z?new Ao(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ao(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);let o=this.canonical.z-e;return e>this.canonical.z?mu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):mu(this.wrap*+r,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;let r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Ao(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new Ao(r,this.wrap,r,o,c),new Ao(r,this.wrap,r,o+1,c),new Ao(r,this.wrap,r,o,c+1),new Ao(r,this.wrap,r,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ao(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ao(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Uu(e.x-this.wrap,e.y))}}function mu(n,e,r,o,c){(n*=2)<0&&(n=-1*n-1);let _=1<<r;return(_*_*n+_*c+o).toString(36)+r.toString(36)+e.toString(36)}De("CanonicalTileID",cc),De("OverscaledTileID",Ao,{omit:["terrainRttPosMatrix32f"]});class Jl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){let r=new Jl;return r.extend(e(new ge(this.minX,this.minY))),r.extend(e(new ge(this.maxX,this.minY))),r.extend(e(new ge(this.minX,this.maxY))),r.extend(e(new ge(this.maxX,this.maxY))),r}static fromPoints(e){let r=new Jl;for(let o of e)r.extend(o);return r}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Hp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){let o=e[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Wp{constructor(e,r,o,c,_){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=o,e._y=c,this.properties=e.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={geometry:this.geometry};for(let r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Kp{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ra(ti,16,0),this.grid3D=new Ra(ti,16,0),this.featureIndexArray=new ue,this.promoteId=r}insert(e,r,o,c,_,g){let b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,_);let T=g?this.grid3D:this.grid;for(let k=0;k<r.length;k++){let B=r[k],z=[1/0,1/0,-1/0,-1/0];for(let V=0;V<B.length;V++){let H=B[V];z[0]=Math.min(z[0],H.x),z[1]=Math.min(z[1],H.y),z[2]=Math.max(z[2],H.x),z[3]=Math.max(z[3],H.y)}z[0]<ti&&z[1]<ti&&z[2]>=0&&z[3]>=0&&T.insert(b,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Nu.VectorTile(new tc(this.rawTileData)).layers,this.sourceLayerCoder=new Hp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,o,c){this.loadVTLayers();let _=e.params,g=ti/e.tileSize/e.scale,b=qe(_.filter),T=e.queryGeometry,k=e.queryPadding*g,B=Jl.fromPoints(T),z=this.grid.query(B.minX-k,B.minY-k,B.maxX+k,B.maxY+k),V=Jl.fromPoints(e.cameraQueryGeometry).expandBy(k),H=this.grid3D.query(V.minX,V.minY,V.maxX,V.maxY,(at,ft,zt,wt)=>function(U,st,Mt,ae,ve){for(let me of U)if(st<=me.x&&Mt<=me.y&&ae>=me.x&&ve>=me.y)return!0;let pe=[new ge(st,Mt),new ge(st,ve),new ge(ae,ve),new ge(ae,Mt)];if(U.length>2){for(let me of pe)if(uu(U,me))return!0}for(let me=0;me<U.length-1;me++)if(wf(U[me],U[me+1],pe))return!0;return!1}(e.cameraQueryGeometry,at-k,ft-k,zt+k,wt+k));for(let at of H)z.push(at);z.sort(Rm);let K={},Y;for(let at=0;at<z.length;at++){let ft=z[at];if(ft===Y)continue;Y=ft;let zt=this.featureIndexArray.get(ft),wt=null;this.loadMatchingFeature(K,zt.bucketIndex,zt.sourceLayerIndex,zt.featureIndex,b,_.layers,_.availableImages,r,o,c,(U,st,Mt)=>(wt||(wt=Wl(U)),st.queryIntersectsFeature({queryGeometry:T,feature:U,featureState:Mt,geometry:wt,zoom:this.z,transform:e.transform,pixelsToTileUnits:g,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation})))}return K}loadMatchingFeature(e,r,o,c,_,g,b,T,k,B,z){let V=this.bucketLayerIDs[r];if(g&&!V.some(at=>g.has(at)))return;let H=this.sourceLayerCoder.decode(o),K=this.vtLayers[H].feature(c);if(_.needGeometry){let at=Kl(K,!0);if(!_.filter(new A(this.tileID.overscaledZ),at,this.tileID.canonical))return}else if(!_.filter(new A(this.tileID.overscaledZ),K))return;let Y=this.getId(K,H);for(let at=0;at<V.length;at++){let ft=V[at];if(g&&!g.has(ft))continue;let zt=T[ft];if(!zt)continue;let wt={};Y&&B&&(wt=B.getState(zt.sourceLayer||"_geojsonTileLayer",Y));let U=yr({},k[ft]);U.paint=Xp(U.paint,zt.paint,K,wt,b),U.layout=Xp(U.layout,zt.layout,K,wt,b);let st=!z||z(K,zt,wt);if(!st)continue;let Mt=new Wp(K,this.z,this.x,this.y,Y);Mt.layer=U;let ae=e[ft];ae===void 0&&(ae=e[ft]=[]),ae.push({featureIndex:c,feature:Mt,intersectionZ:st})}}lookupSymbolFeatures(e,r,o,c,_,g,b,T){let k={};this.loadVTLayers();let B=qe(_);for(let z of e)this.loadMatchingFeature(k,o,c,z,B,g,b,T,r);return k}hasLayer(e){for(let r of this.bucketLayerIDs)for(let o of r)if(e===o)return!0;return!1}getId(e,r){var o;let c=e.id;return this.promoteId&&(c=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof c=="boolean"&&(c=Number(c)),c===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(c=Number(e.properties.cluster_id))),c}}function Xp(n,e,r,o,c){return ji(n,(_,g)=>{let b=e instanceof Ut?e.get(g):null;return b&&b.evaluate?b.evaluate(r,o,c):b})}function Rm(n,e){return e-n}function Yp(n,e,r,o,c){let _=[];for(let g=0;g<n.length;g++){let b=n[g],T;for(let k=0;k<b.length-1;k++){let B=b[k],z=b[k+1];B.x<e&&z.x<e||(B.x<e?B=new ge(e,B.y+(e-B.x)/(z.x-B.x)*(z.y-B.y))._round():z.x<e&&(z=new ge(e,B.y+(e-B.x)/(z.x-B.x)*(z.y-B.y))._round()),B.y<r&&z.y<r||(B.y<r?B=new ge(B.x+(r-B.y)/(z.y-B.y)*(z.x-B.x),r)._round():z.y<r&&(z=new ge(B.x+(r-B.y)/(z.y-B.y)*(z.x-B.x),r)._round()),B.x>=o&&z.x>=o||(B.x>=o?B=new ge(o,B.y+(o-B.x)/(z.x-B.x)*(z.y-B.y))._round():z.x>=o&&(z=new ge(o,B.y+(o-B.x)/(z.x-B.x)*(z.y-B.y))._round()),B.y>=c&&z.y>=c||(B.y>=c?B=new ge(B.x+(c-B.y)/(z.y-B.y)*(z.x-B.x),c)._round():z.y>=c&&(z=new ge(B.x+(c-B.y)/(z.y-B.y)*(z.x-B.x),c)._round()),T&&B.equals(T[T.length-1])||(T=[B],_.push(T)),T.push(z)))))}}return _}De("FeatureIndex",Kp,{omit:["rawTileData","sourceLayerCoder"]});class El extends ge{constructor(e,r,o,c){super(e,r),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new El(this.x,this.y,this.angle,this.segment)}}function Jp(n,e,r,o,c){if(e.segment===void 0||r===0)return!0;let _=e,g=e.segment+1,b=0;for(;b>-r/2;){if(g--,g<0)return!1;b-=n[g].dist(_),_=n[g]}b+=n[g].dist(n[g+1]),g++;let T=[],k=0;for(;b<r/2;){let B=n[g],z=n[g+1];if(!z)return!1;let V=n[g-1].angleTo(B)-B.angleTo(z);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:V}),k+=V;b-T[0].distance>o;)k-=T.shift().angleDelta;if(k>c)return!1;g++,b+=B.dist(z)}return!0}function Qp(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function td(n,e,r){return n?.6*e*r:0}function ed(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Om(n,e,r,o,c,_){let g=td(r,c,_),b=ed(r,o)*_,T=0,k=Qp(n)/2;for(let B=0;B<n.length-1;B++){let z=n[B],V=n[B+1],H=z.dist(V);if(T+H>k){let K=(k-T)/H,Y=_n.number(z.x,V.x,K),at=_n.number(z.y,V.y,K),ft=new El(Y,at,V.angleTo(z),B);return ft._round(),!g||Jp(n,ft,b,g,e)?ft:void 0}T+=H}}function Fm(n,e,r,o,c,_,g,b,T){let k=td(o,_,g),B=ed(o,c),z=B*g,V=n[0].x===0||n[0].x===T||n[0].y===0||n[0].y===T;return e-z<e/4&&(e=z+e/4),id(n,V?e/2*b%e:(B/2+2*_)*g*b%e,e,k,r,z,V,!1,T)}function id(n,e,r,o,c,_,g,b,T){let k=_/2,B=Qp(n),z=0,V=e-r,H=[];for(let K=0;K<n.length-1;K++){let Y=n[K],at=n[K+1],ft=Y.dist(at),zt=at.angleTo(Y);for(;V+r<z+ft;){V+=r;let wt=(V-z)/ft,U=_n.number(Y.x,at.x,wt),st=_n.number(Y.y,at.y,wt);if(U>=0&&U<T&&st>=0&&st<T&&V-k>=0&&V+k<=B){let Mt=new El(U,st,zt,K);Mt._round(),o&&!Jp(n,Mt,_,o,c)||H.push(Mt)}}z+=ft}return b||H.length||g||(H=id(n,z/2,r,o,c,_,g,!0,T)),H}function rd(n,e,r,o){let c=[],_=n.image,g=_.pixelRatio,b=_.paddedRect.w-2,T=_.paddedRect.h-2,k={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom},B=_.stretchX||[[0,b]],z=_.stretchY||[[0,T]],V=(_e,Oe)=>_e+Oe[1]-Oe[0],H=B.reduce(V,0),K=z.reduce(V,0),Y=b-H,at=T-K,ft=0,zt=H,wt=0,U=K,st=0,Mt=Y,ae=0,ve=at;if(_.content&&o){let _e=_.content,Oe=_e[2]-_e[0],We=_e[3]-_e[1];(_.textFitWidth||_.textFitHeight)&&(k=Ap(n)),ft=uh(B,0,_e[0]),wt=uh(z,0,_e[1]),zt=uh(B,_e[0],_e[2]),U=uh(z,_e[1],_e[3]),st=_e[0]-ft,ae=_e[1]-wt,Mt=Oe-zt,ve=We-U}let pe=k.x1,me=k.y1,Me=k.x2-pe,be=k.y2-me,Te=(_e,Oe,We,Ue)=>{let Ne=hh(_e.stretch-ft,zt,Me,pe),Li=ch(_e.fixed-st,Mt,_e.stretch,H),mr=hh(Oe.stretch-wt,U,be,me),qr=ch(Oe.fixed-ae,ve,Oe.stretch,K),On=hh(We.stretch-ft,zt,Me,pe),Io=ch(We.fixed-st,Mt,We.stretch,H),As=hh(Ue.stretch-wt,U,be,me),Mn=ch(Ue.fixed-ae,ve,Ue.stretch,K),pr=new ge(Ne,mr),an=new ge(On,mr),Ln=new ge(On,As),Tn=new ge(Ne,As),ms=new ge(Li/g,qr/g),Bo=new ge(Io/g,Mn/g),ln=e*Math.PI/180;if(ln){let un=Math.sin(ln),hn=Math.cos(ln),zr=[hn,-un,un,hn];pr._matMult(zr),an._matMult(zr),Tn._matMult(zr),Ln._matMult(zr)}let Is=_e.stretch+_e.fixed,Hr=Oe.stretch+Oe.fixed;return{tl:pr,tr:an,bl:Tn,br:Ln,tex:{x:_.paddedRect.x+1+Is,y:_.paddedRect.y+1+Hr,w:We.stretch+We.fixed-Is,h:Ue.stretch+Ue.fixed-Hr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ms,pixelOffsetBR:Bo,minFontScaleX:Mt/g/Me,minFontScaleY:ve/g/be,isSDF:r}};if(o&&(_.stretchX||_.stretchY)){let _e=nd(B,Y,H),Oe=nd(z,at,K);for(let We=0;We<_e.length-1;We++){let Ue=_e[We],Ne=_e[We+1];for(let Li=0;Li<Oe.length-1;Li++)c.push(Te(Ue,Oe[Li],Ne,Oe[Li+1]))}}else c.push(Te({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return c}function uh(n,e,r){let o=0;for(let c of n)o+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return o}function nd(n,e,r){let o=[{fixed:-1,stretch:0}];for(let[c,_]of n){let g=o[o.length-1];o.push({fixed:c-g.stretch,stretch:g.stretch}),o.push({fixed:c-g.stretch,stretch:g.stretch+(_-c)})}return o.push({fixed:e+1,stretch:r}),o}function hh(n,e,r,o){return n/e*r+o}function ch(n,e,r,o){return n-e*r/o}De("Anchor",El);class ph{constructor(e,r,o,c,_,g,b,T,k,B){var z;if(this.boxStartIndex=e.length,k){let V=g.top,H=g.bottom,K=g.collisionPadding;K&&(V-=K[1],H+=K[3]);let Y=H-V;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{let V=!((z=g.image)===null||z===void 0)&&z.content&&(g.image.textFitWidth||g.image.textFitHeight)?Ap(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};V.y1=V.y1*b-T[0],V.y2=V.y2*b+T[2],V.x1=V.x1*b-T[3],V.x2=V.x2*b+T[1];let H=g.collisionPadding;if(H&&(V.x1-=H[0]*b,V.y1-=H[1]*b,V.x2+=H[2]*b,V.y2+=H[3]*b),B){let K=new ge(V.x1,V.y1),Y=new ge(V.x2,V.y1),at=new ge(V.x1,V.y2),ft=new ge(V.x2,V.y2),zt=B*Math.PI/180;K._rotate(zt),Y._rotate(zt),at._rotate(zt),ft._rotate(zt),V.x1=Math.min(K.x,Y.x,at.x,ft.x),V.x2=Math.max(K.x,Y.x,at.x,ft.x),V.y1=Math.min(K.y,Y.y,at.y,ft.y),V.y2=Math.max(K.y,Y.y,at.y,ft.y)}e.emplaceBack(r.x,r.y,V.x1,V.y1,V.x2,V.y2,o,c,_)}this.boxEndIndex=e.length}}class Nm{constructor(e=[],r=(o,c)=>o<c?-1:o>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:r,compare:o}=this,c=r[e];for(;e>0;){let _=e-1>>1,g=r[_];if(o(c,g)>=0)break;r[e]=g,e=_}r[e]=c}_down(e){let{data:r,compare:o}=this,c=this.length>>1,_=r[e];for(;e<c;){let g=1+(e<<1),b=g+1;if(b<this.length&&o(r[b],r[g])<0&&(g=b),o(r[g],_)>=0)break;r[e]=r[g],e=g}r[e]=_}}function jm(n,e=1,r=!1){let o=Jl.fromPoints(n[0]),c=Math.min(o.width(),o.height()),_=c/2,g=new Nm([],Gm),{minX:b,minY:T,maxX:k,maxY:B}=o;if(c===0)return new ge(b,T);for(let H=b;H<k;H+=c)for(let K=T;K<B;K+=c)g.push(new _u(H+_,K+_,_,n));let z=function(H){let K=0,Y=0,at=0,ft=H[0];for(let zt=0,wt=ft.length,U=wt-1;zt<wt;U=zt++){let st=ft[zt],Mt=ft[U],ae=st.x*Mt.y-Mt.x*st.y;Y+=(st.x+Mt.x)*ae,at+=(st.y+Mt.y)*ae,K+=3*ae}return new _u(Y/K,at/K,0,H)}(n),V=g.length;for(;g.length;){let H=g.pop();(H.d>z.d||!z.d)&&(z=H,r&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,V)),H.max-z.d<=e||(_=H.h/2,g.push(new _u(H.p.x-_,H.p.y-_,_,n)),g.push(new _u(H.p.x+_,H.p.y-_,_,n)),g.push(new _u(H.p.x-_,H.p.y+_,_,n)),g.push(new _u(H.p.x+_,H.p.y+_,_,n)),V+=4)}return r&&(console.log(`num probes: ${V}`),console.log(`best distance: ${z.d}`)),z.p}function Gm(n,e){return e.max-n.max}function _u(n,e,r,o){this.p=new ge(n,e),this.h=r,this.d=function(c,_){let g=!1,b=1/0;for(let T=0;T<_.length;T++){let k=_[T];for(let B=0,z=k.length,V=z-1;B<z;V=B++){let H=k[B],K=k[V];H.y>c.y!=K.y>c.y&&c.x<(K.x-H.x)*(c.y-H.y)/(K.y-H.y)+H.x&&(g=!g),b=Math.min(b,Oc(c,H,K))}}return(g?1:-1)*Math.sqrt(b)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Rn;S.aD=void 0,(Rn=S.aD||(S.aD={}))[Rn.center=1]="center",Rn[Rn.left=2]="left",Rn[Rn.right=3]="right",Rn[Rn.top=4]="top",Rn[Rn.bottom=5]="bottom",Rn[Rn["top-left"]=6]="top-left",Rn[Rn["top-right"]=7]="top-right",Rn[Rn["bottom-left"]=8]="bottom-left",Rn[Rn["bottom-right"]=9]="bottom-right";let pc=Number.POSITIVE_INFINITY;function sd(n,e){return e[1]!==pc?function(r,o,c){let _=0,g=0;switch(o=Math.abs(o),c=Math.abs(c),r){case"top-right":case"top-left":case"top":g=c-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-c}switch(r){case"top-right":case"bottom-right":case"right":_=-o;break;case"top-left":case"bottom-left":case"left":_=o}return[_,g]}(n,e[0],e[1]):function(r,o){let c=0,_=0;o<0&&(o=0);let g=o/Math.SQRT2;switch(r){case"top-right":case"top-left":_=g-7;break;case"bottom-right":case"bottom-left":_=7-g;break;case"bottom":_=7-o;break;case"top":_=o-7}switch(r){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=o;break;case"right":c=-o}return[c,_]}(n,e[0])}function od(n,e,r){var o;let c=n.layout,_=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},r);if(_){let b=_.values,T=[];for(let k=0;k<b.length;k+=2){let B=T[k]=b[k],z=b[k+1].map(V=>V*on);B.startsWith("top")?z[1]-=7:B.startsWith("bottom")&&(z[1]+=7),T[k+1]=z}return new ai(T)}let g=c.get("text-variable-anchor");if(g){let b;b=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},r)*on,pc]:c.get("text-offset").evaluate(e,{},r).map(k=>k*on);let T=[];for(let k of g)T.push(k,sd(k,b));return new ai(T)}return null}function dc(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Zm(n,e,r,o,c,_,g,b,T,k,B,z){let V=_.textMaxSize.evaluate(e,{});V===void 0&&(V=g);let H=n.layers[0].layout,K=H.get("icon-offset").evaluate(e,{},B),Y=ld(r.horizontal),at=g/24,ft=n.tilePixelRatio*at,zt=n.tilePixelRatio*V/24,wt=n.tilePixelRatio*b,U=n.tilePixelRatio*H.get("symbol-spacing"),st=H.get("text-padding")*n.tilePixelRatio,Mt=function(We,Ue,Ne,Li=1){let mr=We.get("icon-padding").evaluate(Ue,{},Ne),qr=mr&&mr.values;return[qr[0]*Li,qr[1]*Li,qr[2]*Li,qr[3]*Li]}(H,e,B,n.tilePixelRatio),ae=H.get("text-max-angle")/180*Math.PI,ve=H.get("text-rotation-alignment")!=="viewport"&&H.get("symbol-placement")!=="point",pe=H.get("icon-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",me=H.get("symbol-placement"),Me=U/2,be=H.get("icon-text-fit"),Te;o&&be!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(Te=Ip(o,r.vertical,be,H.get("icon-text-fit-padding"),K,at)),Y&&(o=Ip(o,Y,be,H.get("icon-text-fit-padding"),K,at)));let _e=B?z.line.getGranularityForZoomLevel(B.z):1,Oe=(We,Ue)=>{Ue.x<0||Ue.x>=ti||Ue.y<0||Ue.y>=ti||function(Ne,Li,mr,qr,On,Io,As,Mn,pr,an,Ln,Tn,ms,Bo,ln,Is,Hr,un,hn,zr,tr,ba,gu,wa,$m){let yu=Ne.addToLineVertexArray(Li,mr),Ql,vu,xu,bu,pd=0,dd=0,fd=0,md=0,bc=-1,wc=-1,fl={},_d=fs("");if(Ne.allowVerticalPlacement&&qr.vertical){let es=Mn.layout.get("text-rotate").evaluate(tr,{},wa)+90;xu=new ph(pr,Li,an,Ln,Tn,qr.vertical,ms,Bo,ln,es),As&&(bu=new ph(pr,Li,an,Ln,Tn,As,Hr,un,ln,es))}if(On){let es=Mn.layout.get("icon-rotate").evaluate(tr,{}),Do=Mn.layout.get("icon-text-fit")!=="none",tu=rd(On,es,gu,Do),Ma=As?rd(As,es,gu,Do):void 0;vu=new ph(pr,Li,an,Ln,Tn,On,Hr,un,!1,es),pd=4*tu.length;let eu=Ne.iconSizeData,Ua=null;eu.kind==="source"?(Ua=[dl*Mn.layout.get("icon-size").evaluate(tr,{})],Ua[0]>Sl&&fr(`${Ne.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):eu.kind==="composite"&&(Ua=[dl*ba.compositeIconSizes[0].evaluate(tr,{},wa),dl*ba.compositeIconSizes[1].evaluate(tr,{},wa)],(Ua[0]>Sl||Ua[1]>Sl)&&fr(`${Ne.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ne.addSymbols(Ne.icon,tu,Ua,zr,hn,tr,S.an.none,Li,yu.lineStartIndex,yu.lineLength,-1,wa),bc=Ne.icon.placedSymbolArray.length-1,Ma&&(dd=4*Ma.length,Ne.addSymbols(Ne.icon,Ma,Ua,zr,hn,tr,S.an.vertical,Li,yu.lineStartIndex,yu.lineLength,-1,wa),wc=Ne.icon.placedSymbolArray.length-1)}let gd=Object.keys(qr.horizontal);for(let es of gd){let Do=qr.horizontal[es];if(!Ql){_d=fs(Do.text);let Ma=Mn.layout.get("text-rotate").evaluate(tr,{},wa);Ql=new ph(pr,Li,an,Ln,Tn,Do,ms,Bo,ln,Ma)}let tu=Do.positionedLines.length===1;if(fd+=ad(Ne,Li,Do,Io,Mn,ln,tr,Is,yu,qr.vertical?S.an.horizontal:S.an.horizontalOnly,tu?gd:[es],fl,bc,ba,wa),tu)break}qr.vertical&&(md+=ad(Ne,Li,qr.vertical,Io,Mn,ln,tr,Is,yu,S.an.vertical,["vertical"],fl,wc,ba,wa));let qm=Ql?Ql.boxStartIndex:Ne.collisionBoxArray.length,Hm=Ql?Ql.boxEndIndex:Ne.collisionBoxArray.length,Wm=xu?xu.boxStartIndex:Ne.collisionBoxArray.length,Km=xu?xu.boxEndIndex:Ne.collisionBoxArray.length,Xm=vu?vu.boxStartIndex:Ne.collisionBoxArray.length,Ym=vu?vu.boxEndIndex:Ne.collisionBoxArray.length,Jm=bu?bu.boxStartIndex:Ne.collisionBoxArray.length,Qm=bu?bu.boxEndIndex:Ne.collisionBoxArray.length,Ca=-1,fh=(es,Do)=>es&&es.circleDiameter?Math.max(es.circleDiameter,Do):Do;Ca=fh(Ql,Ca),Ca=fh(xu,Ca),Ca=fh(vu,Ca),Ca=fh(bu,Ca);let yd=Ca>-1?1:0;yd&&(Ca*=$m/on),Ne.glyphOffsetArray.length>=fu.MAX_GLYPHS&&fr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tr.sortKey!==void 0&&Ne.addToSortKeyRanges(Ne.symbolInstances.length,tr.sortKey);let t_=od(Mn,tr,wa),[e_,i_]=function(es,Do){let tu=es.length,Ma=Do?.values;if(Ma?.length>0)for(let eu=0;eu<Ma.length;eu+=2){let Ua=Ma[eu+1];es.emplaceBack(S.aD[Ma[eu]],Ua[0],Ua[1])}return[tu,es.length]}(Ne.textAnchorOffsets,t_);Ne.symbolInstances.emplaceBack(Li.x,Li.y,fl.right>=0?fl.right:-1,fl.center>=0?fl.center:-1,fl.left>=0?fl.left:-1,fl.vertical||-1,bc,wc,_d,qm,Hm,Wm,Km,Xm,Ym,Jm,Qm,an,fd,md,pd,dd,yd,0,ms,Ca,e_,i_)}(n,Ue,We,r,o,c,Te,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,ft,[st,st,st,st],ve,T,wt,Mt,pe,K,e,_,k,B,g)};if(me==="line")for(let We of Yp(e.geometry,0,0,ti,ti)){let Ue=Yl(We,_e),Ne=Fm(Ue,U,ae,r.vertical||Y,o,24,zt,n.overscaling,ti);for(let Li of Ne)Y&&Vm(n,Y.text,Me,Li)||Oe(Ue,Li)}else if(me==="line-center"){for(let We of e.geometry)if(We.length>1){let Ue=Yl(We,_e),Ne=Om(Ue,ae,r.vertical||Y,o,24,zt);Ne&&Oe(Ue,Ne)}}else if(e.type==="Polygon")for(let We of yn(e.geometry,0)){let Ue=jm(We,16);Oe(Yl(We[0],_e,!0),new El(Ue.x,Ue.y,0))}else if(e.type==="LineString")for(let We of e.geometry){let Ue=Yl(We,_e);Oe(Ue,new El(Ue[0].x,Ue[0].y,0))}else if(e.type==="Point")for(let We of e.geometry)for(let Ue of We)Oe([Ue],new El(Ue.x,Ue.y,0))}function ad(n,e,r,o,c,_,g,b,T,k,B,z,V,H,K){let Y=function(zt,wt,U,st,Mt,ae,ve,pe){let me=st.layout.get("text-rotate").evaluate(ae,{})*Math.PI/180,Me=[];for(let be of wt.positionedLines)for(let Te of be.positionedGlyphs){if(!Te.rect)continue;let _e=Te.rect||{},Oe=4,We=!0,Ue=1,Ne=0,Li=(Mt||pe)&&Te.vertical,mr=Te.metrics.advance*Te.scale/2;if(pe&&wt.verticalizable&&(Ne=be.lineOffset/2-(Te.imageName?-(on-Te.metrics.width*Te.scale)/2:(Te.scale-1)*on)),Te.imageName){let un=ve[Te.imageName];We=un.sdf,Ue=un.pixelRatio,Oe=1/Ue}let qr=Mt?[Te.x+mr,Te.y]:[0,0],On=Mt?[0,0]:[Te.x+mr+U[0],Te.y+U[1]-Ne],Io=[0,0];Li&&(Io=On,On=[0,0]);let As=Te.metrics.isDoubleResolution?2:1,Mn=(Te.metrics.left-Oe)*Te.scale-mr+On[0],pr=(-Te.metrics.top-Oe)*Te.scale+On[1],an=Mn+_e.w/As*Te.scale/Ue,Ln=pr+_e.h/As*Te.scale/Ue,Tn=new ge(Mn,pr),ms=new ge(an,pr),Bo=new ge(Mn,Ln),ln=new ge(an,Ln);if(Li){let un=new ge(-mr,mr- -17),hn=-Math.PI/2,zr=12-mr,tr=new ge(22-zr,-(Te.imageName?zr:0)),ba=new ge(...Io);Tn._rotateAround(hn,un)._add(tr)._add(ba),ms._rotateAround(hn,un)._add(tr)._add(ba),Bo._rotateAround(hn,un)._add(tr)._add(ba),ln._rotateAround(hn,un)._add(tr)._add(ba)}if(me){let un=Math.sin(me),hn=Math.cos(me),zr=[hn,-un,un,hn];Tn._matMult(zr),ms._matMult(zr),Bo._matMult(zr),ln._matMult(zr)}let Is=new ge(0,0),Hr=new ge(0,0);Me.push({tl:Tn,tr:ms,bl:Bo,br:ln,tex:_e,writingMode:wt.writingMode,glyphOffset:qr,sectionIndex:Te.sectionIndex,isSDF:We,pixelOffsetTL:Is,pixelOffsetBR:Hr,minFontScaleX:0,minFontScaleY:0})}return Me}(0,r,b,c,_,g,o,n.allowVerticalPlacement),at=n.textSizeData,ft=null;at.kind==="source"?(ft=[dl*c.layout.get("text-size").evaluate(g,{})],ft[0]>Sl&&fr(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):at.kind==="composite"&&(ft=[dl*H.compositeTextSizes[0].evaluate(g,{},K),dl*H.compositeTextSizes[1].evaluate(g,{},K)],(ft[0]>Sl||ft[1]>Sl)&&fr(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,Y,ft,b,_,g,k,e,T.lineStartIndex,T.lineLength,V,K);for(let zt of B)z[zt]=n.text.placedSymbolArray.length-1;return 4*Y.length}function ld(n){for(let e in n)return n[e];return null}function Vm(n,e,r,o){let c=n.compareText;if(e in c){let _=c[e];for(let g=_.length-1;g>=0;g--)if(o.dist(_[g])<r)return!0}else c[e]=[];return c[e].push(o),!1}let ud=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class fc{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,o]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);let _=ud[15&o];if(!_)throw new Error("Unrecognized array type.");let[g]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new fc(b,g,_,e)}constructor(e,r=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let _=ud.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){let o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=r,o}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return mc(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:_,coords:g,nodeSize:b}=this,T=[0,_.length-1,0],k=[];for(;T.length;){let B=T.pop()||0,z=T.pop()||0,V=T.pop()||0;if(z-V<=b){for(let at=V;at<=z;at++){let ft=g[2*at],zt=g[2*at+1];ft>=e&&ft<=o&&zt>=r&&zt<=c&&k.push(_[at])}continue}let H=V+z>>1,K=g[2*H],Y=g[2*H+1];K>=e&&K<=o&&Y>=r&&Y<=c&&k.push(_[H]),(B===0?e<=K:r<=Y)&&(T.push(V),T.push(H-1),T.push(1-B)),(B===0?o>=K:c>=Y)&&(T.push(H+1),T.push(z),T.push(1-B))}return k}within(e,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:c,coords:_,nodeSize:g}=this,b=[0,c.length-1,0],T=[],k=o*o;for(;b.length;){let B=b.pop()||0,z=b.pop()||0,V=b.pop()||0;if(z-V<=g){for(let at=V;at<=z;at++)cd(_[2*at],_[2*at+1],e,r)<=k&&T.push(c[at]);continue}let H=V+z>>1,K=_[2*H],Y=_[2*H+1];cd(K,Y,e,r)<=k&&T.push(c[H]),(B===0?e-o<=K:r-o<=Y)&&(b.push(V),b.push(H-1),b.push(1-B)),(B===0?e+o>=K:r+o>=Y)&&(b.push(H+1),b.push(z),b.push(1-B))}return T}}function mc(n,e,r,o,c,_){if(c-o<=r)return;let g=o+c>>1;hd(n,e,g,o,c,_),mc(n,e,r,o,g-1,1-_),mc(n,e,r,g+1,c,1-_)}function hd(n,e,r,o,c,_){for(;c>o;){if(c-o>600){let k=c-o+1,B=r-o+1,z=Math.log(k),V=.5*Math.exp(2*z/3),H=.5*Math.sqrt(z*V*(k-V)/k)*(B-k/2<0?-1:1);hd(n,e,r,Math.max(o,Math.floor(r-B*V/k+H)),Math.min(c,Math.floor(r+(k-B)*V/k+H)),_)}let g=e[2*r+_],b=o,T=c;for($u(n,e,o,r),e[2*c+_]>g&&$u(n,e,o,c);b<T;){for($u(n,e,b,T),b++,T--;e[2*b+_]<g;)b++;for(;e[2*T+_]>g;)T--}e[2*o+_]===g?$u(n,e,o,T):(T++,$u(n,e,T,c)),T<=r&&(o=T+1),r<=T&&(c=T-1)}}function $u(n,e,r,o){_c(n,r,o),_c(e,2*r,2*o),_c(e,2*r+1,2*o+1)}function _c(n,e,r){let o=n[e];n[e]=n[r],n[r]=o}function cd(n,e,r,o){let c=n-r,_=e-o;return c*c+_*_}var gc;S.cw=void 0,(gc=S.cw||(S.cw={})).create="create",gc.load="load",gc.fullLoad="fullLoad";let dh=null,qu=[],yc=1e3/60,vc="loadTime",xc="fullLoadTime",Um={mark(n){performance.mark(n)},frame(n){let e=n;dh!=null&&qu.push(e-dh),dh=e},clearMetrics(){dh=null,qu=[],performance.clearMeasures(vc),performance.clearMeasures(xc);for(let n in S.cw)performance.clearMarks(S.cw[n])},getPerformanceMetrics(){performance.measure(vc,S.cw.create,S.cw.load),performance.measure(xc,S.cw.create,S.cw.fullLoad);let n=performance.getEntriesByName(vc)[0].duration,e=performance.getEntriesByName(xc)[0].duration,r=qu.length,o=1/(qu.reduce((_,g)=>_+g,0)/r/1e3),c=qu.filter(_=>_>yc).reduce((_,g)=>_+(g-yc)/yc,0);return{loadTime:n,fullLoadTime:e,fps:o,percentDroppedFrames:c/(r+c)*100,totalFrames:r}}};S.$=ti,S.A=Ri,S.B=function([n,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(r),y:n*Math.sin(e)*Math.sin(r),z:n*Math.cos(r)}},S.C=_n,S.D=jt,S.E=ye,S.F=A,S.G=wl,S.H=function(n){if(ns==null){let e=n.navigator?n.navigator.userAgent:null;ns=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ns},S.I=ec,S.J=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Dm(()=>this.process()),this.subscription=Zn(this.target,"message",r=>this.receive(r),!1),this.globalScope=Rr(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}sendAsync(n,e){return new Promise((r,o)=>{let c=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=e?Zn(e.signal,"abort",()=>{_?.unsubscribe(),delete this.resolveRejects[c];let T={id:c,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},zm):null;this.resolveRejects[c]={resolve:T=>{_?.unsubscribe(),r(T)},reject:T=>{_?.unsubscribe(),o(T)}};let g=[],b=Object.assign(Object.assign({},n),{id:c,sourceMapId:this.mapId,origin:location.origin,data:Wo(n.data,g)});this.target.postMessage(b,{transfer:g})})}receive(n){let e=n.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];let o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(Rr(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;let n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return u(this,void 0,void 0,function*(){if(e.type==="<response>"){let c=this.resolveRejects[n];return delete this.resolveRejects[n],c?void(e.error?c.reject(Fa(e.error)):c.resolve(Fa(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let r=Fa(e.data),o=new AbortController;this.abortControllers[n]=o;try{let c=yield this.messageHandlers[e.type](e.sourceMapId,r,o);this.completeTask(n,null,c)}catch(c){this.completeTask(n,c)}})}completeTask(n,e,r){let o=[];delete this.abortControllers[n];let c={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Wo(e):null,data:Wo(r,o)};this.target.postMessage(c,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.K=lt,S.L=function(){var n=new Ri(16);return Ri!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},S.M=function(n,e,r){var o,c,_,g,b,T,k,B,z,V,H,K,Y=r[0],at=r[1],ft=r[2];return e===n?(n[12]=e[0]*Y+e[4]*at+e[8]*ft+e[12],n[13]=e[1]*Y+e[5]*at+e[9]*ft+e[13],n[14]=e[2]*Y+e[6]*at+e[10]*ft+e[14],n[15]=e[3]*Y+e[7]*at+e[11]*ft+e[15]):(c=e[1],_=e[2],g=e[3],b=e[4],T=e[5],k=e[6],B=e[7],z=e[8],V=e[9],H=e[10],K=e[11],n[0]=o=e[0],n[1]=c,n[2]=_,n[3]=g,n[4]=b,n[5]=T,n[6]=k,n[7]=B,n[8]=z,n[9]=V,n[10]=H,n[11]=K,n[12]=o*Y+b*at+z*ft+e[12],n[13]=c*Y+T*at+V*ft+e[13],n[14]=_*Y+k*at+H*ft+e[14],n[15]=g*Y+B*at+K*ft+e[15]),n},S.N=function(n,e,r){var o=r[0],c=r[1],_=r[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*_,n[9]=e[9]*_,n[10]=e[10]*_,n[11]=e[11]*_,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},S.O=function(n,e,r){var o=e[0],c=e[1],_=e[2],g=e[3],b=e[4],T=e[5],k=e[6],B=e[7],z=e[8],V=e[9],H=e[10],K=e[11],Y=e[12],at=e[13],ft=e[14],zt=e[15],wt=r[0],U=r[1],st=r[2],Mt=r[3];return n[0]=wt*o+U*b+st*z+Mt*Y,n[1]=wt*c+U*T+st*V+Mt*at,n[2]=wt*_+U*k+st*H+Mt*ft,n[3]=wt*g+U*B+st*K+Mt*zt,n[4]=(wt=r[4])*o+(U=r[5])*b+(st=r[6])*z+(Mt=r[7])*Y,n[5]=wt*c+U*T+st*V+Mt*at,n[6]=wt*_+U*k+st*H+Mt*ft,n[7]=wt*g+U*B+st*K+Mt*zt,n[8]=(wt=r[8])*o+(U=r[9])*b+(st=r[10])*z+(Mt=r[11])*Y,n[9]=wt*c+U*T+st*V+Mt*at,n[10]=wt*_+U*k+st*H+Mt*ft,n[11]=wt*g+U*B+st*K+Mt*zt,n[12]=(wt=r[12])*o+(U=r[13])*b+(st=r[14])*z+(Mt=r[15])*Y,n[13]=wt*c+U*T+st*V+Mt*at,n[14]=wt*_+U*k+st*H+Mt*ft,n[15]=wt*g+U*B+st*K+Mt*zt,n},S.P=ge,S.Q=function(n,e){let r={};for(let o=0;o<e.length;o++){let c=e[o];c in n&&(r[c]=n[c])}return r},S.R=Es,S.S=kl,S.T=jh,S.U=Zp,S.V=Gp,S.W=Bi,S.X=Wi,S.Y=Rs,S.Z=Ao,S._=u,S.a=J,S.a$=function(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n},S.a0=Uu,S.a1=Jl,S.a2=25,S.a3=cc,S.a4=n=>{let e=window.document.createElement("video");return e.muted=!0,new Promise(r=>{e.onloadstart=()=>{r(e)};for(let o of n){let c=window.document.createElement("source");ee(o)||(e.crossOrigin="Anonymous"),c.src=o,e.appendChild(c)}})},S.a5=Le,S.a6=function(){return _s++},S.a7=nt,S.a8=fu,S.a9=qe,S.aA=on,S.aB=$i,S.aC=function(n,e,r,o,c=!1){if(!r[0]&&!r[1])return[0,0];let _=c?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(_){let g=Math.sin(_),b=Math.cos(_);r=[r[0]*b-r[1]*g,r[0]*g+r[1]*b]}return[c?r[0]:$i(e,r[0],n.zoom),c?r[1]:$i(e,r[1],n.zoom)]},S.aE=nc,S.aF=dc,S.aG=rc,S.aH=fc,S.aI=Q,S.aJ=ih,S.aK=te,S.aL=ki,S.aM=qi,S.aN=ro,S.aO=Vn,S.aP=Up,S.aQ=_r,S.aR=Ki,S.aS=function(n){var e=new Ri(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},S.aT=function(n,e,r){return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n},S.aU=function(n,e){var r=e[0],o=e[1],c=e[2],_=r*r+o*o+c*c;return _>0&&(_=1/Math.sqrt(_)),n[0]=e[0]*_,n[1]=e[1]*_,n[2]=e[2]*_,n},S.aV=wr,S.aW=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},S.aX=function(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n[3]=e[3]*r[3],n},S.aY=Ds,S.aZ=function(n,e,r){let o=e[0]*r[0]+e[1]*r[1]+e[2]*r[2];return o===0?null:(-(n[0]*r[0]+n[1]*r[1]+n[2]*r[2])-r[3])/o},S.a_=gr,S.aa=Kl,S.ab=Wp,S.ac=function(n){let e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,c,_)=>{let g=c||_;return e[o]=!g||g.toLowerCase(),""}),e["max-age"]){let r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},S.ad=Kr,S.ae=function(n){return Math.pow(2,n)},S.af=Fn,S.ag=nr,S.ah=85.051129,S.ai=Vp,S.aj=function(n){return Math.log(n)/Math.LN2},S.ak=function(n){var e=n[0],r=n[1];return e*e+r*r},S.al=function(n,e){let r=[];for(let o in n)o in e||r.push(o);return r},S.am=function(n,e){let r=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){let{interpolationType:c,minZoom:_,maxZoom:g}=n,b=c?nr(Ar.interpolationFactor(c,e,_,g),0,1):0;n.kind==="camera"?o=_n.number(n.minSize,n.maxSize,b):r=b}return{uSizeT:r,uSize:o}},S.ao=function(n,{uSize:e,uSizeT:r},{lowerSize:o,upperSize:c}){return n.kind==="source"?o/dl:n.kind==="composite"?_n.number(o/dl,c/dl,r):e},S.ap=function(n,e){var r=e[0],o=e[1],c=e[2],_=e[3],g=e[4],b=e[5],T=e[6],k=e[7],B=e[8],z=e[9],V=e[10],H=e[11],K=e[12],Y=e[13],at=e[14],ft=e[15],zt=r*b-o*g,wt=r*T-c*g,U=r*k-_*g,st=o*T-c*b,Mt=o*k-_*b,ae=c*k-_*T,ve=B*Y-z*K,pe=B*at-V*K,me=B*ft-H*K,Me=z*at-V*Y,be=z*ft-H*Y,Te=V*ft-H*at,_e=zt*Te-wt*be+U*Me+st*me-Mt*pe+ae*ve;return _e?(n[0]=(b*Te-T*be+k*Me)*(_e=1/_e),n[1]=(c*be-o*Te-_*Me)*_e,n[2]=(Y*ae-at*Mt+ft*st)*_e,n[3]=(V*Mt-z*ae-H*st)*_e,n[4]=(T*me-g*Te-k*pe)*_e,n[5]=(r*Te-c*me+_*pe)*_e,n[6]=(at*U-K*ae-ft*wt)*_e,n[7]=(B*ae-V*U+H*wt)*_e,n[8]=(g*be-b*me+k*ve)*_e,n[9]=(o*me-r*be-_*ve)*_e,n[10]=(K*Mt-Y*U+ft*zt)*_e,n[11]=(z*U-B*Mt-H*zt)*_e,n[12]=(b*pe-g*Me-T*ve)*_e,n[13]=(r*Me-o*pe+c*ve)*_e,n[14]=(Y*wt-K*st-at*zt)*_e,n[15]=(B*st-z*wt+V*zt)*_e,n):null},S.aq=Ye,S.ar=function(n){return Math.hypot(n[0],n[1])},S.as=function(n){return n[0]=0,n[1]=0,n},S.at=function(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n},S.au=sc,S.av=Nn,S.aw=function(n,e,r,o){let c=e.y-n.y,_=e.x-n.x,g=o.y-r.y,b=o.x-r.x,T=g*_-b*c;if(T===0)return null;let k=(b*(n.y-r.y)-g*(n.x-r.x))/T;return new ge(n.x+k*_,n.y+k*c)},S.ax=Yp,S.ay=zc,S.az=function(n){let e=1/0,r=1/0,o=-1/0,c=-1/0;for(let _ of n)e=Math.min(e,_.x),r=Math.min(r,_.y),o=Math.max(o,_.x),c=Math.max(c,_.y);return[e,r,o,c]},S.b=Gn,S.b$=cm,S.b0=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]},S.b1=qp,S.b2=mu,S.b3=function(n,e,r,o,c){var _,g=1/Math.tan(e/2);return n[0]=g/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0?(n[10]=(c+o)*(_=1/(o-c)),n[14]=2*c*o*_):(n[10]=-1,n[14]=-2*o),n},S.b4=function(n){var e=new Ri(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},S.b5=function(n,e,r){var o=Math.sin(r),c=Math.cos(r),_=e[0],g=e[1],b=e[2],T=e[3],k=e[4],B=e[5],z=e[6],V=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=_*c+k*o,n[1]=g*c+B*o,n[2]=b*c+z*o,n[3]=T*c+V*o,n[4]=k*c-_*o,n[5]=B*c-g*o,n[6]=z*c-b*o,n[7]=V*c-T*o,n},S.b6=function(n,e,r){var o=Math.sin(r),c=Math.cos(r),_=e[4],g=e[5],b=e[6],T=e[7],k=e[8],B=e[9],z=e[10],V=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=_*c+k*o,n[5]=g*c+B*o,n[6]=b*c+z*o,n[7]=T*c+V*o,n[8]=k*c-_*o,n[9]=B*c-g*o,n[10]=z*c-b*o,n[11]=V*c-T*o,n},S.b7=function(){let n=new Float32Array(16);return Fn(n),n},S.b8=function(){let n=new Float64Array(16);return Fn(n),n},S.b9=function(){return new Float64Array(16)},S.bA=function(n){return n[0]=0,n[1]=0,n[2]=0,n},S.bB=function(n,e,r,o){let c=Math.sqrt(n*n+e*e),_=Math.sqrt(r*r+o*o);n/=c,e/=c,r/=_,o/=_;let g=Math.acos(n*r+e*o);return-e*r+n*o>0?g:-g},S.bC=function(n,e){let r=Ii(n,2*Math.PI),o=Ii(e,2*Math.PI);return Math.min(Math.abs(r-o),Math.abs(r-o+2*Math.PI),Math.abs(r-o-2*Math.PI))},S.bD=function(){let n={},e=At.$version;for(let r in At.$root){let o=At.$root[r];if(o.required){let c=null;c=r==="version"?e:o.type==="array"?[]:{},c!=null&&(n[r]=c)}}return n},S.bE=jl,S.bF=Et,S.bG=function n(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],r[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(let o in e)if(!n(e[o],r[o]))return!1;return!0}return e===r},S.bH=function(n){n=n.slice();let e=Object.create(null);for(let r=0;r<n.length;r++)e[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=$e(n[r],e[n[r].ref]));return n},S.bI=function(n){if(n.type==="custom")return new Bm(n);switch(n.type){case"background":return new Em(n);case"circle":return new Mf(n);case"color-relief":return new Ef(n);case"fill":return new $f(n);case"fill-extrusion":return new Qf(n);case"heatmap":return new Tf(n);case"hillshade":return new Sf(n);case"line":return new am(n);case"raster":return new Im(n);case"symbol":return new lh(n)}},S.bJ=cn,S.bK=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let r=[];try{if(!Be(n.version,e.version))return[{command:"setStyle",args:[e]}];Be(n.center,e.center)||r.push({command:"setCenter",args:[e.center]}),Be(n.state,e.state)||r.push({command:"setGlobalState",args:[e.state]}),Be(n.centerAltitude,e.centerAltitude)||r.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Be(n.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),Be(n.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),Be(n.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),Be(n.roll,e.roll)||r.push({command:"setRoll",args:[e.roll]}),Be(n.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),Be(n.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),Be(n.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),Be(n.light,e.light)||r.push({command:"setLight",args:[e.light]}),Be(n.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),Be(n.sky,e.sky)||r.push({command:"setSky",args:[e.sky]}),Be(n.projection,e.projection)||r.push({command:"setProjection",args:[e.projection]});let o={},c=[];(function(g,b,T,k){let B;for(B in b=b||{},g=g||{})Object.prototype.hasOwnProperty.call(g,B)&&(Object.prototype.hasOwnProperty.call(b,B)||Oi(B,T,k));for(B in b)Object.prototype.hasOwnProperty.call(b,B)&&(Object.prototype.hasOwnProperty.call(g,B)?Be(g[B],b[B])||(g[B].type==="geojson"&&b[B].type==="geojson"&&Ti(g,b,B)?je(T,{command:"setGeoJSONSourceData",args:[B,b[B].data]}):Ai(B,b,T,k)):Je(B,b,T))})(n.sources,e.sources,c,o);let _=[];n.layers&&n.layers.forEach(g=>{"source"in g&&o[g.source]?r.push({command:"removeLayer",args:[g.id]}):_.push(g)}),r=r.concat(c),function(g,b,T){b=b||[];let k=(g=g||[]).map(Se),B=b.map(Se),z=g.reduce(sr,{}),V=b.reduce(sr,{}),H=k.slice(),K=Object.create(null),Y,at,ft,zt,wt;for(let U=0,st=0;U<k.length;U++)Y=k[U],Object.prototype.hasOwnProperty.call(V,Y)?st++:(je(T,{command:"removeLayer",args:[Y]}),H.splice(H.indexOf(Y,st),1));for(let U=0,st=0;U<B.length;U++)Y=B[B.length-1-U],H[H.length-1-U]!==Y&&(Object.prototype.hasOwnProperty.call(z,Y)?(je(T,{command:"removeLayer",args:[Y]}),H.splice(H.lastIndexOf(Y,H.length-st),1)):st++,zt=H[H.length-U],je(T,{command:"addLayer",args:[V[Y],zt]}),H.splice(H.length-U,0,Y),K[Y]=!0);for(let U=0;U<B.length;U++)if(Y=B[U],at=z[Y],ft=V[Y],!K[Y]&&!Be(at,ft))if(Be(at.source,ft.source)&&Be(at["source-layer"],ft["source-layer"])&&Be(at.type,ft.type)){for(wt in Ge(at.layout,ft.layout,T,Y,null,"setLayoutProperty"),Ge(at.paint,ft.paint,T,Y,null,"setPaintProperty"),Be(at.filter,ft.filter)||je(T,{command:"setFilter",args:[Y,ft.filter]}),Be(at.minzoom,ft.minzoom)&&Be(at.maxzoom,ft.maxzoom)||je(T,{command:"setLayerZoomRange",args:[Y,ft.minzoom,ft.maxzoom]}),at)Object.prototype.hasOwnProperty.call(at,wt)&&wt!=="layout"&&wt!=="paint"&&wt!=="filter"&&wt!=="metadata"&&wt!=="minzoom"&&wt!=="maxzoom"&&(wt.indexOf("paint.")===0?Ge(at[wt],ft[wt],T,Y,wt.slice(6),"setPaintProperty"):Be(at[wt],ft[wt])||je(T,{command:"setLayerProperty",args:[Y,wt,ft[wt]]}));for(wt in ft)Object.prototype.hasOwnProperty.call(ft,wt)&&!Object.prototype.hasOwnProperty.call(at,wt)&&wt!=="layout"&&wt!=="paint"&&wt!=="filter"&&wt!=="metadata"&&wt!=="minzoom"&&wt!=="maxzoom"&&(wt.indexOf("paint.")===0?Ge(at[wt],ft[wt],T,Y,wt.slice(6),"setPaintProperty"):Be(at[wt],ft[wt])||je(T,{command:"setLayerProperty",args:[Y,wt,ft[wt]]}))}else je(T,{command:"removeLayer",args:[Y]}),zt=H[H.lastIndexOf(Y)+1],je(T,{command:"addLayer",args:[ft,zt]})}(_,e.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[e]}]}return r},S.bL=function(n){let e=[],r=n.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},S.bM=ji,S.bN=rs,S.bO=class extends Qi{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},S.bP=Yu,S.bQ=class extends Qi{constructor(n,e){super(n,e),this.current=Bh}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},S.bR=$r,S.bS=class extends Qi{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},S.bT=class extends Qi{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},S.bU=Pn,S.bV=function(n,e){var r=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=r,n[2]=0,n[3]=-r,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},S.bW=function(n,e,r){var o=e[0],c=e[1],_=e[2];return n[0]=o*r[0]+c*r[3]+_*r[6],n[1]=o*r[1]+c*r[4]+_*r[7],n[2]=o*r[2]+c*r[5]+_*r[8],n},S.bX=function(n,e,r,o,c,_,g){var b=1/(e-r),T=1/(o-c),k=1/(_-g);return n[0]=-2*b,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*T,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*k,n[11]=0,n[12]=(e+r)*b,n[13]=(c+o)*T,n[14]=(g+_)*k,n[15]=1,n},S.bY=class extends Qi{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;let e=new Float32Array(4*n.length);for(let r=0;r<n.length;r++)e[4*r]=n[r].r,e[4*r+1]=n[r].g,e[4*r+2]=n[r].b,e[4*r+3]=n[r].a;this.gl.uniform4fv(this.location,e)}}},S.bZ=class extends Qi{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;let e=new Float32Array(n);this.gl.uniform1fv(this.location,e)}}},S.b_=class extends a{},S.ba=function(n,e,r){let o=new Float64Array(4);return io(o,n,e-90,r),o},S.bb=function(n,e,r,o){var c,_,g,b,T,k=e[0],B=e[1],z=e[2],V=e[3],H=r[0],K=r[1],Y=r[2],at=r[3];return(_=k*H+B*K+z*Y+V*at)<0&&(_=-_,H=-H,K=-K,Y=-Y,at=-at),1-_>Ei?(c=Math.acos(_),g=Math.sin(c),b=Math.sin((1-o)*c)/g,T=Math.sin(o*c)/g):(b=1-o,T=o),n[0]=b*k+T*H,n[1]=b*B+T*K,n[2]=b*z+T*Y,n[3]=b*V+T*at,n},S.bc=function(n){let e=new Float64Array(9);var r,o,c,_,g,b,T,k,B,z,V,H,K,Y,at,ft,zt,wt;z=(c=(o=n)[0])*(T=c+c),V=(_=o[1])*T,K=(g=o[2])*T,Y=g*(k=_+_),ft=(b=o[3])*T,zt=b*k,wt=b*(B=g+g),(r=e)[0]=1-(H=_*k)-(at=g*B),r[3]=V-wt,r[6]=K+zt,r[1]=V+wt,r[4]=1-z-at,r[7]=Y-ft,r[2]=K-zt,r[5]=Y+ft,r[8]=1-z-H;let U=Vn(-Math.asin(nr(e[2],-1,1))),st,Mt;return Math.hypot(e[5],e[8])<.001?(st=0,Mt=-Vn(Math.atan2(e[3],e[4]))):(st=Vn(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),Mt=Vn(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:st,pitch:U+90,bearing:Mt}},S.bd=function(n,e){return n.roll==e.roll&&n.pitch==e.pitch&&n.bearing==e.bearing},S.be=di,S.bf=ts,S.bg=pu,S.bh=Ou,S.bi=cu,S.bj=wi,S.bk=mi,S.bl=Qe,S.bm=function(n,e,r,o,c){return wi(o,c,nr((n-e)/(r-e),0,1))},S.bn=Ii,S.bo=function(){return new Float64Array(3)},S.bp=function(n,e,r,o){return n[0]=e[0]+r[0]*o,n[1]=e[1]+r[1]*o,n[2]=e[2]+r[2]*o,n},S.bq=io,S.br=function(n,e,r){var o=r[0],c=r[1],_=r[2],g=e[0],b=e[1],T=e[2],k=c*T-_*b,B=_*g-o*T,z=o*b-c*g,V=c*z-_*B,H=_*k-o*z,K=o*B-c*k,Y=2*r[3];return B*=Y,z*=Y,H*=2,K*=2,n[0]=g+(k*=Y)+(V*=2),n[1]=b+B+H,n[2]=T+z+K,n},S.bs=function(n,e,r){let o=(c=[n[0],n[1],n[2],e[0],e[1],e[2],r[0],r[1],r[2]])[0]*((B=c[8])*(g=c[4])-(b=c[5])*(k=c[7]))+c[1]*(-B*(_=c[3])+b*(T=c[6]))+c[2]*(k*_-g*T);var c,_,g,b,T,k,B;if(o===0)return null;let z=wr([],[e[0],e[1],e[2]],[r[0],r[1],r[2]]),V=wr([],[r[0],r[1],r[2]],[n[0],n[1],n[2]]),H=wr([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),K=_r([],z,-n[3]);return Ki(K,K,_r([],V,-e[3])),Ki(K,K,_r([],H,-r[3])),_r(K,K,1/o),K},S.bt=uc,S.bu=function(){return new Float64Array(4)},S.bv=function(n,e,r,o){var c=[],_=[];return c[0]=e[0]-r[0],c[1]=e[1]-r[1],c[2]=e[2]-r[2],_[0]=c[0]*Math.cos(o)-c[1]*Math.sin(o),_[1]=c[0]*Math.sin(o)+c[1]*Math.cos(o),_[2]=c[2],n[0]=_[0]+r[0],n[1]=_[1]+r[1],n[2]=_[2]+r[2],n},S.bw=function(n,e,r,o){var c=[],_=[];return c[0]=e[0]-r[0],c[1]=e[1]-r[1],c[2]=e[2]-r[2],_[0]=c[0],_[1]=c[1]*Math.cos(o)-c[2]*Math.sin(o),_[2]=c[1]*Math.sin(o)+c[2]*Math.cos(o),n[0]=_[0]+r[0],n[1]=_[1]+r[1],n[2]=_[2]+r[2],n},S.bx=function(n,e,r,o){var c=[],_=[];return c[0]=e[0]-r[0],c[1]=e[1]-r[1],c[2]=e[2]-r[2],_[0]=c[2]*Math.sin(o)+c[0]*Math.cos(o),_[1]=c[1],_[2]=c[2]*Math.cos(o)-c[0]*Math.sin(o),n[0]=_[0]+r[0],n[1]=_[1]+r[1],n[2]=_[2]+r[2],n},S.by=function(n,e,r){var o=Math.sin(r),c=Math.cos(r),_=e[0],g=e[1],b=e[2],T=e[3],k=e[8],B=e[9],z=e[10],V=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=_*c-k*o,n[1]=g*c-B*o,n[2]=b*c-z*o,n[3]=T*c-V*o,n[8]=_*o+k*c,n[9]=g*o+B*c,n[10]=b*o+z*c,n[11]=T*o+V*c,n},S.bz=function(n,e){let r=Ii(n,360),o=Ii(e,360),c=o-r,_=o>r?c-360:c+360;return Math.abs(c)<Math.abs(_)?c:_},S.c=Gt,S.c0=class extends m{},S.c1=Nh,S.c2=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},S.c3=$c,S.c4=function(n,e,r){var o=e[0],c=e[1],_=e[2],g=r[3]*o+r[7]*c+r[11]*_+r[15];return n[0]=(r[0]*o+r[4]*c+r[8]*_+r[12])/(g=g||1),n[1]=(r[1]*o+r[5]*c+r[9]*_+r[13])/g,n[2]=(r[2]*o+r[6]*c+r[10]*_+r[14])/g,n},S.c5=class extends pt{},S.c6=class extends O{},S.c7=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},S.c8=function(n,e){var r=n[0],o=n[1],c=n[2],_=n[3],g=n[4],b=n[5],T=n[6],k=n[7],B=n[8],z=n[9],V=n[10],H=n[11],K=n[12],Y=n[13],at=n[14],ft=n[15],zt=e[0],wt=e[1],U=e[2],st=e[3],Mt=e[4],ae=e[5],ve=e[6],pe=e[7],me=e[8],Me=e[9],be=e[10],Te=e[11],_e=e[12],Oe=e[13],We=e[14],Ue=e[15];return Math.abs(r-zt)<=Ei*Math.max(1,Math.abs(r),Math.abs(zt))&&Math.abs(o-wt)<=Ei*Math.max(1,Math.abs(o),Math.abs(wt))&&Math.abs(c-U)<=Ei*Math.max(1,Math.abs(c),Math.abs(U))&&Math.abs(_-st)<=Ei*Math.max(1,Math.abs(_),Math.abs(st))&&Math.abs(g-Mt)<=Ei*Math.max(1,Math.abs(g),Math.abs(Mt))&&Math.abs(b-ae)<=Ei*Math.max(1,Math.abs(b),Math.abs(ae))&&Math.abs(T-ve)<=Ei*Math.max(1,Math.abs(T),Math.abs(ve))&&Math.abs(k-pe)<=Ei*Math.max(1,Math.abs(k),Math.abs(pe))&&Math.abs(B-me)<=Ei*Math.max(1,Math.abs(B),Math.abs(me))&&Math.abs(z-Me)<=Ei*Math.max(1,Math.abs(z),Math.abs(Me))&&Math.abs(V-be)<=Ei*Math.max(1,Math.abs(V),Math.abs(be))&&Math.abs(H-Te)<=Ei*Math.max(1,Math.abs(H),Math.abs(Te))&&Math.abs(K-_e)<=Ei*Math.max(1,Math.abs(K),Math.abs(_e))&&Math.abs(Y-Oe)<=Ei*Math.max(1,Math.abs(Y),Math.abs(Oe))&&Math.abs(at-We)<=Ei*Math.max(1,Math.abs(at),Math.abs(We))&&Math.abs(ft-Ue)<=Ei*Math.max(1,Math.abs(ft),Math.abs(Ue))},S.c9=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},S.cA=function(n){delete J.REGISTERED_PROTOCOLS[n]},S.cB=function(n,e){let r={};for(let c=0;c<n.length;c++){let _=e&&e[n[c].id]||Js(n[c]);e&&(e[n[c].id]=_);let g=r[_];g||(g=r[_]=[]),g.push(n[c])}let o=[];for(let c in r)o.push(r[c]);return o},S.cC=De,S.cD=Hp,S.cE=Kp,S.cF=Lp,S.cG=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=ti/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;let e=n.bucket.layers[0],r=e.layout,o=e._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new A(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new A(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new A(18))};if(n.bucket.textSizeData.kind==="composite"){let{minZoom:k,maxZoom:B}=n.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new A(k),n.canonical),o["text-size"].possiblyEvaluate(new A(B),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){let{minZoom:k,maxZoom:B}=n.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new A(k),n.canonical),o["icon-size"].possiblyEvaluate(new A(B),n.canonical)]}let _=r.get("text-line-height")*on,g=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",b=r.get("text-keep-upright"),T=r.get("text-size");for(let k of n.bucket.features){let B=r.get("text-font").evaluate(k,{},n.canonical).join(","),z=T.evaluate(k,{},n.canonical),V=c.layoutTextSize.evaluate(k,{},n.canonical),H=c.layoutIconSize.evaluate(k,{},n.canonical),K={horizontal:{},vertical:void 0},Y=k.text,at,ft=[0,0];if(Y){let U=Y.toString(),st=r.get("text-letter-spacing").evaluate(k,{},n.canonical)*on,Mt=ko(U)?st:0,ae=r.get("text-anchor").evaluate(k,{},n.canonical),ve=od(e,k,n.canonical);if(!ve){let be=r.get("text-radial-offset").evaluate(k,{},n.canonical);ft=be?sd(ae,[be*on,pc]):r.get("text-offset").evaluate(k,{},n.canonical).map(Te=>Te*on)}let pe=g?"center":r.get("text-justify").evaluate(k,{},n.canonical),me=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(k,{},n.canonical)*on:1/0,Me=()=>{n.bucket.allowVerticalPlacement&&xr(U)&&(K.vertical=sh(Y,n.glyphMap,n.glyphPositions,n.imagePositions,B,me,_,ae,"left",Mt,ft,S.an.vertical,!0,V,z))};if(!g&&ve){let be=new Set;if(pe==="auto")for(let _e=0;_e<ve.values.length;_e+=2)be.add(dc(ve.values[_e]));else be.add(pe);let Te=!1;for(let _e of be)if(!K.horizontal[_e])if(Te)K.horizontal[_e]=K.horizontal[0];else{let Oe=sh(Y,n.glyphMap,n.glyphPositions,n.imagePositions,B,me,_,"center",_e,Mt,ft,S.an.horizontal,!1,V,z);Oe&&(K.horizontal[_e]=Oe,Te=Oe.positionedLines.length===1)}Me()}else{pe==="auto"&&(pe=dc(ae));let be=sh(Y,n.glyphMap,n.glyphPositions,n.imagePositions,B,me,_,ae,pe,Mt,ft,S.an.horizontal,!1,V,z);be&&(K.horizontal[pe]=be),Me(),xr(U)&&g&&b&&(K.vertical=sh(Y,n.glyphMap,n.glyphPositions,n.imagePositions,B,me,_,ae,pe,Mt,ft,S.an.vertical,!1,V,z))}}let zt=!1;if(k.icon&&k.icon.name){let U=n.imageMap[k.icon.name];U&&(at=Lm(n.imagePositions[k.icon.name],r.get("icon-offset").evaluate(k,{},n.canonical),r.get("icon-anchor").evaluate(k,{},n.canonical)),zt=!!U.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=zt:n.bucket.sdfIcons!==zt&&fr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(U.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}let wt=ld(K.horizontal)||K.vertical;n.bucket.iconsInText=!!wt&&wt.iconsInText,(wt||at)&&Zm(n.bucket,k,K,at,n.imageMap,c,V,H,ft,zt,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},S.cH=Yh,S.cI=$h,S.cJ=Xh,S.cK=Nu,S.cL=tc,S.cM=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},S.cN=function(n,e,r,o,c){return u(this,void 0,void 0,function*(){if(Wi())try{return yield Rs(n,e,r,o,c)}catch{}return function(_,g,b,T,k){let B=_.width,z=_.height;gs&&no||(gs=new OffscreenCanvas(B,z),no=gs.getContext("2d",{willReadFrequently:!0})),gs.width=B,gs.height=z,no.drawImage(_,0,0,B,z);let V=no.getImageData(g,b,T,k);return no.clearRect(0,0,B,z),V.data}(n,e,r,o,c)})},S.cO=Wc,S.cP=rt,S.cQ=Kt,S.cR=cp,S.cS=Cp,S.cT=w,S.cU=M,S.ca=n=>n.type==="symbol",S.cb=n=>n.type==="circle",S.cc=n=>n.type==="heatmap",S.cd=n=>n.type==="line",S.ce=n=>n.type==="fill",S.cf=n=>n.type==="fill-extrusion",S.cg=n=>n.type==="hillshade",S.ch=n=>n.type==="color-relief",S.ci=n=>n.type==="raster",S.cj=n=>n.type==="background",S.ck=n=>n.type==="custom",S.cl=Wr,S.cm=function(n,e,r){let o=bi(e.x-r.x,e.y-r.y),c=bi(n.x-r.x,n.y-r.y);var _,g;return Vn(Math.atan2(o[0]*c[1]-o[1]*c[0],(_=o)[0]*(g=c)[0]+_[1]*g[1]))},S.cn=jn,S.co=function(n,e){return Yo[e]&&(n instanceof MouseEvent||n instanceof WheelEvent)},S.cp=function(n,e){return Xo[e]&&"touches"in n},S.cq=function(n){return Xo[n]||Yo[n]},S.cr=function(n,e,r){var o=e[0],c=e[1];return n[0]=r[0]*o+r[4]*c+r[12],n[1]=r[1]*o+r[5]*c+r[13],n},S.cs=function(n,e){let{x:r,y:o}=Uu.fromLngLat(e);return!(n<0||n>25||o<0||o>=1||r<0||r>=1)},S.ct=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},S.cu=class extends ht{},S.cv=Um,S.cx=function(n){return n.message===Un},S.cy=vt,S.cz=function(n,e){J.REGISTERED_PROTOCOLS[n]=e},S.d=ee,S.e=yr,S.f=n=>u(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));let e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.g=tt,S.h=n=>new Promise((e,r)=>{let o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=zo})},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let c=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(c):zo}),S.i=Rr,S.j=(n,e)=>Nt(yr(n,{type:"json"}),e),S.k=qt,S.l=ce,S.m=Nt,S.n=(n,e)=>Nt(yr(n,{type:"arrayBuffer"}),e),S.o=function(n){return new tc(n).readFields(fm,[])},S.p=Mp,S.q=Iu,S.r=St,S.s=Zn,S.t=W,S.u=xi,S.v=At,S.w=fr,S.x=Lu,S.y=cl,S.z=ya}),Vt("worker",["./shared"],function(S){"use strict";class u{constructor(J){this.keyCache={},J&&this.replace(J)}replace(J){this._layerConfigs={},this._layers={},this.update(J,[])}update(J,tt){for(let vt of J){this._layerConfigs[vt.id]=vt;let Et=this._layers[vt.id]=S.bI(vt);Et._featureFilter=S.a9(Et.filter),this.keyCache[vt.id]&&delete this.keyCache[vt.id]}for(let vt of tt)delete this.keyCache[vt],delete this._layerConfigs[vt],delete this._layers[vt];this.familiesBySource={};let lt=S.cB(Object.values(this._layerConfigs),this.keyCache);for(let vt of lt){let Et=vt.map(qt=>this._layers[qt.id]),Nt=Et[0];if(Nt.visibility==="none")continue;let ee=Nt.source||"",Rt=this.familiesBySource[ee];Rt||(Rt=this.familiesBySource[ee]={});let fe=Nt.sourceLayer||"_geojsonTileLayer",ce=Rt[fe];ce||(ce=Rt[fe]=[]),ce.push(Et)}}}class rt{constructor(J){let tt={},lt=[];for(let ee in J){let Rt=J[ee],fe=tt[ee]={};for(let ce in Rt){let qt=Rt[+ce];if(!qt||qt.bitmap.width===0||qt.bitmap.height===0)continue;let ye={x:0,y:0,w:qt.bitmap.width+2,h:qt.bitmap.height+2};lt.push(ye),fe[ce]={rect:ye,metrics:qt.metrics}}}let{w:vt,h:Et}=S.p(lt),Nt=new S.q({width:vt||1,height:Et||1});for(let ee in J){let Rt=J[ee];for(let fe in Rt){let ce=Rt[+fe];if(!ce||ce.bitmap.width===0||ce.bitmap.height===0)continue;let qt=tt[ee][fe].rect;S.q.copy(ce.bitmap,Nt,{x:0,y:0},{x:qt.x+1,y:qt.y+1},ce.bitmap)}}this.image=Nt,this.positions=tt}}S.cC("GlyphAtlas",rt);class Qt{constructor(J){this.tileID=new S.Z(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId,this.inFlightDependencies=[],this.globalState=J.globalState}parse(J,tt,lt,vt,Et){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=J,this.collisionBoxArray=new S.a7;let Nt=new S.cD(Object.keys(J.layers).sort()),ee=new S.cE(this.tileID,this.promoteId);ee.bucketLayerIDs=[];let Rt={},fe={featureIndex:ee,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:lt,subdivisionGranularity:Et},ce=tt.familiesBySource[this.source];for(let Ge in ce){let Se=J.layers[Ge];if(!Se)continue;Se.version===1&&S.w(`Vector tile source "${this.source}" layer "${Ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let sr=Nt.encode(Ge),Le=[];for(let vr=0;vr<Se.length;vr++){let Gi=Se.feature(vr),$n=ee.getId(Gi,Ge);Le.push({feature:Gi,id:$n,index:vr,sourceLayerIndex:sr})}for(let vr of ce[Ge]){let Gi=vr[0];Gi.source!==this.source&&S.w(`layer.source = ${Gi.source} does not equal this.source = ${this.source}`),Gi.minzoom&&this.zoom<Math.floor(Gi.minzoom)||Gi.maxzoom&&this.zoom>=Gi.maxzoom||Gi.visibility!=="none"&&(se(vr,this.zoom,lt),(Rt[Gi.id]=Gi.createBucket({index:ee.bucketLayerIDs.length,layers:vr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:sr,sourceID:this.source,globalState:this.globalState})).populate(Le,fe,this.tileID.canonical),ee.bucketLayerIDs.push(vr.map($n=>$n.id)))}}let qt=S.bM(fe.glyphDependencies,Ge=>Object.keys(Ge).map(Number));this.inFlightDependencies.forEach(Ge=>Ge?.abort()),this.inFlightDependencies=[];let ye=Promise.resolve({});if(Object.keys(qt).length){let Ge=new AbortController;this.inFlightDependencies.push(Ge),ye=vt.sendAsync({type:"GG",data:{stacks:qt,source:this.source,tileID:this.tileID,type:"glyphs"}},Ge)}let At=Object.keys(fe.iconDependencies),Ie=Promise.resolve({});if(At.length){let Ge=new AbortController;this.inFlightDependencies.push(Ge),Ie=vt.sendAsync({type:"GI",data:{icons:At,source:this.source,tileID:this.tileID,type:"icons"}},Ge)}let $e=Object.keys(fe.patternDependencies),Be=Promise.resolve({});if($e.length){let Ge=new AbortController;this.inFlightDependencies.push(Ge),Be=vt.sendAsync({type:"GI",data:{icons:$e,source:this.source,tileID:this.tileID,type:"patterns"}},Ge)}let[je,Je,Oi]=yield Promise.all([ye,Ie,Be]),Ai=new rt(je),Ti=new S.cF(Je,Oi);for(let Ge in Rt){let Se=Rt[Ge];Se instanceof S.a8?(se(Se.layers,this.zoom,lt),S.cG({bucket:Se,glyphMap:je,glyphPositions:Ai.positions,imageMap:Je,imagePositions:Ti.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:fe.subdivisionGranularity})):Se.hasPattern&&(Se instanceof S.cH||Se instanceof S.cI||Se instanceof S.cJ)&&(se(Se.layers,this.zoom,lt),Se.addFeatures(fe,this.tileID.canonical,Ti.patternPositions))}return this.status="done",{buckets:Object.values(Rt).filter(Ge=>!Ge.isEmpty()),featureIndex:ee,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ai.image,imageAtlas:Ti,glyphMap:this.returnDependencies?je:null,iconMap:this.returnDependencies?Je:null,glyphPositions:this.returnDependencies?Ai.positions:null}})}}function se(Gt,J,tt){let lt=new S.F(J);for(let vt of Gt)vt.recalculate(lt,tt)}class Kt{constructor(J,tt,lt){this.actor=J,this.layerIndex=tt,this.availableImages=lt,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(J,tt){return S._(this,void 0,void 0,function*(){let lt=yield S.n(J.request,tt);try{return{vectorTile:new S.cK.VectorTile(new S.cL(lt.data)),rawData:lt.data,cacheControl:lt.cacheControl,expires:lt.expires}}catch(vt){let Et=new Uint8Array(lt.data),Nt=`Unable to parse the tile at ${J.request.url}, `;throw Nt+=Et[0]===31&&Et[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${vt.message}`,new Error(Nt)}})}loadTile(J){return S._(this,void 0,void 0,function*(){let tt=J.uid,lt=!!(J&&J.request&&J.request.collectResourceTiming)&&new S.cM(J.request),vt=new Qt(J);this.loading[tt]=vt;let Et=new AbortController;vt.abort=Et;try{let Nt=yield this.loadVectorTile(J,Et);if(delete this.loading[tt],!Nt)return null;let ee=Nt.rawData,Rt={};Nt.expires&&(Rt.expires=Nt.expires),Nt.cacheControl&&(Rt.cacheControl=Nt.cacheControl);let fe={};if(lt){let qt=lt.finish();qt&&(fe.resourceTiming=JSON.parse(JSON.stringify(qt)))}vt.vectorTile=Nt.vectorTile;let ce=vt.parse(Nt.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity);this.loaded[tt]=vt,this.fetching[tt]={rawTileData:ee,cacheControl:Rt,resourceTiming:fe};try{let qt=yield ce;return S.e({rawTileData:ee.slice(0)},qt,Rt,fe)}finally{delete this.fetching[tt]}}catch(Nt){throw delete this.loading[tt],vt.status="done",this.loaded[tt]=vt,Nt}})}reloadTile(J){return S._(this,void 0,void 0,function*(){let tt=J.uid;if(!this.loaded||!this.loaded[tt])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let lt=this.loaded[tt];if(lt.showCollisionBoxes=J.showCollisionBoxes,lt.globalState=J.globalState,lt.status==="parsing"){let vt=yield lt.parse(lt.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity),Et;if(this.fetching[tt]){let{rawTileData:Nt,cacheControl:ee,resourceTiming:Rt}=this.fetching[tt];delete this.fetching[tt],Et=S.e({rawTileData:Nt.slice(0)},vt,ee,Rt)}else Et=vt;return Et}if(lt.status==="done"&&lt.vectorTile)return lt.parse(lt.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity)})}abortTile(J){return S._(this,void 0,void 0,function*(){let tt=this.loading,lt=J.uid;tt&&tt[lt]&&tt[lt].abort&&(tt[lt].abort.abort(),delete tt[lt])})}removeTile(J){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[J.uid]&&delete this.loaded[J.uid]})}}class re{constructor(){this.loaded={}}loadTile(J){return S._(this,void 0,void 0,function*(){let{uid:tt,encoding:lt,rawImageData:vt,redFactor:Et,greenFactor:Nt,blueFactor:ee,baseShift:Rt}=J,fe=vt.width+2,ce=vt.height+2,qt=S.b(vt)?new S.R({width:fe,height:ce},yield S.cN(vt,-1,-1,fe,ce)):vt,ye=new S.cO(tt,qt,lt,Et,Nt,ee,Rt);return this.loaded=this.loaded||{},this.loaded[tt]=ye,ye})}removeTile(J){let tt=this.loaded,lt=J.uid;tt&&tt[lt]&&delete tt[lt]}}var _t,ge,Ae=function(){if(ge)return _t;function Gt(tt,lt){if(tt.length!==0){J(tt[0],lt);for(var vt=1;vt<tt.length;vt++)J(tt[vt],!lt)}}function J(tt,lt){for(var vt=0,Et=0,Nt=0,ee=tt.length,Rt=ee-1;Nt<ee;Rt=Nt++){var fe=(tt[Nt][0]-tt[Rt][0])*(tt[Rt][1]+tt[Nt][1]),ce=vt+fe;Et+=Math.abs(vt)>=Math.abs(fe)?vt-ce+fe:fe-ce+vt,vt=ce}vt+Et>=0!=!!lt&&tt.reverse()}return ge=1,_t=function tt(lt,vt){var Et,Nt=lt&&lt.type;if(Nt==="FeatureCollection")for(Et=0;Et<lt.features.length;Et++)tt(lt.features[Et],vt);else if(Nt==="GeometryCollection")for(Et=0;Et<lt.geometries.length;Et++)tt(lt.geometries[Et],vt);else if(Nt==="Feature")tt(lt.geometry,vt);else if(Nt==="Polygon")Gt(lt.coordinates,vt);else if(Nt==="MultiPolygon")for(Et=0;Et<lt.coordinates.length;Et++)Gt(lt.coordinates[Et],vt);return lt}}(),pi=S.cP(Ae);let Ze=S.cK.VectorTileFeature.prototype.toGeoJSON;class gi{constructor(J){this._feature=J,this.extent=S.$,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){let J=[];for(let tt of this._feature.geometry)J.push([new S.P(tt[0],tt[1])]);return J}{let J=[];for(let tt of this._feature.geometry){let lt=[];for(let vt of tt)lt.push(new S.P(vt[0],vt[1]));J.push(lt)}return J}}toGeoJSON(J,tt,lt){return Ze.call(this,J,tt,lt)}}class Bi{constructor(J){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.$,this.length=J.length,this._features=J}feature(J){return new gi(this._features[J])}}var Wi,Ei,Ri,Pn={exports:{}},Fn=function(){if(Ri)return Pn.exports;Ri=1;var Gt=S.cS(),J=function(){if(Ei)return Wi;Ei=1;var ce=S.cQ(),qt=S.cR().VectorTileFeature;function ye(Ie,$e){this.options=$e||{},this.features=Ie,this.length=Ie.length}function At(Ie,$e){this.id=typeof Ie.id=="number"?Ie.id:void 0,this.type=Ie.type,this.rawGeometry=Ie.type===1?[Ie.geometry]:Ie.geometry,this.properties=Ie.tags,this.extent=$e||4096}return Wi=ye,ye.prototype.feature=function(Ie){return new At(this.features[Ie],this.options.extent)},At.prototype.loadGeometry=function(){var Ie=this.rawGeometry;this.geometry=[];for(var $e=0;$e<Ie.length;$e++){for(var Be=Ie[$e],je=[],Je=0;Je<Be.length;Je++)je.push(new ce(Be[Je][0],Be[Je][1]));this.geometry.push(je)}return this.geometry},At.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ie=this.geometry,$e=1/0,Be=-1/0,je=1/0,Je=-1/0,Oi=0;Oi<Ie.length;Oi++)for(var Ai=Ie[Oi],Ti=0;Ti<Ai.length;Ti++){var Ge=Ai[Ti];$e=Math.min($e,Ge.x),Be=Math.max(Be,Ge.x),je=Math.min(je,Ge.y),Je=Math.max(Je,Ge.y)}return[$e,je,Be,Je]},At.prototype.toGeoJSON=qt.prototype.toGeoJSON,Wi}();function tt(ce){var qt=new Gt;return function(ye,At){for(var Ie in ye.layers)At.writeMessage(3,lt,ye.layers[Ie])}(ce,qt),qt.finish()}function lt(ce,qt){var ye;qt.writeVarintField(15,ce.version||1),qt.writeStringField(1,ce.name||""),qt.writeVarintField(5,ce.extent||4096);var At={keys:[],values:[],keycache:{},valuecache:{}};for(ye=0;ye<ce.length;ye++)At.feature=ce.feature(ye),qt.writeMessage(2,vt,At);var Ie=At.keys;for(ye=0;ye<Ie.length;ye++)qt.writeStringField(3,Ie[ye]);var $e=At.values;for(ye=0;ye<$e.length;ye++)qt.writeMessage(4,fe,$e[ye])}function vt(ce,qt){var ye=ce.feature;ye.id!==void 0&&qt.writeVarintField(1,ye.id),qt.writeMessage(2,Et,ce),qt.writeVarintField(3,ye.type),qt.writeMessage(4,Rt,ye)}function Et(ce,qt){var ye=ce.feature,At=ce.keys,Ie=ce.values,$e=ce.keycache,Be=ce.valuecache;for(var je in ye.properties){var Je=ye.properties[je],Oi=$e[je];if(Je!==null){Oi===void 0&&(At.push(je),$e[je]=Oi=At.length-1),qt.writeVarint(Oi);var Ai=typeof Je;Ai!=="string"&&Ai!=="boolean"&&Ai!=="number"&&(Je=JSON.stringify(Je));var Ti=Ai+":"+Je,Ge=Be[Ti];Ge===void 0&&(Ie.push(Je),Be[Ti]=Ge=Ie.length-1),qt.writeVarint(Ge)}}}function Nt(ce,qt){return(qt<<3)+(7&ce)}function ee(ce){return ce<<1^ce>>31}function Rt(ce,qt){for(var ye=ce.loadGeometry(),At=ce.type,Ie=0,$e=0,Be=ye.length,je=0;je<Be;je++){var Je=ye[je],Oi=1;At===1&&(Oi=Je.length),qt.writeVarint(Nt(1,Oi));for(var Ai=At===3?Je.length-1:Je.length,Ti=0;Ti<Ai;Ti++){Ti===1&&At!==1&&qt.writeVarint(Nt(2,Ai-1));var Ge=Je[Ti].x-Ie,Se=Je[Ti].y-$e;qt.writeVarint(ee(Ge)),qt.writeVarint(ee(Se)),Ie+=Ge,$e+=Se}At===3&&qt.writeVarint(Nt(7,1))}}function fe(ce,qt){var ye=typeof ce;ye==="string"?qt.writeStringField(1,ce):ye==="boolean"?qt.writeBooleanField(7,ce):ye==="number"&&(ce%1!=0?qt.writeDoubleField(3,ce):ce<0?qt.writeSVarintField(6,ce):qt.writeVarintField(5,ce))}return Pn.exports=tt,Pn.exports.fromVectorTileJs=tt,Pn.exports.fromGeojsonVt=function(ce,qt){qt=qt||{};var ye={};for(var At in ce)ye[At]=new J(ce[At].features,qt),ye[At].name=At,ye[At].version=qt.version,ye[At].extent=qt.extent;return tt({layers:ye})},Pn.exports.GeoJSONWrapper=J,Pn.exports}(),Bs=S.cP(Fn);let Ds={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Gt=>Gt},dr=Math.fround||(Ki=new Float32Array(1),Gt=>(Ki[0]=+Gt,Ki[0]));var Ki;class _r{constructor(J){this.options=Object.assign(Object.create(Ds),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){let{log:tt,minZoom:lt,maxZoom:vt}=this.options;tt&&console.time("total time");let Et=`prepare ${J.length} points`;tt&&console.time(Et),this.points=J;let Nt=[];for(let Rt=0;Rt<J.length;Rt++){let fe=J[Rt];if(!fe.geometry)continue;let[ce,qt]=fe.geometry.coordinates,ye=dr(gr(ce)),At=dr(Nn(qt));Nt.push(ye,At,1/0,Rt,-1,1),this.options.reduce&&Nt.push(0)}let ee=this.trees[vt+1]=this._createTree(Nt);tt&&console.timeEnd(Et);for(let Rt=vt;Rt>=lt;Rt--){let fe=+Date.now();ee=this.trees[Rt]=this._createTree(this._cluster(ee,Rt)),tt&&console.log("z%d: %d clusters in %dms",Rt,ee.numItems,+Date.now()-fe)}return tt&&console.timeEnd("total time"),this}getClusters(J,tt){let lt=((J[0]+180)%360+360)%360-180,vt=Math.max(-90,Math.min(90,J[1])),Et=J[2]===180?180:((J[2]+180)%360+360)%360-180,Nt=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)lt=-180,Et=180;else if(lt>Et){let qt=this.getClusters([lt,vt,180,Nt],tt),ye=this.getClusters([-180,vt,Et,Nt],tt);return qt.concat(ye)}let ee=this.trees[this._limitZoom(tt)],Rt=ee.range(gr(lt),Nn(Nt),gr(Et),Nn(vt)),fe=ee.data,ce=[];for(let qt of Rt){let ye=this.stride*qt;ce.push(fe[ye+5]>1?wr(fe,ye,this.clusterProps):this.points[fe[ye+3]])}return ce}getChildren(J){let tt=this._getOriginId(J),lt=this._getOriginZoom(J),vt="No cluster with the specified id.",Et=this.trees[lt];if(!Et)throw new Error(vt);let Nt=Et.data;if(tt*this.stride>=Nt.length)throw new Error(vt);let ee=this.options.radius/(this.options.extent*Math.pow(2,lt-1)),Rt=Et.within(Nt[tt*this.stride],Nt[tt*this.stride+1],ee),fe=[];for(let ce of Rt){let qt=ce*this.stride;Nt[qt+4]===J&&fe.push(Nt[qt+5]>1?wr(Nt,qt,this.clusterProps):this.points[Nt[qt+3]])}if(fe.length===0)throw new Error(vt);return fe}getLeaves(J,tt,lt){let vt=[];return this._appendLeaves(vt,J,tt=tt||10,lt=lt||0,0),vt}getTile(J,tt,lt){let vt=this.trees[this._limitZoom(J)],Et=Math.pow(2,J),{extent:Nt,radius:ee}=this.options,Rt=ee/Nt,fe=(lt-Rt)/Et,ce=(lt+1+Rt)/Et,qt={features:[]};return this._addTileFeatures(vt.range((tt-Rt)/Et,fe,(tt+1+Rt)/Et,ce),vt.data,tt,lt,Et,qt),tt===0&&this._addTileFeatures(vt.range(1-Rt/Et,fe,1,ce),vt.data,Et,lt,Et,qt),tt===Et-1&&this._addTileFeatures(vt.range(0,fe,Rt/Et,ce),vt.data,-1,lt,Et,qt),qt.features.length?qt:null}getClusterExpansionZoom(J){let tt=this._getOriginZoom(J)-1;for(;tt<=this.options.maxZoom;){let lt=this.getChildren(J);if(tt++,lt.length!==1)break;J=lt[0].properties.cluster_id}return tt}_appendLeaves(J,tt,lt,vt,Et){let Nt=this.getChildren(tt);for(let ee of Nt){let Rt=ee.properties;if(Rt&&Rt.cluster?Et+Rt.point_count<=vt?Et+=Rt.point_count:Et=this._appendLeaves(J,Rt.cluster_id,lt,vt,Et):Et<vt?Et++:J.push(ee),J.length===lt)break}return Et}_createTree(J){let tt=new S.aH(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let lt=0;lt<J.length;lt+=this.stride)tt.add(J[lt],J[lt+1]);return tt.finish(),tt.data=J,tt}_addTileFeatures(J,tt,lt,vt,Et,Nt){for(let ee of J){let Rt=ee*this.stride,fe=tt[Rt+5]>1,ce,qt,ye;if(fe)ce=is(tt,Rt,this.clusterProps),qt=tt[Rt],ye=tt[Rt+1];else{let $e=this.points[tt[Rt+3]];ce=$e.properties;let[Be,je]=$e.geometry.coordinates;qt=gr(Be),ye=Nn(je)}let At={type:1,geometry:[[Math.round(this.options.extent*(qt*Et-lt)),Math.round(this.options.extent*(ye*Et-vt))]],tags:ce},Ie;Ie=fe||this.options.generateId?tt[Rt+3]:this.points[tt[Rt+3]].id,Ie!==void 0&&(At.id=Ie),Nt.features.push(At)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,tt){let{radius:lt,extent:vt,reduce:Et,minPoints:Nt}=this.options,ee=lt/(vt*Math.pow(2,tt)),Rt=J.data,fe=[],ce=this.stride;for(let qt=0;qt<Rt.length;qt+=ce){if(Rt[qt+2]<=tt)continue;Rt[qt+2]=tt;let ye=Rt[qt],At=Rt[qt+1],Ie=J.within(Rt[qt],Rt[qt+1],ee),$e=Rt[qt+5],Be=$e;for(let je of Ie){let Je=je*ce;Rt[Je+2]>tt&&(Be+=Rt[Je+5])}if(Be>$e&&Be>=Nt){let je,Je=ye*$e,Oi=At*$e,Ai=-1,Ti=(qt/ce<<5)+(tt+1)+this.points.length;for(let Ge of Ie){let Se=Ge*ce;if(Rt[Se+2]<=tt)continue;Rt[Se+2]=tt;let sr=Rt[Se+5];Je+=Rt[Se]*sr,Oi+=Rt[Se+1]*sr,Rt[Se+4]=Ti,Et&&(je||(je=this._map(Rt,qt,!0),Ai=this.clusterProps.length,this.clusterProps.push(je)),Et(je,this._map(Rt,Se)))}Rt[qt+4]=Ti,fe.push(Je/Be,Oi/Be,1/0,Ti,-1,Be),Et&&fe.push(Ai)}else{for(let je=0;je<ce;je++)fe.push(Rt[qt+je]);if(Be>1)for(let je of Ie){let Je=je*ce;if(!(Rt[Je+2]<=tt)){Rt[Je+2]=tt;for(let Oi=0;Oi<ce;Oi++)fe.push(Rt[Je+Oi])}}}}return fe}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,tt,lt){if(J[tt+5]>1){let Nt=this.clusterProps[J[tt+6]];return lt?Object.assign({},Nt):Nt}let vt=this.points[J[tt+3]].properties,Et=this.options.map(vt);return lt&&Et===vt?Object.assign({},Et):Et}}function wr(Gt,J,tt){return{type:"Feature",id:Gt[J+3],properties:is(Gt,J,tt),geometry:{type:"Point",coordinates:[(lt=Gt[J],360*(lt-.5)),ei(Gt[J+1])]}};var lt}function is(Gt,J,tt){let lt=Gt[J+5],vt=lt>=1e4?`${Math.round(lt/1e3)}k`:lt>=1e3?Math.round(lt/100)/10+"k":lt,Et=Gt[J+6],Nt=Et===-1?{}:Object.assign({},tt[Et]);return Object.assign(Nt,{cluster:!0,cluster_id:Gt[J+3],point_count:lt,point_count_abbreviated:vt})}function gr(Gt){return Gt/360+.5}function Nn(Gt){let J=Math.sin(Gt*Math.PI/180),tt=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return tt<0?0:tt>1?1:tt}function ei(Gt){let J=(180-360*Gt)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function io(Gt,J,tt,lt){let vt=lt,Et=J+(tt-J>>1),Nt,ee=tt-J,Rt=Gt[J],fe=Gt[J+1],ce=Gt[tt],qt=Gt[tt+1];for(let ye=J+3;ye<tt;ye+=3){let At=Ye(Gt[ye],Gt[ye+1],Rt,fe,ce,qt);if(At>vt)Nt=ye,vt=At;else if(At===vt){let Ie=Math.abs(ye-Et);Ie<ee&&(Nt=ye,ee=Ie)}}vt>lt&&(Nt-J>3&&io(Gt,J,Nt,lt),Gt[Nt+2]=vt,tt-Nt>3&&io(Gt,Nt,tt,lt))}function Ye(Gt,J,tt,lt,vt,Et){let Nt=vt-tt,ee=Et-lt;if(Nt!==0||ee!==0){let Rt=((Gt-tt)*Nt+(J-lt)*ee)/(Nt*Nt+ee*ee);Rt>1?(tt=vt,lt=Et):Rt>0&&(tt+=Nt*Rt,lt+=ee*Rt)}return Nt=Gt-tt,ee=J-lt,Nt*Nt+ee*ee}function bi(Gt,J,tt,lt){let vt={id:Gt??null,type:J,geometry:tt,tags:lt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")ti(vt,tt);else if(J==="Polygon")ti(vt,tt[0]);else if(J==="MultiLineString")for(let Et of tt)ti(vt,Et);else if(J==="MultiPolygon")for(let Et of tt)ti(vt,Et[0]);return vt}function ti(Gt,J){for(let tt=0;tt<J.length;tt+=3)Gt.minX=Math.min(Gt.minX,J[tt]),Gt.minY=Math.min(Gt.minY,J[tt+1]),Gt.maxX=Math.max(Gt.maxX,J[tt]),Gt.maxY=Math.max(Gt.maxY,J[tt+1])}function $i(Gt,J,tt,lt){if(!J.geometry)return;let vt=J.geometry.coordinates;if(vt&&vt.length===0)return;let Et=J.geometry.type,Nt=Math.pow(tt.tolerance/((1<<tt.maxZoom)*tt.extent),2),ee=[],Rt=J.id;if(tt.promoteId?Rt=J.properties[tt.promoteId]:tt.generateId&&(Rt=lt||0),Et==="Point")Ii(vt,ee);else if(Et==="MultiPoint")for(let fe of vt)Ii(fe,ee);else if(Et==="LineString")wi(vt,ee,Nt,!1);else if(Et==="MultiLineString"){if(tt.lineMetrics){for(let fe of vt)ee=[],wi(fe,ee,Nt,!1),Gt.push(bi(Rt,"LineString",ee,J.properties));return}mi(vt,ee,Nt,!1)}else if(Et==="Polygon")mi(vt,ee,Nt,!0);else{if(Et!=="MultiPolygon"){if(Et==="GeometryCollection"){for(let fe of J.geometry.geometries)$i(Gt,{id:Rt,geometry:fe,properties:J.properties},tt,lt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let fe of vt){let ce=[];mi(fe,ce,Nt,!0),ee.push(ce)}}Gt.push(bi(Rt,Et,ee,J.properties))}function Ii(Gt,J){J.push(Wr(Gt[0]),jn(Gt[1]),0)}function wi(Gt,J,tt,lt){let vt,Et,Nt=0;for(let Rt=0;Rt<Gt.length;Rt++){let fe=Wr(Gt[Rt][0]),ce=jn(Gt[Rt][1]);J.push(fe,ce,0),Rt>0&&(Nt+=lt?(vt*ce-fe*Et)/2:Math.sqrt(Math.pow(fe-vt,2)+Math.pow(ce-Et,2))),vt=fe,Et=ce}let ee=J.length-3;J[2]=1,io(J,0,ee,tt),J[ee+2]=1,J.size=Math.abs(Nt),J.start=0,J.end=J.size}function mi(Gt,J,tt,lt){for(let vt=0;vt<Gt.length;vt++){let Et=[];wi(Gt[vt],Et,tt,lt),J.push(Et)}}function Wr(Gt){return Gt/360+.5}function jn(Gt){let J=Math.sin(Gt*Math.PI/180),tt=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return tt<0?0:tt>1?1:tt}function nr(Gt,J,tt,lt,vt,Et,Nt,ee){if(lt/=J,Et>=(tt/=J)&&Nt<lt)return Gt;if(Nt<tt||Et>=lt)return null;let Rt=[];for(let fe of Gt){let ce=fe.geometry,qt=fe.type,ye=vt===0?fe.minX:fe.minY,At=vt===0?fe.maxX:fe.maxY;if(ye>=tt&&At<lt){Rt.push(fe);continue}if(At<tt||ye>=lt)continue;let Ie=[];if(qt==="Point"||qt==="MultiPoint")ro(ce,Ie,tt,lt,vt);else if(qt==="LineString")yr(ce,Ie,tt,lt,vt,!1,ee.lineMetrics);else if(qt==="MultiLineString")ji(ce,Ie,tt,lt,vt,!1);else if(qt==="Polygon")ji(ce,Ie,tt,lt,vt,!0);else if(qt==="MultiPolygon")for(let $e of ce){let Be=[];ji($e,Be,tt,lt,vt,!0),Be.length&&Ie.push(Be)}if(Ie.length){if(ee.lineMetrics&&qt==="LineString"){for(let $e of Ie)Rt.push(bi(fe.id,qt,$e,fe.tags));continue}qt!=="LineString"&&qt!=="MultiLineString"||(Ie.length===1?(qt="LineString",Ie=Ie[0]):qt="MultiLineString"),qt!=="Point"&&qt!=="MultiPoint"||(qt=Ie.length===3?"Point":"MultiPoint"),Rt.push(bi(fe.id,qt,Ie,fe.tags))}}return Rt.length?Rt:null}function ro(Gt,J,tt,lt,vt){for(let Et=0;Et<Gt.length;Et+=3){let Nt=Gt[Et+vt];Nt>=tt&&Nt<=lt&&rs(J,Gt[Et],Gt[Et+1],Gt[Et+2])}}function yr(Gt,J,tt,lt,vt,Et,Nt){let ee=_s(Gt),Rt=vt===0?cn:zs,fe,ce,qt=Gt.start;for(let Be=0;Be<Gt.length-3;Be+=3){let je=Gt[Be],Je=Gt[Be+1],Oi=Gt[Be+2],Ai=Gt[Be+3],Ti=Gt[Be+4],Ge=vt===0?je:Je,Se=vt===0?Ai:Ti,sr=!1;Nt&&(fe=Math.sqrt(Math.pow(je-Ai,2)+Math.pow(Je-Ti,2))),Ge<tt?Se>tt&&(ce=Rt(ee,je,Je,Ai,Ti,tt),Nt&&(ee.start=qt+fe*ce)):Ge>lt?Se<lt&&(ce=Rt(ee,je,Je,Ai,Ti,lt),Nt&&(ee.start=qt+fe*ce)):rs(ee,je,Je,Oi),Se<tt&&Ge>=tt&&(ce=Rt(ee,je,Je,Ai,Ti,tt),sr=!0),Se>lt&&Ge<=lt&&(ce=Rt(ee,je,Je,Ai,Ti,lt),sr=!0),!Et&&sr&&(Nt&&(ee.end=qt+fe*ce),J.push(ee),ee=_s(Gt)),Nt&&(qt+=fe)}let ye=Gt.length-3,At=Gt[ye],Ie=Gt[ye+1],$e=vt===0?At:Ie;$e>=tt&&$e<=lt&&rs(ee,At,Ie,Gt[ye+2]),ye=ee.length-3,Et&&ye>=3&&(ee[ye]!==ee[0]||ee[ye+1]!==ee[1])&&rs(ee,ee[0],ee[1],ee[2]),ee.length&&J.push(ee)}function _s(Gt){let J=[];return J.size=Gt.size,J.start=Gt.start,J.end=Gt.end,J}function ji(Gt,J,tt,lt,vt,Et){for(let Nt of Gt)yr(Nt,J,tt,lt,vt,Et,!1)}function rs(Gt,J,tt,lt){Gt.push(J,tt,lt)}function cn(Gt,J,tt,lt,vt,Et){let Nt=(Et-J)/(lt-J);return rs(Gt,Et,tt+(vt-tt)*Nt,1),Nt}function zs(Gt,J,tt,lt,vt,Et){let Nt=(Et-tt)/(vt-tt);return rs(Gt,J+(lt-J)*Nt,Et,1),Nt}function fr(Gt,J){let tt=[];for(let lt=0;lt<Gt.length;lt++){let vt=Gt[lt],Et=vt.type,Nt;if(Et==="Point"||Et==="MultiPoint"||Et==="LineString")Nt=Er(vt.geometry,J);else if(Et==="MultiLineString"||Et==="Polygon"){Nt=[];for(let ee of vt.geometry)Nt.push(Er(ee,J))}else if(Et==="MultiPolygon"){Nt=[];for(let ee of vt.geometry){let Rt=[];for(let fe of ee)Rt.push(Er(fe,J));Nt.push(Rt)}}tt.push(bi(vt.id,Et,Nt,vt.tags))}return tt}function Er(Gt,J){let tt=[];tt.size=Gt.size,Gt.start!==void 0&&(tt.start=Gt.start,tt.end=Gt.end);for(let lt=0;lt<Gt.length;lt+=3)tt.push(Gt[lt]+J,Gt[lt+1],Gt[lt+2]);return tt}function Rr(Gt,J){if(Gt.transformed)return Gt;let tt=1<<Gt.z,lt=Gt.x,vt=Gt.y;for(let Et of Gt.features){let Nt=Et.geometry,ee=Et.type;if(Et.geometry=[],ee===1)for(let Rt=0;Rt<Nt.length;Rt+=2)Et.geometry.push(ns(Nt[Rt],Nt[Rt+1],J,tt,lt,vt));else for(let Rt=0;Rt<Nt.length;Rt++){let fe=[];for(let ce=0;ce<Nt[Rt].length;ce+=2)fe.push(ns(Nt[Rt][ce],Nt[Rt][ce+1],J,tt,lt,vt));Et.geometry.push(fe)}}return Gt.transformed=!0,Gt}function ns(Gt,J,tt,lt,vt,Et){return[Math.round(tt*(Gt*lt-vt)),Math.round(tt*(J*lt-Et))]}function Gn(Gt,J,tt,lt,vt){let Et=J===vt.maxZoom?0:vt.tolerance/((1<<J)*vt.extent),Nt={features:[],numPoints:0,numSimplified:0,numFeatures:Gt.length,source:null,x:tt,y:lt,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let ee of Gt)zo(Nt,ee,Et,vt);return Nt}function zo(Gt,J,tt,lt){let vt=J.geometry,Et=J.type,Nt=[];if(Gt.minX=Math.min(Gt.minX,J.minX),Gt.minY=Math.min(Gt.minY,J.minY),Gt.maxX=Math.max(Gt.maxX,J.maxX),Gt.maxY=Math.max(Gt.maxY,J.maxY),Et==="Point"||Et==="MultiPoint")for(let ee=0;ee<vt.length;ee+=3)Nt.push(vt[ee],vt[ee+1]),Gt.numPoints++,Gt.numSimplified++;else if(Et==="LineString")Rs(Nt,vt,Gt,tt,!1,!1);else if(Et==="MultiLineString"||Et==="Polygon")for(let ee=0;ee<vt.length;ee++)Rs(Nt,vt[ee],Gt,tt,Et==="Polygon",ee===0);else if(Et==="MultiPolygon")for(let ee=0;ee<vt.length;ee++){let Rt=vt[ee];for(let fe=0;fe<Rt.length;fe++)Rs(Nt,Rt[fe],Gt,tt,!0,fe===0)}if(Nt.length){let ee=J.tags||null;if(Et==="LineString"&&lt.lineMetrics){ee={};for(let fe in J.tags)ee[fe]=J.tags[fe];ee.mapbox_clip_start=vt.start/vt.size,ee.mapbox_clip_end=vt.end/vt.size}let Rt={geometry:Nt,type:Et==="Polygon"||Et==="MultiPolygon"?3:Et==="LineString"||Et==="MultiLineString"?2:1,tags:ee};J.id!==null&&(Rt.id=J.id),Gt.features.push(Rt)}}function Rs(Gt,J,tt,lt,vt,Et){let Nt=lt*lt;if(lt>0&&J.size<(vt?Nt:lt))return void(tt.numPoints+=J.length/3);let ee=[];for(let Rt=0;Rt<J.length;Rt+=3)(lt===0||J[Rt+2]>Nt)&&(tt.numSimplified++,ee.push(J[Rt],J[Rt+1])),tt.numPoints++;vt&&function(Rt,fe){let ce=0;for(let qt=0,ye=Rt.length,At=ye-2;qt<ye;At=qt,qt+=2)ce+=(Rt[qt]-Rt[At])*(Rt[qt+1]+Rt[At+1]);if(ce>0===fe)for(let qt=0,ye=Rt.length;qt<ye/2;qt+=2){let At=Rt[qt],Ie=Rt[qt+1];Rt[qt]=Rt[ye-2-qt],Rt[qt+1]=Rt[ye-1-qt],Rt[ye-2-qt]=At,Rt[ye-1-qt]=Ie}}(ee,Et),Gt.push(ee)}let gs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class no{constructor(J,tt){let lt=(tt=this.options=function(Et,Nt){for(let ee in Nt)Et[ee]=Nt[ee];return Et}(Object.create(gs),tt)).debug;if(lt&&console.time("preprocess data"),tt.maxZoom<0||tt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(tt.promoteId&&tt.generateId)throw new Error("promoteId and generateId cannot be used together.");let vt=function(Et,Nt){let ee=[];if(Et.type==="FeatureCollection")for(let Rt=0;Rt<Et.features.length;Rt++)$i(ee,Et.features[Rt],Nt,Rt);else $i(ee,Et.type==="Feature"?Et:{geometry:Et},Nt);return ee}(J,tt);this.tiles={},this.tileCoords=[],lt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",tt.indexMaxZoom,tt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),vt=function(Et,Nt){let ee=Nt.buffer/Nt.extent,Rt=Et,fe=nr(Et,1,-1-ee,ee,0,-1,2,Nt),ce=nr(Et,1,1-ee,2+ee,0,-1,2,Nt);return(fe||ce)&&(Rt=nr(Et,1,-ee,1+ee,0,-1,2,Nt)||[],fe&&(Rt=fr(fe,1).concat(Rt)),ce&&(Rt=Rt.concat(fr(ce,-1)))),Rt}(vt,tt),vt.length&&this.splitTile(vt,0,0,0),lt&&(vt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,tt,lt,vt,Et,Nt,ee){let Rt=[J,tt,lt,vt],fe=this.options,ce=fe.debug;for(;Rt.length;){vt=Rt.pop(),lt=Rt.pop(),tt=Rt.pop(),J=Rt.pop();let qt=1<<tt,ye=Zn(tt,lt,vt),At=this.tiles[ye];if(!At&&(ce>1&&console.time("creation"),At=this.tiles[ye]=Gn(J,tt,lt,vt,fe),this.tileCoords.push({z:tt,x:lt,y:vt}),ce)){ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",tt,lt,vt,At.numFeatures,At.numPoints,At.numSimplified),console.timeEnd("creation"));let sr=`z${tt}`;this.stats[sr]=(this.stats[sr]||0)+1,this.total++}if(At.source=J,Et==null){if(tt===fe.indexMaxZoom||At.numPoints<=fe.indexMaxPoints)continue}else{if(tt===fe.maxZoom||tt===Et)continue;if(Et!=null){let sr=Et-tt;if(lt!==Nt>>sr||vt!==ee>>sr)continue}}if(At.source=null,J.length===0)continue;ce>1&&console.time("clipping");let Ie=.5*fe.buffer/fe.extent,$e=.5-Ie,Be=.5+Ie,je=1+Ie,Je=null,Oi=null,Ai=null,Ti=null,Ge=nr(J,qt,lt-Ie,lt+Be,0,At.minX,At.maxX,fe),Se=nr(J,qt,lt+$e,lt+je,0,At.minX,At.maxX,fe);J=null,Ge&&(Je=nr(Ge,qt,vt-Ie,vt+Be,1,At.minY,At.maxY,fe),Oi=nr(Ge,qt,vt+$e,vt+je,1,At.minY,At.maxY,fe),Ge=null),Se&&(Ai=nr(Se,qt,vt-Ie,vt+Be,1,At.minY,At.maxY,fe),Ti=nr(Se,qt,vt+$e,vt+je,1,At.minY,At.maxY,fe),Se=null),ce>1&&console.timeEnd("clipping"),Rt.push(Je||[],tt+1,2*lt,2*vt),Rt.push(Oi||[],tt+1,2*lt,2*vt+1),Rt.push(Ai||[],tt+1,2*lt+1,2*vt),Rt.push(Ti||[],tt+1,2*lt+1,2*vt+1)}}getTile(J,tt,lt){J=+J,tt=+tt,lt=+lt;let vt=this.options,{extent:Et,debug:Nt}=vt;if(J<0||J>24)return null;let ee=1<<J,Rt=Zn(J,tt=tt+ee&ee-1,lt);if(this.tiles[Rt])return Rr(this.tiles[Rt],Et);Nt>1&&console.log("drilling down to z%d-%d-%d",J,tt,lt);let fe,ce=J,qt=tt,ye=lt;for(;!fe&&ce>0;)ce--,qt>>=1,ye>>=1,fe=this.tiles[Zn(ce,qt,ye)];return fe&&fe.source?(Nt>1&&(console.log("found parent tile z%d-%d-%d",ce,qt,ye),console.time("drilling down")),this.splitTile(fe.source,ce,qt,ye,J,tt,lt),Nt>1&&console.timeEnd("drilling down"),this.tiles[Rt]?Rr(this.tiles[Rt],Et):null):null}}function Zn(Gt,J,tt){return 32*((1<<Gt)*tt+J)+Gt}function Kr(Gt,J){return J?Gt.properties[J]:Gt.id}function Vn(Gt,J){if(Gt==null)return!0;if(Gt.type==="Feature")return Kr(Gt,J)!=null;if(Gt.type==="FeatureCollection"){let tt=new Set;for(let lt of Gt.features){let vt=Kr(lt,J);if(vt==null||tt.has(vt))return!1;tt.add(vt)}return!0}return!1}function Xo(Gt,J){let tt=new Map;if(Gt!=null)if(Gt.type==="Feature")tt.set(Kr(Gt,J),Gt);else for(let lt of Gt.features)tt.set(Kr(lt,J),lt);return tt}class Yo extends Kt{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(J,tt){return S._(this,void 0,void 0,function*(){let lt=J.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let vt=this._geoJSONIndex.getTile(lt.z,lt.x,lt.y);if(!vt)return null;let Et=new Bi(vt.features),Nt=Bs(Et);return Nt.byteOffset===0&&Nt.byteLength===Nt.buffer.byteLength||(Nt=new Uint8Array(Nt)),{vectorTile:Et,rawData:Nt.buffer}})}loadData(J){return S._(this,void 0,void 0,function*(){var tt;(tt=this._pendingRequest)===null||tt===void 0||tt.abort();let lt=!!(J&&J.request&&J.request.collectResourceTiming)&&new S.cM(J.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(J,this._pendingRequest),this._geoJSONIndex=J.cluster?new _r(function({superclusterOptions:Nt,clusterProperties:ee}){if(!ee||!Nt)return Nt;let Rt={},fe={},ce={accumulated:null,zoom:0},qt={properties:null},ye=Object.keys(ee);for(let At of ye){let[Ie,$e]=ee[At],Be=S.cT($e),je=S.cT(typeof Ie=="string"?[Ie,["accumulated"],["get",At]]:Ie);Rt[At]=Be.value,fe[At]=je.value}return Nt.map=At=>{qt.properties=At;let Ie={};for(let $e of ye)Ie[$e]=Rt[$e].evaluate(ce,qt);return Ie},Nt.reduce=(At,Ie)=>{qt.properties=Ie;for(let $e of ye)ce.accumulated=At[$e],At[$e]=fe[$e].evaluate(ce,qt)},Nt}(J)).load((yield this._pendingData).features):(vt=yield this._pendingData,new no(vt,J.geojsonVtOptions)),this.loaded={};let Et={};if(lt){let Nt=lt.finish();Nt&&(Et.resourceTiming={},Et.resourceTiming[J.source]=JSON.parse(JSON.stringify(Nt)))}return Et}catch(Et){if(delete this._pendingRequest,S.cx(Et))return{abandoned:!0};throw Et}var vt})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(J){let tt=this.loaded;return tt&&tt[J.uid]?super.reloadTile(J):this.loadTile(J)}loadAndProcessGeoJSON(J,tt){return S._(this,void 0,void 0,function*(){let lt=yield this.loadGeoJSON(J,tt);if(delete this._pendingRequest,typeof lt!="object")throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(pi(lt,!0),J.filter){let vt=S.cT(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(vt.result==="error")throw new Error(vt.value.map(Nt=>`${Nt.key}: ${Nt.message}`).join(", "));lt={type:"FeatureCollection",features:lt.features.filter(Nt=>vt.value.evaluate({zoom:0},Nt))}}return lt})}loadGeoJSON(J,tt){return S._(this,void 0,void 0,function*(){let{promoteId:lt}=J;if(J.request){let vt=yield S.j(J.request,tt);return this._dataUpdateable=Vn(vt.data,lt)?Xo(vt.data,lt):void 0,vt.data}if(typeof J.data=="string")try{let vt=JSON.parse(J.data);return this._dataUpdateable=Vn(vt,lt)?Xo(vt,lt):void 0,vt}catch{throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`)}if(!J.dataDiff)throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${J.source}`);return function(vt,Et,Nt){var ee,Rt,fe,ce;if(Et.removeAll&&vt.clear(),Et.remove)for(let qt of Et.remove)vt.delete(qt);if(Et.add)for(let qt of Et.add){let ye=Kr(qt,Nt);ye!=null&&vt.set(ye,qt)}if(Et.update)for(let qt of Et.update){let ye=vt.get(qt.id);if(ye==null)continue;let At=!qt.removeAllProperties&&(((ee=qt.removeProperties)===null||ee===void 0?void 0:ee.length)>0||((Rt=qt.addOrUpdateProperties)===null||Rt===void 0?void 0:Rt.length)>0);if((qt.newGeometry||qt.removeAllProperties||At)&&(ye=Object.assign({},ye),vt.set(qt.id,ye),At&&(ye.properties=Object.assign({},ye.properties))),qt.newGeometry&&(ye.geometry=qt.newGeometry),qt.removeAllProperties)ye.properties={};else if(((fe=qt.removeProperties)===null||fe===void 0?void 0:fe.length)>0)for(let Ie of qt.removeProperties)Object.prototype.hasOwnProperty.call(ye.properties,Ie)&&delete ye.properties[Ie];if(((ce=qt.addOrUpdateProperties)===null||ce===void 0?void 0:ce.length)>0)for(let{key:Ie,value:$e}of qt.addOrUpdateProperties)ye.properties[Ie]=$e}}(this._dataUpdateable,J.dataDiff,lt),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(J){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(J){return this._geoJSONIndex.getClusterExpansionZoom(J.clusterId)}getClusterChildren(J){return this._geoJSONIndex.getChildren(J.clusterId)}getClusterLeaves(J){return this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset)}}class Un{constructor(J){this.self=J,this.actor=new S.J(J),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(tt,lt)=>{if(this.externalWorkerSourceTypes[tt])throw new Error(`Worker source with name "${tt}" already registered.`);this.externalWorkerSourceTypes[tt]=lt},this.self.addProtocol=S.cz,this.self.removeProtocol=S.cA,this.self.registerRTLTextPlugin=tt=>{S.cU.setMethods(tt)},this.actor.registerMessageHandler("LDT",(tt,lt)=>this._getDEMWorkerSource(tt,lt.source).loadTile(lt)),this.actor.registerMessageHandler("RDT",(tt,lt)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(tt,lt.source).removeTile(lt)})),this.actor.registerMessageHandler("GCEZ",(tt,lt)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(tt,lt.type,lt.source).getClusterExpansionZoom(lt)})),this.actor.registerMessageHandler("GCC",(tt,lt)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(tt,lt.type,lt.source).getClusterChildren(lt)})),this.actor.registerMessageHandler("GCL",(tt,lt)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(tt,lt.type,lt.source).getClusterLeaves(lt)})),this.actor.registerMessageHandler("LD",(tt,lt)=>this._getWorkerSource(tt,lt.type,lt.source).loadData(lt)),this.actor.registerMessageHandler("GD",(tt,lt)=>this._getWorkerSource(tt,lt.type,lt.source).getData()),this.actor.registerMessageHandler("LT",(tt,lt)=>this._getWorkerSource(tt,lt.type,lt.source).loadTile(lt)),this.actor.registerMessageHandler("RT",(tt,lt)=>this._getWorkerSource(tt,lt.type,lt.source).reloadTile(lt)),this.actor.registerMessageHandler("AT",(tt,lt)=>this._getWorkerSource(tt,lt.type,lt.source).abortTile(lt)),this.actor.registerMessageHandler("RMT",(tt,lt)=>this._getWorkerSource(tt,lt.type,lt.source).removeTile(lt)),this.actor.registerMessageHandler("RS",(tt,lt)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[tt]||!this.workerSources[tt][lt.type]||!this.workerSources[tt][lt.type][lt.source])return;let vt=this.workerSources[tt][lt.type][lt.source];delete this.workerSources[tt][lt.type][lt.source],vt.removeSource!==void 0&&vt.removeSource(lt)})),this.actor.registerMessageHandler("RM",tt=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[tt],delete this.availableImages[tt],delete this.workerSources[tt],delete this.demWorkerSources[tt]})),this.actor.registerMessageHandler("SR",(tt,lt)=>S._(this,void 0,void 0,function*(){this.referrer=lt})),this.actor.registerMessageHandler("SRPS",(tt,lt)=>this._syncRTLPluginState(tt,lt)),this.actor.registerMessageHandler("IS",(tt,lt)=>S._(this,void 0,void 0,function*(){this.self.importScripts(lt)})),this.actor.registerMessageHandler("SI",(tt,lt)=>this._setImages(tt,lt)),this.actor.registerMessageHandler("UL",(tt,lt)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(tt).update(lt.layers,lt.removedIds)})),this.actor.registerMessageHandler("SL",(tt,lt)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(tt).replace(lt)}))}_setImages(J,tt){return S._(this,void 0,void 0,function*(){this.availableImages[J]=tt;for(let lt in this.workerSources[J]){let vt=this.workerSources[J][lt];for(let Et in vt)vt[Et].availableImages=tt}})}_syncRTLPluginState(J,tt){return S._(this,void 0,void 0,function*(){return yield S.cU.syncState(tt,this.self.importScripts)})}_getAvailableImages(J){let tt=this.availableImages[J];return tt||(tt=[]),tt}_getLayerIndex(J){let tt=this.layerIndexes[J];return tt||(tt=this.layerIndexes[J]=new u),tt}_getWorkerSource(J,tt,lt){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][tt]||(this.workerSources[J][tt]={}),!this.workerSources[J][tt][lt]){let vt={sendAsync:(Et,Nt)=>(Et.targetMapId=J,this.actor.sendAsync(Et,Nt))};switch(tt){case"vector":this.workerSources[J][tt][lt]=new Kt(vt,this._getLayerIndex(J),this._getAvailableImages(J));break;case"geojson":this.workerSources[J][tt][lt]=new Yo(vt,this._getLayerIndex(J),this._getAvailableImages(J));break;default:this.workerSources[J][tt][lt]=new this.externalWorkerSourceTypes[tt](vt,this._getLayerIndex(J),this._getAvailableImages(J))}}return this.workerSources[J][tt][lt]}_getDEMWorkerSource(J,tt){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][tt]||(this.demWorkerSources[J][tt]=new re),this.demWorkerSources[J][tt]}}return S.i(self)&&(self.worker=new Un(self)),Un}),Vt("index",["exports","./shared"],function(S,u){"use strict";var rt="5.6.0";function Qt(){var d=new u.A(4);return u.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}let se,Kt,re={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(d,t,i){let a=requestAnimationFrame(m=>{h(),t(m)}),{unsubscribe:h}=u.s(d.signal,"abort",()=>{h(),cancelAnimationFrame(a),i(u.c())},!1)},frameAsync(d){return new Promise((t,i)=>{this.frame(d,t,i)})},getImageData(d,t=0){return this.getImageCanvasContext(d).getImageData(-t,-t,d.width+2*t,d.height+2*t)},getImageCanvasContext(d){let t=window.document.createElement("canvas"),i=t.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return t.width=d.width,t.height=d.height,i.drawImage(d,0,0,d.width,d.height),i},resolveURL:d=>(se||(se=document.createElement("a")),se.href=d,se.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Kt==null&&(Kt=matchMedia("(prefers-reduced-motion: reduce)")),Kt.matches)}};class _t{static testProp(t){if(!_t.docStyle)return t[0];for(let i=0;i<t.length;i++)if(t[i]in _t.docStyle)return t[i];return t[0]}static create(t,i,a){let h=window.document.createElement(t);return i!==void 0&&(h.className=i),a&&a.appendChild(h),h}static createNS(t,i){return window.document.createElementNS(t,i)}static disableDrag(){_t.docStyle&&_t.selectProp&&(_t.userSelect=_t.docStyle[_t.selectProp],_t.docStyle[_t.selectProp]="none")}static enableDrag(){_t.docStyle&&_t.selectProp&&(_t.docStyle[_t.selectProp]=_t.userSelect)}static setTransform(t,i){t.style[_t.transformProp]=i}static addEventListener(t,i,a,h={}){t.addEventListener(i,a,"passive"in h?h:h.capture)}static removeEventListener(t,i,a,h={}){t.removeEventListener(i,a,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",_t.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",_t.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",_t.suppressClickInternal,!0)},0)}static getScale(t){let i=t.getBoundingClientRect();return{x:i.width/t.offsetWidth||1,y:i.height/t.offsetHeight||1,boundingClientRect:i}}static getPoint(t,i,a){let h=i.boundingClientRect;return new u.P((a.clientX-h.left)/i.x-t.clientLeft,(a.clientY-h.top)/i.y-t.clientTop)}static mousePos(t,i){let a=_t.getScale(t);return _t.getPoint(t,a,i)}static touchPos(t,i){let a=[],h=_t.getScale(t);for(let m=0;m<i.length;m++)a.push(_t.getPoint(t,h,i[m]));return a}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){let i=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),a=i.querySelectorAll("script");for(let h of a)h.remove();return _t.clean(i),i.innerHTML}static isPossiblyDangerous(t,i){let a=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!a.includes("javascript:")&&!a.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){let i=t.children;for(let a of i)_t.removeAttributes(a),_t.clean(a)}static removeAttributes(t){for(let{name:i,value:a}of t.attributes)_t.isPossiblyDangerous(i,a)&&t.removeAttribute(i)}}_t.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,_t.selectProp=_t.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),_t.transformProp=_t.testProp(["transform","WebkitTransform"]);let ge={supported:!1,testSupport:function(d){!Ze&&pi&&(gi?Bi(d):Ae=d)}},Ae,pi,Ze=!1,gi=!1;function Bi(d){let t=d.createTexture();d.bindTexture(d.TEXTURE_2D,t);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,pi),d.isContextLost())return;ge.supported=!0}catch{}d.deleteTexture(t),Ze=!0}var Wi;typeof document<"u"&&(pi=document.createElement("img"),pi.onload=()=>{Ae&&Bi(Ae),Ae=null,gi=!0},pi.onerror=()=>{Ze=!0,Ae=null},pi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let t,i,a,h;d.resetRequestQueue=()=>{t=[],i=0,a=0,h={}},d.addThrottleControl=P=>{let I=a++;return h[I]=P,I},d.removeThrottleControl=P=>{delete h[P],v()},d.getImage=(P,I,D=!0)=>new Promise((F,O)=>{ge.supported&&(P.headers||(P.headers={}),P.headers.accept="image/webp,*/*"),u.e(P,{type:"image"}),t.push({abortController:I,requestParameters:P,supportImageRefresh:D,state:"queued",onError:Z=>{O(Z)},onSuccess:Z=>{F(Z)}}),v()});let m=P=>u._(this,void 0,void 0,function*(){P.state="running";let{requestParameters:I,supportImageRefresh:D,onError:F,onSuccess:O,abortController:Z}=P,X=D===!1&&!u.i(self)&&!u.g(I.url)&&(!I.headers||Object.keys(I.headers).reduce((dt,mt)=>dt&&mt==="accept",!0));i++;let nt=X?C(I,Z):u.m(I,Z);try{let dt=yield nt;delete P.abortController,P.state="completed",dt.data instanceof HTMLImageElement||u.b(dt.data)?O(dt):dt.data&&O({data:yield(ct=dt.data,typeof createImageBitmap=="function"?u.f(ct):u.h(ct)),cacheControl:dt.cacheControl,expires:dt.expires})}catch(dt){delete P.abortController,F(dt)}finally{i--,v()}var ct}),v=()=>{let P=(()=>{for(let I of Object.keys(h))if(h[I]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=i;I<P&&t.length>0;I++){let D=t.shift();D.abortController.signal.aborted?I--:m(D)}},C=(P,I)=>new Promise((D,F)=>{let O=new Image,Z=P.url,X=P.credentials;X&&X==="include"?O.crossOrigin="use-credentials":(X&&X==="same-origin"||!u.d(Z))&&(O.crossOrigin="anonymous"),I.signal.addEventListener("abort",()=>{O.src="",F(u.c())}),O.fetchPriority="high",O.onload=()=>{O.onerror=O.onload=null,D({data:O})},O.onerror=()=>{O.onerror=O.onload=null,I.signal.aborted||F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},O.src=Z})}(Wi||(Wi={})),Wi.resetRequestQueue();class Ei{constructor(t){this._transformRequestFn=t}transformRequest(t,i){return this._transformRequestFn&&this._transformRequestFn(t,i)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Ri(d){let t=[];if(typeof d=="string")t.push({id:"default",url:d});else if(d&&d.length>0){let i=[];for(let{id:a,url:h}of d){let m=`${a}${h}`;i.indexOf(m)===-1&&(i.push(m),t.push({id:a,url:h}))}}return t}function Pn(d,t,i){try{let a=new URL(d);return a.pathname+=`${t}${i}`,a.toString()}catch{throw new Error(`Invalid sprite URL "${d}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Fn(d){let{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class Bs extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(let{ids:i,promiseResolve:a}of this.requestors)a(this._getImagesForIds(i));this.requestors=[]}}getImage(t){let i=this.images[t];if(i&&!i.data&&i.spriteData){let a=i.spriteData;i.data=new u.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),i.spriteData=null}return i}addImage(t,i){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,i)&&(this.images[t]=i)}_validate(t,i){let a=!0,h=i.data||i.spriteData;return this._validateStretch(i.stretchX,h&&h.width)||(this.fire(new u.k(new Error(`Image "${t}" has invalid "stretchX" value`))),a=!1),this._validateStretch(i.stretchY,h&&h.height)||(this.fire(new u.k(new Error(`Image "${t}" has invalid "stretchY" value`))),a=!1),this._validateContent(i.content,i)||(this.fire(new u.k(new Error(`Image "${t}" has invalid "content" value`))),a=!1),a}_validateStretch(t,i){if(!t)return!0;let a=0;for(let h of t){if(h[0]<a||h[1]<h[0]||i<h[1])return!1;a=h[1]}return!0}_validateContent(t,i){if(!t)return!0;if(t.length!==4)return!1;let a=i.spriteData,h=a&&a.width||i.data.width,m=a&&a.height||i.data.height;return!(t[0]<0||h<t[0]||t[1]<0||m<t[1]||t[2]<0||h<t[2]||t[3]<0||m<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,i,a=!0){let h=this.getImage(t);if(a&&(h.data.width!==i.data.width||h.data.height!==i.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=h.version+1,this.images[t]=i,this.updatedImages[t]=!0}removeImage(t){let i=this.images[t];delete this.images[t],delete this.patterns[t],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((i,a)=>{let h=!0;if(!this.isLoaded())for(let m of t)this.images[m]||(h=!1);this.isLoaded()||h?i(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:i})})}_getImagesForIds(t){let i={};for(let a of t){let h=this.getImage(a);h||(this.fire(new u.l("styleimagemissing",{id:a})),h=this.getImage(a)),h?i[a]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:u.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){let{width:t,height:i}=this.atlasImage;return{width:t,height:i}}getPattern(t){let i=this.patterns[t],a=this.getImage(t);if(!a)return null;if(i&&i.position.version===a.version)return i.position;if(i)i.position.version=a.version;else{let h={w:a.data.width+2,h:a.data.height+2,x:0,y:0},m=new u.I(h,a);this.patterns[t]={bin:h,position:m}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){let i=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.T(t,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){let t=[];for(let m in this.patterns)t.push(this.patterns[m].bin);let{w:i,h:a}=u.p(t),h=this.atlasImage;h.resize({width:i||1,height:a||1});for(let m in this.patterns){let{bin:v}=this.patterns[m],C=v.x+1,P=v.y+1,I=this.getImage(m).data,D=I.width,F=I.height;u.R.copy(I,h,{x:0,y:0},{x:C,y:P},{width:D,height:F}),u.R.copy(I,h,{x:0,y:F-1},{x:C,y:P-1},{width:D,height:1}),u.R.copy(I,h,{x:0,y:0},{x:C,y:P+F},{width:D,height:1}),u.R.copy(I,h,{x:D-1,y:0},{x:C-1,y:P},{width:1,height:F}),u.R.copy(I,h,{x:0,y:0},{x:C+D,y:P},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(let i of t){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;let a=this.getImage(i);a||u.w(`Image with ID: "${i}" was not found`),Fn(a)&&this.updateImage(i,a)}}}let Ds=1e20;function dr(d,t,i,a,h,m,v,C,P){for(let I=t;I<t+a;I++)Ki(d,i*m+I,m,h,v,C,P);for(let I=i;I<i+h;I++)Ki(d,I*m+t,1,a,v,C,P)}function Ki(d,t,i,a,h,m,v){m[0]=0,v[0]=-1e20,v[1]=Ds,h[0]=d[t];for(let C=1,P=0,I=0;C<a;C++){h[C]=d[t+C*i];let D=C*C;do{let F=m[P];I=(h[C]-h[F]+D-F*F)/(C-F)/2}while(I<=v[P]&&--P>-1);P++,m[P]=C,v[P]=I,v[P+1]=Ds}for(let C=0,P=0;C<a;C++){for(;v[P+1]<C;)P++;let I=m[P],D=C-I;d[t+C*i]=h[I]+D*D}}class _r{constructor(t,i){this.requestManager=t,this.localIdeographFontFamily=i,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return u._(this,void 0,void 0,function*(){let i=[];for(let m in t)for(let v of t[m])i.push(this._getAndCacheGlyphsPromise(m,v));let a=yield Promise.all(i),h={};for(let{stack:m,id:v,glyph:C}of a)h[m]||(h[m]={}),h[m][v]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return h})}_getAndCacheGlyphsPromise(t,i){return u._(this,void 0,void 0,function*(){let a=this.entries[t];a||(a=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=a.glyphs[i];if(h!==void 0)return{stack:t,id:i,glyph:h};if(h=this._tinySDF(a,t,i),h)return a.glyphs[i]=h,{stack:t,id:i,glyph:h};let m=Math.floor(i/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[m])return{stack:t,id:i,glyph:h};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[m]){let C=_r.loadGlyphRange(t,m,this.url,this.requestManager);a.requests[m]=C}let v=yield a.requests[m];for(let C in v)this._doesCharSupportLocalGlyph(+C)||(a.glyphs[+C]=v[+C]);return a.ranges[m]=!0,{stack:t,id:i,glyph:v[i]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))||u.u["CJK Unified Ideographs"](t)||u.u["Hangul Syllables"](t)||u.u.Hiragana(t)||u.u.Katakana(t)||u.u["CJK Symbols and Punctuation"](t)||u.u["Halfwidth and Fullwidth Forms"](t))}_tinySDF(t,i,a){let h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(a))return;let m=t.tinySDF;if(!m){let C="400";/bold/i.test(i)?C="900":/medium/i.test(i)?C="500":/light/i.test(i)&&(C="200"),m=t.tinySDF=new _r.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:h,fontWeight:C})}let v=m.draw(String.fromCharCode(a));return{id:a,bitmap:new u.q({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}_r.loadGlyphRange=function(d,t,i,a){return u._(this,void 0,void 0,function*(){let h=256*t,m=h+255,v=a.transformRequest(i.replace("{fontstack}",d).replace("{range}",`${h}-${m}`),"Glyphs"),C=yield u.n(v,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${m}`);let P={};for(let I of u.o(C.data))P[I.id]=I;return P})},_r.TinySDF=class{constructor({fontSize:d=24,buffer:t=3,radius:i=8,cutoff:a=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:v="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=i;let C=this.size=d+4*t,P=this._createCanvas(C),I=this.ctx=P.getContext("2d",{willReadFrequently:!0});I.font=`${v} ${m} ${d}px ${h}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(d){let t=document.createElement("canvas");return t.width=t.height=d,t}draw(d){let{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(d),v=Math.ceil(i),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),P=Math.min(this.size-this.buffer,v+Math.ceil(a)),I=C+2*this.buffer,D=P+2*this.buffer,F=Math.max(I*D,0),O=new Uint8ClampedArray(F),Z={data:O,width:I,height:D,glyphWidth:C,glyphHeight:P,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(C===0||P===0)return Z;let{ctx:X,buffer:nt,gridInner:ct,gridOuter:dt}=this;X.clearRect(nt,nt,C,P),X.fillText(d,nt,nt+v);let mt=X.getImageData(nt,nt,C,P);dt.fill(Ds,0,F),ct.fill(0,0,F);for(let Ct=0;Ct<P;Ct++)for(let yt=0;yt<C;yt++){let Lt=mt.data[4*(Ct*C+yt)+3]/255;if(Lt===0)continue;let It=(Ct+nt)*I+yt+nt;if(Lt===1)dt[It]=0,ct[It]=Ds;else{let xt=.5-Lt;dt[It]=xt>0?xt*xt:0,ct[It]=xt<0?xt*xt:0}}dr(dt,0,0,I,D,I,this.f,this.v,this.z),dr(ct,nt,nt,C,P,I,this.f,this.v,this.z);for(let Ct=0;Ct<F;Ct++){let yt=Math.sqrt(dt[Ct])-Math.sqrt(ct[Ct]);O[Ct]=Math.round(255-255*(yt/this.radius+this.cutoff))}return Z}};class wr{constructor(){this.specification=u.v.light.position}possiblyEvaluate(t,i){return u.B(t.expression.evaluate(i))}interpolate(t,i,a){return{x:u.C.number(t.x,i.x,a),y:u.C.number(t.y,i.y,a),z:u.C.number(t.z,i.z,a)}}}let is;class gr extends u.E{constructor(t){super(),is=is||new u.r({anchor:new u.D(u.v.light.anchor),position:new wr,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.t(is),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i={}){if(!this._validate(u.x,t,i))for(let a in t){let h=t[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),h):this._transitionable.setValue(a,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,a){return(!a||a.validate!==!1)&&u.y(this,t.call(u.z,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}let Nn=new u.r({"sky-color":new u.D(u.v.sky["sky-color"]),"horizon-color":new u.D(u.v.sky["horizon-color"]),"fog-color":new u.D(u.v.sky["fog-color"]),"fog-ground-blend":new u.D(u.v.sky["fog-ground-blend"]),"horizon-fog-blend":new u.D(u.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new u.D(u.v.sky["sky-horizon-blend"]),"atmosphere-blend":new u.D(u.v.sky["atmosphere-blend"])});class ei extends u.E{constructor(t){super(),this._transitionable=new u.t(Nn),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.F(0))}setSky(t,i={}){if(!this._validate(u.G,t,i)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let a in t){let h=t[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),h):this._transitionable.setValue(a,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,a={}){return a?.validate!==!1&&u.y(this,t.call(u.z,u.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:u.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class io{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,i){let a=t.join(",")+String(i);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(t,i)),this.dashEntry[a]}getDashRanges(t,i,a){let h=[],m=t.length%2==1?-t[t.length-1]*a:0,v=t[0]*a,C=!0;h.push({left:m,right:v,isDash:C,zeroLength:t[0]===0});let P=t[0];for(let I=1;I<t.length;I++){C=!C;let D=t[I];m=P*a,P+=D,v=P*a,h.push({left:m,right:v,isDash:C,zeroLength:D===0})}return h}addRoundDash(t,i,a){let h=i/2;for(let m=-a;m<=a;m++){let v=this.width*(this.nextRow+a+m),C=0,P=t[C];for(let I=0;I<this.width;I++){I/P.right>1&&(P=t[++C]);let D=Math.abs(I-P.left),F=Math.abs(I-P.right),O=Math.min(D,F),Z,X=m/a*(h+1);if(P.isDash){let nt=h-Math.abs(X);Z=Math.sqrt(O*O+nt*nt)}else Z=h-Math.sqrt(O*O+X*X);this.data[v+I]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(t){for(let C=t.length-1;C>=0;--C){let P=t[C],I=t[C+1];P.zeroLength?t.splice(C,1):I&&I.isDash===P.isDash&&(I.left=P.left,t.splice(C,1))}let i=t[0],a=t[t.length-1];i.isDash===a.isDash&&(i.left=a.left-this.width,a.right=i.right+this.width);let h=this.width*this.nextRow,m=0,v=t[m];for(let C=0;C<this.width;C++){C/v.right>1&&(v=t[++m]);let P=Math.abs(C-v.left),I=Math.abs(C-v.right),D=Math.min(P,I);this.data[h+C]=Math.max(0,Math.min(255,(v.isDash?D:-D)+128))}}addDash(t,i){let a=i?7:0,h=2*a+1;if(this.nextRow+h>this.height)return u.w("LineAtlas out of space"),null;let m=0;for(let C=0;C<t.length;C++)m+=t[C];if(m!==0){let C=this.width/m,P=this.getDashRanges(t,this.width,C);i?this.addRoundDash(P,C,a):this.addRegularDash(P)}let v={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:m};return this.nextRow+=h,this.dirty=!0,v}bind(t){let i=t.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}let Ye="maplibre_preloaded_worker_pool";class bi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<bi.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ye]}numActive(){return Object.keys(this.active).length}}let ti=Math.floor(re.hardwareConcurrency/2),$i,Ii;function wi(){return $i||($i=new bi),$i}bi.workerCount=u.H(globalThis)?Math.max(Math.min(ti,3),1):1;class mi{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=i;let a=this.workerPool.acquire(i);for(let h=0;h<a.length;h++){let m=new u.J(a[h],i);m.name=`Worker ${h}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,i){let a=[];for(let h of this.actors)a.push(h.sendAsync({type:t,data:i}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(i=>{i.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,i){for(let a of this.actors)a.registerMessageHandler(t,i)}}function Wr(){return Ii||(Ii=new mi(wi(),u.K),Ii.registerMessageHandler("GR",(d,t,i)=>u.m(t,i))),Ii}function jn(d,t){let i=u.L();return u.M(i,i,[1,1,0]),u.N(i,i,[.5*d.width,.5*d.height,1]),d.calculatePosMatrix?u.O(i,i,d.calculatePosMatrix(t.toUnwrapped())):i}function nr(d,t,i,a,h,m,v){var C;let P=function(O,Z,X){if(O)for(let nt of O){let ct=Z[nt];if(ct&&ct.source===X&&ct.type==="fill-extrusion")return!0}else for(let nt in Z){let ct=Z[nt];if(ct.source===X&&ct.type==="fill-extrusion")return!0}return!1}((C=h?.layers)!==null&&C!==void 0?C:null,t,d.id),I=m.maxPitchScaleFactor(),D=d.tilesIn(a,I,P);D.sort(ro);let F=[];for(let O of D)F.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(t,i,d._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,h,m,I,jn(d.transform,O.tileID),v?(Z,X)=>v(O.tileID,Z,X):void 0)});return function(O,Z){for(let X in O)for(let nt of O[X])yr(nt,Z);return O}(function(O){let Z={},X={};for(let nt of O){let ct=nt.queryResults,dt=nt.wrappedTileID,mt=X[dt]=X[dt]||{};for(let Ct in ct){let yt=ct[Ct],Lt=mt[Ct]=mt[Ct]||{},It=Z[Ct]=Z[Ct]||[];for(let xt of yt)Lt[xt.featureIndex]||(Lt[xt.featureIndex]=!0,It.push(xt))}}return Z}(F),d)}function ro(d,t){let i=d.tileID,a=t.tileID;return i.overscaledZ-a.overscaledZ||i.canonical.y-a.canonical.y||i.wrap-a.wrap||i.canonical.x-a.canonical.x}function yr(d,t){let i=d.feature,a=t.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=a}function _s(d,t,i){return u._(this,void 0,void 0,function*(){let a=d;if(d.url?a=(yield u.j(t.transformRequest(d.url,"Source"),i)).data:yield re.frameAsync(i),!a)return null;let h=u.Q(u.e(a,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(h.vectorLayerIds=a.vector_layers.map(m=>m.id)),h})}class ji{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof u.S?new u.S(t.lng,t.lat):u.S.convert(t),this}setSouthWest(t){return this._sw=t instanceof u.S?new u.S(t.lng,t.lat):u.S.convert(t),this}extend(t){let i=this._sw,a=this._ne,h,m;if(t instanceof u.S)h=t,m=t;else{if(!(t instanceof ji))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ji.convert(t)):this.extend(u.S.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(u.S.convert(t)):this;if(h=t._sw,m=t._ne,!h||!m)return this}return i||a?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),a.lng=Math.max(m.lng,a.lng),a.lat=Math.max(m.lat,a.lat)):(this._sw=new u.S(h.lng,h.lat),this._ne=new u.S(m.lng,m.lat)),this}getCenter(){return new u.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.S(this.getWest(),this.getNorth())}getSouthEast(){return new u.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){let{lng:i,lat:a}=u.S.convert(t),h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&h}static convert(t){return t instanceof ji?t:t&&new ji(t)}static fromLngLat(t,i=0){let a=360*i/40075017,h=a/Math.cos(Math.PI/180*t.lat);return new ji(new u.S(t.lng-h,t.lat-a),new u.S(t.lng+h,t.lat+a))}adjustAntiMeridian(){let t=new u.S(this._sw.lng,this._sw.lat),i=new u.S(this._ne.lng,this._ne.lat);return new ji(t,t.lng>i.lng?new u.S(i.lng+360,i.lat):i)}}class rs{constructor(t,i,a){this.bounds=ji.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=a||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){let i=Math.pow(2,t.z),a=Math.floor(u.V(this.bounds.getWest())*i),h=Math.floor(u.U(this.bounds.getNorth())*i),m=Math.ceil(u.V(this.bounds.getEast())*i),v=Math.ceil(u.U(this.bounds.getSouth())*i);return t.x>=a&&t.x<m&&t.y>=h&&t.y<v}}class cn extends u.E{constructor(t,i,a,h){if(super(),this.id=t,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.Q(i,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let t=yield _s(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(u.e(this,t),t.bounds&&(this.tileBounds=new rs(t.bounds,this.minzoom,this.maxzoom)),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new u.k(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(t){return u._(this,void 0,void 0,function*(){let i=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(i,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};a.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((m,v)=>{t.reloadPromise={resolve:m,reject:v}})}else t.actor=this.dispatcher.getActor(),h="LT";t.abortController=new AbortController;try{let m=yield t.actor.sendAsync({type:h,data:a},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,m)}catch(m){if(delete t.abortController,t.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,i){if(i&&i.resourceTiming&&(t.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&t.setExpiryData(i),t.loadVectorData(i,this.map.painter),t.reloadPromise){let a=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(a.resolve).catch(a.reject)}}abortTile(t){return u._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return u._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class zs extends u.E{constructor(t,i,a,h){super(),this.id=t,this.dispatcher=a,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},i),u.e(this,u.Q(i,["url","scheme","tileSize"]))}load(){return u._(this,arguments,void 0,function*(t=!1){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let i=yield _s(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(u.e(this,i),i.bounds&&(this.tileBounds=new rs(i.bounds,this.minzoom,this.maxzoom)),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(i){this._tileJSONRequest=null,this.fire(new u.k(i))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return u.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return u._(this,void 0,void 0,function*(){let i=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{let a=yield Wi.getImage(this.map._requestManager.transformRequest(i,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&(a.cacheControl||a.expires)&&t.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});let h=this.map.painter.context,m=h.gl,v=a.data;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new u.T(h,v,m.RGBA,{useMipmap:!0}),t.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(a){if(delete t.abortController,t.aborted)t.state="unloaded";else if(a)throw t.state="errored",a}})}abortTile(t){return u._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return u._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class fr extends zs{constructor(t,i,a,h){super(t,i,a,h),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(t){return u._(this,void 0,void 0,function*(){let i=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(i,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{let h=yield Wi.getImage(a,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){let m=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});let v=u.b(m)&&u.W()?m:yield this.readImageNow(m),C={type:this.type,uid:t.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();let P=yield t.actor.sendAsync({type:"LDT",data:C});t.dem=P,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}})}readImageNow(t){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.X()){let i=t.width+2,a=t.height+2;try{return new u.R({width:i,height:a},yield u.Y(t,-1,-1,i,a))}catch{}}return re.getImageData(t,1)})}_getNeighboringTiles(t){let i=t.canonical,a=Math.pow(2,i.z),h=(i.x-1+a)%a,m=i.x===0?t.wrap-1:t.wrap,v=(i.x+1+a)%a,C=i.x+1===a?t.wrap+1:t.wrap,P={};return P[new u.Z(t.overscaledZ,m,i.z,h,i.y).key]={backfilled:!1},P[new u.Z(t.overscaledZ,C,i.z,v,i.y).key]={backfilled:!1},i.y>0&&(P[new u.Z(t.overscaledZ,m,i.z,h,i.y-1).key]={backfilled:!1},P[new u.Z(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},P[new u.Z(t.overscaledZ,C,i.z,v,i.y-1).key]={backfilled:!1}),i.y+1<a&&(P[new u.Z(t.overscaledZ,m,i.z,h,i.y+1).key]={backfilled:!1},P[new u.Z(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},P[new u.Z(t.overscaledZ,C,i.z,v,i.y+1).key]={backfilled:!1}),P}unloadTile(t){return u._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class Er extends u.E{constructor(t,i,a,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(h),this._data=i.data,this._options=u.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&u.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=u.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:u.$,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(i.clusterMaxZoom),minPoints:Math.max(2,i.clusterMinPoints||2),extent:u.$,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(u.$/this.tileSize)}_getClusterMaxZoom(t){let i=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||u.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${i}"`),i}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return u._(this,void 0,void 0,function*(){let t=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}getCoordinatesFromGeometry(t){return t.type==="GeometryCollection"?t.geometries.map(i=>i.coordinates).flat(1/0):t.coordinates.flat(1/0)}getBounds(){return u._(this,void 0,void 0,function*(){let t=new ji,i=yield this.getData(),a;switch(i.type){case"FeatureCollection":a=i.features.map(h=>this.getCoordinatesFromGeometry(h.geometry)).flat(1/0);break;case"Feature":a=this.getCoordinatesFromGeometry(i.geometry);break;default:a=this.getCoordinatesFromGeometry(i)}if(a.length==0)return t;for(let h=0;h<a.length-1;h+=2)t.extend([a[h],a[h+1]]);return t})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,i,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:i,offset:a}})}_updateWorkerData(t){return u._(this,void 0,void 0,function*(){let i=u.e({type:this.type},this.workerOptions);t?i.dataDiff=t:typeof this._data=="string"?(i.request=this.map._requestManager.transformRequest(re.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.l("dataloading",{dataType:"source"}));try{let a=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new u.l("dataabort",{dataType:"source"}));let h=null;a.resourceTiming&&a.resourceTiming[this.id]&&(h=a.resourceTiming[this.id].slice(0));let m={dataType:"source"};this._collectResourceTiming&&h&&h.length>0&&u.e(m,{resourceTiming:h}),this.fire(new u.l("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new u.l("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new u.l("dataabort",{dataType:"source"}));this.fire(new u.k(a))}})}loaded(){return this._pendingLoads===0}loadTile(t){return u._(this,void 0,void 0,function*(){let i=t.actor?"RT":"LT";t.actor=this.actor;let a={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};t.abortController=new AbortController;let h=yield this.actor.sendAsync({type:i,data:a},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,i==="RT")})}abortTile(t){return u._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return u._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Rr extends u.E{constructor(t,i,a,h){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=i}load(t){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let i=yield Wi.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,t&&(this.coordinates=t),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new u.k(i))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;let i=t.map(u.a0.fromLngLat);var a;return this.tileID=function(h){let m=u.a1.fromPoints(h),v=m.width(),C=m.height(),P=Math.max(v,C),I=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),D=Math.pow(2,I);return new u.a3(I,Math.floor((m.minX+m.maxX)/2*D),Math.floor((m.minY+m.maxY)/2*D))}(i),this.terrainTileRanges=this._getOverlappingTileRanges(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map(h=>this.tileID.getTilePoint(h)._round()),this.flippedWindingOrder=((a=this.tileCoords)[1].x-a[0].x)*(a[2].y-a[0].y)-(a[1].y-a[0].y)*(a[2].x-a[0].x)<0,this.fire(new u.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let t=this.map.painter.context,i=t.gl;this.texture||(this.texture=new u.T(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let a=!1;for(let h in this.tiles){let m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,a=!0)}a&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){let{minX:i,minY:a,maxX:h,maxY:m}=u.a1.fromPoints(t),v={};for(let C=0;C<=u.a2;C++){let P=Math.pow(2,C),I=Math.floor(i*P),D=Math.floor(a*P),F=Math.floor(h*P),O=Math.floor(m*P);v[C]={minTileX:I,minTileY:D,maxTileX:F,maxTileY:O}}return v}}class ns extends Rr{constructor(t,i,a,h){super(t,i,a,h),this.roundZoom=!0,this.type="video",this.options=i}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;let t=this.options;this.urls=[];for(let i of t.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{let i=yield u.a4(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new u.k(i))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){let i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new u.k(new u.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let t=this.map.painter.context,i=t.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new u.T(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let a=!1;for(let h in this.tiles){let m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,a=!0)}a&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Gn extends Rr{constructor(t,i,a,h){super(t,i,a,h),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(v=>typeof v!="number"))||this.fire(new u.k(new u.a5(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.k(new u.a5(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new u.k(new u.a5(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new u.k(new u.a5(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.k(new u.a5(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let i=this.map.painter.context,a=i.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.T(i,this.canvas,a.RGBA,{premultiply:!0});let h=!1;for(let m in this.tiles){let v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,h=!0)}h&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}let zo={},Rs=d=>{switch(d){case"geojson":return Er;case"image":return Rr;case"raster":return zs;case"raster-dem":return fr;case"vector":return cn;case"video":return ns;case"canvas":return Gn}return zo[d]},gs="RTLPluginLoaded";class no extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Wr()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(i=>{throw this.status="error",i})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return u._(this,arguments,void 0,function*(i,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=re.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return u._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.l(gs))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Zn=null;function Kr(){return Zn||(Zn=new no),Zn}class Vn{constructor(t,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=u.a6(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){let i=t+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,i,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,m){let v={};if(!m)return v;for(let C of h){let P=C.layerIds.map(I=>m.getLayer(I)).filter(Boolean);if(P.length!==0){C.layers=P,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(I=>P.filter(D=>D.id===I)[0]));for(let I of P)v[I.id]=C}}return v}(t.buckets,i?.style),this.hasSymbolBuckets=!1;for(let h in this.buckets){let m=this.buckets[h];if(m instanceof u.a8){if(this.hasSymbolBuckets=!0,!a)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let h in this.buckets){let m=this.buckets[h];if(m instanceof u.a8&&m.hasRTLText){this.hasRTLText=!0,Kr().lazyLoad();break}}this.queryPadding=0;for(let h in this.buckets){let m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(h).queryRadius(m))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new u.a7}unloadVectorData(){for(let t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(let a in this.buckets){let h=this.buckets[a];h.uploadPending()&&h.upload(t)}let i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new u.T(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new u.T(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,i,a,h,m,v,C,P,I,D,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:m,scale:v,tileSize:this.tileSize,pixelPosMatrix:D,transform:P,params:C,queryPadding:this.queryPadding*I,getElevation:F},t,i,a):{}}querySourceFeatures(t,i){let a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;let h=a.loadVTLayers(),m=i&&i.sourceLayer?i.sourceLayer:"",v=h._geojsonTileLayer||h[m];if(!v)return;let C=u.a9(i&&i.filter),{z:P,x:I,y:D}=this.tileID.canonical,F={z:P,x:I,y:D};for(let O=0;O<v.length;O++){let Z=v.feature(O);if(C.needGeometry){let ct=u.aa(Z,!0);if(!C.filter(new u.F(this.tileID.overscaledZ),ct,this.tileID.canonical))continue}else if(!C.filter(new u.F(this.tileID.overscaledZ),Z))continue;let X=a.getId(Z,m),nt=new u.ab(Z,P,I,D,X);nt.tile=F,t.push(nt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){let i=this.expirationTime;if(t.cacheControl){let a=u.ac(t.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let a=Date.now(),h=!1;if(this.expirationTime>a)h=!1;else if(i)if(this.expirationTime<i)h=!0;else{let m=this.expirationTime-i;m?this.expirationTime=a+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;let a=this.latestFeatureIndex.loadVTLayers();for(let h in this.buckets){if(!i.style.hasLayer(h))continue;let m=this.buckets[h],v=m.layers[0].sourceLayer||"_geojsonTileLayer",C=a[v],P=t[v];if(!C||!P||Object.keys(P).length===0)continue;m.update(P,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});let I=i&&i.style&&i.style.getLayer(h);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<re.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=re.now()+t}setDependencies(t,i){let a={};for(let h of i)a[h]=!0;this.dependencies[t]=a}hasDependency(t,i){for(let a of t){let h=this.dependencies[a];if(h){for(let m of i)if(h[m])return!0}}return!1}}class Xo{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(let t in this.data)for(let i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,a){let h=t.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);let m={value:i,timeout:void 0};if(a!==void 0&&(m.timeout=setTimeout(()=>{this.remove(t,m)},a)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){let v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){let i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){let i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;let a=t.wrapped().key,h=i===void 0?0:this.data[a].indexOf(i),m=this.data[a][h];return this.data[a].splice(h,1),m.timeout&&clearTimeout(m.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(m.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){let i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){let i=[];for(let a in this.data)for(let h of this.data[a])t(h.value)||i.push(h);for(let a of i)this.remove(a.value.tileID,a)}}class Yo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,a){let h=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},u.e(this.stateChanges[t][h],a),this.deletedStates[t]===null){this.deletedStates[t]={};for(let m in this.state[t])m!==h&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(let m in this.state[t][h])a[m]||(this.deletedStates[t][h][m]=null)}else for(let m in a)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][m]===null&&delete this.deletedStates[t][h][m]}removeFeatureState(t,i,a){if(this.deletedStates[t]===null)return;let h=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},a&&i!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][a]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(a in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][a]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,i){let a=String(i),h=u.e({},(this.state[t]||{})[a],(this.stateChanges[t]||{})[a]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){let m=this.deletedStates[t][i];if(m===null)return{};for(let v in m)delete h[v]}return h}initializeTileState(t,i){t.setFeatureState(this.state,i)}coalesceChanges(t,i){let a={};for(let h in this.stateChanges){this.state[h]=this.state[h]||{};let m={};for(let v in this.stateChanges[h])this.state[h][v]||(this.state[h][v]={}),u.e(this.state[h][v],this.stateChanges[h][v]),m[v]=this.state[h][v];a[h]=m}for(let h in this.deletedStates){this.state[h]=this.state[h]||{};let m={};if(this.deletedStates[h]===null)for(let v in this.state[h])m[v]={},this.state[h][v]={};else for(let v in this.deletedStates[h]){if(this.deletedStates[h][v]===null)this.state[h][v]={};else for(let C of Object.keys(this.deletedStates[h][v]))delete this.state[h][v][C];m[v]=this.state[h][v]}a[h]=a[h]||{},u.e(a[h],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(let h in t)t[h].setFeatureState(a,i)}}let Un=89.25;function Gt(d,t){let i=u.ag(t.lat,-85.051129,u.ah);return new u.P(u.V(t.lng)*d,u.U(i)*d)}function J(d,t){return new u.a0(t.x/d,t.y/d).toLngLat()}function tt(d){return d.cameraToCenterDistance*Math.min(.85*Math.tan(u.ad(90-d.pitch)),Math.tan(u.ad(Un-d.pitch)))}function lt(d,t){let i=d.canonical,a=t/u.ae(i.z),h=i.x+Math.pow(2,i.z)*d.wrap,m=u.af(new Float64Array(16));return u.M(m,m,[h*a,i.y*a,0]),u.N(m,m,[a/u.$,a/u.$,1]),m}function vt(d,t,i,a,h){let m=u.a0.fromLngLat(d,t),v=h*u.ai(1,d.lat),C=v*Math.cos(u.ad(i)),P=Math.sqrt(v*v-C*C),I=P*Math.sin(u.ad(-a)),D=P*Math.cos(u.ad(-a));return new u.a0(m.x+I,m.y+D,m.z+C)}function Et(d,t,i){let a=t.intersectsFrustum(d);if(!i||a===0)return a;let h=t.intersectsPlane(i);return h===0?0:a===2&&h===2?2:1}function Nt(d,t,i){let a=0,h=(i-t)/10;for(let m=0;m<10;m++)a+=h*Math.pow(Math.cos(t+(m+.5)/10*(i-t)),d);return a}function ee(d,t){return function(i,a,h,m,v){let C=2*((d-1)/u.aj(Math.cos(u.ad(Un-v))/Math.cos(u.ad(Un)))-1),P=Math.acos(h/m),I=2*Nt(C-1,0,u.ad(v/2)),D=Math.min(u.ad(Un),P+u.ad(v/2)),F=Nt(C-1,Math.min(D,P-u.ad(v/2)),D),O=Math.atan(a/h),Z=Math.hypot(a,h),X=i;return X+=u.aj(m/Z/Math.max(.5,Math.cos(u.ad(v/2)))),X+=C*u.aj(Math.cos(O))/2,X-=u.aj(Math.max(1,F/I/t))/2,X}}let Rt=ee(9.314,3);function fe(d,t){let i=(t.roundZoom?Math.round:Math.floor)(d.zoom+u.aj(d.tileSize/t.tileSize));return Math.max(0,i)}function ce(d,t){let i=d.getCameraFrustum(),a=d.getClippingPlane(),h=d.screenPointToMercatorCoordinate(d.getCameraPoint()),m=u.a0.fromLngLat(d.center,d.elevation);h.z=m.z+Math.cos(d.pitchInRadians)*d.cameraToCenterDistance/d.worldSize;let v=d.getCoveringTilesDetailsProvider(),C=v.allowVariableZoom(d,t),P=fe(d,t),I=t.minzoom||0,D=t.maxzoom!==void 0?t.maxzoom:d.maxZoom,F=Math.min(Math.max(0,P),D),O=Math.pow(2,F),Z=[O*h.x,O*h.y,0],X=[O*m.x,O*m.y,0],nt=Math.hypot(m.x-h.x,m.y-h.y),ct=Math.abs(m.z-h.z),dt=Math.hypot(nt,ct),mt=Lt=>({zoom:0,x:0,y:0,wrap:Lt,fullyVisible:!1}),Ct=[],yt=[];if(d.renderWorldCopies&&v.allowWorldCopies())for(let Lt=1;Lt<=3;Lt++)Ct.push(mt(-Lt)),Ct.push(mt(Lt));for(Ct.push(mt(0));Ct.length>0;){let Lt=Ct.pop(),It=Lt.x,xt=Lt.y,Ot=Lt.fullyVisible,ue={x:It,y:xt,z:Lt.zoom},te=v.getTileBoundingVolume(ue,Lt.wrap,d.elevation,t);if(!Ot){let ke=Et(i,te,a);if(ke===0)continue;Ot=ke===2}let ne=v.distanceToTile2d(h.x,h.y,ue,te),he=P;C&&(he=(t.calculateTileZoom||Rt)(d.zoom+u.aj(d.tileSize/t.tileSize),ne,ct,dt,d.fov)),he=(t.roundZoom?Math.round:Math.floor)(he),he=Math.max(0,he);let Ee=Math.min(he,D);if(Lt.wrap=v.getWrap(m,ue,Lt.wrap),Lt.zoom>=Ee){if(Lt.zoom<I)continue;let ke=F-Lt.zoom,xe=Z[0]-.5-(It<<ke),Re=Z[1]-.5-(xt<<ke),_i=t.reparseOverscaled?Math.max(Lt.zoom,he):Lt.zoom;yt.push({tileID:new u.Z(Lt.zoom===D?_i:Lt.zoom,Lt.wrap,Lt.zoom,It,xt),distanceSq:u.ak([X[0]-.5-It,X[1]-.5-xt]),tileDistanceToCamera:Math.sqrt(xe*xe+Re*Re)})}else for(let ke=0;ke<4;ke++)Ct.push({zoom:Lt.zoom+1,x:(It<<1)+ke%2,y:(xt<<1)+(ke>>1),wrap:Lt.wrap,fullyVisible:Ot})}return yt.sort((Lt,It)=>Lt.distanceSq-It.distanceSq).map(Lt=>Lt.tileID)}let qt=u.a1.fromPoints([new u.P(0,0),new u.P(u.$,u.$)]);class ye extends u.E{constructor(t,i,a){super(),this.id=t,this.dispatcher=a,this.on("data",h=>this._dataHandler(h)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,m,v,C)=>{let P=new(Rs(m.type))(h,m,v,C);if(P.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${P.id}`);return P})(t,i,a,this),this._tiles={},this._cache=new Xo(0,h=>this._unloadTile(h)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Yo,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let t in this._tiles){let i=this._tiles[t];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,i,a){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,i,a)}catch(h){t.state="errored",h.status!==404?this._source.fire(new u.k(h,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new u.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let i in this._tiles){let a=this._tiles[i];a.upload(t),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(At).map(t=>t.key)}getRenderableIds(t){let i=[];for(let a in this._tiles)this._isIdRenderable(a,t)&&i.push(this._tiles[a]);return t?i.sort((a,h)=>{let m=a.tileID,v=h.tileID,C=new u.P(m.canonical.x,m.canonical.y)._rotate(-this.transform.bearingInRadians),P=new u.P(v.canonical.x,v.canonical.y)._rotate(-this.transform.bearingInRadians);return m.overscaledZ-v.overscaledZ||P.y-C.y||P.x-C.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(At).map(a=>a.key)}hasRenderableParent(t){let i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let i in this._tiles)t?this._reloadTile(i,"expired"):this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(t,i){return u._(this,void 0,void 0,function*(){let a=this._tiles[t];a&&(a.state!=="loading"&&(a.state=i),yield this._loadTile(a,t,i))})}_tileLoaded(t,i,a){t.timeAdded=re.now(),a==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new u.l("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){let i=this.getRenderableIds();for(let h=0;h<i.length;h++){let m=i[h];if(t.neighboringTiles&&t.neighboringTiles[m]){let v=this.getTileByID(m);a(t,v),a(v,t)}}function a(h,m){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let v=m.tileID.canonical.x-h.tileID.canonical.x,C=m.tileID.canonical.y-h.tileID.canonical.y,P=Math.pow(2,h.tileID.canonical.z),I=m.tileID.key;v===0&&C===0||Math.abs(C)>1||(Math.abs(v)>1&&(Math.abs(v+P)===1?v+=P:Math.abs(v-P)===1&&(v-=P)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,v,C),h.neighboringTiles&&h.neighboringTiles[I]&&(h.neighboringTiles[I].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,a,h){for(let m in this._tiles){let v=this._tiles[m];if(h[m]||!v.hasData()||v.tileID.overscaledZ<=i||v.tileID.overscaledZ>a)continue;let C=v.tileID;for(;v&&v.tileID.overscaledZ>i+1;){let I=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[I.key],v&&v.hasData()&&(C=I)}let P=C;for(;P.overscaledZ>i;)if(P=P.scaledTo(P.overscaledZ-1),t[P.key]||t[P.canonical.key]){h[C.key]=C;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){let a=this._loadedParentTiles[t.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=t.overscaledZ-1;a>=i;a--){let h=t.scaledTo(a),m=this._getLoadedTile(h);if(m)return m}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){let i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){let i=Math.ceil(t.width/this._source.tileSize)+1,a=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(i*a*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(m)}handleWrapJump(t){let i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){let a={};for(let h in this._tiles){let m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+i),a[m.tileID.key]=m}this._tiles=a;for(let h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(let h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}_updateCoveredAndRetainedTiles(t,i,a,h,m,v){let C={},P={},I=Object.keys(t),D=re.now();for(let F of I){let O=t[F],Z=this._tiles[F];if(!Z||Z.fadeEndTime!==0&&Z.fadeEndTime<=D)continue;let X=this.findLoadedParent(O,i),nt=this.findLoadedSibling(O),ct=X||nt||null;ct&&(this._addTile(ct.tileID),C[ct.tileID.key]=ct.tileID),P[F]=O}this._retainLoadedChildren(P,h,a,t);for(let F in C)t[F]||(this._coveredTiles[F]=!0,t[F]=C[F]);if(v){let F={},O={};for(let Z of m)this._tiles[Z.key].hasData()?F[Z.key]=Z:O[Z.key]=Z;for(let Z in O){let X=O[Z].children(this._source.maxzoom);this._tiles[X[0].key]&&this._tiles[X[1].key]&&this._tiles[X[2].key]&&this._tiles[X[3].key]&&(F[X[0].key]=t[X[0].key]=X[0],F[X[1].key]=t[X[1].key]=X[1],F[X[2].key]=t[X[2].key]=X[2],F[X[3].key]=t[X[3].key]=X[3],delete O[Z])}for(let Z in O){let X=O[Z],nt=this.findLoadedParent(X,this._source.minzoom),ct=this.findLoadedSibling(X),dt=nt||ct||null;if(dt){F[dt.tileID.key]=t[dt.tileID.key]=dt.tileID;for(let mt in F)F[mt].isChildOf(dt.tileID)&&delete F[mt]}}for(let Z in this._tiles)F[Z]||(this._coveredTiles[Z]=!0)}}update(t,i){if(!this._sourceLoaded||this._paused)return;let a;this.transform=t,this.terrain=i,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new u.Z(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(a=ce(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(a=a.filter(D=>this._source.hasTile(D)))):a=[];let h=fe(t,this._source),m=Math.max(h-ye.maxOverzooming,this._source.minzoom),v=Math.max(h+ye.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let D={};for(let F of a)if(F.canonical.z>this._source.minzoom){let O=F.scaledTo(F.canonical.z-1);D[O.key]=O;let Z=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));D[Z.key]=Z}a=a.concat(Object.values(D))}let C=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new u.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let P=this._updateRetainedTiles(a,h);Ie(this._source.type)&&this._updateCoveredAndRetainedTiles(P,m,v,h,a,i);for(let D in P)this._tiles[D].clearFadeHold();let I=u.al(this._tiles,P);for(let D of I){let F=this._tiles[D];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,i){var a;let h={},m={},v=Math.max(i-ye.maxOverzooming,this._source.minzoom),C=Math.max(i+ye.maxUnderzooming,this._source.minzoom),P={};for(let I of t){let D=this._addTile(I);h[I.key]=I,D.hasData()||i<this._source.maxzoom&&(P[I.key]=I)}this._retainLoadedChildren(P,i,C,h);for(let I of t){let D=this._tiles[I.key];if(D.hasData())continue;if(i+1>this._source.maxzoom){let O=I.children(this._source.maxzoom)[0],Z=this.getTile(O);if(Z&&Z.hasData()){h[O.key]=O;continue}}else{let O=I.children(this._source.maxzoom);if(h[O[0].key]&&h[O[1].key]&&h[O[2].key]&&h[O[3].key])continue}let F=D.wasRequested();for(let O=I.overscaledZ-1;O>=v;--O){let Z=I.scaledTo(O);if(m[Z.key])break;if(m[Z.key]=!0,D=this.getTile(Z),!D&&F&&(D=this._addTile(Z)),D){let X=D.hasData();if((X||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||F)&&(h[Z.key]=Z),F=D.wasRequested(),X)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let t in this._tiles){let i=[],a,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){a=this._loadedParentTiles[h.key];break}i.push(h.key);let m=h.scaledTo(h.overscaledZ-1);if(a=this._getLoadedTile(m),a)break;h=m}for(let m of i)this._loadedParentTiles[m]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let t in this._tiles){let i=this._tiles[t].tileID,a=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=a}}_addTile(t){let i=this._tiles[t.key];if(i)return i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));let a=i;return i||(i=new Vn(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(i,t.key,i.state)),i.uses++,this._tiles[t.key]=i,a||this._source.fire(new u.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);let a=i.getExpiryTimeout();a&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},a))}refreshTiles(t){for(let i in this._tiles)(this._isIdRenderable(i)||this._tiles[i].state=="errored")&&t.some(a=>a.equals(this._tiles[i].tileID.canonical))&&this._reloadTile(i,"expired")}_removeTile(t){let i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(t){let i=t.sourceDataType;t.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&i==="content"&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,i,a){let h=[],m=this.transform;if(!m)return h;let v=m.getCoveringTilesDetailsProvider().allowWorldCopies(),C=a?m.getCameraQueryGeometry(t):t,P=Z=>m.screenPointToMercatorCoordinate(Z,this.terrain),I=this.transformBbox(t,P,!v),D=this.transformBbox(C,P,!v),F=this.getIds(),O=u.a1.fromPoints(D);for(let Z=0;Z<F.length;Z++){let X=this._tiles[F[Z]];if(X.holdingForFade())continue;let nt=v?[X.tileID]:[X.tileID.unwrapTo(-1),X.tileID.unwrapTo(0)],ct=Math.pow(2,m.zoom-X.tileID.overscaledZ),dt=i*X.queryPadding*u.$/X.tileSize/ct;for(let mt of nt){let Ct=O.map(yt=>mt.getTilePoint(new u.a0(yt.x,yt.y)));if(Ct.expandBy(dt),Ct.intersects(qt)){let yt=I.map(It=>mt.getTilePoint(It)),Lt=D.map(It=>mt.getTilePoint(It));h.push({tile:X,tileID:v?mt:mt.unwrapTo(0),queryGeometry:yt,cameraQueryGeometry:Lt,scale:ct})}}}return h}transformBbox(t,i,a){let h=t.map(i);if(a){let m=u.a1.fromPoints(t);m.shrinkBy(.001*Math.min(m.width(),m.height()));let v=m.map(i);u.a1.fromPoints(h).covers(v)||(h=h.map(C=>C.x>.5?new u.a0(C.x-1,C.y,C.z):C))}return h}getVisibleCoordinates(t){let i=this.getRenderableIds(t).map(a=>this._tiles[a].tileID);return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(Ie(this._source.type)){let t=re.now();for(let i in this._tiles)if(this._tiles[i].fadeEndTime>=t)return!0}return!1}setFeatureState(t,i,a){this._state.updateState(t=t||"_geojsonTileLayer",i,a)}removeFeatureState(t,i,a){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,a)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,a){let h=this._tiles[t];h&&h.setDependencies(i,a)}reloadTilesForDependencies(t,i){for(let a in this._tiles)this._tiles[a].hasDependency(t,i)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(t,i))}}function At(d,t){let i=Math.abs(2*d.wrap)-+(d.wrap<0),a=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||a-i||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function Ie(d){return d==="raster"||d==="image"||d==="video"}ye.maxOverzooming=10,ye.maxUnderzooming=3;class $e{constructor(t,i){this.reset(t,i)}reset(t,i){this.points=t||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=u.ag(t,0,1);let i=1,a=this._distances[i],h=t*this.paddedLength+this.padding;for(;a<h&&i<this._distances.length;)a=this._distances[++i];let m=i-1,v=this._distances[m],C=a-v,P=C>0?(h-v)/C:0;return this.points[m].mult(1-P).add(this.points[i].mult(P))}}function Be(d,t){let i=!0;return d==="always"||d!=="never"&&t!=="never"||(i=!1),i}class je{constructor(t,i,a){let h=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(t/a),this.yCellCount=Math.ceil(i/a);for(let v=0;v<this.xCellCount*this.yCellCount;v++)h.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=i,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,i,a,h,m){this._forEachCell(i,a,h,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(m)}insertCircle(t,i,a,h){this._forEachCell(i-h,a-h,i+h,a+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(i),this.circles.push(a),this.circles.push(h)}_insertBoxCell(t,i,a,h,m,v){this.boxCells[m].push(v)}_insertCircleCell(t,i,a,h,m,v){this.circleCells[m].push(v)}_query(t,i,a,h,m,v,C){if(a<0||t>this.width||h<0||i>this.height)return[];let P=[];if(t<=0&&i<=0&&this.width<=a&&this.height<=h){if(m)return[{key:null,x1:t,y1:i,x2:a,y2:h}];for(let I=0;I<this.boxKeys.length;I++)P.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){let D=this.circles[3*I],F=this.circles[3*I+1],O=this.circles[3*I+2];P.push({key:this.circleKeys[I],x1:D-O,y1:F-O,x2:D+O,y2:F+O})}}else this._forEachCell(t,i,a,h,this._queryCell,P,{hitTest:m,overlapMode:v,seenUids:{box:{},circle:{}}},C);return P}query(t,i,a,h){return this._query(t,i,a,h,!1,null)}hitTest(t,i,a,h,m,v){return this._query(t,i,a,h,!0,m,v).length>0}hitTestCircle(t,i,a,h,m){let v=t-a,C=t+a,P=i-a,I=i+a;if(C<0||v>this.width||I<0||P>this.height)return!1;let D=[];return this._forEachCell(v,P,C,I,this._queryCellCircle,D,{hitTest:!0,overlapMode:h,circle:{x:t,y:i,radius:a},seenUids:{box:{},circle:{}}},m),D.length>0}_queryCell(t,i,a,h,m,v,C,P){let{seenUids:I,hitTest:D,overlapMode:F}=C,O=this.boxCells[m];if(O!==null){let X=this.bboxes;for(let nt of O)if(!I.box[nt]){I.box[nt]=!0;let ct=4*nt,dt=this.boxKeys[nt];if(t<=X[ct+2]&&i<=X[ct+3]&&a>=X[ct+0]&&h>=X[ct+1]&&(!P||P(dt))&&(!D||!Be(F,dt.overlapMode))&&(v.push({key:dt,x1:X[ct],y1:X[ct+1],x2:X[ct+2],y2:X[ct+3]}),D))return!0}}let Z=this.circleCells[m];if(Z!==null){let X=this.circles;for(let nt of Z)if(!I.circle[nt]){I.circle[nt]=!0;let ct=3*nt,dt=this.circleKeys[nt];if(this._circleAndRectCollide(X[ct],X[ct+1],X[ct+2],t,i,a,h)&&(!P||P(dt))&&(!D||!Be(F,dt.overlapMode))){let mt=X[ct],Ct=X[ct+1],yt=X[ct+2];if(v.push({key:dt,x1:mt-yt,y1:Ct-yt,x2:mt+yt,y2:Ct+yt}),D)return!0}}}return!1}_queryCellCircle(t,i,a,h,m,v,C,P){let{circle:I,seenUids:D,overlapMode:F}=C,O=this.boxCells[m];if(O!==null){let X=this.bboxes;for(let nt of O)if(!D.box[nt]){D.box[nt]=!0;let ct=4*nt,dt=this.boxKeys[nt];if(this._circleAndRectCollide(I.x,I.y,I.radius,X[ct+0],X[ct+1],X[ct+2],X[ct+3])&&(!P||P(dt))&&!Be(F,dt.overlapMode))return v.push(!0),!0}}let Z=this.circleCells[m];if(Z!==null){let X=this.circles;for(let nt of Z)if(!D.circle[nt]){D.circle[nt]=!0;let ct=3*nt,dt=this.circleKeys[nt];if(this._circlesCollide(X[ct],X[ct+1],X[ct+2],I.x,I.y,I.radius)&&(!P||P(dt))&&!Be(F,dt.overlapMode))return v.push(!0),!0}}}_forEachCell(t,i,a,h,m,v,C,P){let I=this._convertToXCellCoord(t),D=this._convertToYCellCoord(i),F=this._convertToXCellCoord(a),O=this._convertToYCellCoord(h);for(let Z=I;Z<=F;Z++)for(let X=D;X<=O;X++)if(m.call(this,t,i,a,h,this.xCellCount*X+Z,v,C,P))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,i,a,h,m,v){let C=h-t,P=m-i,I=a+v;return I*I>C*C+P*P}_circleAndRectCollide(t,i,a,h,m,v,C){let P=(v-h)/2,I=Math.abs(t-(h+P));if(I>P+a)return!1;let D=(C-m)/2,F=Math.abs(i-(m+D));if(F>D+a)return!1;if(I<=P||F<=D)return!0;let O=I-P,Z=F-D;return O*O+Z*Z<=a*a}}function Je(d,t,i){let a=u.L();if(!d){let{vecSouth:F,vecEast:O}=Ai(t),Z=Qt();Z[0]=O[0],Z[1]=O[1],Z[2]=F[0],Z[3]=F[1],h=Z,(D=(v=(m=Z)[0])*(I=m[3])-(P=m[2])*(C=m[1]))&&(h[0]=I*(D=1/D),h[1]=-C*D,h[2]=-P*D,h[3]=v*D),a[0]=Z[0],a[1]=Z[1],a[4]=Z[2],a[5]=Z[3]}var h,m,v,C,P,I,D;return u.N(a,a,[1/i,1/i,1]),a}function Oi(d,t,i,a){if(d){let h=u.L();if(!t){let{vecSouth:m,vecEast:v}=Ai(i);h[0]=v[0],h[1]=v[1],h[4]=m[0],h[5]=m[1]}return u.N(h,h,[a,a,1]),h}return i.pixelsToClipSpaceMatrix}function Ai(d){let t=Math.cos(d.rollInRadians),i=Math.sin(d.rollInRadians),a=Math.cos(d.pitchInRadians),h=Math.cos(d.bearingInRadians),m=Math.sin(d.bearingInRadians),v=u.aq();v[0]=-h*a*i-m*t,v[1]=-m*a*i+h*t;let C=u.ar(v);C<1e-9?u.as(v):u.at(v,v,1/C);let P=u.aq();P[0]=h*a*t-m*i,P[1]=m*a*t+h*i;let I=u.ar(P);return I<1e-9?u.as(P):u.at(P,P,1/I),{vecEast:P,vecSouth:v}}function Ti(d,t,i,a){let h;a?(h=[d,t,a(d,t),1],u.av(h,h,i)):(h=[d,t,0,1],Sn(h,h,i));let m=h[3];return{point:new u.P(h[0]/m,h[1]/m),signedDistanceFromCamera:m,isOccluded:!1}}function Ge(d,t){return .5+d/t*.5}function Se(d,t){return d.x>=-t[0]&&d.x<=t[0]&&d.y>=-t[1]&&d.y<=t[1]}function sr(d,t,i,a,h,m,v,C,P,I,D,F,O){let Z=i?d.textSizeData:d.iconSizeData,X=u.am(Z,t.transform.zoom),nt=[256/t.width*2+1,256/t.height*2+1],ct=i?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;ct.clear();let dt=d.lineVertexArray,mt=i?d.text.placedSymbolArray:d.icon.placedSymbolArray,Ct=t.transform.width/t.transform.height,yt=!1;for(let Lt=0;Lt<mt.length;Lt++){let It=mt.get(Lt);if(It.hidden||It.writingMode===u.an.vertical&&!yt){ys(It.numGlyphs,ct);continue}yt=!1;let xt=new u.P(It.anchorX,It.anchorY),Ot={getElevation:O,pitchedLabelPlaneMatrix:a,lineVertexArray:dt,pitchWithMap:m,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:xt,unwrappedTileID:P,width:I,height:D,translation:F},ue=ui(It.anchorX,It.anchorY,Ot);if(!Se(ue.point,nt)){ys(It.numGlyphs,ct);continue}let te=Ge(t.transform.cameraToCenterDistance,ue.signedDistanceFromCamera),ne=u.ao(Z,X,It),he=m?ne*t.transform.getPitchedTextCorrection(It.anchorX,It.anchorY,P)/te:ne*te,Ee=Gi({projectionContext:Ot,pitchedLabelPlaneMatrixInverse:h,symbol:It,fontSize:he,flip:!1,keepUpright:v,glyphOffsetArray:d.glyphOffsetArray,dynamicLayoutVertexArray:ct,aspectRatio:Ct,rotateToLine:C});yt=Ee.useVertical,(Ee.notEnoughRoom||yt||Ee.needsFlipping&&Gi({projectionContext:Ot,pitchedLabelPlaneMatrixInverse:h,symbol:It,fontSize:he,flip:!0,keepUpright:v,glyphOffsetArray:d.glyphOffsetArray,dynamicLayoutVertexArray:ct,aspectRatio:Ct,rotateToLine:C}).notEnoughRoom)&&ys(It.numGlyphs,ct)}i?d.text.dynamicLayoutVertexBuffer.updateData(ct):d.icon.dynamicLayoutVertexBuffer.updateData(ct)}function Le(d,t,i,a,h,m,v,C){let P=m.glyphStartIndex+m.numGlyphs,I=m.lineStartIndex,D=m.lineStartIndex+m.lineLength,F=t.getoffsetX(m.glyphStartIndex),O=t.getoffsetX(P-1),Z=ss(d*F,i,a,h,m.segment,I,D,C,v);if(!Z)return null;let X=ss(d*O,i,a,h,m.segment,I,D,C,v);return X?C.projectionCache.anyProjectionOccluded?null:{first:Z,last:X}:null}function vr(d,t,i,a){return d===u.an.horizontal&&Math.abs(i.y-t.y)>Math.abs(i.x-t.x)*a?{useVertical:!0}:(d===u.an.vertical?t.y<i.y:t.x>i.x)?{needsFlipping:!0}:null}function Gi(d){let{projectionContext:t,pitchedLabelPlaneMatrixInverse:i,symbol:a,fontSize:h,flip:m,keepUpright:v,glyphOffsetArray:C,dynamicLayoutVertexArray:P,aspectRatio:I,rotateToLine:D}=d,F=h/24,O=a.lineOffsetX*F,Z=a.lineOffsetY*F,X;if(a.numGlyphs>1){let nt=a.glyphStartIndex+a.numGlyphs,ct=a.lineStartIndex,dt=a.lineStartIndex+a.lineLength,mt=Le(F,C,O,Z,m,a,D,t);if(!mt)return{notEnoughRoom:!0};let Ct=ni(mt.first.point.x,mt.first.point.y,t,i),yt=ni(mt.last.point.x,mt.last.point.y,t,i);if(v&&!m){let Lt=vr(a.writingMode,Ct,yt,I);if(Lt)return Lt}X=[mt.first];for(let Lt=a.glyphStartIndex+1;Lt<nt-1;Lt++){let It=ss(F*C.getoffsetX(Lt),O,Z,m,a.segment,ct,dt,t,D);if(!It)return{notEnoughRoom:!0};X.push(It)}X.push(mt.last)}else{if(v&&!m){let ct=Pe(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,dt=a.lineStartIndex+a.segment+1,mt=new u.P(t.lineVertexArray.getx(dt),t.lineVertexArray.gety(dt)),Ct=Pe(mt.x,mt.y,t),yt=Ct.signedDistanceFromCamera>0?Ct.point:$n(t.tileAnchorPoint,mt,ct,1,t),Lt=ni(ct.x,ct.y,t,i),It=ni(yt.x,yt.y,t,i),xt=vr(a.writingMode,Lt,It,I);if(xt)return xt}let nt=ss(F*C.getoffsetX(a.glyphStartIndex),O,Z,m,a.segment,a.lineStartIndex,a.lineStartIndex+a.lineLength,t,D);if(!nt||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};X=[nt]}for(let nt of X)u.au(P,nt.point,nt.angle);return{}}function $n(d,t,i,a,h){let m=d.add(d.sub(t)._unit()),v=Pe(m.x,m.y,h).point,C=i.sub(v);return i.add(C._mult(a/C.mag()))}function Os(d,t,i){let a=t.projectionCache;if(a.projections[d])return a.projections[d];let h=new u.P(t.lineVertexArray.getx(d),t.lineVertexArray.gety(d)),m=Pe(h.x,h.y,t);if(m.signedDistanceFromCamera>0)return a.projections[d]=m.point,a.anyProjectionOccluded=a.anyProjectionOccluded||m.isOccluded,m.point;let v=d-i.direction;return $n(i.distanceFromAnchor===0?t.tileAnchorPoint:new u.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),h,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,t)}function Pe(d,t,i){let a=d+i.translation[0],h=t+i.translation[1],m;return i.pitchWithMap?(m=Ti(a,h,i.pitchedLabelPlaneMatrix,i.getElevation),m.isOccluded=!1):(m=i.transform.projectTileCoordinates(a,h,i.unwrappedTileID,i.getElevation),m.point.x=(.5*m.point.x+.5)*i.width,m.point.y=(.5*-m.point.y+.5)*i.height),m}function ni(d,t,i,a){if(i.pitchWithMap){let h=[d,t,0,1];return u.av(h,h,a),i.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],i.unwrappedTileID,i.getElevation).point}return{x:d/i.width*2-1,y:t/i.height*2-1}}function ui(d,t,i){return i.transform.projectTileCoordinates(d,t,i.unwrappedTileID,i.getElevation)}function pn(d,t,i){return d._unit()._perp()._mult(t*i)}function La(d,t,i,a,h,m,v,C,P){if(C.projectionCache.offsets[d])return C.projectionCache.offsets[d];let I=i.add(t);if(d+P.direction<a||d+P.direction>=h)return C.projectionCache.offsets[d]=I,I;let D=Os(d+P.direction,C,P),F=pn(D.sub(i),v,P.direction),O=i.add(F),Z=D.add(F);return C.projectionCache.offsets[d]=u.aw(m,I,O,Z)||I,C.projectionCache.offsets[d]}function ss(d,t,i,a,h,m,v,C,P){let I=a?d-t:d+t,D=I>0?1:-1,F=0;a&&(D*=-1,F=Math.PI),D<0&&(F+=Math.PI);let O,Z=D>0?m+h:m+h+1;C.projectionCache.cachedAnchorPoint?O=C.projectionCache.cachedAnchorPoint:(O=Pe(C.tileAnchorPoint.x,C.tileAnchorPoint.y,C).point,C.projectionCache.cachedAnchorPoint=O);let X,nt,ct=O,dt=O,mt=0,Ct=0,yt=Math.abs(I),Lt=[],It;for(;mt+Ct<=yt;){if(Z+=D,Z<m||Z>=v)return null;mt+=Ct,dt=ct,nt=X;let ue={absOffsetX:yt,direction:D,distanceFromAnchor:mt,previousVertex:dt};if(ct=Os(Z,C,ue),i===0)Lt.push(dt),It=ct.sub(dt);else{let te,ne=ct.sub(dt);te=ne.mag()===0?pn(Os(Z+D,C,ue).sub(ct),i,D):pn(ne,i,D),nt||(nt=dt.add(te)),X=La(Z,te,ct,m,v,nt,i,C,ue),Lt.push(nt),It=X.sub(nt)}Ct=It.mag()}let xt=It._mult((yt-mt)/Ct)._add(nt||dt),Ot=F+Math.atan2(ct.y-dt.y,ct.x-dt.x);return Lt.push(xt),{point:xt,angle:P?Ot:0,path:Lt}}let si=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ys(d,t){for(let i=0;i<d;i++){let a=t.length;t.resize(a+4),t.float32.set(si,3*a)}}function Sn(d,t,i){let a=t[0],h=t[1];return d[0]=i[0]*a+i[4]*h+i[12],d[1]=i[1]*a+i[5]*h+i[13],d[3]=i[3]*a+i[7]*h+i[15],d}let Xi=100;class Jo{constructor(t,i=new je(t.width+200,t.height+200,25),a=new je(t.width+200,t.height+200,25)){this.transform=t,this.grid=i,this.ignoredGrid=a,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Xi,this.screenBottomBoundary=t.height+Xi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,i,a,h,m,v,C,P,I,D,F,O){let Z=this.projectAndGetPerspectiveRatio(t.anchorPointX+P[0],t.anchorPointY+P[1],m,D,O),X=a*Z.perspectiveRatio,nt;if(v||C)nt=this._projectCollisionBox(t,X,h,m,v,C,P,Z,D,F,O);else{let It=Z.x+(F?F.x*X:0),xt=Z.y+(F?F.y*X:0);nt={allPointsOccluded:!1,box:[It+t.x1*X,xt+t.y1*X,It+t.x2*X,xt+t.y2*X]}}let[ct,dt,mt,Ct]=nt.box,yt=v?nt.allPointsOccluded:Z.isOccluded,Lt=yt;return Lt||(Lt=Z.perspectiveRatio<this.perspectiveRatioCutoff),Lt||(Lt=!this.isInsideGrid(ct,dt,mt,Ct)),Lt||i!=="always"&&this.grid.hitTest(ct,dt,mt,Ct,i,I)?{box:[ct,dt,mt,Ct],placeable:!1,offscreen:!1,occluded:yt}:{box:[ct,dt,mt,Ct],placeable:!0,offscreen:this.isOffscreen(ct,dt,mt,Ct),occluded:yt}}placeCollisionCircles(t,i,a,h,m,v,C,P,I,D,F,O,Z,X){let nt=[],ct=new u.P(i.anchorX,i.anchorY),dt=this.getPerspectiveRatio(ct.x,ct.y,v,X),mt=(I?m*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,v)/dt:m*dt)/u.aA,Ct={getElevation:X,pitchedLabelPlaneMatrix:C,lineVertexArray:a,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ct,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:Z},yt=Le(mt,h,i.lineOffsetX*mt,i.lineOffsetY*mt,!1,i,!1,Ct),Lt=!1,It=!1,xt=!0;if(yt){let Ot=.5*F*dt+O,ue=new u.P(-100,-100),te=new u.P(this.screenRightBoundary,this.screenBottomBoundary),ne=new $e,he=yt.first,Ee=yt.last,ke=[];for(let _i=he.path.length-1;_i>=1;_i--)ke.push(he.path[_i]);for(let _i=1;_i<Ee.path.length;_i++)ke.push(Ee.path[_i]);let xe=2.5*Ot;if(I){let _i=this.projectPathToScreenSpace(ke,Ct);ke=_i.some(Di=>Di.signedDistanceFromCamera<=0)?[]:_i.map(Di=>Di.point)}let Re=[];if(ke.length>0){let _i=ke[0].clone(),Di=ke[0].clone();for(let hr=1;hr<ke.length;hr++)_i.x=Math.min(_i.x,ke[hr].x),_i.y=Math.min(_i.y,ke[hr].y),Di.x=Math.max(Di.x,ke[hr].x),Di.y=Math.max(Di.y,ke[hr].y);Re=_i.x>=ue.x&&Di.x<=te.x&&_i.y>=ue.y&&Di.y<=te.y?[ke]:Di.x<ue.x||_i.x>te.x||Di.y<ue.y||_i.y>te.y?[]:u.ax([ke],ue.x,ue.y,te.x,te.y)}for(let _i of Re){ne.reset(_i,.25*Ot);let Di=0;Di=ne.length<=.5*Ot?1:Math.ceil(ne.paddedLength/xe)+1;for(let hr=0;hr<Di;hr++){let Vi=hr/Math.max(Di-1,1),cr=ne.lerp(Vi),qi=cr.x+Xi,Ui=cr.y+Xi;nt.push(qi,Ui,Ot,0);let Hi=qi-Ot,bn=Ui-Ot,ki=qi+Ot,sn=Ui+Ot;if(xt=xt&&this.isOffscreen(Hi,bn,ki,sn),It=It||this.isInsideGrid(Hi,bn,ki,sn),t!=="always"&&this.grid.hitTestCircle(qi,Ui,Ot,t,D)&&(Lt=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Lt}}}}return{circles:!P&&Lt||!It||dt<this.perspectiveRatioCutoff?[]:nt,offscreen:xt,collisionDetected:Lt}}projectPathToScreenSpace(t,i){let a=function(h,m){let v=u.L();return u.ap(v,m.pitchedLabelPlaneMatrix),h.map(C=>{let P=Ti(C.x,C.y,v,m.getElevation),I=m.transform.projectTileCoordinates(P.point.x,P.point.y,m.unwrappedTileID,m.getElevation);return I.point.x=(.5*I.point.x+.5)*m.width,I.point.y=(.5*-I.point.y+.5)*m.height,I})}(t,i);return function(h){let m=0,v=0,C=0,P=0;for(let I=0;I<h.length;I++)h[I].isOccluded?(C=I+1,P=0):(P++,P>v&&(v=P,m=C));return h.slice(m,m+v)}(a)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let i=[],a=new u.a1;for(let F of t){let O=new u.P(F.x+Xi,F.y+Xi);a.extend(O),i.push(O)}let{minX:h,minY:m,maxX:v,maxY:C}=a,P=this.grid.query(h,m,v,C).concat(this.ignoredGrid.query(h,m,v,C)),I={},D={};for(let F of P){let O=F.key;if(I[O.bucketInstanceId]===void 0&&(I[O.bucketInstanceId]={}),I[O.bucketInstanceId][O.featureIndex])continue;let Z=[new u.P(F.x1,F.y1),new u.P(F.x2,F.y1),new u.P(F.x2,F.y2),new u.P(F.x1,F.y2)];u.ay(i,Z)&&(I[O.bucketInstanceId][O.featureIndex]=!0,D[O.bucketInstanceId]===void 0&&(D[O.bucketInstanceId]=[]),D[O.bucketInstanceId].push(O.featureIndex))}return D}insertCollisionBox(t,i,a,h,m,v){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:v,overlapMode:i},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,i,a,h,m,v){let C=a?this.ignoredGrid:this.grid,P={bucketInstanceId:h,featureIndex:m,collisionGroupID:v,overlapMode:i};for(let I=0;I<t.length;I+=4)C.insertCircle(P,t[I],t[I+1],t[I+2])}projectAndGetPerspectiveRatio(t,i,a,h,m){if(m){let v;h?(v=[t,i,h(t,i),1],u.av(v,v,m)):(v=[t,i,0,1],Sn(v,v,m));let C=v[3];return{x:(v[0]/C+1)/2*this.transform.width+Xi,y:(-v[1]/C+1)/2*this.transform.height+Xi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C*.5,isOccluded:!1,signedDistanceFromCamera:C}}{let v=this.transform.projectTileCoordinates(t,i,a,h);return{x:(v.point.x+1)/2*this.transform.width+Xi,y:(1-v.point.y)/2*this.transform.height+Xi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(t,i,a,h){let m=this.transform.projectTileCoordinates(t,i,a,h);return .5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5}isOffscreen(t,i,a,h){return a<Xi||t>=this.screenRightBoundary||h<Xi||i>this.screenBottomBoundary}isInsideGrid(t,i,a,h){return a>=0&&t<this.gridRightBoundary&&h>=0&&i<this.gridBottomBoundary}getViewportMatrix(){let t=u.af([]);return u.M(t,t,[-100,-100,0]),t}_projectCollisionBox(t,i,a,h,m,v,C,P,I,D,F){let O=1,Z=0,X=0,nt=1,ct=t.anchorPointX+C[0],dt=t.anchorPointY+C[1];if(v&&!m){let ke=this.projectAndGetPerspectiveRatio(ct+1,dt,h,I,F),xe=ke.x-P.x,Re=Math.atan((ke.y-P.y)/xe)+(xe<0?Math.PI:0),_i=Math.sin(Re),Di=Math.cos(Re);O=Di,Z=_i,X=-_i,nt=Di}else if(!v&&m){let ke=Ai(this.transform);O=ke.vecEast[0],Z=ke.vecEast[1],X=ke.vecSouth[0],nt=ke.vecSouth[1]}let mt=P.x,Ct=P.y,yt=i;m&&(mt=ct,Ct=dt,yt=Math.pow(2,-(this.transform.zoom-a.overscaledZ)),yt*=this.transform.getPitchedTextCorrection(ct,dt,h),D||(yt*=u.ag(.5+P.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),D&&(mt+=O*D.x*yt+X*D.y*yt,Ct+=Z*D.x*yt+nt*D.y*yt);let Lt=t.x1*yt,It=t.x2*yt,xt=(Lt+It)/2,Ot=t.y1*yt,ue=t.y2*yt,te=(Ot+ue)/2,ne=[{offsetX:Lt,offsetY:Ot},{offsetX:xt,offsetY:Ot},{offsetX:It,offsetY:Ot},{offsetX:It,offsetY:te},{offsetX:It,offsetY:ue},{offsetX:xt,offsetY:ue},{offsetX:Lt,offsetY:ue},{offsetX:Lt,offsetY:te}],he=[];for(let{offsetX:ke,offsetY:xe}of ne)he.push(new u.P(mt+O*ke+X*xe,Ct+Z*ke+nt*xe));let Ee=!1;if(m){let ke=he.map(xe=>this.projectAndGetPerspectiveRatio(xe.x,xe.y,h,I,F));Ee=ke.some(xe=>!xe.isOccluded),he=ke.map(xe=>new u.P(xe.x,xe.y))}else Ee=!0;return{box:u.az(he),allPointsOccluded:!Ee}}}class Qo{constructor(t,i,a,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?i:-i))):h&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class vs{constructor(t,i,a,h,m){this.text=new Qo(t?t.text:null,i,a,m),this.icon=new Qo(t?t.icon:null,i,h,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ta{constructor(t,i,a){this.text=t,this.icon=i,this.skipFade=a}}class Or{constructor(t,i,a,h,m){this.bucketInstanceId=t,this.featureIndex=i,this.sourceLayerIndex=a,this.bucketIndex=h,this.tileID=m}}class zi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){let i=++this.maxGroupID;this.collisionGroups[t]={ID:i,predicate:a=>a.collisionGroupID===i}}return this.collisionGroups[t]}}function Ha(d,t,i,a,h){let{horizontalAlign:m,verticalAlign:v}=u.aG(d);return new u.P(-(m-.5)*t+a[0]*h,-(v-.5)*i+a[1]*h)}class Ro{constructor(t,i,a,h,m){this.transform=t.clone(),this.terrain=i,this.collisionIndex=new Jo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new zi(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){let i=this.terrain;return i?(a,h)=>i.getElevation(t,a,h):null}getBucketParts(t,i,a,h){let m=a.getBucket(i),v=a.latestFeatureIndex;if(!m||!v||i.id!==m.layerIds[0])return;let C=a.collisionBoxArray,P=m.layers[0].layout,I=m.layers[0].paint,D=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),F=a.tileSize/u.$,O=a.tileID.toUnwrapped(),Z=P.get("text-rotation-alignment")==="map",X=u.aB(a,1,this.transform.zoom),nt=u.aC(this.collisionIndex.transform,a,I.get("text-translate"),I.get("text-translate-anchor")),ct=u.aC(this.collisionIndex.transform,a,I.get("icon-translate"),I.get("icon-translate-anchor")),dt=Je(Z,this.transform,X);this.retainedQueryData[m.bucketInstanceId]=new Or(m.bucketInstanceId,v,m.sourceLayerIndex,m.index,a.tileID);let mt={bucket:m,layout:P,translationText:nt,translationIcon:ct,unwrappedTileID:O,pitchedLabelPlaneMatrix:dt,scale:D,textPixelRatio:F,holdingForFade:a.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:u.am(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(h)for(let Ct of m.sortKeyRanges){let{sortKey:yt,symbolInstanceStart:Lt,symbolInstanceEnd:It}=Ct;t.push({sortKey:yt,symbolInstanceStart:Lt,symbolInstanceEnd:It,parameters:mt})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:mt})}attemptAnchorPlacement(t,i,a,h,m,v,C,P,I,D,F,O,Z,X,nt,ct,dt,mt,Ct,yt){let Lt=u.aD[t.textAnchor],It=[t.textOffset0,t.textOffset1],xt=Ha(Lt,a,h,It,m),Ot=this.collisionIndex.placeCollisionBox(i,O,P,I,D,C,v,ct,F.predicate,Ct,xt,yt);if((!mt||this.collisionIndex.placeCollisionBox(mt,O,P,I,D,C,v,dt,F.predicate,Ct,xt,yt).placeable)&&Ot.placeable){let ue;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(ue=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:It,width:a,height:h,anchor:Lt,textBoxScale:m,prevAnchor:ue},this.markUsedJustification(X,Lt,Z,nt),X.allowVerticalPlacement&&(this.markUsedOrientation(X,nt,Z),this.placedOrientations[Z.crossTileID]=nt),{shift:xt,placedGlyphBoxes:Ot}}}placeLayerBucketPart(t,i,a){let{bucket:h,layout:m,translationText:v,translationIcon:C,unwrappedTileID:P,pitchedLabelPlaneMatrix:I,textPixelRatio:D,holdingForFade:F,collisionBoxArray:O,partiallyEvaluatedTextSize:Z,collisionGroup:X}=t.parameters,nt=m.get("text-optional"),ct=m.get("icon-optional"),dt=u.aE(m,"text-overlap","text-allow-overlap"),mt=dt==="always",Ct=u.aE(m,"icon-overlap","icon-allow-overlap"),yt=Ct==="always",Lt=m.get("text-rotation-alignment")==="map",It=m.get("text-pitch-alignment")==="map",xt=m.get("icon-text-fit")!=="none",Ot=m.get("symbol-z-order")==="viewport-y",ue=mt&&(yt||!h.hasIconData()||ct),te=yt&&(mt||!h.hasTextData()||nt);!h.collisionArrays&&O&&h.deserializeCollisionBoxes(O);let ne=this.retainedQueryData[h.bucketInstanceId].tileID,he=this._getTerrainElevationFunc(ne),Ee=this.transform.getFastPathSimpleProjectionMatrix(ne),ke=(xe,Re,_i)=>{var Di,hr;if(i[xe.crossTileID])return;if(F)return void(this.placements[xe.crossTileID]=new ta(!1,!1,!1));let Vi=!1,cr=!1,qi=!0,Ui=null,Hi={box:null,placeable:!1,offscreen:null,occluded:!1},bn={placeable:!1},ki=null,sn=null,wn=null,Na=0,ja=0,Ga=0;Re.textFeatureIndex?Na=Re.textFeatureIndex:xe.useRuntimeCollisionCircles&&(Na=xe.featureIndex),Re.verticalTextFeatureIndex&&(ja=Re.verticalTextFeatureIndex);let Ko=Re.textBox;if(Ko){let fs=br=>{let Qi=u.an.horizontal;if(h.allowVerticalPlacement&&!br&&this.prevPlacement){let ts=this.prevPlacement.placedOrientations[xe.crossTileID];ts&&(this.placedOrientations[xe.crossTileID]=ts,Qi=ts,this.markUsedOrientation(h,Qi,xe))}return Qi},Eo=(br,Qi)=>{if(h.allowVerticalPlacement&&xe.numVerticalGlyphVertices>0&&Re.verticalTextBox){for(let ts of h.writingModes)if(ts===u.an.vertical?(Hi=Qi(),bn=Hi):Hi=br(),Hi&&Hi.placeable)break}else Hi=br()},Za=xe.textAnchorOffsetStartIndex,pl=xe.textAnchorOffsetEndIndex;if(pl===Za){let br=(Qi,ts)=>{let $r=this.collisionIndex.placeCollisionBox(Qi,dt,D,ne,P,It,Lt,v,X.predicate,he,void 0,Ee);return $r&&$r.placeable&&(this.markUsedOrientation(h,ts,xe),this.placedOrientations[xe.crossTileID]=ts),$r};Eo(()=>br(Ko,u.an.horizontal),()=>{let Qi=Re.verticalTextBox;return h.allowVerticalPlacement&&xe.numVerticalGlyphVertices>0&&Qi?br(Qi,u.an.vertical):{box:null,offscreen:null}}),fs(Hi&&Hi.placeable)}else{let br=u.aD[(hr=(Di=this.prevPlacement)===null||Di===void 0?void 0:Di.variableOffsets[xe.crossTileID])===null||hr===void 0?void 0:hr.anchor],Qi=($r,Yu,Bh)=>{let Pu=$r.x2-$r.x1,ql=$r.y2-$r.y1,Tl=xe.textBoxScale,va=xt&&Ct==="never"?Yu:null,Cn=null,xa=dt==="never"?1:2,Su="never";br&&xa++;for(let Va=0;Va<xa;Va++){for(let ku=Za;ku<pl;ku++){let Eu=h.textAnchorOffsets.get(ku);if(br&&Eu.textAnchor!==br)continue;let Hl=this.attemptAnchorPlacement(Eu,$r,Pu,ql,Tl,Lt,It,D,ne,P,X,Su,xe,h,Bh,v,C,va,he);if(Hl&&(Cn=Hl.placedGlyphBoxes,Cn&&Cn.placeable))return Vi=!0,Ui=Hl.shift,Cn}br?br=null:Su=dt}return a&&!Cn&&(Cn={box:this.collisionIndex.placeCollisionBox(Ko,"always",D,ne,P,It,Lt,v,X.predicate,he,void 0,Ee).box,offscreen:!1,placeable:!1,occluded:!1}),Cn};Eo(()=>Qi(Ko,Re.iconBox,u.an.horizontal),()=>{let $r=Re.verticalTextBox;return h.allowVerticalPlacement&&(!Hi||!Hi.placeable)&&xe.numVerticalGlyphVertices>0&&$r?Qi($r,Re.verticalIconBox,u.an.vertical):{box:null,occluded:!0,offscreen:null}}),Hi&&(Vi=Hi.placeable,qi=Hi.offscreen);let ts=fs(Hi&&Hi.placeable);if(!Vi&&this.prevPlacement){let $r=this.prevPlacement.variableOffsets[xe.crossTileID];$r&&(this.variableOffsets[xe.crossTileID]=$r,this.markUsedJustification(h,$r.anchor,xe,ts))}}}if(ki=Hi,Vi=ki&&ki.placeable,qi=ki&&ki.offscreen,xe.useRuntimeCollisionCircles){let fs=h.text.placedSymbolArray.get(xe.centerJustifiedTextSymbolIndex),Eo=u.ao(h.textSizeData,Z,fs),Za=m.get("text-padding");sn=this.collisionIndex.placeCollisionCircles(dt,fs,h.lineVertexArray,h.glyphOffsetArray,Eo,P,I,a,It,X.predicate,xe.collisionCircleDiameter,Za,v,he),sn.circles.length&&sn.collisionDetected&&!a&&u.w("Collisions detected, but collision boxes are not shown"),Vi=mt||sn.circles.length>0&&!sn.collisionDetected,qi=qi&&sn.offscreen}if(Re.iconFeatureIndex&&(Ga=Re.iconFeatureIndex),Re.iconBox){let fs=Eo=>this.collisionIndex.placeCollisionBox(Eo,Ct,D,ne,P,It,Lt,C,X.predicate,he,xt&&Ui?Ui:void 0,Ee);bn&&bn.placeable&&Re.verticalIconBox?(wn=fs(Re.verticalIconBox),cr=wn.placeable):(wn=fs(Re.iconBox),cr=wn.placeable),qi=qi&&wn.offscreen}let Ul=nt||xe.numHorizontalGlyphVertices===0&&xe.numVerticalGlyphVertices===0,$l=ct||xe.numIconVertices===0;Ul||$l?$l?Ul||(cr=cr&&Vi):Vi=cr&&Vi:cr=Vi=cr&&Vi;let Ll=cr&&wn.placeable;if(Vi&&ki.placeable&&this.collisionIndex.insertCollisionBox(ki.box,dt,m.get("text-ignore-placement"),h.bucketInstanceId,bn&&bn.placeable&&ja?ja:Na,X.ID),Ll&&this.collisionIndex.insertCollisionBox(wn.box,Ct,m.get("icon-ignore-placement"),h.bucketInstanceId,Ga,X.ID),sn&&Vi&&this.collisionIndex.insertCollisionCircles(sn.circles,dt,m.get("text-ignore-placement"),h.bucketInstanceId,Na,X.ID),a&&this.storeCollisionData(h.bucketInstanceId,_i,Re,ki,wn,sn),xe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[xe.crossTileID]=new ta((Vi||ue)&&!ki?.occluded,(cr||te)&&!wn?.occluded,qi||h.justReloaded),i[xe.crossTileID]=!0};if(Ot){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let xe=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Re=xe.length-1;Re>=0;--Re){let _i=xe[Re];ke(h.symbolInstances.get(_i),h.collisionArrays[_i],_i)}}else for(let xe=t.symbolInstanceStart;xe<t.symbolInstanceEnd;xe++)ke(h.symbolInstances.get(xe),h.collisionArrays[xe],xe);h.justReloaded=!1}storeCollisionData(t,i,a,h,m,v){if(a.textBox||a.iconBox){let C,P;this.collisionBoxArrays.has(t)?C=this.collisionBoxArrays.get(t):(C=new Map,this.collisionBoxArrays.set(t,C)),C.has(i)?P=C.get(i):(P={text:null,icon:null},C.set(i,P)),a.textBox&&(P.text=h.box),a.iconBox&&(P.icon=m.box)}if(v){let C=this.collisionCircleArrays[t];C===void 0&&(C=this.collisionCircleArrays[t]=[]);for(let P=0;P<v.circles.length;P+=4)C.push(v.circles[P+0]-Xi),C.push(v.circles[P+1]-Xi),C.push(v.circles[P+2]),C.push(v.collisionDetected?1:0)}}markUsedJustification(t,i,a,h){let m;m=h===u.an.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[u.aF(i)];let v=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(let C of v)C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=m>=0&&C!==m?0:a.crossTileID)}markUsedOrientation(t,i,a){let h=i===u.an.horizontal||i===u.an.horizontalOnly?i:0,m=i===u.an.vertical?i:0,v=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(let C of v)t.text.placedSymbolArray.get(C).placedOrientation=h;a.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;let i=this.prevPlacement,a=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;let h=i?i.symbolFadeChange(t):1,m=i?i.opacities:{},v=i?i.variableOffsets:{},C=i?i.placedOrientations:{};for(let P in this.placements){let I=this.placements[P],D=m[P];D?(this.opacities[P]=new vs(D,h,I.text,I.icon),a=a||I.text!==D.text.placed||I.icon!==D.icon.placed):(this.opacities[P]=new vs(null,h,I.text,I.icon,I.skipFade),a=a||I.text||I.icon)}for(let P in m){let I=m[P];if(!this.opacities[P]){let D=new vs(I,h,!1,!1);D.isHidden()||(this.opacities[P]=D,a=a||I.text.placed||I.icon.placed)}}for(let P in v)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=v[P]);for(let P in C)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=C[P]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:t)}updateLayerOpacities(t,i){let a={};for(let h of i){let m=h.getBucket(t);m&&h.latestFeatureIndex&&t.id===m.layerIds[0]&&this.updateBucketOpacities(m,h.tileID,a,h.collisionBoxArray)}}updateBucketOpacities(t,i,a,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let m=t.layers[0],v=m.layout,C=new vs(null,0,!1,!1,!0),P=v.get("text-allow-overlap"),I=v.get("icon-allow-overlap"),D=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=v.get("text-rotation-alignment")==="map",O=v.get("text-pitch-alignment")==="map",Z=v.get("icon-text-fit")!=="none",X=new vs(null,0,P&&(I||!t.hasIconData()||v.get("icon-optional")),I&&(P||!t.hasTextData()||v.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);let nt=(dt,mt,Ct)=>{for(let yt=0;yt<mt/4;yt++)dt.opacityVertexArray.emplaceBack(Ct);dt.hasVisibleVertices=dt.hasVisibleVertices||Ct!==Zs},ct=this.collisionBoxArrays.get(t.bucketInstanceId);for(let dt=0;dt<t.symbolInstances.length;dt++){let mt=t.symbolInstances.get(dt),{numHorizontalGlyphVertices:Ct,numVerticalGlyphVertices:yt,crossTileID:Lt}=mt,It=this.opacities[Lt];a[Lt]?It=C:It||(It=X,this.opacities[Lt]=It),a[Lt]=!0;let xt=mt.numIconVertices>0,Ot=this.placedOrientations[mt.crossTileID],ue=Ot===u.an.vertical,te=Ot===u.an.horizontal||Ot===u.an.horizontalOnly;if(Ct>0||yt>0){let he=Ji(It.text);nt(t.text,Ct,ue?Zs:he),nt(t.text,yt,te?Zs:he);let Ee=It.text.isHidden();[mt.rightJustifiedTextSymbolIndex,mt.centerJustifiedTextSymbolIndex,mt.leftJustifiedTextSymbolIndex].forEach(Re=>{Re>=0&&(t.text.placedSymbolArray.get(Re).hidden=Ee||ue?1:0)}),mt.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(mt.verticalPlacedTextSymbolIndex).hidden=Ee||te?1:0);let ke=this.variableOffsets[mt.crossTileID];ke&&this.markUsedJustification(t,ke.anchor,mt,Ot);let xe=this.placedOrientations[mt.crossTileID];xe&&(this.markUsedJustification(t,"left",mt,xe),this.markUsedOrientation(t,xe,mt))}if(xt){let he=Ji(It.icon),Ee=!(Z&&mt.verticalPlacedIconSymbolIndex&&ue);mt.placedIconSymbolIndex>=0&&(nt(t.icon,mt.numIconVertices,Ee?he:Zs),t.icon.placedSymbolArray.get(mt.placedIconSymbolIndex).hidden=It.icon.isHidden()),mt.verticalPlacedIconSymbolIndex>=0&&(nt(t.icon,mt.numVerticalIconVertices,Ee?Zs:he),t.icon.placedSymbolArray.get(mt.verticalPlacedIconSymbolIndex).hidden=It.icon.isHidden())}let ne=ct&&ct.has(dt)?ct.get(dt):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let he=t.collisionArrays[dt];if(he){let Ee=new u.P(0,0);if(he.textBox||he.verticalTextBox){let ke=!0;if(D){let xe=this.variableOffsets[Lt];xe?(Ee=Ha(xe.anchor,xe.width,xe.height,xe.textOffset,xe.textBoxScale),F&&Ee._rotate(O?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ke=!1}if(he.textBox||he.verticalTextBox){let xe;he.textBox&&(xe=ue),he.verticalTextBox&&(xe=te),Fs(t.textCollisionBox.collisionVertexArray,It.text.placed,!ke||xe,ne.text,Ee.x,Ee.y)}}if(he.iconBox||he.verticalIconBox){let ke=!!(!te&&he.verticalIconBox),xe;he.iconBox&&(xe=ke),he.verticalIconBox&&(xe=!ke),Fs(t.iconCollisionBox.collisionVertexArray,It.icon.placed,xe,ne.icon,Z?Ee.x:0,Z?Ee.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,i){let a=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*a>t}setStale(){this.stale=!0}}function Fs(d,t,i,a,h,m){a&&a.length!==0||(a=[0,0,0,0]);let v=a[0]-Xi,C=a[1]-Xi,P=a[2]-Xi,I=a[3]-Xi;d.emplaceBack(t?1:0,i?1:0,h||0,m||0,v,C),d.emplaceBack(t?1:0,i?1:0,h||0,m||0,P,C),d.emplaceBack(t?1:0,i?1:0,h||0,m||0,P,I),d.emplaceBack(t?1:0,i?1:0,h||0,m||0,v,I)}let yi=Math.pow(2,25),Si=Math.pow(2,24),ea=Math.pow(2,17),Ns=Math.pow(2,16),js=Math.pow(2,9),Gs=Math.pow(2,8),hi=Math.pow(2,1);function Ji(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;let t=d.placed?1:0,i=Math.floor(127*d.opacity);return i*yi+t*Si+i*ea+t*Ns+i*js+t*Gs+i*hi+t}let Zs=0;class Ta{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,i,a,h,m){let v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(i.getBucketParts(v,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((C,P)=>C.sortKey-P.sortKey));this._currentPartIndex<v.length;)if(i.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,m())return!0;return!1}}class dn{constructor(t,i,a,h,m,v,C,P){this.placement=new Ro(t,i,v,C,P),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,i,a){let h=re.now(),m=()=>!this._forceFullPlacement&&re.now()-h>2;for(;this._currentPlacementIndex>=0;){let v=i[t[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=C)&&(!v.maxzoom||v.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Ta(v)),this._inProgressLayer.continuePlacement(a[v.source],this.placement,this._showCollisionBoxes,v,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}let Oo=512/u.$/2;class Fo{constructor(t,i,a){this.tileID=t,this.bucketInstanceId=a,this._symbolsByKey={};let h=new Map;for(let m=0;m<i.length;m++){let v=i.get(m),C=v.key,P=h.get(C);P?P.push(v):h.set(C,[v])}for(let[m,v]of h){let C={positions:v.map(P=>({x:Math.floor(P.anchorX*Oo),y:Math.floor(P.anchorY*Oo)})),crossTileIDs:v.map(P=>P.crossTileID)};if(C.positions.length>128){let P=new u.aH(C.positions.length,16,Uint16Array);for(let{x:I,y:D}of C.positions)P.add(I,D);P.finish(),delete C.positions,C.index=P}this._symbolsByKey[m]=C}}getScaledCoordinates(t,i){let{x:a,y:h,z:m}=this.tileID.canonical,{x:v,y:C,z:P}=i.canonical,I=Oo/Math.pow(2,P-m),D=(C*u.$+t.anchorY)*I,F=h*u.$*Oo;return{x:Math.floor((v*u.$+t.anchorX)*I-a*u.$*Oo),y:Math.floor(D-F)}}findMatches(t,i,a){let h=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let m=0;m<t.length;m++){let v=t.get(m);if(v.crossTileID)continue;let C=this._symbolsByKey[v.key];if(!C)continue;let P=this.getScaledCoordinates(v,i);if(C.index){let I=C.index.range(P.x-h,P.y-h,P.x+h,P.y+h).sort();for(let D of I){let F=C.crossTileIDs[D];if(!a[F]){a[F]=!0,v.crossTileID=F;break}}}else if(C.positions)for(let I=0;I<C.positions.length;I++){let D=C.positions[I],F=C.crossTileIDs[I];if(Math.abs(D.x-P.x)<=h&&Math.abs(D.y-P.y)<=h&&!a[F]){a[F]=!0,v.crossTileID=F;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class xs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class er{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){let i=Math.round((t-this.lng)/360);if(i!==0)for(let a in this.indexes){let h=this.indexes[a],m={};for(let v in h){let C=h[v];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+i),m[C.tileID.key]=C}this.indexes[a]=m}this.lng=t}addBucket(t,i,a){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let m=0;m<i.symbolInstances.length;m++)i.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});let h=this.usedCrossTileIDs[t.overscaledZ];for(let m in this.indexes){let v=this.indexes[m];if(Number(m)>t.overscaledZ)for(let C in v){let P=v[C];P.tileID.isChildOf(t)&&P.findMatches(i.symbolInstances,t,h)}else{let C=v[t.scaledTo(Number(m)).key];C&&C.findMatches(i.symbolInstances,t,h)}}for(let m=0;m<i.symbolInstances.length;m++){let v=i.symbolInstances.get(m);v.crossTileID||(v.crossTileID=a.generate(),h[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Fo(t,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(t,i){for(let a of i.getCrossTileIDsLists())for(let h of a)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let i=!1;for(let a in this.indexes){let h=this.indexes[a];for(let m in h)t[h[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,h[m]),delete h[m],i=!0)}return i}}class os{constructor(){this.layerIndexes={},this.crossTileIDs=new xs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,i,a){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new er);let m=!1,v={};h.handleWrapJump(a);for(let C of i){let P=C.getBucket(t);P&&t.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(C.tileID,P,this.crossTileIDs)&&(m=!0),v[P.bucketInstanceId]=!0)}return h.removeStaleBuckets(v)&&(m=!0),m}pruneUnusedLayers(t){let i={};t.forEach(a=>{i[a]=!0});for(let a in this.layerIndexes)i[a]||delete this.layerIndexes[a]}}var Vs="void main() {fragColor=vec4(1.0);}";let Xr={prelude:ci(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ci("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ci("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ci(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ci(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ci(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ci(Vs,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ci(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ci(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ci("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ci("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ci(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(textureSize(u_elevation_stops,0)[0]);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int num_elevation_stops=textureSize(u_elevation_stops,0)[0];int r=(num_elevation_stops-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(textureSize(u_color_stops,0)[0]);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ci(Vs,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ci(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ci(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ci(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ci(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ci(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ci(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ci(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ci(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:
basic_hillshade(deriv);break;case COMBINED:
combined_hillshade(deriv);break;case IGOR:
igor_hillshade(deriv);break;case MULTIDIRECTIONAL:
multidirectional_hillshade(deriv);break;case STANDARD:
default:
standard_hillshade(deriv);break;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ci(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ci(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ci(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ci(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ci(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ci(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ci(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ci(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ci("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ci("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ci("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ci("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ci(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ci("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ci(d,t){let i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/in ([\w]+) ([\w]+)/g),h=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=m?m.concat(h):h,C={};return{fragmentSource:d=d.replace(i,(P,I,D,F,O)=>(C[O]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${D} ${F} ${O};
#else
uniform ${D} ${F} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${D} ${F} ${O} = u_${O};
#endif
`)),vertexSource:t=t.replace(i,(P,I,D,F,O)=>{let Z=F==="float"?"vec2":"vec4",X=O.match(/color/)?"color":Z;return C[O]?I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${D} ${Z} a_${O};
out ${D} ${F} ${O};
#else
uniform ${D} ${F} u_${O};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${D} ${F} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${X}(a_${O}, u_${O}_t);
#else
    ${D} ${F} ${O} = u_${O};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${D} ${Z} a_${O};
#else
uniform ${D} ${F} u_${O};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${D} ${F} ${O} = a_${O};
#else
    ${D} ${F} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${D} ${F} ${O} = unpack_mix_${X}(a_${O}, u_${O}_t);
#else
    ${D} ${F} ${O} = u_${O};
#endif
`}),staticAttributes:a,staticUniforms:v}}class fn{constructor(t,i,a){this.vertexBuffer=t,this.indexBuffer=i,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var qn=u.aI([{name:"a_pos",type:"Int16",components:2}]);let as="#define PROJECTION_MERCATOR",No="mercator";class ia{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return No}get shaderDefine(){return as}get shaderPreludeCode(){return Xr.projectionMercator}get vertexShaderPreludeCode(){return Xr.projectionMercator.vertexSource}get subdivisionGranularity(){return u.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,i,a,h,m){if(this._cachedMesh)return this._cachedMesh;let v=new u.aK;v.emplaceBack(0,0),v.emplaceBack(u.$,0),v.emplaceBack(0,u.$),v.emplaceBack(u.$,u.$);let C=t.createVertexBuffer(v,qn.members),P=u.aL.simpleSegment(0,0,4,2),I=new u.aM;I.emplaceBack(1,0,2),I.emplaceBack(1,2,3);let D=t.createIndexBuffer(I);return this._cachedMesh=new fn(C,D,P),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Yr{constructor(t=0,i=0,a=0,h=0){if(isNaN(t)||t<0||isNaN(i)||i<0||isNaN(a)||a<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=i,this.left=a,this.right=h}interpolate(t,i,a){return i.top!=null&&t.top!=null&&(this.top=u.C.number(t.top,i.top,a)),i.bottom!=null&&t.bottom!=null&&(this.bottom=u.C.number(t.bottom,i.bottom,a)),i.left!=null&&t.left!=null&&(this.left=u.C.number(t.left,i.left,a)),i.right!=null&&t.right!=null&&(this.right=u.C.number(t.right,i.right,a)),this}getCenter(t,i){let a=u.ag((this.left+t-this.right)/2,0,t),h=u.ag((this.top+i-this.bottom)/2,0,i);return new u.P(a,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Yr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function kn(d,t){if(!d.renderWorldCopies||d.lngRange)return;let i=t.lng-d.center.lng;t.lng+=i>180?-360:i<-180?360:0}function di(d){return Math.max(0,Math.floor(d))}class so{constructor(t,i,a,h,m,v){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=h??0,this._maxPitch=m??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new u.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=di(this._zoom),this._scale=u.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Yr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,i,a){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=di(this._zoom),this._scale=u.ae(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Yr(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!a&&t.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){let i=u.aN(t,-180,180)*Math.PI/180;var a,h,m,v,C,P,I,D,F;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=Qt(),a=this._rotationMatrix,m=-this._bearingInRadians,v=(h=this._rotationMatrix)[0],C=h[1],P=h[2],I=h[3],D=Math.sin(m),F=Math.cos(m),a[0]=v*F+P*D,a[1]=C*F+I*D,a[2]=v*-D+P*F,a[3]=C*-D+I*F)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){let i=u.ag(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){let i=t/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return u.aO(this._fovInRadians)}setFov(t){t=u.ag(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=u.ad(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){let i=this.getConstrained(this._center,t).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=u.ae(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,i){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,i,a){this._unmodified=!1,this._edgeInsets.interpolate(t,i,a),this._constrain(),this._calcMatrices()}resize(t,i,a=!0){this._width=t,this._height=i,a&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new ji([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,u.ah])}getConstrained(t,i){return this._callbacks.getConstrained(t,i)}getCameraQueryGeometry(t,i){if(i.length===1)return[i[0],t];{let{minX:a,minY:h,maxX:m,maxY:v}=u.a1.fromPoints(i).extend(t);return[new u.P(a,h),new u.P(m,h),new u.P(m,v),new u.P(a,v),new u.P(a,h)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let t=this._unmodified,{center:i,zoom:a}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(a),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=u.af(new Float64Array(16));u.N(t,t,[this._width/2,-this._height/2,1]),u.M(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=u.af(new Float64Array(16)),u.N(t,t,[1,-1,1]),u.M(t,t,[-1,-1,0]),u.N(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,i,a,h){let m=a!==void 0?a:this.bearing,v=h=h!==void 0?h:this.pitch,C=u.a0.fromLngLat(t,i),P=-Math.cos(u.ad(v)),I=Math.sin(u.ad(v)),D=I*Math.sin(u.ad(m)),F=-I*Math.cos(u.ad(m)),O=this.elevation,Z=i-O,X;P*Z>=0||Math.abs(P)<.1?(X=1e4,O=i+X*P):X=-Z/P;let nt,ct,dt=u.aP(1,C.y),mt=0;do{if(mt+=1,mt>10)break;ct=X/dt,nt=new u.a0(C.x+D*ct,C.y+F*ct),dt=1/nt.meterInMercatorCoordinateUnits()}while(Math.abs(X-ct*dt)>1e-12);return{center:nt.toLngLat(),elevation:O,zoom:u.aj(this.height/2/Math.tan(this.fovInRadians/2)/ct/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;let i=u.ai(1,this.center.lat)*this.worldSize,a=this.cameraToCenterDistance/i,h=u.a0.fromLngLat(this.center,this.elevation),m=vt(this.center,this.elevation,this.pitch,this.bearing,a);this._elevation=t;let v=this.calculateCenterFromCameraLngLatAlt(m.toLngLat(),u.aP(m.z,h.y),this.bearing,this.pitch);this._elevation=v.elevation,this._center=v.center,this.setZoom(v.zoom)}getCameraPoint(){let t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let t=u.ai(1,this.center.lat)*this.worldSize;return vt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];let i=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/i,t.canonical.y/i,1/i/u.$,1/i/u.$]}}class Pa{constructor(t,i){this.min=t,this.max=i,this.center=u.aQ([],u.aR([],this.min,this.max),.5)}quadrant(t){let i=[t%2==0,t<2],a=u.aS(this.min),h=u.aS(this.max);for(let m=0;m<i.length;m++)a[m]=i[m]?this.min[m]:this.center[m],h[m]=i[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new Pa(a,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let i=!0;for(let a=0;a<t.planes.length;a++){let h=this.intersectsPlane(t.planes[a]);if(h===0)return 0;h===1&&(i=!1)}return i?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let i=t[3],a=t[3];for(let h=0;h<3;h++)t[h]>0?(i+=t[h]*this.min[h],a+=t[h]*this.max[h]):(a+=t[h]*this.min[h],i+=t[h]*this.max[h]);return i>=0?2:a<0?0:1}}class oi{distanceToTile2d(t,i,a,h){let m=h.distanceX([t,i]),v=h.distanceY([t,i]);return Math.hypot(m,v)}getWrap(t,i,a){return a}getTileBoundingVolume(t,i,a,h){var m,v;let C=a,P=a;if(h?.terrain){let D=new u.Z(t.z,i,t.z,t.x,t.y),F=h.terrain.getMinMaxElevation(D);C=(m=F.minElevation)!==null&&m!==void 0?m:a,P=(v=F.maxElevation)!==null&&v!==void 0?v:a}let I=1<<t.z;return new Pa([i+t.x/I,t.y/I,C],[i+(t.x+1)/I,(t.y+1)/I,P])}allowVariableZoom(t,i){let a=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,h=u.ag(78.5-a/2,0,60);return!!i.terrain||t.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class Zi{constructor(t,i,a){this.points=t,this.planes=i,this.aabb=a}static fromInvProjectionMatrix(t,i=1,a=0,h,m){let v=m?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],C=Math.pow(2,a),P=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>function(Z,X,nt,ct){let dt=u.av([],Z,X),mt=1/dt[3]/nt*ct;return u.aX(dt,dt,[mt,mt,1/dt[3],mt])}(O,t,i,C));h&&function(O,Z,X,nt){let ct=nt?4:0,dt=nt?0:4,mt=0,Ct=[],yt=[];for(let xt=0;xt<4;xt++){let Ot=u.aT([],O[xt+dt],O[xt+ct]),ue=u.aY(Ot);u.aQ(Ot,Ot,1/ue),Ct.push(ue),yt.push(Ot)}for(let xt=0;xt<4;xt++){let Ot=u.aZ(O[xt+ct],yt[xt],X);mt=Ot!==null&&Ot>=0?Math.max(mt,Ot):Math.max(mt,Ct[xt])}let Lt=function(xt,Ot){let ue=u.aT([],xt[Ot[0]],xt[Ot[1]]),te=u.aT([],xt[Ot[2]],xt[Ot[1]]),ne=[0,0,0,0];return u.aU(ne,u.aV([],ue,te)),ne[3]=-u.aW(ne,xt[Ot[0]]),ne}(O,Z),It=function(xt,Ot){let ue=u.a_(xt),te=u.a$([],xt,1/ue),ne=u.aT([],Ot,u.aQ([],te,u.aW(Ot,te))),he=u.a_(ne);if(he>0){let Ee=Math.sqrt(1-te[3]*te[3]),ke=u.aQ([],te,-te[3]),xe=u.aR([],ke,u.aQ([],ne,Ee/he));return u.b0(Ot,xe)}return null}(X,Lt);if(It!==null){let xt=It/u.aW(yt[0],Lt);mt=Math.min(mt,xt)}for(let xt=0;xt<4;xt++){let Ot=Math.min(mt,Ct[xt]);O[xt+dt]=[O[xt+ct][0]+yt[xt][0]*Ot,O[xt+ct][1]+yt[xt][1]*Ot,O[xt+ct][2]+yt[xt][2]*Ot,1]}}(P,v[0],h,m);let I=v.map(O=>{let Z=u.aT([],P[O[0]],P[O[1]]),X=u.aT([],P[O[2]],P[O[1]]),nt=u.aU([],u.aV([],Z,X)),ct=-u.aW(nt,P[O[1]]);return nt.concat(ct)}),D=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],F=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let O of P)for(let Z=0;Z<3;Z++)D[Z]=Math.min(D[Z],O[Z]),F[Z]=Math.max(F[Z],O[Z]);return new Zi(P,I,new Pa(D,F))}}class ii{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,i,a){return this._helper.interpolatePadding(t,i,a)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,i,a=!0){this._helper.resize(t,i,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,i){this._helper.overrideNearFarZ(t,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,i){}constructor(t,i,a,h,m){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new so({calcMatrices:()=>{this._calcMatrices()},getConstrained:(v,C)=>this.getConstrained(v,C)},t,i,a,h,m),this._coveringTilesDetailsProvider=new oi}clone(){let t=new ii;return t.apply(this),t}apply(t,i,a){this._helper.apply(t,i,a)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){let i=[new u.b1(0,t)];if(this._helper._renderWorldCopies){let a=this.screenPointToMercatorCoordinate(new u.P(0,0)),h=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,0)),m=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new u.P(0,this._helper._height)),C=Math.floor(Math.min(a.x,h.x,m.x,v.x)),P=Math.floor(Math.max(a.x,h.x,m.x,v.x)),I=1;for(let D=C-I;D<=P+I;D++)D!==0&&i.push(new u.b1(D,t))}return i}getCameraFrustum(){return Zi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){let i=this.screenPointToLocation(this.centerPoint,t),a=t?t.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(a)}setLocationAtPoint(t,i){let a=u.ai(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(i,a),m=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,a),v=u.a0.fromLngLat(t),C=new u.a0(v.x-(h.x-m.x),v.y-(h.y-m.y));this.setCenter(C?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,i){return i?this.coordinatePoint(u.a0.fromLngLat(t),i.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(u.a0.fromLngLat(t))}screenPointToLocation(t,i){var a;return(a=this.screenPointToMercatorCoordinate(t,i))===null||a===void 0?void 0:a.toLngLat()}screenPointToMercatorCoordinate(t,i){if(i){let a=i.pointCoordinate(t);if(a!=null)return a}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,i){let a=i||0,h=[t.x,t.y,0,1],m=[t.x,t.y,1,1];u.av(h,h,this._pixelMatrixInverse),u.av(m,m,this._pixelMatrixInverse);let v=h[3],C=m[3],P=h[1]/v,I=m[1]/C,D=h[2]/v,F=m[2]/C,O=D===F?0:(a-D)/(F-D);return new u.a0(u.C.number(h[0]/v,m[0]/C,O)/this.worldSize,u.C.number(P,I,O)/this.worldSize,a)}coordinatePoint(t,i=0,a=this._pixelMatrix){let h=[t.x*this.worldSize,t.y*this.worldSize,i,1];return u.av(h,h,a),new u.P(h[0]/h[3],h[1]/h[3])}getBounds(){let t=Math.max(0,this._helper._height/2-tt(this));return new ji().extend(this.screenPointToLocation(new u.P(0,t))).extend(this.screenPointToLocation(new u.P(this._helper._width,t))).extend(this.screenPointToLocation(new u.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new u.P(0,this._helper._height)))}isPointOnMapSurface(t,i){return i?i.pointCoordinate(t)!=null:t.y>this.height/2-tt(this)}calculatePosMatrix(t,i=!1,a){var h;let m=(h=t.key)!==null&&h!==void 0?h:u.b2(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),v=i?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(m)){let I=v.get(m);return a?I.f32:I.f64}let C=lt(t,this.worldSize);u.O(C,i?this._alignedProjMatrix:this._viewProjMatrix,C);let P={f64:C,f32:new Float32Array(C)};return v.set(m,P),a?P.f32:P.f64}calculateFogMatrix(t){let i=t.key,a=this._fogMatrixCacheF32;if(a.has(i))return a.get(i);let h=lt(t,this.worldSize);return u.O(h,this._fogMatrix,h),a.set(i,new Float32Array(h)),a.get(i)}getConstrained(t,i){i=u.ag(+i,this.minZoom,this.maxZoom);let a={center:new u.S(t.lng,t.lat),zoom:i},h=this._helper._lngRange;this._helper._renderWorldCopies||h!==null||(h=[-179.9999999999,180-1e-10]);let m=this.tileSize*u.ae(a.zoom),v=0,C=m,P=0,I=m,D=0,F=0,{x:O,y:Z}=this.size;if(this._helper._latRange){let Ct=this._helper._latRange;v=u.U(Ct[1])*m,C=u.U(Ct[0])*m,C-v<Z&&(D=Z/(C-v))}h&&(P=u.aN(u.V(h[0])*m,0,m),I=u.aN(u.V(h[1])*m,0,m),I<P&&(I+=m),I-P<O&&(F=O/(I-P)));let{x:X,y:nt}=Gt(m,t),ct,dt,mt=Math.max(F||0,D||0);if(mt){let Ct=new u.P(F?(I+P)/2:X,D?(C+v)/2:nt);return a.center=J(m,Ct).wrap(),a.zoom+=u.aj(mt),a}if(this._helper._latRange){let Ct=Z/2;nt-Ct<v&&(dt=v+Ct),nt+Ct>C&&(dt=C-Ct)}if(h){let Ct=(P+I)/2,yt=X;this._helper._renderWorldCopies&&(yt=u.aN(X,Ct-m/2,Ct+m/2));let Lt=O/2;yt-Lt<P&&(ct=P+Lt),yt+Lt>I&&(ct=I-Lt)}if(ct!==void 0||dt!==void 0){let Ct=new u.P(ct??X,dt??nt);a.center=J(m,Ct).wrap()}return a}calculateCenterFromCameraLngLatAlt(t,i,a,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,i,a,h)}_calculateNearFarZIfNeeded(t,i,a){if(!this._helper.autoCalculateNearFarZ)return;let h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),m=t-h*this._helper._pixelPerMeter/Math.cos(i),v=h<0?m:t,C=Math.PI/2+this.pitchInRadians,P=u.ad(this.fov)*(Math.abs(Math.cos(u.ad(this.roll)))*this.height+Math.abs(Math.sin(u.ad(this.roll)))*this.width)/this.height*(.5+a.y/this.height),I=Math.sin(P)*v/Math.sin(u.ag(Math.PI-C-P,.01,Math.PI-.01)),D=tt(this),F=Math.atan(D/this._helper.cameraToCenterDistance),O=u.ad(.75),Z=F>O?2*F*(.5+a.y/(2*D)):O,X=Math.sin(Z)*v/Math.sin(u.ag(Math.PI-C-Z,.01,Math.PI-.01)),nt=Math.min(I,X);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*nt+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let t=this.centerOffset,i=Gt(this.worldSize,this.center),a=i.x,h=i.y;this._helper._pixelPerMeter=u.ai(1,this.center.lat)*this.worldSize;let m=u.ad(Math.min(this.pitch,Un)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(m)),C;this._calculateNearFarZIfNeeded(v,m,t),C=new Float64Array(16),u.b3(C,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),u.ap(this._invProjMatrix,C),C[8]=2*-t.x/this._helper._width,C[9]=2*t.y/this._helper._height,this._projectionMatrix=u.b4(C),u.N(C,C,[1,-1,1]),u.M(C,C,[0,0,-this._helper.cameraToCenterDistance]),u.b5(C,C,-this.rollInRadians),u.b6(C,C,this.pitchInRadians),u.b5(C,C,-this.bearingInRadians),u.M(C,C,[-a,-h,0]),this._mercatorMatrix=u.N([],C,[this.worldSize,this.worldSize,this.worldSize]),u.N(C,C,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=u.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,C),u.M(C,C,[0,0,-this.elevation]),this._viewProjMatrix=C,this._invViewProjMatrix=u.ap([],C);let P=[0,0,-1,1];u.av(P,P,this._invViewProjMatrix),this._cameraPosition=[P[0]/P[3],P[1]/P[3],P[2]/P[3]],this._fogMatrix=new Float64Array(16),u.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,u.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),u.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),u.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),u.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),u.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),u.M(this._fogMatrix,this._fogMatrix,[-a,-h,0]),u.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),u.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=u.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,C);let I=this._helper._width%2/2,D=this._helper._height%2/2,F=Math.cos(this.bearingInRadians),O=Math.sin(-this.bearingInRadians),Z=a-Math.round(a)+F*I+O*D,X=h-Math.round(h)+F*D+O*I,nt=new Float64Array(C);if(u.M(nt,nt,[Z>.5?Z-1:Z,X>.5?X-1:X,0]),this._alignedProjMatrix=nt,C=u.ap(new Float64Array(16),this._pixelMatrix),!C)throw new Error("failed to invert matrix");this._pixelMatrixInverse=C,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let t=this.screenPointToMercatorCoordinate(new u.P(0,0)),i=[t.x*this.worldSize,t.y*this.worldSize,0,1];return u.av(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let t=u.ai(1,this.center.lat)*this.worldSize;return vt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,i){let a=u.a0.fromLngLat(t),h=[a.x*this.worldSize,a.y*this.worldSize,i,1];return u.av(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(t){let{overscaledTileID:i,aligned:a,applyTerrainMatrix:h}=t,m=this._helper.getMercatorTileCoordinates(i),v=i?this.calculatePosMatrix(i,a,!0):null,C;return C=i&&i.terrainRttPosMatrix32f&&h?i.terrainRttPosMatrix32f:v||u.b7(),{mainMatrix:C,tileMercatorCoords:m,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:C}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,i,a){return 1}transformLightDirection(t){return u.aS(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,i,a,h){let m=this.calculatePosMatrix(a),v;h?(v=[t,i,h(t,i),1],u.av(v,v,m)):(v=[t,i,0,1],Sn(v,v,m));let C=v[3];return{point:new u.P(v[0]/C,v[1]/C),signedDistanceFromCamera:C,isOccluded:!1}}populateCache(t){for(let i of t)this.calculatePosMatrix(i)}getMatrixForModel(t,i){let a=u.a0.fromLngLat(t,i),h=a.meterInMercatorCoordinateUnits(),m=u.b8();return u.M(m,m,[a.x,a.y,a.z]),u.b5(m,m,Math.PI),u.b6(m,m,Math.PI/2),u.N(m,m,[-h,h,h]),m}getProjectionDataForCustomLayer(t=!0){let i=new u.Z(0,0,0,0,0),a=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:t}),h=lt(i,this.worldSize);u.O(h,this._viewProjMatrix,h),a.tileMercatorCoords=[0,0,1,1];let m=[u.$,u.$,this.worldSize/this._helper.pixelsPerMeter],v=u.b9();return u.N(v,h,m),a.fallbackMatrix=v,a.mainMatrix=v,a}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Cr(){u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function or(d){if(d.useSlerp)if(d.k<1){let t=u.ba(d.startEulerAngles.roll,d.startEulerAngles.pitch,d.startEulerAngles.bearing),i=u.ba(d.endEulerAngles.roll,d.endEulerAngles.pitch,d.endEulerAngles.bearing),a=new Float64Array(4);u.bb(a,t,i,d.k);let h=u.bc(a);d.tr.setRoll(h.roll),d.tr.setPitch(h.pitch),d.tr.setBearing(h.bearing)}else d.tr.setRoll(d.endEulerAngles.roll),d.tr.setPitch(d.endEulerAngles.pitch),d.tr.setBearing(d.endEulerAngles.bearing);else d.tr.setRoll(u.C.number(d.startEulerAngles.roll,d.endEulerAngles.roll,d.k)),d.tr.setPitch(u.C.number(d.startEulerAngles.pitch,d.endEulerAngles.pitch,d.k)),d.tr.setBearing(u.C.number(d.startEulerAngles.bearing,d.endEulerAngles.bearing,d.k))}function Fi(d,t,i,a,h){let m=h.padding,v=Gt(h.worldSize,i.getNorthWest()),C=Gt(h.worldSize,i.getNorthEast()),P=Gt(h.worldSize,i.getSouthEast()),I=Gt(h.worldSize,i.getSouthWest()),D=u.ad(-a),F=v.rotate(D),O=C.rotate(D),Z=P.rotate(D),X=I.rotate(D),nt=new u.P(Math.max(F.x,O.x,X.x,Z.x),Math.max(F.y,O.y,X.y,Z.y)),ct=new u.P(Math.min(F.x,O.x,X.x,Z.x),Math.min(F.y,O.y,X.y,Z.y)),dt=nt.sub(ct),mt=(h.width-(m.left+m.right+t.left+t.right))/dt.x,Ct=(h.height-(m.top+m.bottom+t.top+t.bottom))/dt.y;if(Ct<0||mt<0)return void Cr();let yt=Math.min(u.aj(h.scale*Math.min(mt,Ct)),d.maxZoom),Lt=u.P.convert(d.offset),It=new u.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(u.ad(a)),xt=Lt.add(It).mult(h.scale/u.ae(yt));return{center:J(h.worldSize,v.add(P).div(2).sub(xt)),zoom:yt,bearing:a}}class jo{get useGlobeControls(){return!1}handlePanInertia(t,i){return{easingOffset:t,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(t,i){t.bearingDelta&&i.setBearing(i.bearing+t.bearingDelta),t.pitchDelta&&i.setPitch(i.pitch+t.pitchDelta),t.rollDelta&&i.setRoll(i.roll+t.rollDelta),t.zoomDelta&&i.setZoom(i.zoom+t.zoomDelta)}handleMapControlsPan(t,i,a){t.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(a,t.around)}cameraForBoxAndBearing(t,i,a,h,m){return Fi(t,i,a,h,m)}handleJumpToCenterZoom(t,i){t.zoom!==(i.zoom!==void 0?+i.zoom:t.zoom)&&t.setZoom(+i.zoom),i.center!==void 0&&t.setCenter(u.S.convert(i.center))}handleEaseTo(t,i){let a=t.zoom,h=t.padding,m={roll:t.roll,pitch:t.pitch,bearing:t.bearing},v={roll:i.roll===void 0?t.roll:i.roll,pitch:i.pitch===void 0?t.pitch:i.pitch,bearing:i.bearing===void 0?t.bearing:i.bearing},C=i.zoom!==void 0,P=!t.isPaddingEqual(i.padding),I=!1,D=C?+i.zoom:t.zoom,F=t.centerPoint.add(i.offsetAsPoint),O=t.screenPointToLocation(F),{center:Z,zoom:X}=t.getConstrained(u.S.convert(i.center||O),D??a);kn(t,Z);let nt=Gt(t.worldSize,O),ct=Gt(t.worldSize,Z).sub(nt),dt=u.ae(X-a);return I=X!==a,{easeFunc:mt=>{if(I&&t.setZoom(u.C.number(a,X,mt)),u.bd(m,v)||or({startEulerAngles:m,endEulerAngles:v,tr:t,k:mt,useSlerp:m.roll!=v.roll}),P&&(t.interpolatePadding(h,i.padding,mt),F=t.centerPoint.add(i.offsetAsPoint)),i.around)t.setLocationAtPoint(i.around,i.aroundPoint);else{let Ct=u.ae(t.zoom-a),yt=X>a?Math.min(2,dt):Math.max(.5,dt),Lt=Math.pow(yt,1-mt),It=J(t.worldSize,nt.add(ct.mult(mt*Lt)).mult(Ct));t.setLocationAtPoint(t.renderWorldCopies?It.wrap():It,F)}},isZooming:I,elevationCenter:Z}}handleFlyTo(t,i){let a=i.zoom!==void 0,h=t.zoom,m=t.getConstrained(u.S.convert(i.center||i.locationAtOffset),a?+i.zoom:h),v=m.center,C=m.zoom;kn(t,v);let P=Gt(t.worldSize,i.locationAtOffset),I=Gt(t.worldSize,v).sub(P),D=I.mag(),F=u.ae(C-h),O;if(i.minZoom!==void 0){let Z=Math.min(+i.minZoom,h,C),X=t.getConstrained(v,Z).zoom;O=u.ae(X-h)}return{easeFunc:(Z,X,nt,ct)=>{t.setZoom(Z===1?C:h+u.aj(X));let dt=Z===1?v:J(t.worldSize,P.add(I.mult(nt)).mult(X));t.setLocationAtPoint(t.renderWorldCopies?dt.wrap():dt,ct)},scaleOfZoom:F,targetCenter:v,scaleOfMinZoom:O,pixelPathLength:D}}}class ai{constructor(t,i,a){this.blendFunction=t,this.blendColor=i,this.mask=a}}ai.Replace=[1,0],ai.disabled=new ai(ai.Replace,u.be.transparent,[!1,!1,!1,!1]),ai.unblended=new ai(ai.Replace,u.be.transparent,[!0,!0,!0,!0]),ai.alphaBlended=new ai([1,771],u.be.transparent,[!0,!0,!0,!0]);let ir=2305;class Qe{constructor(t,i,a){this.enable=t,this.mode=i,this.frontFace=a}}Qe.disabled=new Qe(!1,1029,ir),Qe.backCCW=new Qe(!0,1029,ir),Qe.frontCCW=new Qe(!0,1028,ir);class Ve{constructor(t,i,a){this.func=t,this.mask=i,this.range=a}}Ve.ReadOnly=!1,Ve.ReadWrite=!0,Ve.disabled=new Ve(519,Ve.ReadOnly,[0,1]);let mn=7680;class He{constructor(t,i,a,h,m,v){this.test=t,this.ref=i,this.mask=a,this.fail=h,this.depthFail=m,this.pass=v}}He.disabled=new He({func:519,mask:0},0,0,mn,mn,mn);let Us=new WeakMap;function Fr(d){var t;if(Us.has(d))return Us.get(d);{let i=(t=d.getParameter(d.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Us.set(d,i),i}}class oo{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;let i=t.context,a=i.gl;this._texFormat=a.RGBA,this._texType=a.UNSIGNED_BYTE;let h=new u.aK;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);let m=new u.aM;m.emplaceBack(0,1,2),this._fullscreenTriangle=new fn(i.createVertexBuffer(h,qn.members),i.createIndexBuffer(m),u.aL.simpleSegment(0,0,h.length,m.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(a.TEXTURE1);let v=a.createTexture();a.bindTexture(a.TEXTURE_2D,v),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),Fr(a)&&(this._pbo=a.createBuffer(),a.bindBuffer(a.PIXEL_PACK_BUFFER,this._pbo),a.bufferData(a.PIXEL_PACK_BUFFER,4,a.STREAM_READ),a.bindBuffer(a.PIXEL_PACK_BUFFER,null))}destroy(){let t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,i){let a=this._updateCount;return this._readbackQueue?a>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():a>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,i),this._updateCount++,this._measuredError}_bindFramebuffer(){let t=this._cachedRenderContext.context,i=t.gl;t.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,i){let a=this._cachedRenderContext.context,h=a.gl;if(this._bindFramebuffer(),a.viewport.set([0,0,this._texWidth,this._texHeight]),a.clear({color:u.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(a,h.TRIANGLES,Ve.disabled,He.disabled,ai.unblended,Qe.disabled,((m,v)=>({u_input:m,u_output_expected:v}))(t,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Fr(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);let m=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:m}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Fr(t)){let i=t.clientWaitSync(this._readbackQueue.sync,0,0);if(i===t.WAIT_FAILED)return u.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=oo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let i=0;return i+=t[0]/256,i+=t[1]/65536,i+=t[2]/16777216,t[3]<127&&(i=-i),i/128}}let Jr=u.$/128;function Wa(d,t){let i=d.granularity!==void 0?Math.max(d.granularity,1):1,a=i+(d.generateBorders?2:0),h=i+(d.extendToNorthPole||d.generateBorders?1:0)+(d.extendToSouthPole||d.generateBorders?1:0),m=a+1,v=h+1,C=d.generateBorders?-1:0,P=d.generateBorders||d.extendToNorthPole?-1:0,I=i+(d.generateBorders?1:0),D=i+(d.generateBorders||d.extendToSouthPole?1:0),F=m*v,O=a*h*6,Z=m*v>65536;if(Z&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let X=Z||t==="32bit",nt=new Int16Array(2*F),ct=0;for(let Ct=P;Ct<=D;Ct++)for(let yt=C;yt<=I;yt++){let Lt=yt/i*u.$;yt===-1&&(Lt=-64),yt===i+1&&(Lt=u.$+Jr);let It=Ct/i*u.$;Ct===-1&&(It=d.extendToNorthPole?u.bg:-64),Ct===i+1&&(It=d.extendToSouthPole?u.bh:u.$+Jr),nt[ct++]=Lt,nt[ct++]=It}let dt=X?new Uint32Array(O):new Uint16Array(O),mt=0;for(let Ct=0;Ct<h;Ct++)for(let yt=0;yt<a;yt++){let Lt=yt+1+Ct*m,It=yt+(Ct+1)*m,xt=yt+1+(Ct+1)*m;dt[mt++]=yt+Ct*m,dt[mt++]=It,dt[mt++]=Lt,dt[mt++]=Lt,dt[mt++]=It,dt[mt++]=xt}return{vertices:nt.buffer.slice(0),indices:dt.buffer.slice(0),uses32bitIndices:X}}let Hn=new u.aJ({fill:new u.bi(128,2),line:new u.bi(512,0),tile:new u.bi(128,32),stencil:new u.bi(128,1),circle:3});class vi{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Xr.projectionGlobe}get vertexShaderPreludeCode(){return Xr.projectionMercator.vertexSource}get subdivisionGranularity(){return Hn}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new oo(t));let i=u.U(this._errorQueryLatitudeDegrees),a=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(i,a),m=re.now();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=m);let v=Math.min(Math.max((m-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=u.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,u.bk(v))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,i,a,h,m){let v=(m==="stencil"?Hn.stencil:Hn.tile).getGranularityForZoomLevel(i.z);return this._getMesh(t,{granularity:v,generateBorders:a,extendToNorthPole:i.y===0&&h,extendToSouthPole:i.y===(1<<i.z)-1&&h})}_getMesh(t,i){let a=this._getMeshKey(i);if(a in this._tileMeshCache)return this._tileMeshCache[a];let h=function(m,v){let C=Wa(v,"16bit"),P=u.aK.deserialize({arrayBuffer:C.vertices,length:C.vertices.byteLength/2/2}),I=u.aM.deserialize({arrayBuffer:C.indices,length:C.indices.byteLength/2/3});return new fn(m.createVertexBuffer(P,qn.members),m.createIndexBuffer(I),u.aL.simpleSegment(0,0,P.length,I.length))}(t,i);return this._tileMeshCache[a]=h,h}recalculate(t){}hasTransition(){let t=re.now(),i=!1;return i=i||(t-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}let gl=new u.r({type:new u.D(u.v.projection.type)});class Nr extends u.E{constructor(t){super(),this._transitionable=new u.t(gl),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.F(0)),this._mercatorProjection=new ia,this._verticalPerspectiveProjection=new vi}get transitionState(){let t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof u.bl){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,i,a,h,m){return this.currentProjection.getMeshFromTileID(t,i,a,h,m)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function ls(d){let t=Wn(d.worldSize,d.center.lat);return 2*Math.PI*t}function li(d,t,i,a,h){let m=1/(1<<h),v=t/u.$*m+a*m,C=u.bn((d/u.$*m+i*m)*Math.PI*2+Math.PI,2*Math.PI),P=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,I=Math.cos(P),D=new Float64Array(3);return D[0]=Math.sin(C)*I,D[1]=Math.sin(P),D[2]=Math.cos(C)*I,D}function ar(d){return function(t,i){let a=Math.cos(i),h=new Float64Array(3);return h[0]=Math.sin(t)*a,h[1]=Math.sin(i),h[2]=Math.cos(t)*a,h}(d.lng*Math.PI/180,d.lat*Math.PI/180)}function Wn(d,t){return d/(2*Math.PI)/Math.cos(t*Math.PI/180)}function ra(d){let t=Math.asin(d[1])/Math.PI*180,i=Math.sqrt(d[0]*d[0]+d[2]*d[2]);if(i>1e-6){let a=d[0]/i,h=Math.acos(d[2]/i),m=(a>0?h:-h)/Math.PI*180;return new u.S(u.aN(m,-180,180),t)}return new u.S(0,t)}function $s(d){return Math.cos(d*Math.PI/180)}function lr(d,t){let i=$s(d),a=$s(t);return u.aj(a/i)}function ao(d,t){let i=d.rotate(t.bearingInRadians),a=t.zoom+lr(t.center.lat,0),h=u.bj(1/$s(t.center.lat),1/$s(Math.min(Math.abs(t.center.lat),60)),u.bm(a,7,3,0,1)),m=360/ls({worldSize:t.worldSize,center:{lat:t.center.lat}});return new u.S(t.center.lng-i.x*m*h,u.ag(t.center.lat+i.y*m,-85.051129,u.ah))}function Kn(d){let t=.5*d,i=Math.sin(t),a=Math.cos(t);return Math.log(i+a)-Math.log(a-i)}function Go(d,t,i,a){let h=d.lat+i*a;if(Math.abs(i)>1){let m=(Math.sign(d.lat+i)!==Math.sign(d.lat)?-Math.abs(d.lat):Math.abs(d.lat))*Math.PI/180,v=Math.abs(d.lat+i)*Math.PI/180,C=Kn(m+a*(v-m)),P=Kn(m),I=Kn(v);return new u.S(d.lng+t*((C-P)/(I-P)),h)}return new u.S(d.lng+t*a,h)}class Mr{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;let t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,i,a,h){let m=`${t.z}_${t.x}_${t.y}_${h?.terrain?"t":""}`,v=this._cache.get(m);if(v)return v;let C=this._cachePrevious.get(m);if(C)return this._cache.set(m,C),C;let P=this._boundingVolumeFactory(t,i,a,h);return this._cache.set(m,P),this._hadAnyChanges=!0,P}}class bs{constructor(t,i,a,h){this.min=a,this.max=h,this.points=t,this.planes=i}static fromAabb(t,i){let a=[];for(let h=0;h<8;h++)a.push([1&~h?t[0]:i[0],(h>>1&1)==1?i[1]:t[1],(h>>2&1)==1?i[2]:t[2]]);return new bs(a,[[-1,0,0,i[0]],[1,0,0,-t[0]],[0,-1,0,i[1]],[0,1,0,-t[1]],[0,0,-1,i[2]],[0,0,1,-t[2]]],t,i)}static fromCenterSizeAngles(t,i,a){let h=u.bq([],a[0],a[1],a[2]),m=u.br([],[i[0],0,0],h),v=u.br([],[0,i[1],0],h),C=u.br([],[0,0,i[2]],h),P=[...t],I=[...t];for(let F=0;F<8;F++)for(let O=0;O<3;O++){let Z=t[O]+m[O]*(1&~F?-1:1)+v[O]*((F>>1&1)==1?1:-1)+C[O]*((F>>2&1)==1?1:-1);P[O]=Math.min(P[O],Z),I[O]=Math.max(I[O],Z)}let D=[];for(let F=0;F<8;F++){let O=[...t];u.aR(O,O,u.aQ([],m,1&~F?-1:1)),u.aR(O,O,u.aQ([],v,(F>>1&1)==1?1:-1)),u.aR(O,O,u.aQ([],C,(F>>2&1)==1?1:-1)),D.push(O)}return new bs(D,[[...m,-u.aW(m,D[0])],[...v,-u.aW(v,D[0])],[...C,-u.aW(C,D[0])],[-m[0],-m[1],-m[2],-u.aW(m,D[7])],[-v[0],-v[1],-v[2],-u.aW(v,D[7])],[-C[0],-C[1],-C[2],-u.aW(C,D[7])]],P,I)}intersectsFrustum(t){let i=!0,a=this.points.length,h=this.planes.length,m=t.planes.length,v=t.points.length;for(let C=0;C<m;C++){let P=t.planes[C],I=0;for(let D=0;D<a;D++){let F=this.points[D];P[0]*F[0]+P[1]*F[1]+P[2]*F[2]+P[3]>=0&&I++}if(I===0)return 0;I<a&&(i=!1)}if(i)return 2;for(let C=0;C<h;C++){let P=this.planes[C],I=0;for(let D=0;D<v;D++){let F=t.points[D];P[0]*F[0]+P[1]*F[1]+P[2]*F[2]+P[3]>=0&&I++}if(I===0)return 0}return 1}intersectsPlane(t){let i=this.points.length,a=0;for(let h=0;h<i;h++){let m=this.points[h];t[0]*m[0]+t[1]*m[1]+t[2]*m[2]+t[3]>=0&&a++}return a===i?2:a===0?0:1}}function Xn(d,t,i){let a=d-t;return a<0?-a:Math.max(0,a-i)}function us(d,t,i,a,h){let m=d-i,v;return v=m<0?Math.min(-m,1+m-h):m>1?Math.min(Math.max(m-h,0),1-m):0,Math.max(v,Xn(t,a,h))}class yl{constructor(){this._boundingVolumeCache=new Mr(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,i,a,h){let m=1<<a.z,v=1/m,C=a.x/m,P=a.y/m,I=2;return I=Math.min(I,us(t,i,C,P,v)),I=Math.min(I,us(t,i,C+.5,-P-v,v)),I=Math.min(I,us(t,i,C+.5,2-P-v,v)),I}getWrap(t,i,a){let h=1<<i.z,m=1/h,v=i.x/h,C=Xn(t.x,v,m),P=Xn(t.x,v-1,m),I=Xn(t.x,v+1,m),D=Math.min(C,P,I);return D===I?1:D===P?-1:0}allowVariableZoom(t,i){return fe(t,i)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,i,a,h){return this._boundingVolumeCache.getTileBoundingVolume(t,i,a,h)}_computeTileBoundingVolume(t,i,a,h){var m,v;let C=a,P=a;if(h?.terrain){let I=new u.Z(t.z,i,t.z,t.x,t.y),D=h.terrain.getMinMaxElevation(I);C=(m=D.minElevation)!==null&&m!==void 0?m:a,P=(v=D.maxElevation)!==null&&v!==void 0?v:a}if(C/=u.bt,P/=u.bt,C+=1,P+=1,t.z<=0)return bs.fromAabb([-P,-P,-P],[P,P,P]);if(t.z===1)return bs.fromAabb([t.x===0?-P:0,t.y===0?0:-P,-P],[t.x===0?0:P,t.y===0?P:0,P]);{let I=[li(0,0,t.x,t.y,t.z),li(u.$,0,t.x,t.y,t.z),li(u.$,u.$,t.x,t.y,t.z),li(0,u.$,t.x,t.y,t.z)],D=[];for(let ne of I)D.push(u.aQ([],ne,P));if(P!==C)for(let ne of I)D.push(u.aQ([],ne,C));t.y===0&&D.push([0,1,0]),t.y===(1<<t.z)-1&&D.push([0,-1,0]);let F=[1,1,1],O=[-1,-1,-1];for(let ne of D)for(let he=0;he<3;he++)F[he]=Math.min(F[he],ne[he]),O[he]=Math.max(O[he],ne[he]);let Z=li(u.$/2,u.$/2,t.x,t.y,t.z),X=u.aV([],[0,1,0],Z);u.aU(X,X);let nt=u.aV([],Z,X);u.aU(nt,nt);let ct=u.aV([],I[2],I[1]);u.aU(ct,ct);let dt=u.aV([],I[0],I[3]);u.aU(dt,dt),D.push(u.aQ([],Z,P)),t.y>=(1<<t.z)/2&&D.push(u.aQ([],li(u.$/2,0,t.x,t.y,t.z),P)),t.y<(1<<t.z)/2&&D.push(u.aQ([],li(u.$/2,u.$,t.x,t.y,t.z),P));let mt=Ar(Z,D),Ct=Ar(nt,D),yt=[-Z[0],-Z[1],-Z[2],mt.max],Lt=[Z[0],Z[1],Z[2],-mt.min],It=[-nt[0],-nt[1],-nt[2],Ct.max],xt=[nt[0],nt[1],nt[2],-Ct.min],Ot=[...ct,0],ue=[...dt,0],te=[];return t.y===0?te.push(u.bs(ue,Ot,yt),u.bs(ue,Ot,Lt)):te.push(u.bs(It,Ot,yt),u.bs(It,Ot,Lt),u.bs(It,ue,yt),u.bs(It,ue,Lt)),t.y===(1<<t.z)-1?te.push(u.bs(ue,Ot,yt),u.bs(ue,Ot,Lt)):te.push(u.bs(xt,Ot,yt),u.bs(xt,Ot,Lt),u.bs(xt,ue,yt),u.bs(xt,ue,Lt)),new bs(te,[yt,Lt,It,xt,Ot,ue],F,O)}}}function Ar(d,t){let i=1/0,a=-1/0;for(let h of t){let m=u.aW(d,h);i=Math.min(i,m),a=Math.max(a,m)}return{min:i,max:a}}class qs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,i,a){return this._helper.interpolatePadding(t,i,a)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,i){this._helper.resize(t,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,i){this._helper.overrideNearFarZ(t,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=u.bu(),this._projectionMatrix=u.b8(),this._globeViewProjMatrix32f=u.b7(),this._globeViewProjMatrixNoCorrection=u.b8(),this._globeViewProjMatrixNoCorrectionInverted=u.b8(),this._globeProjMatrixInverted=u.b8(),this._cameraPosition=u.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new so({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,i)=>this.getConstrained(t,i)}),this._coveringTilesDetailsProvider=new yl}clone(){let t=new qs;return t.apply(this),t}apply(t,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let t=u.bo();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){let{overscaledTileID:i,applyGlobeMatrix:a}=t,h=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:a?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){let i=this.pitchInRadians,a=this.cameraToCenterDistance/t,h=Math.sin(i)*a,m=Math.cos(i)*a+1,v=1/Math.sqrt(h*h+m*m)*1,C=-h,P=m,I=Math.sqrt(C*C+P*P);C/=I,P/=I;let D=[0,C,P];u.bv(D,D,[0,0,0],-this.bearingInRadians),u.bw(D,D,[0,0,0],-1*this.center.lat*Math.PI/180),u.bx(D,D,[0,0,0],this.center.lng*Math.PI/180);let F=1/u.aY(D);return u.aQ(D,D,F),[...D,-v*F]}isLocationOccluded(t){return!this.isSurfacePointVisible(ar(t))}transformLightDirection(t){let i=this._helper._center.lng*Math.PI/180,a=this._helper._center.lat*Math.PI/180,h=Math.cos(a),m=[Math.sin(i)*h,Math.sin(a),Math.cos(i)*h],v=[m[2],0,-m[0]],C=[0,0,0];u.aV(C,v,m),u.aU(v,v),u.aU(C,C);let P=[0,0,0];return u.aU(P,[v[0]*t[0]+C[0]*t[1]+m[0]*t[2],v[1]*t[0]+C[1]*t[1]+m[1]*t[2],v[2]*t[0]+C[2]*t[1]+m[2]*t[2]]),P}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,i,a){let h=function(C,P,I){let D=1/(1<<I.z);return new u.a0(C/u.$*D+I.x*D,P/u.$*D+I.y*D)}(t,i,a.canonical),m=(v=h.y,[u.bn(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(m[1])}projectTileCoordinates(t,i,a,h){let m=a.canonical,v=li(t,i,m.x,m.y,m.z),C=1+(h?h(t,i):0)/u.bt,P=[v[0]*C,v[1]*C,v[2]*C,1];u.av(P,P,this._globeViewProjMatrixNoCorrection);let I=this._cachedClippingPlane,D=I[0]*v[0]+I[1]*v[1]+I[2]*v[2]+I[3]<0;return{point:new u.P(P[0]/P[3],P[1]/P[3]),signedDistanceFromCamera:P[3],isOccluded:D}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let t=Wn(this.worldSize,this.center.lat),i=u.b9(),a=u.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),u.b3(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let h=this.centerOffset;i[8]=2*-h.x/this._helper._width,i[9]=2*h.y/this._helper._height,this._projectionMatrix=u.b4(i),this._globeProjMatrixInverted=u.b9(),u.ap(this._globeProjMatrixInverted,i),u.M(i,i,[0,0,-this.cameraToCenterDistance]),u.b5(i,i,this.rollInRadians),u.b6(i,i,-this.pitchInRadians),u.b5(i,i,this.bearingInRadians),u.M(i,i,[0,0,-t]);let m=u.bo();m[0]=t,m[1]=t,m[2]=t,u.b6(a,i,this.center.lat*Math.PI/180),u.by(a,a,-this.center.lng*Math.PI/180),u.N(a,a,m),this._globeViewProjMatrixNoCorrection=a,u.b6(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),u.by(i,i,-this.center.lng*Math.PI/180),u.N(i,i,m),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=u.b9(),u.ap(this._globeViewProjMatrixNoCorrectionInverted,a);let v=u.bo();this._cameraPosition=u.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/t,u.bv(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),u.bw(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),u.bv(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),u.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),u.bw(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),u.bx(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);let C=u.b4(this._globeViewProjMatrixNoCorrectionInverted);u.N(C,C,[1,1,-1]),this._cachedFrustum=Zi.fromInvProjectionMatrix(C,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){u.w("calculateFogMatrix is not supported on globe projection.");let i=u.b9();return u.af(i),i}getVisibleUnwrappedCoordinates(t){return[new u.b1(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&u.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,i){if(!this._globeViewProjMatrixNoCorrection)return 1;let a=ar(t);u.aQ(a,a,1+i/u.bt);let h=u.bu();return u.av(h,[a[0],a[1],a[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(t){}getBounds(){let t=.5*this.width,i=.5*this.height,a=[new u.P(0,0),new u.P(t,0),new u.P(this.width,0),new u.P(this.width,i),new u.P(this.width,this.height),new u.P(t,this.height),new u.P(0,this.height),new u.P(0,i)],h=[];for(let F of a)h.push(this.unprojectScreenPoint(F));let m=0,v=0,C=0,P=0,I=this.center;for(let F of h){let O=u.bz(I.lng,F.lng),Z=u.bz(I.lat,F.lat);O<v&&(v=O),O>m&&(m=O),Z<P&&(P=Z),Z>C&&(C=Z)}let D=[I.lng+v,I.lat+P,I.lng+m,I.lat+C];return this.isSurfacePointOnScreen([0,1,0])&&(D[3]=90,D[0]=-180,D[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(D[1]=-90,D[0]=-180,D[2]=180),new ji(D)}getConstrained(t,i){let a=u.ag(t.lat,-85.051129,u.ah),h=u.ag(+i,this.minZoom+lr(0,a),this.maxZoom);return{center:new u.S(t.lng,a),zoom:h}}calculateCenterFromCameraLngLatAlt(t,i,a,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,i,a,h)}setLocationAtPoint(t,i){let a=ar(this.unprojectScreenPoint(i)),h=ar(t),m=u.bo();u.bA(m);let v=u.bo();u.bx(v,a,m,-this.center.lng*Math.PI/180),u.bw(v,v,m,this.center.lat*Math.PI/180);let C=h[0]*h[0]+h[2]*h[2],P=v[0]*v[0];if(C<P)return;let I=Math.sqrt(C-P),D=-I,F=u.bB(h[0],h[2],v[0],I),O=u.bB(h[0],h[2],v[0],D),Z=u.bo();u.bx(Z,h,m,-F);let X=u.bB(Z[1],Z[2],v[1],v[2]),nt=u.bo();u.bx(nt,h,m,-O);let ct=u.bB(nt[1],nt[2],v[1],v[2]),dt=.5*Math.PI,mt=X>=-dt&&X<=dt,Ct=ct>=-dt&&ct<=dt,yt,Lt;if(mt&&Ct){let ue=this.center.lng*Math.PI/180,te=this.center.lat*Math.PI/180;u.bC(F,ue)+u.bC(X,te)<u.bC(O,ue)+u.bC(ct,te)?(yt=F,Lt=X):(yt=O,Lt=ct)}else if(mt)yt=F,Lt=X;else{if(!Ct)return;yt=O,Lt=ct}let It=yt/Math.PI*180,xt=Lt/Math.PI*180,Ot=this.center.lat;this.setCenter(new u.S(It,u.ag(xt,-90,90))),this.setZoom(this.zoom+lr(Ot,this.center.lat))}locationToScreenPoint(t,i){let a=ar(t);if(i){let h=i.getElevationForLngLatZoom(t,this._helper._tileZoom);u.aQ(a,a,1+h/u.bt)}return this._projectSurfacePointToScreen(a)}_projectSurfacePointToScreen(t){let i=u.bu();return u.av(i,[...t,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new u.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,i){if(i){let a=i.pointCoordinate(t);if(a)return a}return u.a0.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,i){var a;return(a=this.screenPointToMercatorCoordinate(t,i))===null||a===void 0?void 0:a.toLngLat()}isPointOnMapSurface(t,i){let a=this._cameraPosition,h=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(a,h)}getRayDirectionFromPixel(t){let i=u.bu();i[0]=t.x/this.width*2-1,i[1]=-1*(t.y/this.height*2-1),i[2]=1,i[3]=1,u.av(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];let a=u.bo();a[0]=i[0]-this._cameraPosition[0],a[1]=i[1]-this._cameraPosition[1],a[2]=i[2]-this._cameraPosition[2];let h=u.bo();return u.aU(h,a),h}isSurfacePointVisible(t){let i=this._cachedClippingPlane;return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;let i=u.bu();return u.av(i,[...t,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(t,i){let a=u.aW(t,i),h=u.bo(),m=u.bo();u.aQ(m,i,a),u.aT(h,t,m);let v=1-u.aW(h,h);if(v<0)return null;let C=u.aW(t,t)-1,P=-a+(a<0?1:-1)*Math.sqrt(v),I=C/P,D=P;return{tMin:Math.min(I,D),tMax:Math.max(I,D)}}unprojectScreenPoint(t){let i=this._cameraPosition,a=this.getRayDirectionFromPixel(t),h=this.rayPlanetIntersection(i,a);if(h){let D=u.bo();u.aR(D,i,[a[0]*h.tMin,a[1]*h.tMin,a[2]*h.tMin]);let F=u.bo();return u.aU(F,D),ra(F)}let m=this._cachedClippingPlane,v=m[0]*a[0]+m[1]*a[1]+m[2]*a[2],C=-u.b0(m,i)/v,P=u.bo();if(C>0)u.aR(P,i,[a[0]*C,a[1]*C,a[2]*C]);else{let D=u.bo();u.aR(D,i,[2*a[0],2*a[1],2*a[2]]);let F=u.b0(this._cachedClippingPlane,D);u.aT(P,D,[this._cachedClippingPlane[0]*F,this._cachedClippingPlane[1]*F,this._cachedClippingPlane[2]*F])}let I=function(D){let F=u.bo();return F[0]=D[0]*-D[3],F[1]=D[1]*-D[3],F[2]=D[2]*-D[3],{center:F,radius:Math.sqrt(1-D[3]*D[3])}}(m);return ra(function(D,F,O){let Z=u.bo();u.aT(Z,O,D);let X=u.bo();return u.bp(X,D,Z,F/u.a_(Z)),X}(I.center,I.radius,P))}getMatrixForModel(t,i){let a=u.S.convert(t),h=1/u.bt,m=u.b8();return u.by(m,m,a.lng/180*Math.PI),u.b6(m,m,-a.lat/180*Math.PI),u.M(m,m,[0,0,1+i/u.bt]),u.b6(m,m,.5*Math.PI),u.N(m,m,[h,h,h]),m}getProjectionDataForCustomLayer(t=!0){let i=this.getProjectionData({overscaledTileID:new u.Z(0,0,0,0,0),applyGlobeMatrix:t});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(t){}}class _n{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,i,a){return this._helper.interpolatePadding(t,i,a)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,i,a=!0){this._helper.resize(t,i,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,i){this._helper.overrideNearFarZ(t,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,i){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new so({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,i)=>this.getConstrained(t,i)}),this._globeness=1,this._mercatorTransform=new ii,this._verticalPerspectiveTransform=new qs}clone(){let t=new _n;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){let i=this._mercatorTransform.getProjectionData(t),a=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?a.mainMatrix:i.mainMatrix,clippingPlane:a.clippingPlane,tileMercatorCoords:a.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return u.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return u.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,i,a){let h=this._mercatorTransform.getPitchedTextCorrection(t,i,a),m=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,i,a);return u.bj(h,m,this._globeness)}projectTileCoordinates(t,i,a,h){return this.currentTransform.projectTileCoordinates(t,i,a,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,i){return this.currentTransform.lngLatToCameraDepth(t,i)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,i){return this.currentTransform.getConstrained(t,i)}calculateCenterFromCameraLngLatAlt(t,i,a,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,i,a,h)}setLocationAtPoint(t,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,i){return this.currentTransform.locationToScreenPoint(t,i)}screenPointToMercatorCoordinate(t,i){return this.currentTransform.screenPointToMercatorCoordinate(t,i)}screenPointToLocation(t,i){return this.currentTransform.screenPointToLocation(t,i)}isPointOnMapSurface(t,i){return this.currentTransform.isPointOnMapSurface(t,i)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,i){return this.currentTransform.getMatrixForModel(t,i)}getProjectionDataForCustomLayer(t=!0){let i=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return i;let a=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return a.fallbackMatrix=i.mainMatrix,a}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class jr{get useGlobeControls(){return!0}handlePanInertia(t,i){let a=ao(t,i);return Math.abs(a.lng-i.center.lng)>180&&(a.lng=i.center.lng+179.5*Math.sign(a.lng-i.center.lng)),{easingCenter:a,easingOffset:new u.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,i){let a=t.around,h=i.screenPointToLocation(a);t.bearingDelta&&i.setBearing(i.bearing+t.bearingDelta),t.pitchDelta&&i.setPitch(i.pitch+t.pitchDelta),t.rollDelta&&i.setRoll(i.roll+t.rollDelta);let m=i.zoom;t.zoomDelta&&i.setZoom(i.zoom+t.zoomDelta);let v=i.zoom-m;if(v===0)return;let C=u.bz(i.center.lng,h.lng),P=C/(Math.abs(C/180)+1),I=u.bz(i.center.lat,h.lat),D=i.getRayDirectionFromPixel(a),F=i.cameraPosition,O=-1*u.aW(F,D),Z=u.bo();u.aR(Z,F,[D[0]*O,D[1]*O,D[2]*O]);let X=u.aY(Z)-1,nt=Math.exp(.5*-Math.max(X-.3,0)),ct=Wn(i.worldSize,i.center.lat)/Math.min(i.width,i.height),dt=u.bm(ct,.9,.5,1,.25),mt=(1-u.ae(-v))*Math.min(nt,dt),Ct=i.center.lat,yt=i.zoom,Lt=new u.S(i.center.lng+P*mt,u.ag(i.center.lat+I*mt,-85.051129,u.ah));i.setLocationAtPoint(h,a);let It=i.center,xt=u.bm(Math.abs(C),45,85,0,1),Ot=u.bm(ct,.75,.35,0,1),ue=Math.pow(Math.max(xt,Ot),.25),te=u.bz(It.lng,Lt.lng),ne=u.bz(It.lat,Lt.lat);i.setCenter(new u.S(It.lng+te*ue,It.lat+ne*ue).wrap()),i.setZoom(yt+lr(Ct,i.center.lat))}handleMapControlsPan(t,i,a){if(!t.panDelta)return;let h=i.center.lat,m=i.zoom;i.setCenter(ao(t.panDelta,i).wrap()),i.setZoom(m+lr(h,i.center.lat))}cameraForBoxAndBearing(t,i,a,h,m){let v=Fi(t,i,a,h,m),C=i.left/m.width*2-1,P=(m.width-i.right)/m.width*2-1,I=i.top/m.height*-2+1,D=(m.height-i.bottom)/m.height*-2+1,F=u.bz(a.getWest(),a.getEast())<0,O=F?a.getEast():a.getWest(),Z=F?a.getWest():a.getEast(),X=Math.max(a.getNorth(),a.getSouth()),nt=Math.min(a.getNorth(),a.getSouth()),ct=O+.5*u.bz(O,Z),dt=X+.5*u.bz(X,nt),mt=m.clone();mt.setCenter(v.center),mt.setBearing(v.bearing),mt.setPitch(0),mt.setRoll(0),mt.setZoom(v.zoom);let Ct=mt.modelViewProjectionMatrix,yt=[ar(a.getNorthWest()),ar(a.getNorthEast()),ar(a.getSouthWest()),ar(a.getSouthEast()),ar(new u.S(Z,dt)),ar(new u.S(O,dt)),ar(new u.S(ct,X)),ar(new u.S(ct,nt))],Lt=ar(v.center),It=Number.POSITIVE_INFINITY;for(let xt of yt)C<0&&(It=jr.getLesserNonNegativeNonNull(It,jr.solveVectorScale(xt,Lt,Ct,"x",C))),P>0&&(It=jr.getLesserNonNegativeNonNull(It,jr.solveVectorScale(xt,Lt,Ct,"x",P))),I>0&&(It=jr.getLesserNonNegativeNonNull(It,jr.solveVectorScale(xt,Lt,Ct,"y",I))),D<0&&(It=jr.getLesserNonNegativeNonNull(It,jr.solveVectorScale(xt,Lt,Ct,"y",D)));if(Number.isFinite(It)&&It!==0)return v.zoom=mt.zoom+u.aj(It),v;Cr()}handleJumpToCenterZoom(t,i){let a=t.center.lat,h=t.getConstrained(i.center?u.S.convert(i.center):t.center,t.zoom).center;t.setCenter(h.wrap());let m=i.zoom!==void 0?+i.zoom:t.zoom+lr(a,h.lat);t.zoom!==m&&t.setZoom(m)}handleEaseTo(t,i){let a=t.zoom,h=t.center,m=t.padding,v={roll:t.roll,pitch:t.pitch,bearing:t.bearing},C={roll:i.roll===void 0?t.roll:i.roll,pitch:i.pitch===void 0?t.pitch:i.pitch,bearing:i.bearing===void 0?t.bearing:i.bearing},P=i.zoom!==void 0,I=!t.isPaddingEqual(i.padding),D=!1,F=i.center?u.S.convert(i.center):h,O=t.getConstrained(F,a).center;kn(t,O);let Z=t.clone();Z.setCenter(O),Z.setZoom(P?+i.zoom:a+lr(h.lat,F.lat)),Z.setBearing(i.bearing);let X=new u.P(u.ag(t.centerPoint.x+i.offsetAsPoint.x,0,t.width),u.ag(t.centerPoint.y+i.offsetAsPoint.y,0,t.height));Z.setLocationAtPoint(O,X);let nt=(i.offset&&i.offsetAsPoint.mag())>0?Z.center:O,ct=P?+i.zoom:a+lr(h.lat,nt.lat),dt=a+lr(h.lat,0),mt=ct+lr(nt.lat,0),Ct=u.bz(h.lng,nt.lng),yt=u.bz(h.lat,nt.lat),Lt=u.ae(mt-dt);return D=ct!==a,{easeFunc:It=>{if(u.bd(v,C)||or({startEulerAngles:v,endEulerAngles:C,tr:t,k:It,useSlerp:v.roll!=C.roll}),I&&t.interpolatePadding(m,i.padding,It),i.around)u.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(i.around,i.aroundPoint);else{let xt=mt>dt?Math.min(2,Lt):Math.max(.5,Lt),Ot=Math.pow(xt,1-It),ue=Go(h,Ct,yt,It*Ot);t.setCenter(ue.wrap())}if(D){let xt=u.C.number(dt,mt,It)+lr(0,t.center.lat);t.setZoom(xt)}},isZooming:D,elevationCenter:nt}}handleFlyTo(t,i){let a=i.zoom!==void 0,h=t.center,m=t.zoom,v=t.padding,C=!t.isPaddingEqual(i.padding),P=t.getConstrained(u.S.convert(i.center||i.locationAtOffset),m).center,I=a?+i.zoom:t.zoom+lr(t.center.lat,P.lat),D=t.clone();D.setCenter(P),D.setZoom(I),D.setBearing(i.bearing);let F=new u.P(u.ag(t.centerPoint.x+i.offsetAsPoint.x,0,t.width),u.ag(t.centerPoint.y+i.offsetAsPoint.y,0,t.height));D.setLocationAtPoint(P,F);let O=D.center;kn(t,O);let Z=function(yt,Lt,It){let xt=ar(Lt),Ot=ar(It),ue=u.aW(xt,Ot),te=Math.acos(ue),ne=ls(yt);return te/(2*Math.PI)*ne}(t,h,O),X=m+lr(h.lat,0),nt=I+lr(O.lat,0),ct=u.ae(nt-X),dt;if(typeof i.minZoom=="number"){let yt=+i.minZoom+lr(O.lat,0),Lt=Math.min(yt,X,nt)+lr(0,O.lat),It=t.getConstrained(O,Lt).zoom+lr(O.lat,0);dt=u.ae(It-X)}let mt=u.bz(h.lng,O.lng),Ct=u.bz(h.lat,O.lat);return{easeFunc:(yt,Lt,It,xt)=>{let Ot=Go(h,mt,Ct,It);C&&t.interpolatePadding(v,i.padding,yt);let ue=yt===1?O:Ot;t.setCenter(ue.wrap());let te=X+u.aj(Lt);t.setZoom(yt===1?I:te+lr(0,ue.lat))},scaleOfZoom:ct,targetCenter:O,scaleOfMinZoom:dt,pixelPathLength:Z}}static solveVectorScale(t,i,a,h,m){let v=h==="x"?[a[0],a[4],a[8],a[12]]:[a[1],a[5],a[9],a[13]],C=[a[3],a[7],a[11],a[15]],P=t[0]*v[0]+t[1]*v[1]+t[2]*v[2],I=t[0]*C[0]+t[1]*C[1]+t[2]*C[2],D=i[0]*v[0]+i[1]*v[1]+i[2]*v[2],F=i[0]*C[0]+i[1]*C[1]+i[2]*C[2];return D+m*I===P+m*F||C[3]*(P-D)+v[3]*(F-I)+P*F==D*I?null:(D+v[3]-m*F-m*C[3])/(D-P-m*F+m*I)}static getLesserNonNegativeNonNull(t,i){return i!==null&&i>=0&&i<t?i:t}}class Sa{constructor(t){this._globe=t,this._mercatorCameraHelper=new jo,this._verticalPerspectiveCameraHelper=new jr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,i){return this.currentHelper.handlePanInertia(t,i)}handleMapControlsRollPitchBearingZoom(t,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,i)}handleMapControlsPan(t,i,a){this.currentHelper.handleMapControlsPan(t,i,a)}cameraForBoxAndBearing(t,i,a,h,m){return this.currentHelper.cameraForBoxAndBearing(t,i,a,h,m)}handleJumpToCenterZoom(t,i){this.currentHelper.handleJumpToCenterZoom(t,i)}handleEaseTo(t,i){return this.currentHelper.handleEaseTo(t,i)}handleFlyTo(t,i){return this.currentHelper.handleFlyTo(t,i)}}let na=(d,t)=>u.y(d,t&&t.filter(i=>i.identifier!=="source.canvas")),lo=u.bD();class sa extends u.E{constructor(t,i={}){super(),this._rtlPluginLoaded=()=>{for(let a in this.sourceCaches){let h=this.sourceCaches[a].getSource().type;h!=="vector"&&h!=="geojson"||this.sourceCaches[a].reload()}},this.map=t,this.dispatcher=new mi(wi(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,h)=>this.getGlyphs(a,h)),this.dispatcher.registerMessageHandler("GI",(a,h)=>this.getImages(a,h)),this.imageManager=new Bs,this.imageManager.setEventedParent(this),this.glyphManager=new _r(t._requestManager,i.localIdeographFontFamily),this.lineAtlas=new io(256,512),this.crossTileSymbolIndex=new os,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",u.bF()),Kr().on(gs,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;let h=this.sourceCaches[a.sourceId];if(!h)return;let m=h.getSource();if(m&&m.vectorLayerIds)for(let v in this._layers){let C=this._layers[v];C.source===m.id&&this._validateLayer(C)}})}setGlobalStateProperty(t,i){var a,h,m;this._checkLoaded();let v=i===null?(m=(h=(a=this.stylesheet.state)===null||a===void 0?void 0:a[t])===null||h===void 0?void 0:h.default)!==null&&m!==void 0?m:null:i;if(u.bG(v,this._globalState[t]))return this;this._globalState[t]=v;let C=this._findGlobalStateAffectedSources([t]);for(let P in this.sourceCaches)C.has(P)&&(this._reloadSource(P),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();let i=[];for(let h in t)!u.bG(this._globalState[h],t[h].default)&&(i.push(h),this._globalState[h]=t[h].default);let a=this._findGlobalStateAffectedSources(i);for(let h in this.sourceCaches)a.has(h)&&(this._reloadSource(h),this._changed=!0)}_findGlobalStateAffectedSources(t){if(t.length===0)return new Set;let i=new Set;for(let a in this._layers){let h=this._layers[a],m=h.getLayoutAffectingGlobalStateRefs();for(let v of t)m.has(v)&&i.add(h.source)}return i}loadURL(t,i={},a){this.fire(new u.l("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;let h=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;let m=this._loadStyleRequest;u.j(h,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,i,a)}).catch(v=>{this._loadStyleRequest=null,v&&!m.signal.aborted&&this.fire(new u.k(v))})}loadJSON(t,i={},a){this.fire(new u.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,re.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(t,i,a)}).catch(()=>{})}loadEmpty(){this.fire(new u.l("dataloading",{dataType:"style"})),this._load(lo,{validate:!1})}_load(t,i,a){var h,m,v;let C=i.transformStyle?i.transformStyle(a,t):t;if(!i.validate||!na(this,u.z(C))){this._loaded=!0,this.stylesheet=C;for(let P in C.sources)this.addSource(P,C.sources[P],{validate:!1});C.sprite?this._loadSprite(C.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(C.glyphs),this._createLayers(),this.light=new gr(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new ei(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.setGlobalState((v=this.stylesheet.state)!==null&&v!==void 0?v:null),this.fire(new u.l("data",{dataType:"style"})),this.fire(new u.l("style.load"))}}_createLayers(){let t=u.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(i=>i.id),this._layers={},this._serializedLayers=null;for(let i of t){let a=u.bI(i);a.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=a}}_loadSprite(t,i=!1,a=void 0){let h;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,v,C,P){return u._(this,void 0,void 0,function*(){let I=Ri(m),D=C>1?"@2x":"",F={},O={};for(let{id:Z,url:X}of I){let nt=v.transformRequest(Pn(X,D,".json"),"SpriteJSON");F[Z]=u.j(nt,P);let ct=v.transformRequest(Pn(X,D,".png"),"SpriteImage");O[Z]=Wi.getImage(ct,P)}return yield Promise.all([...Object.values(F),...Object.values(O)]),function(Z,X){return u._(this,void 0,void 0,function*(){let nt={};for(let ct in Z){nt[ct]={};let dt=re.getImageCanvasContext((yield X[ct]).data),mt=(yield Z[ct]).data;for(let Ct in mt){let{width:yt,height:Lt,x:It,y:xt,sdf:Ot,pixelRatio:ue,stretchX:te,stretchY:ne,content:he,textFitWidth:Ee,textFitHeight:ke}=mt[Ct];nt[ct][Ct]={data:null,pixelRatio:ue,sdf:Ot,stretchX:te,stretchY:ne,content:he,textFitWidth:Ee,textFitHeight:ke,spriteData:{width:yt,height:Lt,x:It,y:xt,context:dt}}}}return nt})}(F,O)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(let v in m){this._spritesImagesIds[v]=[];let C=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(P=>!(P in m)):[];for(let P of C)this.imageManager.removeImage(P),this._changedImages[P]=!0;for(let P in m[v]){let I=v==="default"?P:`${v}:${P}`;this._spritesImagesIds[v].push(I),I in this.imageManager.images?this.imageManager.updateImage(I,m[v][P],!1):this.imageManager.addImage(I,m[v][P]),i&&(this._changedImages[I]=!0)}}}).catch(m=>{this._spriteRequest=null,h=m,this.fire(new u.k(h))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"})),a&&a(h)})}_unloadSprite(){for(let t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}_validateLayer(t){let i=this.sourceCaches[t.source];if(!i)return;let a=t.sourceLayer;if(!a)return;let h=i.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(a)===-1)&&this.fire(new u.k(new Error(`Source layer "${a}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,i=!1){let a=this._serializedAllLayers();if(!t||t.length===0)return Object.values(i?u.bJ(a):a);let h=[];for(let m of t)if(a[m]){let v=i?u.bJ(a[m]):a[m];h.push(v)}return h}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};let i=Object.keys(this._layers);for(let a of i){let h=this._layers[a];h.type!=="custom"&&(t[a]=h.serialize())}return t}hasTransitions(){var t,i,a;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((a=this.projection)===null||a===void 0)&&a.hasTransition())return!0;for(let h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(let h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;let i=this._changed;if(i){let h=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(h.length||m.length)&&this._updateWorkerLayers(h,m);for(let v in this._updatedSources){let C=this._updatedSources[v];if(C==="reload")this._reloadSource(v);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}let a={};for(let h in this.sourceCaches){let m=this.sourceCaches[h];a[h]=m.used,m.used=!1}for(let h of this._order){let m=this._layers[h];m.recalculate(t,this._availableImages),!m.isHidden(t.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(let h in a){let m=this.sourceCaches[h];!!a[h]!=!!m.used&&m.fire(new u.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,i&&this.fire(new u.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let t=Object.keys(this._changedImages);if(t.length){for(let i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,i={}){var a;this._checkLoaded();let h=this.serialize();if(t=i.transformStyle?i.transformStyle(h,t):t,((a=i.validate)===null||a===void 0||a)&&na(this,u.z(t)))return!1;(t=u.bJ(t)).layers=u.bH(t.layers);let m=u.bK(h,t),v=this._getOperationsToPerform(m);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(let C of v.operations)C();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){let i=[],a=[];for(let h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push(()=>this.addLayer.apply(this,h.args));break;case"removeLayer":i.push(()=>this.removeLayer.apply(this,h.args));break;case"setPaintProperty":i.push(()=>this.setPaintProperty.apply(this,h.args));break;case"setLayoutProperty":i.push(()=>this.setLayoutProperty.apply(this,h.args));break;case"setFilter":i.push(()=>this.setFilter.apply(this,h.args));break;case"addSource":i.push(()=>this.addSource.apply(this,h.args));break;case"removeSource":i.push(()=>this.removeSource.apply(this,h.args));break;case"setLayerZoomRange":i.push(()=>this.setLayerZoomRange.apply(this,h.args));break;case"setLight":i.push(()=>this.setLight.apply(this,h.args));break;case"setGeoJSONSourceData":i.push(()=>this.setGeoJSONSourceData.apply(this,h.args));break;case"setGlyphs":i.push(()=>this.setGlyphs.apply(this,h.args));break;case"setSprite":i.push(()=>this.setSprite.apply(this,h.args));break;case"setTerrain":i.push(()=>this.map.setTerrain.apply(this,h.args));break;case"setSky":i.push(()=>this.setSky.apply(this,h.args));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":i.push(()=>this.setGlobalState.apply(this,h.args));break;case"setTransition":i.push(()=>{});break;default:a.push(h.command)}return{operations:i,unimplemented:a}}addImage(t,i){if(this.getImage(t))return this.fire(new u.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,i),this._afterImageUpdated(t)}updateImage(t,i){this.imageManager.updateImage(t,i)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new u.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,i,a={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(u.z.source,`sources.${t}`,i,null,a))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);let h=this.sourceCaches[t]=new ye(t,i,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t})),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(let a in this._layers)if(this._layers[a].source===t)return this.fire(new u.k(new Error(`Source "${t}" cannot be removed while layer "${a}" is using it.`)));let i=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],i.fire(new u.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,i){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);let a=this.sourceCaches[t].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(i),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,i,a={}){this._checkLoaded();let h=t.id;if(this.getLayer(h))return void this.fire(new u.k(new Error(`Layer "${h}" already exists on this map.`)));let m;if(t.type==="custom"){if(na(this,u.bL(t)))return;m=u.bI(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=u.bJ(t),t=u.e(t,{source:h})),this._validate(u.z.layer,`layers.${h}`,t,{arrayIndex:-1},a))return;m=u.bI(t),this._validateLayer(m),m.setEventedParent(this,{layer:{id:h}})}let v=i?this._order.indexOf(i):this._order.length;if(i&&v===-1)this.fire(new u.k(new Error(`Cannot add layer "${h}" before non-existing layer "${i}".`)));else{if(this._order.splice(v,0,h),this._layerOrderChanged=!0,this._layers[h]=m,this._removedLayers[h]&&m.source&&m.type!=="custom"){let C=this._removedLayers[h];delete this._removedLayers[h],C.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new u.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;let a=this._order.indexOf(t);this._order.splice(a,1);let h=i?this._order.indexOf(i):this._order.length;i&&h===-1?this.fire(new u.k(new Error(`Cannot move layer "${t}" before non-existing layer "${i}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();let i=this._layers[t];if(!i)return void this.fire(new u.k(new Error(`Cannot remove non-existing layer "${t}".`)));i.setEventedParent(null);let a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,i,a){this._checkLoaded();let h=this.getLayer(t);h?h.minzoom===i&&h.maxzoom===a||(i!=null&&(h.minzoom=i),a!=null&&(h.maxzoom=a),this._updateLayer(h)):this.fire(new u.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,i,a={}){this._checkLoaded();let h=this.getLayer(t);if(h){if(!u.bG(h.filter,i))return i==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(u.z.filter,`layers.${h.id}.filter`,i,null,a)||(h.setFilter(u.bJ(i)),this._updateLayer(h)))}else this.fire(new u.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return u.bJ(this.getLayer(t).filter)}setLayoutProperty(t,i,a,h={}){this._checkLoaded();let m=this.getLayer(t);m?u.bG(m.getLayoutProperty(i),a)||(m.setLayoutProperty(i,a,h),this._updateLayer(m)):this.fire(new u.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,i){let a=this.getLayer(t);if(a)return a.getLayoutProperty(i);this.fire(new u.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,i,a,h={}){this._checkLoaded();let m=this.getLayer(t);m?u.bG(m.getPaintProperty(i),a)||(m.setPaintProperty(i,a,h)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new u.k(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,i){return this.getLayer(t).getPaintProperty(i)}setFeatureState(t,i){this._checkLoaded();let a=t.source,h=t.sourceLayer,m=this.sourceCaches[a];if(m===void 0)return void this.fire(new u.k(new Error(`The source '${a}' does not exist in the map's style.`)));let v=m.getSource().type;v==="geojson"&&h?this.fire(new u.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||h?(t.id===void 0&&this.fire(new u.k(new Error("The feature id parameter must be provided."))),m.setFeatureState(h,t.id,i)):this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,i){this._checkLoaded();let a=t.source,h=this.sourceCaches[a];if(h===void 0)return void this.fire(new u.k(new Error(`The source '${a}' does not exist in the map's style.`)));let m=h.getSource().type,v=m==="vector"?t.sourceLayer:void 0;m!=="vector"||v?i&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new u.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(v,t.id,i):this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();let i=t.source,a=t.sourceLayer,h=this.sourceCaches[i];if(h!==void 0)return h.getSource().type!=="vector"||a?(t.id===void 0&&this.fire(new u.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(a,t.id)):void this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let t=u.bM(this.sourceCaches,m=>m.serialize()),i=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,h=this.stylesheet;return u.bN({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:t,layers:i,terrain:a},m=>m!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){let i=v=>this._layers[v].type==="fill-extrusion",a={},h=[];for(let v=this._order.length-1;v>=0;v--){let C=this._order[v];if(i(C)){a[C]=v;for(let P of t){let I=P[C];if(I)for(let D of I)h.push(D)}}}h.sort((v,C)=>C.intersectionZ-v.intersectionZ);let m=[];for(let v=this._order.length-1;v>=0;v--){let C=this._order[v];if(i(C))for(let P=h.length-1;P>=0;P--){let I=h[P].feature;if(a[I.layer.id]<v)break;m.push(I),h.pop()}else for(let P of t){let I=P[C];if(I)for(let D of I)m.push(D.feature)}}return m}queryRenderedFeatures(t,i,a){i&&i.filter&&this._validate(u.z.filter,"queryRenderedFeatures.filter",i.filter,null,i);let h={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new u.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let I of i.layers){let D=this._layers[I];if(!D)return this.fire(new u.k(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];h[D.source]=!0}}let m=[];i.availableImages=this._availableImages;let v=this._serializedAllLayers(),C=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,P=Object.assign(Object.assign({},i),{layers:C});for(let I in this.sourceCaches)i.layers&&!h[I]||m.push(nr(this.sourceCaches[I],this._layers,v,t,P,a,this.map.terrain?(D,F,O)=>this.map.terrain.getElevation(D,F,O):void 0));return this.placement&&m.push(function(I,D,F,O,Z,X,nt){let ct={},dt=X.queryRenderedSymbols(O),mt=[];for(let Ct of Object.keys(dt).map(Number))mt.push(nt[Ct]);mt.sort(ro);for(let Ct of mt){let yt=Ct.featureIndex.lookupSymbolFeatures(dt[Ct.bucketInstanceId],D,Ct.bucketIndex,Ct.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,I);for(let Lt in yt){let It=ct[Lt]=ct[Lt]||[],xt=yt[Lt];xt.sort((Ot,ue)=>{let te=Ct.featureSortOrder;if(te){let ne=te.indexOf(Ot.featureIndex);return te.indexOf(ue.featureIndex)-ne}return ue.featureIndex-Ot.featureIndex});for(let Ot of xt)It.push(Ot)}}return function(Ct,yt,Lt){for(let It in Ct)for(let xt of Ct[It])yr(xt,Lt[yt[It].source]);return Ct}(ct,I,F)}(this._layers,v,this.sourceCaches,t,P,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(t,i){i&&i.filter&&this._validate(u.z.filter,"querySourceFeatures.filter",i.filter,null,i);let a=this.sourceCaches[t];return a?function(h,m){let v=h.getRenderableIds().map(I=>h.getTileByID(I)),C=[],P={};for(let I=0;I<v.length;I++){let D=v[I],F=D.tileID.canonical.key;P[F]||(P[F]=!0,D.querySourceFeatures(C,m))}return C}(a,i):[]}getLight(){return this.light.getLight()}setLight(t,i={}){this._checkLoaded();let a=this.light.getLight(),h=!1;for(let v in t)if(!u.bG(t[v],a[v])){h=!0;break}if(!h)return;let m={now:re.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,i),this.light.updateTransitions(m)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,i={}){this._checkLoaded();let a=this.getSky(),h=!1;if(!t&&!a)return;if(t&&!a)h=!0;else if(!t&&a)h=!0;else for(let v in t)if(!u.bG(t[v],a[v])){h=!0;break}if(!h)return;let m={now:re.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,i),this.sky.updateTransitions(m)}_setProjectionInternal(t){let i=function(a){if(Array.isArray(a)){let h=new Nr({type:a});return{projection:h,transform:new _n,cameraHelper:new Sa(h)}}switch(a){case"mercator":return{projection:new ia,transform:new ii,cameraHelper:new jo};case"globe":{let h=new Nr({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:h,transform:new _n,cameraHelper:new Sa(h)}}case"vertical-perspective":return{projection:new vi,transform:new qs,cameraHelper:new jr};default:return u.w(`Unknown projection name: ${a}. Falling back to mercator projection.`),{projection:new ia,transform:new ii,cameraHelper:new jo}}}(t);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(let a in this.sourceCaches)this.sourceCaches[a].reload()}_validate(t,i,a,h,m={}){return(!m||m.validate!==!1)&&na(this,t.call(u.z,u.e({key:i,style:this.serialize(),value:a,styleSpec:u.v},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Kr().off(gs,this._rtlPluginLoaded);for(let i in this._layers)this._layers[i].setEventedParent(null);for(let i in this.sourceCaches){let a=this.sourceCaches[i];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(let i in this.sourceCaches)this.sourceCaches[i].update(t,this.map.terrain)}_generateCollisionBoxes(){for(let t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,i,a,h,m=!1){let v=!1,C=!1,P={};for(let I of this._order){let D=this._layers[I];if(D.type!=="symbol")continue;if(!P[D.source]){let O=this.sourceCaches[D.source];P[D.source]=O.getRenderableIds(!0).map(Z=>O.getTileByID(Z)).sort((Z,X)=>X.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(X.tileID)?-1:1))}let F=this.crossTileSymbolIndex.addLayer(D,P[D.source],t.center.lng);v=v||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(re.now(),t.zoom))&&(this.pauseablePlacement=new dn(t,this.map.terrain,this._order,m,i,a,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(re.now()),C=!0),v&&this.pauseablePlacement.placement.setStale()),C||v)for(let I of this._order){let D=this._layers[I];D.type==="symbol"&&this.placement.updateLayerOpacities(D,P[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(re.now())}_releaseSymbolFadeTiles(){for(let t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,i){return u._(this,void 0,void 0,function*(){let a=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();let h=this.sourceCaches[i.source];return h&&h.setDependencies(i.tileID.key,i.type,i.icons),a})}getGlyphs(t,i){return u._(this,void 0,void 0,function*(){let a=yield this.glyphManager.getGlyphs(i.stacks),h=this.sourceCaches[i.source];return h&&h.setDependencies(i.tileID.key,i.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,i={}){this._checkLoaded(),t&&this._validate(u.z.glyphs,"glyphs",t,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,i,a={},h){this._checkLoaded();let m=[{id:t,url:i}],v=[...Ri(this.stylesheet.sprite),...m];this._validate(u.z.sprite,"sprite",v,null,a)||(this.stylesheet.sprite=v,this._loadSprite(m,!0,h))}removeSprite(t){this._checkLoaded();let i=Ri(this.stylesheet.sprite);if(i.find(a=>a.id===t)){if(this._spritesImagesIds[t])for(let a of this._spritesImagesIds[t])this.imageManager.removeImage(a),this._changedImages[a]=!0;i.splice(i.findIndex(a=>a.id===t),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}else this.fire(new u.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Ri(this.stylesheet.sprite)}setSprite(t,i={},a){this._checkLoaded(),t&&this._validate(u.z.sprite,"sprite",t,null,i)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,a):(this._unloadSprite(),a&&a(null)))}}var Lr=u.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ir{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,i,a,h,m,v,C,P,I){this.context=t;let D=this.boundPaintVertexBuffers.length!==h.length;for(let F=0;!D&&F<h.length;F++)this.boundPaintVertexBuffers[F]!==h[F]&&(D=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==a||D||this.boundIndexBuffer!==m||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==P||this.boundDynamicVertexBuffer3!==I?this.freshBind(i,a,h,m,v,C,P,I):(t.bindVertexArray.set(this.vao),C&&C.bind(),m&&m.dynamicDraw&&m.bind(),P&&P.bind(),I&&I.bind())}freshBind(t,i,a,h,m,v,C,P){let I=t.numAttributes,D=this.context,F=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=h,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=P,i.enableAttributes(F,t);for(let O of a)O.enableAttributes(F,t);v&&v.enableAttributes(F,t),C&&C.enableAttributes(F,t),P&&P.enableAttributes(F,t),i.bind(),i.setVertexAttribPointers(F,t,m);for(let O of a)O.bind(),O.setVertexAttribPointers(F,t,m);v&&(v.bind(),v.setVertexAttribPointers(F,t,m)),h&&h.bind(),C&&(C.bind(),C.setVertexAttribPointers(F,t,m)),P&&(P.bind(),P.setVertexAttribPointers(F,t,m)),D.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let Ka=(d,t,i,a,h)=>({u_texture:0,u_ele_delta:d,u_fog_matrix:t,u_fog_color:i?i.properties.get("fog-color"):u.be.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:i?i.calculateFogBlendOpacity(a):0,u_horizon_color:i?i.properties.get("horizon-color"):u.be.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Xa={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Gr(d){let t=[];for(let i=0;i<d.length;i++){if(d[i]===null)continue;let a=d[i].split(" ");t.push(a.pop())}return t}class ws{constructor(t,i,a,h,m,v,C,P,I=[]){let D=t.gl;this.program=D.createProgram();let F=Gr(i.staticAttributes),O=a?a.getBinderAttributes():[],Z=F.concat(O),X=Xr.prelude.staticUniforms?Gr(Xr.prelude.staticUniforms):[],nt=C.staticUniforms?Gr(C.staticUniforms):[],ct=i.staticUniforms?Gr(i.staticUniforms):[],dt=a?a.getBinderUniforms():[],mt=X.concat(nt).concat(ct).concat(dt),Ct=[];for(let te of mt)Ct.indexOf(te)<0&&Ct.push(te);let yt=a?a.defines():[];Fr(D)&&yt.unshift("#version 300 es"),m&&yt.push("#define OVERDRAW_INSPECTOR;"),v&&yt.push("#define TERRAIN3D;"),P&&yt.push(P),I&&yt.push(...I);let Lt=yt.concat(Xr.prelude.fragmentSource,C.fragmentSource,i.fragmentSource).join(`
`),It=yt.concat(Xr.prelude.vertexSource,C.vertexSource,i.vertexSource).join(`
`);Fr(D)||(Lt=function(te){return te.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Lt),It=function(te){return te.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(It));let xt=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(xt,Lt),D.compileShader(xt),!D.getShaderParameter(xt,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(xt)}`);D.attachShader(this.program,xt);let Ot=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ot,It),D.compileShader(Ot),!D.getShaderParameter(Ot,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(Ot)}`);D.attachShader(this.program,Ot),this.attributes={};let ue={};this.numAttributes=Z.length;for(let te=0;te<this.numAttributes;te++)Z[te]&&(D.bindAttribLocation(this.program,te,Z[te]),this.attributes[Z[te]]=te);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(Ot),D.deleteShader(xt);for(let te=0;te<Ct.length;te++){let ne=Ct[te];if(ne&&!ue[ne]){let he=D.getUniformLocation(this.program,ne);he&&(ue[ne]=he)}}this.fixedUniforms=h(t,ue),this.terrainUniforms=((te,ne)=>({u_depth:new u.bO(te,ne.u_depth),u_terrain:new u.bO(te,ne.u_terrain),u_terrain_dim:new u.bf(te,ne.u_terrain_dim),u_terrain_matrix:new u.bQ(te,ne.u_terrain_matrix),u_terrain_unpack:new u.bR(te,ne.u_terrain_unpack),u_terrain_exaggeration:new u.bf(te,ne.u_terrain_exaggeration)}))(t,ue),this.projectionUniforms=((te,ne)=>({u_projection_matrix:new u.bQ(te,ne.u_projection_matrix),u_projection_tile_mercator_coords:new u.bR(te,ne.u_projection_tile_mercator_coords),u_projection_clipping_plane:new u.bR(te,ne.u_projection_clipping_plane),u_projection_transition:new u.bf(te,ne.u_projection_transition),u_projection_fallback_matrix:new u.bQ(te,ne.u_projection_fallback_matrix)}))(t,ue),this.binderUniforms=a?a.getUniforms(t,ue):[]}draw(t,i,a,h,m,v,C,P,I,D,F,O,Z,X,nt,ct,dt,mt,Ct){let yt=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(a),t.setStencilMode(h),t.setColorMode(m),t.setCullFace(v),P){t.activeTexture.set(yt.TEXTURE2),yt.bindTexture(yt.TEXTURE_2D,P.depthTexture),t.activeTexture.set(yt.TEXTURE3),yt.bindTexture(yt.TEXTURE_2D,P.texture);for(let It in this.terrainUniforms)this.terrainUniforms[It].set(P[It])}if(I)for(let It in I)this.projectionUniforms[Xa[It]].set(I[It]);if(C)for(let It in this.fixedUniforms)this.fixedUniforms[It].set(C[It]);ct&&ct.setUniforms(t,this.binderUniforms,X,{zoom:nt});let Lt=0;switch(i){case yt.LINES:Lt=2;break;case yt.TRIANGLES:Lt=3;break;case yt.LINE_STRIP:Lt=1}for(let It of Z.get()){let xt=It.vaos||(It.vaos={});(xt[D]||(xt[D]=new Ir)).bind(t,this,F,ct?ct.getPaintVertexBuffers():[],O,It.vertexOffset,dt,mt,Ct),yt.drawElements(i,It.primitiveLength*Lt,yt.UNSIGNED_SHORT,It.primitiveOffset*Lt*2)}}}function En(d,t,i){let a=1/u.aB(i,1,t.transform.tileZoom),h=Math.pow(2,i.tileID.overscaledZ),m=i.tileSize*Math.pow(2,t.transform.tileZoom)/h,v=m*(i.tileID.canonical.x+i.tileID.wrap*h),C=m*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[a,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[v>>16,C>>16],u_pixel_coord_lower:[65535&v,65535&C]}}let Yi=(d,t,i,a)=>{let h=d.style.light,m=h.properties.get("position"),v=[m.x,m.y,m.z],C=u.bU();h.properties.get("anchor")==="viewport"&&u.bV(C,d.transform.bearingInRadians),u.bW(v,v,C);let P=d.transform.transformLightDirection(v),I=h.properties.get("color");return{u_lightpos:v,u_lightpos_globe:P,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+t,u_opacity:i,u_fill_translate:a}},ka=(d,t,i,a,h,m,v)=>u.e(Yi(d,t,i,a),En(m,d,v),{u_height_factor:-Math.pow(2,h.overscaledZ)/v.tileSize/8}),oa=(d,t,i,a)=>u.e(En(t,d,i),{u_fill_translate:a}),An=(d,t)=>({u_world:d,u_fill_translate:t}),gn=(d,t,i,a,h)=>u.e(oa(d,t,i,h),{u_world:a}),Zo=(d,t,i,a,h)=>{let m=d.transform,v,C,P=0;if(i.paint.get("circle-pitch-alignment")==="map"){let I=u.aB(t,1,m.zoom);v=!0,C=[I,I],P=I/(u.$*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*h}else v=!1,C=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:C,u_globe_extrude_scale:P,u_translate:a}},Hs=d=>({u_pixel_extrude_scale:[1/d.width,1/d.height]}),aa=d=>({u_viewport_size:[d.width,d.height]}),In=(d,t=1)=>({u_color:d,u_overlay:0,u_overlay_scale:t}),Qr=(d,t,i,a)=>{let h=u.aB(d,1,t)/(u.$*Math.pow(2,d.tileID.overscaledZ))*2*Math.PI*a;return{u_extrude_scale:u.aB(d,1,t),u_intensity:i,u_globe_extrude_scale:h}},Zr=(d,t,i,a)=>{let h=u.L();u.bX(h,0,d.width,d.height,0,0,1);let m=d.context.gl;return{u_matrix:h,u_world:[m.drawingBufferWidth,m.drawingBufferHeight],u_image:i,u_color_ramp:a,u_opacity:t.paint.get("heatmap-opacity")}},Bn=(d,t,i)=>{let a=i.paint.get("hillshade-accent-color"),h;switch(i.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}let m=i.getIlluminationProperties();for(let v=0;v<m.directionRadians.length;v++)i.paint.get("hillshade-illumination-anchor")==="viewport"&&(m.directionRadians[v]+=d.transform.bearingInRadians);return{u_image:0,u_latrange:tn(0,t.tileID),u_exaggeration:i.paint.get("hillshade-exaggeration"),u_altitudes:m.altitudeRadians,u_azimuths:m.directionRadians,u_accent:a,u_method:h,u_highlights:m.highlightColor,u_shadows:m.shadowColor}},Ya=(d,t)=>{let i=t.stride,a=u.L();return u.bX(a,0,u.$,-8192,0,0,1),u.M(a,a,[0,-8192,0]),{u_matrix:a,u_image:1,u_dimension:[i,i],u_zoom:d.overscaledZ,u_unpack:t.getUnpackVector()}};function tn(d,t){let i=Math.pow(2,t.canonical.z),a=t.canonical.y;return[new u.a0(0,a/i).toLngLat().lat,new u.a0(0,(a+1)/i).toLngLat().lat]}let Bl=(d,t)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_opacity:d.paint.get("color-relief-opacity")}),Cs=(d,t,i,a)=>{let h=d.transform;return{u_translation:Qa(d,t,i),u_ratio:a/u.aB(t,1,h.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},la=(d,t,i,a,h)=>u.e(Cs(d,t,i,a),{u_image:0,u_image_height:h}),Vo=(d,t,i,a,h)=>{let m=d.transform,v=Uo(t,m);return{u_translation:Qa(d,t,i),u_texsize:t.imageAtlasTexture.size,u_ratio:a/u.aB(t,1,m.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[v,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Ja=(d,t,i,a,h,m)=>{let v=d.lineAtlas,C=Uo(t,d.transform),P=i.layout.get("line-cap")==="round",I=v.getDash(h.from,P),D=v.getDash(h.to,P),F=I.width*m.fromScale,O=D.width*m.toScale;return u.e(Cs(d,t,i,a),{u_patternscale_a:[C/F,-I.height/2],u_patternscale_b:[C/O,-D.height/2],u_sdfgamma:v.width/(256*Math.min(F,O)*d.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:D.y,u_mix:m.t})};function Uo(d,t){return 1/u.aB(d,1,t.tileZoom)}function Qa(d,t,i){return u.aC(d.transform,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}let Br=(d,t,i,a,h)=>{return{u_tl_parent:d,u_scale_parent:t,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*a.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:a.paint.get("raster-brightness-min"),u_brightness_high:a.paint.get("raster-brightness-max"),u_saturation_factor:(v=a.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(m=a.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:ua(a.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var m,v};function ua(d){d*=Math.PI/180;let t=Math.sin(d),i=Math.cos(d);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}let tl=(d,t,i,a,h,m,v,C,P,I,D,F,O)=>{let Z=v.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:Z.width/Z.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:C,u_coord_matrix:P,u_is_text:+D,u_pitch_with_map:+a,u_is_along_line:h,u_is_variable_anchor:m,u_texsize:F,u_texture:0,u_translation:I,u_pitched_scale:O}},Ms=(d,t,i,a,h,m,v,C,P,I,D,F,O,Z)=>{let X=v.transform;return u.e(tl(d,t,i,a,h,m,v,C,P,I,D,F,Z),{u_gamma_scale:a?Math.cos(X.pitch*Math.PI/180)*X.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},uo=(d,t,i,a,h,m,v,C,P,I,D,F,O)=>u.e(Ms(d,t,i,a,h,m,v,C,P,I,!0,D,0,O),{u_texsize_icon:F,u_texture_icon:1}),yn=(d,t)=>({u_opacity:d,u_color:t}),Dl=(d,t,i,a,h)=>u.e(function(m,v,C,P){let I=C.imageManager.getPattern(m.from.toString()),D=C.imageManager.getPattern(m.to.toString()),{width:F,height:O}=C.imageManager.getPixelSize(),Z=Math.pow(2,P.tileID.overscaledZ),X=P.tileSize*Math.pow(2,C.transform.tileZoom)/Z,nt=X*(P.tileID.canonical.x+P.tileID.wrap*Z),ct=X*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[F,O],u_mix:v.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/u.aB(P,1,C.transform.tileZoom),u_pixel_coord_upper:[nt>>16,ct>>16],u_pixel_coord_lower:[65535&nt,65535&ct]}}(i,h,t,a),{u_opacity:d}),vn=(d,t)=>{},vl={fillExtrusion:(d,t)=>({u_lightpos:new u.bS(d,t.u_lightpos),u_lightpos_globe:new u.bS(d,t.u_lightpos_globe),u_lightintensity:new u.bf(d,t.u_lightintensity),u_lightcolor:new u.bS(d,t.u_lightcolor),u_vertical_gradient:new u.bf(d,t.u_vertical_gradient),u_opacity:new u.bf(d,t.u_opacity),u_fill_translate:new u.bT(d,t.u_fill_translate)}),fillExtrusionPattern:(d,t)=>({u_lightpos:new u.bS(d,t.u_lightpos),u_lightpos_globe:new u.bS(d,t.u_lightpos_globe),u_lightintensity:new u.bf(d,t.u_lightintensity),u_lightcolor:new u.bS(d,t.u_lightcolor),u_vertical_gradient:new u.bf(d,t.u_vertical_gradient),u_height_factor:new u.bf(d,t.u_height_factor),u_opacity:new u.bf(d,t.u_opacity),u_fill_translate:new u.bT(d,t.u_fill_translate),u_image:new u.bO(d,t.u_image),u_texsize:new u.bT(d,t.u_texsize),u_pixel_coord_upper:new u.bT(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.bT(d,t.u_pixel_coord_lower),u_scale:new u.bS(d,t.u_scale),u_fade:new u.bf(d,t.u_fade)}),fill:(d,t)=>({u_fill_translate:new u.bT(d,t.u_fill_translate)}),fillPattern:(d,t)=>({u_image:new u.bO(d,t.u_image),u_texsize:new u.bT(d,t.u_texsize),u_pixel_coord_upper:new u.bT(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.bT(d,t.u_pixel_coord_lower),u_scale:new u.bS(d,t.u_scale),u_fade:new u.bf(d,t.u_fade),u_fill_translate:new u.bT(d,t.u_fill_translate)}),fillOutline:(d,t)=>({u_world:new u.bT(d,t.u_world),u_fill_translate:new u.bT(d,t.u_fill_translate)}),fillOutlinePattern:(d,t)=>({u_world:new u.bT(d,t.u_world),u_image:new u.bO(d,t.u_image),u_texsize:new u.bT(d,t.u_texsize),u_pixel_coord_upper:new u.bT(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.bT(d,t.u_pixel_coord_lower),u_scale:new u.bS(d,t.u_scale),u_fade:new u.bf(d,t.u_fade),u_fill_translate:new u.bT(d,t.u_fill_translate)}),circle:(d,t)=>({u_camera_to_center_distance:new u.bf(d,t.u_camera_to_center_distance),u_scale_with_map:new u.bO(d,t.u_scale_with_map),u_pitch_with_map:new u.bO(d,t.u_pitch_with_map),u_extrude_scale:new u.bT(d,t.u_extrude_scale),u_device_pixel_ratio:new u.bf(d,t.u_device_pixel_ratio),u_globe_extrude_scale:new u.bf(d,t.u_globe_extrude_scale),u_translate:new u.bT(d,t.u_translate)}),collisionBox:(d,t)=>({u_pixel_extrude_scale:new u.bT(d,t.u_pixel_extrude_scale)}),collisionCircle:(d,t)=>({u_viewport_size:new u.bT(d,t.u_viewport_size)}),debug:(d,t)=>({u_color:new u.bP(d,t.u_color),u_overlay:new u.bO(d,t.u_overlay),u_overlay_scale:new u.bf(d,t.u_overlay_scale)}),depth:vn,clippingMask:vn,heatmap:(d,t)=>({u_extrude_scale:new u.bf(d,t.u_extrude_scale),u_intensity:new u.bf(d,t.u_intensity),u_globe_extrude_scale:new u.bf(d,t.u_globe_extrude_scale)}),heatmapTexture:(d,t)=>({u_matrix:new u.bQ(d,t.u_matrix),u_world:new u.bT(d,t.u_world),u_image:new u.bO(d,t.u_image),u_color_ramp:new u.bO(d,t.u_color_ramp),u_opacity:new u.bf(d,t.u_opacity)}),hillshade:(d,t)=>({u_image:new u.bO(d,t.u_image),u_latrange:new u.bT(d,t.u_latrange),u_exaggeration:new u.bf(d,t.u_exaggeration),u_altitudes:new u.bZ(d,t.u_altitudes),u_azimuths:new u.bZ(d,t.u_azimuths),u_accent:new u.bP(d,t.u_accent),u_method:new u.bO(d,t.u_method),u_shadows:new u.bY(d,t.u_shadows),u_highlights:new u.bY(d,t.u_highlights)}),hillshadePrepare:(d,t)=>({u_matrix:new u.bQ(d,t.u_matrix),u_image:new u.bO(d,t.u_image),u_dimension:new u.bT(d,t.u_dimension),u_zoom:new u.bf(d,t.u_zoom),u_unpack:new u.bR(d,t.u_unpack)}),colorRelief:(d,t)=>({u_image:new u.bO(d,t.u_image),u_unpack:new u.bR(d,t.u_unpack),u_dimension:new u.bT(d,t.u_dimension),u_elevation_stops:new u.bO(d,t.u_elevation_stops),u_color_stops:new u.bO(d,t.u_color_stops),u_opacity:new u.bf(d,t.u_opacity)}),line:(d,t)=>({u_translation:new u.bT(d,t.u_translation),u_ratio:new u.bf(d,t.u_ratio),u_device_pixel_ratio:new u.bf(d,t.u_device_pixel_ratio),u_units_to_pixels:new u.bT(d,t.u_units_to_pixels)}),lineGradient:(d,t)=>({u_translation:new u.bT(d,t.u_translation),u_ratio:new u.bf(d,t.u_ratio),u_device_pixel_ratio:new u.bf(d,t.u_device_pixel_ratio),u_units_to_pixels:new u.bT(d,t.u_units_to_pixels),u_image:new u.bO(d,t.u_image),u_image_height:new u.bf(d,t.u_image_height)}),linePattern:(d,t)=>({u_translation:new u.bT(d,t.u_translation),u_texsize:new u.bT(d,t.u_texsize),u_ratio:new u.bf(d,t.u_ratio),u_device_pixel_ratio:new u.bf(d,t.u_device_pixel_ratio),u_image:new u.bO(d,t.u_image),u_units_to_pixels:new u.bT(d,t.u_units_to_pixels),u_scale:new u.bS(d,t.u_scale),u_fade:new u.bf(d,t.u_fade)}),lineSDF:(d,t)=>({u_translation:new u.bT(d,t.u_translation),u_ratio:new u.bf(d,t.u_ratio),u_device_pixel_ratio:new u.bf(d,t.u_device_pixel_ratio),u_units_to_pixels:new u.bT(d,t.u_units_to_pixels),u_patternscale_a:new u.bT(d,t.u_patternscale_a),u_patternscale_b:new u.bT(d,t.u_patternscale_b),u_sdfgamma:new u.bf(d,t.u_sdfgamma),u_image:new u.bO(d,t.u_image),u_tex_y_a:new u.bf(d,t.u_tex_y_a),u_tex_y_b:new u.bf(d,t.u_tex_y_b),u_mix:new u.bf(d,t.u_mix)}),raster:(d,t)=>({u_tl_parent:new u.bT(d,t.u_tl_parent),u_scale_parent:new u.bf(d,t.u_scale_parent),u_buffer_scale:new u.bf(d,t.u_buffer_scale),u_fade_t:new u.bf(d,t.u_fade_t),u_opacity:new u.bf(d,t.u_opacity),u_image0:new u.bO(d,t.u_image0),u_image1:new u.bO(d,t.u_image1),u_brightness_low:new u.bf(d,t.u_brightness_low),u_brightness_high:new u.bf(d,t.u_brightness_high),u_saturation_factor:new u.bf(d,t.u_saturation_factor),u_contrast_factor:new u.bf(d,t.u_contrast_factor),u_spin_weights:new u.bS(d,t.u_spin_weights),u_coords_top:new u.bR(d,t.u_coords_top),u_coords_bottom:new u.bR(d,t.u_coords_bottom)}),symbolIcon:(d,t)=>({u_is_size_zoom_constant:new u.bO(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bO(d,t.u_is_size_feature_constant),u_size_t:new u.bf(d,t.u_size_t),u_size:new u.bf(d,t.u_size),u_camera_to_center_distance:new u.bf(d,t.u_camera_to_center_distance),u_pitch:new u.bf(d,t.u_pitch),u_rotate_symbol:new u.bO(d,t.u_rotate_symbol),u_aspect_ratio:new u.bf(d,t.u_aspect_ratio),u_fade_change:new u.bf(d,t.u_fade_change),u_label_plane_matrix:new u.bQ(d,t.u_label_plane_matrix),u_coord_matrix:new u.bQ(d,t.u_coord_matrix),u_is_text:new u.bO(d,t.u_is_text),u_pitch_with_map:new u.bO(d,t.u_pitch_with_map),u_is_along_line:new u.bO(d,t.u_is_along_line),u_is_variable_anchor:new u.bO(d,t.u_is_variable_anchor),u_texsize:new u.bT(d,t.u_texsize),u_texture:new u.bO(d,t.u_texture),u_translation:new u.bT(d,t.u_translation),u_pitched_scale:new u.bf(d,t.u_pitched_scale)}),symbolSDF:(d,t)=>({u_is_size_zoom_constant:new u.bO(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bO(d,t.u_is_size_feature_constant),u_size_t:new u.bf(d,t.u_size_t),u_size:new u.bf(d,t.u_size),u_camera_to_center_distance:new u.bf(d,t.u_camera_to_center_distance),u_pitch:new u.bf(d,t.u_pitch),u_rotate_symbol:new u.bO(d,t.u_rotate_symbol),u_aspect_ratio:new u.bf(d,t.u_aspect_ratio),u_fade_change:new u.bf(d,t.u_fade_change),u_label_plane_matrix:new u.bQ(d,t.u_label_plane_matrix),u_coord_matrix:new u.bQ(d,t.u_coord_matrix),u_is_text:new u.bO(d,t.u_is_text),u_pitch_with_map:new u.bO(d,t.u_pitch_with_map),u_is_along_line:new u.bO(d,t.u_is_along_line),u_is_variable_anchor:new u.bO(d,t.u_is_variable_anchor),u_texsize:new u.bT(d,t.u_texsize),u_texture:new u.bO(d,t.u_texture),u_gamma_scale:new u.bf(d,t.u_gamma_scale),u_device_pixel_ratio:new u.bf(d,t.u_device_pixel_ratio),u_is_halo:new u.bO(d,t.u_is_halo),u_translation:new u.bT(d,t.u_translation),u_pitched_scale:new u.bf(d,t.u_pitched_scale)}),symbolTextAndIcon:(d,t)=>({u_is_size_zoom_constant:new u.bO(d,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bO(d,t.u_is_size_feature_constant),u_size_t:new u.bf(d,t.u_size_t),u_size:new u.bf(d,t.u_size),u_camera_to_center_distance:new u.bf(d,t.u_camera_to_center_distance),u_pitch:new u.bf(d,t.u_pitch),u_rotate_symbol:new u.bO(d,t.u_rotate_symbol),u_aspect_ratio:new u.bf(d,t.u_aspect_ratio),u_fade_change:new u.bf(d,t.u_fade_change),u_label_plane_matrix:new u.bQ(d,t.u_label_plane_matrix),u_coord_matrix:new u.bQ(d,t.u_coord_matrix),u_is_text:new u.bO(d,t.u_is_text),u_pitch_with_map:new u.bO(d,t.u_pitch_with_map),u_is_along_line:new u.bO(d,t.u_is_along_line),u_is_variable_anchor:new u.bO(d,t.u_is_variable_anchor),u_texsize:new u.bT(d,t.u_texsize),u_texsize_icon:new u.bT(d,t.u_texsize_icon),u_texture:new u.bO(d,t.u_texture),u_texture_icon:new u.bO(d,t.u_texture_icon),u_gamma_scale:new u.bf(d,t.u_gamma_scale),u_device_pixel_ratio:new u.bf(d,t.u_device_pixel_ratio),u_is_halo:new u.bO(d,t.u_is_halo),u_translation:new u.bT(d,t.u_translation),u_pitched_scale:new u.bf(d,t.u_pitched_scale)}),background:(d,t)=>({u_opacity:new u.bf(d,t.u_opacity),u_color:new u.bP(d,t.u_color)}),backgroundPattern:(d,t)=>({u_opacity:new u.bf(d,t.u_opacity),u_image:new u.bO(d,t.u_image),u_pattern_tl_a:new u.bT(d,t.u_pattern_tl_a),u_pattern_br_a:new u.bT(d,t.u_pattern_br_a),u_pattern_tl_b:new u.bT(d,t.u_pattern_tl_b),u_pattern_br_b:new u.bT(d,t.u_pattern_br_b),u_texsize:new u.bT(d,t.u_texsize),u_mix:new u.bf(d,t.u_mix),u_pattern_size_a:new u.bT(d,t.u_pattern_size_a),u_pattern_size_b:new u.bT(d,t.u_pattern_size_b),u_scale_a:new u.bf(d,t.u_scale_a),u_scale_b:new u.bf(d,t.u_scale_b),u_pixel_coord_upper:new u.bT(d,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.bT(d,t.u_pixel_coord_lower),u_tile_units_to_pixels:new u.bf(d,t.u_tile_units_to_pixels)}),terrain:(d,t)=>({u_texture:new u.bO(d,t.u_texture),u_ele_delta:new u.bf(d,t.u_ele_delta),u_fog_matrix:new u.bQ(d,t.u_fog_matrix),u_fog_color:new u.bP(d,t.u_fog_color),u_fog_ground_blend:new u.bf(d,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new u.bf(d,t.u_fog_ground_blend_opacity),u_horizon_color:new u.bP(d,t.u_horizon_color),u_horizon_fog_blend:new u.bf(d,t.u_horizon_fog_blend),u_is_globe_mode:new u.bf(d,t.u_is_globe_mode)}),terrainDepth:(d,t)=>({u_ele_delta:new u.bf(d,t.u_ele_delta)}),terrainCoords:(d,t)=>({u_texture:new u.bO(d,t.u_texture),u_terrain_coords_id:new u.bf(d,t.u_terrain_coords_id),u_ele_delta:new u.bf(d,t.u_ele_delta)}),projectionErrorMeasurement:(d,t)=>({u_input:new u.bf(d,t.u_input),u_output_expected:new u.bf(d,t.u_output_expected)}),atmosphere:(d,t)=>({u_sun_pos:new u.bS(d,t.u_sun_pos),u_atmosphere_blend:new u.bf(d,t.u_atmosphere_blend),u_globe_position:new u.bS(d,t.u_globe_position),u_globe_radius:new u.bf(d,t.u_globe_radius),u_inv_proj_matrix:new u.bQ(d,t.u_inv_proj_matrix)}),sky:(d,t)=>({u_sky_color:new u.bP(d,t.u_sky_color),u_horizon_color:new u.bP(d,t.u_horizon_color),u_horizon:new u.bT(d,t.u_horizon),u_horizon_normal:new u.bT(d,t.u_horizon_normal),u_sky_horizon_blend:new u.bf(d,t.u_sky_horizon_blend),u_sky_blend:new u.bf(d,t.u_sky_blend)})};class hs{constructor(t,i,a){this.context=t;let h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){let i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let ho={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ws{constructor(t,i,a,h){this.length=i.length,this.attributes=a,this.itemSize=i.bytesPerElement,this.dynamicDraw=h,this.context=t;let m=t.gl;this.buffer=m.createBuffer(),t.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);let i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,i){for(let a=0;a<this.attributes.length;a++){let h=i.attributes[this.attributes[a].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,i,a){for(let h=0;h<this.attributes.length;h++){let m=this.attributes[h],v=i.attributes[m.name];v!==void 0&&t.vertexAttribPointer(v,m.components,t[ho[m.type]],!1,this.itemSize,m.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ci{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class co extends Ci{getDefault(){return u.be.transparent}set(t){let i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Yn extends Ci{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class po extends Ci{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ks extends Ci{getDefault(){return[!0,!0,!0,!0]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fo extends Ci{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ea extends Ci{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Aa extends Ci{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){let i=this.current;(t.func!==i.func||t.ref!==i.ref||t.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class mo extends Ci{getDefault(){let t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class _o extends Ci{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=t,this.dirty=!1}}class el extends Ci{getDefault(){return[0,1]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class il extends Ci{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=t,this.dirty=!1}}class rl extends Ci{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class xl extends Ci{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.BLEND):i.disable(i.BLEND),this.current=t,this.dirty=!1}}class ha extends Ci{getDefault(){let t=this.gl;return[t.ONE,t.ZERO]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Jn extends Ci{getDefault(){return u.be.transparent}set(t){let i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ca extends Ci{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ia extends Ci{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=t,this.dirty=!1}}class go extends Ci{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Xs extends Ci{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ba extends Ci{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class yo extends Ci{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ls extends Ci{getDefault(){let t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class $o extends Ci{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Tr extends Ci{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class nl extends Ci{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindTexture(i.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class sl extends Ci{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ol extends Ci{getDefault(){return null}set(t){let i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Dr extends Ci{getDefault(){return null}set(t){var i;if(t===this.current&&!this.dirty)return;let a=this.gl;Fr(a)?a.bindVertexArray(t):(i=a.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class vo extends Ci{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class pa extends Ci{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ts extends Ci{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class xo extends Ci{constructor(t,i){super(t),this.context=t,this.parent=i}getDefault(){return null}}class bo extends xo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class cs extends xo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class wo extends xo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}let qo="Framebuffer is not complete";class en{constructor(t,i,a,h,m){this.context=t,this.width=i,this.height=a;let v=t.gl,C=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new bo(t,C),h)this.depthAttachment=m?new wo(t,C):new cs(t,C);else if(m)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(qo)}destroy(){let t=this.context.gl,i=this.colorAttachment.get();if(i&&t.deleteTexture(i),this.depthAttachment){let a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}t.deleteFramebuffer(this.framebuffer)}}class Ke{constructor(t){var i,a;if(this.gl=t,this.clearColor=new co(this),this.clearDepth=new Yn(this),this.clearStencil=new po(this),this.colorMask=new Ks(this),this.depthMask=new fo(this),this.stencilMask=new Ea(this),this.stencilFunc=new Aa(this),this.stencilOp=new mo(this),this.stencilTest=new _o(this),this.depthRange=new el(this),this.depthTest=new il(this),this.depthFunc=new rl(this),this.blend=new xl(this),this.blendFunc=new ha(this),this.blendColor=new Jn(this),this.blendEquation=new ca(this),this.cullFace=new Ia(this),this.cullFaceSide=new go(this),this.frontFace=new Xs(this),this.program=new Ba(this),this.activeTexture=new yo(this),this.viewport=new Ls(this),this.bindFramebuffer=new $o(this),this.bindRenderbuffer=new Tr(this),this.bindTexture=new nl(this),this.bindVertexBuffer=new sl(this),this.bindElementBuffer=new ol(this),this.bindVertexArray=new Dr(this),this.pixelStoreUnpack=new vo(this),this.pixelStoreUnpackPremultiplyAlpha=new pa(this),this.pixelStoreUnpackFlipY=new Ts(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Fr(t)){this.HALF_FLOAT=t.HALF_FLOAT;let h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=t.RGBA16F)!==null&&i!==void 0?i:h?.RGBA16F_EXT,this.RGB16F=(a=t.RGB16F)!==null&&a!==void 0?a:h?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");let h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,i){return new hs(this,t,i)}createVertexBuffer(t,i,a){return new Ws(this,t,i,a)}createRenderbuffer(t,i,a){let h=this.gl,m=h.createRenderbuffer();return this.bindRenderbuffer.set(m),h.renderbufferStorage(h.RENDERBUFFER,t,i,a),this.bindRenderbuffer.set(null),m}createFramebuffer(t,i,a,h){return new en(this,t,i,a,h)}clear({color:t,depth:i,stencil:a}){let h=this.gl,m=0;t&&(m|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(m|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),a!==void 0&&(m|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),h.clear(m)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){u.bG(t.blendFunction,ai.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Fr(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var i;return Fr(this.gl)?this.gl.deleteVertexArray(t):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Ps;function xn(d,t,i,a,h){let m=d.context,v=d.transform,C=m.gl,P=d.useProgram("collisionBox"),I=[],D=0,F=0;for(let dt=0;dt<a.length;dt++){let mt=a[dt],Ct=t.getTile(mt).getBucket(i);if(!Ct)continue;let yt=h?Ct.textCollisionBox:Ct.iconCollisionBox,Lt=Ct.collisionCircleArray;Lt.length>0&&(I.push({circleArray:Lt,circleOffset:F,coord:mt}),D+=Lt.length/4,F=D),yt&&P.draw(m,C.LINES,Ve.disabled,He.disabled,d.colorModeForRenderPass(),Qe.disabled,Hs(d.transform),d.style.map.terrain&&d.style.map.terrain.getTerrainData(mt),v.getProjectionData({overscaledTileID:mt,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,null,d.transform.zoom,null,null,yt.collisionVertexBuffer)}if(!h||!I.length)return;let O=d.useProgram("collisionCircle"),Z=new u.b_;Z.resize(4*D),Z._trim();let X=0;for(let dt of I)for(let mt=0;mt<dt.circleArray.length/4;mt++){let Ct=4*mt,yt=dt.circleArray[Ct+0],Lt=dt.circleArray[Ct+1],It=dt.circleArray[Ct+2],xt=dt.circleArray[Ct+3];Z.emplace(X++,yt,Lt,It,xt,0),Z.emplace(X++,yt,Lt,It,xt,1),Z.emplace(X++,yt,Lt,It,xt,2),Z.emplace(X++,yt,Lt,It,xt,3)}(!Ps||Ps.length<2*D)&&(Ps=function(dt){let mt=2*dt,Ct=new u.c0;Ct.resize(mt),Ct._trim();for(let yt=0;yt<mt;yt++){let Lt=6*yt;Ct.uint16[Lt+0]=4*yt+0,Ct.uint16[Lt+1]=4*yt+1,Ct.uint16[Lt+2]=4*yt+2,Ct.uint16[Lt+3]=4*yt+2,Ct.uint16[Lt+4]=4*yt+3,Ct.uint16[Lt+5]=4*yt+0}return Ct}(D));let nt=m.createIndexBuffer(Ps,!0),ct=m.createVertexBuffer(Z,u.b$.members,!0);for(let dt of I){let mt=aa(d.transform);O.draw(m,C.TRIANGLES,Ve.disabled,He.disabled,d.colorModeForRenderPass(),Qe.disabled,mt,d.style.map.terrain&&d.style.map.terrain.getTerrainData(dt.coord),null,i.id,ct,nt,u.aL.simpleSegment(0,2*dt.circleOffset,dt.circleArray.length,dt.circleArray.length/2),null,d.transform.zoom,null,null,null)}ct.destroy(),nt.destroy()}let ri=u.af(new Float32Array(16));function Ys(d,t,i,a,h,m){let{horizontalAlign:v,verticalAlign:C}=u.aG(d);return new u.P((-(v-.5)*t/h+a[0])*m,(-(C-.5)*i/h+a[1])*m)}function al(d,t,i,a,h,m){let v=t.tileAnchorPoint.add(new u.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let C=a.mult(m);i||(C=C.rotate(-h));let P=v.add(C);return Ti(P.x,P.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(i){let C=Pe(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(d),P=Math.atan(C.y/C.x)+(C.x<0?Math.PI:0);return d.add(a.rotate(P))}return d.add(a)}function Ss(d,t,i,a,h,m,v,C,P,I,D,F){let O=d.text.placedSymbolArray,Z=d.text.dynamicLayoutVertexArray,X=d.icon.dynamicLayoutVertexArray,nt={};Z.clear();for(let ct=0;ct<O.length;ct++){let dt=O.get(ct),mt=dt.hidden||!dt.crossTileID||d.allowVerticalPlacement&&!dt.placedOrientation?null:a[dt.crossTileID];if(mt){let Ct=new u.P(dt.anchorX,dt.anchorY),yt={getElevation:F,width:h.width,height:h.height,pitchedLabelPlaneMatrix:m,pitchWithMap:i,transform:h,tileAnchorPoint:Ct,translation:I,unwrappedTileID:D},Lt=i?ui(Ct.x,Ct.y,yt):Pe(Ct.x,Ct.y,yt),It=Ge(h.cameraToCenterDistance,Lt.signedDistanceFromCamera),xt=u.ao(d.textSizeData,C,dt)*It/u.aA;i&&(xt*=d.tilePixelRatio/v);let{width:Ot,height:ue,anchor:te,textOffset:ne,textBoxScale:he}=mt,Ee=Ys(te,Ot,ue,ne,he,xt),ke=h.getPitchedTextCorrection(Ct.x+I[0],Ct.y+I[1],D),xe=al(Lt.point,yt,t,Ee,-h.bearingInRadians,ke),Re=d.allowVerticalPlacement&&dt.placedOrientation===u.an.vertical?Math.PI/2:0;for(let _i=0;_i<dt.numGlyphs;_i++)u.au(Z,xe,Re);P&&dt.associatedIconIndex>=0&&(nt[dt.associatedIconIndex]={shiftedAnchor:xe,angle:Re})}else ys(dt.numGlyphs,Z)}if(P){X.clear();let ct=d.icon.placedSymbolArray;for(let dt=0;dt<ct.length;dt++){let mt=ct.get(dt);if(mt.hidden)ys(mt.numGlyphs,X);else{let Ct=nt[dt];if(Ct)for(let yt=0;yt<mt.numGlyphs;yt++)u.au(X,Ct.shiftedAnchor,Ct.angle);else ys(mt.numGlyphs,X)}}d.icon.dynamicLayoutVertexBuffer.updateData(X)}d.text.dynamicLayoutVertexBuffer.updateData(Z)}function ur(d,t,i){return i.iconsInText&&t?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function ll(d,t,i,a,h,m,v,C,P,I,D,F,O){let Z=d.context,X=Z.gl,nt=d.transform,ct=C==="map",dt=P==="map",mt=C!=="viewport"&&i.layout.get("symbol-placement")!=="point",Ct=ct&&!dt&&!mt,yt=!i.layout.get("symbol-sort-key").isConstant(),Lt=!1,It=d.getDepthModeForSublayer(0,Ve.ReadOnly),xt=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ot=[],ue=nt.getCircleRadiusCorrection();for(let te of a){let ne=t.getTile(te),he=ne.getBucket(i);if(!he)continue;let Ee=h?he.text:he.icon;if(!Ee||!Ee.segments.get().length||!Ee.hasVisibleVertices)continue;let ke=Ee.programConfigurations.get(i.id),xe=h||he.sdfIcons,Re=h?he.textSizeData:he.iconSizeData,_i=dt||nt.pitch!==0,Di=d.useProgram(ur(xe,h,he),ke),hr=u.am(Re,nt.zoom),Vi=d.style.map.terrain&&d.style.map.terrain.getTerrainData(te),cr,qi,Ui,Hi,bn=[0,0],ki=null;if(h)qi=ne.glyphAtlasTexture,Ui=X.LINEAR,cr=ne.glyphAtlasTexture.size,he.iconsInText&&(bn=ne.imageAtlasTexture.size,ki=ne.imageAtlasTexture,Hi=_i||d.options.rotating||d.options.zooming||Re.kind==="composite"||Re.kind==="camera"?X.LINEAR:X.NEAREST);else{let br=i.layout.get("icon-size").constantOr(0)!==1||he.iconsNeedLinear;qi=ne.imageAtlasTexture,Ui=xe||d.options.rotating||d.options.zooming||br||_i?X.LINEAR:X.NEAREST,cr=ne.imageAtlasTexture.size}let sn=u.aB(ne,1,d.transform.zoom),wn=Je(ct,d.transform,sn),Na=u.L();u.ap(Na,wn);let ja=Oi(dt,ct,d.transform,sn),Ga=u.aC(nt,ne,m,v),Ko=nt.getProjectionData({overscaledTileID:te,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Ul=xt&&he.hasTextData(),$l=i.layout.get("icon-text-fit")!=="none"&&Ul&&he.hasIconData();if(mt){let br=d.style.map.terrain?(ts,$r)=>d.style.map.terrain.getElevation(te,ts,$r):null,Qi=i.layout.get("text-rotation-alignment")==="map";sr(he,d,h,wn,Na,dt,I,Qi,te.toUnwrapped(),nt.width,nt.height,Ga,br)}let Ll=h&&xt||$l,fs=mt||Ll?ri:dt?wn:d.transform.clipSpaceToPixelsMatrix,Eo=xe&&i.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Za;Za=xe?he.iconsInText?uo(Re.kind,hr,Ct,dt,mt,Ll,d,fs,ja,Ga,cr,bn,ue):Ms(Re.kind,hr,Ct,dt,mt,Ll,d,fs,ja,Ga,h,cr,0,ue):tl(Re.kind,hr,Ct,dt,mt,Ll,d,fs,ja,Ga,h,cr,ue);let pl={program:Di,buffers:Ee,uniformValues:Za,projectionData:Ko,atlasTexture:qi,atlasTextureIcon:ki,atlasInterpolation:Ui,atlasInterpolationIcon:Hi,isSDF:xe,hasHalo:Eo};if(yt&&he.canOverlap){Lt=!0;let br=Ee.segments.get();for(let Qi of br)Ot.push({segments:new u.aL([Qi]),sortKey:Qi.sortKey,state:pl,terrainData:Vi})}else Ot.push({segments:Ee.segments,sortKey:0,state:pl,terrainData:Vi})}Lt&&Ot.sort((te,ne)=>te.sortKey-ne.sortKey);for(let te of Ot){let ne=te.state;if(Z.activeTexture.set(X.TEXTURE0),ne.atlasTexture.bind(ne.atlasInterpolation,X.CLAMP_TO_EDGE),ne.atlasTextureIcon&&(Z.activeTexture.set(X.TEXTURE1),ne.atlasTextureIcon&&ne.atlasTextureIcon.bind(ne.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),ne.isSDF){let he=ne.uniformValues;ne.hasHalo&&(he.u_is_halo=1,s(ne.buffers,te.segments,i,d,ne.program,It,D,F,he,ne.projectionData,te.terrainData)),he.u_is_halo=0}s(ne.buffers,te.segments,i,d,ne.program,It,D,F,ne.uniformValues,ne.projectionData,te.terrainData)}}function s(d,t,i,a,h,m,v,C,P,I,D){let F=a.context;h.draw(F,F.gl.TRIANGLES,m,v,C,Qe.backCCW,P,D,I,i.id,d.layoutVertexBuffer,d.indexBuffer,t,i.paint,a.transform.zoom,d.programConfigurations.get(i.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function f(d,t,i,a,h){let m=d.context,v=m.gl,C=He.disabled,P=new ai([v.ONE,v.ONE],u.be.transparent,[!0,!0,!0,!0]),I=t.getBucket(i);if(!I)return;let D=a.key,F=i.heatmapFbos.get(D);F||(F=E(m,t.tileSize,t.tileSize),i.heatmapFbos.set(D,F)),m.bindFramebuffer.set(F.framebuffer),m.viewport.set([0,0,t.tileSize,t.tileSize]),m.clear({color:u.be.transparent});let O=I.programConfigurations.get(i.id),Z=d.useProgram("heatmap",O,!h),X=d.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),nt=d.style.map.terrain.getTerrainData(a);Z.draw(m,v.TRIANGLES,Ve.disabled,C,P,Qe.disabled,Qr(t,d.transform.zoom,i.paint.get("heatmap-intensity"),1),nt,X,i.id,I.layoutVertexBuffer,I.indexBuffer,I.segments,i.paint,d.transform.zoom,O)}function w(d,t,i,a,h){let m=d.context,v=m.gl,C=d.transform;m.setColorMode(d.colorModeForRenderPass());let P=N(m,t),I=i.key,D=t.heatmapFbos.get(I);if(!D)return;m.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,D.colorAttachment.get()),m.activeTexture.set(v.TEXTURE1),P.bind(v.LINEAR,v.CLAMP_TO_EDGE);let F=C.getProjectionData({overscaledTileID:i,applyTerrainMatrix:h,applyGlobeMatrix:!a});d.useProgram("heatmapTexture").draw(m,v.TRIANGLES,Ve.disabled,He.disabled,d.colorModeForRenderPass(),Qe.disabled,Zr(d,t,0,1),null,F,t.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments,t.paint,C.zoom),D.destroy(),t.heatmapFbos.delete(I)}function E(d,t,i){var a,h;let m=d.gl,v=m.createTexture();m.bindTexture(m.TEXTURE_2D,v),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR);let C=(a=d.HALF_FLOAT)!==null&&a!==void 0?a:m.UNSIGNED_BYTE,P=(h=d.RGBA16F)!==null&&h!==void 0?h:m.RGBA;m.texImage2D(m.TEXTURE_2D,0,P,t,i,0,m.RGBA,C,null);let I=d.createFramebuffer(t,i,!1,!1);return I.colorAttachment.set(v),I}function N(d,t){return t.colorRampTexture||(t.colorRampTexture=new u.T(d,t.colorRamp,d.gl.RGBA)),t.colorRampTexture}function it(d,t,i,a,h){if(!i||!a||!a.imageAtlas)return;let m=a.imageAtlas.patternPositions,v=m[i.to.toString()],C=m[i.from.toString()];if(!v&&C&&(v=C),!C&&v&&(C=v),!v||!C){let P=h.getPaintProperty(t);v=m[P],C=m[P]}v&&C&&d.setConstantPatternPositions(v,C)}function Pt(d,t,i,a,h,m,v,C){let P=d.context.gl,I="fill-pattern",D=i.paint.get(I),F=D&&D.constantOr(1),O=i.getCrossfadeParameters(),Z,X,nt,ct,dt,mt=d.transform,Ct=i.paint.get("fill-translate"),yt=i.paint.get("fill-translate-anchor");v?(X=F&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=P.LINES):(X=F?"fillPattern":"fill",Z=P.TRIANGLES);let Lt=D.constantOr(null);for(let It of a){let xt=t.getTile(It);if(F&&!xt.patternsLoaded())continue;let Ot=xt.getBucket(i);if(!Ot)continue;let ue=Ot.programConfigurations.get(i.id),te=d.useProgram(X,ue),ne=d.style.map.terrain&&d.style.map.terrain.getTerrainData(It);F&&(d.context.activeTexture.set(P.TEXTURE0),xt.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ue.updatePaintBuffers(O)),it(ue,I,Lt,xt,i);let he=mt.getProjectionData({overscaledTileID:It,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),Ee=u.aC(mt,xt,Ct,yt);if(v){ct=Ot.indexBuffer2,dt=Ot.segments2;let xe=[P.drawingBufferWidth,P.drawingBufferHeight];nt=X==="fillOutlinePattern"&&F?gn(d,O,xt,xe,Ee):An(xe,Ee)}else ct=Ot.indexBuffer,dt=Ot.segments,nt=F?oa(d,O,xt,Ee):{u_fill_translate:Ee};let ke=d.stencilModeForClipping(It);te.draw(d.context,Z,h,ke,m,Qe.backCCW,nt,ne,he,i.id,Ot.layoutVertexBuffer,ct,dt,i.paint,d.transform.zoom,ue)}}function Xt(d,t,i,a,h,m,v,C){let P=d.context,I=P.gl,D="fill-extrusion-pattern",F=i.paint.get(D),O=F.constantOr(1),Z=i.getCrossfadeParameters(),X=i.paint.get("fill-extrusion-opacity"),nt=F.constantOr(null),ct=d.transform;for(let dt of a){let mt=t.getTile(dt),Ct=mt.getBucket(i);if(!Ct)continue;let yt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(dt),Lt=Ct.programConfigurations.get(i.id),It=d.useProgram(O?"fillExtrusionPattern":"fillExtrusion",Lt);O&&(d.context.activeTexture.set(I.TEXTURE0),mt.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Lt.updatePaintBuffers(Z));let xt=ct.getProjectionData({overscaledTileID:dt,applyGlobeMatrix:!C,applyTerrainMatrix:!0});it(Lt,D,nt,mt,i);let Ot=u.aC(ct,mt,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),ue=i.paint.get("fill-extrusion-vertical-gradient"),te=O?ka(d,ue,X,Ot,dt,Z,mt):Yi(d,ue,X,Ot);It.draw(P,P.gl.TRIANGLES,h,m,v,Qe.backCCW,te,yt,xt,i.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,i.paint,d.transform.zoom,Lt,d.style.map.terrain&&Ct.centroidVertexBuffer)}}function le(d,t,i,a,h,m,v,C,P){var I;let D=d.style.projection,F=d.context,O=d.transform,Z=F.gl,X=[`#define NUM_ILLUMINATION_SOURCES ${i.paint.get("hillshade-highlight-color").values.length}`],nt=d.useProgram("hillshade",null,!1,X),ct=!d.options.moving;for(let dt of a){let mt=t.getTile(dt),Ct=mt.fbo;if(!Ct)continue;let yt=D.getMeshFromTileID(F,dt.canonical,C,!0,"raster"),Lt=(I=d.style.map.terrain)===null||I===void 0?void 0:I.getTerrainData(dt);F.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,Ct.colorAttachment.get());let It=O.getProjectionData({overscaledTileID:dt,aligned:ct,applyGlobeMatrix:!P,applyTerrainMatrix:!0});nt.draw(F,Z.TRIANGLES,m,h[dt.overscaledZ],v,Qe.backCCW,Bn(d,mt,i),Lt,It,i.id,yt.vertexBuffer,yt.indexBuffer,yt.segments)}}function Ce(d,t,i,a,h,m,v,C,P){var I;let D=d.style.projection,F=d.context,O=d.transform,Z=F.gl,X=d.useProgram("colorRelief"),nt=!d.options.moving,ct=!0;for(let dt of a){let mt=t.getTile(dt),Ct=mt.dem;if(ct){let ue=Z.getParameter(Z.MAX_TEXTURE_SIZE),{elevationTexture:te,colorTexture:ne}=i.getColorRampTextures(F,ue,Ct.getUnpackVector());F.activeTexture.set(Z.TEXTURE1),te.bind(Z.NEAREST,Z.CLAMP_TO_EDGE),F.activeTexture.set(Z.TEXTURE4),ne.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),ct=!1}if(!Ct||!Ct.data)continue;let yt=Ct.stride,Lt=Ct.getPixels();if(F.activeTexture.set(Z.TEXTURE0),F.pixelStoreUnpackPremultiplyAlpha.set(!1),mt.demTexture=mt.demTexture||d.getTileTexture(yt),mt.demTexture){let ue=mt.demTexture;ue.update(Lt,{premultiply:!1}),ue.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}else mt.demTexture=new u.T(F,Lt,Z.RGBA,{premultiply:!1}),mt.demTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let It=D.getMeshFromTileID(F,dt.canonical,C,!0,"raster"),xt=(I=d.style.map.terrain)===null||I===void 0?void 0:I.getTerrainData(dt),Ot=O.getProjectionData({overscaledTileID:dt,aligned:nt,applyGlobeMatrix:!P,applyTerrainMatrix:!0});X.draw(F,Z.TRIANGLES,m,h[dt.overscaledZ],v,Qe.backCCW,Bl(i,mt.dem),xt,Ot,i.id,It.vertexBuffer,It.indexBuffer,It.segments)}}let ze=[new u.P(0,0),new u.P(u.$,0),new u.P(u.$,u.$),new u.P(0,u.$)];function qe(d,t,i,a,h,m,v,C,P=!1,I=!1){let D=a[a.length-1].overscaledZ,F=d.context,O=F.gl,Z=d.useProgram("raster"),X=d.transform,nt=d.style.projection,ct=d.colorModeForRenderPass(),dt=!d.options.moving;for(let mt of a){let Ct=d.getDepthModeForSublayer(mt.overscaledZ-D,i.paint.get("raster-opacity")===1?Ve.ReadWrite:Ve.ReadOnly,O.LESS),yt=t.getTile(mt);yt.registerFadeDuration(i.paint.get("raster-fade-duration"));let Lt=t.findLoadedParent(mt,0),It=t.findLoadedSibling(mt),xt=fi(yt,Lt||It||null,t,i,d.transform,d.style.map.terrain),Ot,ue,te=i.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;F.activeTexture.set(O.TEXTURE0),yt.texture.bind(te,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(O.TEXTURE1),Lt?(Lt.texture.bind(te,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),Ot=Math.pow(2,Lt.tileID.overscaledZ-yt.tileID.overscaledZ),ue=[yt.tileID.canonical.x*Ot%1,yt.tileID.canonical.y*Ot%1]):yt.texture.bind(te,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),yt.texture.useMipmap&&F.extTextureFilterAnisotropic&&d.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);let ne=d.style.map.terrain&&d.style.map.terrain.getTerrainData(mt),he=X.getProjectionData({overscaledTileID:mt,aligned:dt,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),Ee=Br(ue||[0,0],Ot||1,xt,i,C),ke=nt.getMeshFromTileID(F,mt.canonical,m,v,"raster");Z.draw(F,O.TRIANGLES,Ct,h?h[mt.overscaledZ]:He.disabled,ct,P?Qe.frontCCW:Qe.backCCW,Ee,ne,he,i.id,ke.vertexBuffer,ke.indexBuffer,ke.segments)}}function fi(d,t,i,a,h,m){let v=a.paint.get("raster-fade-duration");if(!m&&v>0){let C=re.now(),P=(C-d.timeAdded)/v,I=t?(C-t.timeAdded)/v:-1,D=i.getSource(),F=fe(h,{tileSize:D.tileSize,roundZoom:D.roundZoom}),O=!t||Math.abs(t.tileID.overscaledZ-F)>Math.abs(d.tileID.overscaledZ-F),Z=O&&d.refreshedUponExpiration?1:u.ag(O?P:1-I,0,1);return d.refreshedUponExpiration&&P>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}let Pr=new u.be(1,0,0,1),rr=new u.be(0,1,0,1),rn=new u.be(0,0,1,1),Vr=new u.be(1,0,1,1),Co=new u.be(0,1,1,1);function Mo(d,t,i,a){Js(d,0,t+i/2,d.transform.width,i,a)}function Dn(d,t,i,a){Js(d,t-i/2,0,i,d.transform.height,a)}function Js(d,t,i,a,h,m){let v=d.context,C=v.gl;C.enable(C.SCISSOR_TEST),C.scissor(t*d.pixelRatio,i*d.pixelRatio,a*d.pixelRatio,h*d.pixelRatio),v.clear({color:m}),C.disable(C.SCISSOR_TEST)}function da(d,t,i){let a=d.context,h=a.gl,m=d.useProgram("debug"),v=Ve.disabled,C=He.disabled,P=d.colorModeForRenderPass(),I="$debug",D=d.style.map.terrain&&d.style.map.terrain.getTerrainData(i);a.activeTexture.set(h.TEXTURE0);let F=t.getTileByID(i.key).latestRawTileData,O=Math.floor((F&&F.byteLength||0)/1024),Z=t.getTile(i).tileSize,X=512/Math.min(Z,512)*(i.overscaledZ/d.transform.zoom)*.5,nt=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(nt+=` => ${i.overscaledZ}`),function(dt,mt){dt.initDebugOverlayCanvas();let Ct=dt.debugOverlayCanvas,yt=dt.context.gl,Lt=dt.debugOverlayCanvas.getContext("2d");Lt.clearRect(0,0,Ct.width,Ct.height),Lt.shadowColor="white",Lt.shadowBlur=2,Lt.lineWidth=1.5,Lt.strokeStyle="white",Lt.textBaseline="top",Lt.font="bold 36px Open Sans, sans-serif",Lt.fillText(mt,5,5),Lt.strokeText(mt,5,5),dt.debugOverlayTexture.update(Ct),dt.debugOverlayTexture.bind(yt.LINEAR,yt.CLAMP_TO_EDGE)}(d,`${nt} ${O}kB`);let ct=d.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(a,h.TRIANGLES,v,C,ai.alphaBlended,Qe.disabled,In(u.be.transparent,X),null,ct,I,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),m.draw(a,h.LINE_STRIP,v,C,P,Qe.disabled,In(u.be.red),D,ct,I,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function Ni(d,t,i,a){let{isRenderingGlobe:h}=a,m=d.context,v=m.gl,C=d.transform,P=d.colorModeForRenderPass(),I=d.getDepthModeFor3D(),D=d.useProgram("terrain");m.bindFramebuffer.set(null),m.viewport.set([0,0,d.width,d.height]);for(let F of i){let O=t.getTerrainMesh(F.tileID),Z=d.renderToTexture.getTexture(F),X=t.getTerrainData(F.tileID);m.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,Z.texture);let nt=t.getMeshFrameDelta(C.zoom),ct=C.calculateFogMatrix(F.tileID.toUnwrapped()),dt=Ka(nt,ct,d.style.sky,C.pitch,h),mt=C.getProjectionData({overscaledTileID:F.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});D.draw(m,v.TRIANGLES,I,He.disabled,P,Qe.backCCW,dt,X,mt,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}}function ps(d,t){if(!t.mesh){let i=new u.aK;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);let a=new u.aM;a.emplaceBack(0,1,2),a.emplaceBack(0,2,3),t.mesh=new fn(d.createVertexBuffer(i,qn.members),d.createIndexBuffer(a),u.aL.simpleSegment(0,0,i.length,a.length))}return t.mesh}class Pi{constructor(t,i){this.context=new Ke(t),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ye.maxUnderzooming+ye.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new os}resize(t,i,a){if(this.width=Math.floor(t*a),this.height=Math.floor(i*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let h of this.style._order)this.style._layers[h].resize()}setup(){let t=this.context,i=new u.aK;i.emplaceBack(0,0),i.emplaceBack(u.$,0),i.emplaceBack(0,u.$),i.emplaceBack(u.$,u.$),this.tileExtentBuffer=t.createVertexBuffer(i,qn.members),this.tileExtentSegments=u.aL.simpleSegment(0,0,4,2);let a=new u.aK;a.emplaceBack(0,0),a.emplaceBack(u.$,0),a.emplaceBack(0,u.$),a.emplaceBack(u.$,u.$),this.debugBuffer=t.createVertexBuffer(a,qn.members),this.debugSegments=u.aL.simpleSegment(0,0,4,5);let h=new u.c5;h.emplaceBack(0,0,0,0),h.emplaceBack(u.$,0,u.$,0),h.emplaceBack(0,u.$,0,u.$),h.emplaceBack(u.$,u.$,u.$,u.$),this.rasterBoundsBuffer=t.createVertexBuffer(h,Lr.members),this.rasterBoundsSegments=u.aL.simpleSegment(0,0,4,2);let m=new u.aK;m.emplaceBack(0,0),m.emplaceBack(u.$,0),m.emplaceBack(0,u.$),m.emplaceBack(u.$,u.$),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(m,qn.members),this.rasterBoundsSegmentsPosOnly=u.aL.simpleSegment(0,0,4,5);let v=new u.aK;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(v,qn.members),this.viewportSegments=u.aL.simpleSegment(0,0,4,2);let C=new u.c6;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(C);let P=new u.aM;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(P);let I=this.context.gl;this.stencilClearMode=new He({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.tileExtentMesh=new fn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let t=this.context,i=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let a=u.L();u.bX(a,0,this.width,this.height,0,0,1),u.N(a,a,[i.drawingBufferWidth,i.drawingBufferHeight,0]);let h={mainMatrix:a,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:a};this.useProgram("clippingMask",null,!0).draw(t,i.TRIANGLES,Ve.disabled,this.stencilClearMode,ai.disabled,Qe.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,i,a){if(this.currentStencilSource===t.source||!t.isTileClipped()||!i||!i.length)return;this.currentStencilSource=t.source,this.nextStencilID+i.length>256&&this.clearStencil();let h=this.context;h.setColorMode(ai.disabled),h.setDepthMode(Ve.disabled);let m={};for(let v of i)m[v.key]=this.nextStencilID++;this._renderTileMasks(m,i,a,!0),this._renderTileMasks(m,i,a,!1),this._tileClippingMaskIDs=m}_renderTileMasks(t,i,a,h){let m=this.context,v=m.gl,C=this.style.projection,P=this.transform,I=this.useProgram("clippingMask");for(let D of i){let F=t[D.key],O=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),Z=C.getMeshFromTileID(this.context,D.canonical,h,!0,"stencil"),X=P.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!a,applyTerrainMatrix:!0});I.draw(m,v.TRIANGLES,Ve.disabled,new He({func:v.ALWAYS,mask:0},F,255,v.KEEP,v.KEEP,v.REPLACE),ai.disabled,a?Qe.disabled:Qe.backCCW,null,O,X,"$clipping",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}_renderTilesDepthBuffer(){let t=this.context,i=t.gl,a=this.style.projection,h=this.transform,m=this.useProgram("depth"),v=this.getDepthModeFor3D(),C=ce(h,{tileSize:h.tileSize});for(let P of C){let I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P),D=a.getMeshFromTileID(this.context,P.canonical,!0,!0,"raster"),F=h.getProjectionData({overscaledTileID:P,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(t,i.TRIANGLES,v,He.disabled,ai.disabled,Qe.backCCW,null,I,F,"$clipping",D.vertexBuffer,D.indexBuffer,D.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let t=this.nextStencilID++,i=this.context.gl;return new He({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){let i=this.context.gl;return new He({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){let i=this.context.gl,a=t.sort((v,C)=>C.overscaledZ-v.overscaledZ),h=a[a.length-1].overscaledZ,m=a[0].overscaledZ-h+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();let v={};for(let C=0;C<m;C++)v[C+h]=new He({func:i.GEQUAL,mask:255},C+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=m,[v,a]}return[{[h]:He.disabled},a]}stencilConfigForOverlapTwoPass(t){let i=this.context.gl,a=t.sort((v,C)=>C.overscaledZ-v.overscaledZ),h=a[a.length-1].overscaledZ,m=a[0].overscaledZ-h+1;if(this.clearStencil(),m>1){let v={},C={};for(let P=0;P<m;P++)v[P+h]=new He({func:i.GREATER,mask:255},m+1+P,255,i.KEEP,i.KEEP,i.REPLACE),C[P+h]=new He({func:i.GREATER,mask:255},1+P,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*m+1,[v,C,a]}return this.nextStencilID=3,[{[h]:new He({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[h]:new He({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},a]}colorModeForRenderPass(){let t=this.context.gl;return this._showOverdrawInspector?new ai([t.CONSTANT_COLOR,t.ONE],new u.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ai.unblended:ai.alphaBlended}getDepthModeForSublayer(t,i,a){if(!this.opaquePassEnabledForLayer())return Ve.disabled;let h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ve(a||this.context.gl.LEQUAL,i,[h,h])}getDepthModeFor3D(){return new Ve(this.context.gl.LEQUAL,Ve.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){var a,h;this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(re.now()),this.imageManager.beginFrame();let m=this.style._order,v=this.style.sourceCaches,C={},P={},I={},D={isRenderingToTexture:!1,isRenderingGlobe:((a=t.projection)===null||a===void 0?void 0:a.transitionState)>0};for(let O in v){let Z=v[O];Z.used&&Z.prepare(this.context),C[O]=Z.getVisibleCoordinates(!1),P[O]=C[O].slice().reverse(),I[O]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<m.length;O++)if(this.style._layers[m[O]].is3D()){this.opaquePassCutoff=O;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let O of m){let Z=this.style._layers[O];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;let X=P[Z.source];(Z.type==="custom"||X.length)&&this.renderLayer(this,v[Z.source],Z,X,D)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:O=>this.useProgram(O)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?u.be.black:u.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(O,Z){let X=O.context,nt=X.gl,ct=((It,xt,Ot)=>{let ue=Math.cos(xt.rollInRadians),te=Math.sin(xt.rollInRadians),ne=tt(xt),he=xt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:It.properties.get("sky-color"),u_horizon_color:It.properties.get("horizon-color"),u_horizon:[(xt.width/2-ne*te)*Ot,(xt.height/2+ne*ue)*Ot],u_horizon_normal:[-te,ue],u_sky_horizon_blend:It.properties.get("sky-horizon-blend")*xt.height/2*Ot,u_sky_blend:he}})(Z,O.style.map.transform,O.pixelRatio),dt=new Ve(nt.LEQUAL,Ve.ReadWrite,[0,1]),mt=He.disabled,Ct=O.colorModeForRenderPass(),yt=O.useProgram("sky"),Lt=ps(X,Z);yt.draw(X,nt.TRIANGLES,dt,mt,Ct,Qe.disabled,ct,null,void 0,"sky",Lt.vertexBuffer,Lt.indexBuffer,Lt.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){let O=this.style._layers[m[this.currentLayer]],Z=v[O.source],X=C[O.source];this._renderTileClippingMasks(O,X,!1),this.renderLayer(this,Z,O,X,D)}this.renderPass="translucent";let F=!1;for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){let O=this.style._layers[m[this.currentLayer]],Z=v[O.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(O,D))continue;this.opaquePassEnabledForLayer()||F||(F=!0,D.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let X=(O.type==="symbol"?I:P)[O.source];this._renderTileClippingMasks(O,C[O.source],!!this.renderToTexture),this.renderLayer(this,Z,O,X,D)}if(D.isRenderingGlobe&&function(O,Z,X){let nt=O.context,ct=nt.gl,dt=O.useProgram("atmosphere"),mt=new Ve(ct.LEQUAL,Ve.ReadOnly,[0,1]),Ct=O.transform,yt=function(he,Ee){let ke=he.properties.get("position"),xe=[-ke.x,-ke.y,-ke.z],Re=u.af(new Float64Array(16));return he.properties.get("anchor")==="map"&&(u.b5(Re,Re,Ee.rollInRadians),u.b6(Re,Re,-Ee.pitchInRadians),u.b5(Re,Re,Ee.bearingInRadians),u.b6(Re,Re,Ee.center.lat*Math.PI/180),u.by(Re,Re,-Ee.center.lng*Math.PI/180)),u.c4(xe,xe,Re),xe}(X,O.transform),Lt=Ct.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),It=Z.properties.get("atmosphere-blend")*Lt.projectionTransition;if(It===0)return;let xt=Wn(Ct.worldSize,Ct.center.lat),Ot=Ct.inverseProjectionMatrix,ue=new Float64Array(4);ue[3]=1,u.av(ue,ue,Ct.modelViewProjectionMatrix),ue[0]/=ue[3],ue[1]/=ue[3],ue[2]/=ue[3],ue[3]=1,u.av(ue,ue,Ot),ue[0]/=ue[3],ue[1]/=ue[3],ue[2]/=ue[3],ue[3]=1;let te=((he,Ee,ke,xe,Re)=>({u_sun_pos:he,u_atmosphere_blend:Ee,u_globe_position:ke,u_globe_radius:xe,u_inv_proj_matrix:Re}))(yt,It,[ue[0],ue[1],ue[2]],xt,Ot),ne=ps(nt,Z);dt.draw(nt,ct.TRIANGLES,mt,He.disabled,ai.alphaBlended,Qe.disabled,te,null,null,"atmosphere",ne.vertexBuffer,ne.indexBuffer,ne.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let O=function(Z,X){let nt=null,ct=Object.values(Z._layers).flatMap(yt=>yt.source&&!yt.isHidden(X)?[Z.sourceCaches[yt.source]]:[]),dt=ct.filter(yt=>yt.getSource().type==="vector"),mt=ct.filter(yt=>yt.getSource().type!=="vector"),Ct=yt=>{(!nt||nt.getSource().maxzoom<yt.getSource().maxzoom)&&(nt=yt)};return dt.forEach(yt=>Ct(yt)),nt||mt.forEach(yt=>Ct(yt)),nt}(this.style,this.transform.zoom);O&&function(Z,X,nt){for(let ct=0;ct<nt.length;ct++)da(Z,X,nt[ct])}(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){let Z=O.transform.padding;Mo(O,O.transform.height-(Z.top||0),3,Pr),Mo(O,Z.bottom||0,3,rr),Dn(O,Z.left||0,3,rn),Dn(O,O.transform.width-(Z.right||0),3,Vr);let X=O.transform.centerPoint;(function(nt,ct,dt,mt){Js(nt,ct-1,dt-10,2,20,mt),Js(nt,ct-10,dt-1,20,2,mt)})(O,X.x,O.transform.height-X.y,Co)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;let i=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix,h=this.terrainFacilitator.dirty;h||(h=t?!u.c7(i,a):!u.c8(i,a)),h||(h=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(u.c9(i,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,v){let C=m.context,P=C.gl,I=m.transform,D=ai.unblended,F=new Ve(P.LEQUAL,Ve.ReadWrite,[0,1]),O=v.sourceCache.getRenderableTiles(),Z=m.useProgram("terrainDepth");C.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),C.clear({color:u.be.transparent,depth:1});for(let X of O){let nt=v.getTerrainMesh(X.tileID),ct=v.getTerrainData(X.tileID),dt=I.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),mt={u_ele_delta:v.getMeshFrameDelta(I.zoom)};Z.draw(C,P.TRIANGLES,F,He.disabled,D,Qe.backCCW,mt,ct,dt,"terrain",nt.vertexBuffer,nt.indexBuffer,nt.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,v){let C=m.context,P=C.gl,I=m.transform,D=ai.unblended,F=new Ve(P.LEQUAL,Ve.ReadWrite,[0,1]),O=v.getCoordsTexture(),Z=v.sourceCache.getRenderableTiles(),X=m.useProgram("terrainCoords");C.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),C.clear({color:u.be.transparent,depth:1}),v.coordsIndex=[];for(let nt of Z){let ct=v.getTerrainMesh(nt.tileID),dt=v.getTerrainData(nt.tileID);C.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,O.texture);let mt={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(I.zoom)},Ct=I.getProjectionData({overscaledTileID:nt.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});X.draw(C,P.TRIANGLES,F,He.disabled,D,Qe.backCCW,mt,dt,Ct,"terrain",ct.vertexBuffer,ct.indexBuffer,ct.segments),v.coordsIndex.push(nt.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(t,i,a,h,m){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||(h||[]).length)&&(this.id=a.id,u.ca(a)?function(v,C,P,I,D,F){if(v.renderPass!=="translucent")return;let{isRenderingToTexture:O}=F,Z=He.disabled,X=v.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(nt,ct,dt,mt,Ct,yt,Lt,It,xt){let Ot=ct.transform,ue=ct.style.map.terrain,te=Ct==="map",ne=yt==="map";for(let he of nt){let Ee=mt.getTile(he),ke=Ee.getBucket(dt);if(!ke||!ke.text||!ke.text.segments.get().length)continue;let xe=u.am(ke.textSizeData,Ot.zoom),Re=u.aB(Ee,1,ct.transform.zoom),_i=Je(te,ct.transform,Re),Di=dt.layout.get("icon-text-fit")!=="none"&&ke.hasIconData();if(xe){let hr=Math.pow(2,Ot.zoom-Ee.tileID.overscaledZ),Vi=ue?(cr,qi)=>ue.getElevation(he,cr,qi):null;Ss(ke,te,ne,xt,Ot,_i,hr,xe,Di,u.aC(Ot,Ee,Lt,It),he.toUnwrapped(),Vi)}}}(I,v,P,C,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),D),P.paint.get("icon-opacity").constantOr(1)!==0&&ll(v,C,P,I,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),Z,X,O),P.paint.get("text-opacity").constantOr(1)!==0&&ll(v,C,P,I,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),Z,X,O),C.map.showCollisionBoxes&&(xn(v,C,P,I,!0),xn(v,C,P,I,!1))}(t,i,a,h,this.style.placement.variableOffsets,m):u.cb(a)?function(v,C,P,I,D){if(v.renderPass!=="translucent")return;let{isRenderingToTexture:F}=D,O=P.paint.get("circle-opacity"),Z=P.paint.get("circle-stroke-width"),X=P.paint.get("circle-stroke-opacity"),nt=!P.layout.get("circle-sort-key").isConstant();if(O.constantOr(1)===0&&(Z.constantOr(1)===0||X.constantOr(1)===0))return;let ct=v.context,dt=ct.gl,mt=v.transform,Ct=v.getDepthModeForSublayer(0,Ve.ReadOnly),yt=He.disabled,Lt=v.colorModeForRenderPass(),It=[],xt=mt.getCircleRadiusCorrection();for(let Ot=0;Ot<I.length;Ot++){let ue=I[Ot],te=C.getTile(ue),ne=te.getBucket(P);if(!ne)continue;let he=P.paint.get("circle-translate"),Ee=P.paint.get("circle-translate-anchor"),ke=u.aC(mt,te,he,Ee),xe=ne.programConfigurations.get(P.id),Re=v.useProgram("circle",xe),_i=ne.layoutVertexBuffer,Di=ne.indexBuffer,hr=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ue),Vi={programConfiguration:xe,program:Re,layoutVertexBuffer:_i,indexBuffer:Di,uniformValues:Zo(v,te,P,ke,xt),terrainData:hr,projectionData:mt.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!F,applyTerrainMatrix:!0})};if(nt){let cr=ne.segments.get();for(let qi of cr)It.push({segments:new u.aL([qi]),sortKey:qi.sortKey,state:Vi})}else It.push({segments:ne.segments,sortKey:0,state:Vi})}nt&&It.sort((Ot,ue)=>Ot.sortKey-ue.sortKey);for(let Ot of It){let{programConfiguration:ue,program:te,layoutVertexBuffer:ne,indexBuffer:he,uniformValues:Ee,terrainData:ke,projectionData:xe}=Ot.state;te.draw(ct,dt.TRIANGLES,Ct,yt,Lt,Qe.backCCW,Ee,ke,xe,P.id,ne,he,Ot.segments,P.paint,v.transform.zoom,ue)}}(t,i,a,h,m):u.cc(a)?function(v,C,P,I,D){if(P.paint.get("heatmap-opacity")===0)return;let F=v.context,{isRenderingToTexture:O,isRenderingGlobe:Z}=D;if(v.style.map.terrain){for(let X of I){let nt=C.getTile(X);C.hasRenderableParent(X)||(v.renderPass==="offscreen"?f(v,nt,P,X,Z):v.renderPass==="translucent"&&w(v,P,X,O,Z))}F.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?function(X,nt,ct,dt){let mt=X.context,Ct=mt.gl,yt=X.transform,Lt=He.disabled,It=new ai([Ct.ONE,Ct.ONE],u.be.transparent,[!0,!0,!0,!0]);(function(xt,Ot,ue){let te=xt.gl;xt.activeTexture.set(te.TEXTURE1),xt.viewport.set([0,0,Ot.width/4,Ot.height/4]);let ne=ue.heatmapFbos.get(u.c1);ne?(te.bindTexture(te.TEXTURE_2D,ne.colorAttachment.get()),xt.bindFramebuffer.set(ne.framebuffer)):(ne=E(xt,Ot.width/4,Ot.height/4),ue.heatmapFbos.set(u.c1,ne))})(mt,X,ct),mt.clear({color:u.be.transparent});for(let xt=0;xt<dt.length;xt++){let Ot=dt[xt];if(nt.hasRenderableParent(Ot))continue;let ue=nt.getTile(Ot),te=ue.getBucket(ct);if(!te)continue;let ne=te.programConfigurations.get(ct.id),he=X.useProgram("heatmap",ne),Ee=yt.getProjectionData({overscaledTileID:Ot,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ke=yt.getCircleRadiusCorrection();he.draw(mt,Ct.TRIANGLES,Ve.disabled,Lt,It,Qe.backCCW,Qr(ue,yt.zoom,ct.paint.get("heatmap-intensity"),ke),null,Ee,ct.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,ct.paint,yt.zoom,ne)}mt.viewport.set([0,0,X.width,X.height])}(v,C,P,I):v.renderPass==="translucent"&&function(X,nt){let ct=X.context,dt=ct.gl;ct.setColorMode(X.colorModeForRenderPass());let mt=nt.heatmapFbos.get(u.c1);mt&&(ct.activeTexture.set(dt.TEXTURE0),dt.bindTexture(dt.TEXTURE_2D,mt.colorAttachment.get()),ct.activeTexture.set(dt.TEXTURE1),N(ct,nt).bind(dt.LINEAR,dt.CLAMP_TO_EDGE),X.useProgram("heatmapTexture").draw(ct,dt.TRIANGLES,Ve.disabled,He.disabled,X.colorModeForRenderPass(),Qe.disabled,Zr(X,nt,0,1),null,null,nt.id,X.viewportBuffer,X.quadTriangleIndexBuffer,X.viewportSegments,nt.paint,X.transform.zoom))}(v,P)}(t,i,a,h,m):u.cd(a)?function(v,C,P,I,D){if(v.renderPass!=="translucent")return;let{isRenderingToTexture:F}=D,O=P.paint.get("line-opacity"),Z=P.paint.get("line-width");if(O.constantOr(1)===0||Z.constantOr(1)===0)return;let X=v.getDepthModeForSublayer(0,Ve.ReadOnly),nt=v.colorModeForRenderPass(),ct=P.paint.get("line-dasharray"),dt=P.paint.get("line-pattern"),mt=dt.constantOr(1),Ct=P.paint.get("line-gradient"),yt=P.getCrossfadeParameters(),Lt=mt?"linePattern":ct?"lineSDF":Ct?"lineGradient":"line",It=v.context,xt=It.gl,Ot=v.transform,ue=!0;for(let te of I){let ne=C.getTile(te);if(mt&&!ne.patternsLoaded())continue;let he=ne.getBucket(P);if(!he)continue;let Ee=he.programConfigurations.get(P.id),ke=v.context.program.get(),xe=v.useProgram(Lt,Ee),Re=ue||xe.program!==ke,_i=v.style.map.terrain&&v.style.map.terrain.getTerrainData(te),Di=dt.constantOr(null);if(Di&&ne.imageAtlas){let Ui=ne.imageAtlas,Hi=Ui.patternPositions[Di.to.toString()],bn=Ui.patternPositions[Di.from.toString()];Hi&&bn&&Ee.setConstantPatternPositions(Hi,bn)}let hr=Ot.getProjectionData({overscaledTileID:te,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),Vi=Ot.getPixelScale(),cr=mt?Vo(v,ne,P,Vi,yt):ct?Ja(v,ne,P,Vi,ct,yt):Ct?la(v,ne,P,Vi,he.lineClipsArray.length):Cs(v,ne,P,Vi);if(mt)It.activeTexture.set(xt.TEXTURE0),ne.imageAtlasTexture.bind(xt.LINEAR,xt.CLAMP_TO_EDGE),Ee.updatePaintBuffers(yt);else if(ct&&(Re||v.lineAtlas.dirty))It.activeTexture.set(xt.TEXTURE0),v.lineAtlas.bind(It);else if(Ct){let Ui=he.gradients[P.id],Hi=Ui.texture;if(P.gradientVersion!==Ui.version){let bn=256;if(P.stepInterpolant){let ki=C.getSource().maxzoom,sn=te.canonical.z===ki?Math.ceil(1<<v.transform.maxZoom-te.canonical.z):1;bn=u.ag(u.c2(he.maxLineLength/u.$*1024*sn),256,It.maxTextureSize)}Ui.gradient=u.c3({expression:P.gradientExpression(),evaluationKey:"lineProgress",resolution:bn,image:Ui.gradient||void 0,clips:he.lineClipsArray}),Ui.texture?Ui.texture.update(Ui.gradient):Ui.texture=new u.T(It,Ui.gradient,xt.RGBA),Ui.version=P.gradientVersion,Hi=Ui.texture}It.activeTexture.set(xt.TEXTURE0),Hi.bind(P.stepInterpolant?xt.NEAREST:xt.LINEAR,xt.CLAMP_TO_EDGE)}let qi=v.stencilModeForClipping(te);xe.draw(It,xt.TRIANGLES,X,qi,nt,Qe.disabled,cr,_i,hr,P.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,P.paint,v.transform.zoom,Ee,he.layoutVertexBuffer2),ue=!1}}(t,i,a,h,m):u.ce(a)?function(v,C,P,I,D){let F=P.paint.get("fill-color"),O=P.paint.get("fill-opacity");if(O.constantOr(1)===0)return;let{isRenderingToTexture:Z}=D,X=v.colorModeForRenderPass(),nt=P.paint.get("fill-pattern"),ct=v.opaquePassEnabledForLayer()&&!nt.constantOr(1)&&F.constantOr(u.be.transparent).a===1&&O.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===ct){let dt=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?Ve.ReadWrite:Ve.ReadOnly);Pt(v,C,P,I,dt,X,!1,Z)}if(v.renderPass==="translucent"&&P.paint.get("fill-antialias")){let dt=v.getDepthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,Ve.ReadOnly);Pt(v,C,P,I,dt,X,!0,Z)}}(t,i,a,h,m):u.cf(a)?function(v,C,P,I,D){let F=P.paint.get("fill-extrusion-opacity");if(F===0)return;let{isRenderingToTexture:O}=D;if(v.renderPass==="translucent"){let Z=new Ve(v.context.gl.LEQUAL,Ve.ReadWrite,v.depthRangeFor3D);if(F!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))Xt(v,C,P,I,Z,He.disabled,ai.disabled,O),Xt(v,C,P,I,Z,v.stencilModeFor3D(),v.colorModeForRenderPass(),O);else{let X=v.colorModeForRenderPass();Xt(v,C,P,I,Z,He.disabled,X,O)}}}(t,i,a,h,m):u.cg(a)?function(v,C,P,I,D){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;let{isRenderingToTexture:F}=D,O=v.context,Z=v.style.projection.useSubdivision,X=v.getDepthModeForSublayer(0,Ve.ReadOnly),nt=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(ct,dt,mt,Ct,yt,Lt,It){let xt=ct.context,Ot=xt.gl;for(let ue of mt){let te=dt.getTile(ue),ne=te.dem;if(!ne||!ne.data||!te.needsHillshadePrepare)continue;let he=ne.dim,Ee=ne.stride,ke=ne.getPixels();if(xt.activeTexture.set(Ot.TEXTURE1),xt.pixelStoreUnpackPremultiplyAlpha.set(!1),te.demTexture=te.demTexture||ct.getTileTexture(Ee),te.demTexture){let Re=te.demTexture;Re.update(ke,{premultiply:!1}),Re.bind(Ot.NEAREST,Ot.CLAMP_TO_EDGE)}else te.demTexture=new u.T(xt,ke,Ot.RGBA,{premultiply:!1}),te.demTexture.bind(Ot.NEAREST,Ot.CLAMP_TO_EDGE);xt.activeTexture.set(Ot.TEXTURE0);let xe=te.fbo;if(!xe){let Re=new u.T(xt,{width:he,height:he,data:null},Ot.RGBA);Re.bind(Ot.LINEAR,Ot.CLAMP_TO_EDGE),xe=te.fbo=xt.createFramebuffer(he,he,!0,!1),xe.colorAttachment.set(Re.texture)}xt.bindFramebuffer.set(xe.framebuffer),xt.viewport.set([0,0,he,he]),ct.useProgram("hillshadePrepare").draw(xt,Ot.TRIANGLES,yt,Lt,It,Qe.disabled,Ya(te.tileID,ne),null,null,Ct.id,ct.rasterBoundsBuffer,ct.quadTriangleIndexBuffer,ct.rasterBoundsSegments),te.needsHillshadePrepare=!1}})(v,C,I,P,X,He.disabled,nt),O.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(Z){let[ct,dt,mt]=v.stencilConfigForOverlapTwoPass(I);le(v,C,P,mt,ct,X,nt,!1,F),le(v,C,P,mt,dt,X,nt,!0,F)}else{let[ct,dt]=v.getStencilConfigForOverlapAndUpdateStencilID(I);le(v,C,P,dt,ct,X,nt,!1,F)}}(t,i,a,h,m):u.ch(a)?function(v,C,P,I,D){if(v.renderPass!=="translucent"||!I.length)return;let{isRenderingToTexture:F}=D,O=v.style.projection.useSubdivision,Z=v.getDepthModeForSublayer(0,Ve.ReadOnly),X=v.colorModeForRenderPass();if(O){let[nt,ct,dt]=v.stencilConfigForOverlapTwoPass(I);Ce(v,C,P,dt,nt,Z,X,!1,F),Ce(v,C,P,dt,ct,Z,X,!0,F)}else{let[nt,ct]=v.getStencilConfigForOverlapAndUpdateStencilID(I);Ce(v,C,P,ct,nt,Z,X,!1,F)}}(t,i,a,h,m):u.ci(a)?function(v,C,P,I,D){if(v.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!I.length)return;let{isRenderingToTexture:F}=D,O=C.getSource(),Z=v.style.projection.useSubdivision;if(O instanceof Rr)qe(v,C,P,I,null,!1,!1,O.tileCoords,O.flippedWindingOrder,F);else if(Z){let[X,nt,ct]=v.stencilConfigForOverlapTwoPass(I);qe(v,C,P,ct,X,!1,!0,ze,!1,F),qe(v,C,P,ct,nt,!0,!0,ze,!1,F)}else{let[X,nt]=v.getStencilConfigForOverlapAndUpdateStencilID(I);qe(v,C,P,nt,X,!1,!0,ze,!1,F)}}(t,i,a,h,m):u.cj(a)?function(v,C,P,I,D){let F=P.paint.get("background-color"),O=P.paint.get("background-opacity");if(O===0)return;let{isRenderingToTexture:Z}=D,X=v.context,nt=X.gl,ct=v.style.projection,dt=v.transform,mt=dt.tileSize,Ct=P.paint.get("background-pattern");if(v.isPatternMissing(Ct))return;let yt=!Ct&&F.a===1&&O===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==yt)return;let Lt=He.disabled,It=v.getDepthModeForSublayer(0,yt==="opaque"?Ve.ReadWrite:Ve.ReadOnly),xt=v.colorModeForRenderPass(),Ot=v.useProgram(Ct?"backgroundPattern":"background"),ue=I||ce(dt,{tileSize:mt,terrain:v.style.map.terrain});Ct&&(X.activeTexture.set(nt.TEXTURE0),v.imageManager.bind(v.context));let te=P.getCrossfadeParameters();for(let ne of ue){let he=dt.getProjectionData({overscaledTileID:ne,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),Ee=Ct?Dl(O,v,Ct,{tileID:ne,tileSize:mt},te):yn(O,F),ke=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ne),xe=ct.getMeshFromTileID(X,ne.canonical,!1,!0,"raster");Ot.draw(X,nt.TRIANGLES,It,Lt,xt,Qe.backCCW,Ee,ke,he,P.id,xe.vertexBuffer,xe.indexBuffer,xe.segments)}}(t,0,a,h,m):u.ck(a)&&function(v,C,P,I){let{isRenderingGlobe:D}=I,F=v.context,O=P.implementation,Z=v.style.projection,X=v.transform,nt=X.getProjectionDataForCustomLayer(D),ct={farZ:X.farZ,nearZ:X.nearZ,fov:X.fov*Math.PI/180,modelViewProjectionMatrix:X.modelViewProjectionMatrix,projectionMatrix:X.projectionMatrix,shaderData:{variantName:Z.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Z.shaderPreludeCode.vertexSource}`,define:Z.shaderDefine},defaultProjectionData:nt},dt=O.renderingMode?O.renderingMode:"2d";if(v.renderPass==="offscreen"){let mt=O.prerender;mt&&(v.setCustomLayerDefaults(),F.setColorMode(v.colorModeForRenderPass()),mt.call(O,F.gl,ct),F.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),F.setColorMode(v.colorModeForRenderPass()),F.setStencilMode(He.disabled);let mt=dt==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,Ve.ReadOnly);F.setDepthMode(mt),O.render(F.gl,ct),F.setDirty(),v.setBaseState(),F.bindFramebuffer.set(null)}}(t,0,a,m))}saveTileTexture(t){let i=this._tileTextures[t.size[0]];i?i.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){let i=this._tileTextures[t];return i&&i.length>0?i.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;let i=this.imageManager.getPattern(t.from.toString()),a=this.imageManager.getPattern(t.to.toString());return!i||!a}useProgram(t,i,a=!1,h=[]){this.cache=this.cache||{};let m=!!this.style.map.terrain,v=this.style.projection,C=a?Xr.projectionMercator:v.shaderPreludeCode,P=a?as:v.shaderDefine,I=t+(i?i.cacheKey:"")+`/${a?No:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(m?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[I]||(this.cache[I]=new ws(this.context,Xr[t],i,vl[t],this._showOverdrawInspector,m,C,P,h)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:t,drawingBufferHeight:i}=this.context.gl;return this.width!==t||this.height!==i}}function Lo(d,t){let i,a=!1,h=null,m=null,v=()=>{h=null,a&&(d.apply(m,i),h=setTimeout(v,t),a=!1)};return(...C)=>(a=!0,m=this,i=C,h||v(),h)}class fa{constructor(t){this._getCurrentHash=()=>{let i=window.location.hash.replace("#","");if(this._hashName){let a;return i.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(a=h)}),(a&&a[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{let i=this._getCurrentHash();if(!this._isValidHash(i))return!1;let a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:a,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{let i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{let i=this._getCurrentHash();if(i.length===0)return;let a=i.join("/"),h=a;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${a}`);let m=window.location.hash.replace(h,"");m.startsWith("#&")?m=m.slice(0,1)+m.slice(2):m==="#"&&(m="");let v=window.location.href.replace(/(#.+)?$/,m);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Lo(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){let i=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,h=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,h),v=Math.round(i.lng*m)/m,C=Math.round(i.lat*m)/m,P=this._map.getBearing(),I=this._map.getPitch(),D="";if(D+=t?`/${v}/${C}/${a}`:`${a}/${C}/${v}`,(P||I)&&(D+="/"+Math.round(10*P)/10),I&&(D+=`/${Math.round(I)}`),this._hashName){let F=this._hashName,O=!1,Z=window.location.hash.slice(1).split("&").map(X=>{let nt=X.split("=")[0];return nt===F?(O=!0,`${nt}=${D}`):X}).filter(X=>X);return O||Z.push(`${F}=${D}`),`#${Z.join("&")}`}return`#${D}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new u.S(+t[2],+t[1])}catch{return!1}let i=+t[0],a=+(t[3]||0),h=+(t[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&a>=-180&&a<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}let To={linearity:.3,easing:u.cl(0,0,.3,1)},Po=u.e({deceleration:2500,maxSpeed:1400},To),ma=u.e({deceleration:20,maxSpeed:1400},To),Ur=u.e({deceleration:1e3,maxSpeed:360},To),ul=u.e({deceleration:1e3,maxSpeed:90},To),hl=u.e({deceleration:1e3,maxSpeed:360},To);class zl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:re.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,i=re.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let i={zoom:0,bearing:0,pitch:0,roll:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:m}of this._inertiaBuffer)i.zoom+=m.zoomDelta||0,i.bearing+=m.bearingDelta||0,i.pitch+=m.pitchDelta||0,i.roll+=m.rollDelta||0,m.panDelta&&i.pan._add(m.panDelta),m.around&&(i.around=m.around),m.pinchAround&&(i.pinchAround=m.pinchAround);let a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(i.pan.mag()){let m=_a(i.pan.mag(),a,u.e({},Po,t||{})),v=i.pan.mult(m.amount/i.pan.mag()),C=this._map.cameraHelper.handlePanInertia(v,this._map.transform);h.center=C.easingCenter,h.offset=C.easingOffset,Da(h,m)}if(i.zoom){let m=_a(i.zoom,a,ma);h.zoom=this._map.transform.zoom+m.amount,Da(h,m)}if(i.bearing){let m=_a(i.bearing,a,Ur);h.bearing=this._map.transform.bearing+u.ag(m.amount,-179,179),Da(h,m)}if(i.pitch){let m=_a(i.pitch,a,ul);h.pitch=this._map.transform.pitch+m.amount,Da(h,m)}if(i.roll){let m=_a(i.roll,a,hl);h.roll=this._map.transform.roll+u.ag(m.amount,-179,179),Da(h,m)}if(h.zoom||h.bearing){let m=i.pinchAround===void 0?i.around:i.pinchAround;h.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),u.e(h,{noMoveStart:!0})}}function Da(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function _a(d,t,i){let{maxSpeed:a,linearity:h,deceleration:m}=i,v=u.ag(d*h/(t/1e3),-a,a),C=Math.abs(v)/(m*h);return{easing:i.easing,duration:1e3*C,amount:v*(C/2)}}class zn extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,a,h={}){a=a instanceof MouseEvent?a:new MouseEvent(t,a);let m=_t.mousePos(i.getCanvas(),a),v=i.unproject(m);super(t,u.e({point:m,lngLat:v,originalEvent:a},h)),this._defaultPrevented=!1,this.target=i}}class ds extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,a){let h=t==="touchend"?a.changedTouches:a.touches,m=_t.touchPos(i.getCanvasContainer(),h),v=m.map(P=>i.unproject(P)),C=m.reduce((P,I,D,F)=>P.add(I.div(F.length)),new u.P(0,0));super(t,{points:m,point:C,lngLats:v,lngLat:i.unproject(C),originalEvent:a}),this._defaultPrevented=!1}}class Rl extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,a){super(t,{originalEvent:a}),this._defaultPrevented=!1}}class nu{constructor(t,i){this._map=t,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Rl(t.type,this._map,t))}mousedown(t,i){return this._mousedownPos=i,this._firePreventable(new zn(t.type,this._map,t))}mouseup(t){this._map.fire(new zn(t.type,this._map,t))}click(t,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new zn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new zn(t.type,this._map,t))}mouseover(t){this._map.fire(new zn(t.type,this._map,t))}mouseout(t){this._map.fire(new zn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ds(t.type,this._map,t))}touchmove(t){this._map.fire(new ds(t.type,this._map,t))}touchend(t){this._map.fire(new ds(t.type,this._map,t))}touchcancel(t){this._map.fire(new ds(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class su{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new zn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new zn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qs{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(u.P.convert(t),this._map.terrain)}}class za{constructor(t,i){this._map=t,this._tr=new Qs(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,i){this.isEnabled()&&t.shiftKey&&t.button===0&&(_t.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(t,i){if(!this._active)return;let a=i;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;let h=this._startPos;this._lastPos=a,this._box||(this._box=_t.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));let m=Math.min(h.x,a.x),v=Math.max(h.x,a.x),C=Math.min(h.y,a.y),P=Math.max(h.y,a.y);_t.setTransform(this._box,`translate(${m}px,${C}px)`),this._box.style.width=v-m+"px",this._box.style.height=P-C+"px"}mouseupWindow(t,i){if(!this._active||t.button!==0)return;let a=this._startPos,h=i;if(this.reset(),_t.suppressClick(),a.x!==h.x||a.y!==h.y)return this._map.fire(new u.l("boxzoomend",{originalEvent:t})),{cameraAnimation:m=>m.fitScreenCoordinates(a,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(_t.remove(this._box),this._box=null),_t.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new u.l(t,{originalEvent:i}))}}function bl(d,t){if(d.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${t.length}`);let i={};for(let a=0;a<d.length;a++)i[d[a].identifier]=t[a];return i}class ou{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,i,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),a.length===this.numTouches&&(this.centroid=function(h){let m=new u.P(0,0);for(let v of h)m._add(v);return m.div(h.length)}(i),this.touches=bl(a,i)))}touchmove(t,i,a){if(this.aborted||!this.centroid)return;let h=bl(a,i);for(let m in this.touches){let v=h[m];(!v||v.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(t,i,a){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){let h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class Ol{constructor(t){this.singleTap=new ou(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,i,a){this.singleTap.touchstart(t,i,a)}touchmove(t,i,a){this.singleTap.touchmove(t,i,a)}touchend(t,i,a){let h=this.singleTap.touchend(t,i,a);if(h){let m=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(h)<30;if(m&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class ga{constructor(t){this._tr=new Qs(t),this._zoomIn=new Ol({numTouches:1,numTaps:2}),this._zoomOut=new Ol({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,i,a){this._zoomIn.touchstart(t,i,a),this._zoomOut.touchstart(t,i,a)}touchmove(t,i,a){this._zoomIn.touchmove(t,i,a),this._zoomOut.touchmove(t,i,a)}touchend(t,i,a){let h=this._zoomIn.touchend(t,i,a),m=this._zoomOut.touchend(t,i,a),v=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(h)},{originalEvent:t})}):m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(m)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class So{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){let i=this._moveFunction(...t);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(t,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,i){if(!this.isEnabled())return;let a=this._lastPoint;if(!a)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);let h=Array.isArray(i)?i[0]:i;return!this._moved&&h.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(a,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&_t.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let Qn=0,ks=2,au={[Qn]:1,[ks]:2};class nn{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){let i=_t.mouseButton(t);this._eventButton=i}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(i,a){let h=au[a];return i.buttons===void 0||(i.buttons&h)!==h}(t,this._eventButton)}isValidEndEvent(t){return _t.mouseButton(t)===this._eventButton}}class ya{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Lu{constructor(t=new nn({checkCorrectEvent:()=>!0}),i=new ya){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(t,i,a){return t instanceof MouseEvent?i(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?a(t):void 0}startMove(t){this._executeRelevantHandler(t,i=>this.mouseMoveStateManager.startMove(i),i=>this.oneFingerTouchMoveStateManager.startMove(i))}endMove(t){this._executeRelevantHandler(t,i=>this.mouseMoveStateManager.endMove(i),i=>this.oneFingerTouchMoveStateManager.endMove(i))}isValidStartEvent(t){return this._executeRelevantHandler(t,i=>this.mouseMoveStateManager.isValidStartEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i))}isValidMoveEvent(t){return this._executeRelevantHandler(t,i=>this.mouseMoveStateManager.isValidMoveEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i))}isValidEndEvent(t){return this._executeRelevantHandler(t,i=>this.mouseMoveStateManager.isValidEndEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i))}}let wl=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=t=>{t.preventDefault()}};class lu{constructor(t,i){this._clickTolerance=t.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,i,a){return this._calculateTransform(t,i,a)}touchmove(t,i,a){if(this._active){if(!this._shouldBePrevented(a.length))return t.preventDefault(),this._calculateTransform(t,i,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,i,a){this._calculateTransform(t,i,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,a){a.length>0&&(this._active=!0);let h=bl(a,i),m=new u.P(0,0),v=new u.P(0,0),C=0;for(let I in h){let D=h[I],F=this._touches[I];F&&(m._add(D),v._add(D.sub(F)),C++,h[I]=D)}if(this._touches=h,this._shouldBePrevented(C)||!v.mag())return;let P=v.div(C);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(C),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,i,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([i[0],i[1]]))}touchmove(t,i,a){if(!this._firstTwoTouches)return;t.preventDefault();let[h,m]=this._firstTwoTouches,v=cl(a,i,h),C=cl(a,i,m);if(!v||!C)return;let P=this._aroundCenter?null:v.add(C).div(2);return this._move([v,C],P,t)}touchend(t,i,a){if(!this._firstTwoTouches)return;let[h,m]=this._firstTwoTouches,v=cl(a,i,h),C=cl(a,i,m);v&&C||(this._active&&_t.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function cl(d,t,i){for(let a=0;a<d.length;a++)if(d[a].identifier===i)return t[a]}function Ra(d,t){return Math.log(d/t)/Math.LN2}class to extends Fl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,i){let a=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ra(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ra(this._distance,a),pinchAround:i}}}function De(d,t){return 180*d.angleWith(t)/Math.PI}class Nl extends Fl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,i,a){let h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:De(this._vector,h),pinchAround:i}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());let i=25/(Math.PI*this._minDiameter)*360,a=De(t,this._startVector);return Math.abs(a)<i}}function Oa(d){return Math.abs(d.y)>Math.abs(d.x)}class Ho extends Fl{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,i,a){super.touchstart(t,i,a),this._currentTouchCount=a.length}_start(t){this._lastPoints=t,Oa(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,i,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let h=t[0].sub(this._lastPoints[0]),m=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,m,a.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(t,i,a){if(this._valid!==void 0)return this._valid;let h=t.mag()>=2,m=i.mag()>=2;if(!h&&!m)return;if(!h||!m)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;let v=t.y>0==i.y>0;return Oa(t)&&Oa(i)&&v}}let Wo={panStep:100,bearingStep:15,pitchStep:10};class Fa{constructor(t){this._tr=new Qs(t);let i=Wo;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let i=0,a=0,h=0,m=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),m=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),m=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(a=0,h=0),{cameraAnimation:C=>{let P=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:jl,zoom:i?Math.round(P.zoom)+i*(t.shiftKey?2:1):P.zoom,bearing:P.bearing+a*this._bearingStep,pitch:P.pitch+h*this._pitchStep,offset:[-m*this._panStep,-v*this._panStep],center:P.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jl(d){return d*(2-d)}let xi=4.000244140625,xr=1/450;class ko{constructor(t,i){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=t,this._tr=new Qs(t),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=xr}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let i=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,a=re.now(),h=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,i!==0&&i%xi==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let i=_t.mousePos(this._map.getCanvas(),t),a=this._tr;this._aroundPoint=this._aroundCenter?a.transform.locationToScreenPoint(u.S.convert(a.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let C=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=C),typeof this._targetZoom=="number"&&(this._targetZoom+=C)}if(this._delta!==0){let C=this._type==="wheel"&&Math.abs(this._delta)>xi?this._wheelZoomRate:this._defaultZoomRate,P=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&P!==0&&(P=1/P);let I=typeof this._targetZoom!="number"?t.scale:u.ae(this._targetZoom);this._targetZoom=t.getConstrained(t.getCameraLngLat(),u.aj(I*P)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let i=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,a=this._startZoom,h=this._easing,m,v=!1;if(this._type==="wheel"&&a&&h){let C=re.now()-this._lastWheelEventTime,P=Math.min((C+5)/200,1),I=h(P);m=u.C.number(a,i,I),P<1?this._frameId||(this._frameId=!0):v=!0}else m=i,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=m,{noInertia:!0,needsRenderFrame:!v,zoomDelta:m-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=u.cn;if(this._prevEase){let a=this._prevEase,h=(re.now()-a.start)/a.duration,m=a.easing(h+.01)-a.easing(h),v=.27/Math.sqrt(m*m+1e-4)*.01,C=Math.sqrt(.0729-v*v);i=u.cl(v,C,.25,1)}return this._prevEase={start:re.now(),duration:t,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Cl{constructor(t,i){this._clickZoom=t,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Tu{constructor(t){this._tr=new Qs(t),this.reset()}reset(){this._active=!1}dblclick(t,i){return t.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gl{constructor(){this._tap=new Ol({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,i,a){if(!this._swipePoint)if(this._tapTime){let h=i[0],m=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(h)<30;m&&v?a.length>0&&(this._swipePoint=h,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(t,i,a)}touchmove(t,i,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;let h=i[0],m=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(t,i,a)}touchend(t,i,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{let h=this._tap.touchend(t,i,a);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zl{constructor(t,i,a){this._el=t,this._mousePan=i,this._touchPan=a}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ml{constructor(t,i,a,h){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=i,this._mousePitch=a,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Vl{constructor(t,i,a,h){this._el=t,this._touchZoom=i,this._touchRotate=a,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class l{constructor(t,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=_t.create("div","maplibregl-cooperative-gesture-screen",t);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=i,this._container.appendChild(h);let m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=a,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(_t.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,i){this._enabled&&(this._map.fire(new u.l("cooperativegestureprevented",{gestureType:t,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let p=d=>d.zoom||d.drag||d.roll||d.pitch||d.rotate;class y extends u.l{}function x(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta||d.rollDelta}class M{constructor(t,i){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,m)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let v=h.type==="renderFrame"?void 0:h,C={needsRenderFrame:!1},P={},I={};for(let{handlerName:O,handler:Z,allowed:X}of this._handlers){if(!Z.isEnabled())continue;let nt;if(this._blockedByActive(I,X,O))Z.reset();else if(Z[m||h.type]){if(u.co(h,m||h.type)){let ct=_t.mousePos(this._map.getCanvas(),h);nt=Z[m||h.type](h,ct)}else if(u.cp(h,m||h.type)){let ct=this._getMapTouches(h.touches),dt=_t.touchPos(this._map.getCanvas(),ct);nt=Z[m||h.type](h,dt,ct)}else u.cq(m||h.type)||(nt=Z[m||h.type](h));this.mergeHandlerResult(C,P,nt,O,v),nt&&nt.needsRenderFrame&&this._triggerRenderFrame()}(nt||Z.isActive())&&(I[O]=Z)}let D={};for(let O in this._previousActiveHandlers)I[O]||(D[O]=v);this._previousActiveHandlers=I,(Object.keys(D).length||x(C))&&(this._changes.push([C,P,D]),this._triggerRenderFrame()),(Object.keys(I).length||x(C))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=C;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new zl(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);let a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(let[h,m,v]of this._listeners)_t.addEventListener(h,m,h===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(let[t,i,a]of this._listeners)_t.removeEventListener(t,i,t===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(t){let i=this._map,a=i.getCanvasContainer();this._add("mapEvent",new nu(i,t));let h=i.boxZoom=new za(i,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();let m=i.cooperativeGestures=new l(i,t.cooperativeGestures);this._add("cooperativeGestures",m),t.cooperativeGestures&&m.enable();let v=new ga(i),C=new Tu(i);i.doubleClickZoom=new Cl(C,v),this._add("tapZoom",v),this._add("clickZoom",C),t.interactive&&t.doubleClickZoom&&i.doubleClickZoom.enable();let P=new Gl;this._add("tapDragZoom",P);let I=i.touchPitch=new Ho(i);this._add("touchPitch",I),t.interactive&&t.touchPitch&&i.touchPitch.enable(t.touchPitch);let D=()=>i.project(i.getCenter()),F=function({enable:yt,clickTolerance:Lt,aroundCenter:It=!0,minPixelCenterThreshold:xt=100,rotateDegreesPerPixelMoved:Ot=.8},ue){let te=new nn({checkCorrectEvent:ne=>_t.mouseButton(ne)===0&&ne.ctrlKey||_t.mouseButton(ne)===2&&!ne.ctrlKey});return new So({clickTolerance:Lt,move:(ne,he)=>{let Ee=ue();if(It&&Math.abs(Ee.y-ne.y)>xt)return{bearingDelta:u.cm(new u.P(ne.x,he.y),he,Ee)};let ke=(he.x-ne.x)*Ot;return It&&he.y<Ee.y&&(ke=-ke),{bearingDelta:ke}},moveStateManager:te,enable:yt,assignEvents:wl})}(t,D),O=function({enable:yt,clickTolerance:Lt,pitchDegreesPerPixelMoved:It=-.5}){let xt=new nn({checkCorrectEvent:Ot=>_t.mouseButton(Ot)===0&&Ot.ctrlKey||_t.mouseButton(Ot)===2});return new So({clickTolerance:Lt,move:(Ot,ue)=>({pitchDelta:(ue.y-Ot.y)*It}),moveStateManager:xt,enable:yt,assignEvents:wl})}(t),Z=function({enable:yt,clickTolerance:Lt,rollDegreesPerPixelMoved:It=.3},xt){let Ot=new nn({checkCorrectEvent:ue=>_t.mouseButton(ue)===2&&ue.ctrlKey});return new So({clickTolerance:Lt,move:(ue,te)=>{let ne=xt(),he=(te.x-ue.x)*It;return te.y<ne.y&&(he=-he),{rollDelta:he}},moveStateManager:Ot,enable:yt,assignEvents:wl})}(t,D);i.dragRotate=new Ml(t,F,O,Z),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",O,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Z,["mousePitch"]),t.interactive&&t.dragRotate&&i.dragRotate.enable();let X=function({enable:yt,clickTolerance:Lt}){let It=new nn({checkCorrectEvent:xt=>_t.mouseButton(xt)===0&&!xt.ctrlKey});return new So({clickTolerance:Lt,move:(xt,Ot)=>({around:Ot,panDelta:Ot.sub(xt)}),activateOnStart:!0,moveStateManager:It,enable:yt,assignEvents:wl})}(t),nt=new lu(t,i);i.dragPan=new Zl(a,X,nt),this._add("mousePan",X),this._add("touchPan",nt,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&i.dragPan.enable(t.dragPan);let ct=new Nl,dt=new to;i.touchZoomRotate=new Vl(a,dt,ct,P),this._add("touchRotate",ct,["touchPan","touchZoom"]),this._add("touchZoom",dt,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&i.touchZoomRotate.enable(t.touchZoomRotate);let mt=i.scrollZoom=new ko(i,()=>this._triggerRenderFrame());this._add("scrollZoom",mt,["mousePan"]),t.interactive&&t.scrollZoom&&i.scrollZoom.enable(t.scrollZoom);let Ct=i.keyboard=new Fa(i);this._add("keyboard",Ct),t.interactive&&t.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new su(i))}_add(t,i,a){this._handlers.push({handlerName:t,handler:i,allowed:a}),this._handlersById[t]=i}stop(t){if(!this._updatingCamera){for(let{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(let{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!p(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,i,a){for(let h in t)if(h!==a&&(!i||i.indexOf(h)<0))return!0;return!1}_getMapTouches(t){let i=[];for(let a of t)this._el.contains(a.target)&&i.push(a);return i}mergeHandlerResult(t,i,a,h,m){if(!a)return;u.e(t,a);let v={handlerName:h,originalEvent:a.originalEvent||m};a.zoomDelta!==void 0&&(i.zoom=v),a.panDelta!==void 0&&(i.drag=v),a.rollDelta!==void 0&&(i.roll=v),a.pitchDelta!==void 0&&(i.pitch=v),a.bearingDelta!==void 0&&(i.rotate=v)}_applyChanges(){let t={},i={},a={};for(let[h,m,v]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new u.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(t.rollDelta=(t.rollDelta||0)+h.rollDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),u.e(i,m),u.e(a,v);this._updateMapTransform(t,i,a),this._changes=[]}_updateMapTransform(t,i,a){let h=this._map,m=h._getTransformForUpdate(),v=h.terrain;if(!(x(t)||v&&this._terrainMovement))return this._fireEvents(i,a,!0);h._stop(!0);let{panDelta:C,zoomDelta:P,bearingDelta:I,pitchDelta:D,rollDelta:F,around:O,pinchAround:Z}=t;Z!==void 0&&(O=Z),O=O||h.transform.centerPoint,v&&!m.isPointOnMapSurface(O)&&(O=m.centerPoint);let X={panDelta:C,zoomDelta:P,rollDelta:F,pitchDelta:D,bearingDelta:I,around:O};this._map.cameraHelper.useGlobeControls&&!m.isPointOnMapSurface(O)&&(O=m.centerPoint);let nt=O.distSqr(m.centerPoint)<.01?m.center:m.screenPointToLocation(C?O.sub(C):O);v?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(X,m),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?m.setCenter(m.screenPointToLocation(m.centerPoint.sub(C))):this._map.cameraHelper.handleMapControlsPan(X,m,nt):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(X,m,nt))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(X,m),this._map.cameraHelper.handleMapControlsPan(X,m,nt)),h._applyUpdatedTransform(m),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,a,!0)}_fireEvents(t,i,a){let h=p(this._eventsInProgress),m=p(t),v={};for(let F in t){let{originalEvent:O}=t[F];this._eventsInProgress[F]||(v[`${F}start`]=O),this._eventsInProgress[F]=t[F]}!h&&m&&this._fireEvent("movestart",m.originalEvent);for(let F in v)this._fireEvent(F,v[F]);m&&this._fireEvent("move",m.originalEvent);for(let F in t){let{originalEvent:O}=t[F];this._fireEvent(F,O)}let C={},P;for(let F in this._eventsInProgress){let{handlerName:O,originalEvent:Z}=this._eventsInProgress[F];this._handlersById[O].isActive()||(delete this._eventsInProgress[F],P=i[O]||Z,C[`${F}end`]=P)}for(let F in C)this._fireEvent(F,C[F]);let I=p(this._eventsInProgress),D=(h||m)&&!I;if(D&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let F=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&F.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(F)}if(a&&D){this._updatingCamera=!0;let F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!F||!F.essential&&re.prefersReducedMotion?(this._map.fire(new u.l("moveend",{originalEvent:P})),O(this._map.getBearing())&&this._map.resetNorth()):(O(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:P})),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new u.l(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new y("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class A extends u.E{constructor(t,i,a){super(),this._renderFrameCallback=()=>{let h=Math.min((re.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this.cameraHelper=i,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,i){t.apply(this.transform),this.transform=t,this.cameraHelper=i}getCenter(){return new u.S(this.transform.center.lng,this.transform.center.lat)}setCenter(t,i){return this.jumpTo({center:t},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,i){return this.jumpTo({elevation:t},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,i,a){return t=u.P.convert(t).mult(-1),this.panTo(this.transform.center,u.e({offset:t},i),a)}panTo(t,i,a){return this.easeTo(u.e({center:t},i),a)}getZoom(){return this.transform.zoom}setZoom(t,i){return this.jumpTo({zoom:t},i),this}zoomTo(t,i,a){return this.easeTo(u.e({zoom:t},i),a)}zoomIn(t,i){return this.zoomTo(this.getZoom()+1,t,i),this}zoomOut(t,i){return this.zoomTo(this.getZoom()-1,t,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,i){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new u.l("movestart",i)).fire(new u.l("move",i)).fire(new u.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(t,i){return this.jumpTo({bearing:t},i),this}getPadding(){return this.transform.padding}setPadding(t,i){return this.jumpTo({padding:t},i),this}rotateTo(t,i,a){return this.easeTo(u.e({bearing:t},i),a)}resetNorth(t,i){return this.rotateTo(0,u.e({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(u.e({bearing:0,pitch:0,roll:0,duration:1e3},t),i),this}snapToNorth(t,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,i):this}getPitch(){return this.transform.pitch}setPitch(t,i){return this.jumpTo({pitch:t},i),this}getRoll(){return this.transform.roll}setRoll(t,i){return this.jumpTo({roll:t},i),this}cameraForBounds(t,i){t=ji.convert(t).adjustAntiMeridian();let a=i&&i.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),a,i)}_cameraForBoxAndBearing(t,i,a,h){let m={top:0,bottom:0,right:0,left:0};if(typeof(h=u.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){let I=h.padding;h.padding={top:I,bottom:I,right:I,left:I}}let v=u.e(m,h.padding);h.padding=v;let C=this.transform,P=new ji(t,i);return this.cameraHelper.cameraForBoxAndBearing(h,v,P,a,C)}fitBounds(t,i,a){return this._fitInternal(this.cameraForBounds(t,i),i,a)}fitScreenCoordinates(t,i,a,h,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(u.P.convert(t)),this.transform.screenPointToLocation(u.P.convert(i)),a,h),h,m)}_fitInternal(t,i,a){return t?(delete(i=u.e(t,i)).padding,i.linear?this.easeTo(i,a):this.flyTo(i,a)):this}jumpTo(t,i){this.stop();let a=this._getTransformForUpdate(),h=!1,m=!1,v=!1,C=a.zoom;this.cameraHelper.handleJumpToCenterZoom(a,t);let P=a.zoom!==C;return"elevation"in t&&a.elevation!==+t.elevation&&a.setElevation(+t.elevation),"bearing"in t&&a.bearing!==+t.bearing&&(h=!0,a.setBearing(+t.bearing)),"pitch"in t&&a.pitch!==+t.pitch&&(m=!0,a.setPitch(+t.pitch)),"roll"in t&&a.roll!==+t.roll&&(v=!0,a.setRoll(+t.roll)),t.padding==null||a.isPaddingEqual(t.padding)||a.setPadding(t.padding),this._applyUpdatedTransform(a),this.fire(new u.l("movestart",i)).fire(new u.l("move",i)),P&&this.fire(new u.l("zoomstart",i)).fire(new u.l("zoom",i)).fire(new u.l("zoomend",i)),h&&this.fire(new u.l("rotatestart",i)).fire(new u.l("rotate",i)).fire(new u.l("rotateend",i)),m&&this.fire(new u.l("pitchstart",i)).fire(new u.l("pitch",i)).fire(new u.l("pitchend",i)),v&&this.fire(new u.l("rollstart",i)).fire(new u.l("roll",i)).fire(new u.l("rollend",i)),this.fire(new u.l("moveend",i))}calculateCameraOptionsFromTo(t,i,a,h=0){let m=u.a0.fromLngLat(t,i),v=u.a0.fromLngLat(a,h),C=v.x-m.x,P=v.y-m.y,I=v.z-m.z,D=Math.hypot(C,P,I);if(D===0)throw new Error("Can't calculate camera options with same From and To");let F=Math.hypot(C,P),O=u.aj(this.transform.cameraToCenterDistance/D/this.transform.tileSize),Z=180*Math.atan2(C,-P)/Math.PI,X=180*Math.acos(F/D)/Math.PI;return X=I<0?90-X:90+X,{center:v.toLngLat(),elevation:h,zoom:O,pitch:X,bearing:Z}}calculateCameraOptionsFromCameraLngLatAltRotation(t,i,a,h,m){let v=this.transform.calculateCenterFromCameraLngLatAlt(t,i,a,h);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:a,pitch:h,roll:m}}easeTo(t,i){this._stop(!1,t.easeId),((t=u.e({offset:[0,0],duration:500,easing:u.cn},t)).animate===!1||!t.essential&&re.prefersReducedMotion)&&(t.duration=0);let a=this._getTransformForUpdate(),h=this.getBearing(),m=a.pitch,v=a.roll,C="bearing"in t?this._normalizeBearing(t.bearing,h):h,P="pitch"in t?+t.pitch:m,I="roll"in t?this._normalizeBearing(t.roll,v):v,D="padding"in t?t.padding:a.padding,F=u.P.convert(t.offset),O,Z;t.around&&(O=u.S.convert(t.around),Z=a.locationToScreenPoint(O));let X={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},nt=this.cameraHelper.handleEaseTo(a,{bearing:C,pitch:P,roll:I,padding:D,around:O,aroundPoint:Z,offsetAsPoint:F,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||h!==C,this._pitching=this._pitching||P!==m,this._rolling=this._rolling||I!==v,this._padding=!a.isPaddingEqual(D),this._zooming=this._zooming||nt.isZooming,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,X),this.terrain&&this._prepareElevation(nt.elevationCenter),this._ease(ct=>{nt.easeFunc(ct),this.terrain&&!t.freezeElevation&&this._updateElevation(ct),this._applyUpdatedTransform(a),this._fireMoveEvents(i)},ct=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(i,ct)},t),this}_prepareEase(t,i,a={}){this._moving=!0,i||a.moving||this.fire(new u.l("movestart",t)),this._zooming&&!a.zooming&&this.fire(new u.l("zoomstart",t)),this._rotating&&!a.rotating&&this.fire(new u.l("rotatestart",t)),this._pitching&&!a.pitching&&this.fire(new u.l("pitchstart",t)),this._rolling&&!a.rolling&&this.fire(new u.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&i!==this._elevationTarget){let a=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(a-(i-(a*t+this._elevationStart))/(1-t)),this._elevationTarget=i}this.transform.setElevation(u.C.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};let i=t.getCameraLngLat(),a=t.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(i,t.zoom):0;if(a<h){let m=this.calculateCameraOptionsFromTo(i,h,t.center,t.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(t){let i=[];if(i.push(h=>this._elevateCameraIfInsideTerrain(h)),this.transformCameraUpdate&&i.push(h=>this.transformCameraUpdate(h)),!i.length)return;let a=t.clone();for(let h of i){let m=a.clone(),{center:v,zoom:C,roll:P,pitch:I,bearing:D,elevation:F}=h(m);v&&m.setCenter(v),F!==void 0&&m.setElevation(F),C!==void 0&&m.setZoom(C),P!==void 0&&m.setRoll(P),I!==void 0&&m.setPitch(I),D!==void 0&&m.setBearing(D),a.apply(m)}this.transform.apply(a)}_fireMoveEvents(t){this.fire(new u.l("move",t)),this._zooming&&this.fire(new u.l("zoom",t)),this._rotating&&this.fire(new u.l("rotate",t)),this._pitching&&this.fire(new u.l("pitch",t)),this._rolling&&this.fire(new u.l("roll",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;let a=this._zooming,h=this._rotating,m=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,a&&this.fire(new u.l("zoomend",t)),h&&this.fire(new u.l("rotateend",t)),m&&this.fire(new u.l("pitchend",t)),v&&this.fire(new u.l("rollend",t)),this.fire(new u.l("moveend",t))}flyTo(t,i){if(!t.essential&&re.prefersReducedMotion){let he=u.Q(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(he,i)}this.stop(),t=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.cn},t);let a=this._getTransformForUpdate(),h=a.bearing,m=a.pitch,v=a.roll,C=a.padding,P="bearing"in t?this._normalizeBearing(t.bearing,h):h,I="pitch"in t?+t.pitch:m,D="roll"in t?this._normalizeBearing(t.roll,v):v,F="padding"in t?t.padding:a.padding,O=u.P.convert(t.offset),Z=a.centerPoint.add(O),X=a.screenPointToLocation(Z),nt=this.cameraHelper.handleFlyTo(a,{bearing:P,pitch:I,roll:D,padding:F,locationAtOffset:X,offsetAsPoint:O,center:t.center,minZoom:t.minZoom,zoom:t.zoom}),ct=t.curve,dt=Math.max(a.width,a.height),mt=dt/nt.scaleOfZoom,Ct=nt.pixelPathLength;typeof nt.scaleOfMinZoom=="number"&&(ct=Math.sqrt(dt/nt.scaleOfMinZoom/Ct*2));let yt=ct*ct;function Lt(he){let Ee=(mt*mt-dt*dt+(he?-1:1)*yt*yt*Ct*Ct)/(2*(he?mt:dt)*yt*Ct);return Math.log(Math.sqrt(Ee*Ee+1)-Ee)}function It(he){return(Math.exp(he)-Math.exp(-he))/2}function xt(he){return(Math.exp(he)+Math.exp(-he))/2}let Ot=Lt(!1),ue=function(he){return xt(Ot)/xt(Ot+ct*he)},te=function(he){return dt*((xt(Ot)*(It(Ee=Ot+ct*he)/xt(Ee))-It(Ot))/yt)/Ct;var Ee},ne=(Lt(!0)-Ot)/ct;if(Math.abs(Ct)<2e-6||!isFinite(ne)){if(Math.abs(dt-mt)<1e-6)return this.easeTo(t,i);let he=mt<dt?-1:1;ne=Math.abs(Math.log(mt/dt))/ct,te=()=>0,ue=Ee=>Math.exp(he*ct*Ee)}return t.duration="duration"in t?+t.duration:1e3*ne/("screenSpeed"in t?+t.screenSpeed/ct:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=h!==P,this._pitching=I!==m,this._rolling=D!==v,this._padding=!a.isPaddingEqual(F),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(nt.targetCenter),this._ease(he=>{let Ee=he*ne,ke=1/ue(Ee),xe=te(Ee);this._rotating&&a.setBearing(u.C.number(h,P,he)),this._pitching&&a.setPitch(u.C.number(m,I,he)),this._rolling&&a.setRoll(u.C.number(v,D,he)),this._padding&&(a.interpolatePadding(C,F,he),Z=a.centerPoint.add(O)),nt.easeFunc(he,ke,xe,Z),this.terrain&&!t.freezeElevation&&this._updateElevation(he),this._applyUpdatedTransform(a),this._fireMoveEvents(i)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(i)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,i){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,i)}return t||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(t,i,a){a.animate===!1||a.duration===0?(t(1),i()):(this._easeStart=re.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,i){t=u.aN(t,-180,180);let a=Math.abs(t-i);return Math.abs(t-360-i)<a&&(t-=360),Math.abs(t+360-i)<a&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(u.S.convert(t),this.transform.tileZoom):null}}let R={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class j{constructor(t=R){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=_t.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=_t.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=_t.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){_t.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,i){let a=this._map._getUIString(`AttributionControl.${i}`);t.title=a,t.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){let h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}let i=this._map.style.sourceCaches;for(let h in i){let m=i[h];if(m.used||m.usedForTerrain){let v=m.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter(h=>String(h).trim()),t.sort((h,m)=>h.length-m.length),t=t.filter((h,m)=>{for(let v=m+1;v<t.length;v++)if(t[v].indexOf(h)>=0)return!1;return!0});let a=t.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=_t.sanitize(a),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class W{constructor(t={}){this._updateCompact=()=>{let i=this._container.children;if(i.length){let a=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=_t.create("div","maplibregl-ctrl");let i=_t.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){_t.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class et{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){let i=++this._id;return this._queue.push({callback:t,id:i,cancelled:!1}),i}remove(t){let i=this._currentlyRunning,a=i?this._queue.concat(i):this._queue;for(let h of a)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let i=this._currentlyRunning=this._queue;this._queue=[];for(let a of i)if(!a.cancelled&&(a.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Tt=u.aI([{name:"a_pos3d",type:"Int16",components:3}]);class kt extends u.E{constructor(t){super(),this._lastTilesetChange=re.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,i){this.sourceCache.update(t,i),this._renderableTilesKeys=[];let a={};for(let h of ce(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))a[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),u.bX(h.terrainRttPosMatrix32f,0,u.$,u.$,0,0,1),this._tiles[h.key]=new Vn(h,this.tileSize),this._lastTilesetChange=re.now());for(let h in this._tiles)a[h]||delete this._tiles[h]}freeRtt(t){for(let i in this._tiles){let a=this._tiles[i];(!t||a.tileID.equals(t)||a.tileID.isChildOf(t)||t.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,i){return i?this._getTerrainCoordsForTileRanges(t,i):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){let i={};for(let a of this._renderableTilesKeys){let h=this._tiles[a].tileID,m=t.clone(),v=u.b9();if(h.canonical.equals(t.canonical))u.bX(v,0,u.$,u.$,0,0,1);else if(h.canonical.isChildOf(t.canonical)){let C=h.canonical.z-t.canonical.z,P=h.canonical.x-(h.canonical.x>>C<<C),I=h.canonical.y-(h.canonical.y>>C<<C),D=u.$>>C;u.bX(v,0,D,D,0,0,1),u.M(v,v,[-P*D,-I*D,0])}else{if(!t.canonical.isChildOf(h.canonical))continue;{let C=t.canonical.z-h.canonical.z,P=t.canonical.x-(t.canonical.x>>C<<C),I=t.canonical.y-(t.canonical.y>>C<<C),D=u.$>>C;u.bX(v,0,u.$,u.$,0,0,1),u.M(v,v,[P*D,I*D,0]),u.N(v,v,[1/2**C,1/2**C,0])}}m.terrainRttPosMatrix32f=new Float32Array(v),i[a]=m}return i}_getTerrainCoordsForTileRanges(t,i){let a={};for(let h of this._renderableTilesKeys){let m=this._tiles[h].tileID;if(!this._isWithinTileRanges(m,i))continue;let v=t.clone(),C=u.b9();if(m.canonical.z===t.canonical.z){let P=t.canonical.x-m.canonical.x,I=t.canonical.y-m.canonical.y;u.bX(C,0,u.$,u.$,0,0,1),u.M(C,C,[P*u.$,I*u.$,0])}else if(m.canonical.z>t.canonical.z){let P=m.canonical.z-t.canonical.z,I=m.canonical.x-(m.canonical.x>>P<<P),D=m.canonical.y-(m.canonical.y>>P<<P),F=t.canonical.x-(m.canonical.x>>P),O=t.canonical.y-(m.canonical.y>>P),Z=u.$>>P;u.bX(C,0,Z,Z,0,0,1),u.M(C,C,[-I*Z+F*u.$,-D*Z+O*u.$,0])}else{let P=t.canonical.z-m.canonical.z,I=t.canonical.x-(t.canonical.x>>P<<P),D=t.canonical.y-(t.canonical.y>>P<<P),F=(t.canonical.x>>P)-m.canonical.x,O=(t.canonical.y>>P)-m.canonical.y,Z=u.$<<P;u.bX(C,0,Z,Z,0,0,1),u.M(C,C,[I*u.$+F*Z,D*u.$+O*Z,0])}v.terrainRttPosMatrix32f=new Float32Array(C),a[h]=v}return a}getSourceTile(t,i){let a=this.sourceCache._source,h=t.overscaledZ-this.deltaZoom;if(h>a.maxzoom&&(h=a.maxzoom),h<a.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!m||!m.dem)&&i)for(;h>=a.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(t.scaledTo(h--).key);return m}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,i){return i[t.canonical.z]&&t.canonical.x>=i[t.canonical.z].minTileX&&t.canonical.x<=i[t.canonical.z].maxTileX&&t.canonical.y>=i[t.canonical.z].minTileY&&t.canonical.y<=i[t.canonical.z].maxTileY}}class ie{constructor(t,i,a){this._meshCache={},this.painter=t,this.sourceCache=new kt(i),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,i,a,h=u.$){var m;if(!(i>=0&&i<h&&a>=0&&a<h))return 0;let v=this.getTerrainData(t),C=(m=v.tile)===null||m===void 0?void 0:m.dem;if(!C)return 0;let P=u.cr([],[i/h*u.$,a/h*u.$],v.u_terrain_matrix),I=[P[0]*C.dim,P[1]*C.dim],D=Math.floor(I[0]),F=Math.floor(I[1]),O=I[0]-D,Z=I[1]-F;return C.get(D,F)*(1-O)*(1-Z)+C.get(D+1,F)*O*(1-Z)+C.get(D,F+1)*(1-O)*Z+C.get(D+1,F+1)*O*Z}getElevationForLngLatZoom(t,i){if(!u.cs(i,t.wrap()))return 0;let{tileID:a,mercatorX:h,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(t,i);return this.getElevation(a,h%u.$,m%u.$,u.$)}getElevation(t,i,a,h=u.$){return this.getDEMElevation(t,i,a,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){let h=this.painter.context,m=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new u.T(h,m,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new u.T(h,new u.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.af([])}let i=this.sourceCache.getSourceTile(t,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){let h=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new u.T(h,i.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),i.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}let a=i&&i+i.tileID.key+t.key;if(a&&!this._demMatrixCache[a]){let h=this.sourceCache.sourceCache._source.maxzoom,m=t.canonical.z-i.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?m=t.canonical.z-h:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let v=t.canonical.x-(t.canonical.x>>m<<m),C=t.canonical.y-(t.canonical.y>>m<<m),P=u.ct(new Float64Array(16),[1/(u.$<<m),1/(u.$<<m),0]);u.M(P,P,[v*u.$,C*u.$,0]),this._demMatrixCache[t.key]={matrix:P,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(t){let i=this.painter,a=i.width/devicePixelRatio,h=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new u.T(i.context,{width:a,height:h,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new u.T(i.context,{width:a,height:h,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(a,h,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,a,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,v=0;m<this._coordsTextureSize;m++)for(let C=0;C<this._coordsTextureSize;C++,v+=4)i[v+0]=255&C,i[v+1]=255&m,i[v+2]=C>>8<<4|m>>8,i[v+3]=0;let a=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),h=new u.T(t,a,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);let i=new Uint8Array(4),a=this.painter.context,h=a.gl,m=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(m,C-v-1,1,1,h.RGBA,h.UNSIGNED_BYTE,i),a.bindFramebuffer.set(null);let P=i[0]+(i[2]>>4<<8),I=i[1]+((15&i[2])<<8),D=this.coordsIndex[255-i[3]],F=D&&this.sourceCache.getTileByID(D);if(!F)return null;let O=this._coordsTextureSize,Z=(1<<F.tileID.canonical.z)*O;return new u.a0((F.tileID.canonical.x*O+P)/Z+F.tileID.wrap,(F.tileID.canonical.y*O+I)/Z,this.getElevation(F.tileID,P,I,O))}depthAtPoint(t){let i=new Uint8Array(4),a=this.painter.context,h=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,i),a.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(t){var i;let a=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,h=a&&t.canonical.y===0,m=a&&t.canonical.y===(1<<t.canonical.z)-1,v=`m_${h?"n":""}_${m?"s":""}`;if(this._meshCache[v])return this._meshCache[v];let C=this.painter.context,P=new u.cu,I=new u.aM,D=this.meshSize,F=u.$/D,O=D*D;for(let xt=0;xt<=D;xt++)for(let Ot=0;Ot<=D;Ot++)P.emplaceBack(Ot*F,xt*F,0);for(let xt=0;xt<O;xt+=D+1)for(let Ot=0;Ot<D;Ot++)I.emplaceBack(Ot+xt,D+Ot+xt+1,D+Ot+xt+2),I.emplaceBack(Ot+xt,D+Ot+xt+2,Ot+xt+1);let Z=P.length,X=Z+(D+1),nt=(D+1)*D,ct=h?u.bg:0,dt=h?0:1,mt=m?u.bh:u.$,Ct=m?0:1;for(let xt=0;xt<=D;xt++)P.emplaceBack(xt*F,ct,dt);for(let xt=0;xt<=D;xt++)P.emplaceBack(xt*F,mt,Ct);for(let xt=0;xt<D;xt++)I.emplaceBack(nt+xt,X+xt,X+xt+1),I.emplaceBack(nt+xt,X+xt+1,nt+xt+1),I.emplaceBack(0+xt,Z+xt+1,Z+xt),I.emplaceBack(0+xt,0+xt+1,Z+xt+1);let yt=P.length,Lt=yt+2*(D+1);for(let xt of[0,1])for(let Ot=0;Ot<=D;Ot++)for(let ue of[0,1])P.emplaceBack(xt*u.$,Ot*F,ue);for(let xt=0;xt<2*D;xt+=2)I.emplaceBack(yt+xt,yt+xt+1,yt+xt+3),I.emplaceBack(yt+xt,yt+xt+3,yt+xt+2),I.emplaceBack(Lt+xt,Lt+xt+3,Lt+xt+1),I.emplaceBack(Lt+xt,Lt+xt+2,Lt+xt+3);let It=new fn(C.createVertexBuffer(P,Tt.members),C.createIndexBuffer(I),u.aL.simpleSegment(0,0,P.length,I.length));return this._meshCache[v]=It,It}getMeshFrameDelta(t){return 2*Math.PI*u.bt/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,i){var a;let{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,i);return(a=this.getMinMaxElevation(h).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(t){let i=this.getTerrainData(t).tile,a={minElevation:null,maxElevation:null};return i&&i.dem&&(a.minElevation=i.dem.min*this.exaggeration,a.maxElevation=i.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(t,i){let a=u.a0.fromLngLat(t.wrap()),h=(1<<i)*u.$,m=a.x*h,v=a.y*h,C=Math.floor(m/u.$),P=Math.floor(v/u.$);return{tileID:new u.Z(i,0,i,C,P),mercatorX:m,mercatorY:v}}}class Ut{constructor(t,i,a){this._context=t,this._size=i,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){let i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new u.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(a.texture),{id:t,fbo:i,texture:a,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(i=>t.id!==i),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(let i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(let t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}let jt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class de{constructor(t,i){this.painter=t,this.terrain=i,this.pool=new Ut(t.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(a=>!t._layers[a].isHidden(i)),this._coordsAscending={};for(let a in t.sourceCaches){this._coordsAscending[a]={};let h=t.sourceCaches[a].getVisibleCoordinates(),m=t.sourceCaches[a].getSource(),v=m instanceof Rr?m.terrainTileRanges:null;for(let C of h){let P=this.terrain.sourceCache.getTerrainCoords(C,v);for(let I in P)this._coordsAscending[a][I]||(this._coordsAscending[a][I]=[]),this._coordsAscending[a][I].push(P[I])}}this._coordsAscendingStr={};for(let a of t._order){let h=t._layers[a],m=h.source;if(jt[h.type]&&!this._coordsAscendingStr[m]){this._coordsAscendingStr[m]={};for(let v in this._coordsAscending[m])this._coordsAscendingStr[m][v]=this._coordsAscending[m][v].map(C=>C.key).sort().join()}}for(let a of this._renderableTiles)for(let h in this._coordsAscendingStr){let m=this._coordsAscendingStr[h][a.tileID.key];m&&m!==a.rttCoords[h]&&(a.rtt=[])}}renderLayer(t,i){if(t.isHidden(this.painter.transform.zoom))return!1;let a=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),h=t.type,m=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(jt[h]&&(this._prevType&&jt[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(t.id),!v))return!0;if(jt[this._prevType]||jt[h]&&v){this._prevType=h;let C=this._stacks.length-1,P=this._stacks[C]||[];for(let I of this._renderableTiles){if(this.pool.isFull()&&(Ni(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(I),I.rtt[C]){let F=this.pool.getObjectForId(I.rtt[C].id);if(F.stamp===I.rtt[C].stamp){this.pool.useObject(F);continue}}let D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),I.rtt[C]={id:D.id,stamp:D.stamp},m.context.bindFramebuffer.set(D.fbo.framebuffer),m.context.clear({color:u.be.transparent,stencil:0}),m.currentStencilSource=void 0;for(let F=0;F<P.length;F++){let O=m.style._layers[P[F]],Z=O.source?this._coordsAscending[O.source][I.tileID.key]:[I.tileID];m.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),m._renderTileClippingMasks(O,Z,!0),m.renderLayer(m,m.style.sourceCaches[O.source],O,Z,a),O.source&&(I.rttCoords[O.source]=this._coordsAscendingStr[O.source][I.tileID.key])}}return Ni(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects(),jt[h]}return!1}}let Fe={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Mi=rt,bt={hash:!1,interactive:!0,bearingSnap:7,attributionControl:R,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},St={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Zt{constructor(t,i,a=!1){this.mousedown=m=>{this.startMove(m,_t.mousePos(this.element,m)),_t.addEventListener(window,"mousemove",this.mousemove),_t.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.move(m,_t.mousePos(this.element,m))},this.mouseup=m=>{this._rotatePitchHanlder.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=_t.touchPos(this.element,m.targetTouches)[0],this.startMove(m,this._startPos),_t.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),_t.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=_t.touchPos(this.element,m.targetTouches)[0],this.move(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;let h=new Lu;this._rotatePitchHanlder=new So({clickTolerance:3,move:(m,v)=>{let C=i.getBoundingClientRect(),P=new u.P((C.bottom-C.top)/2,(C.right-C.left)/2);return{bearingDelta:u.cm(new u.P(m.x,v.y),v,P),pitchDelta:a?-.5*(v.y-m.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=t,_t.addEventListener(i,"mousedown",this.mousedown),_t.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),_t.addEventListener(i,"touchcancel",this.reset)}startMove(t,i){this._rotatePitchHanlder.dragStart(t,i),_t.disableDrag()}move(t,i){let a=this.map,{bearingDelta:h,pitchDelta:m}=this._rotatePitchHanlder.dragMove(t,i)||{};h&&a.setBearing(a.getBearing()+h),m&&a.setPitch(a.getPitch()+m)}off(){let t=this.element;_t.removeEventListener(t,"mousedown",this.mousedown),_t.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),_t.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_t.removeEventListener(window,"touchend",this.touchend),_t.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){_t.enableDrag(),_t.removeEventListener(window,"mousemove",this.mousemove),_t.removeEventListener(window,"mouseup",this.mouseup),_t.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_t.removeEventListener(window,"touchend",this.touchend)}}let Jt;function Ht(d,t,i,a=!1){if(a||!i.getCoveringTilesDetailsProvider().allowWorldCopies())return d?.wrap();let h=new u.S(d.lng,d.lat);if(d=new u.S(d.lng,d.lat),t){let m=new u.S(d.lng-360,d.lat),v=new u.S(d.lng+360,d.lat),C=i.locationToScreenPoint(d).distSqr(t);i.locationToScreenPoint(m).distSqr(t)<C?d=m:i.locationToScreenPoint(v).distSqr(t)<C&&(d=v)}for(;Math.abs(d.lng-i.center.lng)>180;){let m=i.locationToScreenPoint(d);if(m.x>=0&&m.y>=0&&m.x<=i.width&&m.y<=i.height)break;d.lng>i.center.lng?d.lng-=360:d.lng+=360}return d.lng!==h.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(d))?d:h}let oe={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function q(d,t,i){let a=d.classList;for(let h in oe)a.remove(`maplibregl-${i}-anchor-${h}`);a.add(`maplibregl-${i}-anchor-${t}`)}class Q extends u.E{constructor(t){if(super(),this._onKeyPress=i=>{let a=i.code,h=i.charCode||i.keyCode;a!=="Space"&&a!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=i=>{let a=i.originalEvent.target,h=this._element;this._popup&&(a===h||h.contains(a))&&this.togglePopup()},this._update=i=>{if(!this._map)return;let a=this._map.loaded()&&!this._map.isMoving();(i?.type==="terrain"||i?.type==="render"&&!a)&&this._map.once("render",this._update),this._lngLat=Ht(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),_t.setTransform(this._element,`${oe[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${h}`),re.frameAsync(new AbortController).then(()=>{this._updateOpacity(i&&i.type==="moveend")}).catch(()=>{})},this._onMove=i=>{if(!this._isDragging){let a=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.l("dragstart"))),this.fire(new u.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.l("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=u.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=_t.create("div");let i=_t.createNS("http://www.w3.org/2000/svg","svg"),a=41,h=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${a}px`),i.setAttributeNS(null,"width",`${h}px`),i.setAttributeNS(null,"viewBox",`0 0 ${h} ${a}`);let m=_t.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");let v=_t.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");let C=_t.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");let P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let dt of P){let mt=_t.createNS("http://www.w3.org/2000/svg","ellipse");mt.setAttributeNS(null,"opacity","0.04"),mt.setAttributeNS(null,"cx","10.5"),mt.setAttributeNS(null,"cy","5.80029008"),mt.setAttributeNS(null,"rx",dt.rx),mt.setAttributeNS(null,"ry",dt.ry),C.appendChild(mt)}let I=_t.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);let D=_t.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(D);let F=_t.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");let O=_t.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild(O);let Z=_t.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");let X=_t.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");let nt=_t.createNS("http://www.w3.org/2000/svg","circle");nt.setAttributeNS(null,"fill","#000000"),nt.setAttributeNS(null,"opacity","0.25"),nt.setAttributeNS(null,"cx","5.5"),nt.setAttributeNS(null,"cy","5.5"),nt.setAttributeNS(null,"r","5.4999962");let ct=_t.createNS("http://www.w3.org/2000/svg","circle");ct.setAttributeNS(null,"fill","#FFFFFF"),ct.setAttributeNS(null,"cx","5.5"),ct.setAttributeNS(null,"cy","5.5"),ct.setAttributeNS(null,"r","5.4999962"),X.appendChild(nt),X.appendChild(ct),v.appendChild(C),v.appendChild(I),v.appendChild(F),v.appendChild(Z),v.appendChild(X),i.appendChild(v),i.setAttributeNS(null,"height",a*this._scale+"px"),i.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(i),this._offset=u.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",i=>{i.preventDefault()}),this._element.addEventListener("mousedown",i=>{i.preventDefault()}),q(this._element,this._anchor,"marker"),t&&t.className)for(let i of t.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),_t.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=u.S.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){let h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){let t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var i,a;let h=(i=this._map)===null||i===void 0?void 0:i.terrain,m=this._map.transform.isLocationOccluded(this._lngLat);if(!h||m){let Z=m?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Z&&(this._element.style.opacity=Z))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let v=this._map,C=v.terrain.depthAtPoint(this._pos),P=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,P)-C<.006)return void(this._element.style.opacity=this._opacity);let I=-this._offset.y/v.transform.pixelsPerMeter,D=Math.sin(v.getPitch()*Math.PI/180)*I,F=v.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),O=v.transform.lngLatToCameraDepth(this._lngLat,P+D)-F>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&O&&this._popup.remove(),this._element.style.opacity=O?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=u.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,i){return(this._opacity===void 0||t===void 0&&i===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}let ut={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ot=0,ht=!1,pt={maxWidth:100,unit:"metric"};function Dt(d,t,i){let a=i&&i.maxWidth||100,h=d._container.clientHeight/2,m=d._container.clientWidth/2,v=d.unproject([m-a/2,h]),C=d.unproject([m+a/2,h]),P=Math.round(d.project(C).x-d.project(v).x),I=Math.min(a,P,d._container.clientWidth),D=v.distanceTo(C);if(i&&i.unit==="imperial"){let F=3.2808*D;F>5280?Bt(t,I,F/5280,d._getUIString("ScaleControl.Miles")):Bt(t,I,F,d._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?Bt(t,I,D/1852,d._getUIString("ScaleControl.NauticalMiles")):D>=1e3?Bt(t,I,D/1e3,d._getUIString("ScaleControl.Kilometers")):Bt(t,I,D,d._getUIString("ScaleControl.Meters"))}function Bt(d,t,i,a){let h=function(m){let v=Math.pow(10,`${Math.floor(m)}`.length-1),C=m/v;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(P){let I=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*I)/I}(C),v*C}(i);d.style.width=t*(h/i)+"px",d.innerHTML=`${h}&nbsp;${a}`}let Ft={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Yt=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wt(d){if(d){if(typeof d=="number"){let t=Math.round(Math.abs(d)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,d),"top-left":new u.P(t,t),"top-right":new u.P(-t,t),bottom:new u.P(0,-d),"bottom-left":new u.P(t,-t),"bottom-right":new u.P(-t,-t),left:new u.P(d,0),right:new u.P(-d,0)}}if(d instanceof u.P||Array.isArray(d)){let t=u.P.convert(d);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:u.P.convert(d.center||[0,0]),top:u.P.convert(d.top||[0,0]),"top-left":u.P.convert(d["top-left"]||[0,0]),"top-right":u.P.convert(d["top-right"]||[0,0]),bottom:u.P.convert(d.bottom||[0,0]),"bottom-left":u.P.convert(d["bottom-left"]||[0,0]),"bottom-right":u.P.convert(d["bottom-right"]||[0,0]),left:u.P.convert(d.left||[0,0]),right:u.P.convert(d.right||[0,0])}}return Wt(new u.P(0,0))}let we=rt;S.AJAXError=u.cy,S.Event=u.l,S.Evented=u.E,S.LngLat=u.S,S.MercatorCoordinate=u.a0,S.Point=u.P,S.addProtocol=u.cz,S.config=u.a,S.removeProtocol=u.cA,S.AttributionControl=j,S.BoxZoomHandler=za,S.CanvasSource=Gn,S.CooperativeGesturesHandler=l,S.DoubleClickZoomHandler=Cl,S.DragPanHandler=Zl,S.DragRotateHandler=Ml,S.EdgeInsets=Yr,S.FullscreenControl=class extends u.E{constructor(d={}){super(),this._onFullscreenChange=()=>{var t;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=i?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=_t.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){_t.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let d=this._fullscreenButton=_t.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);_t.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=Er,S.GeolocateControl=class extends u.E{constructor(d){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new u.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{let i=new u.S(t.coords.longitude,t.coords.latitude),a=t.coords.accuracy,h=this._map.getBearing(),m=u.e({bearing:h},this.options.fitBoundsOptions),v=ji.fromLngLat(i,a);this._map.fitBounds(v,m,{geolocateSource:!0})},this._updateMarker=t=>{if(t){let i=new u.S(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ht)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=_t.create("button","maplibregl-ctrl-geolocate",this._container),_t.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");let i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{let i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=_t.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Q({element:this._dotElement}),this._circleElement=_t.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Q({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.l("trackuserlocationend")),this.fire(new u.l("userlocationlostfocus")))})}},this.options=u.e({},ut,d)}onAdd(d){return this._map=d,this._container=_t.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return u._(this,arguments,void 0,function*(t=!1){if(Jt!==void 0&&!t)return Jt;if(window.navigator.permissions===void 0)return Jt=!!window.navigator.geolocation,Jt;try{Jt=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Jt=!!window.navigator.geolocation}return Jt})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),_t.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ot=0,ht=!1}_isOutOfMapMaxBounds(d){let t=this._map.getMaxBounds(),i=d.coords;return t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let d=this._map.getBounds(),t=d.getSouthEast(),i=d.getNorthEast(),a=t.distanceTo(i),h=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ot--,ht=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.l("trackuserlocationstart")),this.fire(new u.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ot++,ot>1?(d={maximumAge:6e5,timeout:0},ht=!0):(d=this.options.positionOptions,ht=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.GlobeControl=class{constructor(){this._toggleProjection=()=>{var d;let t=(d=this._map.getProjection())===null||d===void 0?void 0:d.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var d;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((d=this._map.getProjection())===null||d===void 0?void 0:d.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(d){return this._map=d,this._container=_t.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=_t.create("button","maplibregl-ctrl-globe",this._container),_t.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){_t.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},S.Hash=fa,S.ImageSource=Rr,S.KeyboardHandler=Fa,S.LngLatBounds=ji,S.LogoControl=W,S.Map=class extends A{constructor(d){var t,i;u.cv.mark(u.cw.create);let a=Object.assign(Object.assign(Object.assign({},bt),d),{canvasContextAttributes:Object.assign(Object.assign({},bt.canvasContextAttributes),d.canvasContextAttributes)});if(a.minZoom!=null&&a.maxZoom!=null&&a.minZoom>a.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(a.minPitch!=null&&a.maxPitch!=null&&a.minPitch>a.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(a.minPitch!=null&&a.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(a.maxPitch!=null&&a.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let h=new ii,m=new jo;if(a.minZoom!==void 0&&h.setMinZoom(a.minZoom),a.maxZoom!==void 0&&h.setMaxZoom(a.maxZoom),a.minPitch!==void 0&&h.setMinPitch(a.minPitch),a.maxPitch!==void 0&&h.setMaxPitch(a.maxPitch),a.renderWorldCopies!==void 0&&h.setRenderWorldCopies(a.renderWorldCopies),super(h,m,{bearingSnap:a.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new et,this._controls=[],this._mapId=u.a6(),this._contextLost=C=>{C.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.l("webglcontextlost",{originalEvent:C}))},this._contextRestored=C=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.l("webglcontextrestored",{originalEvent:C}))},this._onMapScroll=C=>{if(C.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=a.interactive,this._maxTileCacheSize=a.maxTileCacheSize,this._maxTileCacheZoomLevels=a.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},a.canvasContextAttributes),this._trackResize=a.trackResize===!0,this._bearingSnap=a.bearingSnap,this._centerClampedToGround=a.centerClampedToGround,this._refreshExpiredTiles=a.refreshExpiredTiles===!0,this._fadeDuration=a.fadeDuration,this._crossSourceCollisions=a.crossSourceCollisions===!0,this._collectResourceTiming=a.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Fe),a.locale),this._clickTolerance=a.clickTolerance,this._overridePixelRatio=a.pixelRatio,this._maxCanvasSize=a.maxCanvasSize,this.transformCameraUpdate=a.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=a.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Wi.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ei(a.transformRequest),typeof a.container=="string"){if(this._container=document.getElementById(a.container),!this._container)throw new Error(`Container '${a.container}' not found.`)}else{if(!(a.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=a.container}if(a.maxBounds&&this.setMaxBounds(a.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let C=!1,P=Lo(I=>{this._trackResize&&!this._removed&&(this.resize(I),this.redraw())},50);this._resizeObserver=new ResizeObserver(I=>{C?P(I):C=!0}),this._resizeObserver.observe(this._container)}this.handlers=new M(this,a),this._hash=a.hash&&new fa(typeof a.hash=="string"&&a.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:a.center,elevation:a.elevation,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch,roll:a.roll}),a.bounds&&(this.resize(),this.fitBounds(a.bounds,u.e({},a.fitBoundsOptions,{duration:0}))));let v=typeof a.style=="string"||((i=(t=a.style)===null||t===void 0?void 0:t.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=a.localIdeographFontFamily,this._validateStyle=a.validateStyle,a.style&&this.setStyle(a.style,{localIdeographFontFamily:a.localIdeographFontFamily}),a.attributionControl&&this.addControl(new j(typeof a.attributionControl=="boolean"?void 0:a.attributionControl)),a.maplibreLogo&&this.addControl(new W,a.logoPosition),this.on("style.load",()=>{if(v||this._resizeTransform(),this.transform.unmodified){let C=u.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(C)}}),this.on("data",C=>{this._update(C.dataType==="style"),this.fire(new u.l(`${C.dataType}data`,C))}),this.on("dataloading",C=>{this.fire(new u.l(`${C.dataType}dataloading`,C))}),this.on("dataabort",C=>{this.fire(new u.l("sourcedataabort",C))})}_getMapId(){return this._mapId}setGlobalStateProperty(d,t){return this.style.setGlobalStateProperty(d,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new u.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let i=d.onAdd(this);this._controls.push(d);let a=this._controlPositions[t];return t.indexOf("bottom")!==-1?a.insertBefore(i,a.firstChild):a.appendChild(i),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new u.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,t,i,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,t,i,a)}resize(d,t=!0){let[i,a]=this._containerDimensions(),h=this._getClampedPixelRatio(i,a);if(this._resizeCanvas(i,a,h),this.painter.resize(i,a,h),this.painter.overLimit()){let v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];let C=this._getClampedPixelRatio(i,a);this._resizeCanvas(i,a,C),this.painter.resize(i,a,C)}this._resizeTransform(t);let m=!this._moving;return m&&(this.stop(),this.fire(new u.l("movestart",d)).fire(new u.l("move",d))),this.fire(new u.l("resize",d)),m&&this.fire(new u.l("moveend",d)),this}_resizeTransform(d=!0){var t;let[i,a]=this._containerDimensions();this.transform.resize(i,a,d),(t=this._requestedCameraState)===null||t===void 0||t.resize(i,a,d)}_getClampedPixelRatio(d,t){let{0:i,1:a}=this._maxCanvasSize,h=this.getPixelRatio(),m=d*h,v=t*h;return Math.min(m>i?i/m:1,v>a?a/v:1)*h}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(ji.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.setMinZoom(d),this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.setMaxZoom(d),this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.setMinPitch(d),this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(d>=this.transform.minPitch)return this.transform.setMaxPitch(d),this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.setRenderWorldCopies(d),this._update()}project(d){return this.transform.locationToScreenPoint(u.S.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.screenPointToLocation(u.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,t,i){if(d==="mouseenter"||d==="mouseover"){let a=!1;return{layers:t,listener:i,delegates:{mousemove:m=>{let v=t.filter(P=>this.getLayer(P)),C=v.length!==0?this.queryRenderedFeatures(m.point,{layers:v}):[];C.length?a||(a=!0,i.call(this,new zn(d,this,m.originalEvent,{features:C}))):a=!1},mouseout:()=>{a=!1}}}}if(d==="mouseleave"||d==="mouseout"){let a=!1;return{layers:t,listener:i,delegates:{mousemove:v=>{let C=t.filter(P=>this.getLayer(P));(C.length!==0?this.queryRenderedFeatures(v.point,{layers:C}):[]).length?a=!0:a&&(a=!1,i.call(this,new zn(d,this,v.originalEvent)))},mouseout:v=>{a&&(a=!1,i.call(this,new zn(d,this,v.originalEvent)))}}}}{let a=h=>{let m=t.filter(C=>this.getLayer(C)),v=m.length!==0?this.queryRenderedFeatures(h.point,{layers:m}):[];v.length&&(h.features=v,i.call(this,h),delete h.features)};return{layers:t,listener:i,delegates:{[d]:a}}}}_saveDelegatedListener(d,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(t)}_removeDelegatedListener(d,t,i){if(!this._delegatedListeners||!this._delegatedListeners[d])return;let a=this._delegatedListeners[d];for(let h=0;h<a.length;h++){let m=a[h];if(m.listener===i&&m.layers.length===t.length&&m.layers.every(v=>t.includes(v))){for(let v in m.delegates)this.off(v,m.delegates[v]);return void a.splice(h,1)}}}on(d,t,i){if(i===void 0)return super.on(d,t);let a=typeof t=="string"?[t]:t,h=this._createDelegatedListener(d,a,i);this._saveDelegatedListener(d,h);for(let m in h.delegates)this.on(m,h.delegates[m]);return{unsubscribe:()=>{this._removeDelegatedListener(d,a,i)}}}once(d,t,i){if(i===void 0)return super.once(d,t);let a=typeof t=="string"?[t]:t,h=this._createDelegatedListener(d,a,i);for(let m in h.delegates){let v=h.delegates[m];h.delegates[m]=(...C)=>{this._removeDelegatedListener(d,a,i),v(...C)}}this._saveDelegatedListener(d,h);for(let m in h.delegates)this.once(m,h.delegates[m]);return this}off(d,t,i){return i===void 0?super.off(d,t):(this._removeDelegatedListener(d,typeof t=="string"?[t]:t,i),this)}queryRenderedFeatures(d,t){if(!this.style)return[];let i,a=d instanceof u.P||Array.isArray(d),h=a?d:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(a?{}:d)||{},h instanceof u.P||typeof h[0]=="number")i=[u.P.convert(h)];else{let m=u.P.convert(h[0]),v=u.P.convert(h[1]);i=[m,new u.P(v.x,m.y),v,new u.P(m.x,v.y),m]}return this.style.queryRenderedFeatures(i,t,this.transform)}querySourceFeatures(d,t){return this.style.querySourceFeatures(d,t)}setStyle(d,t){return(t=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(d,t))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){let t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){var i,a;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,t));let h=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new sa(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,t,h):this.style.loadJSON(d,t,h),this):((a=(i=this.style)===null||i===void 0?void 0:i.projection)===null||a===void 0||a.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new sa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,t){if(typeof d=="string"){let i=this._requestManager.transformRequest(d,"Style");u.j(i,new AbortController).then(a=>{this._updateDiff(a.data,t)}).catch(a=>{a&&this.fire(new u.k(a))})}else typeof d=="object"&&this._updateDiff(d,t)}_updateDiff(d,t){try{this.style.setState(d,t)&&this._update(!0)}catch(i){u.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(d,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(d,t){return this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)}isSourceLoaded(d){let t=this.style&&this.style.sourceCaches[d];if(t!==void 0)return t.loaded();this.fire(new u.k(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){let t=this.style.sourceCaches[d.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);this.terrain===null&&t.reload();for(let i in this.style._layers){let a=this.style._layers[i];a.type==="hillshade"&&a.source===d.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),a.type==="color-relief"&&a.source===d.source&&u.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ie(this.painter,t,d),this.painter.renderToTexture=new de(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{var a;i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==d.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((a=i.source)===null||a===void 0?void 0:a.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new u.l("terrain",{terrain:d})),this}getTerrain(){var d,t;return(t=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&t!==void 0?t:null}areTilesLoaded(){let d=this.style&&this.style.sourceCaches;for(let t in d){let i=d[t]._tiles;for(let a in i){let h=i[a];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}setSourceTileLodParams(d,t,i){if(i){let a=this.getSource(i);if(!a)throw new Error(`There is no source with ID "${i}", cannot set LOD parameters`);a.calculateTileZoom=ee(Math.max(1,d),Math.max(1,t))}else for(let a in this.style.sourceCaches)this.style.sourceCaches[a].getSource().calculateTileZoom=ee(Math.max(1,d),Math.max(1,t));return this._update(!0),this}refreshTiles(d,t){let i=this.style.sourceCaches[d];if(!i)throw new Error(`There is no source cache with ID "${d}", cannot refresh tile`);t===void 0?i.reload(!0):i.refreshTiles(t.map(a=>new u.a3(a.z,a.x,a.y)))}addImage(d,t,i={}){let{pixelRatio:a=1,sdf:h=!1,stretchX:m,stretchY:v,content:C,textFitWidth:P,textFitHeight:I}=i;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||u.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new u.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:D,height:F,data:O}=t,Z=t;return this.style.addImage(d,{data:new u.R({width:D,height:F},new Uint8Array(O)),pixelRatio:a,stretchX:m,stretchY:v,content:C,textFitWidth:P,textFitHeight:I,sdf:h,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,d),this}}{let{width:D,height:F,data:O}=re.getImageData(t);this.style.addImage(d,{data:new u.R({width:D,height:F},O),pixelRatio:a,stretchX:m,stretchY:v,content:C,textFitWidth:P,textFitHeight:I,sdf:h,version:0})}}updateImage(d,t){let i=this.style.getImage(d);if(!i)return this.fire(new u.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let a=t instanceof HTMLImageElement||u.b(t)?re.getImageData(t):t,{width:h,height:m,data:v}=a;if(h===void 0||m===void 0)return this.fire(new u.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==i.data.width||m!==i.data.height)return this.fire(new u.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let C=!(t instanceof HTMLImageElement||u.b(t));return i.data.replace(v,C),this.style.updateImage(d,i),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new u.k(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d){return Wi.getImage(this._requestManager.transformRequest(d,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(d,t){return this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)}moveLayer(d,t){return this.style.moveLayer(d,t),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,t,i){return this.style.setLayerZoomRange(d,t,i),this._update(!0)}setFilter(d,t,i={}){return this.style.setFilter(d,t,i),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,t,i,a={}){return this.style.setPaintProperty(d,t,i,a),this._update(!0)}getPaintProperty(d,t){return this.style.getPaintProperty(d,t)}setLayoutProperty(d,t,i,a={}){return this.style.setLayoutProperty(d,t,i,a),this._update(!0)}getLayoutProperty(d,t){return this.style.getLayoutProperty(d,t)}setGlyphs(d,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,t,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,t,i,a=>{a||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,t,i=>{i||this._update(!0)}),this}setLight(d,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(d,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(d,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(d,t){return this.style.setFeatureState(d,t),this._update()}removeFeatureState(d,t){return this.style.removeFeatureState(d,t),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,t=0;return this._container&&(d=this._container.clientWidth||400,t=this._container.clientHeight||300),[d,t]}_setupContainer(){let d=this._container;d.classList.add("maplibregl-map");let t=this._canvasContainer=_t.create("div","maplibregl-canvas-container",d);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=_t.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let i=this._containerDimensions(),a=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],a);let h=this._controlContainer=_t.create("div","maplibregl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=_t.create("div",`maplibregl-ctrl-${v} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t,i){this._canvas.width=Math.floor(i*d),this._canvas.height=Math.floor(i*t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_setupPainter(){let d=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),t=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{t={requestedAttributes:d},a&&(t.statusMessage=a.statusMessage,t.type=a.type)},{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,d):this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d),!i){let a="Failed to initialize WebGL";throw t?(t.message=a,new Error(JSON.stringify(t))):new Error(a)}this.painter=new Pi(i,this.transform),ge.testSupport(i)}migrateProjection(d,t){super.migrateProjection(d,t),this.painter.transform=d,this.fire(new u.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){var t,i,a,h,m;let v=this._idleTriggered?this._fadeDuration:0,C=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let P=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let F=this.transform.zoom,O=re.now();this.style.zoomHistory.update(F,O);let Z=new u.F(F,{now:O,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),X=Z.crossFadingFactor();X===1&&X===this._crossFadingFactor||(P=!0,this._crossFadingFactor=X),this.style.update(Z)}let I=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==C;(a=this.style.projection)===null||a===void 0||a.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(m=this.style.projection)===null||m===void 0?void 0:m.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||I)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,I),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new u.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.cv.mark(u.cw.load),this.fire(new u.l("load"))),this.style&&(this.style.hasTransitions()||P)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let D=this._sourcesDirty||this._styleDirty||this._placementDirty;return D||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.l("idle")),!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,u.cv.mark(u.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(let i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Wi.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();let t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),_t.remove(this._canvasContainer),_t.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),u.cv.clearMetrics(),this._removed=!0,this.fire(new u.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,re.frame(this._frameRequest,d=>{u.cv.frame(d),this._frameRequest=null;try{this._render(d)}catch(t){if(!u.cx(t)&&!function(i){return i.message===qo}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return Mi}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(d){return this._lazyInitEmptyStyle(),this.style.setProjection(d),this._update(!0)}},S.MapMouseEvent=zn,S.MapTouchEvent=ds,S.MapWheelEvent=Rl,S.Marker=Q,S.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{let t=this._map.getZoom(),i=t===this._map.getMaxZoom(),a=t===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,i)=>{let a=this._map._getUIString(`NavigationControl.${i}`);t.title=a,t.setAttribute("aria-label",a)},this.options=u.e({},St,d),this._container=_t.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),_t.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),_t.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=_t.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Zt(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){_t.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,t){let i=_t.create("button",d,this._container);return i.type="button",i.addEventListener("click",t),i}},S.Popup=class extends u.E{constructor(d){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&_t.remove(this._content),this._container&&(_t.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=_t.create("div","maplibregl-popup",this._map.getContainer()),this._tip=_t.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ht(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;let i=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let a=this.options.anchor,h=Wt(this.options.offset);if(!a){let v=this._container.offsetWidth,C=this._container.offsetHeight,P;P=i.y+h.bottom.y<C?["top"]:i.y>this._map.transform.height-C?["bottom"]:[],i.x<v/2?P.push("left"):i.x>this._map.transform.width-v/2&&P.push("right"),a=P.length===0?"bottom":P.join("-")}let m=i.add(h[a]);this.options.subpixelPositioning||(m=m.round()),_t.setTransform(this._container,`${oe[a]} translate(${m.x}px,${m.y}px)`),q(this._container,a,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(Ft),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=u.S.convert(d),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){let t=document.createDocumentFragment(),i=document.createElement("body"),a;for(i.innerHTML=d;a=i.firstChild,a;)t.appendChild(a);return this.setDOMContent(t)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=_t.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._container&&this._container.classList.add(d),this}removeClassName(d){return this._container&&this._container.classList.remove(d),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}setSubpixelPositioning(d){this.options.subpixelPositioning=d}_createCloseButton(){this.options.closeButton&&(this._closeButton=_t.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let d=this._container.querySelector(Yt);d&&d.focus()}},S.RasterDEMTileSource=fr,S.RasterTileSource=zs,S.ScaleControl=class{constructor(d){this._onMove=()=>{Dt(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Dt(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},pt),d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=_t.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){_t.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=ko,S.Style=sa,S.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=d}onAdd(d){return this._map=d,this._container=_t.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=_t.create("button","maplibregl-ctrl-terrain",this._container),_t.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){_t.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=Ho,S.TwoFingersTouchRotateHandler=Nl,S.TwoFingersTouchZoomHandler=to,S.TwoFingersTouchZoomRotateHandler=Vl,S.VectorTileSource=cn,S.VideoSource=ns,S.addSourceType=(d,t)=>u._(void 0,void 0,void 0,function*(){if(Rs(d))throw new Error(`A source type called "${d}" already exists.`);((i,a)=>{zo[i]=a})(d,t)}),S.clearPrewarmedResources=function(){let d=$i;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Ye),$i=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.createTileMesh=Wa,S.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return Kr().getRTLTextPluginStatus()},S.getVersion=function(){return we},S.getWorkerCount=function(){return bi.workerCount},S.getWorkerUrl=function(){return u.a.WORKER_URL},S.importScriptInWorkers=function(d){return Wr().broadcast("IS",d)},S.prewarm=function(){wi().acquire(Ye)},S.setMaxParallelImageRequests=function(d){u.a.MAX_PARALLEL_IMAGE_REQUESTS=d},S.setRTLTextPlugin=function(d,t){return Kr().setRTLTextPlugin(d,t)},S.setWorkerCount=function(d){bi.workerCount=d},S.setWorkerUrl=function(d){u.a.WORKER_URL=d}});var G=$t;return G})});var mf=mh((wh,ff)=>{eo();(function($t,gt){typeof wh=="object"&&typeof ff<"u"?gt(wh):typeof define=="function"&&define.amd?define(["exports"],gt):($t=$t||self,gt(($t.Leaflet=$t.Leaflet||{},$t.Leaflet.markercluster={})))})(wh,function($t){"use strict";var gt=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(G){L.Util.setOptions(this,G),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var S=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,S?this._withAnimation:this._noAnimation),this._markerCluster=S?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(G){if(G instanceof L.LayerGroup)return this.addLayers([G]);if(!G.getLatLng)return this._nonPointGroup.addLayer(G),this.fire("layeradd",{layer:G}),this;if(!this._map)return this._needsClustering.push(G),this.fire("layeradd",{layer:G}),this;if(this.hasLayer(G))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(G,this._maxZoom),this.fire("layeradd",{layer:G}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var S=G,u=this._zoom;if(G.__parent)for(;S.__parent._zoom>=u;)S=S.__parent;return this._currentShownBounds.contains(S.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(G,S):this._animationAddLayerNonAnimated(G,S)),this},removeLayer:function(G){return G instanceof L.LayerGroup?this.removeLayers([G]):G.getLatLng?this._map?G.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(G)),this._removeLayer(G,!0),this.fire("layerremove",{layer:G}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),G.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(G)&&(this._featureGroup.removeLayer(G),G.clusterShow&&G.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,G)&&this.hasLayer(G)&&this._needsRemoving.push({layer:G,latlng:G._latlng}),this.fire("layerremove",{layer:G}),this):(this._nonPointGroup.removeLayer(G),this.fire("layerremove",{layer:G}),this)},addLayers:function(G,S){if(!L.Util.isArray(G))return this.addLayer(G);var u=this._featureGroup,rt=this._nonPointGroup,Qt=this.options.chunkedLoading,se=this.options.chunkInterval,Kt=this.options.chunkProgress,re=G.length,_t=0,ge=!0,Ae;if(this._map){var pi=new Date().getTime(),Ze=L.bind(function(){var Bi=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();_t<re;_t++){if(Qt&&_t%200===0){var Wi=new Date().getTime()-Bi;if(Wi>se)break}if(Ae=G[_t],Ae instanceof L.LayerGroup){ge&&(G=G.slice(),ge=!1),this._extractNonGroupLayers(Ae,G),re=G.length;continue}if(!Ae.getLatLng){rt.addLayer(Ae),S||this.fire("layeradd",{layer:Ae});continue}if(!this.hasLayer(Ae)&&(this._addLayer(Ae,this._maxZoom),S||this.fire("layeradd",{layer:Ae}),Ae.__parent&&Ae.__parent.getChildCount()===2)){var Ei=Ae.__parent.getAllChildMarkers(),Ri=Ei[0]===Ae?Ei[1]:Ei[0];u.removeLayer(Ri)}}Kt&&Kt(_t,re,new Date().getTime()-pi),_t===re?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(Ze,this.options.chunkDelay)},this);Ze()}else for(var gi=this._needsClustering;_t<re;_t++){if(Ae=G[_t],Ae instanceof L.LayerGroup){ge&&(G=G.slice(),ge=!1),this._extractNonGroupLayers(Ae,G),re=G.length;continue}if(!Ae.getLatLng){rt.addLayer(Ae);continue}this.hasLayer(Ae)||gi.push(Ae)}return this},removeLayers:function(G){var S,u,rt=G.length,Qt=this._featureGroup,se=this._nonPointGroup,Kt=!0;if(!this._map){for(S=0;S<rt;S++){if(u=G[S],u instanceof L.LayerGroup){Kt&&(G=G.slice(),Kt=!1),this._extractNonGroupLayers(u,G),rt=G.length;continue}this._arraySplice(this._needsClustering,u),se.removeLayer(u),this.hasLayer(u)&&this._needsRemoving.push({layer:u,latlng:u._latlng}),this.fire("layerremove",{layer:u})}return this}if(this._unspiderfy){this._unspiderfy();var re=G.slice(),_t=rt;for(S=0;S<_t;S++){if(u=re[S],u instanceof L.LayerGroup){this._extractNonGroupLayers(u,re),_t=re.length;continue}this._unspiderfyLayer(u)}}for(S=0;S<rt;S++){if(u=G[S],u instanceof L.LayerGroup){Kt&&(G=G.slice(),Kt=!1),this._extractNonGroupLayers(u,G),rt=G.length;continue}if(!u.__parent){se.removeLayer(u),this.fire("layerremove",{layer:u});continue}this._removeLayer(u,!0,!0),this.fire("layerremove",{layer:u}),Qt.hasLayer(u)&&(Qt.removeLayer(u),u.clusterShow&&u.clusterShow())}return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(G){G.off(this._childMarkerEventHandlers,this),delete G.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var G=new L.LatLngBounds;this._topClusterLevel&&G.extend(this._topClusterLevel._bounds);for(var S=this._needsClustering.length-1;S>=0;S--)G.extend(this._needsClustering[S].getLatLng());return G.extend(this._nonPointGroup.getBounds()),G},eachLayer:function(G,S){var u=this._needsClustering.slice(),rt=this._needsRemoving,Qt,se,Kt;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(u),se=u.length-1;se>=0;se--){for(Qt=!0,Kt=rt.length-1;Kt>=0;Kt--)if(rt[Kt].layer===u[se]){Qt=!1;break}Qt&&G.call(S,u[se])}this._nonPointGroup.eachLayer(G,S)},getLayers:function(){var G=[];return this.eachLayer(function(S){G.push(S)}),G},getLayer:function(G){var S=null;return G=parseInt(G,10),this.eachLayer(function(u){L.stamp(u)===G&&(S=u)}),S},hasLayer:function(G){if(!G)return!1;var S,u=this._needsClustering;for(S=u.length-1;S>=0;S--)if(u[S]===G)return!0;for(u=this._needsRemoving,S=u.length-1;S>=0;S--)if(u[S].layer===G)return!1;return!!(G.__parent&&G.__parent._group===this)||this._nonPointGroup.hasLayer(G)},zoomToShowLayer:function(G,S){var u=this._map;typeof S!="function"&&(S=function(){});var rt=function(){(u.hasLayer(G)||u.hasLayer(G.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",rt,this),this.off("animationend",rt,this),u.hasLayer(G)?S():G.__parent._icon&&(this.once("spiderfied",S,this),G.__parent.spiderfy()))};G._icon&&this._map.getBounds().contains(G.getLatLng())?S():G.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",rt,this),this._map.panTo(G.getLatLng())):(this._map.on("moveend",rt,this),this.on("animationend",rt,this),G.__parent.zoomToBounds())},onAdd:function(G){this._map=G;var S,u,rt;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(G),this._nonPointGroup.addTo(G),this._gridClusters||this._generateInitialClusters(),this._maxLat=G.options.crs.projection.MAX_LATITUDE,S=0,u=this._needsRemoving.length;S<u;S++)rt=this._needsRemoving[S],rt.newlatlng=rt.layer._latlng,rt.layer._latlng=rt.latlng;for(S=0,u=this._needsRemoving.length;S<u;S++)rt=this._needsRemoving[S],this._removeLayer(rt.layer,!0),rt.layer._latlng=rt.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),u=this._needsClustering,this._needsClustering=[],this.addLayers(u,!0)},onRemove:function(G){G.off("zoomend",this._zoomEnd,this),G.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(G){for(var S=G;S&&!S._icon;)S=S.__parent;return S||null},_arraySplice:function(G,S){for(var u=G.length-1;u>=0;u--)if(G[u]===S)return G.splice(u,1),!0},_removeFromGridUnclustered:function(G,S){for(var u=this._map,rt=this._gridUnclustered,Qt=Math.floor(this._map.getMinZoom());S>=Qt&&rt[S].removeObject(G,u.project(G.getLatLng(),S));S--);},_childMarkerDragStart:function(G){G.target.__dragStart=G.target._latlng},_childMarkerMoved:function(G){if(!this._ignoreMove&&!G.target.__dragStart){var S=G.target._popup&&G.target._popup.isOpen();this._moveChild(G.target,G.oldLatLng,G.latlng),S&&G.target.openPopup()}},_moveChild:function(G,S,u){G._latlng=S,this.removeLayer(G),G._latlng=u,this.addLayer(G)},_childMarkerDragEnd:function(G){var S=G.target.__dragStart;delete G.target.__dragStart,S&&this._moveChild(G.target,S,G.target._latlng)},_removeLayer:function(G,S,u){var rt=this._gridClusters,Qt=this._gridUnclustered,se=this._featureGroup,Kt=this._map,re=Math.floor(this._map.getMinZoom());S&&this._removeFromGridUnclustered(G,this._maxZoom);var _t=G.__parent,ge=_t._markers,Ae;for(this._arraySplice(ge,G);_t&&(_t._childCount--,_t._boundsNeedUpdate=!0,!(_t._zoom<re));)S&&_t._childCount<=1?(Ae=_t._markers[0]===G?_t._markers[1]:_t._markers[0],rt[_t._zoom].removeObject(_t,Kt.project(_t._cLatLng,_t._zoom)),Qt[_t._zoom].addObject(Ae,Kt.project(Ae.getLatLng(),_t._zoom)),this._arraySplice(_t.__parent._childClusters,_t),_t.__parent._markers.push(Ae),Ae.__parent=_t.__parent,_t._icon&&(se.removeLayer(_t),u||se.addLayer(Ae))):_t._iconNeedsUpdate=!0,_t=_t.__parent;delete G.__parent},_isOrIsParent:function(G,S){for(;S;){if(G===S)return!0;S=S.parentNode}return!1},fire:function(G,S,u){if(S&&S.layer instanceof L.MarkerCluster){if(S.originalEvent&&this._isOrIsParent(S.layer._icon,S.originalEvent.relatedTarget))return;G="cluster"+G}L.FeatureGroup.prototype.fire.call(this,G,S,u)},listens:function(G,S){return L.FeatureGroup.prototype.listens.call(this,G,S)||L.FeatureGroup.prototype.listens.call(this,"cluster"+G,S)},_defaultIconCreateFunction:function(G){var S=G.getChildCount(),u=" marker-cluster-";return S<10?u+="small":S<100?u+="medium":u+="large",new L.DivIcon({html:"<div><span>"+S+"</span></div>",className:"marker-cluster"+u,iconSize:new L.Point(40,40)})},_bindEvents:function(){var G=this._map,S=this.options.spiderfyOnMaxZoom,u=this.options.showCoverageOnHover,rt=this.options.zoomToBoundsOnClick,Qt=this.options.spiderfyOnEveryZoom;(S||rt||Qt)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),u&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),G.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(G){var S=G.layer,u=S;if(!(G.type==="clusterkeypress"&&G.originalEvent&&G.originalEvent.keyCode!==13)){for(;u._childClusters.length===1;)u=u._childClusters[0];u._zoom===this._maxZoom&&u._childCount===S._childCount&&this.options.spiderfyOnMaxZoom?S.spiderfy():this.options.zoomToBoundsOnClick&&S.zoomToBounds(),this.options.spiderfyOnEveryZoom&&S.spiderfy(),G.originalEvent&&G.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(G){var S=this._map;this._inZoomAnimation||(this._shownPolygon&&S.removeLayer(this._shownPolygon),G.layer.getChildCount()>2&&G.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(G.layer.getConvexHull(),this.options.polygonOptions),S.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var G=this.options.spiderfyOnMaxZoom,S=this.options.showCoverageOnHover,u=this.options.zoomToBoundsOnClick,rt=this.options.spiderfyOnEveryZoom,Qt=this._map;(G||u||rt)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),S&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),Qt.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var G=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,G),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),G),this._currentShownBounds=G}},_generateInitialClusters:function(){var G=Math.ceil(this._map.getMaxZoom()),S=Math.floor(this._map.getMinZoom()),u=this.options.maxClusterRadius,rt=u;typeof u!="function"&&(rt=function(){return u}),this.options.disableClusteringAtZoom!==null&&(G=this.options.disableClusteringAtZoom-1),this._maxZoom=G,this._gridClusters={},this._gridUnclustered={};for(var Qt=G;Qt>=S;Qt--)this._gridClusters[Qt]=new L.DistanceGrid(rt(Qt)),this._gridUnclustered[Qt]=new L.DistanceGrid(rt(Qt));this._topClusterLevel=new this._markerCluster(this,S-1)},_addLayer:function(G,S){var u=this._gridClusters,rt=this._gridUnclustered,Qt=Math.floor(this._map.getMinZoom()),se,Kt;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(G),G.on(this._childMarkerEventHandlers,this);S>=Qt;S--){se=this._map.project(G.getLatLng(),S);var re=u[S].getNearObject(se);if(re){re._addChild(G),G.__parent=re;return}if(re=rt[S].getNearObject(se),re){var _t=re.__parent;_t&&this._removeLayer(re,!1);var ge=new this._markerCluster(this,S,re,G);u[S].addObject(ge,this._map.project(ge._cLatLng,S)),re.__parent=ge,G.__parent=ge;var Ae=ge;for(Kt=S-1;Kt>_t._zoom;Kt--)Ae=new this._markerCluster(this,Kt,Ae),u[Kt].addObject(Ae,this._map.project(re.getLatLng(),Kt));_t._addChild(Ae),this._removeFromGridUnclustered(re,S);return}rt[S].addObject(G,se)}this._topClusterLevel._addChild(G),G.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(G){G instanceof L.MarkerCluster&&G._iconNeedsUpdate&&G._updateIcon()})},_enqueue:function(G){this._queue.push(G),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var G=0;G<this._queue.length;G++)this._queue[G].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var G=Math.round(this._map._zoom);this._processQueue(),this._zoom<G&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,G)):this._zoom>G?(this._animationStart(),this._animationZoomOut(this._zoom,G)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(this.options.removeOutsideVisibleBounds){if(L.Browser.mobile)return this._checkBoundsMaxLat(this._map.getBounds())}else return this._mapBoundsInfinite;return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(G){var S=this._maxLat;return S!==void 0&&(G.getNorth()>=S&&(G._northEast.lat=1/0),G.getSouth()<=-S&&(G._southWest.lat=-1/0)),G},_animationAddLayerNonAnimated:function(G,S){if(S===G)this._featureGroup.addLayer(G);else if(S._childCount===2){S._addToMap();var u=S.getAllChildMarkers();this._featureGroup.removeLayer(u[0]),this._featureGroup.removeLayer(u[1])}else S._updateIcon()},_extractNonGroupLayers:function(G,S){var u=G.getLayers(),rt=0,Qt;for(S=S||[];rt<u.length;rt++){if(Qt=u[rt],Qt instanceof L.LayerGroup){this._extractNonGroupLayers(Qt,S);continue}S.push(Qt)}return S},_overrideMarkerIcon:function(G){var S=G.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[G]}});return S}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(G,S){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),G),this._topClusterLevel._recursivelyAddChildrenToMap(null,S,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(G,S){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),G),this._topClusterLevel._recursivelyAddChildrenToMap(null,S,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(G,S){this._animationAddLayerNonAnimated(G,S)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(G,S){var u=this._getExpandedVisibleBounds(),rt=this._featureGroup,Qt=Math.floor(this._map.getMinZoom()),se;this._ignoreMove=!0,this._topClusterLevel._recursively(u,G,Qt,function(Kt){var re=Kt._latlng,_t=Kt._markers,ge;for(u.contains(re)||(re=null),Kt._isSingleParent()&&G+1===S?(rt.removeLayer(Kt),Kt._recursivelyAddChildrenToMap(null,S,u)):(Kt.clusterHide(),Kt._recursivelyAddChildrenToMap(re,S,u)),se=_t.length-1;se>=0;se--)ge=_t[se],u.contains(ge._latlng)||rt.removeLayer(ge)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(u,S),rt.eachLayer(function(Kt){!(Kt instanceof L.MarkerCluster)&&Kt._icon&&Kt.clusterShow()}),this._topClusterLevel._recursively(u,G,S,function(Kt){Kt._recursivelyRestoreChildPositions(S)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(u,G,Qt,function(Kt){rt.removeLayer(Kt),Kt.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(G,S){this._animationZoomOutSingle(this._topClusterLevel,G-1,S),this._topClusterLevel._recursivelyAddChildrenToMap(null,S,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),G,this._getExpandedVisibleBounds())},_animationAddLayer:function(G,S){var u=this,rt=this._featureGroup;rt.addLayer(G),S!==G&&(S._childCount>2?(S._updateIcon(),this._forceLayout(),this._animationStart(),G._setPos(this._map.latLngToLayerPoint(S.getLatLng())),G.clusterHide(),this._enqueue(function(){rt.removeLayer(G),G.clusterShow(),u._animationEnd()})):(this._forceLayout(),u._animationStart(),u._animationZoomOutSingle(S,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(G,S,u){var rt=this._getExpandedVisibleBounds(),Qt=Math.floor(this._map.getMinZoom());G._recursivelyAnimateChildrenInAndAddSelfToMap(rt,Qt,S+1,u);var se=this;this._forceLayout(),G._recursivelyBecomeVisible(rt,u),this._enqueue(function(){if(G._childCount===1){var Kt=G._markers[0];this._ignoreMove=!0,Kt.setLatLng(Kt.getLatLng()),this._ignoreMove=!1,Kt.clusterShow&&Kt.clusterShow()}else G._recursively(rt,u,Qt,function(re){re._recursivelyRemoveChildrenFromMap(rt,Qt,S+1)});se._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(G){return new L.MarkerClusterGroup(G)};var Vt=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(G,S,u,rt){L.Marker.prototype.initialize.call(this,u?u._cLatLng||u.getLatLng():new L.LatLng(0,0),{icon:this,pane:G.options.clusterPane}),this._group=G,this._zoom=S,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,u&&this._addChild(u),rt&&this._addChild(rt)},getAllChildMarkers:function(G,S){G=G||[];for(var u=this._childClusters.length-1;u>=0;u--)this._childClusters[u].getAllChildMarkers(G,S);for(var rt=this._markers.length-1;rt>=0;rt--)S&&this._markers[rt].__dragStart||G.push(this._markers[rt]);return G},getChildCount:function(){return this._childCount},zoomToBounds:function(G){for(var S=this._childClusters.slice(),u=this._group._map,rt=u.getBoundsZoom(this._bounds),Qt=this._zoom+1,se=u.getZoom(),Kt;S.length>0&&rt>Qt;){Qt++;var re=[];for(Kt=0;Kt<S.length;Kt++)re=re.concat(S[Kt]._childClusters);S=re}rt>Qt?this._group._map.setView(this._latlng,Qt):rt<=se?this._group._map.setView(this._latlng,se+1):this._group._map.fitBounds(this._bounds,G)},getBounds:function(){var G=new L.LatLngBounds;return G.extend(this._bounds),G},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(G,S){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(G),G instanceof L.MarkerCluster?(S||(this._childClusters.push(G),G.__parent=this),this._childCount+=G._childCount):(S||this._markers.push(G),this._childCount++),this.__parent&&this.__parent._addChild(G,!0)},_setClusterCenter:function(G){this._cLatLng||(this._cLatLng=G._cLatLng||G._latlng)},_resetBounds:function(){var G=this._bounds;G._southWest&&(G._southWest.lat=1/0,G._southWest.lng=1/0),G._northEast&&(G._northEast.lat=-1/0,G._northEast.lng=-1/0)},_recalculateBounds:function(){var G=this._markers,S=this._childClusters,u=0,rt=0,Qt=this._childCount,se,Kt,re,_t;if(Qt!==0){for(this._resetBounds(),se=0;se<G.length;se++)re=G[se]._latlng,this._bounds.extend(re),u+=re.lat,rt+=re.lng;for(se=0;se<S.length;se++)Kt=S[se],Kt._boundsNeedUpdate&&Kt._recalculateBounds(),this._bounds.extend(Kt._bounds),re=Kt._wLatLng,_t=Kt._childCount,u+=re.lat*_t,rt+=re.lng*_t;this._latlng=this._wLatLng=new L.LatLng(u/Qt,rt/Qt),this._boundsNeedUpdate=!1}},_addToMap:function(G){G&&(this._backupLatlng=this._latlng,this.setLatLng(G)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(G,S,u){this._recursively(G,this._group._map.getMinZoom(),u-1,function(rt){var Qt=rt._markers,se,Kt;for(se=Qt.length-1;se>=0;se--)Kt=Qt[se],Kt._icon&&(Kt._setPos(S),Kt.clusterHide())},function(rt){var Qt=rt._childClusters,se,Kt;for(se=Qt.length-1;se>=0;se--)Kt=Qt[se],Kt._icon&&(Kt._setPos(S),Kt.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(G,S,u,rt){this._recursively(G,rt,S,function(Qt){Qt._recursivelyAnimateChildrenIn(G,Qt._group._map.latLngToLayerPoint(Qt.getLatLng()).round(),u),Qt._isSingleParent()&&u-1===rt?(Qt.clusterShow(),Qt._recursivelyRemoveChildrenFromMap(G,S,u)):Qt.clusterHide(),Qt._addToMap()})},_recursivelyBecomeVisible:function(G,S){this._recursively(G,this._group._map.getMinZoom(),S,null,function(u){u.clusterShow()})},_recursivelyAddChildrenToMap:function(G,S,u){this._recursively(u,this._group._map.getMinZoom()-1,S,function(rt){if(S!==rt._zoom)for(var Qt=rt._markers.length-1;Qt>=0;Qt--){var se=rt._markers[Qt];u.contains(se._latlng)&&(G&&(se._backupLatlng=se.getLatLng(),se.setLatLng(G),se.clusterHide&&se.clusterHide()),rt._group._featureGroup.addLayer(se))}},function(rt){rt._addToMap(G)})},_recursivelyRestoreChildPositions:function(G){for(var S=this._markers.length-1;S>=0;S--){var u=this._markers[S];u._backupLatlng&&(u.setLatLng(u._backupLatlng),delete u._backupLatlng)}if(G-1===this._zoom)for(var rt=this._childClusters.length-1;rt>=0;rt--)this._childClusters[rt]._restorePosition();else for(var Qt=this._childClusters.length-1;Qt>=0;Qt--)this._childClusters[Qt]._recursivelyRestoreChildPositions(G)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(G,S,u,rt){var Qt,se;this._recursively(G,S-1,u-1,function(Kt){for(se=Kt._markers.length-1;se>=0;se--)Qt=Kt._markers[se],(!rt||!rt.contains(Qt._latlng))&&(Kt._group._featureGroup.removeLayer(Qt),Qt.clusterShow&&Qt.clusterShow())},function(Kt){for(se=Kt._childClusters.length-1;se>=0;se--)Qt=Kt._childClusters[se],(!rt||!rt.contains(Qt._latlng))&&(Kt._group._featureGroup.removeLayer(Qt),Qt.clusterShow&&Qt.clusterShow())})},_recursively:function(G,S,u,rt,Qt){var se=this._childClusters,Kt=this._zoom,re,_t;if(S<=Kt&&(rt&&rt(this),Qt&&Kt===u&&Qt(this)),Kt<S||Kt<u)for(re=se.length-1;re>=0;re--)_t=se[re],_t._boundsNeedUpdate&&_t._recalculateBounds(),G.intersects(_t._bounds)&&_t._recursively(G,S,u,rt,Qt)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var G=this.options.opacity;return this.setOpacity(0),this.options.opacity=G,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(G){this._cellSize=G,this._sqCellSize=G*G,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(G,S){var u=this._getCoord(S.x),rt=this._getCoord(S.y),Qt=this._grid,se=Qt[rt]=Qt[rt]||{},Kt=se[u]=se[u]||[],re=L.Util.stamp(G);this._objectPoint[re]=S,Kt.push(G)},updateObject:function(G,S){this.removeObject(G),this.addObject(G,S)},removeObject:function(G,S){var u=this._getCoord(S.x),rt=this._getCoord(S.y),Qt=this._grid,se=Qt[rt]=Qt[rt]||{},Kt=se[u]=se[u]||[],re,_t;for(delete this._objectPoint[L.Util.stamp(G)],re=0,_t=Kt.length;re<_t;re++)if(Kt[re]===G)return Kt.splice(re,1),_t===1&&delete se[u],!0},eachObject:function(G,S){var u,rt,Qt,se,Kt,re,_t,ge=this._grid;for(u in ge){Kt=ge[u];for(rt in Kt)for(re=Kt[rt],Qt=0,se=re.length;Qt<se;Qt++)_t=G.call(S,re[Qt]),_t&&(Qt--,se--)}},getNearObject:function(G){var S=this._getCoord(G.x),u=this._getCoord(G.y),rt,Qt,se,Kt,re,_t,ge,Ae,pi=this._objectPoint,Ze=this._sqCellSize,gi=null;for(rt=u-1;rt<=u+1;rt++)if(Kt=this._grid[rt],Kt){for(Qt=S-1;Qt<=S+1;Qt++)if(re=Kt[Qt],re)for(se=0,_t=re.length;se<_t;se++)ge=re[se],Ae=this._sqDist(pi[L.Util.stamp(ge)],G),(Ae<Ze||Ae<=Ze&&gi===null)&&(Ze=Ae,gi=ge)}return gi},_getCoord:function(G){var S=Math.floor(G/this._cellSize);return isFinite(S)?S:G},_sqDist:function(G,S){var u=S.x-G.x,rt=S.y-G.y;return u*u+rt*rt}},function(){L.QuickHull={getDistant:function(G,S){var u=S[1].lat-S[0].lat,rt=S[0].lng-S[1].lng;return rt*(G.lat-S[0].lat)+u*(G.lng-S[0].lng)},findMostDistantPointFromBaseLine:function(G,S){var u=0,rt=null,Qt=[],se,Kt,re;for(se=S.length-1;se>=0;se--){if(Kt=S[se],re=this.getDistant(Kt,G),re>0)Qt.push(Kt);else continue;re>u&&(u=re,rt=Kt)}return{maxPoint:rt,newPoints:Qt}},buildConvexHull:function(G,S){var u=[],rt=this.findMostDistantPointFromBaseLine(G,S);return rt.maxPoint?(u=u.concat(this.buildConvexHull([G[0],rt.maxPoint],rt.newPoints)),u=u.concat(this.buildConvexHull([rt.maxPoint,G[1]],rt.newPoints)),u):[G[0]]},getConvexHull:function(G){var S=!1,u=!1,rt=!1,Qt=!1,se=null,Kt=null,re=null,_t=null,ge=null,Ae=null,pi;for(pi=G.length-1;pi>=0;pi--){var Ze=G[pi];(S===!1||Ze.lat>S)&&(se=Ze,S=Ze.lat),(u===!1||Ze.lat<u)&&(Kt=Ze,u=Ze.lat),(rt===!1||Ze.lng>rt)&&(re=Ze,rt=Ze.lng),(Qt===!1||Ze.lng<Qt)&&(_t=Ze,Qt=Ze.lng)}u!==S?(Ae=Kt,ge=se):(Ae=_t,ge=re);var gi=[].concat(this.buildConvexHull([Ae,ge],G),this.buildConvexHull([ge,Ae],G));return gi}}}(),L.MarkerCluster.include({getConvexHull:function(){var G=this.getAllChildMarkers(),S=[],u,rt;for(rt=G.length-1;rt>=0;rt--)u=G[rt].getLatLng(),S.push(u);return L.QuickHull.getConvexHull(S)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var G=this.getAllChildMarkers(null,!0),S=this._group,u=S._map,rt=u.latLngToLayerPoint(this._latlng),Qt;this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?Qt=this._group.options.spiderfyShapePositions(G.length,rt):G.length>=this._circleSpiralSwitchover?Qt=this._generatePointsSpiral(G.length,rt):(rt.y+=10,Qt=this._generatePointsCircle(G.length,rt)),this._animationSpiderfy(G,Qt)}},unspiderfy:function(G){this._group._inZoomAnimation||(this._animationUnspiderfy(G),this._group._spiderfied=null)},_generatePointsCircle:function(G,S){var u=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+G),rt=u/this._2PI,Qt=this._2PI/G,se=[],Kt,re;for(rt=Math.max(rt,35),se.length=G,Kt=0;Kt<G;Kt++)re=this._circleStartAngle+Kt*Qt,se[Kt]=new L.Point(S.x+rt*Math.cos(re),S.y+rt*Math.sin(re))._round();return se},_generatePointsSpiral:function(G,S){var u=this._group.options.spiderfyDistanceMultiplier,rt=u*this._spiralLengthStart,Qt=u*this._spiralFootSeparation,se=u*this._spiralLengthFactor*this._2PI,Kt=0,re=[],_t;for(re.length=G,_t=G;_t>=0;_t--)_t<G&&(re[_t]=new L.Point(S.x+rt*Math.cos(Kt),S.y+rt*Math.sin(Kt))._round()),Kt+=Qt/rt+_t*5e-4,rt+=se/Kt;return re},_noanimationUnspiderfy:function(){var G=this._group,S=G._map,u=G._featureGroup,rt=this.getAllChildMarkers(null,!0),Qt,se;for(G._ignoreMove=!0,this.setOpacity(1),se=rt.length-1;se>=0;se--)Qt=rt[se],u.removeLayer(Qt),Qt._preSpiderfyLatlng&&(Qt.setLatLng(Qt._preSpiderfyLatlng),delete Qt._preSpiderfyLatlng),Qt.setZIndexOffset&&Qt.setZIndexOffset(0),Qt._spiderLeg&&(S.removeLayer(Qt._spiderLeg),delete Qt._spiderLeg);G.fire("unspiderfied",{cluster:this,markers:rt}),G._ignoreMove=!1,G._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(G,S){var u=this._group,rt=u._map,Qt=u._featureGroup,se=this._group.options.spiderLegPolylineOptions,Kt,re,_t,ge;for(u._ignoreMove=!0,Kt=0;Kt<G.length;Kt++)ge=rt.layerPointToLatLng(S[Kt]),re=G[Kt],_t=new L.Polyline([this._latlng,ge],se),rt.addLayer(_t),re._spiderLeg=_t,re._preSpiderfyLatlng=re._latlng,re.setLatLng(ge),re.setZIndexOffset&&re.setZIndexOffset(1e6),Qt.addLayer(re);this.setOpacity(.3),u._ignoreMove=!1,u.fire("spiderfied",{cluster:this,markers:G})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(G,S){var u=this,rt=this._group,Qt=rt._map,se=rt._featureGroup,Kt=this._latlng,re=Qt.latLngToLayerPoint(Kt),_t=L.Path.SVG,ge=L.extend({},this._group.options.spiderLegPolylineOptions),Ae=ge.opacity,pi,Ze,gi,Bi,Wi,Ei;for(Ae===void 0&&(Ae=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),_t?(ge.opacity=0,ge.className=(ge.className||"")+" leaflet-cluster-spider-leg"):ge.opacity=Ae,rt._ignoreMove=!0,pi=0;pi<G.length;pi++)Ze=G[pi],Ei=Qt.layerPointToLatLng(S[pi]),gi=new L.Polyline([Kt,Ei],ge),Qt.addLayer(gi),Ze._spiderLeg=gi,_t&&(Bi=gi._path,Wi=Bi.getTotalLength()+.1,Bi.style.strokeDasharray=Wi,Bi.style.strokeDashoffset=Wi),Ze.setZIndexOffset&&Ze.setZIndexOffset(1e6),Ze.clusterHide&&Ze.clusterHide(),se.addLayer(Ze),Ze._setPos&&Ze._setPos(re);for(rt._forceLayout(),rt._animationStart(),pi=G.length-1;pi>=0;pi--)Ei=Qt.layerPointToLatLng(S[pi]),Ze=G[pi],Ze._preSpiderfyLatlng=Ze._latlng,Ze.setLatLng(Ei),Ze.clusterShow&&Ze.clusterShow(),_t&&(gi=Ze._spiderLeg,Bi=gi._path,Bi.style.strokeDashoffset=0,gi.setStyle({opacity:Ae}));this.setOpacity(.3),rt._ignoreMove=!1,setTimeout(function(){rt._animationEnd(),rt.fire("spiderfied",{cluster:u,markers:G})},200)},_animationUnspiderfy:function(G){var S=this,u=this._group,rt=u._map,Qt=u._featureGroup,se=G?rt._latLngToNewLayerPoint(this._latlng,G.zoom,G.center):rt.latLngToLayerPoint(this._latlng),Kt=this.getAllChildMarkers(null,!0),re=L.Path.SVG,_t,ge,Ae,pi,Ze,gi;for(u._ignoreMove=!0,u._animationStart(),this.setOpacity(1),ge=Kt.length-1;ge>=0;ge--)_t=Kt[ge],_t._preSpiderfyLatlng&&(_t.closePopup(),_t.setLatLng(_t._preSpiderfyLatlng),delete _t._preSpiderfyLatlng,gi=!0,_t._setPos&&(_t._setPos(se),gi=!1),_t.clusterHide&&(_t.clusterHide(),gi=!1),gi&&Qt.removeLayer(_t),re&&(Ae=_t._spiderLeg,pi=Ae._path,Ze=pi.getTotalLength()+.1,pi.style.strokeDashoffset=Ze,Ae.setStyle({opacity:0})));u._ignoreMove=!1,setTimeout(function(){var Bi=0;for(ge=Kt.length-1;ge>=0;ge--)_t=Kt[ge],_t._spiderLeg&&Bi++;for(ge=Kt.length-1;ge>=0;ge--)_t=Kt[ge],_t._spiderLeg&&(_t.clusterShow&&_t.clusterShow(),_t.setZIndexOffset&&_t.setZIndexOffset(0),Bi>1&&Qt.removeLayer(_t),rt.removeLayer(_t._spiderLeg),delete _t._spiderLeg);u._animationEnd(),u.fire("unspiderfied",{cluster:S,markers:Kt})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(G){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(G))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(G){this._spiderfied&&this._spiderfied.unspiderfy(G)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(G){G._spiderLeg&&(this._featureGroup.removeLayer(G),G.clusterShow&&G.clusterShow(),G.setZIndexOffset&&G.setZIndexOffset(0),this._map.removeLayer(G._spiderLeg),delete G._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(G){return G?G instanceof L.MarkerClusterGroup?G=G._topClusterLevel.getAllChildMarkers():G instanceof L.LayerGroup?G=G._layers:G instanceof L.MarkerCluster?G=G.getAllChildMarkers():G instanceof L.Marker&&(G=[G]):G=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(G),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(G),this},_flagParentsIconsNeedUpdate:function(G){var S,u;for(S in G)for(u=G[S].__parent;u;)u._iconNeedsUpdate=!0,u=u.__parent},_refreshSingleMarkerModeMarkers:function(G){var S,u;for(S in G)u=G[S],this.hasLayer(u)&&u.setIcon(this._overrideMarkerIcon(u))}}),L.Marker.include({refreshIconOptions:function(G,S){var u=this.options.icon;return L.setOptions(u,G),this.setIcon(u),S&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),$t.MarkerClusterGroup=gt,$t.MarkerCluster=Vt,Object.defineProperty($t,"__esModule",{value:!0})})});eo();var Xe=_h(Lc());var og=_h(hf()),Ih=_h(pf());eo();(()=>{var $t=Object.create,gt=Object.defineProperty,Vt=Object.getOwnPropertyDescriptor,G=Object.getOwnPropertyNames,S=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty,rt=(l,p)=>()=>(p||l((p={exports:{}}).exports,p),p.exports),Qt=(l,p,y,x)=>{if(p&&typeof p=="object"||typeof p=="function")for(let M of G(p))!u.call(l,M)&&M!==y&&gt(l,M,{get:()=>p[M],enumerable:!(x=Vt(p,M))||x.enumerable});return l},se=(l,p,y)=>(y=l!=null?$t(S(l)):{},Qt(p||!l||!l.__esModule?gt(y,"default",{value:l,enumerable:!0}):y,l)),Kt=rt((l,p)=>{function y(){this.__data__=[],this.size=0}p.exports=y}),re=rt((l,p)=>{function y(x,M){return x===M||x!==x&&M!==M}p.exports=y}),_t=rt((l,p)=>{var y=re();function x(M,A){for(var R=M.length;R--;)if(y(M[R][0],A))return R;return-1}p.exports=x}),ge=rt((l,p)=>{var y=_t(),x=Array.prototype,M=x.splice;function A(R){var j=this.__data__,W=y(j,R);if(W<0)return!1;var et=j.length-1;return W==et?j.pop():M.call(j,W,1),--this.size,!0}p.exports=A}),Ae=rt((l,p)=>{var y=_t();function x(M){var A=this.__data__,R=y(A,M);return R<0?void 0:A[R][1]}p.exports=x}),pi=rt((l,p)=>{var y=_t();function x(M){return y(this.__data__,M)>-1}p.exports=x}),Ze=rt((l,p)=>{var y=_t();function x(M,A){var R=this.__data__,j=y(R,M);return j<0?(++this.size,R.push([M,A])):R[j][1]=A,this}p.exports=x}),gi=rt((l,p)=>{var y=Kt(),x=ge(),M=Ae(),A=pi(),R=Ze();function j(W){var et=-1,Tt=W==null?0:W.length;for(this.clear();++et<Tt;){var kt=W[et];this.set(kt[0],kt[1])}}j.prototype.clear=y,j.prototype.delete=x,j.prototype.get=M,j.prototype.has=A,j.prototype.set=R,p.exports=j}),Bi=rt((l,p)=>{var y=gi();function x(){this.__data__=new y,this.size=0}p.exports=x}),Wi=rt((l,p)=>{function y(x){var M=this.__data__,A=M.delete(x);return this.size=M.size,A}p.exports=y}),Ei=rt((l,p)=>{function y(x){return this.__data__.get(x)}p.exports=y}),Ri=rt((l,p)=>{function y(x){return this.__data__.has(x)}p.exports=y}),Pn=rt((l,p)=>{var y=typeof global=="object"&&global&&global.Object===Object&&global;p.exports=y}),Fn=rt((l,p)=>{var y=Pn(),x=typeof self=="object"&&self&&self.Object===Object&&self,M=y||x||Function("return this")();p.exports=M}),Bs=rt((l,p)=>{var y=Fn(),x=y.Symbol;p.exports=x}),Ds=rt((l,p)=>{var y=Bs(),x=Object.prototype,M=x.hasOwnProperty,A=x.toString,R=y?y.toStringTag:void 0;function j(W){var et=M.call(W,R),Tt=W[R];try{W[R]=void 0;var kt=!0}catch{}var ie=A.call(W);return kt&&(et?W[R]=Tt:delete W[R]),ie}p.exports=j}),dr=rt((l,p)=>{var y=Object.prototype,x=y.toString;function M(A){return x.call(A)}p.exports=M}),Ki=rt((l,p)=>{var y=Bs(),x=Ds(),M=dr(),A="[object Null]",R="[object Undefined]",j=y?y.toStringTag:void 0;function W(et){return et==null?et===void 0?R:A:j&&j in Object(et)?x(et):M(et)}p.exports=W}),_r=rt((l,p)=>{function y(x){var M=typeof x;return x!=null&&(M=="object"||M=="function")}p.exports=y}),wr=rt((l,p)=>{var y=Ki(),x=_r(),M="[object AsyncFunction]",A="[object Function]",R="[object GeneratorFunction]",j="[object Proxy]";function W(et){if(!x(et))return!1;var Tt=y(et);return Tt==A||Tt==R||Tt==M||Tt==j}p.exports=W}),is=rt((l,p)=>{var y=Fn(),x=y["__core-js_shared__"];p.exports=x}),gr=rt((l,p)=>{var y=is(),x=function(){var A=/[^.]+$/.exec(y&&y.keys&&y.keys.IE_PROTO||"");return A?"Symbol(src)_1."+A:""}();function M(A){return!!x&&x in A}p.exports=M}),Nn=rt((l,p)=>{var y=Function.prototype,x=y.toString;function M(A){if(A!=null){try{return x.call(A)}catch{}try{return A+""}catch{}}return""}p.exports=M}),ei=rt((l,p)=>{var y=wr(),x=gr(),M=_r(),A=Nn(),R=/[\\^$.*+?()[\]{}|]/g,j=/^\[object .+?Constructor\]$/,W=Function.prototype,et=Object.prototype,Tt=W.toString,kt=et.hasOwnProperty,ie=RegExp("^"+Tt.call(kt).replace(R,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ut(jt){if(!M(jt)||x(jt))return!1;var de=y(jt)?ie:j;return de.test(A(jt))}p.exports=Ut}),io=rt((l,p)=>{function y(x,M){return x?.[M]}p.exports=y}),Ye=rt((l,p)=>{var y=ei(),x=io();function M(A,R){var j=x(A,R);return y(j)?j:void 0}p.exports=M}),bi=rt((l,p)=>{var y=Ye(),x=Fn(),M=y(x,"Map");p.exports=M}),ti=rt((l,p)=>{var y=Ye(),x=y(Object,"create");p.exports=x}),$i=rt((l,p)=>{var y=ti();function x(){this.__data__=y?y(null):{},this.size=0}p.exports=x}),Ii=rt((l,p)=>{function y(x){var M=this.has(x)&&delete this.__data__[x];return this.size-=M?1:0,M}p.exports=y}),wi=rt((l,p)=>{var y=ti(),x="__lodash_hash_undefined__",M=Object.prototype,A=M.hasOwnProperty;function R(j){var W=this.__data__;if(y){var et=W[j];return et===x?void 0:et}return A.call(W,j)?W[j]:void 0}p.exports=R}),mi=rt((l,p)=>{var y=ti(),x=Object.prototype,M=x.hasOwnProperty;function A(R){var j=this.__data__;return y?j[R]!==void 0:M.call(j,R)}p.exports=A}),Wr=rt((l,p)=>{var y=ti(),x="__lodash_hash_undefined__";function M(A,R){var j=this.__data__;return this.size+=this.has(A)?0:1,j[A]=y&&R===void 0?x:R,this}p.exports=M}),jn=rt((l,p)=>{var y=$i(),x=Ii(),M=wi(),A=mi(),R=Wr();function j(W){var et=-1,Tt=W==null?0:W.length;for(this.clear();++et<Tt;){var kt=W[et];this.set(kt[0],kt[1])}}j.prototype.clear=y,j.prototype.delete=x,j.prototype.get=M,j.prototype.has=A,j.prototype.set=R,p.exports=j}),nr=rt((l,p)=>{var y=jn(),x=gi(),M=bi();function A(){this.size=0,this.__data__={hash:new y,map:new(M||x),string:new y}}p.exports=A}),ro=rt((l,p)=>{function y(x){var M=typeof x;return M=="string"||M=="number"||M=="symbol"||M=="boolean"?x!=="__proto__":x===null}p.exports=y}),yr=rt((l,p)=>{var y=ro();function x(M,A){var R=M.__data__;return y(A)?R[typeof A=="string"?"string":"hash"]:R.map}p.exports=x}),_s=rt((l,p)=>{var y=yr();function x(M){var A=y(this,M).delete(M);return this.size-=A?1:0,A}p.exports=x}),ji=rt((l,p)=>{var y=yr();function x(M){return y(this,M).get(M)}p.exports=x}),rs=rt((l,p)=>{var y=yr();function x(M){return y(this,M).has(M)}p.exports=x}),cn=rt((l,p)=>{var y=yr();function x(M,A){var R=y(this,M),j=R.size;return R.set(M,A),this.size+=R.size==j?0:1,this}p.exports=x}),zs=rt((l,p)=>{var y=nr(),x=_s(),M=ji(),A=rs(),R=cn();function j(W){var et=-1,Tt=W==null?0:W.length;for(this.clear();++et<Tt;){var kt=W[et];this.set(kt[0],kt[1])}}j.prototype.clear=y,j.prototype.delete=x,j.prototype.get=M,j.prototype.has=A,j.prototype.set=R,p.exports=j}),fr=rt((l,p)=>{var y=gi(),x=bi(),M=zs(),A=200;function R(j,W){var et=this.__data__;if(et instanceof y){var Tt=et.__data__;if(!x||Tt.length<A-1)return Tt.push([j,W]),this.size=++et.size,this;et=this.__data__=new M(Tt)}return et.set(j,W),this.size=et.size,this}p.exports=R}),Er=rt((l,p)=>{var y=gi(),x=Bi(),M=Wi(),A=Ei(),R=Ri(),j=fr();function W(et){var Tt=this.__data__=new y(et);this.size=Tt.size}W.prototype.clear=x,W.prototype.delete=M,W.prototype.get=A,W.prototype.has=R,W.prototype.set=j,p.exports=W}),Rr=rt((l,p)=>{var y=Ye(),x=function(){try{var M=y(Object,"defineProperty");return M({},"",{}),M}catch{}}();p.exports=x}),ns=rt((l,p)=>{var y=Rr();function x(M,A,R){A=="__proto__"&&y?y(M,A,{configurable:!0,enumerable:!0,value:R,writable:!0}):M[A]=R}p.exports=x}),Gn=rt((l,p)=>{var y=ns(),x=re();function M(A,R,j){(j!==void 0&&!x(A[R],j)||j===void 0&&!(R in A))&&y(A,R,j)}p.exports=M}),zo=rt((l,p)=>{function y(x){return function(M,A,R){for(var j=-1,W=Object(M),et=R(M),Tt=et.length;Tt--;){var kt=et[x?Tt:++j];if(A(W[kt],kt,W)===!1)break}return M}}p.exports=y}),Rs=rt((l,p)=>{var y=zo(),x=y();p.exports=x}),gs=rt((l,p)=>{var y=Fn(),x=typeof l=="object"&&l&&!l.nodeType&&l,M=x&&typeof p=="object"&&p&&!p.nodeType&&p,A=M&&M.exports===x,R=A?y.Buffer:void 0,j=R?R.allocUnsafe:void 0;function W(et,Tt){if(Tt)return et.slice();var kt=et.length,ie=j?j(kt):new et.constructor(kt);return et.copy(ie),ie}p.exports=W}),no=rt((l,p)=>{var y=Fn(),x=y.Uint8Array;p.exports=x}),Zn=rt((l,p)=>{var y=no();function x(M){var A=new M.constructor(M.byteLength);return new y(A).set(new y(M)),A}p.exports=x}),Kr=rt((l,p)=>{var y=Zn();function x(M,A){var R=A?y(M.buffer):M.buffer;return new M.constructor(R,M.byteOffset,M.length)}p.exports=x}),Vn=rt((l,p)=>{function y(x,M){var A=-1,R=x.length;for(M||(M=Array(R));++A<R;)M[A]=x[A];return M}p.exports=y}),Xo=rt((l,p)=>{var y=_r(),x=Object.create,M=function(){function A(){}return function(R){if(!y(R))return{};if(x)return x(R);A.prototype=R;var j=new A;return A.prototype=void 0,j}}();p.exports=M}),Yo=rt((l,p)=>{function y(x,M){return function(A){return x(M(A))}}p.exports=y}),Un=rt((l,p)=>{var y=Yo(),x=y(Object.getPrototypeOf,Object);p.exports=x}),Gt=rt((l,p)=>{var y=Object.prototype;function x(M){var A=M&&M.constructor,R=typeof A=="function"&&A.prototype||y;return M===R}p.exports=x}),J=rt((l,p)=>{var y=Xo(),x=Un(),M=Gt();function A(R){return typeof R.constructor=="function"&&!M(R)?y(x(R)):{}}p.exports=A}),tt=rt((l,p)=>{function y(x){return x!=null&&typeof x=="object"}p.exports=y}),lt=rt((l,p)=>{var y=Ki(),x=tt(),M="[object Arguments]";function A(R){return x(R)&&y(R)==M}p.exports=A}),vt=rt((l,p)=>{var y=lt(),x=tt(),M=Object.prototype,A=M.hasOwnProperty,R=M.propertyIsEnumerable,j=y(function(){return arguments}())?y:function(W){return x(W)&&A.call(W,"callee")&&!R.call(W,"callee")};p.exports=j}),Et=rt((l,p)=>{var y=Array.isArray;p.exports=y}),Nt=rt((l,p)=>{var y=9007199254740991;function x(M){return typeof M=="number"&&M>-1&&M%1==0&&M<=y}p.exports=x}),ee=rt((l,p)=>{var y=wr(),x=Nt();function M(A){return A!=null&&x(A.length)&&!y(A)}p.exports=M}),Rt=rt((l,p)=>{var y=ee(),x=tt();function M(A){return x(A)&&y(A)}p.exports=M}),fe=rt((l,p)=>{function y(){return!1}p.exports=y}),ce=rt((l,p)=>{var y=Fn(),x=fe(),M=typeof l=="object"&&l&&!l.nodeType&&l,A=M&&typeof p=="object"&&p&&!p.nodeType&&p,R=A&&A.exports===M,j=R?y.Buffer:void 0,W=j?j.isBuffer:void 0,et=W||x;p.exports=et}),qt=rt((l,p)=>{var y=Ki(),x=Un(),M=tt(),A="[object Object]",R=Function.prototype,j=Object.prototype,W=R.toString,et=j.hasOwnProperty,Tt=W.call(Object);function kt(ie){if(!M(ie)||y(ie)!=A)return!1;var Ut=x(ie);if(Ut===null)return!0;var jt=et.call(Ut,"constructor")&&Ut.constructor;return typeof jt=="function"&&jt instanceof jt&&W.call(jt)==Tt}p.exports=kt}),ye=rt((l,p)=>{var y=Ki(),x=Nt(),M=tt(),A="[object Arguments]",R="[object Array]",j="[object Boolean]",W="[object Date]",et="[object Error]",Tt="[object Function]",kt="[object Map]",ie="[object Number]",Ut="[object Object]",jt="[object RegExp]",de="[object Set]",Fe="[object String]",Mi="[object WeakMap]",bt="[object ArrayBuffer]",St="[object DataView]",Zt="[object Float32Array]",Jt="[object Float64Array]",Ht="[object Int8Array]",oe="[object Int16Array]",q="[object Int32Array]",Q="[object Uint8Array]",ut="[object Uint8ClampedArray]",ot="[object Uint16Array]",ht="[object Uint32Array]",pt={};pt[Zt]=pt[Jt]=pt[Ht]=pt[oe]=pt[q]=pt[Q]=pt[ut]=pt[ot]=pt[ht]=!0,pt[A]=pt[R]=pt[bt]=pt[j]=pt[St]=pt[W]=pt[et]=pt[Tt]=pt[kt]=pt[ie]=pt[Ut]=pt[jt]=pt[de]=pt[Fe]=pt[Mi]=!1;function Dt(Bt){return M(Bt)&&x(Bt.length)&&!!pt[y(Bt)]}p.exports=Dt}),At=rt((l,p)=>{function y(x){return function(M){return x(M)}}p.exports=y}),Ie=rt((l,p)=>{var y=Pn(),x=typeof l=="object"&&l&&!l.nodeType&&l,M=x&&typeof p=="object"&&p&&!p.nodeType&&p,A=M&&M.exports===x,R=A&&y.process,j=function(){try{var W=M&&M.require&&M.require("util").types;return W||R&&R.binding&&R.binding("util")}catch{}}();p.exports=j}),$e=rt((l,p)=>{var y=ye(),x=At(),M=Ie(),A=M&&M.isTypedArray,R=A?x(A):y;p.exports=R}),Be=rt((l,p)=>{function y(x,M){if(!(M==="constructor"&&typeof x[M]=="function")&&M!="__proto__")return x[M]}p.exports=y}),je=rt((l,p)=>{var y=ns(),x=re(),M=Object.prototype,A=M.hasOwnProperty;function R(j,W,et){var Tt=j[W];(!(A.call(j,W)&&x(Tt,et))||et===void 0&&!(W in j))&&y(j,W,et)}p.exports=R}),Je=rt((l,p)=>{var y=je(),x=ns();function M(A,R,j,W){var et=!j;j||(j={});for(var Tt=-1,kt=R.length;++Tt<kt;){var ie=R[Tt],Ut=W?W(j[ie],A[ie],ie,j,A):void 0;Ut===void 0&&(Ut=A[ie]),et?x(j,ie,Ut):y(j,ie,Ut)}return j}p.exports=M}),Oi=rt((l,p)=>{function y(x,M){for(var A=-1,R=Array(x);++A<x;)R[A]=M(A);return R}p.exports=y}),Ai=rt((l,p)=>{var y=9007199254740991,x=/^(?:0|[1-9]\d*)$/;function M(A,R){var j=typeof A;return R=R??y,!!R&&(j=="number"||j!="symbol"&&x.test(A))&&A>-1&&A%1==0&&A<R}p.exports=M}),Ti=rt((l,p)=>{var y=Oi(),x=vt(),M=Et(),A=ce(),R=Ai(),j=$e(),W=Object.prototype,et=W.hasOwnProperty;function Tt(kt,ie){var Ut=M(kt),jt=!Ut&&x(kt),de=!Ut&&!jt&&A(kt),Fe=!Ut&&!jt&&!de&&j(kt),Mi=Ut||jt||de||Fe,bt=Mi?y(kt.length,String):[],St=bt.length;for(var Zt in kt)(ie||et.call(kt,Zt))&&!(Mi&&(Zt=="length"||de&&(Zt=="offset"||Zt=="parent")||Fe&&(Zt=="buffer"||Zt=="byteLength"||Zt=="byteOffset")||R(Zt,St)))&&bt.push(Zt);return bt}p.exports=Tt}),Ge=rt((l,p)=>{function y(x){var M=[];if(x!=null)for(var A in Object(x))M.push(A);return M}p.exports=y}),Se=rt((l,p)=>{var y=_r(),x=Gt(),M=Ge(),A=Object.prototype,R=A.hasOwnProperty;function j(W){if(!y(W))return M(W);var et=x(W),Tt=[];for(var kt in W)kt=="constructor"&&(et||!R.call(W,kt))||Tt.push(kt);return Tt}p.exports=j}),sr=rt((l,p)=>{var y=Ti(),x=Se(),M=ee();function A(R){return M(R)?y(R,!0):x(R)}p.exports=A}),Le=rt((l,p)=>{var y=Je(),x=sr();function M(A){return y(A,x(A))}p.exports=M}),vr=rt((l,p)=>{var y=Gn(),x=gs(),M=Kr(),A=Vn(),R=J(),j=vt(),W=Et(),et=Rt(),Tt=ce(),kt=wr(),ie=_r(),Ut=qt(),jt=$e(),de=Be(),Fe=Le();function Mi(bt,St,Zt,Jt,Ht,oe,q){var Q=de(bt,Zt),ut=de(St,Zt),ot=q.get(ut);if(ot){y(bt,Zt,ot);return}var ht=oe?oe(Q,ut,Zt+"",bt,St,q):void 0,pt=ht===void 0;if(pt){var Dt=W(ut),Bt=!Dt&&Tt(ut),Ft=!Dt&&!Bt&&jt(ut);ht=ut,Dt||Bt||Ft?W(Q)?ht=Q:et(Q)?ht=A(Q):Bt?(pt=!1,ht=x(ut,!0)):Ft?(pt=!1,ht=M(ut,!0)):ht=[]:Ut(ut)||j(ut)?(ht=Q,j(Q)?ht=Fe(Q):(!ie(Q)||kt(Q))&&(ht=R(ut))):pt=!1}pt&&(q.set(ut,ht),Ht(ht,ut,Jt,oe,q),q.delete(ut)),y(bt,Zt,ht)}p.exports=Mi}),Gi=rt((l,p)=>{var y=Er(),x=Gn(),M=Rs(),A=vr(),R=_r(),j=sr(),W=Be();function et(Tt,kt,ie,Ut,jt){Tt!==kt&&M(kt,function(de,Fe){if(jt||(jt=new y),R(de))A(Tt,kt,Fe,ie,et,Ut,jt);else{var Mi=Ut?Ut(W(Tt,Fe),de,Fe+"",Tt,kt,jt):void 0;Mi===void 0&&(Mi=de),x(Tt,Fe,Mi)}},j)}p.exports=et}),$n=rt((l,p)=>{function y(x){return x}p.exports=y}),Os=rt((l,p)=>{function y(x,M,A){switch(A.length){case 0:return x.call(M);case 1:return x.call(M,A[0]);case 2:return x.call(M,A[0],A[1]);case 3:return x.call(M,A[0],A[1],A[2])}return x.apply(M,A)}p.exports=y}),Pe=rt((l,p)=>{var y=Os(),x=Math.max;function M(A,R,j){return R=x(R===void 0?A.length-1:R,0),function(){for(var W=arguments,et=-1,Tt=x(W.length-R,0),kt=Array(Tt);++et<Tt;)kt[et]=W[R+et];et=-1;for(var ie=Array(R+1);++et<R;)ie[et]=W[et];return ie[R]=j(kt),y(A,this,ie)}}p.exports=M}),ni=rt((l,p)=>{function y(x){return function(){return x}}p.exports=y}),ui=rt((l,p)=>{var y=ni(),x=Rr(),M=$n(),A=x?function(R,j){return x(R,"toString",{configurable:!0,enumerable:!1,value:y(j),writable:!0})}:M;p.exports=A}),pn=rt((l,p)=>{var y=800,x=16,M=Date.now;function A(R){var j=0,W=0;return function(){var et=M(),Tt=x-(et-W);if(W=et,Tt>0){if(++j>=y)return arguments[0]}else j=0;return R.apply(void 0,arguments)}}p.exports=A}),La=rt((l,p)=>{var y=ui(),x=pn(),M=x(y);p.exports=M}),ss=rt((l,p)=>{var y=$n(),x=Pe(),M=La();function A(R,j){return M(x(R,j,y),R+"")}p.exports=A}),si=rt((l,p)=>{var y=re(),x=ee(),M=Ai(),A=_r();function R(j,W,et){if(!A(et))return!1;var Tt=typeof W;return(Tt=="number"?x(et)&&M(W,et.length):Tt=="string"&&W in et)?y(et[W],j):!1}p.exports=R}),ys=rt((l,p)=>{var y=ss(),x=si();function M(A){return y(function(R,j){var W=-1,et=j.length,Tt=et>1?j[et-1]:void 0,kt=et>2?j[2]:void 0;for(Tt=A.length>3&&typeof Tt=="function"?(et--,Tt):void 0,kt&&x(j[0],j[1],kt)&&(Tt=et<3?void 0:Tt,et=1),R=Object(R);++W<et;){var ie=j[W];ie&&A(R,ie,W,Tt)}return R})}p.exports=M}),Sn=rt((l,p)=>{var y=Gi(),x=ys(),M=x(function(A,R,j){y(A,R,j)});p.exports=M}),Xi=rt((l,p)=>{var y=Ki(),x=tt(),M="[object Symbol]";function A(R){return typeof R=="symbol"||x(R)&&y(R)==M}p.exports=A}),Jo=rt((l,p)=>{var y=Et(),x=Xi(),M=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,A=/^\w*$/;function R(j,W){if(y(j))return!1;var et=typeof j;return et=="number"||et=="symbol"||et=="boolean"||j==null||x(j)?!0:A.test(j)||!M.test(j)||W!=null&&j in Object(W)}p.exports=R}),Qo=rt((l,p)=>{var y=zs(),x="Expected a function";function M(A,R){if(typeof A!="function"||R!=null&&typeof R!="function")throw new TypeError(x);var j=function(){var W=arguments,et=R?R.apply(this,W):W[0],Tt=j.cache;if(Tt.has(et))return Tt.get(et);var kt=A.apply(this,W);return j.cache=Tt.set(et,kt)||Tt,kt};return j.cache=new(M.Cache||y),j}M.Cache=y,p.exports=M}),vs=rt((l,p)=>{var y=Qo(),x=500;function M(A){var R=y(A,function(W){return j.size===x&&j.clear(),W}),j=R.cache;return R}p.exports=M}),ta=rt((l,p)=>{var y=vs(),x=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,M=/\\(\\)?/g,A=y(function(R){var j=[];return R.charCodeAt(0)===46&&j.push(""),R.replace(x,function(W,et,Tt,kt){j.push(Tt?kt.replace(M,"$1"):et||W)}),j});p.exports=A}),Or=rt((l,p)=>{function y(x,M){for(var A=-1,R=x==null?0:x.length,j=Array(R);++A<R;)j[A]=M(x[A],A,x);return j}p.exports=y}),zi=rt((l,p)=>{var y=Bs(),x=Or(),M=Et(),A=Xi(),R=1/0,j=y?y.prototype:void 0,W=j?j.toString:void 0;function et(Tt){if(typeof Tt=="string")return Tt;if(M(Tt))return x(Tt,et)+"";if(A(Tt))return W?W.call(Tt):"";var kt=Tt+"";return kt=="0"&&1/Tt==-R?"-0":kt}p.exports=et}),Ha=rt((l,p)=>{var y=zi();function x(M){return M==null?"":y(M)}p.exports=x}),Ro=rt((l,p)=>{var y=Et(),x=Jo(),M=ta(),A=Ha();function R(j,W){return y(j)?j:x(j,W)?[j]:M(A(j))}p.exports=R}),Fs=rt((l,p)=>{var y=Xi(),x=1/0;function M(A){if(typeof A=="string"||y(A))return A;var R=A+"";return R=="0"&&1/A==-x?"-0":R}p.exports=M}),yi=rt((l,p)=>{var y=Ro(),x=Fs();function M(A,R){R=y(R,A);for(var j=0,W=R.length;A!=null&&j<W;)A=A[x(R[j++])];return j&&j==W?A:void 0}p.exports=M}),Si=rt((l,p)=>{var y=yi();function x(M,A,R){var j=M==null?void 0:y(M,A);return j===void 0?R:j}p.exports=x}),ea=rt((l,p)=>{(function(y,x){typeof l=="object"&&typeof p<"u"?p.exports=x():typeof define=="function"&&define.amd?define(x):(y=y||self).RBush=x()})(l,function(){"use strict";function y(bt,St,Zt,Jt,Ht){(function oe(q,Q,ut,ot,ht){for(;ot>ut;){if(ot-ut>600){var pt=ot-ut+1,Dt=Q-ut+1,Bt=Math.log(pt),Ft=.5*Math.exp(2*Bt/3),Yt=.5*Math.sqrt(Bt*Ft*(pt-Ft)/pt)*(Dt-pt/2<0?-1:1),Wt=Math.max(ut,Math.floor(Q-Dt*Ft/pt+Yt)),we=Math.min(ot,Math.floor(Q+(pt-Dt)*Ft/pt+Yt));oe(q,Q,Wt,we,ht)}var d=q[Q],t=ut,i=ot;for(x(q,ut,Q),ht(q[ot],d)>0&&x(q,ut,ot);t<i;){for(x(q,t,i),t++,i--;ht(q[t],d)<0;)t++;for(;ht(q[i],d)>0;)i--}ht(q[ut],d)===0?x(q,ut,i):x(q,++i,ot),i<=Q&&(ut=i+1),Q<=i&&(ot=i-1)}})(bt,St,Zt||0,Jt||bt.length-1,Ht||M)}function x(bt,St,Zt){var Jt=bt[St];bt[St]=bt[Zt],bt[Zt]=Jt}function M(bt,St){return bt<St?-1:bt>St?1:0}var A=function(bt){bt===void 0&&(bt=9),this._maxEntries=Math.max(4,bt),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function R(bt,St,Zt){if(!Zt)return St.indexOf(bt);for(var Jt=0;Jt<St.length;Jt++)if(Zt(bt,St[Jt]))return Jt;return-1}function j(bt,St){W(bt,0,bt.children.length,St,bt)}function W(bt,St,Zt,Jt,Ht){Ht||(Ht=Fe(null)),Ht.minX=1/0,Ht.minY=1/0,Ht.maxX=-1/0,Ht.maxY=-1/0;for(var oe=St;oe<Zt;oe++){var q=bt.children[oe];et(Ht,bt.leaf?Jt(q):q)}return Ht}function et(bt,St){return bt.minX=Math.min(bt.minX,St.minX),bt.minY=Math.min(bt.minY,St.minY),bt.maxX=Math.max(bt.maxX,St.maxX),bt.maxY=Math.max(bt.maxY,St.maxY),bt}function Tt(bt,St){return bt.minX-St.minX}function kt(bt,St){return bt.minY-St.minY}function ie(bt){return(bt.maxX-bt.minX)*(bt.maxY-bt.minY)}function Ut(bt){return bt.maxX-bt.minX+(bt.maxY-bt.minY)}function jt(bt,St){return bt.minX<=St.minX&&bt.minY<=St.minY&&St.maxX<=bt.maxX&&St.maxY<=bt.maxY}function de(bt,St){return St.minX<=bt.maxX&&St.minY<=bt.maxY&&St.maxX>=bt.minX&&St.maxY>=bt.minY}function Fe(bt){return{children:bt,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Mi(bt,St,Zt,Jt,Ht){for(var oe=[St,Zt];oe.length;)if(!((Zt=oe.pop())-(St=oe.pop())<=Jt)){var q=St+Math.ceil((Zt-St)/Jt/2)*Jt;y(bt,q,St,Zt,Ht),oe.push(St,q,q,Zt)}}return A.prototype.all=function(){return this._all(this.data,[])},A.prototype.search=function(bt){var St=this.data,Zt=[];if(!de(bt,St))return Zt;for(var Jt=this.toBBox,Ht=[];St;){for(var oe=0;oe<St.children.length;oe++){var q=St.children[oe],Q=St.leaf?Jt(q):q;de(bt,Q)&&(St.leaf?Zt.push(q):jt(bt,Q)?this._all(q,Zt):Ht.push(q))}St=Ht.pop()}return Zt},A.prototype.collides=function(bt){var St=this.data;if(!de(bt,St))return!1;for(var Zt=[];St;){for(var Jt=0;Jt<St.children.length;Jt++){var Ht=St.children[Jt],oe=St.leaf?this.toBBox(Ht):Ht;if(de(bt,oe)){if(St.leaf||jt(bt,oe))return!0;Zt.push(Ht)}}St=Zt.pop()}return!1},A.prototype.load=function(bt){if(!bt||!bt.length)return this;if(bt.length<this._minEntries){for(var St=0;St<bt.length;St++)this.insert(bt[St]);return this}var Zt=this._build(bt.slice(),0,bt.length-1,0);if(this.data.children.length)if(this.data.height===Zt.height)this._splitRoot(this.data,Zt);else{if(this.data.height<Zt.height){var Jt=this.data;this.data=Zt,Zt=Jt}this._insert(Zt,this.data.height-Zt.height-1,!0)}else this.data=Zt;return this},A.prototype.insert=function(bt){return bt&&this._insert(bt,this.data.height-1),this},A.prototype.clear=function(){return this.data=Fe([]),this},A.prototype.remove=function(bt,St){if(!bt)return this;for(var Zt,Jt,Ht,oe=this.data,q=this.toBBox(bt),Q=[],ut=[];oe||Q.length;){if(oe||(oe=Q.pop(),Jt=Q[Q.length-1],Zt=ut.pop(),Ht=!0),oe.leaf){var ot=R(bt,oe.children,St);if(ot!==-1)return oe.children.splice(ot,1),Q.push(oe),this._condense(Q),this}Ht||oe.leaf||!jt(oe,q)?Jt?(Zt++,oe=Jt.children[Zt],Ht=!1):oe=null:(Q.push(oe),ut.push(Zt),Zt=0,Jt=oe,oe=oe.children[0])}return this},A.prototype.toBBox=function(bt){return bt},A.prototype.compareMinX=function(bt,St){return bt.minX-St.minX},A.prototype.compareMinY=function(bt,St){return bt.minY-St.minY},A.prototype.toJSON=function(){return this.data},A.prototype.fromJSON=function(bt){return this.data=bt,this},A.prototype._all=function(bt,St){for(var Zt=[];bt;)bt.leaf?St.push.apply(St,bt.children):Zt.push.apply(Zt,bt.children),bt=Zt.pop();return St},A.prototype._build=function(bt,St,Zt,Jt){var Ht,oe=Zt-St+1,q=this._maxEntries;if(oe<=q)return j(Ht=Fe(bt.slice(St,Zt+1)),this.toBBox),Ht;Jt||(Jt=Math.ceil(Math.log(oe)/Math.log(q)),q=Math.ceil(oe/Math.pow(q,Jt-1))),(Ht=Fe([])).leaf=!1,Ht.height=Jt;var Q=Math.ceil(oe/q),ut=Q*Math.ceil(Math.sqrt(q));Mi(bt,St,Zt,ut,this.compareMinX);for(var ot=St;ot<=Zt;ot+=ut){var ht=Math.min(ot+ut-1,Zt);Mi(bt,ot,ht,Q,this.compareMinY);for(var pt=ot;pt<=ht;pt+=Q){var Dt=Math.min(pt+Q-1,ht);Ht.children.push(this._build(bt,pt,Dt,Jt-1))}}return j(Ht,this.toBBox),Ht},A.prototype._chooseSubtree=function(bt,St,Zt,Jt){for(;Jt.push(St),!St.leaf&&Jt.length-1!==Zt;){for(var Ht=1/0,oe=1/0,q=void 0,Q=0;Q<St.children.length;Q++){var ut=St.children[Q],ot=ie(ut),ht=(pt=bt,Dt=ut,(Math.max(Dt.maxX,pt.maxX)-Math.min(Dt.minX,pt.minX))*(Math.max(Dt.maxY,pt.maxY)-Math.min(Dt.minY,pt.minY))-ot);ht<oe?(oe=ht,Ht=ot<Ht?ot:Ht,q=ut):ht===oe&&ot<Ht&&(Ht=ot,q=ut)}St=q||St.children[0]}var pt,Dt;return St},A.prototype._insert=function(bt,St,Zt){var Jt=Zt?bt:this.toBBox(bt),Ht=[],oe=this._chooseSubtree(Jt,this.data,St,Ht);for(oe.children.push(bt),et(oe,Jt);St>=0&&Ht[St].children.length>this._maxEntries;)this._split(Ht,St),St--;this._adjustParentBBoxes(Jt,Ht,St)},A.prototype._split=function(bt,St){var Zt=bt[St],Jt=Zt.children.length,Ht=this._minEntries;this._chooseSplitAxis(Zt,Ht,Jt);var oe=this._chooseSplitIndex(Zt,Ht,Jt),q=Fe(Zt.children.splice(oe,Zt.children.length-oe));q.height=Zt.height,q.leaf=Zt.leaf,j(Zt,this.toBBox),j(q,this.toBBox),St?bt[St-1].children.push(q):this._splitRoot(Zt,q)},A.prototype._splitRoot=function(bt,St){this.data=Fe([bt,St]),this.data.height=bt.height+1,this.data.leaf=!1,j(this.data,this.toBBox)},A.prototype._chooseSplitIndex=function(bt,St,Zt){for(var Jt,Ht,oe,q,Q,ut,ot,ht=1/0,pt=1/0,Dt=St;Dt<=Zt-St;Dt++){var Bt=W(bt,0,Dt,this.toBBox),Ft=W(bt,Dt,Zt,this.toBBox),Yt=(Ht=Bt,oe=Ft,q=void 0,Q=void 0,ut=void 0,ot=void 0,q=Math.max(Ht.minX,oe.minX),Q=Math.max(Ht.minY,oe.minY),ut=Math.min(Ht.maxX,oe.maxX),ot=Math.min(Ht.maxY,oe.maxY),Math.max(0,ut-q)*Math.max(0,ot-Q)),Wt=ie(Bt)+ie(Ft);Yt<ht?(ht=Yt,Jt=Dt,pt=Wt<pt?Wt:pt):Yt===ht&&Wt<pt&&(pt=Wt,Jt=Dt)}return Jt||Zt-St},A.prototype._chooseSplitAxis=function(bt,St,Zt){var Jt=bt.leaf?this.compareMinX:Tt,Ht=bt.leaf?this.compareMinY:kt;this._allDistMargin(bt,St,Zt,Jt)<this._allDistMargin(bt,St,Zt,Ht)&&bt.children.sort(Jt)},A.prototype._allDistMargin=function(bt,St,Zt,Jt){bt.children.sort(Jt);for(var Ht=this.toBBox,oe=W(bt,0,St,Ht),q=W(bt,Zt-St,Zt,Ht),Q=Ut(oe)+Ut(q),ut=St;ut<Zt-St;ut++){var ot=bt.children[ut];et(oe,bt.leaf?Ht(ot):ot),Q+=Ut(oe)}for(var ht=Zt-St-1;ht>=St;ht--){var pt=bt.children[ht];et(q,bt.leaf?Ht(pt):pt),Q+=Ut(q)}return Q},A.prototype._adjustParentBBoxes=function(bt,St,Zt){for(var Jt=Zt;Jt>=0;Jt--)et(St[Jt],bt)},A.prototype._condense=function(bt){for(var St=bt.length-1,Zt=void 0;St>=0;St--)bt[St].children.length===0?St>0?(Zt=bt[St-1].children).splice(Zt.indexOf(bt[St]),1):this.clear():j(bt[St],this.toBBox)},A})}),Ns=rt(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.earthRadius=63710088e-1,l.factors={centimeters:l.earthRadius*100,centimetres:l.earthRadius*100,degrees:l.earthRadius/111325,feet:l.earthRadius*3.28084,inches:l.earthRadius*39.37,kilometers:l.earthRadius/1e3,kilometres:l.earthRadius/1e3,meters:l.earthRadius,metres:l.earthRadius,miles:l.earthRadius/1609.344,millimeters:l.earthRadius*1e3,millimetres:l.earthRadius*1e3,nauticalmiles:l.earthRadius/1852,radians:1,yards:l.earthRadius*1.0936},l.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/l.earthRadius,yards:1.0936133},l.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function p(ot,ht,pt){pt===void 0&&(pt={});var Dt={type:"Feature"};return(pt.id===0||pt.id)&&(Dt.id=pt.id),pt.bbox&&(Dt.bbox=pt.bbox),Dt.properties=ht||{},Dt.geometry=ot,Dt}l.feature=p;function y(ot,ht,pt){switch(pt===void 0&&(pt={}),ot){case"Point":return x(ht).geometry;case"LineString":return j(ht).geometry;case"Polygon":return A(ht).geometry;case"MultiPoint":return kt(ht).geometry;case"MultiLineString":return Tt(ht).geometry;case"MultiPolygon":return ie(ht).geometry;default:throw new Error(ot+" is invalid")}}l.geometry=y;function x(ot,ht,pt){if(pt===void 0&&(pt={}),!ot)throw new Error("coordinates is required");if(!Array.isArray(ot))throw new Error("coordinates must be an Array");if(ot.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!oe(ot[0])||!oe(ot[1]))throw new Error("coordinates must contain numbers");var Dt={type:"Point",coordinates:ot};return p(Dt,ht,pt)}l.point=x;function M(ot,ht,pt){return pt===void 0&&(pt={}),et(ot.map(function(Dt){return x(Dt,ht)}),pt)}l.points=M;function A(ot,ht,pt){pt===void 0&&(pt={});for(var Dt=0,Bt=ot;Dt<Bt.length;Dt++){var Ft=Bt[Dt];if(Ft.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Yt=0;Yt<Ft[Ft.length-1].length;Yt++)if(Ft[Ft.length-1][Yt]!==Ft[0][Yt])throw new Error("First and last Position are not equivalent.")}var Wt={type:"Polygon",coordinates:ot};return p(Wt,ht,pt)}l.polygon=A;function R(ot,ht,pt){return pt===void 0&&(pt={}),et(ot.map(function(Dt){return A(Dt,ht)}),pt)}l.polygons=R;function j(ot,ht,pt){if(pt===void 0&&(pt={}),ot.length<2)throw new Error("coordinates must be an array of two or more positions");var Dt={type:"LineString",coordinates:ot};return p(Dt,ht,pt)}l.lineString=j;function W(ot,ht,pt){return pt===void 0&&(pt={}),et(ot.map(function(Dt){return j(Dt,ht)}),pt)}l.lineStrings=W;function et(ot,ht){ht===void 0&&(ht={});var pt={type:"FeatureCollection"};return ht.id&&(pt.id=ht.id),ht.bbox&&(pt.bbox=ht.bbox),pt.features=ot,pt}l.featureCollection=et;function Tt(ot,ht,pt){pt===void 0&&(pt={});var Dt={type:"MultiLineString",coordinates:ot};return p(Dt,ht,pt)}l.multiLineString=Tt;function kt(ot,ht,pt){pt===void 0&&(pt={});var Dt={type:"MultiPoint",coordinates:ot};return p(Dt,ht,pt)}l.multiPoint=kt;function ie(ot,ht,pt){pt===void 0&&(pt={});var Dt={type:"MultiPolygon",coordinates:ot};return p(Dt,ht,pt)}l.multiPolygon=ie;function Ut(ot,ht,pt){pt===void 0&&(pt={});var Dt={type:"GeometryCollection",geometries:ot};return p(Dt,ht,pt)}l.geometryCollection=Ut;function jt(ot,ht){if(ht===void 0&&(ht=0),ht&&!(ht>=0))throw new Error("precision must be a positive number");var pt=Math.pow(10,ht||0);return Math.round(ot*pt)/pt}l.round=jt;function de(ot,ht){ht===void 0&&(ht="kilometers");var pt=l.factors[ht];if(!pt)throw new Error(ht+" units is invalid");return ot*pt}l.radiansToLength=de;function Fe(ot,ht){ht===void 0&&(ht="kilometers");var pt=l.factors[ht];if(!pt)throw new Error(ht+" units is invalid");return ot/pt}l.lengthToRadians=Fe;function Mi(ot,ht){return St(Fe(ot,ht))}l.lengthToDegrees=Mi;function bt(ot){var ht=ot%360;return ht<0&&(ht+=360),ht}l.bearingToAzimuth=bt;function St(ot){var ht=ot%(2*Math.PI);return ht*180/Math.PI}l.radiansToDegrees=St;function Zt(ot){var ht=ot%360;return ht*Math.PI/180}l.degreesToRadians=Zt;function Jt(ot,ht,pt){if(ht===void 0&&(ht="kilometers"),pt===void 0&&(pt="kilometers"),!(ot>=0))throw new Error("length must be a positive number");return de(Fe(ot,ht),pt)}l.convertLength=Jt;function Ht(ot,ht,pt){if(ht===void 0&&(ht="meters"),pt===void 0&&(pt="kilometers"),!(ot>=0))throw new Error("area must be a positive number");var Dt=l.areaFactors[ht];if(!Dt)throw new Error("invalid original units");var Bt=l.areaFactors[pt];if(!Bt)throw new Error("invalid final units");return ot/Dt*Bt}l.convertArea=Ht;function oe(ot){return!isNaN(ot)&&ot!==null&&!Array.isArray(ot)}l.isNumber=oe;function q(ot){return!!ot&&ot.constructor===Object}l.isObject=q;function Q(ot){if(!ot)throw new Error("bbox is required");if(!Array.isArray(ot))throw new Error("bbox must be an Array");if(ot.length!==4&&ot.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");ot.forEach(function(ht){if(!oe(ht))throw new Error("bbox must only contain numbers")})}l.validateBBox=Q;function ut(ot){if(!ot)throw new Error("id is required");if(["string","number"].indexOf(typeof ot)===-1)throw new Error("id must be a number or a string")}l.validateId=ut}),js=rt(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});var p=Ns();function y(St,Zt,Jt){if(St!==null)for(var Ht,oe,q,Q,ut,ot,ht,pt=0,Dt=0,Bt,Ft=St.type,Yt=Ft==="FeatureCollection",Wt=Ft==="Feature",we=Yt?St.features.length:1,d=0;d<we;d++){ht=Yt?St.features[d].geometry:Wt?St.geometry:St,Bt=ht?ht.type==="GeometryCollection":!1,ut=Bt?ht.geometries.length:1;for(var t=0;t<ut;t++){var i=0,a=0;if(Q=Bt?ht.geometries[t]:ht,Q!==null){ot=Q.coordinates;var h=Q.type;switch(pt=Jt&&(h==="Polygon"||h==="MultiPolygon")?1:0,h){case null:break;case"Point":if(Zt(ot,Dt,d,i,a)===!1)return!1;Dt++,i++;break;case"LineString":case"MultiPoint":for(Ht=0;Ht<ot.length;Ht++){if(Zt(ot[Ht],Dt,d,i,a)===!1)return!1;Dt++,h==="MultiPoint"&&i++}h==="LineString"&&i++;break;case"Polygon":case"MultiLineString":for(Ht=0;Ht<ot.length;Ht++){for(oe=0;oe<ot[Ht].length-pt;oe++){if(Zt(ot[Ht][oe],Dt,d,i,a)===!1)return!1;Dt++}h==="MultiLineString"&&i++,h==="Polygon"&&a++}h==="Polygon"&&i++;break;case"MultiPolygon":for(Ht=0;Ht<ot.length;Ht++){for(a=0,oe=0;oe<ot[Ht].length;oe++){for(q=0;q<ot[Ht][oe].length-pt;q++){if(Zt(ot[Ht][oe][q],Dt,d,i,a)===!1)return!1;Dt++}a++}i++}break;case"GeometryCollection":for(Ht=0;Ht<Q.geometries.length;Ht++)if(y(Q.geometries[Ht],Zt,Jt)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function x(St,Zt,Jt,Ht){var oe=Jt;return y(St,function(q,Q,ut,ot,ht){Q===0&&Jt===void 0?oe=q:oe=Zt(oe,q,Q,ut,ot,ht)},Ht),oe}function M(St,Zt){var Jt;switch(St.type){case"FeatureCollection":for(Jt=0;Jt<St.features.length&&Zt(St.features[Jt].properties,Jt)!==!1;Jt++);break;case"Feature":Zt(St.properties,0);break}}function A(St,Zt,Jt){var Ht=Jt;return M(St,function(oe,q){q===0&&Jt===void 0?Ht=oe:Ht=Zt(Ht,oe,q)}),Ht}function R(St,Zt){if(St.type==="Feature")Zt(St,0);else if(St.type==="FeatureCollection")for(var Jt=0;Jt<St.features.length&&Zt(St.features[Jt],Jt)!==!1;Jt++);}function j(St,Zt,Jt){var Ht=Jt;return R(St,function(oe,q){q===0&&Jt===void 0?Ht=oe:Ht=Zt(Ht,oe,q)}),Ht}function W(St){var Zt=[];return y(St,function(Jt){Zt.push(Jt)}),Zt}function et(St,Zt){var Jt,Ht,oe,q,Q,ut,ot,ht,pt,Dt,Bt=0,Ft=St.type==="FeatureCollection",Yt=St.type==="Feature",Wt=Ft?St.features.length:1;for(Jt=0;Jt<Wt;Jt++){for(ut=Ft?St.features[Jt].geometry:Yt?St.geometry:St,ht=Ft?St.features[Jt].properties:Yt?St.properties:{},pt=Ft?St.features[Jt].bbox:Yt?St.bbox:void 0,Dt=Ft?St.features[Jt].id:Yt?St.id:void 0,ot=ut?ut.type==="GeometryCollection":!1,Q=ot?ut.geometries.length:1,oe=0;oe<Q;oe++){if(q=ot?ut.geometries[oe]:ut,q===null){if(Zt(null,Bt,ht,pt,Dt)===!1)return!1;continue}switch(q.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(Zt(q,Bt,ht,pt,Dt)===!1)return!1;break}case"GeometryCollection":{for(Ht=0;Ht<q.geometries.length;Ht++)if(Zt(q.geometries[Ht],Bt,ht,pt,Dt)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Bt++}}function Tt(St,Zt,Jt){var Ht=Jt;return et(St,function(oe,q,Q,ut,ot){q===0&&Jt===void 0?Ht=oe:Ht=Zt(Ht,oe,q,Q,ut,ot)}),Ht}function kt(St,Zt){et(St,function(Jt,Ht,oe,q,Q){var ut=Jt===null?null:Jt.type;switch(ut){case null:case"Point":case"LineString":case"Polygon":return Zt(p.feature(Jt,oe,{bbox:q,id:Q}),Ht,0)===!1?!1:void 0}var ot;switch(ut){case"MultiPoint":ot="Point";break;case"MultiLineString":ot="LineString";break;case"MultiPolygon":ot="Polygon";break}for(var ht=0;ht<Jt.coordinates.length;ht++){var pt=Jt.coordinates[ht],Dt={type:ot,coordinates:pt};if(Zt(p.feature(Dt,oe),Ht,ht)===!1)return!1}})}function ie(St,Zt,Jt){var Ht=Jt;return kt(St,function(oe,q,Q){q===0&&Q===0&&Jt===void 0?Ht=oe:Ht=Zt(Ht,oe,q,Q)}),Ht}function Ut(St,Zt){kt(St,function(Jt,Ht,oe){var q=0;if(Jt.geometry){var Q=Jt.geometry.type;if(!(Q==="Point"||Q==="MultiPoint")){var ut,ot=0,ht=0,pt=0;if(y(Jt,function(Dt,Bt,Ft,Yt,Wt){if(ut===void 0||Ht>ot||Yt>ht||Wt>pt){ut=Dt,ot=Ht,ht=Yt,pt=Wt,q=0;return}var we=p.lineString([ut,Dt],Jt.properties);if(Zt(we,Ht,oe,Wt,q)===!1)return!1;q++,ut=Dt})===!1)return!1}}})}function jt(St,Zt,Jt){var Ht=Jt,oe=!1;return Ut(St,function(q,Q,ut,ot,ht){oe===!1&&Jt===void 0?Ht=q:Ht=Zt(Ht,q,Q,ut,ot,ht),oe=!0}),Ht}function de(St,Zt){if(!St)throw new Error("geojson is required");kt(St,function(Jt,Ht,oe){if(Jt.geometry!==null){var q=Jt.geometry.type,Q=Jt.geometry.coordinates;switch(q){case"LineString":if(Zt(Jt,Ht,oe,0,0)===!1)return!1;break;case"Polygon":for(var ut=0;ut<Q.length;ut++)if(Zt(p.lineString(Q[ut],Jt.properties),Ht,oe,ut)===!1)return!1;break}}})}function Fe(St,Zt,Jt){var Ht=Jt;return de(St,function(oe,q,Q,ut){q===0&&Jt===void 0?Ht=oe:Ht=Zt(Ht,oe,q,Q,ut)}),Ht}function Mi(St,Zt){if(Zt=Zt||{},!p.isObject(Zt))throw new Error("options is invalid");var Jt=Zt.featureIndex||0,Ht=Zt.multiFeatureIndex||0,oe=Zt.geometryIndex||0,q=Zt.segmentIndex||0,Q=Zt.properties,ut;switch(St.type){case"FeatureCollection":Jt<0&&(Jt=St.features.length+Jt),Q=Q||St.features[Jt].properties,ut=St.features[Jt].geometry;break;case"Feature":Q=Q||St.properties,ut=St.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":ut=St;break;default:throw new Error("geojson is invalid")}if(ut===null)return null;var ot=ut.coordinates;switch(ut.type){case"Point":case"MultiPoint":return null;case"LineString":return q<0&&(q=ot.length+q-1),p.lineString([ot[q],ot[q+1]],Q,Zt);case"Polygon":return oe<0&&(oe=ot.length+oe),q<0&&(q=ot[oe].length+q-1),p.lineString([ot[oe][q],ot[oe][q+1]],Q,Zt);case"MultiLineString":return Ht<0&&(Ht=ot.length+Ht),q<0&&(q=ot[Ht].length+q-1),p.lineString([ot[Ht][q],ot[Ht][q+1]],Q,Zt);case"MultiPolygon":return Ht<0&&(Ht=ot.length+Ht),oe<0&&(oe=ot[Ht].length+oe),q<0&&(q=ot[Ht][oe].length-q-1),p.lineString([ot[Ht][oe][q],ot[Ht][oe][q+1]],Q,Zt)}throw new Error("geojson is invalid")}function bt(St,Zt){if(Zt=Zt||{},!p.isObject(Zt))throw new Error("options is invalid");var Jt=Zt.featureIndex||0,Ht=Zt.multiFeatureIndex||0,oe=Zt.geometryIndex||0,q=Zt.coordIndex||0,Q=Zt.properties,ut;switch(St.type){case"FeatureCollection":Jt<0&&(Jt=St.features.length+Jt),Q=Q||St.features[Jt].properties,ut=St.features[Jt].geometry;break;case"Feature":Q=Q||St.properties,ut=St.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":ut=St;break;default:throw new Error("geojson is invalid")}if(ut===null)return null;var ot=ut.coordinates;switch(ut.type){case"Point":return p.point(ot,Q,Zt);case"MultiPoint":return Ht<0&&(Ht=ot.length+Ht),p.point(ot[Ht],Q,Zt);case"LineString":return q<0&&(q=ot.length+q),p.point(ot[q],Q,Zt);case"Polygon":return oe<0&&(oe=ot.length+oe),q<0&&(q=ot[oe].length+q),p.point(ot[oe][q],Q,Zt);case"MultiLineString":return Ht<0&&(Ht=ot.length+Ht),q<0&&(q=ot[Ht].length+q),p.point(ot[Ht][q],Q,Zt);case"MultiPolygon":return Ht<0&&(Ht=ot.length+Ht),oe<0&&(oe=ot[Ht].length+oe),q<0&&(q=ot[Ht][oe].length-q),p.point(ot[Ht][oe][q],Q,Zt)}throw new Error("geojson is invalid")}l.coordAll=W,l.coordEach=y,l.coordReduce=x,l.featureEach=R,l.featureReduce=j,l.findPoint=bt,l.findSegment=Mi,l.flattenEach=kt,l.flattenReduce=ie,l.geomEach=et,l.geomReduce=Tt,l.lineEach=de,l.lineReduce=Fe,l.propEach=M,l.propReduce=A,l.segmentEach=Ut,l.segmentReduce=jt}),Gs=rt(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});var p=js();function y(x){var M=[1/0,1/0,-1/0,-1/0];return p.coordEach(x,function(A){M[0]>A[0]&&(M[0]=A[0]),M[1]>A[1]&&(M[1]=A[1]),M[2]<A[0]&&(M[2]=A[0]),M[3]<A[1]&&(M[3]=A[1])}),M}y.default=y,l.default=y}),hi=rt((l,p)=>{var y=ea(),x=Ns(),M=js(),A=Gs().default,R=M.featureEach,j=M.coordEach,W=x.polygon,et=x.featureCollection;function Tt(kt){var ie=new y(kt);return ie.insert=function(Ut){if(Ut.type!=="Feature")throw new Error("invalid feature");return Ut.bbox=Ut.bbox?Ut.bbox:A(Ut),y.prototype.insert.call(this,Ut)},ie.load=function(Ut){var jt=[];return Array.isArray(Ut)?Ut.forEach(function(de){if(de.type!=="Feature")throw new Error("invalid features");de.bbox=de.bbox?de.bbox:A(de),jt.push(de)}):R(Ut,function(de){if(de.type!=="Feature")throw new Error("invalid features");de.bbox=de.bbox?de.bbox:A(de),jt.push(de)}),y.prototype.load.call(this,jt)},ie.remove=function(Ut,jt){if(Ut.type!=="Feature")throw new Error("invalid feature");return Ut.bbox=Ut.bbox?Ut.bbox:A(Ut),y.prototype.remove.call(this,Ut,jt)},ie.clear=function(){return y.prototype.clear.call(this)},ie.search=function(Ut){var jt=y.prototype.search.call(this,this.toBBox(Ut));return et(jt)},ie.collides=function(Ut){return y.prototype.collides.call(this,this.toBBox(Ut))},ie.all=function(){var Ut=y.prototype.all.call(this);return et(Ut)},ie.toJSON=function(){return y.prototype.toJSON.call(this)},ie.fromJSON=function(Ut){return y.prototype.fromJSON.call(this,Ut)},ie.toBBox=function(Ut){var jt;if(Ut.bbox)jt=Ut.bbox;else if(Array.isArray(Ut)&&Ut.length===4)jt=Ut;else if(Array.isArray(Ut)&&Ut.length===6)jt=[Ut[0],Ut[1],Ut[3],Ut[4]];else if(Ut.type==="Feature")jt=A(Ut);else if(Ut.type==="FeatureCollection")jt=A(Ut);else throw new Error("invalid geojson");return{minX:jt[0],minY:jt[1],maxX:jt[2],maxY:jt[3]}},ie}p.exports=Tt,p.exports.default=Tt});Array.prototype.findIndex=Array.prototype.findIndex||function(l){if(this===null)throw new TypeError("Array.prototype.findIndex called on null or undefined");if(typeof l!="function")throw new TypeError("callback must be a function");for(var p=Object(this),y=p.length>>>0,x=arguments[1],M=0;M<y;M++)if(l.call(x,p[M],M,p))return M;return-1},Array.prototype.find=Array.prototype.find||function(l){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof l!="function")throw new TypeError("callback must be a function");for(var p=Object(this),y=p.length>>>0,x=arguments[1],M=0;M<y;M++){var A=p[M];if(l.call(x,A,M,p))return A}},typeof Object.assign!="function"&&(Object.assign=function(l){"use strict";if(l==null)throw new TypeError("Cannot convert undefined or null to object");l=Object(l);for(var p=1;p<arguments.length;p++){var y=arguments[p];if(y!=null)for(var x in y)Object.prototype.hasOwnProperty.call(y,x)&&(l[x]=y[x])}return l}),function(l){l.forEach(function(p){p.hasOwnProperty("remove")||Object.defineProperty(p,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})}([Element.prototype,CharacterData.prototype,DocumentType.prototype]),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(l,p){if(this==null)throw new TypeError('"this" is null or not defined');var y=Object(this),x=y.length>>>0;if(x===0)return!1;var M=p|0,A=Math.max(M>=0?M:x-Math.abs(M),0);function R(j,W){return j===W||typeof j=="number"&&typeof W=="number"&&isNaN(j)&&isNaN(W)}for(;A<x;){if(R(y[A],l))return!0;A++}return!1}});var Ji={name:"@geoman-io/leaflet-geoman-free",version:"2.18.3",description:"A Leaflet Plugin For Editing Geometry Layers in Leaflet 1.0",keywords:["leaflet","geoman","polygon management","geometry editing","map data","map overlay","polygon","geojson","leaflet-draw","data-field-geojson","ui-leaflet-draw"],files:["dist"],main:"dist/leaflet-geoman.js",types:"dist/leaflet-geoman.d.ts",dependencies:{"@turf/boolean-contains":"^6.5.0","@turf/kinks":"^6.5.0","@turf/line-intersect":"^6.5.0","@turf/line-split":"^6.5.0",lodash:"4.17.21","polyclip-ts":"^0.16.5"},devDependencies:{"@types/leaflet":"^1.9.12","cross-env":"^7.0.3",cypress:"^13.11.0",esbuild:"^0.20.2",eslint:"8.56.0","eslint-config-airbnb-base":"15.0.0","eslint-config-prettier":"9.1.0","eslint-plugin-cypress":"2.15.1","eslint-plugin-import":"2.29.1",husky:"^9.0.11",leaflet:"1.9.3","lint-staged":"^15.2.5",prettier:"3.2.4","prosthetic-hand":"1.3.1","ts-node":"^10.9.2"},peerDependencies:{leaflet:"^1.2.0"},scripts:{start:"pnpm run dev",dev:"cross-env DEV=true ts-node bundle.mjs",build:"ts-node bundle.mjs",test:"cypress run --browser chrome",cypress:"cypress open",prepare:"pnpm run build && husky","eslint-check":"eslint --print-config . | eslint-config-prettier-check",eslint:'eslint "{src,demo}/**/*.js" --fix ',prettier:'prettier --write "{src,demo}/**/*.{js,css}" --log-level=warn',lint:"pnpm run eslint && pnpm run prettier"},repository:{type:"git",url:"git://github.com/geoman-io/leaflet-geoman.git"},author:{name:"Geoman.io",email:"sales@geoman.io",url:"http://geoman.io"},license:"MIT",bugs:{url:"https://github.com/geoman-io/leaflet-geoman/issues"},homepage:"https://geoman.io",prettier:{trailingComma:"es5",tabWidth:2,semi:!0,singleQuote:!0},"lint-staged":{"*.js":'eslint "{src,demo}/**/*.js" --fix',"*.{js,css,md}":'prettier --write "{src,demo}/**/*.{js,css}"'}},Zs=se(Sn()),Ta={tooltips:{placeMarker:"Click to place marker",firstVertex:"Click to place first vertex",continueLine:"Click to continue drawing",finishLine:"Click any existing marker to finish",finishPoly:"Click first marker to finish",finishRect:"Click to finish",startCircle:"Click to place circle center",finishCircle:"Click to finish circle",placeCircleMarker:"Click to place circle marker",placeText:"Click to place text",selectFirstLayerFor:"Select first layer for {action}",selectSecondLayerFor:"Select second layer for {action}"},actions:{finish:"Finish",cancel:"Cancel",removeLastVertex:"Remove Last Vertex"},buttonTitles:{drawMarkerButton:"Draw Marker",drawPolyButton:"Draw Polygons",drawLineButton:"Draw Polyline",drawCircleButton:"Draw Circle",drawRectButton:"Draw Rectangle",editButton:"Edit Layers",dragButton:"Drag Layers",cutButton:"Cut Layers",deleteButton:"Remove Layers",drawCircleMarkerButton:"Draw Circle Marker",snappingButton:"Snap dragged marker to other layers and vertices",pinningButton:"Pin shared vertices together",rotateButton:"Rotate Layers",drawTextButton:"Draw Text",scaleButton:"Scale Layers",autoTracingButton:"Auto trace Line",snapGuidesButton:"Show SnapGuides",unionButton:"Union layers",differenceButton:"Subtract layers"},measurements:{totalLength:"Length",segmentLength:"Segment length",area:"Area",radius:"Radius",perimeter:"Perimeter",height:"Height",width:"Width",coordinates:"Position",coordinatesMarker:"Position Marker"}},dn={tooltips:{placeMarker:"Platziere den Marker mit Klick",firstVertex:"Platziere den ersten Marker mit Klick",continueLine:"Klicke, um weiter zu zeichnen",finishLine:"Beende mit Klick auf existierenden Marker",finishPoly:"Beende mit Klick auf ersten Marker",finishRect:"Beende mit Klick",startCircle:"Platziere das Kreiszentrum mit Klick",finishCircle:"Beende den Kreis mit Klick",placeCircleMarker:"Platziere den Kreismarker mit Klick",placeText:"Platziere den Text mit Klick"},actions:{finish:"Beenden",cancel:"Abbrechen",removeLastVertex:"Letzten Vertex l\xF6schen"},buttonTitles:{drawMarkerButton:"Marker zeichnen",drawPolyButton:"Polygon zeichnen",drawLineButton:"Polyline zeichnen",drawCircleButton:"Kreis zeichnen",drawRectButton:"Rechteck zeichnen",editButton:"Layer editieren",dragButton:"Layer bewegen",cutButton:"Layer schneiden",deleteButton:"Layer l\xF6schen",drawCircleMarkerButton:"Kreismarker zeichnen",snappingButton:"Bewegter Layer an andere Layer oder Vertexe einhacken",pinningButton:"Vertexe an der gleichen Position verkn\xFCpfen",rotateButton:"Layer drehen",drawTextButton:"Text zeichnen",scaleButton:"Layer skalieren",autoTracingButton:"Linie automatisch nachzeichen"},measurements:{totalLength:"L\xE4nge",segmentLength:"Segment L\xE4nge",area:"Fl\xE4che",radius:"Radius",perimeter:"Umfang",height:"H\xF6he",width:"Breite",coordinates:"Position",coordinatesMarker:"Position Marker"}},Oo={tooltips:{placeMarker:"Clicca per posizionare un Marker",firstVertex:"Clicca per posizionare il primo vertice",continueLine:"Clicca per continuare a disegnare",finishLine:"Clicca qualsiasi marker esistente per terminare",finishPoly:"Clicca il primo marker per terminare",finishRect:"Clicca per terminare",startCircle:"Clicca per posizionare il punto centrale del cerchio",finishCircle:"Clicca per terminare il cerchio",placeCircleMarker:"Clicca per posizionare un Marker del cherchio"},actions:{finish:"Termina",cancel:"Annulla",removeLastVertex:"Rimuovi l'ultimo vertice"},buttonTitles:{drawMarkerButton:"Disegna Marker",drawPolyButton:"Disegna Poligoni",drawLineButton:"Disegna Polilinea",drawCircleButton:"Disegna Cerchio",drawRectButton:"Disegna Rettangolo",editButton:"Modifica Livelli",dragButton:"Sposta Livelli",cutButton:"Ritaglia Livelli",deleteButton:"Elimina Livelli",drawCircleMarkerButton:"Disegna Marker del Cerchio",snappingButton:"Snap ha trascinato il pennarello su altri strati e vertici",pinningButton:"Pin condiviso vertici insieme",rotateButton:"Ruota livello"}},Fo={tooltips:{placeMarker:"Klik untuk menempatkan marker",firstVertex:"Klik untuk menempatkan vertex pertama",continueLine:"Klik untuk meneruskan digitasi",finishLine:"Klik pada sembarang marker yang ada untuk mengakhiri",finishPoly:"Klik marker pertama untuk mengakhiri",finishRect:"Klik untuk mengakhiri",startCircle:"Klik untuk menempatkan titik pusat lingkaran",finishCircle:"Klik untuk mengakhiri lingkaran",placeCircleMarker:"Klik untuk menempatkan penanda lingkarann"},actions:{finish:"Selesai",cancel:"Batal",removeLastVertex:"Hilangkan Vertex Terakhir"},buttonTitles:{drawMarkerButton:"Digitasi Marker",drawPolyButton:"Digitasi Polygon",drawLineButton:"Digitasi Polyline",drawCircleButton:"Digitasi Lingkaran",drawRectButton:"Digitasi Segi Empat",editButton:"Edit Layer",dragButton:"Geser Layer",cutButton:"Potong Layer",deleteButton:"Hilangkan Layer",drawCircleMarkerButton:"Digitasi Penanda Lingkaran",snappingButton:"Jepretkan penanda yang ditarik ke lapisan dan simpul lain",pinningButton:"Sematkan simpul bersama bersama",rotateButton:"Putar lapisan"}},xs={tooltips:{placeMarker:"Adaug\u0103 un punct",firstVertex:"Apas\u0103 aici pentru a ad\u0103uga primul Vertex",continueLine:"Apas\u0103 aici pentru a continua desenul",finishLine:"Apas\u0103 pe orice obiect pentru a finisa desenul",finishPoly:"Apas\u0103 pe primul obiect pentru a finisa",finishRect:"Apas\u0103 pentru a finisa",startCircle:"Apas\u0103 pentru a desena un cerc",finishCircle:"Apas\u0103 pentru a finisa un cerc",placeCircleMarker:"Adaug\u0103 un punct"},actions:{finish:"Termin\u0103",cancel:"Anuleaz\u0103",removeLastVertex:"\u0218terge ultimul Vertex"},buttonTitles:{drawMarkerButton:"Adaug\u0103 o bulin\u0103",drawPolyButton:"Deseneaz\u0103 un poligon",drawLineButton:"Deseneaz\u0103 o linie",drawCircleButton:"Deseneaz\u0103 un cerc",drawRectButton:"Deseneaz\u0103 un dreptunghi",editButton:"Editeaz\u0103 straturile",dragButton:"Mut\u0103 straturile",cutButton:"Taie straturile",deleteButton:"\u0218terge straturile",drawCircleMarkerButton:"Deseneaz\u0103 marcatorul cercului",snappingButton:"Fixa\u021Bi marcatorul glisat pe alte straturi \u0219i v\xE2rfuri",pinningButton:"Fixa\u021Bi v\xE2rfurile partajate \xEEmpreun\u0103",rotateButton:"Roti\u021Bi stratul"}},er={tooltips:{placeMarker:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u043D\u0430\u043D\u0435\u0441\u0442\u0438 \u043C\u0430\u0440\u043A\u0435\u0440",firstVertex:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u043D\u0430\u043D\u0435\u0441\u0442\u0438 \u043F\u0435\u0440\u0432\u044B\u0439 \u043E\u0431\u044A\u0435\u043A\u0442",continueLine:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C \u0440\u0438\u0441\u043E\u0432\u0430\u043D\u0438\u0435",finishLine:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435 \u043B\u044E\u0431\u043E\u0439 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0439 \u043C\u0430\u0440\u043A\u0435\u0440 \u0434\u043B\u044F \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u044F",finishPoly:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043F\u0435\u0440\u0432\u0443\u044E \u0442\u043E\u0447\u043A\u0443, \u0447\u0442\u043E\u0431\u044B \u0437\u0430\u043A\u043E\u043D\u0447\u0438\u0442\u044C",finishRect:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0437\u0430\u043A\u043E\u043D\u0447\u0438\u0442\u044C",startCircle:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0446\u0435\u043D\u0442\u0440 \u043A\u0440\u0443\u0433\u0430",finishCircle:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0437\u0430\u0434\u0430\u0442\u044C \u0440\u0430\u0434\u0438\u0443\u0441",placeCircleMarker:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u043D\u0430\u043D\u0435\u0441\u0442\u0438 \u043A\u0440\u0443\u0433\u043E\u0432\u043E\u0439 \u043C\u0430\u0440\u043A\u0435\u0440"},actions:{finish:"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C",cancel:"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C",removeLastVertex:"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C \u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0435\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435"},buttonTitles:{drawMarkerButton:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043C\u0430\u0440\u043A\u0435\u0440",drawPolyButton:"\u0420\u0438\u0441\u043E\u0432\u0430\u0442\u044C \u043F\u043E\u043B\u0438\u0433\u043E\u043D",drawLineButton:"\u0420\u0438\u0441\u043E\u0432\u0430\u0442\u044C \u043A\u0440\u0438\u0432\u0443\u044E",drawCircleButton:"\u0420\u0438\u0441\u043E\u0432\u0430\u0442\u044C \u043A\u0440\u0443\u0433",drawRectButton:"\u0420\u0438\u0441\u043E\u0432\u0430\u0442\u044C \u043F\u0440\u044F\u043C\u043E\u0443\u0433\u043E\u043B\u044C\u043D\u0438\u043A",editButton:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u043B\u043E\u0439",dragButton:"\u041F\u0435\u0440\u0435\u043D\u0435\u0441\u0442\u0438 \u0441\u043B\u043E\u0439",cutButton:"\u0412\u044B\u0440\u0435\u0437\u0430\u0442\u044C \u0441\u043B\u043E\u0439",deleteButton:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0441\u043B\u043E\u0439",drawCircleMarkerButton:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u0440\u0443\u0433\u043E\u0432\u043E\u0439 \u043C\u0430\u0440\u043A\u0435\u0440",snappingButton:"\u041F\u0440\u0438\u0432\u044F\u0437\u0430\u0442\u044C \u043F\u0435\u0440\u0435\u0442\u0430\u0441\u043A\u0438\u0432\u0430\u0435\u043C\u044B\u0439 \u043C\u0430\u0440\u043A\u0435\u0440 \u043A \u0434\u0440\u0443\u0433\u0438\u043C \u0441\u043B\u043E\u044F\u043C \u0438 \u0432\u0435\u0440\u0448\u0438\u043D\u0430\u043C",pinningButton:"\u0421\u0432\u044F\u0437\u0430\u0442\u044C \u043E\u0431\u0449\u0438\u0435 \u0442\u043E\u0447\u043A\u0438 \u0432\u043C\u0435\u0441\u0442\u0435",rotateButton:"\u041F\u043E\u0432\u043E\u0440\u043E\u0442 \u0441\u043B\u043E\u044F"}},os={tooltips:{placeMarker:"Presiona para colocar un marcador",firstVertex:"Presiona para colocar el primer v\xE9rtice",continueLine:"Presiona para continuar dibujando",finishLine:"Presiona cualquier marcador existente para finalizar",finishPoly:"Presiona el primer marcador para finalizar",finishRect:"Presiona para finalizar",startCircle:"Presiona para colocar el centro del c\xEDrculo",finishCircle:"Presiona para finalizar el c\xEDrculo",placeCircleMarker:"Presiona para colocar un marcador de c\xEDrculo"},actions:{finish:"Finalizar",cancel:"Cancelar",removeLastVertex:"Eliminar \xFAltimo v\xE9rtice"},buttonTitles:{drawMarkerButton:"Dibujar Marcador",drawPolyButton:"Dibujar Pol\xEDgono",drawLineButton:"Dibujar L\xEDnea",drawCircleButton:"Dibujar C\xEDrculo",drawRectButton:"Dibujar Rect\xE1ngulo",editButton:"Editar Capas",dragButton:"Arrastrar Capas",cutButton:"Cortar Capas",deleteButton:"Eliminar Capas",drawCircleMarkerButton:"Dibujar Marcador de C\xEDrculo",snappingButton:"El marcador de Snap arrastrado a otras capas y v\xE9rtices",pinningButton:"Fijar juntos los v\xE9rtices compartidos",rotateButton:"Rotar capa"}},Vs={tooltips:{placeMarker:"Klik om een marker te plaatsen",firstVertex:"Klik om het eerste punt te plaatsen",continueLine:"Klik om te blijven tekenen",finishLine:"Klik op een bestaand punt om te be\xEBindigen",finishPoly:"Klik op het eerst punt om te be\xEBindigen",finishRect:"Klik om te be\xEBindigen",startCircle:"Klik om het middelpunt te plaatsen",finishCircle:"Klik om de cirkel te be\xEBindigen",placeCircleMarker:"Klik om een marker te plaatsen"},actions:{finish:"Bewaar",cancel:"Annuleer",removeLastVertex:"Verwijder laatste punt"},buttonTitles:{drawMarkerButton:"Plaats Marker",drawPolyButton:"Teken een vlak",drawLineButton:"Teken een lijn",drawCircleButton:"Teken een cirkel",drawRectButton:"Teken een vierkant",editButton:"Bewerk",dragButton:"Verplaats",cutButton:"Knip",deleteButton:"Verwijder",drawCircleMarkerButton:"Plaats Marker",snappingButton:"Snap gesleepte marker naar andere lagen en hoekpunten",pinningButton:"Speld gedeelde hoekpunten samen",rotateButton:"Laag roteren"}},Xr={tooltips:{placeMarker:"Cliquez pour placer un marqueur",firstVertex:"Cliquez pour placer le premier sommet",continueLine:"Cliquez pour continuer \xE0 dessiner",finishLine:"Cliquez sur n'importe quel marqueur pour terminer",finishPoly:"Cliquez sur le premier marqueur pour terminer",finishRect:"Cliquez pour terminer",startCircle:"Cliquez pour placer le centre du cercle",finishCircle:"Cliquez pour finir le cercle",placeCircleMarker:"Cliquez pour placer le marqueur circulaire"},actions:{finish:"Terminer",cancel:"Annuler",removeLastVertex:"Retirer le dernier sommet"},buttonTitles:{drawMarkerButton:"Placer des marqueurs",drawPolyButton:"Dessiner des polygones",drawLineButton:"Dessiner des polylignes",drawCircleButton:"Dessiner un cercle",drawRectButton:"Dessiner un rectangle",editButton:"\xC9diter des calques",dragButton:"D\xE9placer des calques",cutButton:"Couper des calques",deleteButton:"Supprimer des calques",drawCircleMarkerButton:"Dessiner un marqueur circulaire",snappingButton:"Glisser le marqueur vers d'autres couches et sommets",pinningButton:"\xC9pingler ensemble les sommets partag\xE9s",rotateButton:"Tourner des calques"}},ci={tooltips:{placeMarker:"\u5355\u51FB\u653E\u7F6E\u6807\u8BB0",firstVertex:"\u5355\u51FB\u653E\u7F6E\u9996\u4E2A\u9876\u70B9",continueLine:"\u5355\u51FB\u7EE7\u7EED\u7ED8\u5236",finishLine:"\u5355\u51FB\u4EFB\u4F55\u5B58\u5728\u7684\u6807\u8BB0\u4EE5\u5B8C\u6210",finishPoly:"\u5355\u51FB\u7B2C\u4E00\u4E2A\u6807\u8BB0\u4EE5\u5B8C\u6210",finishRect:"\u5355\u51FB\u5B8C\u6210",startCircle:"\u5355\u51FB\u653E\u7F6E\u5706\u5FC3",finishCircle:"\u5355\u51FB\u5B8C\u6210\u5706\u5F62",placeCircleMarker:"\u70B9\u51FB\u653E\u7F6E\u5706\u5F62\u6807\u8BB0"},actions:{finish:"\u5B8C\u6210",cancel:"\u53D6\u6D88",removeLastVertex:"\u79FB\u9664\u6700\u540E\u7684\u9876\u70B9"},buttonTitles:{drawMarkerButton:"\u7ED8\u5236\u6807\u8BB0",drawPolyButton:"\u7ED8\u5236\u591A\u8FB9\u5F62",drawLineButton:"\u7ED8\u5236\u7EBF\u6BB5",drawCircleButton:"\u7ED8\u5236\u5706\u5F62",drawRectButton:"\u7ED8\u5236\u957F\u65B9\u5F62",editButton:"\u7F16\u8F91\u56FE\u5C42",dragButton:"\u62D6\u62FD\u56FE\u5C42",cutButton:"\u526A\u5207\u56FE\u5C42",deleteButton:"\u5220\u9664\u56FE\u5C42",drawCircleMarkerButton:"\u753B\u5706\u5708\u6807\u8BB0",snappingButton:"\u5C06\u62D6\u52A8\u7684\u6807\u8BB0\u6355\u6349\u5230\u5176\u4ED6\u56FE\u5C42\u548C\u9876\u70B9",pinningButton:"\u5C06\u5171\u4EAB\u9876\u70B9\u56FA\u5B9A\u5728\u4E00\u8D77",rotateButton:"\u65CB\u8F6C\u56FE\u5C42"}},fn={tooltips:{placeMarker:"\u55AE\u64CA\u653E\u7F6E\u6A19\u8A18",firstVertex:"\u55AE\u64CA\u653E\u7F6E\u7B2C\u4E00\u500B\u9802\u9EDE",continueLine:"\u55AE\u64CA\u7E7C\u7E8C\u7E6A\u88FD",finishLine:"\u55AE\u64CA\u4EFB\u4F55\u5B58\u5728\u7684\u6A19\u8A18\u4EE5\u5B8C\u6210",finishPoly:"\u55AE\u64CA\u7B2C\u4E00\u500B\u6A19\u8A18\u4EE5\u5B8C\u6210",finishRect:"\u55AE\u64CA\u5B8C\u6210",startCircle:"\u55AE\u64CA\u653E\u7F6E\u5713\u5FC3",finishCircle:"\u55AE\u64CA\u5B8C\u6210\u5713\u5F62",placeCircleMarker:"\u9EDE\u64CA\u653E\u7F6E\u5713\u5F62\u6A19\u8A18"},actions:{finish:"\u5B8C\u6210",cancel:"\u53D6\u6D88",removeLastVertex:"\u79FB\u9664\u6700\u5F8C\u4E00\u500B\u9802\u9EDE"},buttonTitles:{drawMarkerButton:"\u653E\u7F6E\u6A19\u8A18",drawPolyButton:"\u7E6A\u88FD\u591A\u908A\u5F62",drawLineButton:"\u7E6A\u88FD\u7DDA\u6BB5",drawCircleButton:"\u7E6A\u88FD\u5713\u5F62",drawRectButton:"\u7E6A\u88FD\u65B9\u5F62",editButton:"\u7DE8\u8F2F\u5716\u5F62",dragButton:"\u79FB\u52D5\u5716\u5F62",cutButton:"\u88C1\u5207\u5716\u5F62",deleteButton:"\u522A\u9664\u5716\u5F62",drawCircleMarkerButton:"\u756B\u5713\u5708\u6A19\u8A18",snappingButton:"\u5C07\u62D6\u52D5\u7684\u6A19\u8A18\u5C0D\u9F4A\u5230\u5176\u4ED6\u5716\u5C64\u548C\u9802\u9EDE",pinningButton:"\u5C07\u5171\u4EAB\u9802\u9EDE\u56FA\u5B9A\u5728\u4E00\u8D77",rotateButton:"\u65CB\u8F49\u5716\u5F62"}},qn={tooltips:{placeMarker:"Clique para posicionar o marcador",firstVertex:"Clique para posicionar o primeiro v\xE9rtice",continueLine:"Clique para continuar desenhando",finishLine:"Clique em qualquer marcador existente para finalizar",finishPoly:"Clique no primeiro marcador para finalizar",finishRect:"Clique para finalizar",startCircle:"Clique para posicionar o centro do c\xEDrculo",finishCircle:"Clique para finalizar o c\xEDrculo",placeCircleMarker:"Clique para posicionar o marcador circular",placeText:"Clique para inserir texto"},actions:{finish:"Finalizar",cancel:"Cancelar",removeLastVertex:"Remover \xFAltimo v\xE9rtice"},buttonTitles:{drawMarkerButton:"Desenhar Marcador",drawPolyButton:"Desenhar Pol\xEDgonos",drawLineButton:"Desenhar Linha Poligonal",drawCircleButton:"Desenhar C\xEDrculo",drawRectButton:"Desenhar Ret\xE2ngulo",editButton:"Editar Camadas",dragButton:"Arrastar Camadas",cutButton:"Recortar Camadas",deleteButton:"Remover Camadas",drawCircleMarkerButton:"Desenhar Marcador de C\xEDrculo",snappingButton:"Ajustar marcador arrastado a outras camadas e v\xE9rtices",pinningButton:"Unir v\xE9rtices compartilhados",rotateButton:"Rotacionar Camadas",drawTextButton:"Desenhar Texto",scaleButton:"Redimensionar Camadas",autoTracingButton:"Tra\xE7ado Autom\xE1tico de Linha"},measurements:{totalLength:"Comprimento",segmentLength:"Comprimento do Segmento",area:"\xC1rea",radius:"Raio",perimeter:"Per\xEDmetro",height:"Altura",width:"Largura",coordinates:"Posi\xE7\xE3o",coordinatesMarker:"Marcador de Posi\xE7\xE3o"}},as={tooltips:{placeMarker:"Clique para colocar marcador",firstVertex:"Clique para colocar primeiro v\xE9rtice",continueLine:"Clique para continuar a desenhar",finishLine:"Clique num marcador existente para terminar",finishPoly:"Clique no primeiro marcador para terminar",finishRect:"Clique para terminar",startCircle:"Clique para colocar o centro do c\xEDrculo",finishCircle:"Clique para terminar o c\xEDrculo",placeCircleMarker:"Clique para colocar marcador de c\xEDrculo",placeText:"Clique para colocar texto"},actions:{finish:"Terminar",cancel:"Cancelar",removeLastVertex:"Remover \xDAltimo V\xE9rtice"},buttonTitles:{drawMarkerButton:"Desenhar Marcador",drawPolyButton:"Desenhar Pol\xEDgonos",drawLineButton:"Desenhar Polilinha",drawCircleButton:"Desenhar C\xEDrculo",drawRectButton:"Desenhar Ret\xE2ngulo",editButton:"Editar Camadas",dragButton:"Arrastar Camadas",cutButton:"Cortar Camadas",deleteButton:"Remover Camadas",drawCircleMarkerButton:"Desenhar Marcador de C\xEDrculo",snappingButton:"Ajustar marcador arrastado a outras camadas e v\xE9rtices",pinningButton:"Unir v\xE9rtices partilhados",rotateButton:"Rodar Camadas",drawTextButton:"Desenhar Texto",scaleButton:"Escalar Camadas",autoTracingButton:"Tra\xE7ado Autom\xE1tico de Linha"},measurements:{totalLength:"Comprimento",segmentLength:"Comprimento do Segmento",area:"\xC1rea",radius:"Raio",perimeter:"Per\xEDmetro",height:"Altura",width:"Largura",coordinates:"Posi\xE7\xE3o",coordinatesMarker:"Marcador de Posi\xE7\xE3o"}},No={tooltips:{placeMarker:"Kliknij, aby umie\u015Bci\u0107 znacznik",firstVertex:"Kliknij, aby umie\u015Bci\u0107 pierwszy wierzcho\u0142ek",continueLine:"Kliknij, aby kontynuowa\u0107 rysowanie",finishLine:"Kliknij dowolny istniej\u0105cy znacznik, aby zako\u0144czy\u0107",finishPoly:"Kliknij pierwszy znacznik, aby zako\u0144czy\u0107",finishRect:"Kliknij, aby zako\u0144czy\u0107",startCircle:"Kliknij, aby umie\u015Bci\u0107 \u015Brodek okr\u0119gu",finishCircle:"Kliknij, aby zako\u0144czy\u0107 okr\u0105g",placeCircleMarker:"Kliknij, aby umie\u015Bci\u0107 znacznik okr\u0119gu",placeText:"Kliknij, aby umie\u015Bci\u0107 tekst"},actions:{finish:"Zako\u0144cz",cancel:"Anuluj",removeLastVertex:"Usu\u0144 ostatni wierzcho\u0142ek"},buttonTitles:{drawMarkerButton:"Rysuj znacznik",drawPolyButton:"Rysuj wielok\u0105t",drawLineButton:"Rysuj lini\u0119",drawCircleButton:"Rysuj okr\u0105g",drawRectButton:"Rysuj prostok\u0105t",editButton:"Edytuj warstwy",dragButton:"Przeci\u0105gnij warstwy",cutButton:"Wytnij warstwy",deleteButton:"Usu\u0144 warstwy",drawCircleMarkerButton:"Rysuj znacznik okr\u0105g\u0142y",snappingButton:"Przyci\u0105gnij przenoszony znacznik do innych warstw i wierzcho\u0142k\xF3w",pinningButton:"Przypnij wsp\xF3lne wierzcho\u0142ki razem",rotateButton:"Obr\xF3\u0107 warstwy",drawTextButton:"Rysuj tekst",scaleButton:"Skaluj warstwy",autoTracingButton:"Automatyczne \u015Bledzenie linii"},measurements:{totalLength:"D\u0142ugo\u015B\u0107",segmentLength:"D\u0142ugo\u015B\u0107 odcinka",area:"Obszar",radius:"Promie\u0144",perimeter:"Obw\xF3d",height:"Wysoko\u015B\u0107",width:"Szeroko\u015B\u0107",coordinates:"Pozycja",coordinatesMarker:"Znacznik pozycji"}},ia={tooltips:{placeMarker:"Klicka f\xF6r att placera mark\xF6r",firstVertex:"Klicka f\xF6r att placera f\xF6rsta h\xF6rnet",continueLine:"Klicka f\xF6r att forts\xE4tta rita",finishLine:"Klicka p\xE5 en existerande punkt f\xF6r att slutf\xF6ra",finishPoly:"Klicka p\xE5 den f\xF6rsta punkten f\xF6r att slutf\xF6ra",finishRect:"Klicka f\xF6r att slutf\xF6ra",startCircle:"Klicka f\xF6r att placera cirkelns centrum",finishCircle:"Klicka f\xF6r att slutf\xF6ra cirkeln",placeCircleMarker:"Klicka f\xF6r att placera cirkelmark\xF6r"},actions:{finish:"Slutf\xF6r",cancel:"Avbryt",removeLastVertex:"Ta bort sista h\xF6rnet"},buttonTitles:{drawMarkerButton:"Rita Mark\xF6r",drawPolyButton:"Rita Polygoner",drawLineButton:"Rita Linje",drawCircleButton:"Rita Cirkel",drawRectButton:"Rita Rektangel",editButton:"Redigera Lager",dragButton:"Dra Lager",cutButton:"Klipp i Lager",deleteButton:"Ta bort Lager",drawCircleMarkerButton:"Rita Cirkelmark\xF6r",snappingButton:"Sn\xE4pp dra mark\xF6ren till andra lager och h\xF6rn",pinningButton:"F\xE4st delade h\xF6rn tillsammans",rotateButton:"Rotera lagret"}},Yr={tooltips:{placeMarker:"\u039A\u03AC\u03BD\u03C4\u03B5 \u03BA\u03BB\u03B9\u03BA \u03B3\u03B9\u03B1 \u03BD\u03B1 \u03C4\u03BF\u03C0\u03BF\u03B8\u03B5\u03C4\u03AE\u03C3\u03B5\u03C4\u03B5 \u0394\u03B5\u03AF\u03BA\u03C4\u03B7",firstVertex:"\u039A\u03AC\u03BD\u03C4\u03B5 \u03BA\u03BB\u03B9\u03BA \u03B3\u03B9\u03B1 \u03BD\u03B1 \u03C4\u03BF\u03C0\u03BF\u03B8\u03B5\u03C4\u03AE\u03C3\u03B5\u03C4\u03B5 \u03C4\u03BF \u03C0\u03C1\u03CE\u03C4\u03BF \u03C3\u03B7\u03BC\u03B5\u03AF\u03BF",continueLine:"\u039A\u03AC\u03BD\u03C4\u03B5 \u03BA\u03BB\u03B9\u03BA \u03B3\u03B9\u03B1 \u03BD\u03B1 \u03C3\u03C5\u03BD\u03B5\u03C7\u03AF\u03C3\u03B5\u03C4\u03B5 \u03BD\u03B1 \u03C3\u03C7\u03B5\u03B4\u03B9\u03AC\u03B6\u03B5\u03C4\u03B5",finishLine:"\u039A\u03AC\u03BD\u03C4\u03B5 \u03BA\u03BB\u03B9\u03BA \u03C3\u03B5 \u03BF\u03C0\u03BF\u03B9\u03BF\u03BD\u03B4\u03AE\u03C0\u03BF\u03C4\u03B5 \u03C5\u03C0\u03AC\u03C1\u03C7\u03BF\u03BD \u03C3\u03B7\u03BC\u03B5\u03AF\u03BF \u03B3\u03B9\u03B1 \u03BD\u03B1 \u03BF\u03BB\u03BF\u03BA\u03BB\u03B7\u03C1\u03C9\u03B8\u03B5\u03AF",finishPoly:"\u039A\u03AC\u03BD\u03C4\u03B5 \u03BA\u03BB\u03B9\u03BA \u03C3\u03C4\u03BF \u03C0\u03C1\u03CE\u03C4\u03BF \u03C3\u03B7\u03BC\u03B5\u03AF\u03BF \u03B3\u03B9\u03B1 \u03BD\u03B1 \u03C4\u03B5\u03BB\u03B5\u03B9\u03CE\u03C3\u03B5\u03C4\u03B5",finishRect:"\u039A\u03AC\u03BD\u03C4\u03B5 \u03BA\u03BB\u03B9\u03BA \u03B3\u03B9\u03B1 \u03BD\u03B1 \u03C4\u03B5\u03BB\u03B5\u03B9\u03CE\u03C3\u03B5\u03C4\u03B5",startCircle:"\u039A\u03AC\u03BD\u03C4\u03B5 \u03BA\u03BB\u03B9\u03BA \u03B3\u03B9\u03B1 \u03BD\u03B1 \u03C4\u03BF\u03C0\u03BF\u03B8\u03B5\u03C4\u03AE\u03C3\u03B5\u03C4\u03B5 \u03BA\u03AD\u03BD\u03C4\u03C1\u03BF \u039A\u03CD\u03BA\u03BB\u03BF\u03C5",finishCircle:"\u039A\u03AC\u03BD\u03C4\u03B5 \u03BA\u03BB\u03B9\u03BA \u03B3\u03B9\u03B1 \u03BD\u03B1 \u03BF\u03BB\u03BF\u03BA\u03BB\u03B7\u03C1\u03CE\u03C3\u03B5\u03C4\u03B5 \u03C4\u03BF\u03BD \u039A\u03CD\u03BA\u03BB\u03BF",placeCircleMarker:"\u039A\u03AC\u03BD\u03C4\u03B5 \u03BA\u03BB\u03B9\u03BA \u03B3\u03B9\u03B1 \u03BD\u03B1 \u03C4\u03BF\u03C0\u03BF\u03B8\u03B5\u03C4\u03AE\u03C3\u03B5\u03C4\u03B5 \u039A\u03C5\u03BA\u03BB\u03B9\u03BA\u03CC \u0394\u03B5\u03AF\u03BA\u03C4\u03B7"},actions:{finish:"\u03A4\u03AD\u03BB\u03BF\u03C2",cancel:"\u0391\u03BA\u03CD\u03C1\u03C9\u03C3\u03B7",removeLastVertex:"\u039A\u03B1\u03C4\u03AC\u03C1\u03B3\u03B7\u03C3\u03B7 \u03C4\u03B5\u03BB\u03B5\u03C5\u03C4\u03B1\u03AF\u03BF\u03C5 \u03C3\u03B7\u03BC\u03B5\u03AF\u03BF\u03C5"},buttonTitles:{drawMarkerButton:"\u03A3\u03C7\u03B5\u03B4\u03AF\u03B1\u03C3\u03B7 \u0394\u03B5\u03AF\u03BA\u03C4\u03B7",drawPolyButton:"\u03A3\u03C7\u03B5\u03B4\u03AF\u03B1\u03C3\u03B7 \u03A0\u03BF\u03BB\u03C5\u03B3\u03CE\u03BD\u03BF\u03C5",drawLineButton:"\u03A3\u03C7\u03B5\u03B4\u03AF\u03B1\u03C3\u03B7 \u0393\u03C1\u03B1\u03BC\u03BC\u03AE\u03C2",drawCircleButton:"\u03A3\u03C7\u03B5\u03B4\u03AF\u03B1\u03C3\u03B7 \u039A\u03CD\u03BA\u03BB\u03BF\u03C5",drawRectButton:"\u03A3\u03C7\u03B5\u03B4\u03AF\u03B1\u03C3\u03B7 \u039F\u03C1\u03B8\u03BF\u03B3\u03C9\u03BD\u03AF\u03BF\u03C5",editButton:"\u0395\u03C0\u03B5\u03BE\u03B5\u03C1\u03B3\u03B1\u03C3\u03AF\u03B1 \u0395\u03C0\u03B9\u03C0\u03AD\u03B4\u03C9\u03BD",dragButton:"\u039C\u03B5\u03C4\u03B1\u03C6\u03BF\u03C1\u03AC \u0395\u03C0\u03B9\u03C0\u03AD\u03B4\u03C9\u03BD",cutButton:"\u0391\u03C0\u03BF\u03BA\u03BF\u03C0\u03AE \u0395\u03C0\u03B9\u03C0\u03AD\u03B4\u03C9\u03BD",deleteButton:"\u039A\u03B1\u03C4\u03AC\u03C1\u03B3\u03B7\u03C3\u03B7 \u0395\u03C0\u03B9\u03C0\u03AD\u03B4\u03C9\u03BD",drawCircleMarkerButton:"\u03A3\u03C7\u03B5\u03B4\u03AF\u03B1\u03C3\u03B7 \u039A\u03C5\u03BA\u03BB\u03B9\u03BA\u03BF\u03CD \u0394\u03B5\u03AF\u03BA\u03C4\u03B7",snappingButton:"\u03A0\u03C1\u03BF\u03C3\u03BA\u03CC\u03BB\u03BB\u03B7\u03C3\u03B7 \u03C4\u03BF\u03C5 \u0394\u03B5\u03AF\u03BA\u03C4\u03B7 \u03BC\u03B5\u03C4\u03B1\u03C6\u03BF\u03C1\u03AC\u03C2 \u03C3\u03B5 \u03AC\u03BB\u03BB\u03B1 \u0395\u03C0\u03AF\u03C0\u03B5\u03B4\u03B1 \u03BA\u03B1\u03B9 \u039A\u03BF\u03C1\u03C5\u03C6\u03AD\u03C2",pinningButton:"\u03A0\u03B5\u03C1\u03B9\u03BA\u03BF\u03C0\u03AE \u03BA\u03BF\u03B9\u03BD\u03CE\u03BD \u03BA\u03BF\u03C1\u03C5\u03C6\u03CE\u03BD \u03BC\u03B1\u03B6\u03AF",rotateButton:"\u03A0\u03B5\u03C1\u03B9\u03C3\u03C4\u03C1\u03AD\u03C8\u03C4\u03B5 \u03C4\u03BF \u03C3\u03C4\u03C1\u03CE\u03BC\u03B1"}},kn={tooltips:{placeMarker:"Kattintson a jel\xF6l\u0151 elhelyez\xE9s\xE9hez",firstVertex:"Kattintson az els\u0151 pont elhelyez\xE9s\xE9hez",continueLine:"Kattintson a k\xF6vetkez\u0151 pont elhelyez\xE9s\xE9hez",finishLine:"A befejez\xE9shez kattintson egy megl\xE9v\u0151 pontra",finishPoly:"A befejez\xE9shez kattintson az els\u0151 pontra",finishRect:"Kattintson a befejez\xE9shez",startCircle:"Kattintson a k\xF6r k\xF6z\xE9ppontj\xE1nak elhelyez\xE9s\xE9hez",finishCircle:"Kattintson a k\xF6r befejez\xE9s\xE9hez",placeCircleMarker:"Kattintson a k\xF6rjel\xF6l\u0151 elhelyez\xE9s\xE9hez"},actions:{finish:"Befejez\xE9s",cancel:"M\xE9gse",removeLastVertex:"Utols\xF3 pont elt\xE1vol\xEDt\xE1sa"},buttonTitles:{drawMarkerButton:"Jel\xF6l\u0151 rajzol\xE1sa",drawPolyButton:"Poligon rajzol\xE1sa",drawLineButton:"Vonal rajzol\xE1sa",drawCircleButton:"K\xF6r rajzol\xE1sa",drawRectButton:"N\xE9gyzet rajzol\xE1sa",editButton:"Elemek szerkeszt\xE9se",dragButton:"Elemek mozgat\xE1sa",cutButton:"Elemek v\xE1g\xE1sa",deleteButton:"Elemek t\xF6rl\xE9se",drawCircleMarkerButton:"K\xF6r jel\xF6l\u0151 rajzol\xE1sa",snappingButton:"Kapcsolja a jel\xF6lt\u0151t m\xE1sik elemhez vagy ponthoz",pinningButton:"K\xF6z\xF6s pontok \xF6sszek\xF6t\xE9se",rotateButton:"F\xF3lia elforgat\xE1sa"}},di={tooltips:{placeMarker:"Tryk for at placere en mark\xF8r",firstVertex:"Tryk for at placere det f\xF8rste punkt",continueLine:"Tryk for at forts\xE6tte linjen",finishLine:"Tryk p\xE5 et eksisterende punkt for at afslutte",finishPoly:"Tryk p\xE5 det f\xF8rste punkt for at afslutte",finishRect:"Tryk for at afslutte",startCircle:"Tryk for at placere cirklens center",finishCircle:"Tryk for at afslutte cirklen",placeCircleMarker:"Tryk for at placere en cirkelmark\xF8r"},actions:{finish:"Afslut",cancel:"Afbryd",removeLastVertex:"Fjern sidste punkt"},buttonTitles:{drawMarkerButton:"Placer mark\xF8r",drawPolyButton:"Tegn polygon",drawLineButton:"Tegn linje",drawCircleButton:"Tegn cirkel",drawRectButton:"Tegn firkant",editButton:"Rediger",dragButton:"Tr\xE6k",cutButton:"Klip",deleteButton:"Fjern",drawCircleMarkerButton:"Tegn cirkelmark\xF8r",snappingButton:"Fastg\xF8r trukket mark\xF8r til andre elementer",pinningButton:"Sammenl\xE6g delte elementer",rotateButton:"Roter laget"}},so={tooltips:{placeMarker:"Klikk for \xE5 plassere punkt",firstVertex:"Klikk for \xE5 plassere f\xF8rste punkt",continueLine:"Klikk for \xE5 tegne videre",finishLine:"Klikk p\xE5 et eksisterende punkt for \xE5 fullf\xF8re",finishPoly:"Klikk f\xF8rste punkt for \xE5 fullf\xF8re",finishRect:"Klikk for \xE5 fullf\xF8re",startCircle:"Klikk for \xE5 sette sirkel midtpunkt",finishCircle:"Klikk for \xE5 fullf\xF8re sirkel",placeCircleMarker:"Klikk for \xE5 plassere sirkel",placeText:"Klikk for \xE5 plassere tekst"},actions:{finish:"Fullf\xF8r",cancel:"Kanseller",removeLastVertex:"Fjern forrige punkt"},buttonTitles:{drawMarkerButton:"Tegn punkt",drawPolyButton:"Tegn flate",drawLineButton:"Tegn linje",drawCircleButton:"Tegn sirkel",drawRectButton:"Tegn rektangel",editButton:"Rediger objekter",dragButton:"Dra objekter",cutButton:"Kutt objekter",deleteButton:"Fjern objekter",drawCircleMarkerButton:"Tegn sirkel-punkt",snappingButton:"Fest dratt punkt til andre objekter og punkt",pinningButton:"Pin delte punkter sammen",rotateButton:"Rot\xE9r objekter",drawTextButton:"Tegn tekst",scaleButton:"Skal\xE9r objekter",autoTracingButton:"Automatisk sporing av linje"},measurements:{totalLength:"Lengde",segmentLength:"Segmentlengde",area:"Omr\xE5de",radius:"Radius",perimeter:"Omriss",height:"H\xF8yde",width:"Bredde",coordinates:"Posisjon",coordinatesMarker:"Posisjonsmark\xF8r"}},Pa={tooltips:{placeMarker:"\u06A9\u0644\u06CC\u06A9 \u0628\u0631\u0627\u06CC \u062C\u0627\u0646\u0645\u0627\u06CC\u06CC \u0646\u0634\u0627\u0646",firstVertex:"\u06A9\u0644\u06CC\u06A9 \u0628\u0631\u0627\u06CC \u0631\u0633\u0645 \u0627\u0648\u0644\u06CC\u0646 \u0631\u0623\u0633",continueLine:"\u06A9\u0644\u06CC\u06A9 \u0628\u0631\u0627\u06CC \u0627\u062F\u0627\u0645\u0647 \u0631\u0633\u0645",finishLine:"\u06A9\u0644\u06CC\u06A9 \u0631\u0648\u06CC \u0647\u0631 \u0646\u0634\u0627\u0646 \u0645\u0648\u062C\u0648\u062F \u0628\u0631\u0627\u06CC \u067E\u0627\u06CC\u0627\u0646",finishPoly:"\u06A9\u0644\u06CC\u06A9 \u0631\u0648\u06CC \u0627\u0648\u0644\u06CC\u0646 \u0646\u0634\u0627\u0646 \u0628\u0631\u0627\u06CC \u067E\u0627\u06CC\u0627\u0646",finishRect:"\u06A9\u0644\u06CC\u06A9 \u0628\u0631\u0627\u06CC \u067E\u0627\u06CC\u0627\u0646",startCircle:"\u06A9\u0644\u06CC\u06A9 \u0628\u0631\u0627\u06CC \u0631\u0633\u0645 \u0645\u0631\u06A9\u0632 \u062F\u0627\u06CC\u0631\u0647",finishCircle:"\u06A9\u0644\u06CC\u06A9 \u0628\u0631\u0627\u06CC \u067E\u0627\u06CC\u0627\u0646 \u0631\u0633\u0645 \u062F\u0627\u06CC\u0631\u0647",placeCircleMarker:"\u06A9\u0644\u06CC\u06A9 \u0628\u0631\u0627\u06CC \u0631\u0633\u0645 \u0646\u0634\u0627\u0646 \u062F\u0627\u06CC\u0631\u0647",placeText:"\u06A9\u0644\u06CC\u06A9 \u0628\u0631\u0627\u06CC \u0646\u0648\u0634\u062A\u0646 \u0645\u062A\u0646"},actions:{finish:"\u067E\u0627\u06CC\u0627\u0646",cancel:"\u0644\u0641\u0648",removeLastVertex:"\u062D\u0630\u0641 \u0622\u062E\u0631\u06CC\u0646 \u0631\u0623\u0633"},buttonTitles:{drawMarkerButton:"\u062F\u0631\u062C \u0646\u0634\u0627\u0646",drawPolyButton:"\u0631\u0633\u0645 \u0686\u0646\u062F\u0636\u0644\u0639\u06CC",drawLineButton:"\u0631\u0633\u0645 \u062E\u0637",drawCircleButton:"\u0631\u0633\u0645 \u062F\u0627\u06CC\u0631\u0647",drawRectButton:"\u0631\u0633\u0645 \u0686\u0647\u0627\u0631\u0636\u0644\u0639\u06CC",editButton:"\u0648\u06CC\u0631\u0627\u06CC\u0634 \u0644\u0627\u06CC\u0647\u200C\u0647\u0627",dragButton:"\u062C\u0627\u0628\u062C\u0627\u06CC\u06CC \u0644\u0627\u06CC\u0647\u200C\u0647\u0627",cutButton:"\u0628\u0631\u0634 \u0644\u0627\u06CC\u0647\u200C\u0647\u0627",deleteButton:"\u062D\u0630\u0641 \u0644\u0627\u06CC\u0647\u200C\u0647\u0627",drawCircleMarkerButton:"\u0631\u0633\u0645 \u0646\u0634\u0627\u0646 \u062F\u0627\u06CC\u0631\u0647",snappingButton:"\u0646\u0634\u0627\u0646\u06AF\u0631 \u0631\u0627 \u0628\u0647 \u0644\u0627\u06CC\u0647\u200C\u0647\u0627 \u0648 \u0631\u0626\u0648\u0633 \u062F\u06CC\u06AF\u0631 \u0628\u06A9\u0634\u06CC\u062F",pinningButton:"\u0631\u0626\u0648\u0633 \u0645\u0634\u062A\u0631\u06A9 \u0631\u0627 \u0628\u0627 \u0647\u0645 \u067E\u06CC\u0646 \u06A9\u0646\u06CC\u062F",rotateButton:"\u0686\u0631\u062E\u0634 \u0644\u0627\u06CC\u0647",drawTextButton:"\u0631\u0633\u0645 \u0645\u062A\u0646",scaleButton:"\u0645\u0642\u06CC\u0627\u0633\u200C\u06AF\u0630\u0627\u0631\u06CC",autoTracingButton:"\u0631\u062F\u06CC\u0627\u0628 \u062E\u0648\u062F\u06A9\u0627\u0631"},measurements:{totalLength:"\u0637\u0648\u0644",segmentLength:"\u0637\u0648\u0644 \u0628\u062E\u0634",area:"\u0646\u0627\u062D\u06CC\u0647",radius:"\u0634\u0639\u0627\u0639",perimeter:"\u0645\u062D\u06CC\u0637",height:"\u0627\u0631\u062A\u0641\u0627\u0639",width:"\u0639\u0631\u0636",coordinates:"\u0645\u0648\u0642\u0639\u06CC\u062A",coordinatesMarker:"\u0645\u0648\u0642\u0639\u06CC\u062A \u0646\u0634\u0627\u0646"}},oi={tooltips:{placeMarker:"\u041D\u0430\u0442\u0438\u0441\u043D\u0456\u0442\u044C, \u0449\u043E\u0431 \u043D\u0430\u043D\u0435\u0441\u0442\u0438 \u043C\u0430\u0440\u043A\u0435\u0440",firstVertex:"\u041D\u0430\u0442\u0438\u0441\u043D\u0456\u0442\u044C, \u0449\u043E\u0431 \u043D\u0430\u043D\u0435\u0441\u0442\u0438 \u043F\u0435\u0440\u0448\u0443 \u0432\u0435\u0440\u0448\u0438\u043D\u0443",continueLine:"\u041D\u0430\u0442\u0438\u0441\u043D\u0456\u0442\u044C, \u0449\u043E\u0431 \u043F\u0440\u043E\u0434\u043E\u0432\u0436\u0438\u0442\u0438 \u043C\u0430\u043B\u044E\u0432\u0430\u0442\u0438",finishLine:"\u041D\u0430\u0442\u0438\u0441\u043D\u0456\u0442\u044C \u0431\u0443\u0434\u044C-\u044F\u043A\u0438\u0439 \u0456\u0441\u043D\u0443\u044E\u0447\u0438\u0439 \u043C\u0430\u0440\u043A\u0435\u0440 \u0434\u043B\u044F \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043D\u044F",finishPoly:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u043F\u0435\u0440\u0448\u0438\u0439 \u043C\u0430\u0440\u043A\u0435\u0440, \u0449\u043E\u0431 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u0438",finishRect:"\u041D\u0430\u0442\u0438\u0441\u043D\u0456\u0442\u044C, \u0449\u043E\u0431 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u0438",startCircle:"\u041D\u0430\u0442\u0438\u0441\u043D\u0456\u0442\u044C, \u0449\u043E\u0431 \u0434\u043E\u0434\u0430\u0442\u0438 \u0446\u0435\u043D\u0442\u0440 \u043A\u043E\u043B\u0430",finishCircle:"\u041D\u0430\u0442\u0438\u0441\u043D\u0456\u0442\u044C, \u0449\u043E\u0431 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u0438 \u043A\u043E\u043B\u043E",placeCircleMarker:"\u041D\u0430\u0442\u0438\u0441\u043D\u0456\u0442\u044C, \u0449\u043E\u0431 \u043D\u0430\u043D\u0435\u0441\u0442\u0438 \u043A\u0440\u0443\u0433\u043E\u0432\u0438\u0439 \u043C\u0430\u0440\u043A\u0435\u0440"},actions:{finish:"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u0438",cancel:"\u0412\u0456\u0434\u043C\u0456\u043D\u0438\u0442\u0438",removeLastVertex:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438 \u043F\u043E\u043F\u0435\u0440\u0435\u0434\u043D\u044E \u0432\u0435\u0440\u0448\u0438\u043D\u0443"},buttonTitles:{drawMarkerButton:"\u041C\u0430\u043B\u044E\u0432\u0430\u0442\u0438 \u043C\u0430\u0440\u043A\u0435\u0440",drawPolyButton:"\u041C\u0430\u043B\u044E\u0432\u0430\u0442\u0438 \u043F\u043E\u043B\u0456\u0433\u043E\u043D",drawLineButton:"\u041C\u0430\u043B\u044E\u0432\u0430\u0442\u0438 \u043A\u0440\u0438\u0432\u0443",drawCircleButton:"\u041C\u0430\u043B\u044E\u0432\u0430\u0442\u0438 \u043A\u043E\u043B\u043E",drawRectButton:"\u041C\u0430\u043B\u044E\u0432\u0430\u0442\u0438 \u043F\u0440\u044F\u043C\u043E\u043A\u0443\u0442\u043D\u0438\u043A",editButton:"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u0448\u0430\u0440\u0438",dragButton:"\u041F\u0435\u0440\u0435\u043D\u0435\u0441\u0442\u0438 \u0448\u0430\u0440\u0438",cutButton:"\u0412\u0438\u0440\u0456\u0437\u0430\u0442\u0438 \u0448\u0430\u0440\u0438",deleteButton:"\u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438 \u0448\u0430\u0440\u0438",drawCircleMarkerButton:"\u041C\u0430\u043B\u044E\u0432\u0430\u0442\u0438 \u043A\u0440\u0443\u0433\u043E\u0432\u0438\u0439 \u043C\u0430\u0440\u043A\u0435\u0440",snappingButton:"\u041F\u0440\u0438\u0432\u2019\u044F\u0437\u0430\u0442\u0438 \u043F\u0435\u0440\u0435\u0442\u044F\u0433\u043D\u0443\u0442\u0438\u0439 \u043C\u0430\u0440\u043A\u0435\u0440 \u0434\u043E \u0456\u043D\u0448\u0438\u0445 \u0448\u0430\u0440\u0456\u0432 \u0442\u0430 \u0432\u0435\u0440\u0448\u0438\u043D",pinningButton:"\u0417\u0432'\u044F\u0437\u0430\u0442\u0438 \u0441\u043F\u0456\u043B\u044C\u043D\u0456 \u0432\u0435\u0440\u0448\u0438\u043D\u0438 \u0440\u0430\u0437\u043E\u043C",rotateButton:"\u041F\u043E\u0432\u0435\u0440\u043D\u0443\u0442\u0438 \u0448\u0430\u0440"}},Zi={tooltips:{placeMarker:"\u0130\u015Faret\xE7i yerle\u015Ftirmek i\xE7in t\u0131klay\u0131n",firstVertex:"\u0130lk tepe noktas\u0131n\u0131 yerle\u015Ftirmek i\xE7in t\u0131klay\u0131n",continueLine:"\xC7izime devam etmek i\xE7in t\u0131klay\u0131n",finishLine:"Bitirmek i\xE7in mevcut herhangi bir i\u015Faret\xE7iyi t\u0131klay\u0131n",finishPoly:"Bitirmek i\xE7in ilk i\u015Faret\xE7iyi t\u0131klay\u0131n",finishRect:"Bitirmek i\xE7in t\u0131klay\u0131n",startCircle:"Daire merkezine yerle\u015Ftirmek i\xE7in t\u0131klay\u0131n",finishCircle:"Daireyi bitirmek i\xE7in t\u0131klay\u0131n",placeCircleMarker:"Daire i\u015Faret\xE7isi yerle\u015Ftirmek i\xE7in t\u0131klay\u0131n"},actions:{finish:"Bitir",cancel:"\u0130ptal",removeLastVertex:"Son k\xF6\u015Feyi kald\u0131r"},buttonTitles:{drawMarkerButton:"\xC7izim \u0130\u015Faret\xE7isi",drawPolyButton:"\xC7okgenler \xE7iz",drawLineButton:"\xC7oklu \xE7izgi \xE7iz",drawCircleButton:"\xC7ember \xE7iz",drawRectButton:"Dikd\xF6rtgen \xE7iz",editButton:"Katmanlar\u0131 d\xFCzenle",dragButton:"Katmanlar\u0131 s\xFCr\xFCkle",cutButton:"Katmanlar\u0131 kes",deleteButton:"Katmanlar\u0131 kald\u0131r",drawCircleMarkerButton:"Daire i\u015Faret\xE7isi \xE7iz",snappingButton:"S\xFCr\xFCklenen i\u015Faret\xE7iyi di\u011Fer katmanlara ve k\xF6\u015Felere yap\u0131\u015Ft\u0131r",pinningButton:"Payla\u015F\u0131lan k\xF6\u015Feleri birbirine sabitle",rotateButton:"Katman\u0131 d\xF6nd\xFCr"}},ii={tooltips:{placeMarker:"Kliknut\xEDm vytvo\u0159\xEDte zna\u010Dku",firstVertex:"Kliknut\xEDm vytvo\u0159\xEDte prvn\xED objekt",continueLine:"Kliknut\xEDm pokra\u010Dujte v kreslen\xED",finishLine:"Kliknut\xED na libovolnou existuj\xEDc\xED zna\u010Dku pro dokon\u010Den\xED",finishPoly:"Vyberte prvn\xED bod pro dokon\u010Den\xED",finishRect:"Klikn\u011Bte pro dokon\u010Den\xED",startCircle:"Kliknut\xEDm p\u0159idejte st\u0159ed kruhu",finishCircle:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0437\u0430\u0434\u0430\u0442\u044C \u0440\u0430\u0434\u0438\u0443\u0441",placeCircleMarker:"Kliknut\xEDm nastavte polom\u011Br"},actions:{finish:"Dokon\u010Dit",cancel:"Zru\u0161it",removeLastVertex:"Zru\u0161it posledn\xED akci"},buttonTitles:{drawMarkerButton:"P\u0159idat zna\u010Dku",drawPolyButton:"Nakreslit polygon",drawLineButton:"Nakreslit k\u0159ivku",drawCircleButton:"Nakreslit kruh",drawRectButton:"Nakreslit obd\xE9ln\xEDk",editButton:"Upravit vrstvu",dragButton:"P\u0159eneste vrstvu",cutButton:"Vyjmout vrstvu",deleteButton:"Smazat vrstvu",drawCircleMarkerButton:"P\u0159idat kruhovou zna\u010Dku",snappingButton:"Nav\xE1zat ta\u017Enou zna\u010Dku k dal\u0161\xEDm vrstv\xE1m a vrchol\u016Fm",pinningButton:"Spojit spole\u010Dn\xE9 body dohromady",rotateButton:"Oto\u010Dte vrstvu"}},Cr={tooltips:{placeMarker:"\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u30DE\u30FC\u30AB\u30FC\u3092\u914D\u7F6E",firstVertex:"\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u6700\u521D\u306E\u9802\u70B9\u3092\u914D\u7F6E",continueLine:"\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u63CF\u753B\u3092\u7D9A\u3051\u308B",finishLine:"\u4EFB\u610F\u306E\u30DE\u30FC\u30AB\u30FC\u3092\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u7D42\u4E86",finishPoly:"\u6700\u521D\u306E\u30DE\u30FC\u30AB\u30FC\u3092\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u7D42\u4E86",finishRect:"\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u7D42\u4E86",startCircle:"\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u5186\u306E\u4E2D\u5FC3\u3092\u914D\u7F6E",finishCircle:"\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u5186\u306E\u63CF\u753B\u3092\u7D42\u4E86",placeCircleMarker:"\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u5186\u30DE\u30FC\u30AB\u30FC\u3092\u914D\u7F6E",placeText:"\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u30C6\u30AD\u30B9\u30C8\u3092\u914D\u7F6E"},actions:{finish:"\u7D42\u4E86",cancel:"\u30AD\u30E3\u30F3\u30BB\u30EB",removeLastVertex:"\u6700\u5F8C\u306E\u9802\u70B9\u3092\u524A\u9664"},buttonTitles:{drawMarkerButton:"\u30DE\u30FC\u30AB\u30FC\u3092\u63CF\u753B",drawPolyButton:"\u30DD\u30EA\u30B4\u30F3\u3092\u63CF\u753B",drawLineButton:"\u6298\u308C\u7DDA\u3092\u63CF\u753B",drawCircleButton:"\u5186\u3092\u63CF\u753B",drawRectButton:"\u77E9\u5F62\u3092\u63CF\u753B",editButton:"\u30EC\u30A4\u30E4\u30FC\u3092\u7DE8\u96C6",dragButton:"\u30EC\u30A4\u30E4\u30FC\u3092\u30C9\u30E9\u30C3\u30B0",cutButton:"\u30EC\u30A4\u30E4\u30FC\u3092\u5207\u308A\u53D6\u308A",deleteButton:"\u30EC\u30A4\u30E4\u30FC\u3092\u524A\u9664",drawCircleMarkerButton:"\u5186\u30DE\u30FC\u30AB\u30FC\u3092\u63CF\u753B",snappingButton:"\u30C9\u30E9\u30C3\u30B0\u3057\u305F\u30DE\u30FC\u30AB\u30FC\u3092\u4ED6\u306E\u30EC\u30A4\u30E4\u30FC\u3084\u9802\u70B9\u306B\u30B9\u30CA\u30C3\u30D7\u3059\u308B",pinningButton:"\u5171\u6709\u3059\u308B\u9802\u70B9\u3092\u540C\u6642\u306B\u52D5\u304B\u3059",rotateButton:"\u30EC\u30A4\u30E4\u30FC\u3092\u56DE\u8EE2",drawTextButton:"\u30C6\u30AD\u30B9\u30C8\u3092\u63CF\u753B"}},or={tooltips:{placeMarker:"Klikkaa asettaaksesi merkin",firstVertex:"Klikkaa asettaakseni ensimm\xE4isen osuuden",continueLine:"Klikkaa jatkaaksesi piirt\xE4mist\xE4",finishLine:"Klikkaa olemassa olevaa merkki\xE4 lopettaaksesi",finishPoly:"Klikkaa ensimm\xE4ist\xE4 merkki\xE4 lopettaaksesi",finishRect:"Klikkaa lopettaaksesi",startCircle:"Klikkaa asettaaksesi ympyr\xE4n keskipisteen",finishCircle:"Klikkaa lopettaaksesi ympyr\xE4n",placeCircleMarker:"Klikkaa asettaaksesi ympyr\xE4merkin",placeText:"Klikkaa asettaaksesi tekstin"},actions:{finish:"Valmis",cancel:"Peruuta",removeLastVertex:"Poista viimeinen osuus"},buttonTitles:{drawMarkerButton:"Piirr\xE4 merkkej\xE4",drawPolyButton:"Piirr\xE4 monikulmioita",drawLineButton:"Piirr\xE4 viivoja",drawCircleButton:"Piirr\xE4 ympyr\xE4",drawRectButton:"Piirr\xE4 neliskulmioita",editButton:"Muokkaa",dragButton:"Siirr\xE4",cutButton:"Leikkaa",deleteButton:"Poista",drawCircleMarkerButton:"Piirr\xE4 ympyr\xE4merkki",snappingButton:"Kiinnit\xE4 siirrett\xE4v\xE4 merkki toisiin muotoihin",pinningButton:"Kiinnit\xE4 jaetut muodot yhteen",rotateButton:"K\xE4\xE4nn\xE4",drawTextButton:"Piirr\xE4 teksti\xE4"}},Fi={tooltips:{placeMarker:"\uB9C8\uCEE4 \uC704\uCE58\uB97C \uD074\uB9AD\uD558\uC138\uC694",firstVertex:"\uCCAB\uBC88\uC9F8 \uAF2D\uC9C0\uC810 \uC704\uCE58\uC744 \uD074\uB9AD\uD558\uC138\uC694",continueLine:"\uACC4\uC18D \uADF8\uB9AC\uB824\uBA74 \uD074\uB9AD\uD558\uC138\uC694",finishLine:"\uB05D\uB0B4\uB824\uBA74 \uAE30\uC874 \uB9C8\uCEE4\uB97C \uD074\uB9AD\uD558\uC138\uC694",finishPoly:"\uB05D\uB0B4\uB824\uBA74 \uCC98\uC74C \uB9C8\uCEE4\uB97C \uD074\uB9AD\uD558\uC138\uC694",finishRect:"\uB05D\uB0B4\uB824\uBA74 \uD074\uB9AD\uD558\uC138\uC694",startCircle:"\uC6D0\uC758 \uC911\uC2EC\uC774 \uB420 \uC704\uCE58\uB97C \uD074\uB9AD\uD558\uC138\uC694",finishCircle:"\uC6D0\uC744 \uB05D\uB0B4\uB824\uBA74 \uD074\uB9AD\uD558\uC138\uC694",placeCircleMarker:"\uC6D0 \uB9C8\uCEE4 \uC704\uCE58\uB97C \uD074\uB9AD\uD558\uC138\uC694",placeText:"\uD14D\uC2A4\uD2B8 \uC704\uCE58\uB97C \uD074\uB9AD\uD558\uC138\uC694"},actions:{finish:"\uB05D\uB0B4\uAE30",cancel:"\uCDE8\uC18C",removeLastVertex:"\uB9C8\uC9C0\uB9C9 \uAF2D\uC9C0\uC810 \uC81C\uAC70"},buttonTitles:{drawMarkerButton:"\uB9C8\uCEE4 \uADF8\uB9AC\uAE30",drawPolyButton:"\uB2E4\uAC01\uD615 \uADF8\uB9AC\uAE30",drawLineButton:"\uB2E4\uAC01\uC120 \uADF8\uB9AC\uAE30",drawCircleButton:"\uC6D0 \uADF8\uB9AC\uAE30",drawRectButton:"\uC9C1\uC0AC\uAC01\uD615 \uADF8\uB9AC\uAE30",editButton:"\uB808\uC774\uC5B4 \uD3B8\uC9D1\uD558\uAE30",dragButton:"\uB808\uC774\uC5B4 \uB04C\uAE30",cutButton:"\uB808\uC774\uC5B4 \uC790\uB974\uAE30",deleteButton:"\uB808\uC774\uC5B4 \uC81C\uAC70\uD558\uAE30",drawCircleMarkerButton:"\uC6D0 \uB9C8\uCEE4 \uADF8\uB9AC\uAE30",snappingButton:"\uC7A1\uC544\uB048 \uB9C8\uCEE4\uB97C \uB2E4\uB978 \uB808\uC774\uC5B4 \uBC0F \uAF2D\uC9C0\uC810\uC5D0 \uB4E4\uB7EC\uBD99\uAC8C \uD558\uAE30",pinningButton:"\uACF5\uC720 \uAF2D\uC9C0\uC810\uC744 \uD568\uAED8 \uCC0D\uAE30",rotateButton:"\uB808\uC774\uC5B4 \uD68C\uC804\uD558\uAE30",drawTextButton:"\uD14D\uC2A4\uD2B8 \uADF8\uB9AC\uAE30"}},jo={tooltips:{placeMarker:"\u041C\u0430\u0440\u043A\u0435\u0440\u0434\u0438 \u0436\u0430\u0439\u0433\u0430\u0448\u0442\u044B\u0440\u0443\u0443 \u04AF\u0447\u04AF\u043D \u0431\u0430\u0441\u044B\u04A3\u044B\u0437",firstVertex:"\u0411\u0438\u0440\u0438\u043D\u0447\u0438 \u0447\u043E\u043A\u0443\u043D\u0443 \u0436\u0430\u0439\u0433\u0430\u0448\u0442\u044B\u0440\u0443\u0443\u043D\u0443 \u04AF\u0447\u04AF\u043D \u0431\u0430\u0441\u044B\u04A3\u044B\u0437",continueLine:"\u0421\u04AF\u0440\u04E9\u0442 \u0442\u0430\u0440\u0442\u0443\u0443\u043D\u0443 \u0443\u043B\u0430\u043D\u0442\u0443\u0443 \u04AF\u0447\u04AF\u043D \u0431\u0430\u0441\u044B\u04A3\u044B\u0437",finishLine:"\u0410\u044F\u043A\u0442\u043E\u043E \u04AF\u0447\u04AF\u043D \u0443\u0447\u0443\u0440\u0434\u0430\u0433\u044B \u043C\u0430\u0440\u043A\u0435\u0440\u0434\u0438 \u0431\u0430\u0441\u044B\u04A3\u044B\u0437",finishPoly:"\u0411\u04AF\u0442\u04AF\u0440\u04AF\u04AF \u04AF\u0447\u04AF\u043D \u0431\u0438\u0440\u0438\u043D\u0447\u0438 \u043C\u0430\u0440\u043A\u0435\u0440\u0434\u0438 \u0431\u0430\u0441\u044B\u04A3\u044B\u0437",finishRect:"\u0411\u04AF\u0442\u04AF\u0440\u04AF\u04AF \u04AF\u0447\u04AF\u043D \u0431\u0430\u0441\u044B\u04A3\u044B\u0437",startCircle:"\u0410\u0439\u043B\u0430\u043D\u0430\u043D\u044B\u043D \u0431\u043E\u0440\u0431\u043E\u0440\u0443\u043D \u0436\u0430\u0439\u0433\u0430\u0448\u0442\u044B\u0440\u0443\u0443\u043D\u0443 \u04AF\u0447\u04AF\u043D \u0431\u0430\u0441\u044B\u04A3\u044B\u0437",finishCircle:"\u0410\u0439\u043B\u0430\u043D\u0430\u043D\u044B \u0431\u04AF\u0442\u04AF\u0440\u04AF\u04AF \u04AF\u0447\u04AF\u043D \u0431\u0430\u0441\u044B\u04A3\u044B\u0437",placeCircleMarker:"\u0422\u0435\u0433\u0435\u0440\u0435\u043A \u043C\u0430\u0440\u043A\u0435\u0440\u0434\u0438 \u0436\u0430\u0439\u0433\u0430\u0448\u0442\u044B\u0440\u0443\u0443 \u04AF\u0447\u04AF\u043D \u0431\u0430\u0441\u044B\u04A3\u044B\u0437",placeText:"\u0422\u0435\u043A\u0441\u0442\u0442\u0438 \u0436\u0430\u0439\u0433\u0430\u0448\u0442\u044B\u0440\u0443\u0443 \u04AF\u0447\u04AF\u043D \u0431\u0430\u0441\u044B\u04A3\u044B\u0437"},actions:{finish:"\u0410\u044F\u0433\u044B",cancel:"\u0416\u043E\u043A \u043A\u044B\u043B\u0443\u0443",removeLastVertex:"\u0410\u043A\u044B\u0440\u043A\u044B \u0447\u043E\u043A\u0443\u043D\u0443 \u04E9\u0447\u04AF\u0440\u04AF\u04AF"},buttonTitles:{drawMarkerButton:"\u041C\u0430\u0440\u043A\u0435\u0440\u0434\u0438 \u0447\u0438\u0437\u0443\u0443",drawPolyButton:"\u041F\u043E\u043B\u0438\u0433\u043E\u043D \u0447\u0438\u0437\u0443\u0443",drawLineButton:"\u041F\u043E\u043B\u0438\u043B\u0438\u043D\u0438\u044F \u0447\u0438\u0437\u0443\u0443",drawCircleButton:"\u0414\u0430\u0439\u044B\u043D\u0434\u044B \u0447\u0438\u0437\u0443\u0443",drawRectButton:"\u041F\u0440\u044F\u043C\u043E\u0443\u0433\u043E\u043B\u044C\u043D\u0438\u043A \u0447\u0438\u0437\u0443\u0443",editButton:"\u0421\u043B\u043E\u043E\u043F\u0442\u0443 \u0442\u04AF\u0437\u04E9\u0442\u04AF\u04AF",dragButton:"\u0421\u043B\u043E\u043E\u043F\u0442\u0443 \u043A\u0430\u0440\u0430\u043F \u0441\u04AF\u0439\u043B\u04E9\u04AF",cutButton:"\u0421\u043B\u043E\u043E\u043F\u0442\u0443\u043D \u0431\u0430\u0448\u044B\u043D \u043A\u0435\u0441\u04AF\u04AF",deleteButton:"\u0421\u043B\u043E\u043E\u043F\u0442\u0443\u043D \u04E9\u0447\u04AF\u0440\u04AF\u04AF",drawCircleMarkerButton:"\u0414\u0430\u0439\u044B\u043D\u0434\u044B \u043C\u0430\u0440\u043A\u0435\u0440\u0434\u0438 \u0447\u0438\u0437\u0443\u0443",snappingButton:"\u0411\u0430\u0448\u043A\u0430 \u0441\u043B\u043E\u043E\u043F\u0442\u043E\u0440\u0434\u0443\u043D \u0436\u0430\u043D\u0430 \u0432\u0435\u0440\u0442\u0435\u043A\u0441\u0442\u0435\u0440\u0434\u0438\u043D \u0430\u0440\u0430\u0441\u044B\u043D\u0430 \u0447\u0435\u043A\u0438\u043B\u0434\u04E9\u04E9",pinningButton:"\u0411\u04E9\u043B\u04AF\u0448\u043A\u04E9\u043D \u0432\u0435\u0440\u0442\u0435\u043A\u0441\u0442\u0435\u0440\u0434\u0438 \u0431\u0438\u0440\u0433\u0435 \u0442\u0443\u0442\u0443\u0448\u0442\u0443\u0440\u0443\u0443",rotateButton:"\u0421\u043B\u043E\u043E\u043F\u0442\u0443\u043D \u04E9\u0437\u0433\u04E9\u0440\u0442\u04AF\u04AF",drawTextButton:"\u0422\u0435\u043A\u0441\u0442 \u0447\u0438\u0437\u0443\u0443",scaleButton:"\u0421\u043B\u043E\u043E\u043F\u0442\u0443\u043D \u04E9\u043B\u0447\u04E9\u043C\u04AF\u043D \u04E9\u0437\u0433\u04E9\u0440\u0442\u04AF\u04AF",autoTracingButton:"\u0410\u0432\u0442\u043E\u043C\u0430\u0442\u0442\u044B\u043A \u0442\u0438\u0437\u043C\u0435\u0433\u0438 \u0447\u0438\u0437\u0443\u0443"},measurements:{totalLength:"\u0423\u0437\u0443\u043D\u0434\u0443\u043A",segmentLength:"\u0421\u0435\u0433\u043C\u0435\u043D\u0442 \u0443\u0437\u0443\u043D\u0434\u0443\u0433\u0443",area:"\u0410\u0439\u043C\u0430\u043A",radius:"\u0420\u0430\u0434\u0438\u0443\u0441",perimeter:"\u041F\u0435\u0440\u0438\u043C\u0435\u0442\u0440",height:"\u0414\u0438\u0430\u043C\u0435\u0442\u0440",width:"\u041A\u0435\u043D\u0447\u0438\u043B\u0438\u043A",coordinates:"\u041A\u043E\u043E\u0440\u0434\u0438\u043D\u0430\u0442\u0442\u0430\u0440",coordinatesMarker:"\u041C\u0430\u0440\u043A\u0435\u0440\u0434\u0438\u043D \u043A\u043E\u043E\u0440\u0434\u0438\u043D\u0430\u0442\u0442\u0430\u0440\u044B"}},ai=as,ir={en:Ta,de:dn,it:Oo,id:Fo,ro:xs,ru:er,es:os,nl:Vs,fr:Xr,pt:ai,pt_br:qn,pt_pt:as,zh:ci,zh_tw:fn,pl:No,sv:ia,el:Yr,hu:kn,da:di,no:so,fa:Pa,ua:oi,tr:Zi,cz:ii,ja:Cr,fi:or,ko:Fi,ky:jo},Qe={_globalEditModeEnabled:!1,enableGlobalEditMode(l){let p=kr({},l);this._globalEditModeEnabled=!0,this.Toolbar.toggleButton("editMode",this.globalEditModeEnabled()),L.PM.Utils.findLayers(this.map).forEach(y=>{this._isRelevantForEdit(y)&&y.pm.enable(p)}),this.throttledReInitEdit||(this.throttledReInitEdit=L.Util.throttle(this.handleLayerAdditionInGlobalEditMode,100,this)),this._addedLayersEdit={},this.map.on("layeradd",this._layerAddedEdit,this),this.map.on("layeradd",this.throttledReInitEdit,this),this._fireGlobalEditModeToggled(!0)},disableGlobalEditMode(){this._globalEditModeEnabled=!1,L.PM.Utils.findLayers(this.map).forEach(l=>{l.pm.disable()}),this.map.off("layeradd",this._layerAddedEdit,this),this.map.off("layeradd",this.throttledReInitEdit,this),this.Toolbar.toggleButton("editMode",this.globalEditModeEnabled()),this._fireGlobalEditModeToggled(!1)},globalEditEnabled(){return this.globalEditModeEnabled()},globalEditModeEnabled(){return this._globalEditModeEnabled},toggleGlobalEditMode(l=this.globalOptions){this.globalEditModeEnabled()?this.disableGlobalEditMode():this.enableGlobalEditMode(l)},handleLayerAdditionInGlobalEditMode(){let l=this._addedLayersEdit;if(this._addedLayersEdit={},this.globalEditModeEnabled())for(let p in l){let y=l[p];this._isRelevantForEdit(y)&&y.pm.enable(kr({},this.globalOptions))}},_layerAddedEdit({layer:l}){this._addedLayersEdit[L.stamp(l)]=l},_isRelevantForEdit(l){return l.pm&&!(l instanceof L.LayerGroup)&&(!L.PM.optIn&&!l.options.pmIgnore||L.PM.optIn&&l.options.pmIgnore===!1)&&!l._pmTempLayer&&l.pm.options.allowEditing}},Ve=Qe,mn={_globalDragModeEnabled:!1,enableGlobalDragMode(){let l=L.PM.Utils.findLayers(this.map);this._globalDragModeEnabled=!0,this._addedLayersDrag={},l.forEach(p=>{this._isRelevantForDrag(p)&&p.pm.enableLayerDrag()}),this.throttledReInitDrag||(this.throttledReInitDrag=L.Util.throttle(this.reinitGlobalDragMode,100,this)),this.map.on("layeradd",this._layerAddedDrag,this),this.map.on("layeradd",this.throttledReInitDrag,this),this.Toolbar.toggleButton("dragMode",this.globalDragModeEnabled()),this._fireGlobalDragModeToggled(!0)},disableGlobalDragMode(){let l=L.PM.Utils.findLayers(this.map);this._globalDragModeEnabled=!1,l.forEach(p=>{p.pm.disableLayerDrag()}),this.map.off("layeradd",this._layerAddedDrag,this),this.map.off("layeradd",this.throttledReInitDrag,this),this.Toolbar.toggleButton("dragMode",this.globalDragModeEnabled()),this._fireGlobalDragModeToggled(!1)},globalDragModeEnabled(){return!!this._globalDragModeEnabled},toggleGlobalDragMode(){this.globalDragModeEnabled()?this.disableGlobalDragMode():this.enableGlobalDragMode()},reinitGlobalDragMode(){let l=this._addedLayersDrag;if(this._addedLayersDrag={},this.globalDragModeEnabled())for(let p in l){let y=l[p];this._isRelevantForDrag(y)&&y.pm.enableLayerDrag()}},_layerAddedDrag({layer:l}){this._addedLayersDrag[L.stamp(l)]=l},_isRelevantForDrag(l){return l.pm&&!(l instanceof L.LayerGroup)&&(!L.PM.optIn&&!l.options.pmIgnore||L.PM.optIn&&l.options.pmIgnore===!1)&&!l._pmTempLayer&&l.pm.options.draggable}},He=mn,Us={_globalRemovalModeEnabled:!1,enableGlobalRemovalMode(){this._globalRemovalModeEnabled=!0,this.map.eachLayer(l=>{this._isRelevantForRemoval(l)&&(l.pm.enabled()&&l.pm.disable(),l.on("click",this.removeLayer,this))}),this.throttledReInitRemoval||(this.throttledReInitRemoval=L.Util.throttle(this.handleLayerAdditionInGlobalRemovalMode,100,this)),this._addedLayersRemoval={},this.map.on("layeradd",this._layerAddedRemoval,this),this.map.on("layeradd",this.throttledReInitRemoval,this),this.Toolbar.toggleButton("removalMode",this.globalRemovalModeEnabled()),this._fireGlobalRemovalModeToggled(!0)},disableGlobalRemovalMode(){this._globalRemovalModeEnabled=!1,this.map.eachLayer(l=>{l.off("click",this.removeLayer,this)}),this.map.off("layeradd",this._layerAddedRemoval,this),this.map.off("layeradd",this.throttledReInitRemoval,this),this.Toolbar.toggleButton("removalMode",this.globalRemovalModeEnabled()),this._fireGlobalRemovalModeToggled(!1)},globalRemovalEnabled(){return this.globalRemovalModeEnabled()},globalRemovalModeEnabled(){return!!this._globalRemovalModeEnabled},toggleGlobalRemovalMode(){this.globalRemovalModeEnabled()?this.disableGlobalRemovalMode():this.enableGlobalRemovalMode()},removeLayer(l){let p=l.target;this._isRelevantForRemoval(p)&&!p.pm.dragging()&&(p.removeFrom(this.map.pm._getContainingLayer()),p.remove(),p instanceof L.LayerGroup?(this._fireRemoveLayerGroup(p),this._fireRemoveLayerGroup(this.map,p)):(p.pm._fireRemove(p),p.pm._fireRemove(this.map,p)))},_isRelevantForRemoval(l){return l.pm&&!(l instanceof L.LayerGroup)&&(!L.PM.optIn&&!l.options.pmIgnore||L.PM.optIn&&l.options.pmIgnore===!1)&&!l._pmTempLayer&&l.pm.options.allowRemoval},handleLayerAdditionInGlobalRemovalMode(){let l=this._addedLayersRemoval;if(this._addedLayersRemoval={},this.globalRemovalModeEnabled())for(let p in l){let y=l[p];this._isRelevantForRemoval(y)&&(y.pm.enabled()&&y.pm.disable(),y.on("click",this.removeLayer,this))}},_layerAddedRemoval({layer:l}){this._addedLayersRemoval[L.stamp(l)]=l}},Fr=Us,oo={_globalRotateModeEnabled:!1,enableGlobalRotateMode(){this._globalRotateModeEnabled=!0,L.PM.Utils.findLayers(this.map).filter(l=>l instanceof L.Polyline).forEach(l=>{this._isRelevantForRotate(l)&&l.pm.enableRotate()}),this.throttledReInitRotate||(this.throttledReInitRotate=L.Util.throttle(this.handleLayerAdditionInGlobalRotateMode,100,this)),this._addedLayersRotate={},this.map.on("layeradd",this._layerAddedRotate,this),this.map.on("layeradd",this.throttledReInitRotate,this),this.Toolbar.toggleButton("rotateMode",this.globalRotateModeEnabled()),this._fireGlobalRotateModeToggled()},disableGlobalRotateMode(){this._globalRotateModeEnabled=!1,L.PM.Utils.findLayers(this.map).filter(l=>l instanceof L.Polyline).forEach(l=>{l.pm.disableRotate()}),this.map.off("layeradd",this._layerAddedRotate,this),this.map.off("layeradd",this.throttledReInitRotate,this),this.Toolbar.toggleButton("rotateMode",this.globalRotateModeEnabled()),this._fireGlobalRotateModeToggled()},globalRotateModeEnabled(){return!!this._globalRotateModeEnabled},toggleGlobalRotateMode(){this.globalRotateModeEnabled()?this.disableGlobalRotateMode():this.enableGlobalRotateMode()},_isRelevantForRotate(l){return l.pm&&l instanceof L.Polyline&&!(l instanceof L.LayerGroup)&&(!L.PM.optIn&&!l.options.pmIgnore||L.PM.optIn&&l.options.pmIgnore===!1)&&!l._pmTempLayer&&l.pm.options.allowRotation},handleLayerAdditionInGlobalRotateMode(){let l=this._addedLayersRotate;if(this._addedLayersRotate={},this.globalRotateModeEnabled())for(let p in l){let y=l[p];this._isRelevantForRemoval(y)&&y.pm.enableRotate()}},_layerAddedRotate({layer:l}){this._addedLayersRotate[L.stamp(l)]=l}},Jr=oo,Wa=se(Sn()),Hn={_fireDrawStart(l="Draw",p={}){this.__fire(this._map,"pm:drawstart",{shape:this._shape,workingLayer:this._layer},l,p)},_fireDrawEnd(l="Draw",p={}){this.__fire(this._map,"pm:drawend",{shape:this._shape},l,p)},_fireCreate(l,p="Draw",y={}){this.__fire(this._map,"pm:create",{shape:this._shape,marker:l,layer:l},p,y)},_fireCenterPlaced(l="Draw",p={}){let y=l==="Draw"?this._layer:void 0,x=l!=="Draw"?this._layer:void 0;this.__fire(this._layer,"pm:centerplaced",{shape:this._shape,workingLayer:y,layer:x,latlng:this._layer.getLatLng()},l,p)},_fireCut(l,p,y,x="Draw",M={}){this.__fire(l,"pm:cut",{shape:this._shape,layer:p,originalLayer:y},x,M)},_fireEdit(l=this._layer,p="Edit",y={}){this.__fire(l,"pm:edit",{layer:this._layer,shape:this.getShape()},p,y)},_fireEnable(l="Edit",p={}){this.__fire(this._layer,"pm:enable",{layer:this._layer,shape:this.getShape()},l,p)},_fireDisable(l="Edit",p={}){this.__fire(this._layer,"pm:disable",{layer:this._layer,shape:this.getShape()},l,p)},_fireUpdate(l="Edit",p={}){this.__fire(this._layer,"pm:update",{layer:this._layer,shape:this.getShape()},l,p)},_fireMarkerDragStart(l,p=void 0,y="Edit",x={}){this.__fire(this._layer,"pm:markerdragstart",{layer:this._layer,markerEvent:l,shape:this.getShape(),indexPath:p},y,x)},_fireMarkerDrag(l,p=void 0,y="Edit",x={}){this.__fire(this._layer,"pm:markerdrag",{layer:this._layer,markerEvent:l,shape:this.getShape(),indexPath:p},y,x)},_fireMarkerDragEnd(l,p=void 0,y=void 0,x="Edit",M={}){this.__fire(this._layer,"pm:markerdragend",{layer:this._layer,markerEvent:l,shape:this.getShape(),indexPath:p,intersectionReset:y},x,M)},_fireDragStart(l="Edit",p={}){this.__fire(this._layer,"pm:dragstart",{layer:this._layer,shape:this.getShape()},l,p)},_fireDrag(l,p="Edit",y={}){this.__fire(this._layer,"pm:drag",Al(kr({},l),{shape:this.getShape()}),p,y)},_fireDragEnd(l="Edit",p={}){this.__fire(this._layer,"pm:dragend",{layer:this._layer,shape:this.getShape()},l,p)},_fireDragEnable(l="Edit",p={}){this.__fire(this._layer,"pm:dragenable",{layer:this._layer,shape:this.getShape()},l,p)},_fireDragDisable(l="Edit",p={}){this.__fire(this._layer,"pm:dragdisable",{layer:this._layer,shape:this.getShape()},l,p)},_fireRemove(l,p=l,y="Edit",x={}){this.__fire(l,"pm:remove",{layer:p,shape:this.getShape()},y,x)},_fireVertexAdded(l,p,y,x="Edit",M={}){this.__fire(this._layer,"pm:vertexadded",{layer:this._layer,workingLayer:this._layer,marker:l,indexPath:p,latlng:y,shape:this.getShape()},x,M)},_fireVertexRemoved(l,p,y="Edit",x={}){this.__fire(this._layer,"pm:vertexremoved",{layer:this._layer,marker:l,indexPath:p,shape:this.getShape()},y,x)},_fireVertexClick(l,p,y="Edit",x={}){this.__fire(this._layer,"pm:vertexclick",{layer:this._layer,markerEvent:l,indexPath:p,shape:this.getShape()},y,x)},_fireIntersect(l,p=this._layer,y="Edit",x={}){this.__fire(p,"pm:intersect",{layer:this._layer,intersection:l,shape:this.getShape()},y,x)},_fireLayerReset(l,p,y="Edit",x={}){this.__fire(this._layer,"pm:layerreset",{layer:this._layer,markerEvent:l,indexPath:p,shape:this.getShape()},y,x)},_fireChange(l,p="Edit",y={}){this.__fire(this._layer,"pm:change",{layer:this._layer,latlngs:l,shape:this.getShape()},p,y)},_fireTextChange(l,p="Edit",y={}){this.__fire(this._layer,"pm:textchange",{layer:this._layer,text:l,shape:this.getShape()},p,y)},_fireTextFocus(l="Edit",p={}){this.__fire(this._layer,"pm:textfocus",{layer:this._layer,shape:this.getShape()},l,p)},_fireTextBlur(l="Edit",p={}){this.__fire(this._layer,"pm:textblur",{layer:this._layer,shape:this.getShape()},l,p)},_fireSnapDrag(l,p,y="Snapping",x={}){this.__fire(l,"pm:snapdrag",p,y,x)},_fireSnap(l,p,y="Snapping",x={}){this.__fire(l,"pm:snap",p,y,x)},_fireUnsnap(l,p,y="Snapping",x={}){this.__fire(l,"pm:unsnap",p,y,x)},_fireRotationEnable(l,p,y="Rotation",x={}){this.__fire(l,"pm:rotateenable",{layer:this._layer,helpLayer:this._rotatePoly,shape:this.getShape()},y,x)},_fireRotationDisable(l,p="Rotation",y={}){this.__fire(l,"pm:rotatedisable",{layer:this._layer,shape:this.getShape()},p,y)},_fireRotationStart(l,p,y="Rotation",x={}){this.__fire(l,"pm:rotatestart",{layer:this._rotationLayer,helpLayer:this._layer,startAngle:this._startAngle,originLatLngs:p},y,x)},_fireRotation(l,p,y,x=this._rotationLayer,M="Rotation",A={}){this.__fire(l,"pm:rotate",{layer:x,helpLayer:this._layer,startAngle:this._startAngle,angle:x.pm.getAngle(),angleDiff:p,oldLatLngs:y,newLatLngs:x.getLatLngs()},M,A)},_fireRotationEnd(l,p,y,x="Rotation",M={}){this.__fire(l,"pm:rotateend",{layer:this._rotationLayer,helpLayer:this._layer,startAngle:p,angle:this._rotationLayer.pm.getAngle(),originLatLngs:y,newLatLngs:this._rotationLayer.getLatLngs()},x,M)},_fireActionClick(l,p,y,x="Toolbar",M={}){this.__fire(this._map,"pm:actionclick",{text:l.text,action:l,btnName:p,button:y},x,M)},_fireButtonClick(l,p,y="Toolbar",x={}){this.__fire(this._map,"pm:buttonclick",{btnName:l,button:p},y,x)},_fireLangChange(l,p,y,x,M="Global",A={}){this.__fire(this.map,"pm:langchange",{oldLang:l,activeLang:p,fallback:y,translations:x},M,A)},_fireGlobalDragModeToggled(l,p="Global",y={}){this.__fire(this.map,"pm:globaldragmodetoggled",{enabled:l,map:this.map},p,y)},_fireGlobalEditModeToggled(l,p="Global",y={}){this.__fire(this.map,"pm:globaleditmodetoggled",{enabled:l,map:this.map},p,y)},_fireGlobalRemovalModeToggled(l,p="Global",y={}){this.__fire(this.map,"pm:globalremovalmodetoggled",{enabled:l,map:this.map},p,y)},_fireGlobalCutModeToggled(l="Global",p={}){this.__fire(this._map,"pm:globalcutmodetoggled",{enabled:!!this._enabled,map:this._map},l,p)},_fireGlobalDrawModeToggled(l="Global",p={}){this.__fire(this._map,"pm:globaldrawmodetoggled",{enabled:this._enabled,shape:this._shape,map:this._map},l,p)},_fireGlobalRotateModeToggled(l="Global",p={}){this.__fire(this.map,"pm:globalrotatemodetoggled",{enabled:this.globalRotateModeEnabled(),map:this.map},l,p)},_fireRemoveLayerGroup(l,p=l,y="Edit",x={}){this.__fire(l,"pm:remove",{layer:p,shape:void 0},y,x)},_fireKeyeventEvent(l,p,y,x="Global",M={}){this.__fire(this.map,"pm:keyevent",{event:l,eventType:p,focusOn:y},x,M)},__fire(l,p,y,x,M={}){y=(0,Wa.default)(y,M,{source:x}),L.PM.Utils._fireEvent(l,p,y)}},vi=Hn,gl=()=>({_lastEvents:{keydown:void 0,keyup:void 0,current:void 0},_initKeyListener(l){this.map=l,L.DomEvent.on(document,"keydown keyup",this._onKeyListener,this),L.DomEvent.on(window,"blur",this._onBlur,this),l.once("unload",this._unbindKeyListenerEvents,this)},_unbindKeyListenerEvents(){L.DomEvent.off(document,"keydown keyup",this._onKeyListener,this),L.DomEvent.off(window,"blur",this._onBlur,this)},_onKeyListener(l){let p="document";this.map.getContainer().contains(l.target)&&(p="map");let y={event:l,eventType:l.type,focusOn:p};this._lastEvents[l.type]=y,this._lastEvents.current=y,this.map.pm._fireKeyeventEvent(l,l.type,p)},_onBlur(l){l.altKey=!1;let p={event:l,eventType:l.type,focusOn:"document"};this._lastEvents[l.type]=p,this._lastEvents.current=p},getLastKeyEvent(l="current"){return this._lastEvents[l]},isShiftKeyPressed(){return this._lastEvents.current?.event.shiftKey},isAltKeyPressed(){return this._lastEvents.current?.event.altKey},isCtrlKeyPressed(){return this._lastEvents.current?.event.ctrlKey},isMetaKeyPressed(){return this._lastEvents.current?.event.metaKey},getPressedKey(){return this._lastEvents.current?.event.key}}),Nr=gl,ls=se(Si());function li(l){let p=L.PM.activeLang;return(0,ls.default)(ir[p],l)||(0,ls.default)(ir.en,l)||l}function ar(l){for(let p=0;p<l.length;p+=1){let y=l[p];if(Array.isArray(y)){if(ar(y))return!0}else if(y!=null&&y!=="")return!0}return!1}function Wn(l){return l.reduce((p,y)=>{if(y.length!==0){let x=Array.isArray(y)?Wn(y):y;Array.isArray(x)?x.length!==0&&p.push(x):p.push(x)}return p},[])}function ra(l,p,y){let x={a:L.CRS.Earth.R,b:63567523142e-4,f:.0033528106647474805},{a:M,b:A,f:R}=x,j=l.lng,W=l.lat,et=y,Tt=Math.PI,kt=p*Tt/180,ie=Math.sin(kt),Ut=Math.cos(kt),jt=(1-R)*Math.tan(W*Tt/180),de=1/Math.sqrt(1+jt*jt),Fe=jt*de,Mi=Math.atan2(jt,Ut),bt=de*ie,St=1-bt*bt,Zt=St*(M*M-A*A)/(A*A),Jt=1+Zt/16384*(4096+Zt*(-768+Zt*(320-175*Zt))),Ht=Zt/1024*(256+Zt*(-128+Zt*(74-47*Zt))),oe=et/(A*Jt),q=2*Math.PI,Q,ut,ot;for(;Math.abs(oe-q)>1e-12;){Q=Math.cos(2*Mi+oe),ut=Math.sin(oe),ot=Math.cos(oe);let we=Ht*ut*(Q+Ht/4*(ot*(-1+2*Q*Q)-Ht/6*Q*(-3+4*ut*ut)*(-3+4*Q*Q)));q=oe,oe=et/(A*Jt)+we}let ht=Fe*ut-de*ot*Ut,pt=Math.atan2(Fe*ot+de*ut*Ut,(1-R)*Math.sqrt(bt*bt+ht*ht)),Dt=Math.atan2(ut*ie,de*ot-Fe*ut*Ut),Bt=R/16*St*(4+R*(4-3*St)),Ft=Dt-(1-Bt)*R*bt*(oe+Bt*ut*(Q+Bt*ot*(-1+2*Q*Q))),Yt=j+Ft*180/Tt,Wt=pt*180/Tt;return L.latLng(Yt,Wt)}function $s(l,p,y,x,M=!0){let A,R,j,W=[];for(let et=0;et<y;et+=1){if(M)A=et*360/y+x,R=ra(l,A,p),j=L.latLng(R.lng,R.lat);else{let Tt=l.lat+Math.cos(2*et*Math.PI/y)*p,kt=l.lng+Math.sin(2*et*Math.PI/y)*p;j=L.latLng(Tt,kt)}W.push(j)}return W}function lr(l,p,y){p=(p+360)%360;let x=Math.PI/180,M=180/Math.PI,{R:A}=L.CRS.Earth,R=l.lng*x,j=l.lat*x,W=p*x,et=Math.sin(j),Tt=Math.cos(j),kt=Math.cos(y/A),ie=Math.sin(y/A),Ut=Math.asin(et*kt+Tt*ie*Math.cos(W)),jt=R+Math.atan2(Math.sin(W)*ie*Tt,kt-et*Math.sin(Ut));jt*=M;let de=jt-360,Fe=jt<-180?jt+360:jt;return jt=jt>180?de:Fe,L.latLng([Ut*M,jt])}function ao(l,p,y){let x=l.latLngToContainerPoint(p),M=l.latLngToContainerPoint(y),A=Math.atan2(M.y-x.y,M.x-x.x)*180/Math.PI+90;return A+=A<0?360:0,A}function Kn(l,p,y,x){let M=ao(l,p,y);return lr(p,M,x)}function Go(l,p,y="asc"){if(!p||Object.keys(p).length===0)return(W,et)=>W-et;let x=Object.keys(p),M,A=x.length-1,R={};for(;A>=0;)M=x[A],R[M.toLowerCase()]=p[M],A-=1;function j(W){if(W instanceof L.Marker)return"Marker";if(W instanceof L.Circle)return"Circle";if(W instanceof L.CircleMarker)return"CircleMarker";if(W instanceof L.Rectangle)return"Rectangle";if(W instanceof L.Polygon)return"Polygon";if(W instanceof L.Polyline)return"Line"}return(W,et)=>{let Tt,kt;if(l==="instanceofShape"){if(Tt=j(W.layer).toLowerCase(),kt=j(et.layer).toLowerCase(),!Tt||!kt)return 0}else{if(!W.hasOwnProperty(l)||!et.hasOwnProperty(l))return 0;Tt=W[l].toLowerCase(),kt=et[l].toLowerCase()}let ie=Tt in R?R[Tt]:Number.MAX_SAFE_INTEGER,Ut=kt in R?R[kt]:Number.MAX_SAFE_INTEGER,jt=0;return ie<Ut?jt=-1:ie>Ut&&(jt=1),y==="desc"?jt*-1:jt}}function Mr(l,p=l.getLatLngs()){return l instanceof L.Polygon?L.polygon(p).getLatLngs():L.polyline(p).getLatLngs()}function bs(l,p){if(p.options.crs?.projection?.MAX_LATITUDE){let y=p.options.crs?.projection?.MAX_LATITUDE;l.lat=Math.max(Math.min(y,l.lat),-y)}return l}function Xn(l){return l.options.renderer||l._map&&(l._map._getPaneRenderer(l.options.pane)||l._map.options.renderer||l._map._renderer)||l._renderer}var us=L.Class.extend({includes:[Ve,He,Fr,Jr,vi],initialize(l){this.map=l,this.Draw=new L.PM.Draw(l),this.Toolbar=new L.PM.Toolbar(l),this.Keyboard=Nr(),this.globalOptions={snappable:!0,layerGroup:void 0,snappingOrder:["Marker","CircleMarker","Circle","Line","Polygon","Rectangle"],panes:{vertexPane:"markerPane",layerPane:"overlayPane",markerPane:"markerPane"},draggable:!0},this.Keyboard._initKeyListener(l)},setLang(l="en",p,y="en"){if(l=l.trim().toLowerCase(),!/^[a-z]{2}$/.test(l)){let M=l.replace(/[-_\s]/g,"-").replace(/^(\w{2})$/,"$1-").match(/([a-z]{2})-?([a-z]{2})?/);if(M){let A=[`${M[1]}_${M[2]}`,`${M[1]}`];for(let R of A)if(ir[R]){l=R;break}}}let x=L.PM.activeLang;p&&(ir[l]=(0,Zs.default)(ir[y],p)),L.PM.activeLang=l,this.map.pm.Toolbar.reinit(),this._fireLangChange(x,l,y,ir[l])},addControls(l){this.Toolbar.addControls(l)},removeControls(){this.Toolbar.removeControls()},toggleControls(){this.Toolbar.toggleControls()},controlsVisible(){return this.Toolbar.isVisible},enableDraw(l="Polygon",p){l==="Poly"&&(l="Polygon"),this.Draw.enable(l,p)},disableDraw(l="Polygon"){l==="Poly"&&(l="Polygon"),this.Draw.disable(l)},setPathOptions(l,p={}){let y=p.ignoreShapes||[],x=p.merge||!1;this.map.pm.Draw.shapes.forEach(M=>{y.indexOf(M)===-1&&this.map.pm.Draw[M].setPathOptions(l,x)})},getGlobalOptions(){return this.globalOptions},setGlobalOptions(l){let p=(0,Zs.default)(this.globalOptions,l);p.editable&&(p.resizeableCircleMarker=p.editable,delete p.editable);let y=!1;this.map.pm.Draw.CircleMarker.enabled()&&!!this.map.pm.Draw.CircleMarker.options.resizeableCircleMarker!=!!p.resizeableCircleMarker&&(this.map.pm.Draw.CircleMarker.disable(),y=!0);let x=!1;this.map.pm.Draw.Circle.enabled()&&!!this.map.pm.Draw.Circle.options.resizeableCircle!=!!p.resizeableCircle&&(this.map.pm.Draw.Circle.disable(),x=!0),this.map.pm.Draw.shapes.forEach(M=>{this.map.pm.Draw[M].setOptions(p)}),y&&this.map.pm.Draw.CircleMarker.enable(),x&&this.map.pm.Draw.Circle.enable(),L.PM.Utils.findLayers(this.map).forEach(M=>{M.pm.setOptions(p)}),this.map.fire("pm:globaloptionschanged"),this.globalOptions=p,this.applyGlobalOptions()},applyGlobalOptions(){L.PM.Utils.findLayers(this.map).forEach(l=>{l.pm.enabled()&&l.pm.applyOptions()})},globalDrawModeEnabled(){return!!this.Draw.getActiveShape()},globalCutModeEnabled(){return!!this.Draw.Cut.enabled()},enableGlobalCutMode(l){return this.Draw.Cut.enable(l)},toggleGlobalCutMode(l){return this.Draw.Cut.toggle(l)},disableGlobalCutMode(){return this.Draw.Cut.disable()},getGeomanLayers(l=!1){let p=L.PM.Utils.findLayers(this.map);if(!l)return p;let y=L.featureGroup();return y._pmTempLayer=!0,p.forEach(x=>{y.addLayer(x)}),y},getGeomanDrawLayers(l=!1){let p=L.PM.Utils.findLayers(this.map).filter(x=>x._drawnByGeoman===!0);if(!l)return p;let y=L.featureGroup();return y._pmTempLayer=!0,p.forEach(x=>{y.addLayer(x)}),y},_getContainingLayer(){return this.globalOptions.layerGroup&&this.globalOptions.layerGroup instanceof L.LayerGroup?this.globalOptions.layerGroup:this.map},_isCRSSimple(){return this.map.options.crs===L.CRS.Simple},_touchEventCounter:0,_addTouchEvents(l){this._touchEventCounter===0&&(L.DomEvent.on(l,"touchmove",this._canvasTouchMove,this),L.DomEvent.on(l,"touchstart touchend touchcancel",this._canvasTouchClick,this)),this._touchEventCounter+=1},_removeTouchEvents(l){this._touchEventCounter===1&&(L.DomEvent.off(l,"touchmove",this._canvasTouchMove,this),L.DomEvent.off(l,"touchstart touchend touchcancel",this._canvasTouchClick,this)),this._touchEventCounter=this._touchEventCounter<=1?0:this._touchEventCounter-1},_canvasTouchMove(l){Xn(this.map)._onMouseMove(this._createMouseEvent("mousemove",l))},_canvasTouchClick(l){let p="";l.type==="touchstart"||l.type==="pointerdown"?p="mousedown":(l.type==="touchend"||l.type==="pointerup"||l.type==="touchcancel"||l.type==="pointercancel")&&(p="mouseup"),p&&Xn(this.map)._onClick(this._createMouseEvent(p,l))},_createMouseEvent(l,p){let y,x=p.touches[0]||p.changedTouches[0];try{y=new MouseEvent(l,{bubbles:p.bubbles,cancelable:p.cancelable,view:p.view,detail:x.detail,screenX:x.screenX,screenY:x.screenY,clientX:x.clientX,clientY:x.clientY,ctrlKey:p.ctrlKey,altKey:p.altKey,shiftKey:p.shiftKey,metaKey:p.metaKey,button:p.button,relatedTarget:p.relatedTarget})}catch{y=document.createEvent("MouseEvents"),y.initMouseEvent(l,p.bubbles,p.cancelable,p.view,x.detail,x.screenX,x.screenY,x.clientX,x.clientY,p.ctrlKey,p.altKey,p.shiftKey,p.metaKey,p.button,p.relatedTarget)}return y}}),yl=us,Ar=L.Control.extend({includes:[vi],options:{position:"topleft",disableByOtherButtons:!0},initialize(l){this._button=L.Util.extend({},this.options,l)},onAdd(l){return this._map=l,this._map.pm.Toolbar.options.oneBlock?this._container=this._map.pm.Toolbar._createContainer(this.options.position):this._button.tool==="edit"?this._container=this._map.pm.Toolbar.editContainer:this._button.tool==="options"?this._container=this._map.pm.Toolbar.optionsContainer:this._button.tool==="custom"?this._container=this._map.pm.Toolbar.customContainer:this._container=this._map.pm.Toolbar.drawContainer,this._renderButton(),this._container},_renderButton(){let l=this.buttonsDomNode;this.buttonsDomNode=this._makeButton(this._button),l?l.replaceWith(this.buttonsDomNode):this._container.appendChild(this.buttonsDomNode)},onRemove(){return this.buttonsDomNode.remove(),this._container},getText(){return this._button.text},getIconUrl(){return this._button.iconUrl},destroy(){this._button={},this._update()},toggle(l){return typeof l=="boolean"?this._button.toggleStatus=l:this._button.toggleStatus=!this._button.toggleStatus,this._applyStyleClasses(),this._updateActiveAction(this._button),this._button.toggleStatus},toggled(){return this._button.toggleStatus},onCreate(){this.toggle(!1)},disable(){this.toggle(!1),this._button.disabled=!0,this._updateDisabled()},enable(){this._button.disabled=!1,this._updateDisabled(),this._updateActiveAction(this._button)},_triggerClick(l){l&&l.preventDefault(),!this._button.disabled&&(this._button.onClick(l,{button:this,event:l}),this._clicked(l),this._button.afterClick(l,{button:this,event:l}))},_makeButton(l){let p=this.options.position.indexOf("right")>-1?"pos-right":"",y=L.DomUtil.create("div",`button-container  ${p}`,this._container);l.title&&y.setAttribute("title",l.title);let x=L.DomUtil.create("a","leaflet-buttons-control-button",y);x.setAttribute("role","button"),x.setAttribute("tabindex","0"),x.href="#";let M=L.DomUtil.create("div",`leaflet-pm-actions-container ${p}`,y),A=l.actions,R={cancel:{text:li("actions.cancel"),title:li("actions.cancel"),onClick(){this._triggerClick()}},finishMode:{text:li("actions.finish"),title:li("actions.finish"),onClick(){this._triggerClick()}},removeLastVertex:{text:li("actions.removeLastVertex"),title:li("actions.removeLastVertex"),onClick(){this._map.pm.Draw[l.jsClass]._removeLastVertex()}},finish:{text:li("actions.finish"),title:li("actions.finish"),onClick(W){this._map.pm.Draw[l.jsClass]._finishShape(W)}}};l._preparedActions=A.map(W=>{let et=typeof W=="string"?W:W.name,Tt;if(R[et])Tt=R[et];else if(W.text)Tt=W;else return Tt;let kt=L.DomUtil.create("a",`leaflet-pm-action ${p} action-${et}`,M);if(kt.setAttribute("role","button"),kt.setAttribute("tabindex","0"),kt.href="#",Tt.title&&(kt.title=Tt.title),kt.innerHTML=Tt.text,L.DomEvent.disableClickPropagation(kt),L.DomEvent.on(kt,"click",L.DomEvent.stop),Tt._node=kt,!l.disabled&&Tt.onClick){let ie=Ut=>{Ut.preventDefault();let jt="",{buttons:de}=this._map.pm.Toolbar;for(let Fe in de)if(de[Fe]._button===l){jt=Fe;break}this._fireActionClick(Tt,jt,l)};L.DomEvent.addListener(kt,"click",ie,this),L.DomEvent.addListener(kt,"click",Tt.onClick,this),L.DomEvent.addListener(kt,"click",()=>this._updateActiveAction(l))}return Tt}),this._updateActiveAction(l),l.toggleStatus&&L.DomUtil.addClass(y,"active");let j=L.DomUtil.create("div","control-icon",x);return l.iconUrl&&j.setAttribute("src",l.iconUrl),l.className&&L.DomUtil.addClass(j,l.className),L.DomEvent.disableClickPropagation(x),L.DomEvent.on(x,"click",L.DomEvent.stop),l.disabled||(L.DomEvent.addListener(x,"click",this._onBtnClick,this),L.DomEvent.addListener(x,"click",this._triggerClick,this)),l.disabled&&(L.DomUtil.addClass(x,"pm-disabled"),x.setAttribute("aria-disabled","true")),y},_applyStyleClasses(){this._container&&(!this._button.toggleStatus||this._button.cssToggle===!1?(L.DomUtil.removeClass(this.buttonsDomNode,"active"),L.DomUtil.removeClass(this._container,"activeChild")):(L.DomUtil.addClass(this.buttonsDomNode,"active"),L.DomUtil.addClass(this._container,"activeChild")))},_onBtnClick(){if(this._button.disabled)return;this._button.disableOtherButtons&&this._map.pm.Toolbar.triggerClickOnToggledButtons(this);let l="",{buttons:p}=this._map.pm.Toolbar;for(let y in p)if(p[y]._button===this._button){l=y;break}this._fireButtonClick(l,this._button)},_clicked(){this._button.doToggle&&this.toggle()},_updateDisabled(){if(!this._container)return;let l="pm-disabled",p=this.buttonsDomNode.children[0];this._button.disabled?(L.DomUtil.addClass(p,l),p.setAttribute("aria-disabled","true")):(L.DomUtil.removeClass(p,l),p.setAttribute("aria-disabled","false"))},_updateActiveAction(l){l._preparedActions?.forEach(p=>{p?._node&&(p.isActive&&p.isActive.call(this)?L.DomUtil.addClass(p._node,"active-action"):L.DomUtil.removeClass(p._node,"active-action"))})}}),qs=Ar;L.Control.PMButton=qs;var _n=L.Class.extend({options:{drawMarker:!0,drawRectangle:!0,drawPolyline:!0,drawPolygon:!0,drawCircle:!0,drawCircleMarker:!0,drawText:!0,editMode:!0,dragMode:!0,cutPolygon:!0,removalMode:!0,rotateMode:!0,snappingOption:!0,drawControls:!0,editControls:!0,optionsControls:!0,customControls:!0,oneBlock:!1,position:"topleft",positions:{draw:"",edit:"",options:"",custom:""}},customButtons:[],initialize(l){this.customButtons=[],this.options.positions={draw:"",edit:"",options:"",custom:""},this.init(l)},reinit(){let l=this.isVisible;this.removeControls(),this._defineButtons(),l&&this.addControls()},init(l){this.map=l,this.buttons={},this.isVisible=!1,this.drawContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-draw leaflet-bar leaflet-control"),this.editContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-edit leaflet-bar leaflet-control"),this.optionsContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-options leaflet-bar leaflet-control"),this.customContainer=L.DomUtil.create("div","leaflet-pm-toolbar leaflet-pm-custom leaflet-bar leaflet-control"),this._defineButtons()},_createContainer(l){let p=`${l}Container`;return this[p]||(this[p]=L.DomUtil.create("div",`leaflet-pm-toolbar leaflet-pm-${l} leaflet-bar leaflet-control`)),this[p]},getButtons(){return this.buttons},addControls(l=this.options){typeof l.editPolygon<"u"&&(l.editMode=l.editPolygon),typeof l.deleteLayer<"u"&&(l.removalMode=l.deleteLayer),L.Util.setOptions(this,l),this.applyIconStyle(),this.isVisible=!0,this._showHideButtons()},applyIconStyle(){let l=this.getButtons(),p={geomanIcons:{drawMarker:"control-icon leaflet-pm-icon-marker",drawPolyline:"control-icon leaflet-pm-icon-polyline",drawRectangle:"control-icon leaflet-pm-icon-rectangle",drawPolygon:"control-icon leaflet-pm-icon-polygon",drawCircle:"control-icon leaflet-pm-icon-circle",drawCircleMarker:"control-icon leaflet-pm-icon-circle-marker",editMode:"control-icon leaflet-pm-icon-edit",dragMode:"control-icon leaflet-pm-icon-drag",cutPolygon:"control-icon leaflet-pm-icon-cut",removalMode:"control-icon leaflet-pm-icon-delete",drawText:"control-icon leaflet-pm-icon-text"}};for(let y in l){let x=l[y];L.Util.setOptions(x,{className:p.geomanIcons[y]})}},removeControls(){let l=this.getButtons();for(let p in l)l[p].remove();this.isVisible=!1},toggleControls(l=this.options){this.isVisible?this.removeControls():this.addControls(l)},_addButton(l,p){return this.buttons[l]=p,this.options[l]=!!this.options[l]||!1,this.buttons[l]},triggerClickOnToggledButtons(l){for(let p in this.buttons){let y=this.buttons[p];y._button.disableByOtherButtons&&y!==l&&y.toggled()&&y._triggerClick()}},toggleButton(l,p,y=!0){l==="editPolygon"&&(l="editMode"),l==="deleteLayer"&&(l="removalMode");let x=l;return y&&this.triggerClickOnToggledButtons(this.buttons[x]),this.buttons[x]?this.buttons[x].toggle(p):!1},_defineButtons(){let l={className:"control-icon leaflet-pm-icon-marker",title:li("buttonTitles.drawMarkerButton"),jsClass:"Marker",onClick:()=>{},afterClick:(ie,Ut)=>{this.map.pm.Draw[Ut.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},p={title:li("buttonTitles.drawPolyButton"),className:"control-icon leaflet-pm-icon-polygon",jsClass:"Polygon",onClick:()=>{},afterClick:(ie,Ut)=>{this.map.pm.Draw[Ut.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["finish","removeLastVertex","cancel"]},y={className:"control-icon leaflet-pm-icon-polyline",title:li("buttonTitles.drawLineButton"),jsClass:"Line",onClick:()=>{},afterClick:(ie,Ut)=>{this.map.pm.Draw[Ut.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["finish","removeLastVertex","cancel"]},x={title:li("buttonTitles.drawCircleButton"),className:"control-icon leaflet-pm-icon-circle",jsClass:"Circle",onClick:()=>{},afterClick:(ie,Ut)=>{this.map.pm.Draw[Ut.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},M={title:li("buttonTitles.drawCircleMarkerButton"),className:"control-icon leaflet-pm-icon-circle-marker",jsClass:"CircleMarker",onClick:()=>{},afterClick:(ie,Ut)=>{this.map.pm.Draw[Ut.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},A={title:li("buttonTitles.drawRectButton"),className:"control-icon leaflet-pm-icon-rectangle",jsClass:"Rectangle",onClick:()=>{},afterClick:(ie,Ut)=>{this.map.pm.Draw[Ut.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]},R={title:li("buttonTitles.editButton"),className:"control-icon leaflet-pm-icon-edit",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalEditMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},j={title:li("buttonTitles.dragButton"),className:"control-icon leaflet-pm-icon-drag",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalDragMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},W={title:li("buttonTitles.cutButton"),className:"control-icon leaflet-pm-icon-cut",jsClass:"Cut",onClick:()=>{},afterClick:(ie,Ut)=>{this.map.pm.Draw[Ut.button._button.jsClass].toggle({snappable:!0,cursorMarker:!0,allowSelfIntersection:!1})},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finish","removeLastVertex","cancel"]},et={title:li("buttonTitles.deleteButton"),className:"control-icon leaflet-pm-icon-delete",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalRemovalMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},Tt={title:li("buttonTitles.rotateButton"),className:"control-icon leaflet-pm-icon-rotate",onClick:()=>{},afterClick:()=>{this.map.pm.toggleGlobalRotateMode()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,tool:"edit",actions:["finishMode"]},kt={className:"control-icon leaflet-pm-icon-text",title:li("buttonTitles.drawTextButton"),jsClass:"Text",onClick:()=>{},afterClick:(ie,Ut)=>{this.map.pm.Draw[Ut.button._button.jsClass].toggle()},doToggle:!0,toggleStatus:!1,disableOtherButtons:!0,position:this.options.position,actions:["cancel"]};this._addButton("drawMarker",new L.Control.PMButton(l)),this._addButton("drawPolyline",new L.Control.PMButton(y)),this._addButton("drawRectangle",new L.Control.PMButton(A)),this._addButton("drawPolygon",new L.Control.PMButton(p)),this._addButton("drawCircle",new L.Control.PMButton(x)),this._addButton("drawCircleMarker",new L.Control.PMButton(M)),this._addButton("drawText",new L.Control.PMButton(kt)),this._addButton("editMode",new L.Control.PMButton(R)),this._addButton("dragMode",new L.Control.PMButton(j)),this._addButton("cutPolygon",new L.Control.PMButton(W)),this._addButton("removalMode",new L.Control.PMButton(et)),this._addButton("rotateMode",new L.Control.PMButton(Tt))},_showHideButtons(){if(!this.isVisible)return;this.removeControls(),this.isVisible=!0;let l=this.getButtons(),p=[];this.options.drawControls===!1&&(p=p.concat(Object.keys(l).filter(y=>!l[y]._button.tool))),this.options.editControls===!1&&(p=p.concat(Object.keys(l).filter(y=>l[y]._button.tool==="edit"))),this.options.optionsControls===!1&&(p=p.concat(Object.keys(l).filter(y=>l[y]._button.tool==="options"))),this.options.customControls===!1&&(p=p.concat(Object.keys(l).filter(y=>l[y]._button.tool==="custom")));for(let y in l)if(this.options[y]&&p.indexOf(y)===-1){let x=l[y]._button.tool;x||(x="draw"),l[y].setPosition(this._getBtnPosition(x)),l[y].addTo(this.map)}},_getBtnPosition(l){return this.options.positions&&this.options.positions[l]?this.options.positions[l]:this.options.position},setBlockPosition(l,p){this.options.positions[l]=p,this._showHideButtons(),this.changeControlOrder()},getBlockPositions(){return this.options.positions},copyDrawControl(l,p){if(p)typeof p!="object"&&(p={name:p});else throw new TypeError("Button has no name");let y=this._btnNameMapping(l);if(!p.name)throw new TypeError("Button has no name");if(this.buttons[p.name])throw new TypeError("Button with this name already exists");let x=this.map.pm.Draw.createNewDrawInstance(p.name,y);p=kr(kr({},this.buttons[y]._button),p);let M=this.createCustomControl(p);return{drawInstance:x,control:M}},createCustomControl(l){if(!l.name)throw new TypeError("Button has no name");if(this.buttons[l.name])throw new TypeError("Button with this name already exists");l.onClick||(l.onClick=()=>{}),l.afterClick||(l.afterClick=()=>{}),l.toggle!==!1&&(l.toggle=!0),l.block&&(l.block=l.block.toLowerCase()),(!l.block||l.block==="draw")&&(l.block=""),l.className?l.className.indexOf("control-icon")===-1&&(l.className=`control-icon ${l.className}`):l.className="control-icon";let p={tool:l.block,className:l.className,title:l.title||"",jsClass:l.name,onClick:l.onClick,afterClick:l.afterClick,doToggle:l.toggle,toggleStatus:!1,disableOtherButtons:l.disableOtherButtons??!0,disableByOtherButtons:l.disableByOtherButtons??!0,cssToggle:l.toggle,position:this.options.position,actions:l.actions||[],disabled:!!l.disabled};this.options[l.name]!==!1&&(this.options[l.name]=!0);let y=this._addButton(l.name,new L.Control.PMButton(p));return this.changeControlOrder(),y},controlExists(l){return!!this.getButton(l)},getButton(l){return this.getButtons()[l]},getButtonsInBlock(l){let p={};if(l)for(let y in this.getButtons()){let x=this.getButtons()[y];(x._button.tool===l||l==="draw"&&!x._button.tool)&&(p[y]=x)}return p},changeControlOrder(l=[]){let p=this._shapeMapping(),y=[];l.forEach(A=>{p[A]?y.push(p[A]):y.push(A)});let x=this.getButtons(),M={};y.forEach(A=>{x[A]&&(M[A]=x[A])}),Object.keys(x).filter(A=>!x[A]._button.tool||x[A]._button.tool==="draw").forEach(A=>{y.indexOf(A)===-1&&(M[A]=x[A])}),Object.keys(x).filter(A=>x[A]._button.tool==="edit").forEach(A=>{y.indexOf(A)===-1&&(M[A]=x[A])}),Object.keys(x).filter(A=>x[A]._button.tool==="options").forEach(A=>{y.indexOf(A)===-1&&(M[A]=x[A])}),Object.keys(x).filter(A=>x[A]._button.tool==="custom").forEach(A=>{y.indexOf(A)===-1&&(M[A]=x[A])}),Object.keys(x).forEach(A=>{y.indexOf(A)===-1&&(M[A]=x[A])}),this.map.pm.Toolbar.buttons=M,this._showHideButtons()},getControlOrder(){let l=this.getButtons(),p=[];for(let y in l)p.push(y);return p},changeActionsOfControl(l,p){let y=this._btnNameMapping(l);if(!y)throw new TypeError("No name passed");if(!p)throw new TypeError("No actions passed");if(!this.buttons[y])throw new TypeError("Button with this name not exists");this.buttons[y]._button.actions=p,this.changeControlOrder()},setButtonDisabled(l,p){let y=this._btnNameMapping(l);p?this.buttons[y].disable():this.buttons[y].enable()},_shapeMapping(){return{Marker:"drawMarker",Circle:"drawCircle",Polygon:"drawPolygon",Rectangle:"drawRectangle",Polyline:"drawPolyline",Line:"drawPolyline",CircleMarker:"drawCircleMarker",Edit:"editMode",Drag:"dragMode",Cut:"cutPolygon",Removal:"removalMode",Rotate:"rotateMode",Text:"drawText"}},_btnNameMapping(l){let p=this._shapeMapping();return p[l]?p[l]:l}}),jr=_n,Sa=se(Sn()),na={_initSnappableMarkers(){this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,this._assignEvents(this._markers),this._layer.off("pm:dragstart",this._unsnap,this),this._layer.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){this._layer.off("pm:dragstart",this._unsnap,this)},_assignEvents(l){l.forEach(p=>{if(Array.isArray(p)){this._assignEvents(p);return}p.off("drag",this._handleSnapping,this),p.on("drag",this._handleSnapping,this),p.off("dragend",this._cleanupSnapping,this),p.on("dragend",this._cleanupSnapping,this)})},_cleanupSnapping(l){if(l){let p=l.target;p._snapped=!1}delete this._snapList,this.throttledList&&(this._map.off("layeradd",this.throttledList,this),this.throttledList=void 0),this._map.off("layerremove",this._handleSnapLayerRemoval,this),this.debugIndicatorLines&&this.debugIndicatorLines.forEach(p=>{p.remove()})},_handleThrottleSnapping(){this.throttledList&&this._createSnapList()},_handleSnapping(l){let p=l.target;if(p._snapped=!1,this.throttledList||(this.throttledList=L.Util.throttle(this._handleThrottleSnapping,100,this)),l?.originalEvent?.altKey||this._map?.pm?.Keyboard.isAltKeyPressed()||(this._snapList===void 0&&(this._createSnapList(),this._map.off("layeradd",this.throttledList,this),this._map.on("layeradd",this.throttledList,this)),this._snapList.length<=0))return!1;let y=this._calcClosestLayer(p.getLatLng(),this._snapList);if(Object.keys(y).length===0)return!1;let x=y.layer instanceof L.Marker||y.layer instanceof L.CircleMarker||!this.options.snapSegment,M;x?M=y.latlng:M=this._checkPrioritiySnapping(y);let A=this.options.snapDistance,R={marker:p,shape:this._shape,snapLatLng:M,segment:y.segment,layer:this._layer,workingLayer:this._layer,layerInteractedWith:y.layer,distance:y.distance};if(this._fireSnapDrag(R.marker,R),this._fireSnapDrag(this._layer,R),y.distance<A){p._orgLatLng=p.getLatLng(),p.setLatLng(M),p._snapped=!0,p._snapInfo=R;let j=()=>{this._snapLatLng=M,this._fireSnap(p,R),this._fireSnap(this._layer,R)},W=this._snapLatLng||{},et=M||{};(W.lat!==et.lat||W.lng!==et.lng)&&j()}else this._snapLatLng&&(this._unsnap(R),p._snapped=!1,p._snapInfo=void 0,this._fireUnsnap(R.marker,R),this._fireUnsnap(this._layer,R));return!0},_createSnapList(){let l=[],p=[],y=this._map;y.off("layerremove",this._handleSnapLayerRemoval,this),y.on("layerremove",this._handleSnapLayerRemoval,this),y.eachLayer(x=>{if((x instanceof L.Polyline||x instanceof L.Marker||x instanceof L.CircleMarker||x instanceof L.ImageOverlay)&&x.options.snapIgnore!==!0){if(x.options.snapIgnore===void 0&&(!L.PM.optIn&&x.options.pmIgnore===!0||L.PM.optIn&&x.options.pmIgnore!==!1))return;(x instanceof L.Circle||x instanceof L.CircleMarker)&&x.pm&&x.pm._hiddenPolyCircle?l.push(x.pm._hiddenPolyCircle):x instanceof L.ImageOverlay&&(x=L.rectangle(x.getBounds())),l.push(x);let M=L.polyline([],{color:"red",pmIgnore:!0});M._pmTempLayer=!0,p.push(M),(x instanceof L.Circle||x instanceof L.CircleMarker)&&p.push(M)}}),l=l.filter(x=>this._layer!==x),l=l.filter(x=>x._latlng||x._latlngs&&ar(x._latlngs)),l=l.filter(x=>!x._pmTempLayer),this._otherSnapLayers?(this._otherSnapLayers.forEach(()=>{let x=L.polyline([],{color:"red",pmIgnore:!0});x._pmTempLayer=!0,p.push(x)}),this._snapList=l.concat(this._otherSnapLayers)):this._snapList=l,this.debugIndicatorLines=p},_handleSnapLayerRemoval({layer:l}){if(!l._leaflet_id)return;let p=this._snapList.findIndex(y=>y._leaflet_id===l._leaflet_id);p>-1&&this._snapList.splice(p,1)},_calcClosestLayer(l,p){return this._calcClosestLayers(l,p,1)[0]},_calcClosestLayers(l,p,y=1){let x=[],M={};p.forEach((R,j)=>{if(R._parentCopy&&R._parentCopy===this._layer||R.getLatLngs?.().flat(5).length<2)return;let W=this._calcLayerDistances(l,R);if(W.distance=Math.floor(W.distance),this.debugIndicatorLines){if(!this.debugIndicatorLines[j]){let et=L.polyline([],{color:"red",pmIgnore:!0});et._pmTempLayer=!0,this.debugIndicatorLines[j]=et}this.debugIndicatorLines[j].setLatLngs([l,W.latlng])}y===1&&(M.distance===void 0||W.distance-5<=M.distance)?(W.distance+5<M.distance&&(x=[]),M=W,M.layer=R,x.push(M)):y!==1&&(M={},M=W,M.layer=R,x.push(M))}),y!==1&&(x=x.sort((R,j)=>R.distance-j.distance)),y===-1&&(y=x.length);let A=this._getClosestLayerByPriority(x,y);return L.Util.isArray(A)?A:[A]},_calcLayerDistances(l,p){let y=this._map,x=p instanceof L.Marker||p instanceof L.CircleMarker,M=p instanceof L.Polygon,A=l;if(x){let R=p.getLatLng();return{latlng:kr({},R),distance:this._getDistance(y,R,A)}}return this._calcLatLngDistances(A,p.getLatLngs(),y,M)},_calcLatLngDistances(l,p,y,x=!1){let M,A,R,j=W=>{W.forEach((et,Tt)=>{if(Array.isArray(et)){j(et);return}if(this.options.snapSegment){let kt=et,ie;x?ie=Tt+1===W.length?0:Tt+1:ie=Tt+1===W.length?void 0:Tt+1;let Ut=W[ie];if(Ut){let jt=this._getDistanceToSegment(y,l,kt,Ut);(A===void 0||jt<A)&&(A=jt,R=[kt,Ut])}}else{let kt=this._getDistance(y,l,et);(A===void 0||kt<A)&&(A=kt,M=et)}})};return j(p),this.options.snapSegment?{latlng:kr({},this._getClosestPointOnSegment(y,l,R[0],R[1])),segment:R,distance:A}:{latlng:M,distance:A}},_getClosestLayerByPriority(l,p=1){l=l.sort((R,j)=>R._leaflet_id-j._leaflet_id);let y=["Marker","CircleMarker","Circle","Line","Polygon","Rectangle"],x=this._map.pm.globalOptions.snappingOrder||[],M=0,A={};return x.concat(y).forEach(R=>{A[R]||(M+=1,A[R]=M)}),l.sort(Go("instanceofShape",A)),p===1?l[0]||{}:l.slice(0,p)},_checkPrioritiySnapping(l){let p=this._map,y=l.segment[0],x=l.segment[1],M=l.latlng,A=M;if(this.options.snapVertex){let R=this._getDistance(p,y,M),j=this._getDistance(p,x,M),W=R<j?y:x,et=R<j?R:j;if(this.options.snapMiddle){let kt=L.PM.Utils.calcMiddleLatLng(p,y,x),ie=this._getDistance(p,kt,M);ie<R&&ie<j&&(W=kt,et=ie)}let Tt=this.options.snapDistance;et<Tt&&(A=W)}return kr({},A)},_unsnap(){delete this._snapLatLng},_getClosestPointOnSegment(l,p,y,x){let M=l.getMaxZoom();M===1/0&&(M=l.getZoom());let A=l.project(p,M),R=l.project(y,M),j=l.project(x,M),W=L.LineUtil.closestPointOnSegment(A,R,j);return l.unproject(W,M)},_getDistanceToSegment(l,p,y,x){let M=l.latLngToContainerPoint(p),A=l.latLngToContainerPoint(y),R=l.latLngToContainerPoint(x);return L.LineUtil.pointToSegmentDistance(M,A,R)},_getDistance(l,p,y){return l.latLngToContainerPoint(p).distanceTo(l.latLngToContainerPoint(y))}},lo=na,sa=L.Class.extend({includes:[lo,vi],options:{snappable:!0,snapDistance:20,snapMiddle:!1,allowSelfIntersection:!0,tooltips:!0,templineStyle:{},hintlineStyle:{color:"#3388ff",dashArray:"5,5"},pathOptions:null,cursorMarker:!0,finishOn:null,markerStyle:{draggable:!0,icon:L.icon()},hideMiddleMarkers:!1,minRadiusCircle:null,maxRadiusCircle:null,minRadiusCircleMarker:null,maxRadiusCircleMarker:null,resizeableCircleMarker:!1,resizeableCircle:!0,markerEditable:!0,continueDrawing:!1,snapSegment:!0,requireSnapToFinish:!1,rectangleAngle:0,textOptions:{text:null,focusAfterDraw:null,removeIfEmpty:null,className:null},snapVertex:!0},setOptions(l){L.Util.setOptions(this,l),this.setStyle(this.options)},setStyle(){},getOptions(){return this.options},initialize(l){let p=new L.Icon.Default;p.options.tooltipAnchor=[0,0],this.options.markerStyle.icon=p,this._map=l,this.shapes=["Marker","CircleMarker","Line","Polygon","Rectangle","Circle","Cut","Text"],this.shapes.forEach(y=>{this[y]=new L.PM.Draw[y](this._map)}),this.Marker.setOptions({continueDrawing:!0}),this.CircleMarker.setOptions({continueDrawing:!0})},setPathOptions(l,p=!1){p?this.options.pathOptions=(0,Sa.default)(this.options.pathOptions,l):this.options.pathOptions=l},getShapes(){return this.shapes},getShape(){return this._shape},enable(l,p){if(!l)throw new Error(`Error: Please pass a shape as a parameter. Possible shapes are: ${this.getShapes().join(",")}`);this.disable(),this[l].enable(p)},disable(){this.shapes.forEach(l=>{this[l].disable()})},addControls(){this.shapes.forEach(l=>{this[l].addButton()})},getActiveShape(){let l;return this.shapes.forEach(p=>{this[p]._enabled&&(l=p)}),l},_setGlobalDrawMode(){this._shape==="Cut"?this._fireGlobalCutModeToggled():this._fireGlobalDrawModeToggled();let l=[];this._map.eachLayer(p=>{(p instanceof L.Polyline||p instanceof L.Marker||p instanceof L.Circle||p instanceof L.CircleMarker||p instanceof L.ImageOverlay)&&(p._pmTempLayer||l.push(p))}),this._enabled?l.forEach(p=>{L.PM.Utils.disablePopup(p)}):l.forEach(p=>{L.PM.Utils.enablePopup(p)})},createNewDrawInstance(l,p){let y=this._getShapeFromBtnName(p);if(this[l])throw new TypeError("Draw Type already exists");if(!L.PM.Draw[y])throw new TypeError(`There is no class L.PM.Draw.${y}`);return this[l]=new L.PM.Draw[y](this._map),this[l].toolbarButtonName=l,this[l]._shape=l,this.shapes.push(l),this[p]&&this[l].setOptions(this[p].options),this[l].setOptions(this[l].options),this[l]},_getShapeFromBtnName(l){let p={drawMarker:"Marker",drawCircle:"Circle",drawPolygon:"Polygon",drawPolyline:"Line",drawRectangle:"Rectangle",drawCircleMarker:"CircleMarker",editMode:"Edit",dragMode:"Drag",cutPolygon:"Cut",removalMode:"Removal",rotateMode:"Rotate",drawText:"Text"};return p[l]?p[l]:this[l]?this[l]._shape:l},_finishLayer(l){l.pm&&(l.pm.setOptions(this.options),l.pm._shape=this._shape,l.pm._map=this._map),this._addDrawnLayerProp(l)},_addDrawnLayerProp(l){l._drawnByGeoman=!0},_setPane(l,p){p==="layerPane"?l.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.layerPane||"overlayPane":p==="vertexPane"?l.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.vertexPane||"markerPane":p==="markerPane"&&(l.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.markerPane||"markerPane")},_isFirstLayer(){return(this._map||this._layer._map).pm.getGeomanLayers().length===0}}),Lr=sa;Lr.Marker=Lr.extend({initialize(l){this._map=l,this._shape="Marker",this.toolbarButtonName="drawMarker"},enable(l){L.Util.setOptions(this,l),this._enabled=!0,this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._createMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._hintMarker=L.marker(this._map.getCenter(),this.options.markerStyle),this._setPane(this._hintMarker,"markerPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this.options.tooltips&&this._hintMarker.bindTooltip(li("tooltips.placeMarker"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._layer=this._hintMarker,this._map.on("mousemove",this._syncHintMarker,this),this.options.markerEditable&&this._map.eachLayer(p=>{this.isRelevantMarker(p)&&p.pm.enable()}),this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._createMarker,this),this._hintMarker.remove(),this._map.off("mousemove",this._syncHintMarker,this),this._map.eachLayer(l=>{this.isRelevantMarker(l)&&l.pm.disable()}),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(l){this.enabled()?this.disable():this.enable(l)},isRelevantMarker(l){return l instanceof L.Marker&&l.pm&&!l._pmTempLayer&&!l.pm._initTextMarker},_syncHintMarker(l){if(this._hintMarker.setLatLng(l.latlng),this.options.snappable){let p=l;p.target=this._hintMarker,this._handleSnapping(p)}this._fireChange(this._hintMarker.getLatLng(),"Draw")},_createMarker(l){if(!l.latlng||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(l.latlng);let p=this._hintMarker.getLatLng(),y=new L.Marker(p,this.options.markerStyle);this._setPane(y,"markerPane"),this._finishLayer(y),y.pm||(y.options.draggable=!1),y.addTo(this._map.pm._getContainingLayer()),y.pm&&this.options.markerEditable?y.pm.enable():y.dragging&&y.dragging.disable(),this._fireCreate(y),this._cleanupSnapping(),this.options.continueDrawing||this.disable()},setStyle(){this.options.markerStyle?.icon&&this._hintMarker?.setIcon(this.options.markerStyle.icon)}});var Ir=63710088e-1,Ka={centimeters:Ir*100,centimetres:Ir*100,degrees:Ir/111325,feet:Ir*3.28084,inches:Ir*39.37,kilometers:Ir/1e3,kilometres:Ir/1e3,meters:Ir,metres:Ir,miles:Ir/1609.344,millimeters:Ir*1e3,millimetres:Ir*1e3,nauticalmiles:Ir/1852,radians:1,yards:Ir*1.0936},Xa={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Ir,yards:1.0936133};function Gr(l,p,y){y===void 0&&(y={});var x={type:"Feature"};return(y.id===0||y.id)&&(x.id=y.id),y.bbox&&(x.bbox=y.bbox),x.properties=p||{},x.geometry=l,x}function ws(l,p,y){if(y===void 0&&(y={}),!l)throw new Error("coordinates is required");if(!Array.isArray(l))throw new Error("coordinates must be an Array");if(l.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Zo(l[0])||!Zo(l[1]))throw new Error("coordinates must contain numbers");var x={type:"Point",coordinates:l};return Gr(x,p,y)}function En(l,p,y){if(y===void 0&&(y={}),l.length<2)throw new Error("coordinates must be an array of two or more positions");var x={type:"LineString",coordinates:l};return Gr(x,p,y)}function Yi(l,p){p===void 0&&(p={});var y={type:"FeatureCollection"};return p.id&&(y.id=p.id),p.bbox&&(y.bbox=p.bbox),y.features=l,y}function ka(l,p){p===void 0&&(p="kilometers");var y=Ka[p];if(!y)throw new Error(p+" units is invalid");return l*y}function oa(l,p){p===void 0&&(p="kilometers");var y=Ka[p];if(!y)throw new Error(p+" units is invalid");return l/y}function An(l){var p=l%(2*Math.PI);return p*180/Math.PI}function gn(l){var p=l%360;return p*Math.PI/180}function Zo(l){return!isNaN(l)&&l!==null&&!Array.isArray(l)}function Hs(l){var p,y,x={type:"FeatureCollection",features:[]};if(l.type==="Feature"?y=l.geometry:y=l,y.type==="LineString")p=[y.coordinates];else if(y.type==="MultiLineString")p=y.coordinates;else if(y.type==="MultiPolygon")p=[].concat.apply([],y.coordinates);else if(y.type==="Polygon")p=y.coordinates;else throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");return p.forEach(function(M){p.forEach(function(A){for(var R=0;R<M.length-1;R++)for(var j=R;j<A.length-1;j++)if(!(M===A&&(Math.abs(R-j)===1||R===0&&j===M.length-2&&M[R][0]===M[M.length-1][0]&&M[R][1]===M[M.length-1][1]))){var W=aa(M[R][0],M[R][1],M[R+1][0],M[R+1][1],A[j][0],A[j][1],A[j+1][0],A[j+1][1]);W&&x.features.push(ws([W[0],W[1]]))}})}),x}function aa(l,p,y,x,M,A,R,j){var W,et,Tt,kt,ie,Ut={x:null,y:null,onLine1:!1,onLine2:!1};return W=(j-A)*(y-l)-(R-M)*(x-p),W===0?Ut.x!==null&&Ut.y!==null?Ut:!1:(et=p-A,Tt=l-M,kt=(R-M)*et-(j-A)*Tt,ie=(y-l)*et-(x-p)*Tt,et=kt/W,Tt=ie/W,Ut.x=l+et*(y-l),Ut.y=p+et*(x-p),et>=0&&et<=1&&(Ut.onLine1=!0),Tt>=0&&Tt<=1&&(Ut.onLine2=!0),Ut.onLine1&&Ut.onLine2?[Ut.x,Ut.y]:!1)}Lr.Line=Lr.extend({initialize(l){this._map=l,this._shape="Line",this.toolbarButtonName="drawPolyline",this._doesSelfIntersect=!1},enable(l){L.Util.setOptions(this,l),this._enabled=!0,this._markers=[],this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.polyline([],Al(kr({},this.options.templineStyle),{pmIgnore:!1})),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._layerGroup.addLayer(this._layer),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._hintMarker=L.marker(this._map.getCenter(),{interactive:!1,zIndexOffset:100,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(li("tooltips.firstVertex"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._createVertex,this),this.options.finishOn&&this.options.finishOn!=="snap"&&this._map.on(this.options.finishOn,this._finishShape,this),this.options.finishOn==="dblclick"&&(this.tempMapDoubleClickZoomState=this._map.doubleClickZoom._enabled,this.tempMapDoubleClickZoomState&&this._map.doubleClickZoom.disable()),this._map.on("mousemove",this._syncHintMarker,this),this._hintMarker.on("move",this._syncHintLine,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],this.isRed=!1,this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._createVertex,this),this._map.off("mousemove",this._syncHintMarker,this),this.options.finishOn&&this.options.finishOn!=="snap"&&this._map.off(this.options.finishOn,this._finishShape,this),this.tempMapDoubleClickZoomState&&this._map.doubleClickZoom.enable(),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(l){this.enabled()?this.disable():this.enable(l)},_syncHintLine(){let l=this._layer.getLatLngs();if(l.length>0){let p=l[l.length-1];this._hintline.setLatLngs([p,this._hintMarker.getLatLng()])}},_syncHintMarker(l){if(this._hintMarker.setLatLng(l.latlng),this.options.snappable){let y=l;y.target=this._hintMarker,this._handleSnapping(y)}this.options.allowSelfIntersection||this._handleSelfIntersection(!0,this._hintMarker.getLatLng());let p=this._layer._defaultShape().slice();p.push(this._hintMarker.getLatLng()),this._change(p)},hasSelfIntersection(){return Hs(this._layer.toGeoJSON(15)).features.length>0},_handleSelfIntersection(l,p){let y=L.polyline(this._layer.getLatLngs());l&&(p||(p=this._hintMarker.getLatLng()),y.addLatLng(p));let x=Hs(y.toGeoJSON(15));this._doesSelfIntersect=x.features.length>0,this._doesSelfIntersect?this.isRed||(this.isRed=!0,this._hintline.setStyle({color:"#f00000ff"}),this._fireIntersect(x,this._map,"Draw")):this._hintline.isEmpty()||(this.isRed=!1,this._hintline.setStyle(this.options.hintlineStyle))},_createVertex(l){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,l.latlng),this._doesSelfIntersect))return;this._hintMarker._snapped||this._hintMarker.setLatLng(l.latlng);let p=this._hintMarker.getLatLng(),y=this._layer.getLatLngs(),x=y[y.length-1];if(p.equals(y[0])||y.length>0&&p.equals(x)){this._finishShape();return}this._layer._latlngInfo=this._layer._latlngInfo||[],this._layer._latlngInfo.push({latlng:p,snapInfo:this._hintMarker._snapInfo}),this._layer.addLatLng(p);let M=this._createMarker(p);this._setTooltipText(),this._setHintLineAfterNewVertex(p),this._fireVertexAdded(M,void 0,p,"Draw"),this._change(this._layer.getLatLngs()),this.options.finishOn==="snap"&&this._hintMarker._snapped&&this._finishShape(l)},_setHintLineAfterNewVertex(l){this._hintline.setLatLngs([l,l])},_removeLastVertex(){let l=this._markers;if(l.length<=1){this.disable();return}let p=this._layer.getLatLngs(),y=l[l.length-1],{indexPath:x}=L.PM.Utils.findDeepMarkerIndex(l,y);l.pop(),this._layerGroup.removeLayer(y);let M=l[l.length-1],A=p.indexOf(M.getLatLng());p=p.slice(0,A+1),this._layer.setLatLngs(p),this._layer._latlngInfo.pop(),this._syncHintLine(),this._setTooltipText(),this._fireVertexRemoved(y,x,"Draw"),this._change(this._layer.getLatLngs())},_finishShape(){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!1),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let l=this._layer.getLatLngs();if(l.length<=1)return;let p=L.polyline(l,this.options.pathOptions);this._setPane(p,"layerPane"),this._finishLayer(p),p.addTo(this._map.pm._getContainingLayer()),this._fireCreate(p),this.options.snappable&&this._cleanupSnapping();let y=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(y))},_createMarker(l){let p=new L.Marker(l,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._setPane(p,"vertexPane"),p._pmTempLayer=!0,this._layerGroup.addLayer(p),this._markers.push(p),p.on("click",this._finishShape,this),p},_setTooltipText(){let{length:l}=this._layer.getLatLngs().flat(),p="";l<=1?p=li("tooltips.continueLine"):p=li("tooltips.finishLine"),this._hintMarker.setTooltipContent(p)},_change(l){this._fireChange(l,"Draw")},setStyle(){this._layer?.setStyle(this.options.templineStyle),this._hintline?.setStyle(this.options.hintlineStyle)}}),Lr.Polygon=Lr.Line.extend({initialize(l){this._map=l,this._shape="Polygon",this.toolbarButtonName="drawPolygon"},enable(l){L.PM.Draw.Line.prototype.enable.call(this,l),this._layer.pm._shape="Polygon"},_createMarker(l){let p=new L.Marker(l,{draggable:!1,icon:L.divIcon({className:"marker-icon"})});return this._setPane(p,"vertexPane"),p._pmTempLayer=!0,this._layerGroup.addLayer(p),this._markers.push(p),this._layer.getLatLngs().flat().length===1?(p.on("click",this._finishShape,this),this._tempSnapLayerIndex=this._otherSnapLayers.push(p)-1,this.options.snappable&&this._cleanupSnapping()):p.on("click",()=>1),p},_setTooltipText(){let{length:l}=this._layer.getLatLngs().flat(),p="";l<=2?p=li("tooltips.continueLine"):p=li("tooltips.finishPoly"),this._hintMarker.setTooltipContent(p)},_finishShape(){if(!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,this._layer.getLatLngs()[0]),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let l=this._layer.getLatLngs();if(l.length<=2)return;let p=L.polygon(l,this.options.pathOptions);this._setPane(p,"layerPane"),this._finishLayer(p),p.addTo(this._map.pm._getContainingLayer()),this._fireCreate(p),this._cleanupSnapping(),this._otherSnapLayers.splice(this._tempSnapLayerIndex,1),delete this._tempSnapLayerIndex;let y=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(y))}}),Lr.Rectangle=Lr.extend({initialize(l){this._map=l,this._shape="Rectangle",this.toolbarButtonName="drawRectangle"},enable(l){if(L.Util.setOptions(this,l),this._enabled=!0,this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=L.rectangle([[0,0],[0,0]],this.options.pathOptions),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._startMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon rect-start-marker"}),draggable:!1,zIndexOffset:-100,opacity:this.options.cursorMarker?1:0}),this._setPane(this._startMarker,"vertexPane"),this._startMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._startMarker),this._hintMarker=L.marker(this._map.getCenter(),{zIndexOffset:150,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(li("tooltips.firstVertex"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this.options.cursorMarker){this._styleMarkers=[];for(let p=0;p<2;p+=1){let y=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon rect-style-marker"}),draggable:!1,zIndexOffset:100});this._setPane(y,"vertexPane"),y._pmTempLayer=!0,this._layerGroup.addLayer(y),this._styleMarkers.push(y)}}this._map.getContainer().classList.add("geoman-draw-cursor"),this._map.on("click",this._placeStartingMarkers,this),this._map.on("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._otherSnapLayers=[],this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("click",this._finishShape,this),this._map.off("click",this._placeStartingMarkers,this),this._map.off("mousemove",this._syncHintMarker,this),this._map.removeLayer(this._layerGroup),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(l){this.enabled()?this.disable():this.enable(l)},_placeStartingMarkers(l){this._hintMarker._snapped||this._hintMarker.setLatLng(l.latlng);let p=this._hintMarker.getLatLng();L.DomUtil.addClass(this._startMarker._icon,"visible"),this._startMarker.setLatLng(p),this.options.cursorMarker&&this._styleMarkers&&this._styleMarkers.forEach(y=>{L.DomUtil.addClass(y._icon,"visible"),y.setLatLng(p)}),this._map.off("click",this._placeStartingMarkers,this),this._map.on("click",this._finishShape,this),this._hintMarker.setTooltipContent(li("tooltips.finishRect")),this._setRectangleOrigin()},_setRectangleOrigin(){let l=this._startMarker.getLatLng();l&&(this._layerGroup.addLayer(this._layer),this._layer.setLatLngs([l,l]),this._hintMarker.on("move",this._syncRectangleSize,this))},_syncHintMarker(l){if(this._hintMarker.setLatLng(l.latlng),this.options.snappable){let y=l;y.target=this._hintMarker,this._handleSnapping(y)}let p=this._layerGroup&&this._layerGroup.hasLayer(this._layer)?this._layer.getLatLngs():[this._hintMarker.getLatLng()];this._fireChange(p,"Draw")},_syncRectangleSize(){let l=bs(this._startMarker.getLatLng(),this._map),p=bs(this._hintMarker.getLatLng(),this._map),y=L.PM.Utils._getRotatedRectangle(l,p,this.options.rectangleAngle||0,this._map);if(this._layer.setLatLngs(y),this.options.cursorMarker&&this._styleMarkers){let x=[];y.forEach(M=>{!M.equals(l,1e-8)&&!M.equals(p,1e-8)&&x.push(M)}),x.forEach((M,A)=>{try{this._styleMarkers[A].setLatLng(M)}catch{}})}},_findCorners(){let l=this._layer.getLatLngs()[0];return L.PM.Utils._getRotatedRectangle(l[0],l[2],this.options.rectangleAngle||0,this._map)},_finishShape(l){this._hintMarker._snapped||this._hintMarker.setLatLng(l.latlng);let p=this._hintMarker.getLatLng(),y=this._startMarker.getLatLng();if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer()||y.equals(p))return;let x=L.rectangle([y,p],this.options.pathOptions);if(this.options.rectangleAngle){let A=L.PM.Utils._getRotatedRectangle(y,p,this.options.rectangleAngle||0,this._map);x.setLatLngs(A),x.pm&&x.pm._setAngle(this.options.rectangleAngle||0)}this._setPane(x,"layerPane"),this._finishLayer(x),x.addTo(this._map.pm._getContainingLayer()),this._fireCreate(x);let M=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(M))},setStyle(){this._layer?.setStyle(this.options.pathOptions)}}),Lr.CircleMarker=Lr.extend({initialize(l){this._map=l,this._shape="CircleMarker",this.toolbarButtonName="drawCircleMarker",this._layerIsDragging=!1,this._BaseCircleClass=L.CircleMarker,this._minRadiusOption="minRadiusCircleMarker",this._maxRadiusOption="maxRadiusCircleMarker",this._editableOption="resizeableCircleMarker",this._defaultRadius=10},enable(l){if(L.Util.setOptions(this,l),this.options.editable&&(this.options.resizeableCircleMarker=this.options.editable,delete this.options.editable),this._enabled=!0,this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._map.getContainer().classList.add("geoman-draw-cursor"),this.options[this._editableOption]){let p={};L.extend(p,this.options.templineStyle),p.radius=0,this._layerGroup=new L.FeatureGroup,this._layerGroup._pmTempLayer=!0,this._layerGroup.addTo(this._map),this._layer=new this._BaseCircleClass(this._map.getCenter(),p),this._setPane(this._layer,"layerPane"),this._layer._pmTempLayer=!0,this._centerMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"marker-icon"}),draggable:!1,zIndexOffset:100}),this._setPane(this._centerMarker,"vertexPane"),this._centerMarker._pmTempLayer=!0,this._hintMarker=L.marker(this._map.getCenter(),{zIndexOffset:110,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._layerGroup.addLayer(this._hintMarker),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(li("tooltips.startCircle"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._hintline=L.polyline([],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._layerGroup.addLayer(this._hintline),this._map.on("click",this._placeCenterMarker,this)}else this._map.on("click",this._createMarker,this),this._hintMarker=new this._BaseCircleClass(this._map.getCenter(),kr({radius:this._defaultRadius},this.options.templineStyle)),this._setPane(this._hintMarker,"layerPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this._layer=this._hintMarker,this.options.tooltips&&this._hintMarker.bindTooltip(li("tooltips.placeCircleMarker"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip();this._map.on("mousemove",this._syncHintMarker,this),this._extendingEnable(),this._otherSnapLayers=[],this._fireDrawStart(),this._setGlobalDrawMode()},_extendingEnable(){!this.options[this._editableOption]&&this.options.markerEditable&&this._map.eachLayer(l=>{this.isRelevantMarker(l)&&l.pm.enable()}),this._layer.bringToBack()},disable(){this._enabled&&(this._enabled=!1,this._map.getContainer().classList.remove("geoman-draw-cursor"),this.options[this._editableOption]?(this._map.off("click",this._finishShape,this),this._map.off("click",this._placeCenterMarker,this),this._map.removeLayer(this._layerGroup)):(this._map.off("click",this._createMarker,this),this._extendingDisable(),this._hintMarker.remove()),this._map.off("mousemove",this._syncHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},_extendingDisable(){this._map.eachLayer(l=>{this.isRelevantMarker(l)&&l.pm.disable()})},enabled(){return this._enabled},toggle(l){this.enabled()?this.disable():this.enable(l)},_placeCenterMarker(l){this._hintMarker._snapped||this._hintMarker.setLatLng(l.latlng),this._layerGroup.addLayer(this._layer),this._layerGroup.addLayer(this._centerMarker);let p=this._hintMarker.getLatLng();this._centerMarker.setLatLng(p),this._map.off("click",this._placeCenterMarker,this),this._map.on("click",this._finishShape,this),this._placeCircleCenter()},_placeCircleCenter(){let l=this._centerMarker.getLatLng();l&&(this._layer.setLatLng(l),this._hintMarker.on("move",this._syncHintLine,this),this._hintMarker.on("move",this._syncCircleRadius,this),this._hintMarker.setTooltipContent(li("tooltips.finishCircle")),this._fireCenterPlaced(),this._fireChange(this._layer.getLatLng(),"Draw"))},_syncHintLine(){let l=this._centerMarker.getLatLng(),p=this._getNewDestinationOfHintMarker();this._hintline.setLatLngs([l,p])},_syncCircleRadius(){let l=this._centerMarker.getLatLng(),p=this._hintMarker.getLatLng(),y=this._distanceCalculation(l,p);this.options[this._minRadiusOption]&&y<this.options[this._minRadiusOption]?this._layer.setRadius(this.options[this._minRadiusOption]):this.options[this._maxRadiusOption]&&y>this.options[this._maxRadiusOption]?this._layer.setRadius(this.options[this._maxRadiusOption]):this._layer.setRadius(y)},_syncHintMarker(l){if(this._hintMarker.setLatLng(l.latlng),this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker()),this.options.snappable){let y=l;y.target=this._hintMarker,this._handleSnapping(y)}this._handleHintMarkerSnapping();let p=this._layerGroup&&this._layerGroup.hasLayer(this._centerMarker)?this._centerMarker.getLatLng():this._hintMarker.getLatLng();this._fireChange(p,"Draw")},isRelevantMarker(l){return l instanceof L.CircleMarker&&!(l instanceof L.Circle)&&l.pm&&!l._pmTempLayer},_createMarker(l){if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer()||!l.latlng||this._layerIsDragging)return;this._hintMarker._snapped||this._hintMarker.setLatLng(l.latlng);let p=this._hintMarker.getLatLng(),y=new this._BaseCircleClass(p,kr({radius:this._defaultRadius},this.options.pathOptions));this._setPane(y,"layerPane"),this._finishLayer(y),y.addTo(this._map.pm._getContainingLayer()),this._extendingCreateMarker(y),this._fireCreate(y),this._cleanupSnapping(),this.options.continueDrawing||this.disable()},_extendingCreateMarker(l){l.pm&&this.options.markerEditable&&l.pm.enable()},_finishShape(l){if(this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(l.latlng);let p=this._centerMarker.getLatLng(),y=this._defaultRadius;if(this.options[this._editableOption]){let R=this._hintMarker.getLatLng();y=this._distanceCalculation(p,R),this.options[this._minRadiusOption]&&y<this.options[this._minRadiusOption]?y=this.options[this._minRadiusOption]:this.options[this._maxRadiusOption]&&y>this.options[this._maxRadiusOption]&&(y=this.options[this._maxRadiusOption])}let x=Al(kr({},this.options.pathOptions),{radius:y}),M=new this._BaseCircleClass(p,x);this._setPane(M,"layerPane"),this._finishLayer(M),M.addTo(this._map.pm._getContainingLayer()),M.pm&&M.pm._updateHiddenPolyCircle(),this._fireCreate(M);let A=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(A))},_getNewDestinationOfHintMarker(){let l=this._hintMarker.getLatLng();if(this.options[this._editableOption]){if(!this._layerGroup.hasLayer(this._centerMarker))return l;let p=this._centerMarker.getLatLng(),y=this._distanceCalculation(p,l);this.options[this._minRadiusOption]&&y<this.options[this._minRadiusOption]?l=Kn(this._map,p,l,this._getMinDistanceInMeter()):this.options[this._maxRadiusOption]&&y>this.options[this._maxRadiusOption]&&(l=Kn(this._map,p,l,this._getMaxDistanceInMeter()))}return l},_getMinDistanceInMeter(){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._minRadiusOption],this._map,this._centerMarker.getLatLng())},_getMaxDistanceInMeter(){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._maxRadiusOption],this._map,this._centerMarker.getLatLng())},_handleHintMarkerSnapping(){if(this.options[this._editableOption]){if(this._hintMarker._snapped){let l=this._centerMarker.getLatLng(),p=this._hintMarker.getLatLng(),y=this._distanceCalculation(l,p);this._layerGroup.hasLayer(this._centerMarker)&&(this.options[this._minRadiusOption]&&y<this.options[this._minRadiusOption]?this._hintMarker.setLatLng(this._hintMarker._orgLatLng):this.options[this._maxRadiusOption]&&y>this.options[this._maxRadiusOption]&&this._hintMarker.setLatLng(this._hintMarker._orgLatLng))}this._hintMarker.setLatLng(this._getNewDestinationOfHintMarker())}},setStyle(){let l={};L.extend(l,this.options.templineStyle),this.options[this._editableOption]&&(l.radius=0),this._layer?.setStyle(l),this._hintline?.setStyle(this.options.hintlineStyle)},_distanceCalculation(l,p){return this._map.project(l).distanceTo(this._map.project(p))}}),Lr.Circle=Lr.CircleMarker.extend({initialize(l){this._map=l,this._shape="Circle",this.toolbarButtonName="drawCircle",this._BaseCircleClass=L.Circle,this._minRadiusOption="minRadiusCircle",this._maxRadiusOption="maxRadiusCircle",this._editableOption="resizeableCircle",this._defaultRadius=100},_extendingEnable(){},_extendingDisable(){},_extendingCreateMarker(){},isRelevantMarker(){},_getMinDistanceInMeter(){return this.options[this._minRadiusOption]},_getMaxDistanceInMeter(){return this.options[this._maxRadiusOption]},_distanceCalculation(l,p){return this._map.distance(l,p)}});function In(l){if(!l)throw new Error("coord is required");if(!Array.isArray(l)){if(l.type==="Feature"&&l.geometry!==null&&l.geometry.type==="Point")return l.geometry.coordinates;if(l.type==="Point")return l.coordinates}if(Array.isArray(l)&&l.length>=2&&!Array.isArray(l[0])&&!Array.isArray(l[1]))return l;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Qr(l){if(Array.isArray(l))return l;if(l.type==="Feature"){if(l.geometry!==null)return l.geometry.coordinates}else if(l.coordinates)return l.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Zr(l){return l.type==="Feature"?l.geometry:l}function Bn(l,p){return l.type==="FeatureCollection"?"FeatureCollection":l.type==="GeometryCollection"?"GeometryCollection":l.type==="Feature"&&l.geometry!==null?l.geometry.type:l.type}function Ya(l,p,y){if(l!==null)for(var x,M,A,R,j,W,et,Tt=0,kt=0,ie,Ut=l.type,jt=Ut==="FeatureCollection",de=Ut==="Feature",Fe=jt?l.features.length:1,Mi=0;Mi<Fe;Mi++){et=jt?l.features[Mi].geometry:de?l.geometry:l,ie=et?et.type==="GeometryCollection":!1,j=ie?et.geometries.length:1;for(var bt=0;bt<j;bt++){var St=0,Zt=0;if(R=ie?et.geometries[bt]:et,R!==null){W=R.coordinates;var Jt=R.type;switch(Tt=y&&(Jt==="Polygon"||Jt==="MultiPolygon")?1:0,Jt){case null:break;case"Point":if(p(W,kt,Mi,St,Zt)===!1)return!1;kt++,St++;break;case"LineString":case"MultiPoint":for(x=0;x<W.length;x++){if(p(W[x],kt,Mi,St,Zt)===!1)return!1;kt++,Jt==="MultiPoint"&&St++}Jt==="LineString"&&St++;break;case"Polygon":case"MultiLineString":for(x=0;x<W.length;x++){for(M=0;M<W[x].length-Tt;M++){if(p(W[x][M],kt,Mi,St,Zt)===!1)return!1;kt++}Jt==="MultiLineString"&&St++,Jt==="Polygon"&&Zt++}Jt==="Polygon"&&St++;break;case"MultiPolygon":for(x=0;x<W.length;x++){for(Zt=0,M=0;M<W[x].length;M++){for(A=0;A<W[x][M].length-Tt;A++){if(p(W[x][M][A],kt,Mi,St,Zt)===!1)return!1;kt++}Zt++}St++}break;case"GeometryCollection":for(x=0;x<R.geometries.length;x++)if(Ya(R.geometries[x],p,y)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function tn(l,p){if(l.type==="Feature")p(l,0);else if(l.type==="FeatureCollection")for(var y=0;y<l.features.length&&p(l.features[y],y)!==!1;y++);}function Bl(l,p,y){var x=y;return tn(l,function(M,A){A===0&&y===void 0?x=M:x=p(x,M,A)}),x}function Cs(l,p){var y,x,M,A,R,j,W,et,Tt,kt,ie=0,Ut=l.type==="FeatureCollection",jt=l.type==="Feature",de=Ut?l.features.length:1;for(y=0;y<de;y++){for(j=Ut?l.features[y].geometry:jt?l.geometry:l,et=Ut?l.features[y].properties:jt?l.properties:{},Tt=Ut?l.features[y].bbox:jt?l.bbox:void 0,kt=Ut?l.features[y].id:jt?l.id:void 0,W=j?j.type==="GeometryCollection":!1,R=W?j.geometries.length:1,M=0;M<R;M++){if(A=W?j.geometries[M]:j,A===null){if(p(null,ie,et,Tt,kt)===!1)return!1;continue}switch(A.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(p(A,ie,et,Tt,kt)===!1)return!1;break}case"GeometryCollection":{for(x=0;x<A.geometries.length;x++)if(p(A.geometries[x],ie,et,Tt,kt)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ie++}}function la(l,p){Cs(l,function(y,x,M,A,R){var j=y===null?null:y.type;switch(j){case null:case"Point":case"LineString":case"Polygon":return p(Gr(y,M,{bbox:A,id:R}),x,0)===!1?!1:void 0}var W;switch(j){case"MultiPoint":W="Point";break;case"MultiLineString":W="LineString";break;case"MultiPolygon":W="Polygon";break}for(var et=0;et<y.coordinates.length;et++){var Tt=y.coordinates[et],kt={type:W,coordinates:Tt};if(p(Gr(kt,M),x,et)===!1)return!1}})}function Vo(l){if(!l)throw new Error("geojson is required");var p=[];return la(l,function(y){Ja(y,p)}),Yi(p)}function Ja(l,p){var y=[],x=l.geometry;if(x!==null){switch(x.type){case"Polygon":y=Qr(x);break;case"LineString":y=[Qr(x)]}y.forEach(function(M){var A=Uo(M,l.properties);A.forEach(function(R){R.id=p.length,p.push(R)})})}}function Uo(l,p){var y=[];return l.reduce(function(x,M){var A=En([x,M],p);return A.bbox=Qa(x,M),y.push(A),M}),y}function Qa(l,p){var y=l[0],x=l[1],M=p[0],A=p[1],R=y<M?y:M,j=x<A?x:A,W=y>M?y:M,et=x>A?x:A;return[R,j,W,et]}var Br=Vo,ua=se(hi(),1);function tl(l,p){var y={},x=[];if(l.type==="LineString"&&(l=Gr(l)),p.type==="LineString"&&(p=Gr(p)),l.type==="Feature"&&p.type==="Feature"&&l.geometry!==null&&p.geometry!==null&&l.geometry.type==="LineString"&&p.geometry.type==="LineString"&&l.geometry.coordinates.length===2&&p.geometry.coordinates.length===2){var M=Ms(l,p);return M&&x.push(M),Yi(x)}var A=(0,ua.default)();return A.load(Br(p)),tn(Br(l),function(R){tn(A.search(R),function(j){var W=Ms(R,j);if(W){var et=Qr(W).join(",");y[et]||(y[et]=!0,x.push(W))}})}),Yi(x)}function Ms(l,p){var y=Qr(l),x=Qr(p);if(y.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(x.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var M=y[0][0],A=y[0][1],R=y[1][0],j=y[1][1],W=x[0][0],et=x[0][1],Tt=x[1][0],kt=x[1][1],ie=(kt-et)*(R-M)-(Tt-W)*(j-A),Ut=(Tt-W)*(A-et)-(kt-et)*(M-W),jt=(R-M)*(A-et)-(j-A)*(M-W);if(ie===0)return null;var de=Ut/ie,Fe=jt/ie;if(de>=0&&de<=1&&Fe>=0&&Fe<=1){var Mi=M+de*(R-M),bt=A+de*(j-A);return ws([Mi,bt])}return null}var uo=tl,yn=se(hi(),1);function Dl(l,p,y){y===void 0&&(y={});var x=In(l),M=In(p),A=gn(M[1]-x[1]),R=gn(M[0]-x[0]),j=gn(x[1]),W=gn(M[1]),et=Math.pow(Math.sin(A/2),2)+Math.pow(Math.sin(R/2),2)*Math.cos(j)*Math.cos(W);return ka(2*Math.atan2(Math.sqrt(et),Math.sqrt(1-et)),y.units)}var vn=Dl;function vl(l){var p=l[0],y=l[1],x=l[2],M=l[3],A=vn(l.slice(0,2),[x,y]),R=vn(l.slice(0,2),[p,M]);if(A>=R){var j=(y+M)/2;return[p,j-(x-p)/2,x,j+(x-p)/2]}else{var W=(p+x)/2;return[W-(M-y)/2,y,W+(M-y)/2,M]}}var hs=vl;function ho(l){var p=[1/0,1/0,-1/0,-1/0];return Ya(l,function(y){p[0]>y[0]&&(p[0]=y[0]),p[1]>y[1]&&(p[1]=y[1]),p[2]<y[0]&&(p[2]=y[0]),p[3]<y[1]&&(p[3]=y[1])}),p}ho.default=ho;var Ws=ho;function Ci(l,p){p===void 0&&(p={});var y=p.precision,x=p.coordinates,M=p.mutate;if(y=y==null||isNaN(y)?6:y,x=x==null||isNaN(x)?3:x,!l)throw new Error("<geojson> is required");if(typeof y!="number")throw new Error("<precision> must be a number");if(typeof x!="number")throw new Error("<coordinates> must be a number");(M===!1||M===void 0)&&(l=JSON.parse(JSON.stringify(l)));var A=Math.pow(10,y);return Ya(l,function(R){co(R,A,x)}),l}function co(l,p,y){l.length>y&&l.splice(y,l.length);for(var x=0;x<l.length;x++)l[x]=Math.round(l[x]*p)/p;return l}var Yn=Ci;function po(l,p,y){if(y===void 0&&(y={}),y.final===!0)return Ks(l,p);var x=In(l),M=In(p),A=gn(x[0]),R=gn(M[0]),j=gn(x[1]),W=gn(M[1]),et=Math.sin(R-A)*Math.cos(W),Tt=Math.cos(j)*Math.sin(W)-Math.sin(j)*Math.cos(W)*Math.cos(R-A);return An(Math.atan2(et,Tt))}function Ks(l,p){var y=po(p,l);return y=(y+180)%360,y}function fo(l,p,y,x){x===void 0&&(x={});var M=In(l),A=gn(M[0]),R=gn(M[1]),j=gn(y),W=oa(p,x.units),et=Math.asin(Math.sin(R)*Math.cos(W)+Math.cos(R)*Math.sin(W)*Math.cos(j)),Tt=A+Math.atan2(Math.sin(j)*Math.sin(W)*Math.cos(R),Math.cos(W)-Math.sin(R)*Math.sin(et)),kt=An(Tt),ie=An(et);return ws([kt,ie],x.properties)}function Ea(l,p,y){y===void 0&&(y={});var x=ws([1/0,1/0],{dist:1/0}),M=0;return la(l,function(A){for(var R=Qr(A),j=0;j<R.length-1;j++){var W=ws(R[j]);W.properties.dist=vn(p,W,y);var et=ws(R[j+1]);et.properties.dist=vn(p,et,y);var Tt=vn(W,et,y),kt=Math.max(W.properties.dist,et.properties.dist),ie=po(W,et),Ut=fo(p,kt,ie+90,y),jt=fo(p,kt,ie-90,y),de=uo(En([Ut.geometry.coordinates,jt.geometry.coordinates]),En([W.geometry.coordinates,et.geometry.coordinates])),Fe=null;de.features.length>0&&(Fe=de.features[0],Fe.properties.dist=vn(p,Fe,y),Fe.properties.location=M+vn(W,Fe,y)),W.properties.dist<x.properties.dist&&(x=W,x.properties.index=j,x.properties.location=M),et.properties.dist<x.properties.dist&&(x=et,x.properties.index=j+1,x.properties.location=M+Tt),Fe&&Fe.properties.dist<x.properties.dist&&(x=Fe,x.properties.index=j),M+=Tt}}),x}var Aa=Ea;function mo(l,p){if(!l)throw new Error("line is required");if(!p)throw new Error("splitter is required");var y=Bn(l),x=Bn(p);if(y!=="LineString")throw new Error("line must be LineString");if(x==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(x==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var M=Yn(p,{precision:7});switch(x){case"Point":return el(l,M);case"MultiPoint":return _o(l,M);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return _o(l,uo(l,M))}}function _o(l,p){var y=[],x=(0,yn.default)();return la(p,function(M){if(y.forEach(function(j,W){j.id=W}),!y.length)y=el(l,M).features,y.forEach(function(j){j.bbox||(j.bbox=hs(Ws(j)))}),x.load(Yi(y));else{var A=x.search(M);if(A.features.length){var R=il(M,A);y=y.filter(function(j){return j.id!==R.id}),x.remove(R),tn(el(R,M),function(j){y.push(j),x.insert(j)})}}}),Yi(y)}function el(l,p){var y=[],x=Qr(l)[0],M=Qr(l)[l.geometry.coordinates.length-1];if(rl(x,In(p))||rl(M,In(p)))return Yi([l]);var A=(0,yn.default)(),R=Br(l);A.load(R);var j=A.search(p);if(!j.features.length)return Yi([l]);var W=il(p,j),et=[x],Tt=Bl(R,function(kt,ie,Ut){var jt=Qr(ie)[1],de=In(p);return Ut===W.id?(kt.push(de),y.push(En(kt)),rl(de,jt)?[de]:[de,jt]):(kt.push(jt),kt)},et);return Tt.length>1&&y.push(En(Tt)),Yi(y)}function il(l,p){if(!p.features.length)throw new Error("lines must contain features");if(p.features.length===1)return p.features[0];var y,x=1/0;return tn(p,function(M){var A=Aa(M,l),R=A.properties.dist;R<x&&(y=M,x=R)}),y}function rl(l,p){return l[0]===p[0]&&l[1]===p[1]}var xl=mo;function ha(l,p,y){if(y===void 0&&(y={}),!l)throw new Error("point is required");if(!p)throw new Error("polygon is required");var x=In(l),M=Zr(p),A=M.type,R=p.bbox,j=M.coordinates;if(R&&ca(x,R)===!1)return!1;A==="Polygon"&&(j=[j]);for(var W=!1,et=0;et<j.length&&!W;et++)if(Jn(x,j[et][0],y.ignoreBoundary)){for(var Tt=!1,kt=1;kt<j[et].length&&!Tt;)Jn(x,j[et][kt],!y.ignoreBoundary)&&(Tt=!0),kt++;Tt||(W=!0)}return W}function Jn(l,p,y){var x=!1;p[0][0]===p[p.length-1][0]&&p[0][1]===p[p.length-1][1]&&(p=p.slice(0,p.length-1));for(var M=0,A=p.length-1;M<p.length;A=M++){var R=p[M][0],j=p[M][1],W=p[A][0],et=p[A][1],Tt=l[1]*(R-W)+j*(W-l[0])+et*(l[0]-R)===0&&(R-l[0])*(W-l[0])<=0&&(j-l[1])*(et-l[1])<=0;if(Tt)return!y;var kt=j>l[1]!=et>l[1]&&l[0]<(W-R)*(l[1]-j)/(et-j)+R;kt&&(x=!x)}return x}function ca(l,p){return p[0]<=l[0]&&p[1]<=l[1]&&p[2]>=l[0]&&p[3]>=l[1]}function Ia(l,p,y){y===void 0&&(y={});for(var x=In(l),M=Qr(p),A=0;A<M.length-1;A++){var R=!1;if(y.ignoreEndVertices&&(A===0&&(R="start"),A===M.length-2&&(R="end"),A===0&&A+1===M.length-1&&(R="both")),go(M[A],M[A+1],x,R,typeof y.epsilon>"u"?null:y.epsilon))return!0}return!1}function go(l,p,y,x,M){var A=y[0],R=y[1],j=l[0],W=l[1],et=p[0],Tt=p[1],kt=y[0]-j,ie=y[1]-W,Ut=et-j,jt=Tt-W,de=kt*jt-ie*Ut;if(M!==null){if(Math.abs(de)>M)return!1}else if(de!==0)return!1;if(x){if(x==="start")return Math.abs(Ut)>=Math.abs(jt)?Ut>0?j<A&&A<=et:et<=A&&A<j:jt>0?W<R&&R<=Tt:Tt<=R&&R<W;if(x==="end")return Math.abs(Ut)>=Math.abs(jt)?Ut>0?j<=A&&A<et:et<A&&A<=j:jt>0?W<=R&&R<Tt:Tt<R&&R<=W;if(x==="both")return Math.abs(Ut)>=Math.abs(jt)?Ut>0?j<A&&A<et:et<A&&A<j:jt>0?W<R&&R<Tt:Tt<R&&R<W}else return Math.abs(Ut)>=Math.abs(jt)?Ut>0?j<=A&&A<=et:et<=A&&A<=j:jt>0?W<=R&&R<=Tt:Tt<=R&&R<=W;return!1}var Xs=Ia;function Ba(l,p){var y=Zr(l),x=Zr(p),M=y.type,A=x.type,R=y.coordinates,j=x.coordinates;switch(M){case"Point":switch(A){case"Point":return vo(R,j);default:throw new Error("feature2 "+A+" geometry not supported")}case"MultiPoint":switch(A){case"Point":return yo(y,x);case"MultiPoint":return Ls(y,x);default:throw new Error("feature2 "+A+" geometry not supported")}case"LineString":switch(A){case"Point":return Xs(x,y,{ignoreEndVertices:!0});case"LineString":return nl(y,x);case"MultiPoint":return $o(y,x);default:throw new Error("feature2 "+A+" geometry not supported")}case"Polygon":switch(A){case"Point":return ha(x,y,{ignoreBoundary:!0});case"LineString":return sl(y,x);case"Polygon":return ol(y,x);case"MultiPoint":return Tr(y,x);default:throw new Error("feature2 "+A+" geometry not supported")}default:throw new Error("feature1 "+M+" geometry not supported")}}function yo(l,p){var y,x=!1;for(y=0;y<l.coordinates.length;y++)if(vo(l.coordinates[y],p.coordinates)){x=!0;break}return x}function Ls(l,p){for(var y=0,x=p.coordinates;y<x.length;y++){for(var M=x[y],A=!1,R=0,j=l.coordinates;R<j.length;R++){var W=j[R];if(vo(M,W)){A=!0;break}}if(!A)return!1}return!0}function $o(l,p){for(var y=!1,x=0,M=p.coordinates;x<M.length;x++){var A=M[x];if(Xs(A,l,{ignoreEndVertices:!0})&&(y=!0),!Xs(A,l))return!1}return!!y}function Tr(l,p){for(var y=0,x=p.coordinates;y<x.length;y++){var M=x[y];if(!ha(M,l,{ignoreBoundary:!0}))return!1}return!0}function nl(l,p){for(var y=!1,x=0,M=p.coordinates;x<M.length;x++){var A=M[x];if(Xs({type:"Point",coordinates:A},l,{ignoreEndVertices:!0})&&(y=!0),!Xs({type:"Point",coordinates:A},l,{ignoreEndVertices:!1}))return!1}return y}function sl(l,p){var y=!1,x=0,M=Ws(l),A=Ws(p);if(!Dr(M,A))return!1;for(x;x<p.coordinates.length-1;x++){var R=pa(p.coordinates[x],p.coordinates[x+1]);if(ha({type:"Point",coordinates:R},l,{ignoreBoundary:!0})){y=!0;break}}return y}function ol(l,p){if(l.type==="Feature"&&l.geometry===null||p.type==="Feature"&&p.geometry===null)return!1;var y=Ws(l),x=Ws(p);if(!Dr(y,x))return!1;for(var M=Zr(p).coordinates,A=0,R=M;A<R.length;A++)for(var j=R[A],W=0,et=j;W<et.length;W++){var Tt=et[W];if(!ha(Tt,l))return!1}return!0}function Dr(l,p){return!(l[0]>p[0]||l[2]<p[2]||l[1]>p[1]||l[3]<p[3])}function vo(l,p){return l[0]===p[0]&&l[1]===p[1]}function pa(l,p){return[(l[0]+p[0])/2,(l[1]+p[1])/2]}var Ts=se(Si()),xo=l=>()=>l,bo=l=>{let p=l?(y,x)=>x.minus(y).abs().isLessThanOrEqualTo(l):xo(!1);return(y,x)=>p(y,x)?0:y.comparedTo(x)};function cs(l){let p=l?(y,x,M,A,R)=>y.exponentiatedBy(2).isLessThanOrEqualTo(A.minus(x).exponentiatedBy(2).plus(R.minus(M).exponentiatedBy(2)).times(l)):xo(!1);return(y,x,M)=>{let A=y.x,R=y.y,j=M.x,W=M.y,et=R.minus(W).times(x.x.minus(j)).minus(A.minus(j).times(x.y.minus(W)));return p(et,A,R,j,W)?0:et.comparedTo(0)}}var wo=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,qo=Math.ceil,en=Math.floor,Ke="[BigNumber Error] ",Ps=Ke+"Number primitive has more than 15 significant digits: ",xn=1e14,ri=14,Ys=9007199254740991,al=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Ss=1e7,ur=1e9;function ll(l){var p,y,x,M=bt.prototype={constructor:bt,toString:null,valueOf:null},A=new bt(1),R=20,j=4,W=-7,et=21,Tt=-1e7,kt=1e7,ie=!1,Ut=1,jt=0,de={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},Fe="0123456789abcdefghijklmnopqrstuvwxyz",Mi=!0;function bt(q,Q){var ut,ot,ht,pt,Dt,Bt,Ft,Yt,Wt=this;if(!(Wt instanceof bt))return new bt(q,Q);if(Q==null){if(q&&q._isBigNumber===!0){Wt.s=q.s,!q.c||q.e>kt?Wt.c=Wt.e=null:q.e<Tt?Wt.c=[Wt.e=0]:(Wt.e=q.e,Wt.c=q.c.slice());return}if((Bt=typeof q=="number")&&q*0==0){if(Wt.s=1/q<0?(q=-q,-1):1,q===~~q){for(pt=0,Dt=q;Dt>=10;Dt/=10,pt++);pt>kt?Wt.c=Wt.e=null:(Wt.e=pt,Wt.c=[q]);return}Yt=String(q)}else{if(!wo.test(Yt=String(q)))return x(Wt,Yt,Bt);Wt.s=Yt.charCodeAt(0)==45?(Yt=Yt.slice(1),-1):1}(pt=Yt.indexOf("."))>-1&&(Yt=Yt.replace(".","")),(Dt=Yt.search(/e/i))>0?(pt<0&&(pt=Dt),pt+=+Yt.slice(Dt+1),Yt=Yt.substring(0,Dt)):pt<0&&(pt=Yt.length)}else{if(E(Q,2,Fe.length,"Base"),Q==10&&Mi)return Wt=new bt(q),Ht(Wt,R+Wt.e+1,j);if(Yt=String(q),Bt=typeof q=="number"){if(q*0!=0)return x(Wt,Yt,Bt,Q);if(Wt.s=1/q<0?(Yt=Yt.slice(1),-1):1,bt.DEBUG&&Yt.replace(/^0\.0*|\./,"").length>15)throw Error(Ps+q)}else Wt.s=Yt.charCodeAt(0)===45?(Yt=Yt.slice(1),-1):1;for(ut=Fe.slice(0,Q),pt=Dt=0,Ft=Yt.length;Dt<Ft;Dt++)if(ut.indexOf(ot=Yt.charAt(Dt))<0){if(ot=="."){if(Dt>pt){pt=Ft;continue}}else if(!ht&&(Yt==Yt.toUpperCase()&&(Yt=Yt.toLowerCase())||Yt==Yt.toLowerCase()&&(Yt=Yt.toUpperCase()))){ht=!0,Dt=-1,pt=0;continue}return x(Wt,String(q),Bt,Q)}Bt=!1,Yt=y(Yt,Q,10,Wt.s),(pt=Yt.indexOf("."))>-1?Yt=Yt.replace(".",""):pt=Yt.length}for(Dt=0;Yt.charCodeAt(Dt)===48;Dt++);for(Ft=Yt.length;Yt.charCodeAt(--Ft)===48;);if(Yt=Yt.slice(Dt,++Ft)){if(Ft-=Dt,Bt&&bt.DEBUG&&Ft>15&&(q>Ys||q!==en(q)))throw Error(Ps+Wt.s*q);if((pt=pt-Dt-1)>kt)Wt.c=Wt.e=null;else if(pt<Tt)Wt.c=[Wt.e=0];else{if(Wt.e=pt,Wt.c=[],Dt=(pt+1)%ri,pt<0&&(Dt+=ri),Dt<Ft){for(Dt&&Wt.c.push(+Yt.slice(0,Dt)),Ft-=ri;Dt<Ft;)Wt.c.push(+Yt.slice(Dt,Dt+=ri));Dt=ri-(Yt=Yt.slice(Dt)).length}else Dt-=Ft;for(;Dt--;Yt+="0");Wt.c.push(+Yt)}}else Wt.c=[Wt.e=0]}bt.clone=ll,bt.ROUND_UP=0,bt.ROUND_DOWN=1,bt.ROUND_CEIL=2,bt.ROUND_FLOOR=3,bt.ROUND_HALF_UP=4,bt.ROUND_HALF_DOWN=5,bt.ROUND_HALF_EVEN=6,bt.ROUND_HALF_CEIL=7,bt.ROUND_HALF_FLOOR=8,bt.EUCLID=9,bt.config=bt.set=function(q){var Q,ut;if(q!=null)if(typeof q=="object"){if(q.hasOwnProperty(Q="DECIMAL_PLACES")&&(ut=q[Q],E(ut,0,ur,Q),R=ut),q.hasOwnProperty(Q="ROUNDING_MODE")&&(ut=q[Q],E(ut,0,8,Q),j=ut),q.hasOwnProperty(Q="EXPONENTIAL_AT")&&(ut=q[Q],ut&&ut.pop?(E(ut[0],-ur,0,Q),E(ut[1],0,ur,Q),W=ut[0],et=ut[1]):(E(ut,-ur,ur,Q),W=-(et=ut<0?-ut:ut))),q.hasOwnProperty(Q="RANGE"))if(ut=q[Q],ut&&ut.pop)E(ut[0],-ur,-1,Q),E(ut[1],1,ur,Q),Tt=ut[0],kt=ut[1];else if(E(ut,-ur,ur,Q),ut)Tt=-(kt=ut<0?-ut:ut);else throw Error(Ke+Q+" cannot be zero: "+ut);if(q.hasOwnProperty(Q="CRYPTO"))if(ut=q[Q],ut===!!ut)if(ut)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))ie=ut;else throw ie=!ut,Error(Ke+"crypto unavailable");else ie=ut;else throw Error(Ke+Q+" not true or false: "+ut);if(q.hasOwnProperty(Q="MODULO_MODE")&&(ut=q[Q],E(ut,0,9,Q),Ut=ut),q.hasOwnProperty(Q="POW_PRECISION")&&(ut=q[Q],E(ut,0,ur,Q),jt=ut),q.hasOwnProperty(Q="FORMAT"))if(ut=q[Q],typeof ut=="object")de=ut;else throw Error(Ke+Q+" not an object: "+ut);if(q.hasOwnProperty(Q="ALPHABET"))if(ut=q[Q],typeof ut=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(ut))Mi=ut.slice(0,10)=="0123456789",Fe=ut;else throw Error(Ke+Q+" invalid: "+ut)}else throw Error(Ke+"Object expected: "+q);return{DECIMAL_PLACES:R,ROUNDING_MODE:j,EXPONENTIAL_AT:[W,et],RANGE:[Tt,kt],CRYPTO:ie,MODULO_MODE:Ut,POW_PRECISION:jt,FORMAT:de,ALPHABET:Fe}},bt.isBigNumber=function(q){if(!q||q._isBigNumber!==!0)return!1;if(!bt.DEBUG)return!0;var Q,ut,ot=q.c,ht=q.e,pt=q.s;t:if({}.toString.call(ot)=="[object Array]"){if((pt===1||pt===-1)&&ht>=-ur&&ht<=ur&&ht===en(ht)){if(ot[0]===0){if(ht===0&&ot.length===1)return!0;break t}if(Q=(ht+1)%ri,Q<1&&(Q+=ri),String(ot[0]).length==Q){for(Q=0;Q<ot.length;Q++)if(ut=ot[Q],ut<0||ut>=xn||ut!==en(ut))break t;if(ut!==0)return!0}}}else if(ot===null&&ht===null&&(pt===null||pt===1||pt===-1))return!0;throw Error(Ke+"Invalid BigNumber: "+q)},bt.maximum=bt.max=function(){return Zt(arguments,-1)},bt.minimum=bt.min=function(){return Zt(arguments,1)},bt.random=function(){var q=9007199254740992,Q=Math.random()*q&2097151?function(){return en(Math.random()*q)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(ut){var ot,ht,pt,Dt,Bt,Ft=0,Yt=[],Wt=new bt(A);if(ut==null?ut=R:E(ut,0,ur),Dt=qo(ut/ri),ie)if(crypto.getRandomValues){for(ot=crypto.getRandomValues(new Uint32Array(Dt*=2));Ft<Dt;)Bt=ot[Ft]*131072+(ot[Ft+1]>>>11),Bt>=9e15?(ht=crypto.getRandomValues(new Uint32Array(2)),ot[Ft]=ht[0],ot[Ft+1]=ht[1]):(Yt.push(Bt%1e14),Ft+=2);Ft=Dt/2}else if(crypto.randomBytes){for(ot=crypto.randomBytes(Dt*=7);Ft<Dt;)Bt=(ot[Ft]&31)*281474976710656+ot[Ft+1]*1099511627776+ot[Ft+2]*4294967296+ot[Ft+3]*16777216+(ot[Ft+4]<<16)+(ot[Ft+5]<<8)+ot[Ft+6],Bt>=9e15?crypto.randomBytes(7).copy(ot,Ft):(Yt.push(Bt%1e14),Ft+=7);Ft=Dt/7}else throw ie=!1,Error(Ke+"crypto unavailable");if(!ie)for(;Ft<Dt;)Bt=Q(),Bt<9e15&&(Yt[Ft++]=Bt%1e14);for(Dt=Yt[--Ft],ut%=ri,Dt&&ut&&(Bt=al[ri-ut],Yt[Ft]=en(Dt/Bt)*Bt);Yt[Ft]===0;Yt.pop(),Ft--);if(Ft<0)Yt=[pt=0];else{for(pt=-1;Yt[0]===0;Yt.splice(0,1),pt-=ri);for(Ft=1,Bt=Yt[0];Bt>=10;Bt/=10,Ft++);Ft<ri&&(pt-=ri-Ft)}return Wt.e=pt,Wt.c=Yt,Wt}}(),bt.sum=function(){for(var q=1,Q=arguments,ut=new bt(Q[0]);q<Q.length;)ut=ut.plus(Q[q++]);return ut},y=function(){var q="0123456789";function Q(ut,ot,ht,pt){for(var Dt,Bt=[0],Ft,Yt=0,Wt=ut.length;Yt<Wt;){for(Ft=Bt.length;Ft--;Bt[Ft]*=ot);for(Bt[0]+=pt.indexOf(ut.charAt(Yt++)),Dt=0;Dt<Bt.length;Dt++)Bt[Dt]>ht-1&&(Bt[Dt+1]==null&&(Bt[Dt+1]=0),Bt[Dt+1]+=Bt[Dt]/ht|0,Bt[Dt]%=ht)}return Bt.reverse()}return function(ut,ot,ht,pt,Dt){var Bt,Ft,Yt,Wt,we,d,t,i,a=ut.indexOf("."),h=R,m=j;for(a>=0&&(Wt=jt,jt=0,ut=ut.replace(".",""),i=new bt(ot),d=i.pow(ut.length-a),jt=Wt,i.c=Q(Pt(f(d.c),d.e,"0"),10,ht,q),i.e=i.c.length),t=Q(ut,ot,ht,Dt?(Bt=Fe,q):(Bt=q,Fe)),Yt=Wt=t.length;t[--Wt]==0;t.pop());if(!t[0])return Bt.charAt(0);if(a<0?--Yt:(d.c=t,d.e=Yt,d.s=pt,d=p(d,i,h,m,ht),t=d.c,we=d.r,Yt=d.e),Ft=Yt+h+1,a=t[Ft],Wt=ht/2,we=we||Ft<0||t[Ft+1]!=null,we=m<4?(a!=null||we)&&(m==0||m==(d.s<0?3:2)):a>Wt||a==Wt&&(m==4||we||m==6&&t[Ft-1]&1||m==(d.s<0?8:7)),Ft<1||!t[0])ut=we?Pt(Bt.charAt(1),-h,Bt.charAt(0)):Bt.charAt(0);else{if(t.length=Ft,we)for(--ht;++t[--Ft]>ht;)t[Ft]=0,Ft||(++Yt,t=[1].concat(t));for(Wt=t.length;!t[--Wt];);for(a=0,ut="";a<=Wt;ut+=Bt.charAt(t[a++]));ut=Pt(ut,Yt,Bt.charAt(0))}return ut}}(),p=function(){function q(ot,ht,pt){var Dt,Bt,Ft,Yt,Wt=0,we=ot.length,d=ht%Ss,t=ht/Ss|0;for(ot=ot.slice();we--;)Ft=ot[we]%Ss,Yt=ot[we]/Ss|0,Dt=t*Ft+Yt*d,Bt=d*Ft+Dt%Ss*Ss+Wt,Wt=(Bt/pt|0)+(Dt/Ss|0)+t*Yt,ot[we]=Bt%pt;return Wt&&(ot=[Wt].concat(ot)),ot}function Q(ot,ht,pt,Dt){var Bt,Ft;if(pt!=Dt)Ft=pt>Dt?1:-1;else for(Bt=Ft=0;Bt<pt;Bt++)if(ot[Bt]!=ht[Bt]){Ft=ot[Bt]>ht[Bt]?1:-1;break}return Ft}function ut(ot,ht,pt,Dt){for(var Bt=0;pt--;)ot[pt]-=Bt,Bt=ot[pt]<ht[pt]?1:0,ot[pt]=Bt*Dt+ot[pt]-ht[pt];for(;!ot[0]&&ot.length>1;ot.splice(0,1));}return function(ot,ht,pt,Dt,Bt){var Ft,Yt,Wt,we,d,t,i,a,h,m,v,C,P,I,D,F,O,Z=ot.s==ht.s?1:-1,X=ot.c,nt=ht.c;if(!X||!X[0]||!nt||!nt[0])return new bt(!ot.s||!ht.s||(X?nt&&X[0]==nt[0]:!nt)?NaN:X&&X[0]==0||!nt?Z*0:Z/0);for(a=new bt(Z),h=a.c=[],Yt=ot.e-ht.e,Z=pt+Yt+1,Bt||(Bt=xn,Yt=s(ot.e/ri)-s(ht.e/ri),Z=Z/ri|0),Wt=0;nt[Wt]==(X[Wt]||0);Wt++);if(nt[Wt]>(X[Wt]||0)&&Yt--,Z<0)h.push(1),we=!0;else{for(I=X.length,F=nt.length,Wt=0,Z+=2,d=en(Bt/(nt[0]+1)),d>1&&(nt=q(nt,d,Bt),X=q(X,d,Bt),F=nt.length,I=X.length),P=F,m=X.slice(0,F),v=m.length;v<F;m[v++]=0);O=nt.slice(),O=[0].concat(O),D=nt[0],nt[1]>=Bt/2&&D++;do{if(d=0,Ft=Q(nt,m,F,v),Ft<0){if(C=m[0],F!=v&&(C=C*Bt+(m[1]||0)),d=en(C/D),d>1)for(d>=Bt&&(d=Bt-1),t=q(nt,d,Bt),i=t.length,v=m.length;Q(t,m,i,v)==1;)d--,ut(t,F<i?O:nt,i,Bt),i=t.length,Ft=1;else d==0&&(Ft=d=1),t=nt.slice(),i=t.length;if(i<v&&(t=[0].concat(t)),ut(m,t,v,Bt),v=m.length,Ft==-1)for(;Q(nt,m,F,v)<1;)d++,ut(m,F<v?O:nt,v,Bt),v=m.length}else Ft===0&&(d++,m=[0]);h[Wt++]=d,m[0]?m[v++]=X[P]||0:(m=[X[P]],v=1)}while((P++<I||m[0]!=null)&&Z--);we=m[0]!=null,h[0]||h.splice(0,1)}if(Bt==xn){for(Wt=1,Z=h[0];Z>=10;Z/=10,Wt++);Ht(a,pt+(a.e=Wt+Yt*ri-1)+1,Dt,we)}else a.e=Yt,a.r=+we;return a}}();function St(q,Q,ut,ot){var ht,pt,Dt,Bt,Ft;if(ut==null?ut=j:E(ut,0,8),!q.c)return q.toString();if(ht=q.c[0],Dt=q.e,Q==null)Ft=f(q.c),Ft=ot==1||ot==2&&(Dt<=W||Dt>=et)?it(Ft,Dt):Pt(Ft,Dt,"0");else if(q=Ht(new bt(q),Q,ut),pt=q.e,Ft=f(q.c),Bt=Ft.length,ot==1||ot==2&&(Q<=pt||pt<=W)){for(;Bt<Q;Ft+="0",Bt++);Ft=it(Ft,pt)}else if(Q-=Dt,Ft=Pt(Ft,pt,"0"),pt+1>Bt){if(--Q>0)for(Ft+=".";Q--;Ft+="0");}else if(Q+=pt-Bt,Q>0)for(pt+1==Bt&&(Ft+=".");Q--;Ft+="0");return q.s<0&&ht?"-"+Ft:Ft}function Zt(q,Q){for(var ut,ot,ht=1,pt=new bt(q[0]);ht<q.length;ht++)ot=new bt(q[ht]),(!ot.s||(ut=w(pt,ot))===Q||ut===0&&pt.s===Q)&&(pt=ot);return pt}function Jt(q,Q,ut){for(var ot=1,ht=Q.length;!Q[--ht];Q.pop());for(ht=Q[0];ht>=10;ht/=10,ot++);return(ut=ot+ut*ri-1)>kt?q.c=q.e=null:ut<Tt?q.c=[q.e=0]:(q.e=ut,q.c=Q),q}x=function(){var q=/^(-?)0([xbo])(?=\w[\w.]*$)/i,Q=/^([^.]+)\.$/,ut=/^\.([^.]+)$/,ot=/^-?(Infinity|NaN)$/,ht=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(pt,Dt,Bt,Ft){var Yt,Wt=Bt?Dt:Dt.replace(ht,"");if(ot.test(Wt))pt.s=isNaN(Wt)?null:Wt<0?-1:1;else{if(!Bt&&(Wt=Wt.replace(q,function(we,d,t){return Yt=(t=t.toLowerCase())=="x"?16:t=="b"?2:8,!Ft||Ft==Yt?d:we}),Ft&&(Yt=Ft,Wt=Wt.replace(Q,"$1").replace(ut,"0.$1")),Dt!=Wt))return new bt(Wt,Yt);if(bt.DEBUG)throw Error(Ke+"Not a"+(Ft?" base "+Ft:"")+" number: "+Dt);pt.s=null}pt.c=pt.e=null}}();function Ht(q,Q,ut,ot){var ht,pt,Dt,Bt,Ft,Yt,Wt,we=q.c,d=al;if(we){t:{for(ht=1,Bt=we[0];Bt>=10;Bt/=10,ht++);if(pt=Q-ht,pt<0)pt+=ri,Dt=Q,Ft=we[Yt=0],Wt=en(Ft/d[ht-Dt-1]%10);else if(Yt=qo((pt+1)/ri),Yt>=we.length)if(ot){for(;we.length<=Yt;we.push(0));Ft=Wt=0,ht=1,pt%=ri,Dt=pt-ri+1}else break t;else{for(Ft=Bt=we[Yt],ht=1;Bt>=10;Bt/=10,ht++);pt%=ri,Dt=pt-ri+ht,Wt=Dt<0?0:en(Ft/d[ht-Dt-1]%10)}if(ot=ot||Q<0||we[Yt+1]!=null||(Dt<0?Ft:Ft%d[ht-Dt-1]),ot=ut<4?(Wt||ot)&&(ut==0||ut==(q.s<0?3:2)):Wt>5||Wt==5&&(ut==4||ot||ut==6&&(pt>0?Dt>0?Ft/d[ht-Dt]:0:we[Yt-1])%10&1||ut==(q.s<0?8:7)),Q<1||!we[0])return we.length=0,ot?(Q-=q.e+1,we[0]=d[(ri-Q%ri)%ri],q.e=-Q||0):we[0]=q.e=0,q;if(pt==0?(we.length=Yt,Bt=1,Yt--):(we.length=Yt+1,Bt=d[ri-pt],we[Yt]=Dt>0?en(Ft/d[ht-Dt]%d[Dt])*Bt:0),ot)for(;;)if(Yt==0){for(pt=1,Dt=we[0];Dt>=10;Dt/=10,pt++);for(Dt=we[0]+=Bt,Bt=1;Dt>=10;Dt/=10,Bt++);pt!=Bt&&(q.e++,we[0]==xn&&(we[0]=1));break}else{if(we[Yt]+=Bt,we[Yt]!=xn)break;we[Yt--]=0,Bt=1}for(pt=we.length;we[--pt]===0;we.pop());}q.e>kt?q.c=q.e=null:q.e<Tt&&(q.c=[q.e=0])}return q}function oe(q){var Q,ut=q.e;return ut===null?q.toString():(Q=f(q.c),Q=ut<=W||ut>=et?it(Q,ut):Pt(Q,ut,"0"),q.s<0?"-"+Q:Q)}return M.absoluteValue=M.abs=function(){var q=new bt(this);return q.s<0&&(q.s=1),q},M.comparedTo=function(q,Q){return w(this,new bt(q,Q))},M.decimalPlaces=M.dp=function(q,Q){var ut,ot,ht,pt=this;if(q!=null)return E(q,0,ur),Q==null?Q=j:E(Q,0,8),Ht(new bt(pt),q+pt.e+1,Q);if(!(ut=pt.c))return null;if(ot=((ht=ut.length-1)-s(this.e/ri))*ri,ht=ut[ht])for(;ht%10==0;ht/=10,ot--);return ot<0&&(ot=0),ot},M.dividedBy=M.div=function(q,Q){return p(this,new bt(q,Q),R,j)},M.dividedToIntegerBy=M.idiv=function(q,Q){return p(this,new bt(q,Q),0,1)},M.exponentiatedBy=M.pow=function(q,Q){var ut,ot,ht,pt,Dt,Bt,Ft,Yt,Wt,we=this;if(q=new bt(q),q.c&&!q.isInteger())throw Error(Ke+"Exponent not an integer: "+oe(q));if(Q!=null&&(Q=new bt(Q)),Bt=q.e>14,!we.c||!we.c[0]||we.c[0]==1&&!we.e&&we.c.length==1||!q.c||!q.c[0])return Wt=new bt(Math.pow(+oe(we),Bt?q.s*(2-N(q)):+oe(q))),Q?Wt.mod(Q):Wt;if(Ft=q.s<0,Q){if(Q.c?!Q.c[0]:!Q.s)return new bt(NaN);ot=!Ft&&we.isInteger()&&Q.isInteger(),ot&&(we=we.mod(Q))}else{if(q.e>9&&(we.e>0||we.e<-1||(we.e==0?we.c[0]>1||Bt&&we.c[1]>=24e7:we.c[0]<8e13||Bt&&we.c[0]<=9999975e7)))return pt=we.s<0&&N(q)?-0:0,we.e>-1&&(pt=1/pt),new bt(Ft?1/pt:pt);jt&&(pt=qo(jt/ri+2))}for(Bt?(ut=new bt(.5),Ft&&(q.s=1),Yt=N(q)):(ht=Math.abs(+oe(q)),Yt=ht%2),Wt=new bt(A);;){if(Yt){if(Wt=Wt.times(we),!Wt.c)break;pt?Wt.c.length>pt&&(Wt.c.length=pt):ot&&(Wt=Wt.mod(Q))}if(ht){if(ht=en(ht/2),ht===0)break;Yt=ht%2}else if(q=q.times(ut),Ht(q,q.e+1,1),q.e>14)Yt=N(q);else{if(ht=+oe(q),ht===0)break;Yt=ht%2}we=we.times(we),pt?we.c&&we.c.length>pt&&(we.c.length=pt):ot&&(we=we.mod(Q))}return ot?Wt:(Ft&&(Wt=A.div(Wt)),Q?Wt.mod(Q):pt?Ht(Wt,jt,j,Dt):Wt)},M.integerValue=function(q){var Q=new bt(this);return q==null?q=j:E(q,0,8),Ht(Q,Q.e+1,q)},M.isEqualTo=M.eq=function(q,Q){return w(this,new bt(q,Q))===0},M.isFinite=function(){return!!this.c},M.isGreaterThan=M.gt=function(q,Q){return w(this,new bt(q,Q))>0},M.isGreaterThanOrEqualTo=M.gte=function(q,Q){return(Q=w(this,new bt(q,Q)))===1||Q===0},M.isInteger=function(){return!!this.c&&s(this.e/ri)>this.c.length-2},M.isLessThan=M.lt=function(q,Q){return w(this,new bt(q,Q))<0},M.isLessThanOrEqualTo=M.lte=function(q,Q){return(Q=w(this,new bt(q,Q)))===-1||Q===0},M.isNaN=function(){return!this.s},M.isNegative=function(){return this.s<0},M.isPositive=function(){return this.s>0},M.isZero=function(){return!!this.c&&this.c[0]==0},M.minus=function(q,Q){var ut,ot,ht,pt,Dt=this,Bt=Dt.s;if(q=new bt(q,Q),Q=q.s,!Bt||!Q)return new bt(NaN);if(Bt!=Q)return q.s=-Q,Dt.plus(q);var Ft=Dt.e/ri,Yt=q.e/ri,Wt=Dt.c,we=q.c;if(!Ft||!Yt){if(!Wt||!we)return Wt?(q.s=-Q,q):new bt(we?Dt:NaN);if(!Wt[0]||!we[0])return we[0]?(q.s=-Q,q):new bt(Wt[0]?Dt:j==3?-0:0)}if(Ft=s(Ft),Yt=s(Yt),Wt=Wt.slice(),Bt=Ft-Yt){for((pt=Bt<0)?(Bt=-Bt,ht=Wt):(Yt=Ft,ht=we),ht.reverse(),Q=Bt;Q--;ht.push(0));ht.reverse()}else for(ot=(pt=(Bt=Wt.length)<(Q=we.length))?Bt:Q,Bt=Q=0;Q<ot;Q++)if(Wt[Q]!=we[Q]){pt=Wt[Q]<we[Q];break}if(pt&&(ht=Wt,Wt=we,we=ht,q.s=-q.s),Q=(ot=we.length)-(ut=Wt.length),Q>0)for(;Q--;Wt[ut++]=0);for(Q=xn-1;ot>Bt;){if(Wt[--ot]<we[ot]){for(ut=ot;ut&&!Wt[--ut];Wt[ut]=Q);--Wt[ut],Wt[ot]+=xn}Wt[ot]-=we[ot]}for(;Wt[0]==0;Wt.splice(0,1),--Yt);return Wt[0]?Jt(q,Wt,Yt):(q.s=j==3?-1:1,q.c=[q.e=0],q)},M.modulo=M.mod=function(q,Q){var ut,ot,ht=this;return q=new bt(q,Q),!ht.c||!q.s||q.c&&!q.c[0]?new bt(NaN):!q.c||ht.c&&!ht.c[0]?new bt(ht):(Ut==9?(ot=q.s,q.s=1,ut=p(ht,q,0,3),q.s=ot,ut.s*=ot):ut=p(ht,q,0,Ut),q=ht.minus(ut.times(q)),!q.c[0]&&Ut==1&&(q.s=ht.s),q)},M.multipliedBy=M.times=function(q,Q){var ut,ot,ht,pt,Dt,Bt,Ft,Yt,Wt,we,d,t,i,a,h,m=this,v=m.c,C=(q=new bt(q,Q)).c;if(!v||!C||!v[0]||!C[0])return!m.s||!q.s||v&&!v[0]&&!C||C&&!C[0]&&!v?q.c=q.e=q.s=null:(q.s*=m.s,!v||!C?q.c=q.e=null:(q.c=[0],q.e=0)),q;for(ot=s(m.e/ri)+s(q.e/ri),q.s*=m.s,Ft=v.length,we=C.length,Ft<we&&(i=v,v=C,C=i,ht=Ft,Ft=we,we=ht),ht=Ft+we,i=[];ht--;i.push(0));for(a=xn,h=Ss,ht=we;--ht>=0;){for(ut=0,d=C[ht]%h,t=C[ht]/h|0,Dt=Ft,pt=ht+Dt;pt>ht;)Yt=v[--Dt]%h,Wt=v[Dt]/h|0,Bt=t*Yt+Wt*d,Yt=d*Yt+Bt%h*h+i[pt]+ut,ut=(Yt/a|0)+(Bt/h|0)+t*Wt,i[pt--]=Yt%a;i[pt]=ut}return ut?++ot:i.splice(0,1),Jt(q,i,ot)},M.negated=function(){var q=new bt(this);return q.s=-q.s||null,q},M.plus=function(q,Q){var ut,ot=this,ht=ot.s;if(q=new bt(q,Q),Q=q.s,!ht||!Q)return new bt(NaN);if(ht!=Q)return q.s=-Q,ot.minus(q);var pt=ot.e/ri,Dt=q.e/ri,Bt=ot.c,Ft=q.c;if(!pt||!Dt){if(!Bt||!Ft)return new bt(ht/0);if(!Bt[0]||!Ft[0])return Ft[0]?q:new bt(Bt[0]?ot:ht*0)}if(pt=s(pt),Dt=s(Dt),Bt=Bt.slice(),ht=pt-Dt){for(ht>0?(Dt=pt,ut=Ft):(ht=-ht,ut=Bt),ut.reverse();ht--;ut.push(0));ut.reverse()}for(ht=Bt.length,Q=Ft.length,ht-Q<0&&(ut=Ft,Ft=Bt,Bt=ut,Q=ht),ht=0;Q;)ht=(Bt[--Q]=Bt[Q]+Ft[Q]+ht)/xn|0,Bt[Q]=xn===Bt[Q]?0:Bt[Q]%xn;return ht&&(Bt=[ht].concat(Bt),++Dt),Jt(q,Bt,Dt)},M.precision=M.sd=function(q,Q){var ut,ot,ht,pt=this;if(q!=null&&q!==!!q)return E(q,1,ur),Q==null?Q=j:E(Q,0,8),Ht(new bt(pt),q,Q);if(!(ut=pt.c))return null;if(ht=ut.length-1,ot=ht*ri+1,ht=ut[ht]){for(;ht%10==0;ht/=10,ot--);for(ht=ut[0];ht>=10;ht/=10,ot++);}return q&&pt.e+1>ot&&(ot=pt.e+1),ot},M.shiftedBy=function(q){return E(q,-Ys,Ys),this.times("1e"+q)},M.squareRoot=M.sqrt=function(){var q,Q,ut,ot,ht,pt=this,Dt=pt.c,Bt=pt.s,Ft=pt.e,Yt=R+4,Wt=new bt("0.5");if(Bt!==1||!Dt||!Dt[0])return new bt(!Bt||Bt<0&&(!Dt||Dt[0])?NaN:Dt?pt:1/0);if(Bt=Math.sqrt(+oe(pt)),Bt==0||Bt==1/0?(Q=f(Dt),(Q.length+Ft)%2==0&&(Q+="0"),Bt=Math.sqrt(+Q),Ft=s((Ft+1)/2)-(Ft<0||Ft%2),Bt==1/0?Q="5e"+Ft:(Q=Bt.toExponential(),Q=Q.slice(0,Q.indexOf("e")+1)+Ft),ut=new bt(Q)):ut=new bt(Bt+""),ut.c[0]){for(Ft=ut.e,Bt=Ft+Yt,Bt<3&&(Bt=0);;)if(ht=ut,ut=Wt.times(ht.plus(p(pt,ht,Yt,1))),f(ht.c).slice(0,Bt)===(Q=f(ut.c)).slice(0,Bt))if(ut.e<Ft&&--Bt,Q=Q.slice(Bt-3,Bt+1),Q=="9999"||!ot&&Q=="4999"){if(!ot&&(Ht(ht,ht.e+R+2,0),ht.times(ht).eq(pt))){ut=ht;break}Yt+=4,Bt+=4,ot=1}else{(!+Q||!+Q.slice(1)&&Q.charAt(0)=="5")&&(Ht(ut,ut.e+R+2,1),q=!ut.times(ut).eq(pt));break}}return Ht(ut,ut.e+R+1,j,q)},M.toExponential=function(q,Q){return q!=null&&(E(q,0,ur),q++),St(this,q,Q,1)},M.toFixed=function(q,Q){return q!=null&&(E(q,0,ur),q=q+this.e+1),St(this,q,Q)},M.toFormat=function(q,Q,ut){var ot,ht=this;if(ut==null)q!=null&&Q&&typeof Q=="object"?(ut=Q,Q=null):q&&typeof q=="object"?(ut=q,q=Q=null):ut=de;else if(typeof ut!="object")throw Error(Ke+"Argument not an object: "+ut);if(ot=ht.toFixed(q,Q),ht.c){var pt,Dt=ot.split("."),Bt=+ut.groupSize,Ft=+ut.secondaryGroupSize,Yt=ut.groupSeparator||"",Wt=Dt[0],we=Dt[1],d=ht.s<0,t=d?Wt.slice(1):Wt,i=t.length;if(Ft&&(pt=Bt,Bt=Ft,Ft=pt,i-=pt),Bt>0&&i>0){for(pt=i%Bt||Bt,Wt=t.substr(0,pt);pt<i;pt+=Bt)Wt+=Yt+t.substr(pt,Bt);Ft>0&&(Wt+=Yt+t.slice(pt)),d&&(Wt="-"+Wt)}ot=we?Wt+(ut.decimalSeparator||"")+((Ft=+ut.fractionGroupSize)?we.replace(new RegExp("\\d{"+Ft+"}\\B","g"),"$&"+(ut.fractionGroupSeparator||"")):we):Wt}return(ut.prefix||"")+ot+(ut.suffix||"")},M.toFraction=function(q){var Q,ut,ot,ht,pt,Dt,Bt,Ft,Yt,Wt,we,d,t=this,i=t.c;if(q!=null&&(Bt=new bt(q),!Bt.isInteger()&&(Bt.c||Bt.s!==1)||Bt.lt(A)))throw Error(Ke+"Argument "+(Bt.isInteger()?"out of range: ":"not an integer: ")+oe(Bt));if(!i)return new bt(t);for(Q=new bt(A),Yt=ut=new bt(A),ot=Ft=new bt(A),d=f(i),pt=Q.e=d.length-t.e-1,Q.c[0]=al[(Dt=pt%ri)<0?ri+Dt:Dt],q=!q||Bt.comparedTo(Q)>0?pt>0?Q:Yt:Bt,Dt=kt,kt=1/0,Bt=new bt(d),Ft.c[0]=0;Wt=p(Bt,Q,0,1),ht=ut.plus(Wt.times(ot)),ht.comparedTo(q)!=1;)ut=ot,ot=ht,Yt=Ft.plus(Wt.times(ht=Yt)),Ft=ht,Q=Bt.minus(Wt.times(ht=Q)),Bt=ht;return ht=p(q.minus(ut),ot,0,1),Ft=Ft.plus(ht.times(Yt)),ut=ut.plus(ht.times(ot)),Ft.s=Yt.s=t.s,pt=pt*2,we=p(Yt,ot,pt,j).minus(t).abs().comparedTo(p(Ft,ut,pt,j).minus(t).abs())<1?[Yt,ot]:[Ft,ut],kt=Dt,we},M.toNumber=function(){return+oe(this)},M.toPrecision=function(q,Q){return q!=null&&E(q,1,ur),St(this,q,Q,2)},M.toString=function(q){var Q,ut=this,ot=ut.s,ht=ut.e;return ht===null?ot?(Q="Infinity",ot<0&&(Q="-"+Q)):Q="NaN":(q==null?Q=ht<=W||ht>=et?it(f(ut.c),ht):Pt(f(ut.c),ht,"0"):q===10&&Mi?(ut=Ht(new bt(ut),R+ht+1,j),Q=Pt(f(ut.c),ut.e,"0")):(E(q,2,Fe.length,"Base"),Q=y(Pt(f(ut.c),ht,"0"),10,q,ot,!0)),ot<0&&ut.c[0]&&(Q="-"+Q)),Q},M.valueOf=M.toJSON=function(){return oe(this)},M._isBigNumber=!0,M[Symbol.toStringTag]="BigNumber",M[Symbol.for("nodejs.util.inspect.custom")]=M.valueOf,l!=null&&bt.set(l),bt}function s(l){var p=l|0;return l>0||l===p?p:p-1}function f(l){for(var p,y,x=1,M=l.length,A=l[0]+"";x<M;){for(p=l[x++]+"",y=ri-p.length;y--;p="0"+p);A+=p}for(M=A.length;A.charCodeAt(--M)===48;);return A.slice(0,M+1||1)}function w(l,p){var y,x,M=l.c,A=p.c,R=l.s,j=p.s,W=l.e,et=p.e;if(!R||!j)return null;if(y=M&&!M[0],x=A&&!A[0],y||x)return y?x?0:-j:R;if(R!=j)return R;if(y=R<0,x=W==et,!M||!A)return x?0:!M^y?1:-1;if(!x)return W>et^y?1:-1;for(j=(W=M.length)<(et=A.length)?W:et,R=0;R<j;R++)if(M[R]!=A[R])return M[R]>A[R]^y?1:-1;return W==et?0:W>et^y?1:-1}function E(l,p,y,x){if(l<p||l>y||l!==en(l))throw Error(Ke+(x||"Argument")+(typeof l=="number"?l<p||l>y?" out of range: ":" not an integer: ":" not a primitive number: ")+String(l))}function N(l){var p=l.c.length-1;return s(l.e/ri)==p&&l.c[p]%2!=0}function it(l,p){return(l.length>1?l.charAt(0)+"."+l.slice(1):l)+(p<0?"e":"e+")+p}function Pt(l,p,y){var x,M;if(p<0){for(M=y+".";++p;M+=y);l=M+l}else if(x=l.length,++p>x){for(M=y,p-=x;--p;M+=y);l+=M}else p<x&&(l=l.slice(0,p)+"."+l.slice(p));return l}var Xt=ll(),le=Xt,Ce=class{key;left=null;right=null;constructor(l){this.key=l}},ze=class extends Ce{constructor(l){super(l)}},qe=class{size=0;modificationCount=0;splayCount=0;splay(l){let p=this.root;if(p==null)return this.compare(l,l),-1;let y=null,x=null,M=null,A=null,R=p,j=this.compare,W;for(;;)if(W=j(R.key,l),W>0){let et=R.left;if(et==null||(W=j(et.key,l),W>0&&(R.left=et.right,et.right=R,R=et,et=R.left,et==null)))break;y==null?x=R:y.left=R,y=R,R=et}else if(W<0){let et=R.right;if(et==null||(W=j(et.key,l),W<0&&(R.right=et.left,et.left=R,R=et,et=R.right,et==null)))break;M==null?A=R:M.right=R,M=R,R=et}else break;return M!=null&&(M.right=R.left,R.left=A),y!=null&&(y.left=R.right,R.right=x),this.root!==R&&(this.root=R,this.splayCount++),W}splayMin(l){let p=l,y=p.left;for(;y!=null;){let x=y;p.left=x.right,x.right=p,p=x,y=p.left}return p}splayMax(l){let p=l,y=p.right;for(;y!=null;){let x=y;p.right=x.left,x.left=p,p=x,y=p.right}return p}_delete(l){if(this.root==null||this.splay(l)!=0)return null;let p=this.root,y=p,x=p.left;if(this.size--,x==null)this.root=p.right;else{let M=p.right;p=this.splayMax(x),p.right=M,this.root=p}return this.modificationCount++,y}addNewRoot(l,p){this.size++,this.modificationCount++;let y=this.root;if(y==null){this.root=l;return}p<0?(l.left=y,l.right=y.right,y.right=null):(l.right=y,l.left=y.left,y.left=null),this.root=l}_first(){let l=this.root;return l==null?null:(this.root=this.splayMin(l),this.root)}_last(){let l=this.root;return l==null?null:(this.root=this.splayMax(l),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(l){return this.validKey(l)&&this.splay(l)==0}defaultCompare(){return(l,p)=>l<p?-1:l>p?1:0}wrap(){return{getRoot:()=>this.root,setRoot:l=>{this.root=l},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:l=>{this.splayCount=l},splay:l=>this.splay(l),has:l=>this.has(l)}}},fi=class Hu extends qe{root=null;compare;validKey;constructor(p,y){super(),this.compare=p??this.defaultCompare(),this.validKey=y??(x=>x!=null&&x!=null)}delete(p){return this.validKey(p)?this._delete(p)!=null:!1}deleteAll(p){for(let y of p)this.delete(y)}forEach(p){let y=this[Symbol.iterator](),x;for(;x=y.next(),!x.done;)p(x.value,x.value,this)}add(p){let y=this.splay(p);return y!=0&&this.addNewRoot(new ze(p),y),this}addAndReturn(p){let y=this.splay(p);return y!=0&&this.addNewRoot(new ze(p),y),this.root.key}addAll(p){for(let y of p)this.add(y)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(p){if(p==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(p)<0)return this.root.key;let y=this.root.left;if(y==null)return null;let x=y.right;for(;x!=null;)y=x,x=y.right;return y.key}firstAfter(p){if(p==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(p)>0)return this.root.key;let y=this.root.right;if(y==null)return null;let x=y.left;for(;x!=null;)y=x,x=y.left;return y.key}retainAll(p){let y=new Hu(this.compare,this.validKey),x=this.modificationCount;for(let M of p){if(x!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(M)&&this.splay(M)==0&&y.add(this.root.key)}y.size!=this.size&&(this.root=y.root,this.size=y.size,this.modificationCount++)}lookup(p){return!this.validKey(p)||this.splay(p)!=0?null:this.root.key}intersection(p){let y=new Hu(this.compare,this.validKey);for(let x of this)p.has(x)&&y.add(x);return y}difference(p){let y=new Hu(this.compare,this.validKey);for(let x of this)p.has(x)||y.add(x);return y}union(p){let y=this.clone();return y.addAll(p),y}clone(){let p=new Hu(this.compare,this.validKey);return p.size=this.size,p.root=this.copyNode(this.root),p}copyNode(p){if(p==null)return null;function y(M,A){let R,j;do{if(R=M.left,j=M.right,R!=null){let W=new ze(R.key);A.left=W,y(R,W)}if(j!=null){let W=new ze(j.key);A.right=W,M=j,A=W}}while(j!=null)}let x=new ze(p.key);return y(p,x),x}toSet(){return this.clone()}entries(){return new rn(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new rr(this.wrap())}[Symbol.toStringTag]="[object Set]"},Pr=class{tree;path=new Array;modificationCount=null;splayCount;constructor(l){this.tree=l,this.splayCount=l.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;let l=this.path[this.path.length-1];return this.getValue(l)}rebuildPath(l){this.path.splice(0,this.path.length),this.tree.splay(l),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(l){for(;l!=null;)this.path.push(l),l=l.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let y=this.tree.getRoot();for(;y!=null;)this.path.push(y),y=y.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let l=this.path[this.path.length-1],p=l.right;if(p!=null){for(;p!=null;)this.path.push(p),p=p.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===l;)l=this.path.pop();return this.path.length>0}},rr=class extends Pr{getValue(l){return l.key}},rn=class extends Pr{getValue(l){return[l.key,l.key]}},Vr=l=>l,Co=l=>{if(l){let p=new fi(bo(l)),y=new fi(bo(l)),x=(A,R)=>R.addAndReturn(A),M=A=>({x:x(A.x,p),y:x(A.y,y)});return M({x:new le(0),y:new le(0)}),M}return Vr},Mo=l=>({set:p=>{Dn=Mo(p)},reset:()=>Mo(l),compare:bo(l),snap:Co(l),orient:cs(l)}),Dn=Mo(),Js=(l,p)=>l.ll.x.isLessThanOrEqualTo(p.x)&&p.x.isLessThanOrEqualTo(l.ur.x)&&l.ll.y.isLessThanOrEqualTo(p.y)&&p.y.isLessThanOrEqualTo(l.ur.y),da=(l,p)=>{if(p.ur.x.isLessThan(l.ll.x)||l.ur.x.isLessThan(p.ll.x)||p.ur.y.isLessThan(l.ll.y)||l.ur.y.isLessThan(p.ll.y))return null;let y=l.ll.x.isLessThan(p.ll.x)?p.ll.x:l.ll.x,x=l.ur.x.isLessThan(p.ur.x)?l.ur.x:p.ur.x,M=l.ll.y.isLessThan(p.ll.y)?p.ll.y:l.ll.y,A=l.ur.y.isLessThan(p.ur.y)?l.ur.y:p.ur.y;return{ll:{x:y,y:M},ur:{x,y:A}}},Ni=(l,p)=>l.x.times(p.y).minus(l.y.times(p.x)),ps=(l,p)=>l.x.times(p.x).plus(l.y.times(p.y)),Pi=l=>ps(l,l).sqrt(),Lo=(l,p,y)=>{let x={x:p.x.minus(l.x),y:p.y.minus(l.y)},M={x:y.x.minus(l.x),y:y.y.minus(l.y)};return Ni(M,x).div(Pi(M)).div(Pi(x))},fa=(l,p,y)=>{let x={x:p.x.minus(l.x),y:p.y.minus(l.y)},M={x:y.x.minus(l.x),y:y.y.minus(l.y)};return ps(M,x).div(Pi(M)).div(Pi(x))},To=(l,p,y)=>p.y.isZero()?null:{x:l.x.plus(p.x.div(p.y).times(y.minus(l.y))),y},Po=(l,p,y)=>p.x.isZero()?null:{x:y,y:l.y.plus(p.y.div(p.x).times(y.minus(l.x)))},ma=(l,p,y,x)=>{if(p.x.isZero())return Po(y,x,l.x);if(x.x.isZero())return Po(l,p,y.x);if(p.y.isZero())return To(y,x,l.y);if(x.y.isZero())return To(l,p,y.y);let M=Ni(p,x);if(M.isZero())return null;let A={x:y.x.minus(l.x),y:y.y.minus(l.y)},R=Ni(A,p).div(M),j=Ni(A,x).div(M),W=l.x.plus(j.times(p.x)),et=y.x.plus(R.times(x.x)),Tt=l.y.plus(j.times(p.y)),kt=y.y.plus(R.times(x.y)),ie=W.plus(et).div(2),Ut=Tt.plus(kt).div(2);return{x:ie,y:Ut}},Ur=class df{point;isLeft;segment;otherSE;consumedBy;static compare(p,y){let x=df.comparePoints(p.point,y.point);return x!==0?x:(p.point!==y.point&&p.link(y),p.isLeft!==y.isLeft?p.isLeft?1:-1:hl.compare(p.segment,y.segment))}static comparePoints(p,y){return p.x.isLessThan(y.x)?-1:p.x.isGreaterThan(y.x)?1:p.y.isLessThan(y.y)?-1:p.y.isGreaterThan(y.y)?1:0}constructor(p,y){p.events===void 0?p.events=[this]:p.events.push(this),this.point=p,this.isLeft=y}link(p){if(p.point===this.point)throw new Error("Tried to link already linked events");let y=p.point.events;for(let x=0,M=y.length;x<M;x++){let A=y[x];this.point.events.push(A),A.point=this.point}this.checkForConsuming()}checkForConsuming(){let p=this.point.events.length;for(let y=0;y<p;y++){let x=this.point.events[y];if(x.segment.consumedBy===void 0)for(let M=y+1;M<p;M++){let A=this.point.events[M];A.consumedBy===void 0&&x.otherSE.point.events===A.otherSE.point.events&&x.segment.consume(A.segment)}}}getAvailableLinkedEvents(){let p=[];for(let y=0,x=this.point.events.length;y<x;y++){let M=this.point.events[y];M!==this&&!M.segment.ringOut&&M.segment.isInResult()&&p.push(M)}return p}getLeftmostComparator(p){let y=new Map,x=M=>{let A=M.otherSE;y.set(M,{sine:Lo(this.point,p.point,A.point),cosine:fa(this.point,p.point,A.point)})};return(M,A)=>{y.has(M)||x(M),y.has(A)||x(A);let{sine:R,cosine:j}=y.get(M),{sine:W,cosine:et}=y.get(A);return R.isGreaterThanOrEqualTo(0)&&W.isGreaterThanOrEqualTo(0)?j.isLessThan(et)?1:j.isGreaterThan(et)?-1:0:R.isLessThan(0)&&W.isLessThan(0)?j.isLessThan(et)?-1:j.isGreaterThan(et)?1:0:W.isLessThan(R)?-1:W.isGreaterThan(R)?1:0}}},ul=0,hl=class bh{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(p,y){let x=p.leftSE.point.x,M=y.leftSE.point.x,A=p.rightSE.point.x,R=y.rightSE.point.x;if(R.isLessThan(x))return 1;if(A.isLessThan(M))return-1;let j=p.leftSE.point.y,W=y.leftSE.point.y,et=p.rightSE.point.y,Tt=y.rightSE.point.y;if(x.isLessThan(M)){if(W.isLessThan(j)&&W.isLessThan(et))return 1;if(W.isGreaterThan(j)&&W.isGreaterThan(et))return-1;let kt=p.comparePoint(y.leftSE.point);if(kt<0)return 1;if(kt>0)return-1;let ie=y.comparePoint(p.rightSE.point);return ie!==0?ie:-1}if(x.isGreaterThan(M)){if(j.isLessThan(W)&&j.isLessThan(Tt))return-1;if(j.isGreaterThan(W)&&j.isGreaterThan(Tt))return 1;let kt=y.comparePoint(p.leftSE.point);if(kt!==0)return kt;let ie=p.comparePoint(y.rightSE.point);return ie<0?1:ie>0?-1:1}if(j.isLessThan(W))return-1;if(j.isGreaterThan(W))return 1;if(A.isLessThan(R)){let kt=y.comparePoint(p.rightSE.point);if(kt!==0)return kt}if(A.isGreaterThan(R)){let kt=p.comparePoint(y.rightSE.point);if(kt<0)return 1;if(kt>0)return-1}if(!A.eq(R)){let kt=et.minus(j),ie=A.minus(x),Ut=Tt.minus(W),jt=R.minus(M);if(kt.isGreaterThan(ie)&&Ut.isLessThan(jt))return 1;if(kt.isLessThan(ie)&&Ut.isGreaterThan(jt))return-1}return A.isGreaterThan(R)?1:A.isLessThan(R)||et.isLessThan(Tt)?-1:et.isGreaterThan(Tt)?1:p.id<y.id?-1:p.id>y.id?1:0}constructor(p,y,x,M){this.id=++ul,this.leftSE=p,p.segment=this,p.otherSE=y,this.rightSE=y,y.segment=this,y.otherSE=p,this.rings=x,this.windings=M}static fromRing(p,y,x){let M,A,R,j=Ur.comparePoints(p,y);if(j<0)M=p,A=y,R=1;else if(j>0)M=y,A=p,R=-1;else throw new Error(`Tried to create degenerate segment at [${p.x}, ${p.y}]`);let W=new Ur(M,!0),et=new Ur(A,!1);return new bh(W,et,[x],[R])}replaceRightSE(p){this.rightSE=p,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let p=this.leftSE.point.y,y=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:p.isLessThan(y)?p:y},ur:{x:this.rightSE.point.x,y:p.isGreaterThan(y)?p:y}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(p){return p.x.eq(this.leftSE.point.x)&&p.y.eq(this.leftSE.point.y)||p.x.eq(this.rightSE.point.x)&&p.y.eq(this.rightSE.point.y)}comparePoint(p){return Dn.orient(this.leftSE.point,p,this.rightSE.point)}getIntersection(p){let y=this.bbox(),x=p.bbox(),M=da(y,x);if(M===null)return null;let A=this.leftSE.point,R=this.rightSE.point,j=p.leftSE.point,W=p.rightSE.point,et=Js(y,j)&&this.comparePoint(j)===0,Tt=Js(x,A)&&p.comparePoint(A)===0,kt=Js(y,W)&&this.comparePoint(W)===0,ie=Js(x,R)&&p.comparePoint(R)===0;if(Tt&&et)return ie&&!kt?R:!ie&&kt?W:null;if(Tt)return kt&&A.x.eq(W.x)&&A.y.eq(W.y)?null:A;if(et)return ie&&R.x.eq(j.x)&&R.y.eq(j.y)?null:j;if(ie&&kt)return null;if(ie)return R;if(kt)return W;let Ut=ma(A,this.vector(),j,p.vector());return Ut===null||!Js(M,Ut)?null:Dn.snap(Ut)}split(p){let y=[],x=p.events!==void 0,M=new Ur(p,!0),A=new Ur(p,!1),R=this.rightSE;this.replaceRightSE(A),y.push(A),y.push(M);let j=new bh(M,R,this.rings.slice(),this.windings.slice());return Ur.comparePoints(j.leftSE.point,j.rightSE.point)>0&&j.swapEvents(),Ur.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),x&&(M.checkForConsuming(),A.checkForConsuming()),y}swapEvents(){let p=this.rightSE;this.rightSE=this.leftSE,this.leftSE=p,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let y=0,x=this.windings.length;y<x;y++)this.windings[y]*=-1}consume(p){let y=this,x=p;for(;y.consumedBy;)y=y.consumedBy;for(;x.consumedBy;)x=x.consumedBy;let M=bh.compare(y,x);if(M!==0){if(M>0){let A=y;y=x,x=A}if(y.prev===x){let A=y;y=x,x=A}for(let A=0,R=x.rings.length;A<R;A++){let j=x.rings[A],W=x.windings[A],et=y.rings.indexOf(j);et===-1?(y.rings.push(j),y.windings.push(W)):y.windings[et]+=W}x.rings=null,x.windings=null,x.consumedBy=y,x.leftSE.consumedBy=y.leftSE,x.rightSE.consumedBy=y.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{let p=this.prev.consumedBy||this.prev;this._beforeState=p.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;let p=this.beforeState();this._afterState={rings:p.rings.slice(0),windings:p.windings.slice(0),multiPolys:[]};let y=this._afterState.rings,x=this._afterState.windings,M=this._afterState.multiPolys;for(let j=0,W=this.rings.length;j<W;j++){let et=this.rings[j],Tt=this.windings[j],kt=y.indexOf(et);kt===-1?(y.push(et),x.push(Tt)):x[kt]+=Tt}let A=[],R=[];for(let j=0,W=y.length;j<W;j++){if(x[j]===0)continue;let et=y[j],Tt=et.poly;if(R.indexOf(Tt)===-1)if(et.isExterior)A.push(Tt);else{R.indexOf(Tt)===-1&&R.push(Tt);let kt=A.indexOf(et.poly);kt!==-1&&A.splice(kt,1)}}for(let j=0,W=A.length;j<W;j++){let et=A[j].multiPoly;M.indexOf(et)===-1&&M.push(et)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;let p=this.beforeState().multiPolys,y=this.afterState().multiPolys;switch(za.type){case"union":{let x=p.length===0,M=y.length===0;this._isInResult=x!==M;break}case"intersection":{let x,M;p.length<y.length?(x=p.length,M=y.length):(x=y.length,M=p.length),this._isInResult=M===za.numMultiPolys&&x<M;break}case"xor":{let x=Math.abs(p.length-y.length);this._isInResult=x%2===1;break}case"difference":{let x=M=>M.length===1&&M[0].isSubject;this._isInResult=x(p)!==x(y);break}}return this._isInResult}},zl=class{poly;isExterior;segments;bbox;constructor(l,p,y){if(!Array.isArray(l)||l.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=p,this.isExterior=y,this.segments=[],typeof l[0][0]!="number"||typeof l[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let x=Dn.snap({x:new le(l[0][0]),y:new le(l[0][1])});this.bbox={ll:{x:x.x,y:x.y},ur:{x:x.x,y:x.y}};let M=x;for(let A=1,R=l.length;A<R;A++){if(typeof l[A][0]!="number"||typeof l[A][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let j=Dn.snap({x:new le(l[A][0]),y:new le(l[A][1])});j.x.eq(M.x)&&j.y.eq(M.y)||(this.segments.push(hl.fromRing(M,j,this)),j.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=j.x),j.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=j.y),j.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=j.x),j.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=j.y),M=j)}(!x.x.eq(M.x)||!x.y.eq(M.y))&&this.segments.push(hl.fromRing(M,x,this))}getSweepEvents(){let l=[];for(let p=0,y=this.segments.length;p<y;p++){let x=this.segments[p];l.push(x.leftSE),l.push(x.rightSE)}return l}},Da=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(l,p){if(!Array.isArray(l))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new zl(l[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let y=1,x=l.length;y<x;y++){let M=new zl(l[y],this,!1);M.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=M.bbox.ll.x),M.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=M.bbox.ll.y),M.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=M.bbox.ur.x),M.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=M.bbox.ur.y),this.interiorRings.push(M)}this.multiPoly=p}getSweepEvents(){let l=this.exteriorRing.getSweepEvents();for(let p=0,y=this.interiorRings.length;p<y;p++){let x=this.interiorRings[p].getSweepEvents();for(let M=0,A=x.length;M<A;M++)l.push(x[M])}return l}},_a=class{isSubject;polys;bbox;constructor(l,p){if(!Array.isArray(l))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof l[0][0][0]=="number"&&(l=[l])}catch{}this.polys=[],this.bbox={ll:{x:new le(Number.POSITIVE_INFINITY),y:new le(Number.POSITIVE_INFINITY)},ur:{x:new le(Number.NEGATIVE_INFINITY),y:new le(Number.NEGATIVE_INFINITY)}};for(let y=0,x=l.length;y<x;y++){let M=new Da(l[y],this);M.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=M.bbox.ll.x),M.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=M.bbox.ll.y),M.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=M.bbox.ur.x),M.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=M.bbox.ur.y),this.polys.push(M)}this.isSubject=p}getSweepEvents(){let l=[];for(let p=0,y=this.polys.length;p<y;p++){let x=this.polys[p].getSweepEvents();for(let M=0,A=x.length;M<A;M++)l.push(x[M])}return l}},zn=class kc{events;poly;_isExteriorRing;_enclosingRing;static factory(p){let y=[];for(let x=0,M=p.length;x<M;x++){let A=p[x];if(!A.isInResult()||A.ringOut)continue;let R=null,j=A.leftSE,W=A.rightSE,et=[j],Tt=j.point,kt=[];for(;R=j,j=W,et.push(j),j.point!==Tt;)for(;;){let ie=j.getAvailableLinkedEvents();if(ie.length===0){let de=et[0].point,Fe=et[et.length-1].point;throw new Error(`Unable to complete output ring starting at [${de.x}, ${de.y}]. Last matching segment found ends at [${Fe.x}, ${Fe.y}].`)}if(ie.length===1){W=ie[0].otherSE;break}let Ut=null;for(let de=0,Fe=kt.length;de<Fe;de++)if(kt[de].point===j.point){Ut=de;break}if(Ut!==null){let de=kt.splice(Ut)[0],Fe=et.splice(de.index);Fe.unshift(Fe[0].otherSE),y.push(new kc(Fe.reverse()));continue}kt.push({index:et.length,point:j.point});let jt=j.getLeftmostComparator(R);W=ie.sort(jt)[0].otherSE;break}y.push(new kc(et))}return y}constructor(p){this.events=p;for(let y=0,x=p.length;y<x;y++)p[y].segment.ringOut=this;this.poly=null}getGeom(){let p=this.events[0].point,y=[p];for(let et=1,Tt=this.events.length-1;et<Tt;et++){let kt=this.events[et].point,ie=this.events[et+1].point;Dn.orient(kt,p,ie)!==0&&(y.push(kt),p=kt)}if(y.length===1)return null;let x=y[0],M=y[1];Dn.orient(x,p,M)===0&&y.shift(),y.push(y[0]);let A=this.isExteriorRing()?1:-1,R=this.isExteriorRing()?0:y.length-1,j=this.isExteriorRing()?y.length:-1,W=[];for(let et=R;et!=j;et+=A)W.push([y[et].x.toNumber(),y[et].y.toNumber()]);return W}isExteriorRing(){if(this._isExteriorRing===void 0){let p=this.enclosingRing();this._isExteriorRing=p?!p.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let p=this.events[0];for(let M=1,A=this.events.length;M<A;M++){let R=this.events[M];Ur.compare(p,R)>0&&(p=R)}let y=p.segment.prevInResult(),x=y?y.prevInResult():null;for(;;){if(!y)return null;if(!x)return y.ringOut;if(x.ringOut!==y.ringOut)return x.ringOut?.enclosingRing()!==y.ringOut?y.ringOut:y.ringOut?.enclosingRing();y=x.prevInResult(),x=y?y.prevInResult():null}}},ds=class{exteriorRing;interiorRings;constructor(l){this.exteriorRing=l,l.poly=this,this.interiorRings=[]}addInterior(l){this.interiorRings.push(l),l.poly=this}getGeom(){let l=this.exteriorRing.getGeom();if(l===null)return null;let p=[l];for(let y=0,x=this.interiorRings.length;y<x;y++){let M=this.interiorRings[y].getGeom();M!==null&&p.push(M)}return p}},Rl=class{rings;polys;constructor(l){this.rings=l,this.polys=this._composePolys(l)}getGeom(){let l=[];for(let p=0,y=this.polys.length;p<y;p++){let x=this.polys[p].getGeom();x!==null&&l.push(x)}return l}_composePolys(l){let p=[];for(let y=0,x=l.length;y<x;y++){let M=l[y];if(!M.poly)if(M.isExteriorRing())p.push(new ds(M));else{let A=M.enclosingRing();A?.poly||p.push(new ds(A)),A?.poly?.addInterior(M)}}return p}},nu=class{queue;tree;segments;constructor(l,p=hl.compare){this.queue=l,this.tree=new fi(p),this.segments=[]}process(l){let p=l.segment,y=[];if(l.consumedBy)return l.isLeft?this.queue.delete(l.otherSE):this.tree.delete(p),y;l.isLeft&&this.tree.add(p);let x=p,M=p;do x=this.tree.lastBefore(x);while(x!=null&&x.consumedBy!=null);do M=this.tree.firstAfter(M);while(M!=null&&M.consumedBy!=null);if(l.isLeft){let A=null;if(x){let j=x.getIntersection(p);if(j!==null&&(p.isAnEndpoint(j)||(A=j),!x.isAnEndpoint(j))){let W=this._splitSafely(x,j);for(let et=0,Tt=W.length;et<Tt;et++)y.push(W[et])}}let R=null;if(M){let j=M.getIntersection(p);if(j!==null&&(p.isAnEndpoint(j)||(R=j),!M.isAnEndpoint(j))){let W=this._splitSafely(M,j);for(let et=0,Tt=W.length;et<Tt;et++)y.push(W[et])}}if(A!==null||R!==null){let j=null;A===null?j=R:R===null?j=A:j=Ur.comparePoints(A,R)<=0?A:R,this.queue.delete(p.rightSE),y.push(p.rightSE);let W=p.split(j);for(let et=0,Tt=W.length;et<Tt;et++)y.push(W[et])}y.length>0?(this.tree.delete(p),y.push(l)):(this.segments.push(p),p.prev=x)}else{if(x&&M){let A=x.getIntersection(M);if(A!==null){if(!x.isAnEndpoint(A)){let R=this._splitSafely(x,A);for(let j=0,W=R.length;j<W;j++)y.push(R[j])}if(!M.isAnEndpoint(A)){let R=this._splitSafely(M,A);for(let j=0,W=R.length;j<W;j++)y.push(R[j])}}}this.tree.delete(p)}return y}_splitSafely(l,p){this.tree.delete(l);let y=l.rightSE;this.queue.delete(y);let x=l.split(p);return x.push(y),l.consumedBy===void 0&&this.tree.add(l),x}},su=class{type;numMultiPolys;run(l,p,y){Qs.type=l;let x=[new _a(p,!0)];for(let W=0,et=y.length;W<et;W++)x.push(new _a(y[W],!1));if(Qs.numMultiPolys=x.length,Qs.type==="difference"){let W=x[0],et=1;for(;et<x.length;)da(x[et].bbox,W.bbox)!==null?et++:x.splice(et,1)}if(Qs.type==="intersection")for(let W=0,et=x.length;W<et;W++){let Tt=x[W];for(let kt=W+1,ie=x.length;kt<ie;kt++)if(da(Tt.bbox,x[kt].bbox)===null)return[]}let M=new fi(Ur.compare);for(let W=0,et=x.length;W<et;W++){let Tt=x[W].getSweepEvents();for(let kt=0,ie=Tt.length;kt<ie;kt++)M.add(Tt[kt])}let A=new nu(M),R=null;for(M.size!=0&&(R=M.first(),M.delete(R));R;){let W=A.process(R);for(let et=0,Tt=W.length;et<Tt;et++){let kt=W[et];kt.consumedBy===void 0&&M.add(kt)}M.size!=0?(R=M.first(),M.delete(R)):R=null}Dn.reset();let j=zn.factory(A.segments);return new Rl(j).getGeom()}},Qs=new su,za=Qs,bl=(l,...p)=>za.run("intersection",l,p),ou=(l,...p)=>za.run("difference",l,p),Ol=Dn.set;function ga(l){let p={type:"Feature"};return p.geometry=l,p}function So(l){return l.type==="Feature"?l.geometry:l}function Qn(l){return l&&l.geometry&&l.geometry.coordinates?l.geometry.coordinates:l}function ks(l){return ga({type:"LineString",coordinates:l})}function au(l){return ga({type:"MultiLineString",coordinates:l})}function nn(l){return ga({type:"Polygon",coordinates:l})}function ya(l){return ga({type:"MultiPolygon",coordinates:l})}function Lu(l,p){let y=So(l),x=So(p),M=bl(y.coordinates,x.coordinates);return M.length===0?null:M.length===1?nn(M[0]):ya(M)}function wl(l,p){let y=So(l),x=So(p),M=ou(y.coordinates,x.coordinates);return M.length===0?null:M.length===1?nn(M[0]):ya(M)}function lu(l){return Array.isArray(l)?1+lu(l[0]):-1}function Fl(l){l instanceof L.Polyline&&(l=l.toGeoJSON(15));let p=Qn(l),y=lu(p),x=[];return y>1?p.forEach(M=>{x.push(ks(M))}):x.push(l),x}function cl(l){let p=[];return l.eachLayer(y=>{p.push(Qn(y.toGeoJSON(15)))}),au(p)}Lr.Cut=Lr.Polygon.extend({initialize(l){this._map=l,this._shape="Cut",this.toolbarButtonName="cutPolygon"},_finishShape(){if(this._editedLayers=[],!this.options.allowSelfIntersection&&(this._handleSelfIntersection(!0,this._layer.getLatLngs()[0]),this._doesSelfIntersect)||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;let l=this._layer.getLatLngs();if(l.length<=2)return;let p=L.polygon(l,this.options.pathOptions);p._latlngInfos=this._layer._latlngInfo,this.cut(p),this._cleanupSnapping(),this._otherSnapLayers.splice(this._tempSnapLayerIndex,1),delete this._tempSnapLayerIndex,this._editedLayers.forEach(({layer:x,originalLayer:M})=>{this._fireCut(M,x,M),this._fireCut(this._map,x,M),M.pm._fireEdit()}),this._editedLayers=[];let y=this._hintMarker.getLatLng();this.disable(),this.options.continueDrawing&&(this.enable(),this._hintMarker.setLatLng(y))},cut(l){let p=this._map._layers,y=l._latlngInfos||[];Object.keys(p).map(x=>p[x]).filter(x=>x.pm).filter(x=>!x._pmTempLayer).filter(x=>!L.PM.optIn&&!x.options.pmIgnore||L.PM.optIn&&x.options.pmIgnore===!1).filter(x=>x instanceof L.Polyline).filter(x=>x!==l).filter(x=>x.pm.options.allowCutting).filter(x=>this.options.layersToCut&&L.Util.isArray(this.options.layersToCut)&&this.options.layersToCut.length>0?this.options.layersToCut.indexOf(x)>-1:!0).filter(x=>!this._layerGroup.hasLayer(x)).filter(x=>{try{let M=!!uo(l.toGeoJSON(15),x.toGeoJSON(15)).features.length>0;return M||x instanceof L.Polyline&&!(x instanceof L.Polygon)?M:!!Lu(l.toGeoJSON(15),x.toGeoJSON(15))}catch{return x instanceof L.Polygon&&console.error("You can't cut polygons with self-intersections"),!1}}).forEach(x=>{let M;if(x instanceof L.Polygon){M=L.polygon(x.getLatLngs());let W=M.getLatLngs();y.forEach(et=>{if(et&&et.snapInfo){let{latlng:Tt}=et,kt=this._calcClosestLayer(Tt,[M]);if(kt&&kt.segment&&kt.distance<this.options.snapDistance){let{segment:ie}=kt;if(ie&&ie.length===2){let{indexPath:Ut,parentPath:jt,newIndex:de}=L.PM.Utils._getIndexFromSegment(W,ie);(Ut.length>1?(0,Ts.default)(W,jt):W).splice(de,0,Tt)}}}})}else M=x;let A=this._cutLayer(l,M),R=L.geoJSON(A,x.options);R.getLayers().length===1&&([R]=R.getLayers()),this._setPane(R,"layerPane");let j=R.addTo(this._map.pm._getContainingLayer());if(j.pm.enable(x.pm.options),j.pm.disable(),x._pmTempLayer=!0,l._pmTempLayer=!0,x.remove(),x.removeFrom(this._map.pm._getContainingLayer()),l.remove(),l.removeFrom(this._map.pm._getContainingLayer()),j.getLayers&&j.getLayers().length===0&&this._map.pm.removeLayer({target:j}),j instanceof L.LayerGroup?(j.eachLayer(W=>{this._addDrawnLayerProp(W)}),this._addDrawnLayerProp(j)):this._addDrawnLayerProp(j),this.options.layersToCut&&L.Util.isArray(this.options.layersToCut)&&this.options.layersToCut.length>0){let W=this.options.layersToCut.indexOf(x);W>-1&&this.options.layersToCut.splice(W,1)}this._editedLayers.push({layer:j,originalLayer:x})})},_cutLayer(l,p){let y=L.geoJSON(),x;if(p instanceof L.Polygon)x=wl(p.toGeoJSON(15),l.toGeoJSON(15));else{let M=Fl(p);M.forEach(A=>{let R=xl(A,l.toGeoJSON(15)),j;R&&R.features.length>0?j=L.geoJSON(R):j=L.geoJSON(A),j.getLayers().forEach(W=>{Ba(l.toGeoJSON(15),W.toGeoJSON(15))||W.addTo(y)})}),M.length>1?x=cl(y):x=y.toGeoJSON(15)}return x},_change:L.Util.falseFn}),Lr.Text=Lr.extend({initialize(l){this._map=l,this._shape="Text",this.toolbarButtonName="drawText"},enable(l){L.Util.setOptions(this,l),this._enabled=!0,this._map.on("click",this._createMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!0),this._hintMarker=L.marker(this._map.getCenter(),{interactive:!1,zIndexOffset:100,icon:L.divIcon({className:"marker-icon cursor-marker"})}),this._setPane(this._hintMarker,"vertexPane"),this._hintMarker._pmTempLayer=!0,this._hintMarker.addTo(this._map),this.options.cursorMarker&&L.DomUtil.addClass(this._hintMarker._icon,"visible"),this.options.tooltips&&this._hintMarker.bindTooltip(li("tooltips.placeText"),{permanent:!0,offset:L.point(0,10),direction:"bottom",opacity:.8}).openTooltip(),this._layer=this._hintMarker,this._map.on("mousemove",this._syncHintMarker,this),this._map.getContainer().classList.add("geoman-draw-cursor"),this._fireDrawStart(),this._setGlobalDrawMode()},disable(){this._enabled&&(this._enabled=!1,this._map.off("click",this._createMarker,this),this._hintMarker?.remove(),this._map.getContainer().classList.remove("geoman-draw-cursor"),this._map.off("mousemove",this._syncHintMarker,this),this._map.off("mousemove",this._showHintMarker,this),this._map.pm.Toolbar.toggleButton(this.toolbarButtonName,!1),this.options.snappable&&this._cleanupSnapping(),this._fireDrawEnd(),this._setGlobalDrawMode())},enabled(){return this._enabled},toggle(l){this.enabled()?this.disable():this.enable(l)},_syncHintMarker(l){if(this._hintMarker.setLatLng(l.latlng),this.options.snappable){let p=l;p.target=this._hintMarker,this._handleSnapping(p)}},_createMarker(l){if(!l.latlng||this.options.requireSnapToFinish&&!this._hintMarker._snapped&&!this._isFirstLayer())return;this._hintMarker._snapped||this._hintMarker.setLatLng(l.latlng);let p=this._hintMarker.getLatLng();if(this.textArea=this._createTextArea(),this.options.textOptions?.className){let M=this.options.textOptions.className.split(" ");this.textArea.classList.add(...M)}let y=this._createTextIcon(this.textArea),x=new L.Marker(p,{textMarker:!0,_textMarkerOverPM:!0,icon:y});if(this._setPane(x,"markerPane"),this._finishLayer(x),x.pm||(x.options.draggable=!1),x.addTo(this._map.pm._getContainingLayer()),x.pm){x.pm.textArea=this.textArea,L.setOptions(x.pm,{removeIfEmpty:this.options.textOptions?.removeIfEmpty??!0});let M=this.options.textOptions?.focusAfterDraw??!0;x.pm._createTextMarker(M),this.options.textOptions?.text&&x.pm.setText(this.options.textOptions.text)}this._fireCreate(x),this._cleanupSnapping(),this.disable(),this.options.continueDrawing&&this._map.once("mousemove",this._showHintMarkerAfterMoving,this)},_showHintMarkerAfterMoving(l){this.enable(),this._hintMarker.setLatLng(l.latlng)},_createTextArea(){let l=document.createElement("textarea");return l.readOnly=!0,l.classList.add("pm-textarea","pm-disabled"),l},_createTextIcon(l){return L.divIcon({className:"pm-text-marker",html:l})}});var Ra={enableLayerDrag(){if(!this.options.draggable||!this._layer._map)return;this.disable(),this._layerDragEnabled=!0,this._map||(this._map=this._layer._map),(this._layer instanceof L.Marker||this._layer instanceof L.ImageOverlay)&&L.DomEvent.on(this._getDOMElem(),"dragstart",this._stopDOMImageDrag),this._layer.dragging&&this._layer.dragging.disable(),this._tempDragCoord=null,Xn(this._layer)instanceof L.Canvas?(this._layer.on("mouseout",this.removeDraggingClass,this),this._layer.on("mouseover",this.addDraggingClass,this)):this.addDraggingClass(),this._originalMapDragState=this._layer._map.dragging._enabled,this._safeToCacheDragState=!0;let l=this._getDOMElem();l&&(Xn(this._layer)instanceof L.Canvas?(this._layer.on("touchstart mousedown",this._dragMixinOnMouseDown,this),this._map.pm._addTouchEvents(l)):L.DomEvent.on(l,"touchstart mousedown",this._simulateMouseDownEvent,this)),this._fireDragEnable()},disableLayerDrag(){this._layerDragEnabled=!1,Xn(this._layer)instanceof L.Canvas?(this._layer.off("mouseout",this.removeDraggingClass,this),this._layer.off("mouseover",this.addDraggingClass,this)):this.removeDraggingClass(),this._originalMapDragState&&this._dragging&&this._map.dragging.enable(),this._safeToCacheDragState=!1,this._layer.dragging&&this._layer.dragging.disable();let l=this._getDOMElem();l&&(Xn(this._layer)instanceof L.Canvas?(this._layer.off("touchstart mousedown",this._dragMixinOnMouseDown,this),this._map.pm._removeTouchEvents(l)):L.DomEvent.off(l,"touchstart mousedown",this._simulateMouseDownEvent,this)),this._layerDragged&&this._fireUpdate(),this._layerDragged=!1,this._fireDragDisable()},dragging(){return this._dragging},layerDragEnabled(){return!!this._layerDragEnabled},_simulateMouseDownEvent(l){let p=l.touches?l.touches[0]:l,y={originalEvent:p,target:this._layer};return y.containerPoint=this._map.mouseEventToContainerPoint(p),y.latlng=this._map.containerPointToLatLng(y.containerPoint),this._dragMixinOnMouseDown(y),!1},_simulateMouseMoveEvent(l){let p=l.touches?l.touches[0]:l,y={originalEvent:p,target:this._layer};return y.containerPoint=this._map.mouseEventToContainerPoint(p),y.latlng=this._map.containerPointToLatLng(y.containerPoint),this._dragMixinOnMouseMove(y),!1},_simulateMouseUpEvent(l){let p={originalEvent:l.touches?l.touches[0]:l,target:this._layer};return l.type.indexOf("touch")===-1&&(p.containerPoint=this._map.mouseEventToContainerPoint(l),p.latlng=this._map.containerPointToLatLng(p.containerPoint)),this._dragMixinOnMouseUp(p),!1},_dragMixinOnMouseDown(l){if(l.originalEvent.button>0)return;this._overwriteEventIfItComesFromMarker(l);let p=l._fromLayerSync,y=this._syncLayers("_dragMixinOnMouseDown",l);if(this._layer instanceof L.Marker&&(this.options.snappable&&!p&&!y?this._initSnappableMarkers():this._disableSnapping()),this._layer instanceof L.CircleMarker){let x="resizeableCircleMarker";this._layer instanceof L.Circle&&(x="resizeableCircle"),this.options.snappable&&!p&&!y?this._layer.pm.options[x]||this._initSnappableMarkersDrag():this._layer.pm.options[x]?this._layer.pm._disableSnapping():this._layer.pm._disableSnappingDrag()}this._safeToCacheDragState&&(this._originalMapDragState=this._layer._map.dragging._enabled,this._safeToCacheDragState=!1),this._tempDragCoord=l.latlng,L.DomEvent.on(this._map.getContainer(),"touchend mouseup",this._simulateMouseUpEvent,this),L.DomEvent.on(this._map.getContainer(),"touchmove mousemove",this._simulateMouseMoveEvent,this)},_dragMixinOnMouseMove(l){this._overwriteEventIfItComesFromMarker(l);let p=this._getDOMElem();this._syncLayers("_dragMixinOnMouseMove",l),this._dragging||(this._dragging=!0,L.DomUtil.addClass(p,"leaflet-pm-dragging"),this._layer instanceof L.Marker||this._layer.bringToFront(),this._originalMapDragState&&this._map.dragging.disable(),this._fireDragStart()),this._tempDragCoord||(this._tempDragCoord=l.latlng),this._onLayerDrag(l),this._layer instanceof L.CircleMarker&&this._layer.pm._updateHiddenPolyCircle()},_dragMixinOnMouseUp(l){let p=this._getDOMElem();return this._syncLayers("_dragMixinOnMouseUp",l),this._originalMapDragState&&this._map.dragging.enable(),this._safeToCacheDragState=!0,L.DomEvent.off(this._map.getContainer(),"touchmove mousemove",this._simulateMouseMoveEvent,this),L.DomEvent.off(this._map.getContainer(),"touchend mouseup",this._simulateMouseUpEvent,this),this._dragging?(this._layer instanceof L.CircleMarker&&this._layer.pm._updateHiddenPolyCircle(),this._layerDragged=!0,window.setTimeout(()=>{this._dragging=!1,p&&L.DomUtil.removeClass(p,"leaflet-pm-dragging"),this._fireDragEnd(),this._fireEdit(),this._layerEdited=!0},10),!0):!1},_onLayerDrag(l){let{latlng:p}=l,y={lat:p.lat-this._tempDragCoord.lat,lng:p.lng-this._tempDragCoord.lng},x=M=>M.map(A=>{if(Array.isArray(A))return x(A);let R={lat:A.lat+y.lat,lng:A.lng+y.lng};return(A.alt||A.alt===0)&&(R.alt=A.alt),R});if(this._layer instanceof L.Circle&&this._layer.options.resizeableCircle||this._layer instanceof L.CircleMarker&&this._layer.options.resizeableCircleMarker){let M=x([this._layer.getLatLng()]);this._layer.setLatLng(M[0]),this._fireChange(this._layer.getLatLng(),"Edit")}else if(this._layer instanceof L.CircleMarker||this._layer instanceof L.Marker){let M=this._layer.getLatLng();this._layer._snapped&&(M=this._layer._orgLatLng);let A=x([M]);this._layer.setLatLng(A[0]),this._fireChange(this._layer.getLatLng(),"Edit")}else if(this._layer instanceof L.ImageOverlay){let M=x([this._layer.getBounds().getNorthWest(),this._layer.getBounds().getSouthEast()]);this._layer.setBounds(M),this._fireChange(this._layer.getBounds(),"Edit")}else{let M=x(this._layer.getLatLngs());this._layer.setLatLngs(M),this._fireChange(this._layer.getLatLngs(),"Edit")}this._tempDragCoord=p,l.layer=this._layer,this._fireDrag(l)},addDraggingClass(){let l=this._getDOMElem();l&&L.DomUtil.addClass(l,"leaflet-pm-draggable")},removeDraggingClass(){let l=this._getDOMElem();l&&L.DomUtil.removeClass(l,"leaflet-pm-draggable")},_getDOMElem(){let l=null;return this._layer._path?l=this._layer._path:this._layer._renderer&&this._layer._renderer._container?l=this._layer._renderer._container:this._layer._image?l=this._layer._image:this._layer._icon&&(l=this._layer._icon),l},_overwriteEventIfItComesFromMarker(l){l.target.getLatLng&&(!l.target._radius||l.target._radius<=10)&&(l.containerPoint=this._map.mouseEventToContainerPoint(l.originalEvent),l.latlng=this._map.containerPointToLatLng(l.containerPoint))},_syncLayers(l,p){if(this.enabled())return!1;if(!p._fromLayerSync&&this._layer===p.target&&this.options.syncLayersOnDrag){p._fromLayerSync=!0;let y=[];if(L.Util.isArray(this.options.syncLayersOnDrag))y=this.options.syncLayersOnDrag,this.options.syncLayersOnDrag.forEach(x=>{x instanceof L.LayerGroup&&(y=y.concat(x.pm.getLayers(!0)))});else if(this.options.syncLayersOnDrag===!0&&this._parentLayerGroup)for(let x in this._parentLayerGroup){let M=this._parentLayerGroup[x];M.pm&&(y=M.pm.getLayers(!0))}return L.Util.isArray(y)&&y.length>0&&(y=y.filter(x=>!!x.pm).filter(x=>!!x.pm.options.draggable),y.forEach(x=>{x!==this._layer&&x.pm[l]&&(x._snapped=!1,x.pm[l](p))})),y.length>0}return!1},_stopDOMImageDrag(l){return l.preventDefault(),!1}},to=Ra,De=se(Si());function Nl(l,p,y,x){return y.unproject(p.transform(y.project(l,x)),x)}function Oa(l,p,y){let x=y.getMaxZoom();if(x===1/0&&(x=y.getZoom()),L.Util.isArray(l)){let M=[];return l.forEach(A=>{M.push(Oa(A,p,y))}),M}return l instanceof L.LatLng?Nl(l,p,y,x):null}function Ho(l,p){p instanceof L.Layer&&(p=p.getLatLng());let y=l.getMaxZoom();return y===1/0&&(y=l.getZoom()),l.project(p,y)}function Wo(l,p){let y=l.getMaxZoom();return y===1/0&&(y=l.getZoom()),l.unproject(p,y)}var Fa={_onRotateStart(l){this._preventRenderingMarkers(!0),this._rotationOriginLatLng=this._getRotationCenter().clone(),this._rotationOriginPoint=Ho(this._map,this._rotationOriginLatLng),this._rotationStartPoint=Ho(this._map,l.target.getLatLng()),this._initialRotateLatLng=Mr(this._layer),this._startAngle=this.getAngle();let p=Mr(this._rotationLayer,this._rotationLayer.pm._rotateOrgLatLng);this._fireRotationStart(this._rotationLayer,p),this._fireRotationStart(this._map,p)},_onRotate(l){let p=Ho(this._map,l.target.getLatLng()),y=this._rotationStartPoint,x=this._rotationOriginPoint,M=Math.atan2(p.y-x.y,p.x-x.x)-Math.atan2(y.y-x.y,y.x-x.x);this._layer.setLatLngs(this._rotateLayer(M,this._initialRotateLatLng,this._rotationOriginLatLng,L.PM.Matrix.init(),this._map));let A=this;function R(Tt,kt=[],ie=-1){if(ie>-1&&kt.push(ie),L.Util.isArray(Tt[0]))Tt.forEach((Ut,jt)=>R(Ut,kt.slice(),jt));else{let Ut=kt.length>0?(0,De.default)(A._markers,kt):A._markers[0];Tt.forEach((jt,de)=>{Ut[de].setLatLng(jt)})}}R(this._layer.getLatLngs());let j=Mr(this._rotationLayer);this._rotationLayer.setLatLngs(this._rotateLayer(M,this._rotationLayer.pm._rotateOrgLatLng,this._rotationOriginLatLng,L.PM.Matrix.init(),this._map));let W=M*180/Math.PI;W=W<0?W+360:W;let et=W+this._startAngle;this._setAngle(et),this._rotationLayer.pm._setAngle(et),this._fireRotation(this._rotationLayer,W,j),this._fireRotation(this._map,W,j),this._rotationLayer.pm._fireChange(this._rotationLayer.getLatLngs(),"Rotation")},_onRotateEnd(){let l=this._startAngle;delete this._rotationOriginLatLng,delete this._rotationOriginPoint,delete this._rotationStartPoint,delete this._initialRotateLatLng,delete this._startAngle;let p=Mr(this._rotationLayer,this._rotationLayer.pm._rotateOrgLatLng);this._rotationLayer.pm._rotateOrgLatLng=Mr(this._rotationLayer),this._fireRotationEnd(this._rotationLayer,l,p),this._fireRotationEnd(this._map,l,p),this._rotationLayer.pm._fireEdit(this._rotationLayer,"Rotation"),this._preventRenderingMarkers(!1),this._layerRotated=!0},_rotateLayer(l,p,y,x,M){let A=Ho(M,y);return this._matrix=x.clone().rotate(l,A).flip(),Oa(p,this._matrix,M)},_setAngle(l){l=l<0?l+360:l,this._angle=l%360},_getRotationCenter(){if(this._rotationCenter)return this._rotationCenter;let l=L.polygon(this._layer.getLatLngs(),{stroke:!1,fill:!1,pmIgnore:!0}).addTo(this._layer._map),p=l.getCenter();return l.removeFrom(this._layer._map),p},enableRotate(){if(!this.options.allowRotation){this.disableRotate();return}this.rotateEnabled()&&this.disableRotate(),this._layer instanceof L.Rectangle&&this._angle===void 0&&this.setInitAngle(ao(this._layer._map,this._layer.getLatLngs()[0][0],this._layer.getLatLngs()[0][1])||0);let l={fill:!1,stroke:!1,pmIgnore:!1,snapIgnore:!0};this._rotatePoly=L.polygon(this._layer.getLatLngs(),l),this._rotatePoly._pmTempLayer=!0,this._rotatePoly.addTo(this._layer._map),this._rotatePoly.pm._setAngle(this.getAngle()),this._rotatePoly.pm.setRotationCenter(this.getRotationCenter()),this._rotatePoly.pm.setOptions(this._layer._map.pm.getGlobalOptions()),this._rotatePoly.pm.setOptions({rotate:!0,snappable:!1,hideMiddleMarkers:!0}),this._rotatePoly.pm._rotationLayer=this._layer,this._rotatePoly.pm.enable(),this._rotateOrgLatLng=Mr(this._layer),this._rotateEnabled=!0,this._layer.on("remove",this.disableRotate,this),this._fireRotationEnable(this._layer),this._fireRotationEnable(this._layer._map)},disableRotate(){this.rotateEnabled()&&(this._rotatePoly.pm._layerRotated&&this._fireUpdate(),this._rotatePoly.pm._layerRotated=!1,this._rotatePoly.pm.disable(),this._rotatePoly.remove(),this._rotatePoly.pm.setOptions({rotate:!1}),this._rotatePoly=void 0,this._rotateOrgLatLng=void 0,this._layer.off("remove",this.disableRotate,this),this._rotateEnabled=!1,this._fireRotationDisable(this._layer),this._fireRotationDisable(this._layer._map))},rotateEnabled(){return!!this._rotateEnabled},rotateLayer(l){let p=this.getAngle(),y=this._layer.getLatLngs(),x=l*(Math.PI/180);this._layer.setLatLngs(this._rotateLayer(x,this._layer.getLatLngs(),this._getRotationCenter(),L.PM.Matrix.init(),this._layer._map)),this._rotateOrgLatLng=L.polygon(this._layer.getLatLngs()).getLatLngs(),this._setAngle(this.getAngle()+l),this.rotateEnabled()&&this._rotatePoly&&this._rotatePoly.pm.enabled()&&(this._rotatePoly.setLatLngs(this._rotateLayer(x,this._rotatePoly.getLatLngs(),this._getRotationCenter(),L.PM.Matrix.init(),this._rotatePoly._map)),this._rotatePoly.pm._initMarkers());let M=this.getAngle()-p;M=M<0?M+360:M,this._startAngle=p,this._fireRotation(this._layer,M,y,this._layer),this._fireRotation(this._map||this._layer._map,M,y,this._layer),delete this._startAngle,this._fireChange(this._layer.getLatLngs(),"Rotation")},rotateLayerToAngle(l){let p=l-this.getAngle();this.rotateLayer(p)},getAngle(){return this._angle||0},setInitAngle(l){this._setAngle(l)},getRotationCenter(){return this._getRotationCenter()},setRotationCenter(l){this._rotationCenter=l,this._rotatePoly&&this._rotatePoly.pm.setRotationCenter(l)}},jl=Fa,xi=L.Class.extend({includes:[to,lo,jl,vi],options:{snappable:!0,snapDistance:20,allowSelfIntersection:!0,allowSelfIntersectionEdit:!1,preventMarkerRemoval:!1,removeLayerBelowMinVertexCount:!0,limitMarkersToCount:-1,hideMiddleMarkers:!1,snapSegment:!0,syncLayersOnDrag:!1,draggable:!0,allowEditing:!0,allowRemoval:!0,allowCutting:!0,allowRotation:!0,addVertexOn:"click",removeVertexOn:"contextmenu",removeVertexValidation:void 0,addVertexValidation:void 0,moveVertexValidation:void 0,resizeableCircleMarker:!1,resizeableCircle:!0,snapMiddle:!1,snapVertex:!0},setOptions(l){L.Util.setOptions(this,l)},getOptions(){return this.options},applyOptions(){},isPolygon(){return this._layer instanceof L.Polygon},getShape(){return this._shape},_setPane(l,p){p==="layerPane"?l.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.layerPane||"overlayPane":p==="vertexPane"?l.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.vertexPane||"markerPane":p==="markerPane"&&(l.options.pane=this._map.pm.globalOptions.panes&&this._map.pm.globalOptions.panes.markerPane||"markerPane")},remove(){(this._map||this._layer._map).pm.removeLayer({target:this._layer})},_vertexValidation(l,p){let y=p.target,x={layer:this._layer,marker:y,event:p},M="";return l==="move"?M="moveVertexValidation":l==="add"?M="addVertexValidation":l==="remove"&&(M="removeVertexValidation"),this.options[M]&&typeof this.options[M]=="function"&&!this.options[M](x)?(l==="move"&&(y._cancelDragEventChain=y.getLatLng()),!1):(y._cancelDragEventChain=null,!0)},_vertexValidationDrag(l){return l._cancelDragEventChain?(l._latlng=l._cancelDragEventChain,l.update(),!1):!0},_vertexValidationDragEnd(l){return l._cancelDragEventChain?(l._cancelDragEventChain=null,!1):!0}}),xr=xi;xr.LayerGroup=L.Class.extend({initialize(l){this._layerGroup=l,this._layers=this.getLayers(),this._getMap(),this._layers.forEach(x=>this._initLayer(x));let p=x=>{if(x.layer._pmTempLayer)return;this._layers=this.getLayers();let M=this._layers.filter(A=>!A.pm._parentLayerGroup||!(this._layerGroup._leaflet_id in A.pm._parentLayerGroup));M.forEach(A=>{this._initLayer(A)}),M.length>0&&this._getMap()&&this._getMap().pm.globalEditModeEnabled()&&this.enabled()&&this.enable(this.getOptions())};this._layerGroup.on("layeradd",L.Util.throttle(p,100,this),this),this._layerGroup.on("layerremove",x=>{this._removeLayerFromGroup(x.target)},this);let y=x=>{x.target._pmTempLayer||(this._layers=this.getLayers())};this._layerGroup.on("layerremove",L.Util.throttle(y,100,this),this)},enable(l,p=[]){p.length===0&&(this._layers=this.getLayers()),this._options=l,this._layers.forEach(y=>{y instanceof L.LayerGroup?p.indexOf(y._leaflet_id)===-1&&(p.push(y._leaflet_id),y.pm.enable(l,p)):y.pm.enable(l)})},disable(l=[]){l.length===0&&(this._layers=this.getLayers()),this._layers.forEach(p=>{p instanceof L.LayerGroup?l.indexOf(p._leaflet_id)===-1&&(l.push(p._leaflet_id),p.pm.disable(l)):p.pm.disable()})},enabled(l=[]){return l.length===0&&(this._layers=this.getLayers()),!!this._layers.find(p=>p instanceof L.LayerGroup?l.indexOf(p._leaflet_id)===-1?(l.push(p._leaflet_id),p.pm.enabled(l)):!1:p.pm.enabled())},toggleEdit(l,p=[]){p.length===0&&(this._layers=this.getLayers()),this._options=l,this._layers.forEach(y=>{y instanceof L.LayerGroup?p.indexOf(y._leaflet_id)===-1&&(p.push(y._leaflet_id),y.pm.toggleEdit(l,p)):y.pm.toggleEdit(l)})},_initLayer(l){let p=L.Util.stamp(this._layerGroup);l.pm._parentLayerGroup||(l.pm._parentLayerGroup={}),l.pm._parentLayerGroup[p]=this._layerGroup},_removeLayerFromGroup(l){if(l.pm&&l.pm._layerGroup){let p=L.Util.stamp(this._layerGroup);delete l.pm._layerGroup[p]}},dragging(){return this._layers=this.getLayers(),this._layers?!!this._layers.find(l=>l.pm.dragging()):!1},getOptions(){return this.options},_getMap(){return this._map||this._layers.find(l=>!!l._map)?._map||null},getLayers(l=!1,p=!0,y=!0,x=[]){let M=[];return l?this._layerGroup.getLayers().forEach(A=>{M.push(A),A instanceof L.LayerGroup&&x.indexOf(A._leaflet_id)===-1&&(x.push(A._leaflet_id),M=M.concat(A.pm.getLayers(!0,!0,!0,x)))}):M=this._layerGroup.getLayers(),y&&(M=M.filter(A=>!(A instanceof L.LayerGroup))),p&&(M=M.filter(A=>!!A.pm),M=M.filter(A=>!A._pmTempLayer),M=M.filter(A=>!L.PM.optIn&&!A.options.pmIgnore||L.PM.optIn&&A.options.pmIgnore===!1)),M},setOptions(l,p=[]){p.length===0&&(this._layers=this.getLayers()),this.options=l,this._layers.forEach(y=>{y.pm&&(y instanceof L.LayerGroup?p.indexOf(y._leaflet_id)===-1&&(p.push(y._leaflet_id),y.pm.setOptions(l,p)):y.pm.setOptions(l))})}}),xr.Marker=xr.extend({_shape:"Marker",initialize(l){this._layer=l,this._enabled=!1,this._layer.on("dragend",this._onDragEnd,this)},enable(l={draggable:!0}){if(L.Util.setOptions(this,l),!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._fireEnable()},disable(){this.enabled()&&(this.disableLayerDrag(),this._layer.off("remove",this.disable,this),this._layer.off("contextmenu",this._removeMarker,this),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1)},enabled(){return this._enabled},toggleEdit(l){this.enabled()?this.disable():this.enable(l)},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),this.options.draggable?this.enableLayerDrag():this.disableLayerDrag(),this.options.preventMarkerRemoval||this._layer.on("contextmenu",this._removeMarker,this)},_removeMarker(l){let p=l.target;p.remove(),this._fireRemove(p),this._fireRemove(this._map,p)},_onDragEnd(){this._fireEdit(),this._layerEdited=!0},_initSnappableMarkers(){let l=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,l.off("pm:drag",this._handleSnapping,this),l.on("pm:drag",this._handleSnapping,this),l.off("pm:dragend",this._cleanupSnapping,this),l.on("pm:dragend",this._cleanupSnapping,this),l.off("pm:dragstart",this._unsnap,this),l.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){let l=this._layer;l.off("pm:drag",this._handleSnapping,this),l.off("pm:dragend",this._cleanupSnapping,this),l.off("pm:dragstart",this._unsnap,this)}});var ko=se(Si()),Cl={filterMarkerGroup(){this.markerCache=[],this.createCache(),this._layer.on("pm:edit",this.createCache,this),this.applyLimitFilters({}),this.throttledApplyLimitFilters||(this.throttledApplyLimitFilters=L.Util.throttle(this.applyLimitFilters,100,this)),this._layer.on("pm:disable",this._removeMarkerLimitEvents,this),this._layer.on("remove",this._removeMarkerLimitEvents,this),this.options.limitMarkersToCount>-1&&(this._layer.on("pm:vertexremoved",this._initMarkers,this),this._map.on("mousemove",this.throttledApplyLimitFilters,this))},_removeMarkerLimitEvents(){this._map.off("mousemove",this.throttledApplyLimitFilters,this),this._layer.off("pm:edit",this.createCache,this),this._layer.off("pm:disable",this._removeMarkerLimitEvents,this),this._layer.off("pm:vertexremoved",this._initMarkers,this)},createCache(){let l=[...this._markerGroup.getLayers(),...this.markerCache];this.markerCache=l.filter((p,y,x)=>x.indexOf(p)===y)},_removeFromCache(l){let p=this.markerCache.indexOf(l);p>-1&&this.markerCache.splice(p,1)},renderLimits(l){this.markerCache.forEach(p=>{l.includes(p)?this._markerGroup.addLayer(p):this._markerGroup.removeLayer(p)})},applyLimitFilters({latlng:l={lat:0,lng:0}}){if(this._preventRenderMarkers)return;let p=[...this._filterClosestMarkers(l)];this.renderLimits(p)},_filterClosestMarkers(l){let p=[...this.markerCache],y=this.options.limitMarkersToCount;return y===-1?p:(p.sort((x,M)=>{let A=x._latlng.distanceTo(l),R=M._latlng.distanceTo(l);return A-R}),p.filter((x,M)=>y>-1?M<y:!0))},_preventRenderMarkers:!1,_preventRenderingMarkers(l){this._preventRenderMarkers=!!l}},Tu=Cl;xr.Line=xr.extend({includes:[Tu],_shape:"Line",initialize(l){this._layer=l,this._enabled=!1},enable(l){if(L.Util.setOptions(this,l),this._map=this._layer._map,!!this._map){if(!this.options.allowEditing){this.disable();return}this.enabled()&&this.disable(),this._enabled=!0,this._initMarkers(),this.applyOptions(),this._layer.on("remove",this.disable,this),this.options.allowSelfIntersection||this._layer.on("pm:vertexremoved",this._handleSelfIntersectionOnVertexRemoval,this),this.options.allowSelfIntersection?this.cachedColor=void 0:(this._layer.options.color!=="#f00000ff"?(this.cachedColor=this._layer.options.color,this.isRed=!1):this.isRed=!0,this._handleLayerStyle()),this._fireEnable()}},disable(){if(!this.enabled()||this._dragging)return;this._enabled=!1,this._markerGroup.clearLayers(),this._markerGroup.removeFrom(this._map),this._layer.off("remove",this.disable,this),this.options.allowSelfIntersection||this._layer.off("pm:vertexremoved",this._handleSelfIntersectionOnVertexRemoval,this);let l=this._layer._path?this._layer._path:this._layer._renderer._container;L.DomUtil.removeClass(l,"leaflet-pm-draggable"),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable()},enabled(){return this._enabled},toggleEdit(l){return this.enabled()?this.disable():this.enable(l),this.enabled()},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping()},_initMarkers(){let l=this._map,p=this._layer.getLatLngs();this._markerGroup&&(this._markerGroup.removeFrom(l),this._markerGroup.clearLayers()),this._markerGroup=new L.FeatureGroup,this._markerGroup._pmTempLayer=!0;let y=x=>{if(Array.isArray(x[0]))return x.map(y,this);let M=x.map(this._createMarker,this);return this.options.hideMiddleMarkers!==!0&&x.map((A,R)=>{let j=this.isPolygon()?(R+1)%x.length:R+1;return this._createMiddleMarker(M[R],M[j])}),M};this._markers=y(p),this.filterMarkerGroup(),l.addLayer(this._markerGroup)},_createMarker(l){let p=new L.Marker(l,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(p,"vertexPane"),p._pmTempLayer=!0,this.options.rotate?(p.on("dragstart",this._onRotateStart,this),p.on("drag",this._onRotate,this),p.on("dragend",this._onRotateEnd,this)):(p.on("click",this._onVertexClick,this),p.on("dragstart",this._onMarkerDragStart,this),p.on("move",this._onMarkerDrag,this),p.on("dragend",this._onMarkerDragEnd,this),this.options.preventMarkerRemoval||p.on(this.options.removeVertexOn,this._removeMarker,this)),this._markerGroup.addLayer(p),p},_createMiddleMarker(l,p){if(!l||!p)return!1;let y=L.PM.Utils.calcMiddleLatLng(this._map,l.getLatLng(),p.getLatLng()),x=this._createMarker(y),M=L.divIcon({className:"marker-icon marker-icon-middle"});return x.setIcon(M),x.leftM=l,x.rightM=p,l._middleMarkerNext=x,p._middleMarkerPrev=x,x.on(this.options.addVertexOn,this._onMiddleMarkerClick,this),x.on("movestart",this._onMiddleMarkerMoveStart,this),x},_onMiddleMarkerClick(l){let p=l.target;if(!this._vertexValidation("add",l))return;let y=L.divIcon({className:"marker-icon"});p.setIcon(y),this._addMarker(p,p.leftM,p.rightM)},_onMiddleMarkerMoveStart(l){let p=l.target;if(p.on("moveend",this._onMiddleMarkerMoveEnd,this),!this._vertexValidation("add",l)){p.on("move",this._onMiddleMarkerMovePrevent,this);return}p._dragging=!0,this._addMarker(p,p.leftM,p.rightM)},_onMiddleMarkerMovePrevent(l){let p=l.target;this._vertexValidationDrag(p)},_onMiddleMarkerMoveEnd(l){let p=l.target;if(p.off("move",this._onMiddleMarkerMovePrevent,this),p.off("moveend",this._onMiddleMarkerMoveEnd,this),!this._vertexValidationDragEnd(p))return;let y=L.divIcon({className:"marker-icon"});p.setIcon(y),setTimeout(()=>{delete p._dragging},100)},_addMarker(l,p,y){l.off("movestart",this._onMiddleMarkerMoveStart,this),l.off(this.options.addVertexOn,this._onMiddleMarkerClick,this);let x=l.getLatLng(),M=this._layer._latlngs;delete l.leftM,delete l.rightM;let{indexPath:A,index:R,parentPath:j}=L.PM.Utils.findDeepMarkerIndex(this._markers,p),W=A.length>1?(0,ko.default)(M,j):M,et=A.length>1?(0,ko.default)(this._markers,j):this._markers;W.splice(R+1,0,x),et.splice(R+1,0,l),this._layer.setLatLngs(M),this.options.hideMiddleMarkers!==!0&&(this._createMiddleMarker(p,l),this._createMiddleMarker(l,y)),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit"),this._fireVertexAdded(l,L.PM.Utils.findDeepMarkerIndex(this._markers,l).indexPath,x),this.options.snappable&&this._initSnappableMarkers()},hasSelfIntersection(){return Hs(this._layer.toGeoJSON(15)).features.length>0},_handleSelfIntersectionOnVertexRemoval(){this._handleLayerStyle(!0)&&(this._layer.setLatLngs(this._coordsBeforeEdit),this._coordsBeforeEdit=null,this._initMarkers())},_handleLayerStyle(l){let p=this._layer,y,x;if(this.options.allowSelfIntersection?y=!1:(x=Hs(this._layer.toGeoJSON(15)),y=x.features.length>0),y){if(!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._updateDisabledMarkerStyle(this._markers,!0),this.isRed)return y;l?this._flashLayer():(p.setStyle({color:"#f00000ff"}),this.isRed=!0),this._fireIntersect(x)}else p.setStyle({color:this.cachedColor}),this.isRed=!1,!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._updateDisabledMarkerStyle(this._markers,!1);return y},_flashLayer(){this.cachedColor||(this.cachedColor=this._layer.options.color),this._layer.setStyle({color:"#f00000ff"}),this.isRed=!0,window.setTimeout(()=>{this._layer.setStyle({color:this.cachedColor}),this.isRed=!1},200)},_updateDisabledMarkerStyle(l,p){l.forEach(y=>{Array.isArray(y)?this._updateDisabledMarkerStyle(y,p):y._icon&&(p&&!this._checkMarkerAllowedToDrag(y)?L.DomUtil.addClass(y._icon,"vertexmarker-disabled"):L.DomUtil.removeClass(y._icon,"vertexmarker-disabled"))})},_removeMarker(l){let p=l.target;if(!this._vertexValidation("remove",l))return;this.options.allowSelfIntersection||(this._coordsBeforeEdit=Mr(this._layer,this._layer.getLatLngs()));let y=this._layer.getLatLngs(),{indexPath:x,index:M,parentPath:A}=L.PM.Utils.findDeepMarkerIndex(this._markers,p);if(!x)return;let R=x.length>1?(0,ko.default)(y,A):y,j=x.length>1?(0,ko.default)(this._markers,A):this._markers,W=A[A.length-1]>0&&this._layer instanceof L.Polygon;if(!this.options.removeLayerBelowMinVertexCount&&!W&&(R.length<=2||this.isPolygon()&&R.length<=3)){this._flashLayer();return}R.splice(M,1),this._layer.setLatLngs(y),this.isPolygon()&&R.length<=2&&R.splice(0,R.length);let et=!1;if(R.length<=1&&(R.splice(0,R.length),A.length>1&&x.length>1&&(y=Wn(y)),this._layer.setLatLngs(y),this._initMarkers(),et=!0),ar(y)||this._layer.remove(),y=Wn(y),this._layer.setLatLngs(y),this._markers=Wn(this._markers),!et&&(j=x.length>1?(0,ko.default)(this._markers,A):this._markers,p._middleMarkerPrev&&(this._markerGroup.removeLayer(p._middleMarkerPrev),this._removeFromCache(p._middleMarkerPrev)),p._middleMarkerNext&&(this._markerGroup.removeLayer(p._middleMarkerNext),this._removeFromCache(p._middleMarkerNext)),this._markerGroup.removeLayer(p),this._removeFromCache(p),j)){let Tt,kt;if(this.isPolygon()?(Tt=(M+1)%j.length,kt=(M+(j.length-1))%j.length):(kt=M-1<0?void 0:M-1,Tt=M+1>=j.length?void 0:M+1),Tt!==kt){let ie=j[kt],Ut=j[Tt];this.options.hideMiddleMarkers!==!0&&this._createMiddleMarker(ie,Ut)}j.splice(M,1)}this._fireEdit(),this._layerEdited=!0,this._fireVertexRemoved(p,x),this._fireChange(this._layer.getLatLngs(),"Edit")},updatePolygonCoordsFromMarkerDrag(l){let p=this._layer.getLatLngs(),y=l.getLatLng(),{indexPath:x,index:M,parentPath:A}=L.PM.Utils.findDeepMarkerIndex(this._markers,l);(x.length>1?(0,ko.default)(p,A):p).splice(M,1,y),this._layer.setLatLngs(p)},_getNeighborMarkers(l){let{indexPath:p,index:y,parentPath:x}=L.PM.Utils.findDeepMarkerIndex(this._markers,l),M=p.length>1?(0,ko.default)(this._markers,x):this._markers,A=(y+1)%M.length,R=(y+(M.length-1))%M.length,j=M[R],W=M[A];return{prevMarker:j,nextMarker:W}},_checkMarkerAllowedToDrag(l){let{prevMarker:p,nextMarker:y}=this._getNeighborMarkers(l),x=L.polyline([p.getLatLng(),l.getLatLng()]),M=L.polyline([l.getLatLng(),y.getLatLng()]),A=uo(this._layer.toGeoJSON(15),x.toGeoJSON(15)).features.length,R=uo(this._layer.toGeoJSON(15),M.toGeoJSON(15)).features.length;return l.getLatLng()===this._markers[0][0].getLatLng()?R+=1:l.getLatLng()===this._markers[0][this._markers[0].length-1].getLatLng()&&(A+=1),!(A<=2&&R<=2)},_onMarkerDragStart(l){let p=l.target;if(this.cachedColor||(this.cachedColor=this._layer.options.color),!this._vertexValidation("move",l))return;let{indexPath:y}=L.PM.Utils.findDeepMarkerIndex(this._markers,p);this._fireMarkerDragStart(l,y),this.options.allowSelfIntersection||(this._coordsBeforeEdit=Mr(this._layer,this._layer.getLatLngs())),!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this.hasSelfIntersection()?this._markerAllowedToDrag=this._checkMarkerAllowedToDrag(p):this._markerAllowedToDrag=null},_onMarkerDrag(l){let p=l.target;if(!this._vertexValidationDrag(p))return;let{indexPath:y,index:x,parentPath:M}=L.PM.Utils.findDeepMarkerIndex(this._markers,p);if(!y)return;if(!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this.hasSelfIntersection()&&this._markerAllowedToDrag===!1){this._layer.setLatLngs(this._coordsBeforeEdit),this._initMarkers(),this._handleLayerStyle();return}this.updatePolygonCoordsFromMarkerDrag(p);let A=y.length>1?(0,ko.default)(this._markers,M):this._markers,R=(x+1)%A.length,j=(x+(A.length-1))%A.length,W=p.getLatLng(),et=A[j].getLatLng(),Tt=A[R].getLatLng();if(p._middleMarkerNext){let kt=L.PM.Utils.calcMiddleLatLng(this._map,W,Tt);p._middleMarkerNext.setLatLng(kt)}if(p._middleMarkerPrev){let kt=L.PM.Utils.calcMiddleLatLng(this._map,W,et);p._middleMarkerPrev.setLatLng(kt)}this.options.allowSelfIntersection||this._handleLayerStyle(),this._fireMarkerDrag(l,y),this._fireChange(this._layer.getLatLngs(),"Edit")},_onMarkerDragEnd(l){let p=l.target;if(!this._vertexValidationDragEnd(p))return;let{indexPath:y}=L.PM.Utils.findDeepMarkerIndex(this._markers,p),x=!this.options.allowSelfIntersection&&this.hasSelfIntersection();x&&this.options.allowSelfIntersectionEdit&&this._markerAllowedToDrag&&(x=!1);let M=!this.options.allowSelfIntersection&&x;if(this._fireMarkerDragEnd(l,y,M),M){this._layer.setLatLngs(this._coordsBeforeEdit),this._coordsBeforeEdit=null,this._initMarkers(),this.options.snappable&&this._initSnappableMarkers(),this._handleLayerStyle(),this._fireLayerReset(l,y);return}!this.options.allowSelfIntersection&&this.options.allowSelfIntersectionEdit&&this._handleLayerStyle(),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit")},_onVertexClick(l){let p=l.target;if(p._dragging)return;let{indexPath:y}=L.PM.Utils.findDeepMarkerIndex(this._markers,p);this._fireVertexClick(l,y)}}),xr.Polygon=xr.Line.extend({_shape:"Polygon",_checkMarkerAllowedToDrag(l){let{prevMarker:p,nextMarker:y}=this._getNeighborMarkers(l),x=L.polyline([p.getLatLng(),l.getLatLng()]),M=L.polyline([l.getLatLng(),y.getLatLng()]),A=uo(this._layer.toGeoJSON(15),x.toGeoJSON(15)).features.length,R=uo(this._layer.toGeoJSON(15),M.toGeoJSON(15)).features.length;return!(A<=2&&R<=2)}}),xr.Rectangle=xr.Polygon.extend({_shape:"Rectangle",_initMarkers(){let l=this._map,p=this._findCorners();this._markerGroup&&this._markerGroup.clearLayers(),this._markerGroup=new L.FeatureGroup,this._markerGroup._pmTempLayer=!0,l.addLayer(this._markerGroup),this._markers=[],this._markers[0]=p.map(this._createMarker,this),[this._cornerMarkers]=this._markers,this._layer.getLatLngs()[0].forEach((y,x)=>{let M=this._cornerMarkers.find(A=>A._index===x);M&&M.setLatLng(y)})},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping(),this._addMarkerEvents()},_createMarker(l,p){let y=new L.Marker(l,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(y,"vertexPane"),y._origLatLng=l,y._index=p,y._pmTempLayer=!0,y.on("click",this._onVertexClick,this),this._markerGroup.addLayer(y),y},_addMarkerEvents(){this._markers[0].forEach(l=>{l.on("dragstart",this._onMarkerDragStart,this),l.on("drag",this._onMarkerDrag,this),l.on("dragend",this._onMarkerDragEnd,this),this.options.preventMarkerRemoval||l.on("contextmenu",this._removeMarker,this)})},_removeMarker(){return null},_onMarkerDragStart(l){if(!this._vertexValidation("move",l))return;let p=l.target,y=this._cornerMarkers;p._oppositeCornerLatLng=y.find(M=>M._index===(p._index+2)%4).getLatLng(),p._snapped=!1;let{indexPath:x}=L.PM.Utils.findDeepMarkerIndex(this._markers,p);this._fireMarkerDragStart(l,x)},_onMarkerDrag(l){let p=l.target;if(!this._vertexValidationDrag(p)||p._index===void 0)return;this._adjustRectangleForMarkerMove(p);let{indexPath:y}=L.PM.Utils.findDeepMarkerIndex(this._markers,p);this._fireMarkerDrag(l,y),this._fireChange(this._layer.getLatLngs(),"Edit")},_onMarkerDragEnd(l){let p=l.target;if(!this._vertexValidationDragEnd(p))return;this._cornerMarkers.forEach(x=>{delete x._oppositeCornerLatLng});let{indexPath:y}=L.PM.Utils.findDeepMarkerIndex(this._markers,p);this._fireMarkerDragEnd(l,y),this._fireEdit(),this._layerEdited=!0,this._fireChange(this._layer.getLatLngs(),"Edit")},_adjustRectangleForMarkerMove(l){L.extend(l._origLatLng,l._latlng);let p=L.PM.Utils._getRotatedRectangle(l.getLatLng(),l._oppositeCornerLatLng,this.getAngle(),this._map);this._layer.setLatLngs(p),this._adjustAllMarkers(l),this._layer.redraw()},_adjustAllMarkers(l){let p=this._layer.getLatLngs()[0];if(p&&p.length!==4&&p.length>0)p.forEach((y,x)=>{this._cornerMarkers[x].setLatLng(y)}),this._cornerMarkers.slice(p.length).forEach(y=>{y.setLatLng(p[0])});else if(!p||!p.length)console.error("The layer has no LatLngs");else{let y=p.findIndex(x=>l.getLatLng().equals(x));y>-1?(this._cornerMarkers[(l._index+1)%4].setLatLng(p[(y+1)%4]),this._cornerMarkers[(l._index+2)%4].setLatLng(p[(y+2)%4]),this._cornerMarkers[(l._index+3)%4].setLatLng(p[(y+3)%4])):this._cornerMarkers.forEach(x=>{x.setLatLng(p[x._index])})}},_findCorners(){this._angle===void 0&&this.setInitAngle(ao(this._map,this._layer.getLatLngs()[0][0],this._layer.getLatLngs()[0][1])||0);let l=this._layer.getLatLngs()[0];return L.PM.Utils._getRotatedRectangle(l[0],l[2],this.getAngle(),this._map||this)}}),xr.CircleMarker=xr.extend({_shape:"CircleMarker",initialize(l){this._layer=l,this._enabled=!1,this._minRadiusOption="minRadiusCircleMarker",this._maxRadiusOption="maxRadiusCircleMarker",this._editableOption="resizeableCircleMarker",this._updateHiddenPolyCircle()},enable(l={draggable:!0,snappable:!0}){if(L.Util.setOptions(this,l),this.options.editable&&(this.options.resizeableCircleMarker=this.options.editable,delete this.options.editable),!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._extendingEnable(),this._updateHiddenPolyCircle(),this._fireEnable()},_extendingEnable(){this._layer.on("pm:dragstart",this._onDragStart,this),this._layer.on("pm:drag",this._onMarkerDrag,this),this._layer.on("pm:dragend",this._onMarkerDragEnd,this)},disable(){this.dragging()||(this._map||(this._map=this._layer._map),this._map&&this.enabled()&&(this.layerDragEnabled()&&this.disableLayerDrag(),this._helperLayers&&(this._helperLayers.clearLayers(),this._helperLayers.removeFrom(this._map)),this.options[this._editableOption]?(this._map.off("move",this._syncMarkers,this),this._outerMarker.off("drag",this._handleOuterMarkerSnapping,this)):this._map.off("move",this._updateHiddenPolyCircle,this),this._extendingDisable(),this._layer.off("remove",this.disable,this),this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1))},_extendingDisable(){this._layer.off("contextmenu",this._removeMarker,this)},enabled(){return this._enabled},toggleEdit(l){this.enabled()?this.disable():this.enable(l)},applyOptions(){this.options[this._editableOption]?(this._initMarkers(),this._map.on("move",this._syncMarkers,this),this.options.snappable?(this._initSnappableMarkers(),this._outerMarker.on("drag",this._handleOuterMarkerSnapping,this),this._outerMarker.on("move",this._syncHintLine,this),this._outerMarker.on("move",this._syncCircleRadius,this)):this._disableSnapping()):(this.options.draggable&&this.enableLayerDrag(),this._map.on("move",this._updateHiddenPolyCircle,this),this.options.snappable?this._initSnappableMarkersDrag():this._disableSnappingDrag()),this._extendingApplyOptions()},_extendingApplyOptions(){this.options.preventMarkerRemoval||this._layer.on("contextmenu",this._removeMarker,this)},_initMarkers(){let l=this._map;this._helperLayers&&(this._helperLayers.removeFrom(l),this._helperLayers.clearLayers()),this._helperLayers=new L.FeatureGroup,this._helperLayers._pmTempLayer=!0,this._helperLayers.addTo(l);let p=this._layer.getLatLng(),y=this._layer._radius,x=this._getLatLngOnCircle(p,y);this._centerMarker=this._createCenterMarker(p),this._outerMarker=this._createOuterMarker(x),this._markers=[this._centerMarker,this._outerMarker],this._createHintLine(this._centerMarker,this._outerMarker)},_getLatLngOnCircle(l,p){let y=this._map.project(l),x=L.point(y.x+p,y.y);return this._map.unproject(x)},_createHintLine(l,p){let y=l.getLatLng(),x=p.getLatLng();this._hintline=L.polyline([y,x],this.options.hintlineStyle),this._setPane(this._hintline,"layerPane"),this._hintline._pmTempLayer=!0,this._helperLayers.addLayer(this._hintline)},_createCenterMarker(l){let p=this._createMarker(l);return this.options.draggable?(L.DomUtil.addClass(p._icon,"leaflet-pm-draggable"),p.on("move",this._moveCircle,this)):p.dragging.disable(),p},_createOuterMarker(l){let p=this._createMarker(l);return p.on("drag",this._resizeCircle,this),p},_createMarker(l){let p=new L.Marker(l,{draggable:!0,icon:L.divIcon({className:"marker-icon"})});return this._setPane(p,"vertexPane"),p._origLatLng=l,p._pmTempLayer=!0,p.on("dragstart",this._onMarkerDragStart,this),p.on("drag",this._onMarkerDrag,this),p.on("dragend",this._onMarkerDragEnd,this),p.on("click",this._onVertexClick,this),this._helperLayers.addLayer(p),p},_moveCircle(l){if(l.target._cancelDragEventChain)return;let p=this._centerMarker.getLatLng();this._layer.setLatLng(p);let y=this._layer._radius,x=this._getLatLngOnCircle(p,y);this._outerMarker._latlng=x,this._outerMarker.update(),this._syncHintLine(),this._updateHiddenPolyCircle(),this._fireCenterPlaced("Edit"),this._fireChange(this._layer.getLatLng(),"Edit")},_syncMarkers(){let l=this._layer.getLatLng(),p=this._layer._radius,y=this._getLatLngOnCircle(l,p);this._outerMarker.setLatLng(y),this._centerMarker.setLatLng(l),this._syncHintLine(),this._updateHiddenPolyCircle()},_resizeCircle(){this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker()),this._syncHintLine(),this._syncCircleRadius()},_syncCircleRadius(){let l=this._centerMarker.getLatLng(),p=this._outerMarker.getLatLng(),y=this._distanceCalculation(l,p);this.options[this._minRadiusOption]&&y<this.options[this._minRadiusOption]?this._layer.setRadius(this.options[this._minRadiusOption]):this.options[this._maxRadiusOption]&&y>this.options[this._maxRadiusOption]?this._layer.setRadius(this.options[this._maxRadiusOption]):this._layer.setRadius(y),this._updateHiddenPolyCircle(),this._fireChange(this._layer.getLatLng(),"Edit")},_syncHintLine(){let l=this._centerMarker.getLatLng(),p=this._outerMarker.getLatLng();this._hintline.setLatLngs([l,p])},_removeMarker(){this.options[this._editableOption]&&this.disable(),this._layer.remove(),this._fireRemove(this._layer),this._fireRemove(this._map,this._layer)},_onDragStart(){this._map.pm.Draw.CircleMarker._layerIsDragging=!0},_onMarkerDragStart(l){this._vertexValidation("move",l)&&this._fireMarkerDragStart(l)},_onMarkerDrag(l){let p=l.target;p instanceof L.Marker&&!this._vertexValidationDrag(p)||this._fireMarkerDrag(l)},_onMarkerDragEnd(l){this._extedingMarkerDragEnd();let p=l.target;this._vertexValidationDragEnd(p)&&(this.options[this._editableOption]&&(this._fireEdit(),this._layerEdited=!0),this._fireMarkerDragEnd(l))},_extedingMarkerDragEnd(){this._map.pm.Draw.CircleMarker._layerIsDragging=!1},_initSnappableMarkersDrag(){let l=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,l.off("pm:drag",this._handleSnapping,this),l.on("pm:drag",this._handleSnapping,this),l.off("pm:dragend",this._cleanupSnapping,this),l.on("pm:dragend",this._cleanupSnapping,this),l.off("pm:dragstart",this._unsnap,this),l.on("pm:dragstart",this._unsnap,this)},_disableSnappingDrag(){let l=this._layer;l.off("pm:drag",this._handleSnapping,this),l.off("pm:dragend",this._cleanupSnapping,this),l.off("pm:dragstart",this._unsnap,this)},_updateHiddenPolyCircle(){let l=this._layer._map||this._map;if(l){let p=L.PM.Utils.pxRadiusToMeterRadius(this._layer.getRadius(),l,this._layer.getLatLng()),y=L.circle(this._layer.getLatLng(),this._layer.options);y.setRadius(p);let x=l&&l.pm._isCRSSimple();this._hiddenPolyCircle?this._hiddenPolyCircle.setLatLngs(L.PM.Utils.circleToPolygon(y,200,!x).getLatLngs()):this._hiddenPolyCircle=L.PM.Utils.circleToPolygon(y,200,!x),this._hiddenPolyCircle._parentCopy||(this._hiddenPolyCircle._parentCopy=this._layer)}},_getNewDestinationOfOuterMarker(){let l=this._centerMarker.getLatLng(),p=this._outerMarker.getLatLng(),y=this._distanceCalculation(l,p);return this.options[this._minRadiusOption]&&y<this.options[this._minRadiusOption]?p=Kn(this._map,l,p,this._getMinDistanceInMeter(l)):this.options[this._maxRadiusOption]&&y>this.options[this._maxRadiusOption]&&(p=Kn(this._map,l,p,this._getMaxDistanceInMeter(l))),p},_handleOuterMarkerSnapping(){if(this._outerMarker._snapped){let l=this._centerMarker.getLatLng(),p=this._outerMarker.getLatLng(),y=this._distanceCalculation(l,p);this.options[this._minRadiusOption]&&y<this.options[this._minRadiusOption]?this._outerMarker.setLatLng(this._outerMarker._orgLatLng):this.options[this._maxRadiusOption]&&y>this.options[this._maxRadiusOption]&&this._outerMarker.setLatLng(this._outerMarker._orgLatLng)}this._outerMarker.setLatLng(this._getNewDestinationOfOuterMarker())},_distanceCalculation(l,p){return this._map.project(l).distanceTo(this._map.project(p))},_getMinDistanceInMeter(l){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._minRadiusOption],this._map,l)},_getMaxDistanceInMeter(l){return L.PM.Utils.pxRadiusToMeterRadius(this.options[this._maxRadiusOption],this._map,l)},_onVertexClick(l){l.target._dragging||this._fireVertexClick(l,void 0)}}),xr.Circle=xr.CircleMarker.extend({_shape:"Circle",initialize(l){this._layer=l,this._enabled=!1,this._minRadiusOption="minRadiusCircle",this._maxRadiusOption="maxRadiusCircle",this._editableOption="resizeableCircle",this._updateHiddenPolyCircle()},enable(l){L.PM.Edit.CircleMarker.prototype.enable.call(this,l||{})},_extendingEnable(){},_extendingDisable(){this._layer.off("remove",this.disable,this);let l=this._layer._path?this._layer._path:this._layer._renderer._container;L.DomUtil.removeClass(l,"leaflet-pm-draggable")},_extendingApplyOptions(){},_syncMarkers(){},_removeMarker(){},_onDragStart(){},_extedingMarkerDragEnd(){},_updateHiddenPolyCircle(){let l=this._map&&this._map.pm._isCRSSimple();this._hiddenPolyCircle?this._hiddenPolyCircle.setLatLngs(L.PM.Utils.circleToPolygon(this._layer,200,!l).getLatLngs()):this._hiddenPolyCircle=L.PM.Utils.circleToPolygon(this._layer,200,!l),this._hiddenPolyCircle._parentCopy||(this._hiddenPolyCircle._parentCopy=this._layer)},_distanceCalculation(l,p){return this._map.distance(l,p)},_getMinDistanceInMeter(){return this.options[this._minRadiusOption]},_getMaxDistanceInMeter(){return this.options[this._maxRadiusOption]},_onVertexClick(l){l.target._dragging||this._fireVertexClick(l,void 0)}}),xr.ImageOverlay=xr.extend({_shape:"ImageOverlay",initialize(l){this._layer=l,this._enabled=!1},toggleEdit(l){this.enabled()?this.disable():this.enable(l)},enabled(){return this._enabled},enable(l={draggable:!0,snappable:!0}){if(L.Util.setOptions(this,l),this._map=this._layer._map,!!this._map){if(!this.options.allowEditing){this.disable();return}this.enabled()||this.disable(),this.enableLayerDrag(),this._layer.on("remove",this.disable,this),this._enabled=!0,this._otherSnapLayers=this._findCorners(),this._fireEnable()}},disable(){this._dragging||(this._map||(this._map=this._layer._map),this.disableLayerDrag(),this._layer.off("remove",this.disable,this),this.enabled()||(this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable()),this._enabled=!1)},_findCorners(){let l=this._layer.getBounds(),p=l.getNorthWest(),y=l.getNorthEast(),x=l.getSouthEast(),M=l.getSouthWest();return[p,y,x,M]}}),xr.Text=xr.extend({_shape:"Text",initialize(l){this._layer=l,this._enabled=!1},enable(l){if(L.Util.setOptions(this,l),!!this.textArea){if(!this.options.allowEditing||!this._layer._map){this.disable();return}this._map=this._layer._map,this.enabled()&&this.disable(),this.applyOptions(),this._safeToCacheDragState=!0,this._focusChange(),this.textArea.readOnly=!1,this.textArea.classList.remove("pm-disabled"),this._layer.on("remove",this.disable,this),L.DomEvent.on(this.textArea,"input",this._autoResize,this),L.DomEvent.on(this.textArea,"focus",this._focusChange,this),L.DomEvent.on(this.textArea,"blur",this._focusChange,this),this._layer.on("dblclick",L.DomEvent.stop),L.DomEvent.off(this.textArea,"mousedown",this._preventTextSelection),this._enabled=!0,this._fireEnable()}},disable(){if(!this.enabled())return;this._layer.off("remove",this.disable,this),L.DomEvent.off(this.textArea,"input",this._autoResize,this),L.DomEvent.off(this.textArea,"focus",this._focusChange,this),L.DomEvent.off(this.textArea,"blur",this._focusChange,this),L.DomEvent.off(document,"click",this._documentClick,this),this._focusChange(),this.textArea.readOnly=!0,this.textArea.classList.add("pm-disabled");let l=document.activeElement;this.textArea.focus(),this.textArea.selectionStart=0,this.textArea.selectionEnd=0,L.DomEvent.on(this.textArea,"mousedown",this._preventTextSelection),l.focus(),this._disableOnBlurActive=!1,this._layerEdited&&this._fireUpdate(),this._layerEdited=!1,this._fireDisable(),this._enabled=!1},enabled(){return this._enabled},toggleEdit(l){this.enabled()?this.disable():this.enable(l)},applyOptions(){this.options.snappable?this._initSnappableMarkers():this._disableSnapping()},_initSnappableMarkers(){let l=this._layer;this.options.snapDistance=this.options.snapDistance||30,this.options.snapSegment=this.options.snapSegment===void 0?!0:this.options.snapSegment,l.off("pm:drag",this._handleSnapping,this),l.on("pm:drag",this._handleSnapping,this),l.off("pm:dragend",this._cleanupSnapping,this),l.on("pm:dragend",this._cleanupSnapping,this),l.off("pm:dragstart",this._unsnap,this),l.on("pm:dragstart",this._unsnap,this)},_disableSnapping(){let l=this._layer;l.off("pm:drag",this._handleSnapping,this),l.off("pm:dragend",this._cleanupSnapping,this),l.off("pm:dragstart",this._unsnap,this)},_autoResize(){this.textArea.style.height="1px",this.textArea.style.width="1px";let l=this.textArea.scrollHeight>21?this.textArea.scrollHeight:21,p=this.textArea.scrollWidth>16?this.textArea.scrollWidth:16;this.textArea.style.height=`${l}px`,this.textArea.style.width=`${p}px`,this._layer.options.text=this.getText(),this._fireTextChange(this.getText())},_disableOnBlur(){this._disableOnBlurActive=!0,setTimeout(()=>{this.enabled()&&L.DomEvent.on(document,"click",this._documentClick,this)},100)},_documentClick(l){l.target!==this.textArea&&(this.disable(),!this.getText()&&this.options.removeIfEmpty&&this.remove())},_focusChange(l={}){let p=this._hasFocus;this._hasFocus=l.type==="focus",!p!=!this._hasFocus&&(this._hasFocus?(this._applyFocus(),this._focusText=this.getText(),this._fireTextFocus()):(this._removeFocus(),this._fireTextBlur(),this._focusText!==this.getText()&&(this._fireEdit(),this._layerEdited=!0)))},_applyFocus(){this.textArea.classList.add("pm-hasfocus"),this._map.dragging&&(this._safeToCacheDragState&&(this._originalMapDragState=this._map.dragging._enabled,this._safeToCacheDragState=!1),this._map.dragging.disable())},_removeFocus(){this._map.dragging&&(this._originalMapDragState&&this._map.dragging.enable(),this._safeToCacheDragState=!0),this.textArea.classList.remove("pm-hasfocus")},focus(){if(!this.enabled())throw new TypeError("Layer is not enabled");this.textArea.focus()},blur(){if(!this.enabled())throw new TypeError("Layer is not enabled");this.textArea.blur(),this._disableOnBlurActive&&this.disable()},hasFocus(){return this._hasFocus},getElement(){return this.textArea},setText(l){l&&(this.textArea.value=l),this._autoResize()},getText(){return this.textArea.value},_initTextMarker(){if(this.textArea=L.PM.Draw.Text.prototype._createTextArea.call(this),this.options.className){let p=this.options.className.split(" ");this.textArea.classList.add(...p)}let l=L.PM.Draw.Text.prototype._createTextIcon.call(this,this.textArea);this._layer.setIcon(l),this._layer.once("add",this._createTextMarker,this)},_createTextMarker(l=!1){this._layer.off("add",this._createTextMarker,this),this._layer.getElement().tabIndex=-1,this.textArea.wrap="off",this.textArea.style.overflow="hidden",this.textArea.style.height=L.DomUtil.getStyle(this.textArea,"font-size"),this.textArea.style.width="1px",this._layer.options.text&&this.setText(this._layer.options.text),this._autoResize(),l===!0&&(this.enable(),this.focus(),this._disableOnBlur())},_preventTextSelection(l){l.preventDefault()}});var Gl=function(l,p,y,x,M,A){this._matrix=[l,p,y,x,M,A]};Gl.init=()=>new L.PM.Matrix(1,0,0,1,0,0),Gl.prototype={transform(l){return this._transform(l.clone())},_transform(l){let p=this._matrix,{x:y,y:x}=l;return l.x=p[0]*y+p[1]*x+p[4],l.y=p[2]*y+p[3]*x+p[5],l},untransform(l){let p=this._matrix;return new L.Point((l.x/p[0]-p[4])/p[0],(l.y/p[2]-p[5])/p[2])},clone(){let l=this._matrix;return new L.PM.Matrix(l[0],l[1],l[2],l[3],l[4],l[5])},translate(l){if(l===void 0)return new L.Point(this._matrix[4],this._matrix[5]);let p,y;return typeof l=="number"?(p=l,y=l):(p=l.x,y=l.y),this._add(1,0,0,1,p,y)},scale(l,p){if(l===void 0)return new L.Point(this._matrix[0],this._matrix[3]);let y,x;return p=p||L.point(0,0),typeof l=="number"?(y=l,x=l):(y=l.x,x=l.y),this._add(y,0,0,x,p.x,p.y)._add(1,0,0,1,-p.x,-p.y)},rotate(l,p){let y=Math.cos(l),x=Math.sin(l);return p=p||new L.Point(0,0),this._add(y,x,-x,y,p.x,p.y)._add(1,0,0,1,-p.x,-p.y)},flip(){return this._matrix[1]*=-1,this._matrix[2]*=-1,this},_add(l,p,y,x,M,A){let R=[[],[],[]],j=this._matrix,W=[[j[0],j[2],j[4]],[j[1],j[3],j[5]],[0,0,1]],et=[[l,y,M],[p,x,A],[0,0,1]],Tt;l&&l instanceof L.PM.Matrix&&(j=l._matrix,et=[[j[0],j[2],j[4]],[j[1],j[3],j[5]],[0,0,1]]);for(let kt=0;kt<3;kt+=1)for(let ie=0;ie<3;ie+=1){Tt=0;for(let Ut=0;Ut<3;Ut+=1)Tt+=W[kt][Ut]*et[Ut][ie];R[kt][ie]=Tt}return this._matrix=[R[0][0],R[1][0],R[0][1],R[1][1],R[0][2],R[1][2]],this}};var Zl=Gl,Ml={calcMiddleLatLng(l,p,y){let x=l.project(p),M=l.project(y);return l.unproject(x._add(M)._divideBy(2))},findLayers(l){let p=[];return l.eachLayer(y=>{(y instanceof L.Polyline||y instanceof L.Marker||y instanceof L.Circle||y instanceof L.CircleMarker||y instanceof L.ImageOverlay)&&p.push(y)}),p=p.filter(y=>!!y.pm),p=p.filter(y=>!y._pmTempLayer),p=p.filter(y=>!L.PM.optIn&&!y.options.pmIgnore||L.PM.optIn&&y.options.pmIgnore===!1),p},circleToPolygon(l,p=60,y=!0){let x=l.getLatLng(),M=l.getRadius(),A=$s(x,M,p,0,y),R=[];for(let j=0;j<A.length;j+=1){let W=[A[j].lat,A[j].lng];R.push(W)}return L.polygon(R,l.options)},disablePopup(l){l.getPopup()&&(l._tempPopupCopy=l.getPopup(),l.unbindPopup())},enablePopup(l){l._tempPopupCopy&&(l.bindPopup(l._tempPopupCopy),delete l._tempPopupCopy)},_fireEvent(l,p,y,x=!1){l.fire(p,y,x);let{groups:M}=this.getAllParentGroups(l);M.forEach(A=>{A.fire(p,y,x)})},getAllParentGroups(l){let p=[],y=[],x=M=>{for(let A in M._eventParents)if(p.indexOf(A)===-1){p.push(A);let R=M._eventParents[A];y.push(R),x(R)}};return!l._pmLastGroupFetch||!l._pmLastGroupFetch.time||new Date().getTime()-l._pmLastGroupFetch.time>1e3?(x(l),l._pmLastGroupFetch={time:new Date().getTime(),groups:y,groupIds:p},{groupIds:p,groups:y}):{groups:l._pmLastGroupFetch.groups,groupIds:l._pmLastGroupFetch.groupIds}},createGeodesicPolygon:$s,getTranslation:li,findDeepCoordIndex(l,p,y=!0){let x,M=R=>(j,W)=>{let et=R.concat(W);if(y){if(j.lat&&j.lat===p.lat&&j.lng===p.lng)return x=et,!0}else if(j.lat&&L.latLng(j).equals(p))return x=et,!0;return Array.isArray(j)&&j.some(M(et))};l.some(M([]));let A={};return x&&(A={indexPath:x,index:x[x.length-1],parentPath:x.slice(0,x.length-1)}),A},findDeepMarkerIndex(l,p){let y,x=A=>(R,j)=>{let W=A.concat(j);return R._leaflet_id===p._leaflet_id?(y=W,!0):Array.isArray(R)&&R.some(x(W))};l.some(x([]));let M={};return y&&(M={indexPath:y,index:y[y.length-1],parentPath:y.slice(0,y.length-1)}),M},_getIndexFromSegment(l,p){if(p&&p.length===2){let y=this.findDeepCoordIndex(l,p[0]),x=this.findDeepCoordIndex(l,p[1]),M=Math.max(y.index,x.index);return(y.index===0||x.index===0)&&M!==1&&(M+=1),{indexA:y,indexB:x,newIndex:M,indexPath:y.indexPath,parentPath:y.parentPath}}return null},_getRotatedRectangle(l,p,y,x){let M=Ho(x,l),A=Ho(x,p),R=y*Math.PI/180,j=Math.cos(R),W=Math.sin(R),et=(A.x-M.x)*j+(A.y-M.y)*W,Tt=(A.y-M.y)*j-(A.x-M.x)*W,kt=et*j+M.x,ie=et*W+M.y,Ut=-Tt*W+M.x,jt=Tt*j+M.y,de=Wo(x,M),Fe=Wo(x,{x:kt,y:ie}),Mi=Wo(x,A),bt=Wo(x,{x:Ut,y:jt});return[de,Fe,Mi,bt]},pxRadiusToMeterRadius(l,p,y){let x=p.project(y),M=L.point(x.x+l,x.y);return p.distance(p.unproject(M),y)}},Vl=Ml;L.PM=L.PM||{version:Ji.version,Map:yl,Toolbar:jr,Draw:Lr,Edit:xr,Utils:Vl,Matrix:Zl,activeLang:"en",optIn:!1,initialize(l){this.addInitHooks(l)},setOptIn(l){this.optIn=!!l},addInitHooks(){function l(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Map(this)):this.options.pmIgnore||(this.pm=new L.PM.Map(this)),this.pm&&this.pm.setGlobalOptions({})}L.Map.addInitHook(l);function p(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.LayerGroup(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.LayerGroup(this))}L.LayerGroup.addInitHook(p);function y(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.options.textMarker?(this.pm=new L.PM.Edit.Text(this),this.options._textMarkerOverPM||this.pm._initTextMarker(),delete this.options._textMarkerOverPM):this.pm=new L.PM.Edit.Marker(this)):this.options.pmIgnore||(this.options.textMarker?(this.pm=new L.PM.Edit.Text(this),this.options._textMarkerOverPM||this.pm._initTextMarker(),delete this.options._textMarkerOverPM):this.pm=new L.PM.Edit.Marker(this))}L.Marker.addInitHook(y);function x(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.CircleMarker(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.CircleMarker(this))}L.CircleMarker.addInitHook(x);function M(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Line(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Line(this))}L.Polyline.addInitHook(M);function A(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Polygon(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Polygon(this))}L.Polygon.addInitHook(A);function R(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Rectangle(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Rectangle(this))}L.Rectangle.addInitHook(R);function j(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.Circle(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.Circle(this))}L.Circle.addInitHook(j);function W(){this.pm=void 0,L.PM.optIn?this.options.pmIgnore===!1&&(this.pm=new L.PM.Edit.ImageOverlay(this)):this.options.pmIgnore||(this.pm=new L.PM.Edit.ImageOverlay(this))}L.ImageOverlay.addInitHook(W)},reInitLayer(l){l instanceof L.LayerGroup&&l.eachLayer(p=>{this.reInitLayer(p)}),l.pm||L.PM.optIn&&l.options.pmIgnore!==!1||l.options.pmIgnore||(l instanceof L.Map?l.pm=new L.PM.Map(l):l instanceof L.Marker?l.options.textMarker?(l.pm=new L.PM.Edit.Text(l),l.pm._initTextMarker(),l.pm._createTextMarker(!1)):l.pm=new L.PM.Edit.Marker(l):l instanceof L.Circle?l.pm=new L.PM.Edit.Circle(l):l instanceof L.CircleMarker?l.pm=new L.PM.Edit.CircleMarker(l):l instanceof L.Rectangle?l.pm=new L.PM.Edit.Rectangle(l):l instanceof L.Polygon?l.pm=new L.PM.Edit.Polygon(l):l instanceof L.Polyline?l.pm=new L.PM.Edit.Line(l):l instanceof L.LayerGroup?l.pm=new L.PM.Edit.LayerGroup(l):l instanceof L.ImageOverlay&&(l.pm=new L.PM.Edit.ImageOverlay(l)))}},L.version==="1.7.1"&&L.Canvas.include({_onClick(l){let p=this._map.mouseEventToLayerPoint(l),y,x;for(let M=this._drawFirst;M;M=M.next)y=M.layer,y.options.interactive&&y._containsPoint(p)&&(!(l.type==="click"||l.type==="preclick")||!this._map._draggableMoved(y))&&(x=y);x&&(L.DomEvent.fakeStop(l),this._fireEvent([x],l))}}),L.PM.initialize()})();var lg=_h(mf());Xe.default.MarkerCluster=Xe.default.MarkerCluster.mergeOptions({pmIgnore:!0});Xe.default.Map.addInitHook(function(){this._patterns={}});Xe.default.Map.include({addPattern:function($t){let gt=Xe.default.stamp($t);return this._patterns[gt]?$t:(this._patterns[gt]=$t,this.whenReady(()=>{$t.onAdd(this)}),this)},removePattern:function($t){let gt=Xe.default.stamp($t);return this._patterns[gt]?(this._loaded&&$t.onRemove(this),delete this._patterns[gt],this._loaded&&(this.fire("patternremove",{pattern:$t}),$t.fire("remove")),$t._map=null,this):this},_initDefRoot:function(){if(!this._defRoot){let $t=this.getRenderer(this);this._defRoot=Eh.prototype._createElement("defs"),$t._container.appendChild(this._defRoot)}}});Xe.default.SVG.include({_superUpdateStyle:Xe.default.SVG.prototype._updateStyle,_updateStyle:function($t){this._superUpdateStyle($t);let gt=$t.options;gt.fill&&gt.fillPattern&&$t._path.setAttribute("fill","url(#"+Xe.default.stamp(gt.fillPattern)+")")}});var Ch=class extends Xe.default.Control{constructor(gt){super(gt),this.current=$(),this.currentButton=$(),this.sidebar=$('<div class="tb-map-sidebar"></div>'),this.options.container.append(this.sidebar);let Vt=gt?.position||"topleft";["topleft","bottomleft"].includes(Vt)?this.options.container.addClass("tb-sidebar-left"):this.options.container.addClass("tb-sidebar-right")}addPane(gt,Vt){return gt.hide().appendTo(this.sidebar),Vt.appendTo(this.buttonContainer),this}togglePane(gt,Vt){let G=this.options?.paneWidth||220,S=this.options?.position||"topleft";this.current.hide().trigger("hide"),this.currentButton.removeClass("active"),this.current===gt?(["topleft","bottomleft"].includes(S)&&this.map.panBy([-G,0],{animate:!1}),this.sidebar.hide(),this.current=this.currentButton=$()):(this.sidebar.show(),["topleft","bottomleft"].includes(S)&&!this.current.length&&this.map.panBy([G,0],{animate:!1}),this.current=gt,this.currentButton=Vt||$()),this.current.show().trigger("show"),this.currentButton.addClass("active"),this.map.invalidateSize({pan:!1,animate:!1})}onAdd(gt){return this.buttonContainer=$("<div>").attr("class","leaflet-bar"),this.buttonContainer[0]}addTo(gt){return this.map=gt,super.addTo(gt)}},Mu=class extends Xe.default.Control{constructor(gt){super(gt)}addTo(gt){return this.button=$("<a>").attr("class","tb-control-button").attr("href","#").attr("role","button").html('<div class="'+this.options.uiClass+'"></div>').on("click",Vt=>{this.toggle(Vt)}),this.options.buttonTitle&&this.button.attr("title",this.options.buttonTitle),this.$ui=$("<div>").attr("class",this.options.uiClass),$('<div class="tb-layers-title-container">').appendTo(this.$ui).append($('<div class="tb-layers-title">').text(this.options.paneTitle)).append($("<div>").append($('<button type="button" class="tb-button-close mdc-icon-button mat-mdc-icon-button"><span class="mat-mdc-button-persistent-ripple mdc-icon-button__ripple"></span><span class="material-icons">close</span></button>').attr("aria-label","Close").bind("click",Vt=>{this.toggle(Vt)}))),this.options.sidebar.addPane(this.$ui,this.button),this.onAddPane(gt,this.button,this.$ui,Vt=>{this.toggle(Vt)}),this}onAddPane(gt,Vt,G,S){}toggle(gt){gt.stopPropagation(),gt.preventDefault(),this.button.hasClass("disabled")||this.options.sidebar.togglePane(this.$ui,this.button)}},Mh=class extends Mu{constructor(gt){super(gt)}onAddPane(gt,Vt,G,S){let u=Mc(),rt=this.options.layers,Qt=$("<div>").attr("class","tb-layers-container").appendTo(G);rt.forEach((se,Kt)=>{let re=`map-ui-layer-${u}-${Kt}`,_t=$('<div class="tb-layer-card">').appendTo(Qt),ge=$('<div class="tb-layer-map">').appendTo(_t),Ae=$('<input type="radio" class="tb-layer-button" name="layer">').prop("id",re).prop("checked",gt.hasLayer(se.layer)).appendTo(_t),pi=$('<label class="tb-layer-label">').prop("for",re).append($("<span>").append(se.title)).appendTo(_t);gt.whenReady(()=>{let Ze=Xe.default.map(ge[0],{attributionControl:!1,zoomControl:!1,keyboard:!1}).addLayer(se.mini);Ze.dragging.disable(),Ze.touchZoom.disable(),Ze.doubleClickZoom.disable(),Ze.scrollWheelZoom.disable();let gi=()=>{Ze.setView(gt.getCenter(),Math.max(gt.getZoom()-2,0))},Bi=()=>{Ze.invalidateSize(),Ze.setView(gt.getCenter(),Math.max(gt.getZoom()-2,0),{animate:!1}),gt.on("moveend",gi)};G.on("show",Bi),G.on("hide",()=>{gt.off("moveend",gi)})}),Ae.on("click",Ze=>{Ze.stopPropagation(),gt.hasLayer(se.layer)||(gt.addLayer(se.layer),gt.attributionControl.setPrefix(se.attributionPrefix),rt.forEach(gi=>{gi.layer!==se.layer&&gt.removeLayer(gi.layer)}),gt.fire("baselayerchange",{layer:se.layer}))}),pi.on("dblclick",Ze=>{S(Ze)}),gt.on("layeradd layerremove",function(){Ae.prop("checked",gt.hasLayer(se.layer))})})}},Lh=class extends Mu{constructor(gt){super(gt)}onAddPane(gt,Vt,G,S){let u=Mc(),rt=this.options.groups,Qt=$("<div>").attr("class","tb-layers-container").appendTo(G);rt.forEach((se,Kt)=>{let re=`map-group-layer-${u}-${Kt}`,_t=$('<div class="tb-group-checkbox">').appendTo(Qt),ge=$('<input type="checkbox" class="tb-group-button" name="group">').prop("id",re).prop("checked",se.enabled).appendTo(_t);$('<label class="tb-group-label">').prop("title",se.title).prop("for",re).append($("<span>").append(se.title)).appendTo(_t),ge.on("click",Ae=>{Ae.stopPropagation(),se.enabled=!se.enabled;let pi=!1;se.dataLayers.forEach(Ze=>{pi=Ze.toggleGroup(se.group)||pi}),pi&&gt.fire("layergroupchange",{group:se})}),gt.on("layeradd layerremove",function(){ge.prop("checked",se.enabled)})})}},Th=class{constructor(gt,Vt){this.options=gt,this.iconRegistry=Vt,this.active=!1,this.disabled=!1;let G=$('<div class="tb-control-button-icon"></div>'),S=Cc(this.options.icon),u=Cc(this.options.title);this.button=$("<a>").attr("class","tb-control-button tb-control-text-button").attr("href","#").attr("role","button"),S&&(this.button.append(G),this.loadIcon(G)),u&&this.button.append(`<div class="tb-control-text">${this.options.title}</div>`),this.button.css("--tb-map-control-color",this.options.color),this.button.css("--tb-map-control-active-color",this.options.color),this.button.css("--tb-map-control-hover-background-color",this.options.color),S&&!u?this.button.css("padding",0):!S&&u&&this.button.css("padding-left","14px"),this.button.on("click",rt=>{rt.stopPropagation(),rt.preventDefault(),this._onClick&&this._onClick(rt.originalEvent,this)})}onClick(gt){this._onClick=gt}loadIcon(gt){if(gt.addClass(this.iconRegistry.getDefaultFontSetClass()),!Wd(this.options.icon)){gt.addClass("material-icon-font"),gt.text(this.options.icon);return}let[Vt,G]=Hd(this.options.icon);this.iconRegistry.getNamedSvgIcon(G,Vt).pipe(bd(1),xd(S=>(console.log(`Error retrieving icon ${Vt}:${G}! ${S.message}`),vd(null)))).subscribe({next:S=>{gt.append(S),S.style.height="24px",S.style.width="24px"}})}setActive(gt){this.active!==gt&&(this.active=gt,this.active?Xe.default.DomUtil.addClass(this.button[0],"active"):Xe.default.DomUtil.removeClass(this.button[0],"active"))}isActive(){return this.active}setDisabled(gt){this.disabled!==gt&&(this.disabled=gt,this.disabled?(Xe.default.DomUtil.addClass(this.button[0],"leaflet-disabled"),this.button[0].setAttribute("aria-disabled","true")):(Xe.default.DomUtil.removeClass(this.button[0],"leaflet-disabled"),this.button[0].setAttribute("aria-disabled","false")))}isDisabled(){return this.disabled}getButtonElement(){return this.button}},Wu=class{constructor(gt){this.options=gt,this.active=!1,this.disabled=!1,this.id=gt.id;let Vt=this.options.showText?this.options.title:null;this.button=$("<a>").attr("class","tb-control-button").attr("href","#").attr("role","button").html('<div class="'+this.options.iconClass+'"></div>'+(Vt?`<div class="tb-control-text">${Vt}</div>`:"")),this.options.showText?Xe.default.DomUtil.addClass(this.button[0],"tb-control-text-button"):this.button.attr("title",this.options.title),this.button.on("click",G=>{G.stopPropagation(),G.preventDefault(),this.options.click(G.originalEvent,this)})}setActive(gt){this.active!==gt&&(this.active=gt,this.active?Xe.default.DomUtil.addClass(this.button[0],"active"):Xe.default.DomUtil.removeClass(this.button[0],"active"))}isActive(){return this.active}setDisabled(gt){this.disabled!==gt&&(this.disabled=gt,this.disabled?(Xe.default.DomUtil.addClass(this.button[0],"leaflet-disabled"),this.button[0].setAttribute("aria-disabled","true")):(Xe.default.DomUtil.removeClass(this.button[0],"leaflet-disabled"),this.button[0].setAttribute("aria-disabled","false")))}isDisabled(){return this.disabled}getId(){return this.id}getButtonElement(){return this.button}},Ph=class{constructor(gt){this.options=gt,this.buttons=[];let Vt=$(".leaflet-control-container",this.options.mapElement);this.toolbarElement=$('<div class="tb-map-top-toolbar leaflet-top"></div>'),this.toolbarElement.appendTo(Vt)}toolbarButton(gt){let Vt=new Th(gt,this.options.iconRegistry),G=$('<div class="leaflet-bar leaflet-control"></div>');return Vt.getButtonElement().appendTo(G),G.appendTo(this.toolbarElement),this.buttons.push(Vt),Vt}setDisabled(gt){this.buttons.forEach(Vt=>{Vt.isActive()||Vt.setDisabled(gt)})}},Sh=class extends Xe.default.Control{constructor(gt){super(gt)}toolbarButton(gt){let Vt=new Wu(gt);return Vt.getButtonElement().appendTo(this.buttonContainer),Vt}onAdd(gt){return this.buttonContainer=$("<div>").attr("class","leaflet-bar"),this.buttonContainer[0]}addTo(gt){return super.addTo(gt)}},kh=class{constructor(gt){this.options=gt,this.toolbarButtons=[];let Vt=$(".leaflet-control-container",gt.mapElement),G=$('<div class="tb-map-bottom-toolbar leaflet-bottom"></div>');G.appendTo(Vt),this.buttonContainer=$('<div class="leaflet-bar leaflet-control"></div>'),this.buttonContainer.appendTo(G),this.container=this.buttonContainer[0]}getButton(gt){return this.toolbarButtons.find(Vt=>Vt.getId()===gt)}open(gt,Vt=!0){if(this.toolbarButtons.length=0,gt.forEach(G=>{let S=new Wu(G);this.toolbarButtons.push(S),S.getButtonElement().appendTo(this.container)}),Vt){let G=$("<a>").attr("class","tb-control-button").attr("href","#").attr("role","button").attr("title",this.options.closeTitle).html('<div class="tb-close"></div>');G.on("click",S=>{S.stopPropagation(),S.preventDefault(),this.close()}),G.appendTo(this.buttonContainer)}}close(){this.options.onClose?this.options.onClose()&&this.buttonContainer.empty():this.buttonContainer.empty()}},Eh=class extends Xe.default.Evented{constructor(gt){super(),this.options={x:0,y:0,width:8,height:8,patternUnits:"userSpaceOnUse",patternContentUnits:"userSpaceOnUse"},this._elements={},this.options=kr(kr({},this.options),gt)}onAdd(gt){this._map=gt,this._map._initDefRoot(),this._initDom();for(let Vt in this._elements)this._elements[Vt].onAdd(this);this._addElements(),this._addDom(),this.redraw(),this.fire("add"),this._map.fire("patternadd",{pattern:this})}onRemove(gt){this._removeDom()}redraw(){if(this._map){this._update();for(let gt in this._elements)this._elements[gt].redraw()}return this}setStyle(gt){return Xe.default.setOptions(this,gt),this._map&&(this._updateStyle(),this.redraw()),this}addTo(gt){return gt.addPattern(this),this}remove(){return this.removeFrom(this._map)}removeFrom(gt){return gt&&gt.removePattern(this),this}addElement(gt){let Vt=Xe.default.stamp(gt);if(this._elements[Vt])return gt;this._elements[Vt]=gt,gt.onAdd(this)}_createElement(gt){return document.createElementNS("http://www.w3.org/2000/svg",gt)}_initDom(){this._dom=this._createElement("pattern"),this.options.className&&Xe.default.DomUtil.addClass(this._dom,this.options.className),this._updateStyle()}_addDom(){this._map._defRoot.appendChild(this._dom)}_removeDom(){Xe.default.DomUtil.remove(this._dom)}_updateStyle(){let gt=this._dom,Vt=this.options;if(gt){if(gt.setAttribute("id",`${Xe.default.stamp(this)}`),gt.setAttribute("x",`${Vt.x}`),gt.setAttribute("y",`${Vt.y}`),gt.setAttribute("width",`${Vt.width}`),gt.setAttribute("height",`${Vt.height}`),gt.setAttribute("patternUnits",Vt.patternUnits),gt.setAttribute("patternContentUnits",Vt.patternContentUnits),Vt.patternTransform||Vt.angle){let G=Vt.patternTransform?Vt.patternTransform+" ":"";G+=Vt.angle?"rotate("+Vt.angle+") ":"",gt.setAttribute("patternTransform",G)}else gt.removeAttribute("patternTransform");if(Vt.viewBox?gt.setAttribute("viewBox",Vt.viewBox.join(" ")):gt.removeAttribute("viewBox"),Vt.preserveAspectRatioAlign){let G=Vt.preserveAspectRatioAlign;G!=="none"&&Vt.preserveAspectRatioMeetOrSlice&&(G+=" "+Vt.preserveAspectRatioMeetOrSlice),gt.setAttribute("preserveAspectRatio",G)}else gt.removeAttribute("preserveAspectRatio");for(let G in this._elements)this._elements[G]._updateStyle()}}_addElements(){}_update(){}},Ku=class extends Xe.default.Class{constructor(gt){super(),this.options=kr(kr({},this._defaultOptions()),gt)}onAdd(gt){this._pattern=gt,this._pattern._dom&&(this._initDom(),this._addDom())}addTo(gt){return gt.addElement(this),this}redraw(){return this._pattern&&this._updateElement(),this}setStyle(gt){return Xe.default.setOptions(this,gt),this._pattern&&this._updateStyle(),this}_createElement(gt){return document.createElementNS("http://www.w3.org/2000/svg",gt)}_initDomElement(gt){this._dom=this._createElement(gt),this.options.className&&Xe.default.DomUtil.addClass(this._dom,this.options.className),this._updateStyle()}_addDom(){this._pattern._dom.appendChild(this._dom)}_updateStyle(){}_initDom(){}_updateElement(){}},_f={stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",fillOpacity:.2,fillRule:"evenodd"},Xu=class extends Ku{constructor(gt){super(gt)}_updateStyle(){let gt=this._dom,Vt=this.options;gt&&(Vt.stroke?(gt.setAttribute("stroke",Vt.color),gt.setAttribute("stroke-opacity",`${Vt.opacity}`),gt.setAttribute("stroke-width",`${Vt.weight}`),gt.setAttribute("stroke-linecap",Vt.lineCap),gt.setAttribute("stroke-linejoin",Vt.lineJoin),Vt.dashArray?gt.setAttribute("stroke-dasharray",Vt.dashArray.join(" ")):gt.removeAttribute("stroke-dasharray"),Vt.dashOffset?gt.setAttribute("stroke-dashoffset",`${Vt.dashOffset}`):gt.removeAttribute("stroke-dashoffset")):gt.setAttribute("stroke","none"),Vt.fill?(Vt.fillPattern?gt.setAttribute("fill","url(#"+Xe.default.stamp(Vt.fillPattern)+")"):gt.setAttribute("fill",Vt.fillColor||Vt.color),gt.setAttribute("fill-opacity",`${Vt.fillOpacity}`),gt.setAttribute("fill-rule",Vt.fillRule||"evenodd")):gt.setAttribute("fill","none"),gt.setAttribute("pointer-events",Vt.pointerEvents||(Vt.interactive?"visiblePainted":"none")))}},Ec=class extends Xu{constructor(gt){super(gt)}_initDom(){this._initDomElement("rect")}_updateElement(){this._dom&&(this._dom.setAttribute("x",`${this.options.x}`),this._dom.setAttribute("y",`${this.options.y}`),this._dom.setAttribute("width",`${this.options.width}`),this._dom.setAttribute("height",`${this.options.height}`),this.options.rx&&this._dom.setAttribute("rx",`${this.options.rx}`),this.options.ry&&this._dom.setAttribute("ry",`${this.options.ry}`))}_defaultOptions(){return kr({x:0,y:0,width:10,height:10},_f)}},Ac=class extends Xu{constructor(gt){super(gt)}_initDom(){this._initDomElement("path")}_updateElement(){this._dom&&this._dom.setAttribute("d",this.options.d)}_defaultOptions(){return kr({},_f)}},Ic=class extends Ku{constructor(gt){super(gt)}_initDom(){this._initDomElement("image")}_updateStyle(){let gt=this._dom,Vt=this.options;if(!gt)return;if(this._dom.setAttribute("href",Vt.imageUrl),this._dom.setAttribute("opacity",Dd(Vt.opacity)?`${Vt.opacity}`:"1"),this._dom.setAttribute("x","0"),this._dom.setAttribute("y","0"),this._dom.setAttribute("width",`${Vt.width}`),this._dom.setAttribute("height",`${Vt.height}`),Vt.preserveAspectRatioAlign){let S=Vt.preserveAspectRatioAlign;S!=="none"&&Vt.preserveAspectRatioMeetOrSlice&&(S+=" "+Vt.preserveAspectRatioMeetOrSlice),gt.setAttribute("preserveAspectRatio",S)}else gt.removeAttribute("preserveAspectRatio");let G=[];Vt.angle&&G.push(`rotate(${Vt.angle})`),Vt.scale&&Vt.scale!==1&&G.push(`scale(${Vt.scale})`),G.length&&(this._dom.setAttribute("transform",G.join(" ")),this._dom.setAttribute("transform-origin",`${Vt.width/2} ${Vt.height/2}`))}_defaultOptions(){return{imageUrl:"",width:0,height:0}}},r_=$t=>new Ch($t),n_=$t=>new Mu($t),s_=$t=>new Mh($t),o_=$t=>new Lh($t),a_=$t=>new Ph($t),l_=$t=>new Sh($t),u_=$t=>new kh($t),gf=(()=>{class $t extends Xe.default.TileLayer{static{this.chinaProviders={Tencent:{Normal:"//rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={-y}&type=vector&styleid=3",Satellite:"//p{s}.map.gtimg.com/sateTiles/{z}/{sx}/{sy}/{x}_{-y}.jpg",Terrain:"//p{s}.map.gtimg.com/demTiles/{z}/{sx}/{sy}/{x}_{-y}.jpg",Subdomains:"0123"}}}constructor(Vt,G){G=G||{};let S=Vt.split("."),u=S[0],rt=S[1],Qt=$t.chinaProviders[u][rt];G.subdomains=$t.chinaProviders[u].Subdomains,super(Qt,G)}getTileUrl(Vt){let G={s:this._getSubdomain(Vt),x:Vt.x,y:Vt.y,z:this._getZoomForUrl(),sx:null,sy:null};if(this._map&&!this._map.options.crs.infinite){let S=this._globalTileRange.max.y-Vt.y;this.options.tms&&(G.y=S),G["-y"]=S}return G.sx=G.x>>4,G.sy=(1<<G.z)-G.y>>4,Xe.default.Util.template(this._url,Xe.default.Util.extend(G,this.options))}}return $t})(),h_=($t,gt)=>new gf($t,gt),Ah=class extends Xe.default.Layer{constructor(gt){super(),gt=Al(kr({},gt),{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"}),gt.attribution=this._loadAttribution(gt),this._prepareTransformRequest(gt),Xe.default.setOptions(this,gt),this._throttledUpdate=Xe.default.Util.throttle(this._update,this.options.updateInterval,this)}onAdd(gt){let Vt=!1;this._container?Vt=!0:this._initContainer();let G=this.getPaneName();return gt.getPane(G).appendChild(this._container),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),this._map._proxy&&gt.options.zoomAnimation&&Xe.default.DomEvent.on(gt._proxy,Xe.default.DomUtil.TRANSITION_END,this._transitionEnd,this),Vt&&this._update(),this}onRemove(gt){this._map._proxy&&this._map.options.zoomAnimation&&Xe.default.DomEvent.off(gt._proxy,Xe.default.DomUtil.TRANSITION_END,this._transitionEnd,this);let Vt=this.getPaneName();return gt.getPane(Vt).removeChild(this._container),this._glMap.remove(),this._glMap=null,this}getEvents(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}}getMapLibreGLMap(){return this._glMap}getCanvas(){return this._glMap.getCanvas()}getSize(){return this._map.getSize().multiplyBy(1+this.options.padding*2)}getBounds(){let gt=this.getSize().multiplyBy(.5),Vt=this._map.latLngToContainerPoint(this._map.getCenter());return Xe.default.latLngBounds(this._map.containerPointToLatLng(Vt.subtract(gt)),this._map.containerPointToLatLng(Vt.add(gt)))}getContainer(){return this._container}getPaneName(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"}_roundPoint(gt){return new Xe.default.Point(Math.round(gt.x),Math.round(gt.y))}_initContainer(){let gt=this._container=Xe.default.DomUtil.create("div","leaflet-gl-layer"),Vt=this.getSize(),G=this._map.getSize().multiplyBy(this.options.padding);gt.style.width=Vt.x+"px",gt.style.height=Vt.y+"px";let S=this._map.containerPointToLayerPoint([0,0]).subtract(G);Xe.default.DomUtil.setPosition(gt,this._roundPoint(S))}_initGL(){let gt=this._map.getCenter(),Vt=Xe.default.extend({},this.options,{container:this._container,center:[gt.lng,gt.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap=new Ih.Map(Vt),this._glMap.once("load",()=>{this.fire("load")}),this._glMap.setMaxBounds(null),this._transformGL(this._glMap),this._actualCanvas=this._glMap._canvas;let G=this._actualCanvas;Xe.default.DomUtil.addClass(G,"leaflet-image-layer"),Xe.default.DomUtil.addClass(G,"leaflet-zoom-animated"),this.options.interactive&&Xe.default.DomUtil.addClass(G,"leaflet-interactive"),this.options.className&&Xe.default.DomUtil.addClass(G,this.options.className)}_update(){if(!this._map||(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming))return;let gt=this.getSize(),Vt=this._container,G=this._glMap,S=this._map.getSize().multiplyBy(this.options.padding),u=this._map.containerPointToLayerPoint([0,0]).subtract(S);Xe.default.DomUtil.setPosition(Vt,this._roundPoint(u)),this._transformGL(G),G.transform.width!==gt.x||G.transform.height!==gt.y?(Vt.style.width=gt.x+"px",Vt.style.height=gt.y+"px",G.resize()):G._update()}_transformGL(gt){let Vt=this._map.getCenter(),G=gt._getTransformForUpdate();G.setCenter(Ih.LngLat.convert([Vt.lng,Vt.lat])),G.setZoom(this._map.getZoom()-1),gt.transform.apply(G),gt._fireMoveEvents()}_pinchZoom(){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})}_animateZoom(gt){let Vt=this._map.getZoomScale(gt.zoom),G=this._map.getSize().multiplyBy(this.options.padding*Vt),S=this.getSize().divideBy(2),u=this._map.project(gt.center,gt.zoom).subtract(S).add(this._map._getMapPanePos().add(G)).round(),rt=this._map.project(this._map.getBounds().getNorthWest(),gt.zoom).subtract(u);Xe.default.DomUtil.setTransform(this._actualCanvas,rt.subtract(this._offset),Vt)}_zoomStart(){this._zooming=!0}_zoomEnd(){let gt=this._map.getZoomScale(this._map.getZoom());Xe.default.DomUtil.setTransform(this._actualCanvas,null,gt),this._zooming=!1,this._update()}_transitionEnd(){Xe.default.Util.requestAnimFrame(()=>{let gt=this._map.getZoom(),Vt=this._map.getCenter(),G=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());Xe.default.DomUtil.setTransform(this._actualCanvas,G,1),this._glMap.once("moveend",()=>{this._zoomEnd()}),this._glMap.jumpTo({center:Vt,zoom:gt-1})})}_resize(){this._transitionEnd()}_loadAttribution(gt){if(gt.attributionControl!==!1&&typeof gt.attributionControl?.customAttribution=="string")return gt.attributionControl.customAttribution;if(gt.attributionControl!==!1){let Vt=gt.style;if(typeof Vt!="string"&&Vt?.sources)return Object.keys(Vt.sources).map(G=>{let S=Vt.sources[G];return S&&S.type!=="video"&&S.type!=="image"&&typeof S.attribution=="string"?S.attribution.trim():null}).filter(Boolean).join(", ")}return""}_prepareTransformRequest(gt){if(!gt.transformRequest){let Vt=gt.style;if(typeof Vt!="string"&&Vt.glyphs){let S=Vt.glyphs.replace(/\//g,"\\/").replace(/\./g,"\\.").replace("{fontstack}","(.*)").replace("{range}","(.*)"),u=new RegExp(S);gt.transformRequest=(rt,Qt)=>{if(Qt==="Glyphs"&&u&&u.test(rt)){let se=u.exec(rt);if(se.length===3){let Kt=se[1],re=Kt.split(",");if(re.length>1){let _t=re[0];rt=rt.replace(Kt,_t)}}}return{url:rt}}}}}},c_=$t=>new Ah($t);Xe.default.TB=Xe.default.TB||{SidebarControl:Ch,SidebarPaneControl:Mu,LayersControl:Mh,GroupsControl:Lh,TopToolbarButton:Th,TopToolbarControl:Ph,ToolbarButton:Wu,ToolbarControl:Sh,BottomToolbarControl:kh,Pattern:Eh,PatternElement:Ku,PatternShape:Xu,PatternRect:Ec,PatternPath:Ac,PatternImage:Ic,sidebar:r_,sidebarPane:n_,layers:s_,groups:o_,topToolbar:a_,toolbar:l_,bottomToolbar:u_,TileLayer:{ChinaProvider:gf},tileLayer:{chinaProvider:h_},MapLibreGL:{MapLibreGLLayer:Ah,mapLibreGLLayer:c_}};eo();function p_($t,gt){$t&1&&yh(0,"mat-progress-bar",17)}function d_($t,gt){$t&1&&yh(0,"div",18)}function f_($t,gt){if($t&1&&(qa(0,"mat-option",19),Il(1),_l()),$t&2){let Vt=gt.$implicit;ml("value",Vt),$a(),vh(" ",Vt.entityParseName," ")}}var Bg=(()=>{class $t extends Vd{constructor(Vt,G,S,u,rt){super(Vt,G,u),this.store=Vt,this.router=G,this.data=S,this.dialogRef=u,this.fb=rt,this.selectEntityFormGroup=this.fb.group({entity:["",Kd.required]})}save(){this.dialogRef.close(this.selectEntityFormGroup.value.entity)}static{this.\u0275fac=function(G){return new(G||$t)(wu(Bd),wu(Id),wu(Nd),wu(Fd),wu(ef))}}static{this.\u0275cmp=wd({type:$t,selectors:[["tb-select-entity-dialog"]],features:[Ld],decls:30,vars:22,consts:[["addEntityForm","ngForm"],[3,"ngSubmit","formGroup"],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"matDialogClose"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[1,"mat-block",2,"min-width","280px"],["formControlName","entity"],[3,"value",4,"ngFor","ngForOf"],["translate","",1,"tb-hint"],["mat-dialog-actions","",1,"flex","flex-row","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"disabled","matDialogClose"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"]],template:function(G,S){if(G&1){let u=Td();qa(0,"form",1,0),Pd("ngSubmit",function(){return Cd(u),Md(S.save())}),qa(2,"mat-toolbar",2)(3,"h2",3),Il(4,"widgets.maps.select-entity"),_l(),yh(5,"span",4),qa(6,"button",5)(7,"mat-icon",6),Il(8,"close"),_l()()(),gh(9,p_,1,0,"mat-progress-bar",7),iu(10,"async"),gh(11,d_,1,0,"div",8),iu(12,"async"),qa(13,"div",9)(14,"mat-form-field",10)(15,"mat-label",3),Il(16,"entity.entity"),_l(),qa(17,"mat-select",11),gh(18,f_,2,2,"mat-option",12),_l()(),qa(19,"div",13),Il(20,"widgets.maps.select-entity-hint"),_l()(),qa(21,"div",14)(22,"button",15),iu(23,"async"),Il(24),iu(25,"translate"),_l(),qa(26,"button",16),iu(27,"async"),Il(28),iu(29,"translate"),_l()()()}if(G&2){let u=Sd(1);ml("formGroup",S.selectEntityFormGroup),$a(6),ml("matDialogClose",null),$a(3),ml("ngIf",ru(10,10,S.isLoading$)),$a(2),ml("ngIf",!ru(12,12,S.isLoading$)),$a(7),ml("ngForOf",S.data.entities),$a(4),ml("disabled",ru(23,14,S.isLoading$))("matDialogClose",null),$a(2),vh(" ",ru(25,16,"action.cancel")," "),$a(2),ml("disabled",ru(27,18,S.isLoading$)||u.invalid||!u.dirty),$a(2),vh(" ",ru(29,20,"action.add")," ")}},dependencies:[kd,Ed,Ud,$d,qd,of,nf,rf,af,jd,Zd,Gd,sf,Od,Jd,Xd,Yd,Qd,tf,zd,Ad,Rd],styles:['@charset "UTF-8";[_nghost-%COMP%]   .tb-hint[_ngcontent-%COMP%]{margin-top:-1.25em;max-width:fit-content}']})}}return $t})();export{Lc as a,Bg as b};
