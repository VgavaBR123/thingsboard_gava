import{D as Ve,G as Ge,fa as He,p as je,q as Ne,r as Re,ua as $e,w as Oe,wa as qe,xa as ze,z as Ue}from"./chunk-MHBQMIF2.js";import{Cd as F,E as be,Fh as Mt,Jb as St,Ka as Ee,Nd as X,O as fe,Od as _t,Og as Fe,Pd as it,Ph as At,S as ge,Zd as Me,ae as Ae,ed as Et,g as ht,gl as we,jb as _e,kl as Le,oi as ke,qi as Ft,t as ut,ti as Pe,vi as xe,wi as Be,x as ue}from"./chunk-NP42USWW.js";import{G as dt,H as lt,J as he,M as mt,N as pt,Q as ct,aa as Tt,da as It,g as z,j as Q,z as k}from"./chunk-NKKV3KXS.js";import{b as et}from"./chunk-QR6ZNJZ6.js";import{A as re,Bc as bt,E as de,Ec as ft,Fc as gt,Kc as ve,Lc as yt,Mc as De,Oc as vt,Pc as Ce,Q as st,Qb as rt,Rc as Dt,Xc as Ct,cd as W,hd as Te,id as Se,kc as J,oc as Y,od as Ie,uc as K,yc as ye}from"./chunk-HBCL52P7.js";import{A as L,ba as me,ca as pe,jc as ce,m as C,n as nt,y as w,z as le}from"./chunk-HA3FE6NY.js";import{$c as v,$e as I,Ac as d,Bc as m,C as P,Cc as u,E as Z,Fa as U,Ga as Gt,Gc as Qt,J as tt,Jb as Bt,Jc as f,Jd as te,Lc as V,Ma as b,Ng as se,Oc as g,Pb as n,Qb as h,Re as ie,S as Ut,Sc as Jt,Ta as x,Tc as Yt,Ua as Ht,Uc as Kt,Va as $t,Yc as wt,Z as ot,Zc as c,_c as G,bf as ae,cb as qt,cf as oe,db as zt,dc as A,ed as Wt,hd as Xt,i as Ot,jc as M,jd as H,jg as ne,kd as Zt,ke as B,oc as p,od as r,pd as l,qc as S,qd as $,qe as q,te as ee,w as O,ya as Vt}from"./chunk-PQ6EZO2H.js";import{a as xt,d as Rt,i as D}from"./chunk-GHMOB5KC.js";D();var Qe=(()=>{class o{constructor(e,i,t){this.store=e,this.dialogService=i,this.translate=t}canDeactivate(e,i,t){let a=null;if(this.store.pipe(nt(re),ot(1)).subscribe(s=>{a=s}),a&&a.isAuthenticated){let s=!1;if(e.confirmForm){let y=e.confirmForm();y&&(s=y.dirty)}else ne(e.isDirty)&&(s=e.isDirty);if(s){let y=this.getMessage(e);return this.dialogService.confirm(this.translate.instant("confirm-on-exit.title"),y).pipe(P(_=>(_&&(e.confirmForm&&e.confirmForm()?e.confirmForm().markAsPristine():e.isDirty=!1),_)))}}return!0}getMessage(e){return e.confirmOnExitMessage?e.confirmOnExitMessage:this.translate.instant("confirm-on-exit.html-message")}static{this.\u0275fac=function(i){return new(i||o)(b(C),b(ut),b(w))}}static{this.\u0275prov=U({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();D();var Je=o=>({dashboardTitle:o});function bi(o,E){o&1&&(d(0,"mat-error"),c(1),r(2,"translate"),m()),o&2&&(n(),v(" ",l(2,1,"dashboard.title-required")," "))}function fi(o,E){o&1&&(d(0,"mat-error"),c(1),r(2,"translate"),m()),o&2&&(n(),v(" ",l(2,1,"dashboard.title-max-length")," "))}function gi(o,E){if(o&1&&(u(0,"tb-entity-list",25),r(1,"translate")),o&2){let e=V();g("labelText",l(1,2,"dashboard.assigned-customers")),p("entityType",e.entityType.CUSTOMER)}}var Xe=(()=>{class o extends ke{constructor(e,i,t,a,s,y,_){super(e,y,a,s,_),this.store=e,this.translate=i,this.dashboardService=t,this.entityValue=a,this.entitiesTableConfigValue=s,this.fb=y,this.cd=_,this.entityType=I}ngOnInit(){this.dashboardScope=this.entitiesTableConfig.componentsData.dashboardScope,this.customerId=this.entitiesTableConfig.componentsData.customerId,super.ngOnInit()}isPublic(e){return X(e)}isCurrentPublicCustomer(e){return it(e,this.customerId)}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){this.updateFields(e);let i=this.fb.group({title:[e?e.title:"",[bt.required,bt.maxLength(255)]],image:[e?e.image:null],mobileHide:[e?e.mobileHide:!1],mobileOrder:[e?e.mobileOrder:null,[bt.pattern(/^-?[0-9]+$/)]],configuration:this.fb.group({description:[e&&e.configuration?e.configuration.description:""]})});return this.isAdd&&i.addControl("assignedCustomerIds",this.fb.control([])),i}updateForm(e){this.updateFields(e),this.entityForm.patchValue({title:e.title}),this.entityForm.patchValue({image:e.image}),this.entityForm.patchValue({mobileHide:e.mobileHide}),this.entityForm.patchValue({mobileOrder:e.mobileOrder}),this.entityForm.patchValue({configuration:{description:e.configuration?e.configuration.description:""}})}prepareFormValue(e){let i=super.prepareFormValue(e);return i.configuration=xt(xt({},this.entity.configuration||{}),i.configuration||{}),i}onPublicLinkCopied(e){this.store.dispatch(new et({message:this.translate.instant("dashboard.public-link-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onDashboardIdCopied(e){this.store.dispatch(new et({message:this.translate.instant("dashboard.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}updateFields(e){e&&!se(e,{})&&(this.assignedCustomersText=_t(e),this.publicLink=this.dashboardService.getPublicDashboardLink(e))}static{this.\u0275fac=function(i){return new(i||o)(h(C),h(w),h(F),h("entity"),h("entitiesTableConfig"),h(W),h(te))}}static{this.\u0275cmp=x({type:o,selectors:[["tb-dashboard-form"]],features:[A],decls:82,vars:103,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"flex","flex-col"],["shareHashTags","thingsboard, iot",2,"padding-bottom","1.25em",3,"shareTitle","shareText","shareLink"],[1,"mat-block","flex-1"],["mat-icon-button","","ngxClipboard","","matTooltipPosition","above",2,"margin-top","8px",3,"cbOnSuccess","cbContent","matTooltip"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formGroupName","configuration",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["formControlName","assignedCustomerIds",3,"labelText","entityType",4,"ngIf"],[1,"tb-form-panel","stroked","no-gap"],["translate","",1,"tb-form-panel-title"],["formControlName","mobileHide",1,"mat-slide","margin","fixed-title-width"],["matInput","","formControlName","mobileOrder","type","number","step","1"],["formControlName","image",1,"flex-1",3,"label"],["formControlName","assignedCustomerIds",3,"labelText","entityType"]],template:function(i,t){i&1&&(d(0,"div",0)(1,"button",1),r(2,"async"),f("click",function(s){return t.onEntityAction(s,"open")}),c(3),r(4,"translate"),m(),d(5,"button",1),r(6,"async"),f("click",function(s){return t.onEntityAction(s,"export")}),c(7),r(8,"translate"),m(),d(9,"button",1),r(10,"async"),f("click",function(s){return t.onEntityAction(s,"makePublic")}),c(11),r(12,"translate"),m(),d(13,"button",1),r(14,"async"),f("click",function(s){return t.onEntityAction(s,"makePrivate")}),c(15),r(16,"translate"),m(),d(17,"button",1),r(18,"async"),f("click",function(s){return t.onEntityAction(s,"manageAssignedCustomers")}),c(19),r(20,"translate"),m(),d(21,"button",1),r(22,"async"),f("click",function(s){return t.onEntityAction(s,"unassignFromCustomer")}),c(23),r(24,"translate"),m(),d(25,"button",1),r(26,"async"),f("click",function(s){return t.onEntityAction(s,"unassignFromEdge")}),c(27),r(28,"translate"),m(),d(29,"button",1),r(30,"async"),f("click",function(s){return t.onEntityAction(s,"delete")}),c(31),r(32,"translate"),m(),d(33,"div",2)(34,"button",3),f("cbOnSuccess",function(s){return t.onDashboardIdCopied(s)}),u(35,"mat-icon",4),d(36,"span",5),c(37,"dashboard.copyId"),m()()()(),d(38,"div",6)(39,"mat-form-field",7)(40,"mat-label",5),c(41,"dashboard.assignedToCustomers"),m(),u(42,"input",8),m(),d(43,"div",9),u(44,"tb-social-share-panel",10),r(45,"translate"),r(46,"translate"),d(47,"div",2)(48,"mat-form-field",11)(49,"mat-label",5),c(50,"dashboard.public-link"),m(),u(51,"input",8),m(),d(52,"button",12),r(53,"translate"),f("cbOnSuccess",function(s){return t.onPublicLinkCopied(s)}),u(54,"mat-icon",4),m()()(),d(55,"form",13)(56,"fieldset",14),r(57,"async"),d(58,"mat-form-field",7)(59,"mat-label",5),c(60,"dashboard.title"),m(),u(61,"input",15),M(62,bi,3,3,"mat-error",16)(63,fi,3,3,"mat-error",16),m(),d(64,"div",17)(65,"mat-form-field",7)(66,"mat-label",5),c(67,"dashboard.description"),m(),u(68,"textarea",18),m()(),M(69,gi,2,4,"tb-entity-list",19),d(70,"div",20)(71,"div",21),c(72,"dashboard.mobile-app-settings"),m(),d(73,"mat-slide-toggle",22),c(74),r(75,"translate"),m(),d(76,"mat-form-field",7)(77,"mat-label",5),c(78,"dashboard.mobile-order"),m(),u(79,"input",23),m(),u(80,"tb-gallery-image-input",24),r(81,"translate"),m()()()()),i&2&&(n(),S("!hidden",t.isEdit),p("disabled",l(2,53,t.isLoading$)),n(2),v(" ",l(4,55,"dashboard.open-dashboard")," "),n(2),S("!hidden",t.isEdit||t.dashboardScope!=="tenant"),p("disabled",l(6,57,t.isLoading$)),n(2),v(" ",l(8,59,"dashboard.export")," "),n(2),S("!hidden",t.isEdit||t.dashboardScope!=="tenant"||t.isPublic(t.entity)),p("disabled",l(10,61,t.isLoading$)),n(2),v(" ",l(12,63,"dashboard.make-public")," "),n(2),S("!hidden",t.isEdit||!(t.dashboardScope==="tenant"&&t.isPublic(t.entity)||t.dashboardScope==="customer"&&t.isCurrentPublicCustomer(t.entity))),p("disabled",l(14,65,t.isLoading$)),n(2),v(" ",l(16,67,"dashboard.make-private")," "),n(2),S("!hidden",t.isEdit||t.dashboardScope!=="tenant"),p("disabled",l(18,69,t.isLoading$)),n(2),v(" ",l(20,71,"dashboard.manage-assigned-customers")," "),n(2),S("!hidden",t.isEdit||t.dashboardScope!=="customer"||t.isCurrentPublicCustomer(t.entity)),p("disabled",l(22,73,t.isLoading$)),n(2),v(" ",l(24,75,"dashboard.unassign-from-customer")," "),n(2),S("!hidden",t.isEdit||t.dashboardScope!=="edge"),p("disabled",l(26,77,t.isLoading$)),n(2),v(" ",l(28,79,"edge.unassign-from-edge")," "),n(2),S("!hidden",t.hideDelete()||t.isEdit),p("disabled",l(30,81,t.isLoading$)),n(2),v(" ",l(32,83,"dashboard.delete")," "),n(3),S("!hidden",t.isEdit),p("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),n(5),S("!hidden",t.isEdit||!(t.assignedCustomersText!=null&&t.assignedCustomersText.length)||t.dashboardScope!=="tenant"),n(3),p("ngModel",t.assignedCustomersText),n(),S("!hidden",t.isEdit||!(t.dashboardScope==="tenant"&&t.isPublic(t.entity)||t.dashboardScope==="customer"&&t.isCurrentPublicCustomer(t.entity))),n(),g("shareTitle",$(45,85,"dashboard.socialshare-title",H(99,Je,t.entity==null?null:t.entity.title))),g("shareText",$(46,88,"dashboard.socialshare-text",H(101,Je,t.entity==null?null:t.entity.title))),g("shareLink",t.publicLink),n(7),p("ngModel",t.publicLink),n(),g("cbContent",t.publicLink),g("matTooltip",l(53,91,"dashboard.copy-public-link")),n(3),p("formGroup",t.entityForm),n(),p("disabled",l(57,93,t.isLoading$)||!t.isEdit),n(6),p("ngIf",t.entityForm.get("title").hasError("required")),n(),p("ngIf",t.entityForm.get("title").hasError("maxlength")),n(6),p("ngIf",t.isAdd),n(5),v(" ",l(75,95,"dashboard.mobile-hide")," "),n(6),g("label",l(81,97,"dashboard.image")))},dependencies:[B,Mt,At,J,Y,K,Ee,Ie,Te,Se,ht,_e,Et,yt,ye,De,ft,gt,Ct,ve,vt,Dt,Ce,le,Le,q,L],styles:['@charset "UTF-8";']})}}return o})();D();function Di(o,E){o&1&&u(0,"mat-progress-bar",13)}function Ci(o,E){o&1&&u(0,"div",14)}var ti=(()=>{class o extends ct{constructor(e,i,t,a,s,y,_){switch(super(e,i,y),this.store=e,this.router=i,this.data=t,this.dashboardService=a,this.errorStateMatcher=s,this.dialogRef=y,this.fb=_,this.submitted=!1,this.entityType=I,this.assignedCustomersIds=t.assignedCustomersIds||[],t.actionType){case"assign":this.titleText="dashboard.assign-to-customers",this.labelText="dashboard.assign-to-customers-text",this.actionName="action.assign";break;case"manage":this.titleText="dashboard.manage-assigned-customers",this.labelText="dashboard.assigned-customers",this.actionName="action.update";break;case"unassign":this.titleText="dashboard.unassign-from-customers",this.labelText="dashboard.unassign-from-customers-text",this.actionName="action.unassign";break}}ngOnInit(){this.dashboardCustomersFormGroup=this.fb.group({assignedCustomerIds:[[...this.assignedCustomersIds]]})}isErrorState(e,i){let t=this.errorStateMatcher.isErrorState(e,i),a=!!(e&&e.invalid&&this.submitted);return t||a}cancel(){this.dialogRef.close(!1)}submit(){this.submitted=!0;let e=this.dashboardCustomersFormGroup.get("assignedCustomerIds").value,i=[];this.data.dashboardIds.forEach(t=>{i.push(this.getManageDashboardCustomersTask(t,e))}),tt(i).subscribe(()=>{this.dialogRef.close(!0)})}getManageDashboardCustomersTask(e,i){switch(this.data.actionType){case"assign":return this.dashboardService.addDashboardCustomers(e,i);case"manage":return this.dashboardService.updateDashboardCustomers(e,i);case"unassign":return this.dashboardService.removeDashboardCustomers(e,i)}}static{this.\u0275fac=function(i){return new(i||o)(h(C),h(z),h(lt),h(F),h(rt,4),h(dt),h(W))}}static{this.\u0275cmp=x({type:o,selectors:[["tb-manage-dashboard-customers-dialog"]],features:[Wt([{provide:rt,useExisting:o}]),A],decls:30,vars:30,consts:[[2,"width","600px",3,"ngSubmit","formGroup"],["color","primary",1,"flex","flex-row"],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[3,"disabled"],["formControlName","assignedCustomerIds",3,"required","entityType"],["mat-dialog-actions","",1,"flex","flex-row"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,t){i&1&&(d(0,"form",0),f("ngSubmit",function(){return t.submit()}),d(1,"mat-toolbar",1)(2,"h2"),c(3),r(4,"translate"),m(),u(5,"span",2),d(6,"button",3),f("click",function(){return t.cancel()}),d(7,"mat-icon",4),c(8,"close"),m()()(),M(9,Di,1,0,"mat-progress-bar",5),r(10,"async"),M(11,Ci,1,0,"div",6),r(12,"async"),d(13,"div",7)(14,"fieldset",8),r(15,"async"),d(16,"span"),c(17),r(18,"translate"),m(),u(19,"tb-entity-list",9),m()(),d(20,"div",10),u(21,"span",2),d(22,"button",11),r(23,"async"),f("click",function(){return t.cancel()}),c(24),r(25,"translate"),m(),d(26,"button",12),r(27,"async"),c(28),r(29,"translate"),m()()()),i&2&&(p("formGroup",t.dashboardCustomersFormGroup),n(3),G(l(4,12,t.titleText)),n(6),p("ngIf",l(10,14,t.isLoading$)),n(2),p("ngIf",!l(12,16,t.isLoading$)),n(3),p("disabled",l(15,18,t.isLoading$)),n(3),G(l(18,20,t.labelText)),n(2),p("required",t.data.actionType!=="manage")("entityType",t.entityType.CUSTOMER),n(3),p("disabled",l(23,22,t.isLoading$)),n(2),v(" ",l(25,24,"action.cancel")," "),n(2),p("disabled",l(27,26,t.isLoading$)||t.dashboardCustomersFormGroup.invalid||!t.dashboardCustomersFormGroup.dirty),n(2),v(" ",l(29,28,t.actionName)," "))},dependencies:[B,Mt,J,Y,K,Tt,It,pt,mt,yt,ft,gt,Ct,vt,Dt,q,L],encapsulation:2})}}return o})();D();var Ti=(o,E)=>({dashboardTitle:o,publicLink:E}),ei=o=>({dashboardTitle:o});function Si(o,E){o&1&&u(0,"mat-progress-bar",17)}function Ii(o,E){o&1&&u(0,"div",18)}var ii=(()=>{class o extends ct{constructor(e,i,t,a,s,y,_){super(e,i,y),this.store=e,this.router=i,this.data=t,this.translate=a,this.dashboardService=s,this.dialogRef=y,this.fb=_,this.dashboard=t.dashboard,this.publicLink=s.getPublicDashboardLink(this.dashboard)}ngOnInit(){}close(){this.dialogRef.close()}onPublicLinkCopied(e){this.store.dispatch(new et({message:this.translate.instant("dashboard.public-link-copied-message"),type:"success",target:"makeDashboardPublicDialogContent",duration:750,verticalPosition:"bottom",horizontalPosition:"left"}))}static{this.\u0275fac=function(i){return new(i||o)(h(C),h(z),h(lt),h(w),h(F),h(dt),h(W))}}static{this.\u0275cmp=x({type:o,selectors:[["tb-make-dashboard-public-dialog"]],features:[A],decls:34,vars:42,consts:[[2,"min-width","400px","position","relative"],["color","primary",1,"flex","flex-row"],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","","toastTarget","makeDashboardPublicDialogContent"],[3,"innerHTML"],[1,"flex","flex-row","items-center","justify-start"],[1,"tb-highlight","flex-1"],["mat-icon-button","","ngxClipboard","","matTooltipPosition","above",3,"cbOnSuccess","cbContent","matTooltip"],["svgIcon","mdi:clipboard-arrow-left"],[1,"tb-notice",3,"innerHTML"],["shareHashTags","thingsboard, iot",2,"padding-top","15px",3,"shareTitle","shareText","shareLink"],["mat-dialog-actions","",1,"flex","flex-row"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(i,t){i&1&&(d(0,"div",0)(1,"mat-toolbar",1)(2,"h2"),c(3),r(4,"translate"),m(),u(5,"span",2),d(6,"button",3),f("click",function(){return t.close()}),d(7,"mat-icon",4),c(8,"close"),m()()(),M(9,Si,1,0,"mat-progress-bar",5),r(10,"async"),M(11,Ii,1,0,"div",6),r(12,"async"),d(13,"div",7),u(14,"span",8),r(15,"async"),d(16,"div",9)(17,"pre",10)(18,"code"),c(19),m()(),d(20,"button",11),r(21,"translate"),f("cbOnSuccess",function(s){return t.onPublicLinkCopied(s)}),u(22,"mat-icon",12),m()(),u(23,"div",13),r(24,"translate"),u(25,"tb-social-share-panel",14),r(26,"translate"),r(27,"translate"),m(),d(28,"div",15),u(29,"span",2),d(30,"button",16),r(31,"async"),f("click",function(){return t.close()}),c(32),r(33,"translate"),m()()()),i&2&&(n(3),G(l(4,13,"dashboard.public-dashboard-title")),n(6),p("ngIf",l(10,15,t.isLoading$)),n(2),p("ngIf",!l(12,17,t.isLoading$)),n(3),g("innerHTML",l(15,19,t.translate.get("dashboard.public-dashboard-text",Zt(35,Ti,t.dashboard.title,t.publicLink))),Bt),n(5),G(t.publicLink),n(),g("cbContent",t.publicLink),g("matTooltip",l(21,21,"dashboard.copy-public-link")),n(3),g("innerHTML",l(24,23,"dashboard.public-dashboard-notice"),Bt),n(2),g("shareTitle",$(26,25,"dashboard.socialshare-title",H(38,ei,t.dashboard.title))),g("shareText",$(27,28,"dashboard.socialshare-text",H(40,ei,t.dashboard.title))),g("shareLink",t.publicLink),n(5),p("disabled",l(31,31,t.isLoading$)),n(2),v(" ",l(33,33,"action.ok")," "))},dependencies:[B,fe,At,J,Y,K,Tt,It,pt,mt,ht,Et,q,L],encapsulation:2})}}return o})();D();D();var ai=(()=>{class o extends ce{set isEdit(e){this.isEditValue=e}get isEdit(){return this.isEditValue}set entity(e){this.setEntity(e)}get entity(){return this.entityValue}set entitiesTableConfig(e){this.setEntitiesTableConfig(e)}get entitiesTableConfig(){return this.entitiesTableConfigValue}constructor(e){super(e),this.store=e,this.attributeScopes=pe,this.latestTelemetryTypes=me,this.authorities=k,this.entityTypes=I,this.auditLogModes=je,this.eventTypes=Ne,this.debugEventTypes=Re,this.nullUid=ie,this.entityTabsSubject=new Ot(null),this.entityTabsChanged=this.entityTabsSubject.asObservable(),this.authUser=st(e)}ngOnInit(){}ngAfterViewInit(){this.entityTabsSubject.next(this.entityTabs.toArray()),this.entityTabs.changes.subscribe(()=>{this.entityTabsSubject.next(this.entityTabs.toArray())})}setEntity(e){this.entityValue=e}setEntitiesTableConfig(e){this.entitiesTableConfigValue=e}static{this.\u0275fac=function(i){return new(i||o)(h(C))}}static{this.\u0275dir=$t({type:o,viewQuery:function(i,t){if(i&1&&Jt(St,5),i&2){let a;Yt(a=Kt())&&(t.entityTabs=a)}},inputs:{isEdit:"isEdit",entity:"entity",entitiesTableConfig:"entitiesTableConfig",detailsForm:"detailsForm"},features:[A]})}}return o})();function Ei(o,E){if(o&1&&(d(0,"mat-tab",3,0),r(2,"translate"),u(3,"tb-audit-log-table",4),m()),o&2){let e=wt(1),i=V();g("label",l(2,4,"audit-log.audit-logs")),n(3),p("active",e.isActive)("auditLogMode",i.auditLogModes.ENTITY)("entityId",i.entity.id)}}function _i(o,E){if(o&1){let e=Qt();d(0,"mat-tab",3,1),r(2,"translate"),d(3,"tb-version-control",5),f("versionRestored",function(){qt(e);let t=V();return zt(t.entitiesTableConfig.updateData())}),m()()}if(o&2){let e=wt(1),i=V();g("label",l(2,5,"version-control.version-control")),n(3),p("active",e.isActive)("entityId",i.entity.id)("entityName",i.entity.name)("externalEntityId",i.entity.externalId||i.entity.id)}}var oi=(()=>{class o extends ai{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(i){return new(i||o)(h(C))}}static{this.\u0275cmp=x({type:o,selectors:[["tb-dashboard-tabs"]],features:[A],decls:2,vars:2,consts:[["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(i,t){i&1&&M(0,Ei,4,6,"mat-tab",2)(1,_i,4,7,"mat-tab",2),i&2&&(p("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),n(),p("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[B,St,Ge,Ve,L],encapsulation:2})}}return o})();D();D();var jt=(()=>{class o{constructor(e,i,t,a,s,y,_,si,ri,di,li){this.store=e,this.dashboardService=i,this.customerService=t,this.edgeService=a,this.dialogService=s,this.homeDialogs=y,this.importExport=_,this.translate=si,this.datePipe=ri,this.router=di,this.dialog=li,this.config=new xe,this.config.entityType=I.DASHBOARD,this.config.entityComponent=Xe,this.config.entityTabsComponent=oi,this.config.entityTranslations=ae.get(I.DASHBOARD),this.config.entityResources=oe.get(I.DASHBOARD),this.config.rowPointer=!0,this.config.deleteEntityTitle=T=>this.translate.instant("dashboard.delete-dashboard-title",{dashboardTitle:T.title}),this.config.deleteEntityContent=()=>this.translate.instant("dashboard.delete-dashboard-text"),this.config.deleteEntitiesTitle=T=>this.translate.instant("dashboard.delete-dashboards-title",{count:T}),this.config.deleteEntitiesContent=()=>this.translate.instant("dashboard.delete-dashboards-text"),this.config.loadEntity=T=>this.dashboardService.getDashboard(T.id),this.config.saveEntity=T=>this.saveAndAssignDashboard(T),this.config.onEntityAction=T=>this.onDashboardAction(T),this.config.detailsReadonly=()=>this.config.componentsData.dashboardScope==="customer_user"||this.config.componentsData.dashboardScope==="edge_customer_user",this.config.handleRowClick=(T,Nt)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(T,Nt):this.openDashboard(T,Nt),!0),this.config.entityAdded=T=>{this.openDashboard(null,T)}}resolve(e){let i=e.params;return this.config.componentsData={dashboardScope:e.data.dashboardsType,customerId:i.customerId,edgeId:i.edgeId},this.store.pipe(nt(de),ot(1)).pipe(Vt(t=>{t.authority===k.CUSTOMER_USER&&(e.data.dashboardsType==="edge"?this.config.componentsData.dashboardScope="edge_customer_user":this.config.componentsData.dashboardScope="customer_user",this.config.componentsData.customerId=t.customerId)}),Z(()=>this.config.componentsData.customerId?this.customerService.getCustomer(this.config.componentsData.customerId):O(null)),P(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-dashboards"):this.config.tableTitle=t.title+": "+this.translate.instant("dashboard.dashboards"):this.config.componentsData.dashboardScope==="edge"?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(a=>this.config.tableTitle=a.name+": "+this.translate.instant("dashboard.dashboards")):this.config.tableTitle=this.translate.instant("dashboard.dashboards"),this.config.columns=this.configureColumns(this.config.componentsData.dashboardScope),this.configureEntityFunctions(this.config.componentsData.dashboardScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.dashboardScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.dashboardScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.dashboardScope),this.config.addEnabled=!(this.config.componentsData.dashboardScope==="customer_user"||this.config.componentsData.dashboardScope==="edge_customer_user"),this.config.entitiesDeleteEnabled=this.config.componentsData.dashboardScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.dashboardScope==="tenant",this.config)))}configureColumns(e){let i=[new Pe("createdTime","common.created-time",this.datePipe,"150px"),new Ft("title","dashboard.title","50%")];return e==="tenant"&&i.push(new Ft("customersTitle","dashboard.assignedToCustomers","50%",t=>_t(t),()=>({}),!1),new Ft("dashboardIsPublic","dashboard.public","60px",t=>Be(X(t)),()=>({}),!1)),i}configureEntityFunctions(e){e==="tenant"?(this.config.entitiesFetchFunction=i=>this.dashboardService.getTenantDashboards(i),this.config.deleteEntity=i=>this.dashboardService.deleteDashboard(i.id)):e==="edge"||e==="edge_customer_user"?this.config.entitiesFetchFunction=i=>this.dashboardService.getEdgeDashboards(this.config.componentsData.edgeId,i,this.config.componentsData.dashboardsType):(this.config.entitiesFetchFunction=i=>this.dashboardService.getCustomerDashboards(this.config.componentsData.customerId,i),this.config.deleteEntity=i=>this.dashboardService.unassignDashboardFromCustomer(this.config.componentsData.customerId,i.id))}configureCellActions(e){let i=[];return e==="tenant"&&i.push({name:this.translate.instant("dashboard.export"),icon:"file_download",isEnabled:()=>!0,onAction:(t,a)=>this.exportDashboard(t,a)},{name:this.translate.instant("dashboard.make-public"),icon:"share",isEnabled:t=>!X(t),onAction:(t,a)=>this.makePublic(t,a)},{name:this.translate.instant("dashboard.make-private"),icon:"reply",isEnabled:t=>X(t),onAction:(t,a)=>this.makePrivate(t,a)},{name:this.translate.instant("dashboard.manage-assigned-customers"),icon:"assignment_ind",isEnabled:()=>!0,onAction:(t,a)=>this.manageAssignedCustomers(t,a)}),e==="customer"&&i.push({name:this.translate.instant("dashboard.export"),icon:"file_download",isEnabled:()=>!0,onAction:(t,a)=>this.exportDashboard(t,a)},{name:this.translate.instant("dashboard.make-private"),icon:"reply",isEnabled:t=>it(t,this.config.componentsData.customerId),onAction:(t,a)=>this.makePrivate(t,a)},{name:this.translate.instant("dashboard.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>!it(t,this.config.componentsData.customerId),onAction:(t,a)=>this.unassignFromCustomer(t,a,this.config.componentsData.customerId)}),e==="edge"&&i.push({name:this.translate.instant("dashboard.export"),icon:"file_download",isEnabled:()=>!0,onAction:(t,a)=>this.exportDashboard(t,a)},{name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:()=>!0,onAction:(t,a)=>this.unassignFromEdge(t,a)}),i.push({name:this.translate.instant("dashboard.dashboard-details"),icon:"edit",isEnabled:()=>!0,onAction:(t,a)=>this.config.toggleEntityDetails(t,a)}),i}configureGroupActions(e){let i=[];return e==="tenant"&&(i.push({name:this.translate.instant("dashboard.assign-dashboards"),icon:"assignment_ind",isEnabled:!0,onAction:(t,a)=>this.assignDashboardsToCustomers(t,a.map(s=>s.id.id))}),i.push({name:this.translate.instant("dashboard.unassign-dashboards"),icon:"assignment_return",isEnabled:!0,onAction:(t,a)=>this.unassignDashboardsFromCustomers(t,a.map(s=>s.id.id))})),e==="customer"&&i.push({name:this.translate.instant("dashboard.unassign-dashboards"),icon:"assignment_return",isEnabled:!0,onAction:(t,a)=>this.unassignDashboardsFromCustomer(t,a.map(s=>s.id.id),this.config.componentsData.customerId)}),e==="edge"&&i.push({name:this.translate.instant("dashboard.unassign-dashboards"),icon:"assignment_return",isEnabled:!0,onAction:(t,a)=>this.unassignDashboardsFromEdge(t,a)}),i}configureAddActions(e){let i=[];return e==="tenant"&&i.push({name:this.translate.instant("dashboard.create-new-dashboard"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.config.getTable().addEntity(t)},{name:this.translate.instant("dashboard.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importDashboard(t)}),e==="customer"&&i.push({name:this.translate.instant("dashboard.assign-new-dashboard"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addDashboardsToCustomer(t)}),e==="edge"&&i.push({name:this.translate.instant("dashboard.assign-new-dashboard"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addDashboardsToEdge(t)}),i}openDashboard(e,i){e&&e.stopPropagation(),this.config.componentsData.dashboardScope==="customer"?this.router.navigateByUrl(`customers/${this.config.componentsData.customerId}/dashboards/${i.id.id}`):this.config.componentsData.dashboardScope==="edge"?this.router.navigateByUrl(`edgeInstances/${this.config.componentsData.edgeId}/dashboards/${i.id.id}`):this.router.navigateByUrl(`dashboards/${i.id.id}`)}importDashboard(e){this.importExport.importDashboard(this.editMissingAliases.bind(this)).subscribe(i=>{i&&this.config.updateData()})}editMissingAliases(e,i,t,a){return this.dialog.open(He,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityAliases:a,widgets:e,customTitle:t,isSingleWidget:i,disableAdd:!0}}).afterClosed().pipe(P(s=>{if(s)return s;throw new Error("Unable to resolve missing entity aliases!")}))}exportDashboard(e,i){e&&e.stopPropagation(),this.importExport.exportDashboard(i.id.id)}addDashboardsToCustomer(e){e&&e.stopPropagation(),this.dialog.open(qe,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.config.componentsData.customerId,entityType:I.DASHBOARD}}).afterClosed().subscribe(i=>{i&&this.config.updateData()})}makePublic(e,i){e&&e.stopPropagation(),this.dashboardService.makeDashboardPublic(i.id.id).subscribe(t=>{this.dialog.open(ii,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{dashboard:t}}).afterClosed().subscribe(()=>{this.config.updateData()})})}makePrivate(e,i){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("dashboard.make-private-dashboard-title",{dashboardTitle:i.title}),this.translate.instant("dashboard.make-private-dashboard-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.dashboardService.makeDashboardPrivate(i.id.id).subscribe(()=>{this.config.updateData()})})}manageAssignedCustomers(e,i){let t=i.assignedCustomers?i.assignedCustomers.map(a=>a.customerId.id):[];this.showManageAssignedCustomersDialog(e,[i.id.id],"manage",t)}assignDashboardsToCustomers(e,i){this.showManageAssignedCustomersDialog(e,i,"assign")}unassignDashboardsFromCustomers(e,i){this.showManageAssignedCustomersDialog(e,i,"unassign")}showManageAssignedCustomersDialog(e,i,t,a){e&&e.stopPropagation(),this.dialog.open(ti,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{dashboardIds:i,actionType:t,assignedCustomersIds:a}}).afterClosed().subscribe(s=>{s&&this.config.updateData()})}unassignFromCustomer(e,i,t){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("dashboard.unassign-dashboard-title",{dashboardTitle:i.title}),this.translate.instant("dashboard.unassign-dashboard-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(a=>{a&&this.dashboardService.unassignDashboardFromCustomer(t,i.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.dashboardScope!=="tenant")})})}unassignDashboardsFromCustomer(e,i,t){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("dashboard.unassign-dashboards-title",{count:i.length}),this.translate.instant("dashboard.unassign-dashboards-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(a=>{if(a){let s=[];i.forEach(y=>{s.push(this.dashboardService.unassignDashboardFromCustomer(t,y))}),tt(s).subscribe(()=>{this.config.updateData()})}})}onDashboardAction(e){switch(e.action){case"open":return this.openDashboard(e.event,e.entity),!0;case"export":return this.exportDashboard(e.event,e.entity),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"makePrivate":return this.makePrivate(e.event,e.entity),!0;case"manageAssignedCustomers":return this.manageAssignedCustomers(e.event,e.entity),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity,this.config.componentsData.customerId),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0}return!1}addDashboardsToEdge(e){e&&e.stopPropagation(),this.dialog.open(ze,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:I.DASHBOARD}}).afterClosed().subscribe(i=>{i&&this.config.updateData()})}unassignFromEdge(e,i){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("dashboard.unassign-dashboard-title",{dashboardTitle:i.title}),this.translate.instant("dashboard.unassign-dashboard-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.dashboardService.unassignDashboardFromEdge(this.config.componentsData.edgeId,i.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.dashboardScope!=="tenant")})})}unassignDashboardsFromEdge(e,i){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("dashboard.unassign-dashboards-from-edge-title",{count:i.length}),this.translate.instant("dashboard.unassign-dashboards-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let a=[];i.forEach(s=>{a.push(this.dashboardService.unassignDashboardFromEdge(this.config.componentsData.edgeId,s.id.id))}),tt(a).subscribe(()=>{this.config.updateData()})}})}saveAndAssignDashboard(e){let a=e,{assignedCustomerIds:i}=a,t=Rt(a,["assignedCustomerIds"]);return this.dashboardService.saveDashboard(t).pipe(Z(s=>i?.length?this.dashboardService.addDashboardCustomers(s.id.id,i):O(s)))}static{this.\u0275fac=function(i){return new(i||o)(b(C),b(F),b(Ae),b(Fe),b(ut),b(Ue),b(we),b(w),b(ee),b(z),b(he))}}static{this.\u0275prov=U({token:o,factory:o.\u0275fac})}}return o})();var ni=(()=>{class o{constructor(e,i,t,a){this.store=e,this.dashboardService=i,this.userSettingService=t,this.dashboardUtils=a}resolve(e){let i=e.params.dashboardId;return this.dashboardService.getDashboard(i).pipe(Z(t=>(st(this.store).isPublic?O(null):this.userSettingService.reportUserDashboardAction(i,ue.VISIT,{ignoreLoading:!0,ignoreErrors:!0})).pipe(Ut(()=>O(t)),P(()=>t))),P(t=>this.dashboardUtils.validateAndUpdateDashboard(t)))}static{this.\u0275fac=function(i){return new(i||o)(b(C),b(F),b(be),b(Me))}}static{this.\u0275prov=U({token:o,factory:o.\u0275fac})}}return o})(),Mi=(o,E,e)=>e.dashboard.title,Ai=[{path:"dashboards",data:{breadcrumb:{menuId:ge.dashboards}},children:[{path:"",component:Oe,data:{auth:[k.TENANT_ADMIN,k.CUSTOMER_USER],title:"dashboard.dashboards",dashboardsType:"tenant"},resolve:{entitiesTableConfig:jt}},{path:":dashboardId",component:$e,canDeactivate:[Qe],data:{breadcrumb:{labelFunction:Mi,icon:"dashboard"},auth:[k.TENANT_ADMIN,k.CUSTOMER_USER],title:"dashboard.dashboard",widgetEditMode:!1},resolve:{dashboard:ni}}]}],Fi=(()=>{class o{static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275mod=Ht({type:o})}static{this.\u0275inj=Gt({providers:[jt,ni],imports:[Q.forChild(Ai),Q]})}}return o})();(function(){Xt(Fi,{imports:[Q],exports:[Q]})})();export{Qe as a,ai as b,Xe as c,ti as d,ii as e,oi as f,jt as g,ni as h,Mi as i,Fi as j};
