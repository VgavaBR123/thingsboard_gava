import{D as Ui,Na as zi,ba as Hi,i as Gi,q as ji,r as qi}from"./chunk-MHBQMIF2.js";import{Aa as ci,Cc as Ri,Da as pi,Ga as mi,Ha as hi,Jb as xi,K as ue,Ka as Se,Kb as Ii,Mc as Ti,Na as fi,Sa as gi,Ta as bi,Ua as Ci,Va as vi,Vn as Ai,Wl as Fi,Yl as Pi,ca as R,cb as yi,cc as Si,db as _i,ea as ii,eb as Ni,ee as O,el as Li,fe as Ge,g as Jt,ge as W,ha as si,hc as ut,hm as Bi,ia as di,ja as ui,ke as Di,ld as Mi,le as wi,m as at,me as It,mm as Oi,n as Zt,od as Ei,p as ei,pe as Ve,qc as xt,ql as Vi,se as ki,t as ti,te as je,ve as Re,wl as ct}from"./chunk-NP42USWW.js";import{G as tt,H as it,J as Kt,M as nt,N as ot,Q as rt,R as Xt,W as Yt,aa as dt,da as Ae,e as Ut,g as _e}from"./chunk-NKKV3KXS.js";import{Bc as U,Ec as Q,Fc as K,Hc as Nt,Ka as Zi,Kc as ni,Lc as ge,Nc as oi,Oc as Z,Pc as lt,Qb as fe,Rc as ee,T as he,Xa as en,Xc as xe,Ya as tn,bd as ri,cd as te,dc as Qt,hd as Le,id as st,kc as we,kd as ai,ld as li,mc as $t,nc as Wt,oc as Oe,od as Ie,uc as ce,xc as ke,yc as Ne}from"./chunk-HBCL52P7.js";import{A as J,a as Ht,jc as et,m as Be,y as De,z as de}from"./chunk-HA3FE6NY.js";import{$c as w,$e as zt,Ac as r,Bc as d,C as vt,Cc as x,E as He,Ea as Ee,Ee as qt,Fc as Ot,Gc as T,Jb as Fe,Jc as _,Jd as jt,Kb as Ft,Lc as C,Lg as D,O as Et,Oc as M,Pb as a,Pc as At,Qb as b,S as ze,Sc as V,Ta as q,Tc as F,Uc as P,Wb as Pt,X as Dt,Xb as $e,Yc as j,Zc as h,_c as z,bb as Ke,bd as We,cb as v,cd as Xe,da as wt,db as y,dc as Ce,dd as Ye,ed as ae,g as Ue,j as Tt,jc as I,jd as Je,je as Ze,ke as Y,kg as _t,lb as me,oc as l,od as f,pc as yt,pd as g,q as bt,qa as kt,qc as ve,qd as Pe,qe as ye,r as Ct,sa as Lt,tc as Bt,td as Gt,ua as Qe,w as X,wa as Me,x as Mt,ya as Vt}from"./chunk-PQ6EZO2H.js";import{a as gt,i as re}from"./chunk-GHMOB5KC.js";re();var nn=["definedConfigContent"],on=["jsonObjectEditComponent"];function rn(o,m){if(o&1&&(r(0,"div",5),h(1),d()),o&2){let e=C();a(),z(e.definedDirectiveError)}}function an(o,m){if(o&1&&(x(0,"tb-json-object-edit",6,1),f(2,"translate")),o&2){let e=C();l("label",g(2,3,"rulenode.configuration"))("jsonRequired",e.required)("fillHeight",!0)}}var Ki=(()=>{class o{get required(){return this.requiredValue}set required(e){this.requiredValue=he(e)}set nodeDefinition(e){this.nodeDefinitionValue!==e&&(this.nodeDefinitionValue=e,this.nodeDefinitionValue&&this.validateDefinedDirective(),setTimeout(()=>this.initRuleNode.emit()))}get nodeDefinition(){return this.nodeDefinitionValue}constructor(e,t){this.ruleChainService=e,this.fb=t,this.initRuleNode=new me,this.changeScript=new me,this.propagateChange=i=>{},this.ruleNodeConfigFormGroup=this.fb.group({configuration:[null,U.required]})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnDestroy(){this.definedConfigComponentRef&&this.definedConfigComponentRef.destroy(),this.changeSubscription&&(this.changeSubscription.unsubscribe(),this.changeSubscription=null),this.changeScriptSubscription&&(this.changeScriptSubscription.unsubscribe(),this.changeScriptSubscription=null)}setDisabledState(e){this.disabled=e,this.disabled?this.ruleNodeConfigFormGroup.disable({emitEvent:!1}):this.ruleNodeConfigFormGroup.enable({emitEvent:!1}),this.definedConfigComponent&&(this.definedConfigComponent.disabled=this.disabled)}writeValue(e){this.configuration=D(e),this.changeSubscription&&(this.changeSubscription.unsubscribe(),this.changeSubscription=null),this.definedConfigComponent?(this.definedConfigComponent.configuration=this.configuration,this.changeSubscription=this.definedConfigComponent.configurationChanged.subscribe(t=>{this.updateModel(t)})):(this.ruleNodeConfigFormGroup.get("configuration").patchValue(this.configuration,{emitEvent:!1}),this.changeSubscription=this.ruleNodeConfigFormGroup.get("configuration").valueChanges.subscribe(t=>{this.updateModel(t)}))}useDefinedDirective(){return this.nodeDefinition&&this.nodeDefinition.configDirective&&this.nodeDefinition.configDirective.length&&!this.definedDirectiveError}updateModel(e){this.definedConfigComponent||this.ruleNodeConfigFormGroup.valid?this.propagateChange(e):this.propagateChange(this.required?null:e)}validateDefinedDirective(){if(this.definedConfigComponentRef&&(this.definedConfigComponentRef.destroy(),this.definedConfigComponentRef=null),this.nodeDefinition.uiResourceLoadError&&this.nodeDefinition.uiResourceLoadError.length)this.definedDirectiveError=this.nodeDefinition.uiResourceLoadError;else if(this.nodeDefinition.configDirective&&this.nodeDefinition.configDirective.length){this.changeSubscription&&(this.changeSubscription.unsubscribe(),this.changeSubscription=null),this.changeScriptSubscription&&(this.changeScriptSubscription.unsubscribe(),this.changeScriptSubscription=null),this.definedConfigContainer.clear();let e=this.ruleChainService.getRuleNodeConfigComponent(this.nodeDefinition.configDirective);this.definedConfigComponentRef=this.definedConfigContainer.createComponent(e),this.definedConfigComponent=this.definedConfigComponentRef.instance,this.definedConfigComponent.ruleNodeId=this.ruleNodeId,this.definedConfigComponent.ruleChainId=this.ruleChainId,this.definedConfigComponent.ruleChainType=this.ruleChainType,this.definedConfigComponent.configuration=this.configuration,this.changeSubscription=this.definedConfigComponent.configurationChanged.subscribe(t=>{this.updateModel(t)}),this.definedConfigComponent?.changeScript&&(this.changeScriptSubscription=this.definedConfigComponent.changeScript.subscribe(()=>this.changeScript.emit()))}}validate(){this.useDefinedDirective()&&this.definedConfigComponent.validate()}static{this.\u0275fac=function(t){return new(t||o)(b(Re),b(te))}}static{this.\u0275cmp=q({type:o,selectors:[["tb-rule-node-config"]],viewQuery:function(t,i){if(t&1&&(V(nn,7,$e),V(on,5)),t&2){let n;F(n=P())&&(i.definedConfigContainer=n.first),F(n=P())&&(i.jsonObjectEditComponent=n.first)}},inputs:{required:"required",disabled:"disabled",ruleNodeId:"ruleNodeId",ruleChainId:"ruleChainId",ruleChainType:"ruleChainType",nodeDefinition:"nodeDefinition"},outputs:{initRuleNode:"initRuleNode",changeScript:"changeScript"},features:[ae([{provide:ke,useExisting:Ee(()=>o),multi:!0}])],decls:5,vars:3,consts:[["definedConfigContent",""],["jsonObjectEditComponent",""],[3,"formGroup"],["class","tb-rulenode-directive-error",4,"ngIf"],["class","tb-rule-node-configuration-json","formControlName","configuration",3,"label","jsonRequired","fillHeight",4,"ngIf"],[1,"tb-rulenode-directive-error"],["formControlName","configuration",1,"tb-rule-node-configuration-json",3,"label","jsonRequired","fillHeight"]],template:function(t,i){t&1&&(r(0,"div",2),Ot(1,null,0),I(3,rn,2,1,"div",3)(4,an,3,5,"tb-json-object-edit",4),d()),t&2&&(l("formGroup",i.ruleNodeConfigFormGroup),a(3),l("ngIf",i.definedDirectiveError),a(),l("ngIf",!i.useDefinedDirective()))},dependencies:[Y,Ei,Q,K,Z,ee,J],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   tb-json-object-edit.tb-rule-node-configuration-json[_ngcontent-%COMP%]{display:block;height:300px}[_nghost-%COMP%]   .tb-rulenode-directive-error[_ngcontent-%COMP%]{font-size:13px;font-weight:400;color:#dd2c00}']})}}return o})();re();var un=["ruleNodeConfigComponent"];function cn(o,m){if(o&1){let e=T();r(0,"div",17)(1,"button",18),_("click",function(i){v(e);let n=C();return y(n.openRuleChain(i))}),h(2),f(3,"translate"),d()()}o&2&&(a(2),w(" ",g(3,1,"rulechain.open-rulechain")," "))}function pn(o,m){o&1&&(r(0,"mat-error"),h(1),f(2,"translate"),d()),o&2&&(a(),w(" ",g(2,1,"rulenode.name-required")," "))}function mn(o,m){o&1&&(r(0,"mat-error"),h(1),f(2,"translate"),d()),o&2&&(a(),w(" ",g(2,1,"rulenode.name-max-length")," "))}function hn(o,m){if(o&1){let e=T();r(0,"button",19),_("click",function(i){v(e);let n=C();return y(n.onSingleModeChange(i))}),r(1,"mat-icon"),h(2,"checkmark"),d(),r(3,"span",5),h(4,"rulenode.singleton"),d(),x(5,"input",20),d()}if(o&2){let e=C();ve("active",e.ruleNodeFormGroup.get("singletonMode").value),l("disabled",e.ruleNodeFormGroup.get("singletonMode").disabled||e.disabled),a(),ve("invisible",!e.ruleNodeFormGroup.get("singletonMode").value)}}function fn(o,m){if(o&1&&x(0,"tb-queue-autocomplete",21),o&2){let e=C();l("queueType",e.serviceType)("autocompleteHint",e.isSingleton()?"rulenode.queue-singleton-hint":"rulenode.queue-hint")}}var Te=class o extends et{constructor(m,e){super(),this.fb=m,this.router=e,this.disabled=!1,this.isAdd=!1,this.initRuleNode=new me,this.changeScript=new me,this.entityType=zt,this.serviceType=Bi.TB_RULE_ENGINE,this.destroy$=new Ue,this.ruleNodeFormGroup=this.fb.group({})}buildForm(){this.ruleNode?(this.ruleNodeFormGroup=this.fb.group({name:[this.ruleNode.name,[U.required,U.pattern("(.|\\s)*\\S(.|\\s)*"),U.maxLength(255)]],debugSettings:[this.ruleNode.debugSettings],singletonMode:[this.ruleNode.singletonMode,[]],configuration:[this.ruleNode.configuration,[U.required]],additionalInfo:this.fb.group({description:[this.ruleNode.additionalInfo?this.ruleNode.additionalInfo.description:""]})}),this.isAddQueue()&&(this.ruleNodeFormGroup.addControl("queueName",this.fb.control(this.ruleNode?.queueName?this.ruleNode.queueName:null)),this.isSingleton()&&(this.isSingletonEditAllowed()||this.ruleNodeFormGroup.get("singletonMode").disable({emitEvent:!1}),this.ruleNodeFormGroup.get("singletonMode").value||this.ruleNodeFormGroup.get("queueName").disable({emitEvent:!1}),this.ruleNodeFormGroup.get("singletonMode").valueChanges.pipe(Me(this.destroy$)).subscribe(m=>{m?this.ruleNodeFormGroup.get("queueName").enable({emitEvent:!1}):this.ruleNodeFormGroup.get("queueName").disable({emitEvent:!1})}))),this.ruleNodeFormGroup.valueChanges.pipe(Me(this.destroy$)).subscribe(()=>this.updateRuleNode())):this.ruleNodeFormGroup=this.fb.group({}),this.disabled&&this.ruleNodeFormGroup.disable({emitEvent:!1})}updateRuleNode(){let m=this.ruleNodeFormGroup.value||{};m.name=m.name.trim(),Object.assign(this.ruleNode,m)}ngOnInit(){this.disabled&&this.ruleNodeFormGroup.disable({emitEvent:!1})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngOnChanges(m){for(let e of Object.keys(m)){let t=m[e];t.currentValue!==t.previousValue&&e==="ruleNode"&&this.buildForm()}}validate(){this.ruleNodeConfigComponent.validate()}onSingleModeChange(m){m&&m.stopPropagation();let e=this.ruleNodeFormGroup.get("singletonMode");e.patchValue(!e.value),e.markAsDirty()}openRuleChain(m){m&&m.stopPropagation();let e=this.ruleNodeFormGroup.get("configuration")?.value?.ruleChainId;e&&(this.ruleChainType===je.EDGE?this.router.navigateByUrl(`/edgeManagement/ruleChains/${e}`):this.router.navigateByUrl(`/ruleChains/${e}`))}isAddQueue(){return this.isSingleton()||this.ruleNode.component.hasQueueName}isSingleton(){return this.ruleNode.component.clusteringMode===Ve.SINGLETON||this.ruleNode.component.clusteringMode===Ve.USER_PREFERENCE}isSingletonEditAllowed(){return this.ruleNode.component.clusteringMode===Ve.USER_PREFERENCE}static{this.\u0275fac=function(e){return new(e||o)(b(te),b(_e))}}static{this.\u0275cmp=q({type:o,selectors:[["tb-rule-node"]],viewQuery:function(e,t){if(e&1&&V(un,5),e&2){let i;F(i=P())&&(t.ruleNodeConfigComponent=i.first)}},inputs:{ruleNode:"ruleNode",ruleChainId:"ruleChainId",ruleChainType:"ruleChainType",disabled:"disabled",isAdd:"isAdd"},outputs:{initRuleNode:"initRuleNode",changeScript:"changeScript"},features:[Ce,Ke],decls:21,vars:11,consts:[["ruleNodeConfigComponent",""],["class","tb-details-buttons",4,"ngIf"],[1,"mat-padding",3,"formGroup"],[1,"title-row","align-center","flex"],[1,"mat-block","flex-1"],["translate",""],["matInput","","formControlName","name","required",""],[4,"ngIf"],[1,"mb-5","flex","max-w-xs","flex-row"],["formControlName","debugSettings",1,"mr-2",3,"entityType"],["mat-stroked-button","","class","tb-rounded-btn flex-1","color","primary",3,"disabled","active","click",4,"ngIf"],["formControlName","configuration",3,"initRuleNode","changeScript","ruleNodeId","ruleChainId","ruleChainType","nodeDefinition"],[1,"description-block"],["subscriptSizing","dynamic","formControlName","queueName",3,"queueType","autocompleteHint",4,"ngIf"],["formGroupName","additionalInfo"],[1,"mat-block"],["matInput","","formControlName","description","rows","1"],[1,"tb-details-buttons"],["mat-raised-button","","color","primary",3,"click"],["mat-stroked-button","","color","primary",1,"tb-rounded-btn","flex-1",3,"click","disabled"],["formControlName","singletonMode",1,"hidden"],["subscriptSizing","dynamic","formControlName","queueName",3,"queueType","autocompleteHint"]],template:function(e,t){if(e&1){let i=T();I(0,cn,4,3,"div",1),r(1,"form",2)(2,"section",3)(3,"mat-form-field",4)(4,"mat-label",5),h(5,"rulenode.name"),d(),x(6,"input",6),I(7,pn,3,3,"mat-error",7)(8,mn,3,3,"mat-error",7),d(),r(9,"section",8),x(10,"tb-entity-debug-settings-button",9),I(11,hn,6,5,"button",10),d()(),r(12,"tb-rule-node-config",11,0),_("initRuleNode",function(s){return v(i),y(t.initRuleNode.emit(s))})("changeScript",function(s){return v(i),y(t.changeScript.emit(s))}),d(),r(14,"div",12),I(15,fn,1,2,"tb-queue-autocomplete",13),r(16,"div",14)(17,"mat-form-field",15)(18,"mat-label",5),h(19,"rulenode.rule-node-description"),d(),x(20,"textarea",16),d()()()()}e&2&&(l("ngIf",!t.isAdd&&(t.ruleNode.component==null||t.ruleNode.component.configurationDescriptor==null||t.ruleNode.component.configurationDescriptor.nodeDefinition==null?null:t.ruleNode.component.configurationDescriptor.nodeDefinition.ruleChainNode)),a(),l("formGroup",t.ruleNodeFormGroup),a(6),l("ngIf",t.ruleNodeFormGroup.get("name").hasError("required")||t.ruleNodeFormGroup.get("name").hasError("pattern")),a(),l("ngIf",t.ruleNodeFormGroup.get("name").hasError("maxlength")),a(2),l("entityType",t.entityType.RULE_NODE),a(),l("ngIf",t.isSingleton()),a(),l("ruleNodeId",t.ruleNode.ruleNodeId==null?null:t.ruleNode.ruleNodeId.id)("ruleChainId",t.ruleChainId)("ruleChainType",t.ruleChainType)("nodeDefinition",t.ruleNode.component.configurationDescriptor.nodeDefinition),a(3),l("ngIf",t.isAddQueue()))},dependencies:[Y,Oi,we,ce,Se,Ie,Le,st,ge,Ne,Q,K,xe,Z,ee,lt,de,zi,Ki,J],styles:['@charset "UTF-8";[_nghost-%COMP%]   form[_ngcontent-%COMP%]{overflow-x:hidden!important}[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media screen and (min-width: 960px){[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]{flex-direction:row;gap:8px;align-items:center}[_nghost-%COMP%]   .title-row[_ngcontent-%COMP%]   .node-setting[_ngcontent-%COMP%]{margin-top:5px}}[_nghost-%COMP%]   .description-block[_ngcontent-%COMP%]{margin-top:22px}']})}};bt([xt(),Ct("design:type",Object)],Te.prototype,"disabled",void 0);bt([xt(),Ct("design:type",Object)],Te.prototype,"isAdd",void 0);re();var vn=["chipList"],yn=["labelAutocomplete"],_n=["labelInput"],Nn=o=>({label:o});function xn(o,m){o&1&&(r(0,"mat-icon",13),h(1,"close"),d())}function In(o,m){if(o&1){let e=T();r(0,"mat-chip-row",11),_("removed",function(){let i=v(e).$implicit,n=C();return y(n.remove(i))}),h(1),I(2,xn,2,0,"mat-icon",12),d()}if(o&2){let e=m.$implicit,t=C();l("removable",!t.disabled),a(),w(" ",e.name," "),a(),l("ngIf",!t.disabled)}}function Sn(o,m){if(o&1&&(r(0,"mat-option",14),x(1,"span",15),f(2,"highlight"),d()),o&2){let e=m.$implicit,t=C();l("value",e),a(),l("innerHTML",Pe(2,2,e.name,t.searchText),Fe)}}function Rn(o,m){o&1&&(r(0,"div")(1,"span",5),h(2,"rulenode.no-link-labels-found"),d()())}function Tn(o,m){if(o&1&&(r(0,"span"),h(1),f(2,"async"),d()),o&2){let e=C(2);a(),w(" ",g(2,1,e.translate.get("rulenode.no-link-label-matching",Je(3,Nn,e.truncate.transform(e.searchText,!0,6,"..."))))," ")}}function Mn(o,m){if(o&1){let e=T();r(0,"span")(1,"a",20),_("click",function(i){v(e);let n=C(2);return y(n.createLinkLabel(i,n.searchText))}),h(2,"rulenode.create-new-link-label"),d()()}}function En(o,m){if(o&1){let e=T();r(0,"mat-option",16)(1,"div",17),_("click",function(i){return v(e),y(i.stopPropagation())}),I(2,Rn,3,0,"div",18)(3,Tn,3,5,"ng-template",null,3,Gt)(5,Mn,3,0,"span",19),d()()}if(o&2){let e=j(4),t=C();l("value",null),a(2),l("ngIf",!t.textIsNotEmpty(t.searchText))("ngIfElse",e),a(3),l("ngIf",t.allowCustom)}}var Yi=(()=>{class o{get required(){return this.requiredValue}set required(e){this.requiredValue=he(e)}get allowCustom(){return this.allowCustomValue}set allowCustom(e){this.allowCustomValue=he(e),this.separatorKeysCodes=this.allowCustomValue?[13,188,186]:[]}constructor(e,t,i,n){this.fb=e,this.truncate=t,this.translate=i,this.ruleChainService=n,this.labelsList=[],this.separatorKeysCodes=[],this.labels=[],this.searchText="",this.propagateChange=s=>{},this.linksFormGroup=this.fb.group({label:[null]})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.filteredLabels=this.linksFormGroup.get("label").valueChanges.pipe(Qe(""),vt(e=>e||""),He(e=>this.fetchLabels(e)),kt())}ngOnChanges(e){let t=!1;for(let i of Object.keys(e)){let n=e[i];n.currentValue!==n.previousValue&&["allowCustom","allowedLabels","sourceRuleChainId"].includes(i)&&(t=!0)}t&&this.linksFormGroup.get("label").patchValue("",{emitEvent:!0})}setDisabledState(e){this.disabled=e,this.disabled?this.linksFormGroup.disable({emitEvent:!1}):this.linksFormGroup.enable({emitEvent:!1})}writeValue(e){this.searchText="",this.labelsList.length=0,this.labels.length=0,this.modelValue=e,this.prepareLabelsList().subscribe(t=>{this.labelsList=t,e&&e.forEach(i=>{this.allowedLabels[i]?this.labels.push(D(this.allowedLabels[i])):this.labels.push({name:i,value:i})}),this.chipList&&this.required&&(this.chipList.errorState=!this.labels.length),this.linksFormGroup.get("label").patchValue("",{emitEvent:!0})})}prepareLabelsList(){let e=[];if(this.sourceRuleChainId)return this.ruleChainService.getRuleChainOutputLabels(this.sourceRuleChainId,{ignoreErrors:!0}).pipe(vt(t=>{for(let i of t)e.push({name:i,value:i});return e}),ze(()=>X(e)));for(let t of Object.keys(this.allowedLabels))e.push({name:this.allowedLabels[t].name,value:this.allowedLabels[t].value});return X(e)}displayLabelFn(e){return e?e.name:void 0}textIsNotEmpty(e){return e&&e.length>0}createLinkLabel(e,t){e.preventDefault(),this.transformLinkLabel(t)}add(e){(!this.matAutocomplete.isOpen||this.allowCustom)&&this.transformLinkLabel(e.value)}fetchLabels(e){if(this.searchText=e,this.searchText&&this.searchText.length){let t=this.searchText.toUpperCase();return X(this.labelsList.filter(i=>i.name.toUpperCase().includes(t)))}else return X(this.labelsList)}transformLinkLabel(e){if((e||"").trim()){let t=null,i=e.trim(),n=this.labelsList.find(s=>s.name===i);n?t=D(n):this.allowCustom&&(t={name:i,value:i}),t&&this.addLabel(t)}this.clear("")}remove(e){let t=this.labels.indexOf(e);t>=0&&(this.labels.splice(t,1),this.labels.length||this.required&&(this.chipList.errorState=!0),this.updateModel())}selected(e){this.addLabel(e.option.value),this.clear("")}addLabel(e){this.labels.findIndex(i=>i.value===e.value)===-1&&(this.labels.push(e),this.required&&(this.chipList.errorState=!1),this.updateModel())}onFocus(){this.linksFormGroup.get("label").updateValueAndValidity({onlySelf:!0,emitEvent:!0})}clear(e=""){this.labelInput.nativeElement.value=e,this.linksFormGroup.get("label").patchValue(null,{emitEvent:!0}),setTimeout(()=>{this.labelInput.nativeElement.blur(),this.labelInput.nativeElement.focus()},0)}updateModel(){let e=this.labels.map(t=>t.value);this.propagateChange(e)}static{this.\u0275fac=function(t){return new(t||o)(b(te),b(ct),b(De),b(Re))}}static{this.\u0275cmp=q({type:o,selectors:[["tb-link-labels"]],viewQuery:function(t,i){if(t&1&&(V(vn,5),V(yn,5),V(_n,5)),t&2){let n;F(n=P())&&(i.chipList=n.first),F(n=P())&&(i.matAutocomplete=n.first),F(n=P())&&(i.labelInput=n.first)}},inputs:{required:"required",disabled:"disabled",allowCustom:"allowCustom",allowedLabels:"allowedLabels",sourceRuleChainId:"sourceRuleChainId"},features:[ae([{provide:ke,useExisting:Ee(()=>o),multi:!0}]),Ke],decls:16,vars:16,consts:[["chipList",""],["labelInput","","origin","matAutocompleteOrigin"],["labelAutocomplete","matAutocomplete"],["searchNotEmpty",""],[2,"width","100%",3,"formGroup"],["translate",""],[3,"removable","removed",4,"ngFor","ngForOf"],["matInput","","type","text","formControlName","label","matAutocompleteOrigin","",2,"max-width","200px",3,"focusin","matChipInputTokenEnd","placeholder","matAutocompleteConnectedTo","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes"],[1,"tb-autocomplete",3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],["class","tb-not-found",3,"value",4,"ngIf"],[3,"removed","removable"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"value"],[3,"innerHTML"],[1,"tb-not-found",3,"value"],[1,"tb-not-found-content",3,"click"],[4,"ngIf","ngIfElse"],[4,"ngIf"],["translate","",3,"click"]],template:function(t,i){if(t&1){let n=T();r(0,"mat-form-field",4)(1,"mat-label",5),h(2,"rulenode.link-labels"),d(),r(3,"mat-chip-grid",null,0),I(5,In,3,3,"mat-chip-row",6),r(6,"input",7,1),f(9,"translate"),_("focusin",function(){return v(n),y(i.onFocus())})("matChipInputTokenEnd",function(p){return v(n),y(i.add(p))}),d()(),r(10,"mat-autocomplete",8,2),_("optionSelected",function(p){return v(n),y(i.selected(p))}),I(12,Sn,3,5,"mat-option",9),f(13,"async"),I(14,En,6,4,"mat-option",10),f(15,"async"),d()()}if(t&2){let n,s=j(4),p=j(8),u=j(11);l("formGroup",i.linksFormGroup),a(5),l("ngForOf",i.labels),a(),M("placeholder",i.disabled?"":g(9,10,"rulenode.link-label")),l("matAutocompleteConnectedTo",p)("matAutocomplete",u)("matChipInputFor",s)("matChipInputSeparatorKeyCodes",i.separatorKeysCodes),a(4),l("displayWith",i.displayLabelFn),a(2),l("ngForOf",g(13,12,i.filteredLabels)),a(2),l("ngIf",((n=g(15,14,i.filteredLabels))==null?null:n.length)===0)}},dependencies:[Ze,Y,ce,Se,Ie,Le,Qt,si,ui,di,mi,hi,ci,pi,Ne,Q,K,Z,ee,de,ye,Ti,J],encapsulation:2})}}return o})();re();var Rt=(()=>{class o{get required(){return this.requiredValue}set required(e){this.requiredValue=he(e)}get allowCustom(){return this.allowCustomValue}set allowCustom(e){this.allowCustomValue=he(e)}constructor(e,t,i){this.fb=e,this.truncate=t,this.translate=i,this.propagateChange=n=>{},this.ruleNodeLinkFormGroup=this.fb.group({labels:[[],U.required]}),this.ruleNodeLinkFormGroup.get("labels").valueChanges.pipe(Ht()).subscribe(n=>this.updateModel(n))}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){}setDisabledState(e){this.disabled=e,this.disabled?this.ruleNodeLinkFormGroup.disable({emitEvent:!1}):this.ruleNodeLinkFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e;let t=this.modelValue&&this.modelValue.labels?this.modelValue.labels:[];this.ruleNodeLinkFormGroup.get("labels").patchValue(t,{emitEvent:!1})}updateModel(e){e&&e.length?(this.modelValue.labels=e,this.modelValue.label=e.join(" / "),this.propagateChange(this.modelValue)):this.propagateChange(this.required?null:this.modelValue)}static{this.\u0275fac=function(t){return new(t||o)(b(te),b(ct),b(De))}}static{this.\u0275cmp=q({type:o,selectors:[["tb-rule-node-link"]],inputs:{required:"required",disabled:"disabled",allowCustom:"allowCustom",allowedLabels:"allowedLabels",sourceRuleChainId:"sourceRuleChainId"},features:[ae([{provide:ke,useExisting:Ee(()=>o),multi:!0}])],decls:3,vars:4,consts:[[1,"mat-padding","flex","flex-col"],[3,"formGroup"],["required","","formControlName","labels",3,"allowedLabels","allowCustom","sourceRuleChainId"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"form",1),x(2,"tb-link-labels",2),d()()),t&2&&(a(),l("formGroup",i.ruleNodeLinkFormGroup),a(),l("allowedLabels",i.allowedLabels)("allowCustom",i.allowCustom)("sourceRuleChainId",i.sourceRuleChainId))},dependencies:[ge,Q,K,xe,Z,ee,Yi],encapsulation:2})}}return o})();re();var kn=["ruleChainCanvas"],Ln=["ruleChainMenuTrigger"],Vn=["drawer"],Ji=["tbRuleNode"],Fn=["tbRuleNodeLink"],Pn=["ruleNodeTypeExpansionPanels"],Bn=o=>[o];function On(o,m){if(o&1){let e=T();r(0,"tb-rule-chain-select",38),Ye("ngModelChange",function(i){v(e);let n=C();return Xe(n.ruleChain,i)||(n.ruleChain=i),y(i)}),_("ngModelChange",function(){v(e);let i=C();return y(i.currentRuleChainIdChanged(i.ruleChain.id==null?null:i.ruleChain.id.id))}),d()}if(o&2){let e=C();l("ruleChainType",e.ruleChainType)("disabled",e.isDirtyValue),We("ngModel",e.ruleChain)}}function An(o,m){if(o&1){let e=T();r(0,"mat-expansion-panel",39,5)(2,"mat-expansion-panel-header",40),_("mouseenter",function(i){let n=v(e).$implicit,s=C();return y(s.typeHeaderMouseEnter(i,n))})("mouseleave",function(){v(e);let i=C();return y(i.destroyTooltips())}),r(3,"mat-panel-title")(4,"mat-icon"),h(5),d(),r(6,"div",41),h(7),d()()(),x(8,"fc-canvas",42),d()}if(o&2){let e=m.$implicit,t=C();l("expanded",!0),a(5),z(t.ruleNodeTypeDescriptorsMap.get(e).icon),a(2),z(t.ruleNodeTypeDescriptorsMap.get(e).name),a(),At("id","tb-rulchain-",e,""),l("model",t.ruleNodeTypesModel[e].model)("selectedObjects",t.ruleNodeTypesModel[e].selectedObjects)("automaticResize",!1)("userCallbacks",t.nodeLibCallbacks)("nodeWidth",170)("nodeHeight",50)("dropTargetId","tb-rulchain-canvas")}}function Gn(o,m){if(o&1){let e=T();r(0,"mat-tab",47,7),f(2,"translate"),r(3,"tb-event-table",55),_("debugEventSelected",function(i){v(e);let n=C(2);return y(n.onDebugEventSelected(i))}),d()()}if(o&2){let e=j(1),t=C(2);M("label",g(2,7,"rulenode.events")),a(3),l("debugEventTypes",Je(9,Bn,t.debugEventTypes.DEBUG_RULE_NODE))("defaultEventType",t.debugEventTypes.DEBUG_RULE_NODE)("active",e.isActive)("tenantId",t.ruleChain.tenantId.id)("entityId",t.editingRuleNode.ruleNodeId)("functionTestButtonLabel",t.ruleNodeTestButtonLabel)}}function jn(o,m){if(o&1){let e=T();r(0,"tb-details-panel",43),f(1,"translate"),_("closeDetails",function(){v(e);let i=C();return y(i.onEditRuleNodeClosed())})("toggleDetailsEditMode",function(){v(e);let i=C();return y(i.onRevertRuleNodeEdit())})("applyDetails",function(){v(e);let i=C();return y(i.saveRuleNode())}),r(2,"div",44),x(3,"div",45),d(),r(4,"mat-tab-group",46),Ye("selectedIndexChange",function(i){v(e);let n=C();return Xe(n.selectedRuleNodeTabIndex,i)||(n.selectedRuleNodeTabIndex=i),y(i)}),r(5,"mat-tab",47),f(6,"translate"),r(7,"tb-rule-node",48,6),_("initRuleNode",function(){v(e);let i=C();return y(i.onRuleNodeInit())})("changeScript",function(){v(e);let i=C();return y(i.switchToFirstTab())}),d()(),I(9,Gn,4,11,"mat-tab",49),r(10,"mat-tab",47),f(11,"translate"),r(12,"div",50)(13,"div",51)(14,"div",52),h(15),d(),r(16,"div"),h(17,"\xA0"),d(),x(18,"div",53),f(19,"safe"),r(20,"div"),h(21,"\xA0"),d(),x(22,"div",54),f(23,"safe"),d()()()()()}if(o&2){let e=j(8),t=C();M("headerTitle",t.editingRuleNode.name),M("headerSubtitle",g(1,16,t.ruleNodeTypeDescriptorsMap.get(t.editingRuleNode.component.type).name)+" - "+t.editingRuleNode.component.name),l("isReadOnly",t.selectedRuleNodeTabIndex>0)("isAlwaysEdit",!0)("theForm",e.ruleNodeFormGroup),a(3),l("tb-help",t.helpLinkIdForRuleNodeType()),a(),We("selectedIndex",t.selectedRuleNodeTabIndex),a(),M("label",g(6,18,"rulenode.details")),a(2),l("ruleNode",t.editingRuleNode)("ruleChainId",t.ruleChain.id==null?null:t.ruleChain.id.id)("ruleChainType",t.ruleChainType),a(2),l("ngIf",t.editingRuleNode.ruleNodeId),a(),M("label",g(11,20,"rulenode.help")),a(5),z(t.editingRuleNode.component.name),a(3),l("innerHtml",Pe(19,22,t.editingRuleNode.component.configurationDescriptor.nodeDefinition.description,"html"),Fe),a(4),l("innerHtml",Pe(23,25,t.editingRuleNode.component.configurationDescriptor.nodeDefinition.details,"html"),Fe)}}function qn(o,m){if(o&1){let e=T();r(0,"tb-details-panel",43),f(1,"translate"),_("closeDetails",function(){v(e);let i=C();return y(i.onEditRuleNodeLinkClosed())})("toggleDetailsEditMode",function(){v(e);let i=C();return y(i.onRevertRuleNodeLinkEdit())})("applyDetails",function(){v(e);let i=C();return y(i.saveRuleNodeLink())}),r(2,"div",44),x(3,"div",45),d(),r(4,"tb-rule-node-link",56,8),Ye("ngModelChange",function(i){v(e);let n=C();return Xe(n.editingRuleNodeLink,i)||(n.editingRuleNodeLink=i),y(i)}),d()()}if(o&2){let e=j(5),t=C();M("headerTitle",t.editingRuleNodeLink.label),M("headerSubtitle",g(1,10,"rulenode.link-details")),l("isReadOnly",!1)("isAlwaysEdit",!0)("theForm",e.ruleNodeLinkFormGroup),a(3),l("tb-help","ruleEngine"),a(),We("ngModel",t.editingRuleNodeLink),l("allowedLabels",t.editingRuleNodeLinkLabels)("allowCustom",t.editingRuleNodeAllowCustomLabels)("sourceRuleChainId",t.editingRuleNodeSourceRuleChainId)}}function Un(o,m){if(o&1){let e=T();r(0,"button",57,9),f(2,"translate"),_("click",function(i){v(e);let n=j(1),s=C();return y(s.toggleVersionControl(i,n))}),r(3,"mat-icon"),h(4,"history"),d()()}o&2&&M("matTooltip",g(2,1,"version-control.version-control"))}function Hn(o,m){if(o&1&&(r(0,"mat-icon"),h(1),d()),o&2){let e=C().contextInfo;a(),z(e.icon)}}function zn(o,m){if(o&1&&x(0,"img",65),o&2){let e=C().contextInfo;l("src",e.iconUrl,Ft)}}function Qn(o,m){o&1&&x(0,"mat-divider")}function Kn(o,m){if(o&1&&(r(0,"span",70),h(1),f(2,"keyboardShortcut"),d()),o&2){let e=C(2).$implicit;a(),w(" ",g(2,1,e.shortcut),"")}}function $n(o,m){if(o&1&&(r(0,"mat-icon"),h(1),d()),o&2){let e=C(2).$implicit;a(),z(e.icon)}}function Wn(o,m){if(o&1){let e=T();r(0,"button",67),_("click",function(){v(e);let i=C().$implicit,n=C(2);return y(i.action(n.contextMenuEvent))}),I(1,Kn,3,3,"span",68)(2,$n,2,1,"mat-icon",59),r(3,"span",69),h(4),d()()}if(o&2){let e=C().$implicit;l("disabled",!e.enabled),a(),l("ngIf",e.shortcut),a(),l("ngIf",e.icon),a(2),z(e.value)}}function Xn(o,m){if(o&1&&(r(0,"div"),I(1,Qn,1,0,"mat-divider",59)(2,Wn,5,4,"button",66),d()),o&2){let e=m.$implicit;a(),l("ngIf",e.divider),a(),l("ngIf",!e.divider)}}function Yn(o,m){if(o&1){let e=T();r(0,"div",58),_("mouseleave",function(){v(e);let i=C();return y(i.onRuleChainContextMenuMouseLeave())}),r(1,"div"),I(2,Hn,2,1,"mat-icon",59)(3,zn,1,1,"img",60),r(4,"div",61)(5,"div",62),h(6),d(),r(7,"div",63),h(8),d()()(),I(9,Xn,3,2,"div",64),d()}if(o&2){let e=m.contextInfo;a(),Bt("tb-context-menu-header ",e.headerClass,""),a(),l("ngIf",!e.iconUrl),a(),l("ngIf",e.iconUrl),a(3),z(e.title),a(2),z(e.subtitle),a(),l("ngForOf",e.menuItems)}}function Jn(o,m){o&1&&x(0,"mat-progress-bar",14)}function Zn(o,m){o&1&&x(0,"mat-progress-bar",14)}function eo(o,m){o&1&&x(0,"mat-progress-bar",19)}function to(o,m){o&1&&(r(0,"mat-error"),h(1),f(2,"translate"),d()),o&2&&(a(),w(" ",g(2,1,"rulechain.name-required")," "))}function io(o,m){o&1&&(r(0,"mat-error"),h(1),f(2,"translate"),d()),o&2&&(a(),w(" ",g(2,1,"rulechain.name-max-length")," "))}var Aa=(()=>{class o extends et{get isDirty(){return this.isDirtyValue||this.isImport}set isDirty(e){this.isDirtyValue=e}constructor(e,t,i,n,s,p,u,N,E,B,A,ie,k,pe){super(e),this.store=e,this.route=t,this.router=i,this.ruleChainService=n,this.authService=s,this.translate=p,this.itembuffer=u,this.popoverService=N,this.renderer=E,this.viewContainerRef=B,this.changeDetector=A,this.dialog=ie,this.dialogService=k,this.fb=pe,this.width="100%",this.height="100%",this.eventTypes=ji,this.debugEventTypes=qi,this.ruleChainMenuPosition={x:"0px",y:"0px"},this.ruleNodeTypeDescriptorsMap=W,this.ruleNodeTypesLibraryArray=Ge,this.isInvalid=!1,this.errorTooltips={},this.isFullscreen=!1,this.selectedRuleNodeTabIndex=0,this.editingRuleNode=null,this.isEditingRuleNode=!1,this.editingRuleNodeIndex=-1,this.editingRuleNodeAllowCustomLabels=!1,this.editingRuleNodeLink=null,this.isEditingRuleNodeLink=!1,this.editingRuleNodeLinkIndex=-1,this.hotKeys=[],this.enableHotKeys=!0,this.ruleNodeSearch="",this.ruleNodeTypeSearch=this.fb.control("",{nonNullable:!0}),this.ruleChainModel={nodes:[],edges:[]},this.selectedObjects=[],this.editCallbacks={edgeDoubleClick:(le,c)=>{this.openLinkDetails(c)},edgeEdit:(le,c)=>{this.openLinkDetails(c)},nodeCallbacks:{doubleClick:(le,c)=>{this.openNodeDetails(c)},nodeEdit:(le,c)=>{this.openNodeDetails(c)},mouseEnter:this.displayNodeDescriptionTooltip.bind(this),mouseLeave:this.destroyTooltips.bind(this),mouseDown:this.destroyTooltips.bind(this)},isValidEdge:(le,c)=>le.type===R.rightConnectorType&&c.type===R.leftConnectorType,createEdge:(le,c)=>{let S=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(c.source);if(S.component.type===O.INPUT){let G=this.ruleChainModel.edges.find(L=>L.source===this.inputConnectorId+"");return G&&this.ruleChainCanvas.modelService.edges.delete(G),X(c)}else{if(c.label)return c.labels||(c.labels=c.label.split(" / ")),X(c);{let G=this.ruleChainService.getRuleNodeSupportedLinks(S.component),L=this.ruleChainService.ruleNodeAllowCustomLinks(S.component),H=this.ruleChainService.ruleNodeSourceRuleChainId(S.component,S.configuration);return this.enableHotKeys=!1,this.addRuleNodeLink(c,G,L,H).pipe(Vt(()=>{this.enableHotKeys=!0}),He(ne=>ne?X(ne):Et))}}},dropNode:(le,c)=>{this.addRuleNode(c)}},this.ruleNodeTypesModel={},this.nodeLibCallbacks={nodeCallbacks:{mouseEnter:this.displayLibNodeDescriptionTooltip.bind(this),mouseLeave:this.destroyTooltips.bind(this),mouseDown:this.destroyTooltips.bind(this)}},this.flowchartConstants=R,this.updateBreadcrumbs=new me,this.destroy$=new Ue,this.route.data.pipe(Me(this.destroy$)).subscribe(()=>{this.reset(),this.init()})}ngOnInit(){this.ruleNodeTypeSearch.valueChanges.pipe(Dt(150),Qe(""),wt((e,t)=>e.trim()===t.trim()),Lt(1),Me(this.destroy$)).subscribe(()=>this.updateRuleChainLibrary())}ngAfterViewChecked(){this.changeDetector.detectChanges()}ngAfterViewInit(){this.ruleChainCanvas.adjustCanvasSize(!0)}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}currentRuleChainIdChanged(e){this.ruleChainType===je.CORE?this.router.navigateByUrl(`ruleChains/${e}`):this.router.navigateByUrl(`edgeManagement/ruleChains/${e}`)}onSearchTextUpdated(e){this.ruleNodeSearch=e,this.updateRuleNodesHighlight()}init(){if(this.initHotKeys(),this.isImport=this.route.snapshot.data.import,this.ruleChainType=this.route.snapshot.data.ruleChainType,this.isImport){let e=this.itembuffer.getRuleChainImport();this.ruleChain=e.ruleChain,this.ruleChainMetaData=e.metadata}else this.ruleChain=this.route.snapshot.data.ruleChain,this.ruleChainMetaData=this.route.snapshot.data.ruleChainMetaData;this.ruleNodeComponents=this.route.snapshot.data.ruleNodeComponents;for(let e of Ge)W.get(e).special||(this.ruleNodeTypesModel[e]={model:{nodes:[],edges:[]},selectedObjects:[]});this.updateRuleChainLibrary(),this.createRuleChainModel()}reset(){this.selectedObjects=[],this.ruleChainModel.nodes=[],this.ruleChainModel.edges=[],this.ruleNodeTypesModel={},this.ruleChainCanvas&&this.ruleChainCanvas.adjustCanvasSize(!0),this.isEditingRuleNode=!1,this.isEditingRuleNodeLink=!1,this.updateRuleNodesHighlight()}initHotKeys(){this.hotKeys.length||(this.hotKeys.push(new ue(["ctrl+a","meta+a"],e=>this.enableHotKeys?(e.preventDefault(),this.ruleChainCanvas.modelService.selectAll(),!1):!0,[],this.translate.instant("rulenode.select-all-objects"))),this.hotKeys.push(new ue(["ctrl+c","meta+c"],e=>this.enableHotKeys?(e.preventDefault(),this.copyRuleNodes(),!1):!0,[],this.translate.instant("rulenode.copy-selected"))),this.hotKeys.push(new ue(["ctrl+v","meta+v"],e=>this.enableHotKeys?(e.preventDefault(),this.itembuffer.hasRuleNodes()&&this.pasteRuleNodes(),!1):!0,[],this.translate.instant("action.paste"))),this.hotKeys.push(new ue("esc",e=>this.enableHotKeys?(e.preventDefault(),e.stopPropagation(),this.ruleChainCanvas.modelService.deselectAll(),!1):!0,["INPUT","SELECT","TEXTAREA"],this.translate.instant("rulenode.deselect-all-objects"))),this.hotKeys.push(new ue(["ctrl+s","meta+s"],e=>this.enableHotKeys?(e.preventDefault(),this.saveRuleChain(),!1):!0,["INPUT","SELECT","TEXTAREA"],this.translate.instant("action.apply"))),this.hotKeys.push(new ue(["ctrl+z","meta+z"],e=>this.enableHotKeys?(e.preventDefault(),this.revertRuleChain(),!1):!0,["INPUT","SELECT","TEXTAREA"],this.translate.instant("action.decline-changes"))),this.hotKeys.push(new ue("del",e=>this.enableHotKeys?(e.preventDefault(),this.ruleChainCanvas.modelService.deleteSelected(),!1):!0,[],this.translate.instant("rulenode.delete-selected-objects"))),this.hotKeys.push(new ue(["ctrl+r","meta+r"],e=>this.enableHotKeys&&this.canCreateNestedRuleChain()?(e.preventDefault(),this.createNestedRuleChain(),!1):!0,["INPUT","SELECT","TEXTAREA"],this.translate.instant("rulenode.create-nested-rulechain"))))}updateRuleChainLibrary(){let e=this.ruleNodeTypeSearch.value.trim().toUpperCase(),t=this.ruleNodeComponents.filter(i=>i.name.toUpperCase().includes(e));this.loadRuleChainLibrary(t)}loadRuleChainLibrary(e){for(let t of Object.keys(this.ruleNodeTypesModel))this.ruleNodeTypesModel[t].model.nodes.length=0;if(e.forEach(t=>{let i=t.type,n=this.ruleNodeTypesModel[i].model,s=W.get(O[i]),p=s.icon,u=null;t.configurationDescriptor.nodeDefinition.icon&&(p=t.configurationDescriptor.nodeDefinition.icon),t.configurationDescriptor.nodeDefinition.iconUrl&&(u=t.configurationDescriptor.nodeDefinition.iconUrl);let N={id:"node-lib-"+i+"-"+n.nodes.length,component:t,name:"",nodeClass:s.nodeClass,singletonMode:t.clusteringMode!==Ve.ENABLED,icon:p,iconUrl:u,x:30,y:10+50*n.nodes.length,connectors:[]};t.configurationDescriptor.nodeDefinition.inEnabled&&N.connectors.push({type:R.leftConnectorType,id:n.nodes.length*2+""}),t.configurationDescriptor.nodeDefinition.outEnabled&&N.connectors.push({type:R.rightConnectorType,id:n.nodes.length*2+1+""}),n.nodes.push(N)}),this.expansionPanels)for(let t=0;t<Ge.length;t++){let i=this.expansionPanels.find((n,s)=>s===t);if(i){let n=Ge[t];this.ruleNodeTypesModel[n].model.nodes.length?i.open():i.close()}}}createRuleChainModel(){this.nextNodeID=1,this.nextConnectorID=1,this.selectedObjects=[],this.ruleChainModel.nodes=[],this.ruleChainModel.edges=[],this.inputConnectorId=this.nextConnectorID++,this.ruleChainModel.nodes.push({id:"rule-chain-node-"+this.nextNodeID++,component:ki,name:"",nodeClass:W.get(O.INPUT).nodeClass,icon:W.get(O.INPUT).icon,readonly:!0,x:50,y:150,connectors:[{type:R.rightConnectorType,id:this.inputConnectorId+""}]});let e=[];if(this.ruleChainMetaData.nodes.forEach(t=>{let i=this.ruleChainService.getRuleNodeComponentByClazz(this.ruleChainType,t.type),n=W.get(i.type),s=n.icon,p=null;i.configurationDescriptor.nodeDefinition.icon&&(s=i.configurationDescriptor.nodeDefinition.icon),i.configurationDescriptor.nodeDefinition.iconUrl&&(p=i.configurationDescriptor.nodeDefinition.iconUrl);let u={id:"rule-chain-node-"+this.nextNodeID++,ruleNodeId:t.id,additionalInfo:t.additionalInfo,configuration:t.configuration,configurationVersion:_t(t.configurationVersion)?t.configurationVersion:0,debugSettings:t.debugSettings,singletonMode:t.singletonMode,queueName:t.queueName,x:Math.round(t.additionalInfo.layoutX),y:Math.round(t.additionalInfo.layoutY),component:i,name:t.name,nodeClass:n.nodeClass,icon:s,iconUrl:p,connectors:[],ruleChainType:this.ruleChainType};i.configurationDescriptor.nodeDefinition.inEnabled&&u.connectors.push({type:R.leftConnectorType,id:this.nextConnectorID+++""}),i.configurationDescriptor.nodeDefinition.outEnabled&&u.connectors.push({type:R.rightConnectorType,id:this.nextConnectorID+++""}),e.push(u),this.ruleChainModel.nodes.push(u)}),this.ruleChainMetaData.firstNodeIndex>-1){let t=e[this.ruleChainMetaData.firstNodeIndex];if(t){let i=t.connectors.filter(n=>n.type===R.leftConnectorType);if(i&&i.length){let n={source:this.inputConnectorId+"",destination:i[0].id};this.ruleChainModel.edges.push(n)}}}if(this.ruleChainMetaData.connections){let t={};this.ruleChainMetaData.connections.forEach(i=>{let n=e[i.fromIndex],s=e[i.toIndex];if(n&&s){let p=n.connectors.filter(N=>N.type===R.rightConnectorType),u=s.connectors.filter(N=>N.type===R.leftConnectorType);if(p&&p.length&&u&&u.length){let N=p[0].id,E=u[0].id,B=N+"_"+E,A=t[B];A?(A.label+=" / "+i.type,A.labels.push(i.type)):(A={source:N,destination:E,label:i.type,labels:[i.type]},t[B]=A,this.ruleChainModel.edges.push(A))}}})}this.ruleChainCanvas&&this.ruleChainCanvas.adjustCanvasSize(!0),this.isDirtyValue=!1,this.updateRuleNodesHighlight(),this.validate()}openRuleChainContextMenu(e){if(this.ruleChainCanvas.modelService&&!e.ctrlKey&&!e.metaKey){let t=e.clientX,i=e.clientY,n=this.ruleChainCanvas.modelService.getItemInfoAtPoint(t,i),s=this.prepareContextMenu(n);s.menuItems&&s.menuItems.length>0&&(e.preventDefault(),e.stopPropagation(),this.contextMenuEvent=e,this.ruleChainMenuPosition.x=t+"px",this.ruleChainMenuPosition.y=i+"px",this.ruleChainMenuTrigger.menuData={contextInfo:s},this.ruleChainMenuTrigger.openMenu())}}onRuleChainContextMenuMouseLeave(){this.ruleChainMenuTrigger.closeMenu()}prepareContextMenu(e){if(this.objectsSelected()||!e.node&&!e.edge)return this.prepareRuleChainContextMenu();if(e.node)return this.prepareRuleNodeContextMenu(e.node);if(e.edge)return this.prepareEdgeContextMenu(e.edge)}prepareRuleChainContextMenu(){let e={headerClass:"tb-rulechain-header",icon:"settings_ethernet",title:this.ruleChain.name,subtitle:this.translate.instant("rulechain.rulechain"),menuItems:[]};return this.ruleChainCanvas.modelService.nodes.getSelectedNodes().length&&e.menuItems.push({action:()=>{this.copyRuleNodes()},enabled:!0,value:"rulenode.copy-selected",icon:"content_copy",shortcut:"M-C"}),e.menuItems.push({action:t=>{this.pasteRuleNodes(t)},enabled:this.itembuffer.hasRuleNodes(),value:"action.paste",icon:"content_paste",shortcut:"M-V"}),e.menuItems.push({divider:!0}),this.objectsSelected()?(e.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.deselectAll()},enabled:!0,value:"rulenode.deselect-all",icon:"tab_unselected",shortcut:"Esc"}),this.canCreateNestedRuleChain()&&e.menuItems.push({action:()=>{this.createNestedRuleChain()},enabled:!0,value:"rulenode.create-nested-rulechain",icon:"settings_ethernet",shortcut:"M-R"}),e.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.deleteSelected()},enabled:!0,value:"rulenode.delete-selected",icon:"clear",shortcut:"Del"})):e.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.selectAll()},enabled:!0,value:"rulenode.select-all",icon:"select_all",shortcut:"M-A"}),e.menuItems.push({divider:!0}),e.menuItems.push({action:()=>{this.saveRuleChain()},enabled:!(this.isInvalid||!this.isDirty&&!this.isImport),value:"action.apply-changes",icon:"done",shortcut:"M-S"}),e.menuItems.push({action:()=>{this.revertRuleChain()},enabled:this.isDirty,value:"action.decline-changes",icon:"close",shortcut:"M-Z"}),e}prepareRuleNodeContextMenu(e){let t={headerClass:e.nodeClass,icon:e.icon,iconUrl:e.iconUrl,title:e.name,subtitle:e.component.name,menuItems:[]};return e.readonly||(t.menuItems.push({action:()=>{this.openNodeDetails(e)},enabled:!0,value:"rulenode.details",icon:"menu"}),t.menuItems.push({action:()=>{this.copyNode(e)},enabled:!0,value:"action.copy",icon:"content_copy"}),t.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.nodes.delete(e)},enabled:!0,value:"action.delete",icon:"clear",shortcut:"M-X"})),t}prepareEdgeContextMenu(e){let t={headerClass:"tb-link-header",icon:"trending_flat",title:e.label,subtitle:this.translate.instant("rulenode.link"),menuItems:[]};return this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(e.source).component.type!==O.INPUT&&t.menuItems.push({action:()=>{this.openLinkDetails(e)},enabled:!0,value:"rulenode.details",icon:"menu"}),t.menuItems.push({action:()=>{this.ruleChainCanvas.modelService.edges.delete(e)},enabled:!0,value:"action.delete",icon:"clear",shortcut:"M-X"}),t}canCreateNestedRuleChain(){let e=this.ruleChainCanvas.modelService.nodes.getSelectedNodes(),t=this.ruleChainCanvas.modelService.edges.getSelectedEdges();if(e.length>1){let i=new Set;return t.forEach(s=>{let p=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(s.source),u=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(s.destination),N=e.indexOf(p),E=e.indexOf(u);N>-1&&E>-1&&i.add(E)}),e.filter((s,p)=>!i.has(p)).filter(s=>s.component.configurationDescriptor.nodeDefinition.inEnabled).length<=1}return!1}createNestedRuleChain(){let e=this.ruleChainCanvas.modelService.nodes.getSelectedNodes(),t=this.ruleChainCanvas.modelService.edges.getSelectedEdges();this.dialog.open(ro,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{ruleChainType:this.ruleChainType}}).afterClosed().subscribe(i=>{if(i){this.ruleChainCanvas.modelService.deselectAll();let n={ruleChainId:i.id,nodes:[],connections:[]},s=[],p=null,u=0,N=null,E=0;e.forEach(c=>{let S={type:c.component.clazz,name:c.name,configuration:D(c.configuration),additionalInfo:c.additionalInfo?D(c.additionalInfo):{},debugSettings:c.debugSettings,singletonMode:c.singletonMode,queueName:c.queueName};p===null?p=c.x:p=Math.min(p,c.x),N===null?N=c.y:N=Math.min(N,c.y),u=Math.max(u,c.x),E=Math.max(E,c.y),S.additionalInfo.layoutX=Math.round(c.x),S.additionalInfo.layoutY=Math.round(c.y),n.nodes.push(S),this.ruleChainCanvas.modelService.nodes.getConnectorsByType(c,R.rightConnectorType).forEach(L=>{let ne=this.ruleChainCanvas.modelService.model.edges.filter(oe=>oe.source===L.id).filter(oe=>{let se=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(oe.destination);return e.indexOf(se)===-1});s=s.concat(ne)})});let B=new Set;t.forEach(c=>{let S=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(c.source),G=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(c.destination);if(S.component.type!==O.INPUT){let L=e.indexOf(S),H=e.indexOf(G);if(L>-1&&H>-1){let ne={fromIndex:L,toIndex:H};c.labels.forEach(oe=>{let se=D(ne);se.type=oe,n.connections.push(se)}),B.add(H)}}});let ie=e.filter((c,S)=>!B.has(S)).filter(c=>c.component.configurationDescriptor.nodeDefinition.inEnabled),k=[];if(ie.length){let c=ie[0],S=this.ruleChainCanvas.modelService.nodes.getConnectorsByType(c,R.leftConnectorType);if(S.length){let G=S[0],L=this.ruleChainCanvas.modelService.model.edges.filter(H=>H.destination===G.id);k=k.concat(L)}n.firstNodeIndex=e.indexOf(c)}s.forEach(c=>{let S=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(c.source),G=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(c.destination),L={type:wi,name:c.label,configuration:{},additionalInfo:{},singletonMode:!1};L.additionalInfo.layoutX=Math.round(G.x),L.additionalInfo.layoutY=Math.round(G.y),n.nodes.push(L);let H=e.indexOf(S),ne=n.nodes.length-1,oe={fromIndex:H,toIndex:ne};c.labels.forEach(se=>{let qe=D(oe);qe.type=se,n.connections.push(qe)})});let pe=Math.round(p-375),le=Math.round(N-150);n.nodes.forEach(c=>{c.additionalInfo.layoutX-=pe,c.additionalInfo.layoutY-=le}),this.ruleChainService.saveRuleChainMetadata(n).subscribe(()=>{let c=this.ruleChainService.getRuleNodeComponentByClazz(this.ruleChainType,Di),S=W.get(c.type),G=S.icon,L=null;c.configurationDescriptor.nodeDefinition.icon&&(G=c.configurationDescriptor.nodeDefinition.icon),c.configurationDescriptor.nodeDefinition.iconUrl&&(L=c.configurationDescriptor.nodeDefinition.iconUrl);let H=(p+u)/2,ne=(N+E)/2,oe=this.nextConnectorID+++"",se=this.nextConnectorID+++"",qe={name:i.name,component:c,id:"rule-chain-node-"+this.nextNodeID++,configuration:{ruleChainId:i.id.id},singletonMode:!1,x:Math.round(H),y:Math.round(ne),nodeClass:S.nodeClass,icon:G,iconUrl:L,ruleChainType:this.ruleChainType,connectors:[{type:R.leftConnectorType,id:oe},{type:R.rightConnectorType,id:se}]};this.ruleChainModel.nodes.push(qe),k.forEach(be=>{be.destination=oe}),s.forEach(be=>{be.source=se,be.labels=[be.label]}),e.forEach(be=>{this.ruleChainCanvas.modelService.nodes.delete(be)}),this.onModelChanged(),this.updateRuleNodesHighlight()})}})}onModelChanged(){this.isDirtyValue=!0,this.validate()}helpLinkIdForRuleNodeType(){let e=null;return this.editingRuleNode&&(e=this.editingRuleNode.component),It(e)}openNodeDetails(e){e.component.type!==O.INPUT&&(this.enableHotKeys=!1,this.updateErrorTooltips(!0),this.isEditingRuleNodeLink=!1,this.editingRuleNodeLink=null,this.isEditingRuleNode=!0,this.editingRuleNodeIndex=this.ruleChainModel.nodes.indexOf(e),this.editingRuleNode=D(e,["component"]),setTimeout(()=>{this.ruleNodeComponent.ruleNodeFormGroup.markAsPristine()},0))}openLinkDetails(e){let t=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(e.source);t.component.type!==O.INPUT&&(this.enableHotKeys=!1,this.updateErrorTooltips(!0),this.isEditingRuleNode=!1,this.editingRuleNode=null,this.editingRuleNodeLinkLabels=this.ruleChainService.getRuleNodeSupportedLinks(t.component),this.editingRuleNodeAllowCustomLabels=this.ruleChainService.ruleNodeAllowCustomLinks(t.component),this.editingRuleNodeSourceRuleChainId=this.ruleChainService.ruleNodeSourceRuleChainId(t.component,t.configuration),this.isEditingRuleNodeLink=!0,this.editingRuleNodeLinkIndex=this.ruleChainModel.edges.indexOf(e),this.editingRuleNodeLink=D(e),setTimeout(()=>{this.ruleNodeLinkComponent.ruleNodeLinkFormGroup.markAsPristine()},0))}copyNode(e){this.itembuffer.copyRuleNodes([e],[])}copyRuleNodes(){let e=this.ruleChainCanvas.modelService.nodes.getSelectedNodes(),t=this.ruleChainCanvas.modelService.edges.getSelectedEdges(),i=[];t.forEach(n=>{let s=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(n.source),p=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(n.destination),u=s.component.type===O.INPUT,N=e.indexOf(s),E=e.indexOf(p);if((u||N>-1)&&E>-1){let B={isInputSource:u,fromIndex:N,toIndex:E,label:n.label,labels:n.labels};i.push(B)}}),this.itembuffer.copyRuleNodes(e,i)}pasteRuleNodes(e){let t=$(this.ruleChainCanvas.modelService.canvasHtmlElement),i,n;if(e){let p=t.offset();i=Math.round(e.clientX-p.left),n=Math.round(e.clientY-p.top)}else{let p=t.parent(),u=p.scrollTop();i=p.scrollLeft()+p.width()/2,n=u+p.height()/2}let s=this.itembuffer.pasteRuleNodes(i,n);if(s){this.ruleChainCanvas.modelService.deselectAll();let p=[];s.nodes.forEach(u=>{u.id="rule-chain-node-"+this.nextNodeID++;let N=u.component;N.configurationDescriptor.nodeDefinition.inEnabled&&u.connectors.push({type:R.leftConnectorType,id:this.nextConnectorID+++""}),N.configurationDescriptor.nodeDefinition.outEnabled&&u.connectors.push({type:R.rightConnectorType,id:this.nextConnectorID+++""}),p.push(u),this.ruleChainModel.nodes.push(u),this.ruleChainCanvas.modelService.nodes.select(u)}),s.connections.forEach(u=>{let N=p[u.fromIndex],E=p[u.toIndex];if((u.isInputSource||N)&&E){let B,A;if(u.isInputSource){B=this.inputConnectorId+"";let k=this.ruleChainModel.edges.find(pe=>pe.source===this.inputConnectorId+"");k&&this.ruleChainCanvas.modelService.edges.delete(k)}else{let k=this.ruleChainCanvas.modelService.nodes.getConnectorsByType(N,R.rightConnectorType);k&&k.length&&(B=k[0].id)}let ie=this.ruleChainCanvas.modelService.nodes.getConnectorsByType(E,R.leftConnectorType);if(ie&&ie.length&&(A=ie[0].id),B&&A){let k={source:B,destination:A,label:u.label,labels:u.labels};this.ruleChainModel.edges.push(k),this.ruleChainCanvas.modelService.edges.select(k)}}}),this.updateRuleNodesHighlight(),this.validate(),this.onModelChanged()}}onDetailsDrawerClosed(){this.onEditRuleNodeClosed(),this.onEditRuleNodeLinkClosed(),this.enableHotKeys=!0,this.updateErrorTooltips(!1)}onEditRuleNodeClosed(){this.editingRuleNode=null,this.isEditingRuleNode=!1}onEditRuleNodeLinkClosed(){this.editingRuleNodeLink=null,this.isEditingRuleNodeLink=!1}onRevertRuleNodeEdit(){this.ruleNodeComponent.ruleNodeFormGroup.markAsPristine();let e=this.ruleChainModel.nodes[this.editingRuleNodeIndex];this.editingRuleNode=D(e,["component"])}onRevertRuleNodeLinkEdit(){this.ruleNodeLinkComponent.ruleNodeLinkFormGroup.markAsPristine();let e=this.ruleChainModel.edges[this.editingRuleNodeLinkIndex];this.editingRuleNodeLink=D(e)}onDebugEventSelected(e){let t=this.ruleNodeComponent.ruleNodeConfigComponent,i=t.definedConfigComponent;t.useDefinedDirective()&&i.hasScript&&i.testScript&&i.testScript(e)}onRuleNodeInit(){let e=this.ruleNodeComponent.ruleNodeConfigComponent.definedConfigComponent;this.ruleNodeComponent.ruleNodeConfigComponent.useDefinedDirective()&&e.hasScript?this.ruleNodeTestButtonLabel=e.testScriptLabel:this.ruleNodeTestButtonLabel=""}switchToFirstTab(){this.selectedRuleNodeTabIndex=0}saveRuleNode(){this.ruleNodeComponent.validate(),this.ruleNodeComponent.ruleNodeFormGroup.valid&&(this.ruleNodeComponent.ruleNodeFormGroup.markAsPristine(),this.editingRuleNode.error&&delete this.editingRuleNode.error,this.ruleChainModel.nodes[this.editingRuleNodeIndex]=this.editingRuleNode,this.editingRuleNode=D(this.editingRuleNode,["component"]),this.onModelChanged(),this.updateRuleNodesHighlight())}saveRuleNodeLink(){this.ruleNodeLinkComponent.ruleNodeLinkFormGroup.markAsPristine(),this.ruleChainModel.edges[this.editingRuleNodeLinkIndex]=this.editingRuleNodeLink,this.editingRuleNodeLink=D(this.editingRuleNodeLink),this.onModelChanged()}typeHeaderMouseEnter(e,t){let i=W.get(t);this.displayTooltip(e,'<div class="tb-rule-node-tooltip tb-lib-tooltip"><div id="tb-node-content"><div class="tb-node-title">'+this.translate.instant(i.name)+'</div><div class="tb-node-details">'+this.translate.instant(i.details)+"</div></div></div>")}displayLibNodeDescriptionTooltip(e,t){this.displayTooltip(e,'<div class="tb-rule-node-tooltip tb-lib-tooltip"><div id="tb-node-content"><div class="tb-node-title">'+t.component.name+'</div><div class="tb-node-description">'+t.component.configurationDescriptor.nodeDefinition.description+'</div><div class="tb-node-details">'+t.component.configurationDescriptor.nodeDefinition.details+"</div></div></div>")}displayNodeDescriptionTooltip(e,t){if(!this.errorTooltips[t.id]){let i,n,s;t.component.type===O.INPUT?(i=this.translate.instant(W.get(O.INPUT).name),n=this.translate.instant(W.get(O.INPUT).details)):(i=t.name,n=this.translate.instant(W.get(t.component.type).name)+" - "+t.component.name,t.additionalInfo&&(s=t.additionalInfo.description));let p='<div class="tb-rule-node-tooltip"><div id="tb-node-content"><div class="tb-node-title">'+i+'</div><div class="tb-node-description">'+n+"</div>";s&&(p+='<div class="tb-node-details">'+s+"</div>"),p+="</div></div>",this.displayTooltip(e,p)}}destroyTooltips(){this.tooltipTimeout&&(clearTimeout(this.tooltipTimeout),this.tooltipTimeout=null),$.tooltipster.instances().forEach(t=>{t.isErrorTooltip||t.destroy()})}updateRuleNodesHighlight(){for(let e of this.ruleChainModel.nodes)e.highlighted=!1;if(this.ruleNodeSearch){let e=this.ruleNodeSearch.toUpperCase(),t=this.ruleChainModel.nodes.filter(i=>i.name.toUpperCase().includes(e));if(t)for(let i of t)i.highlighted=!0}this.ruleChainCanvas&&this.ruleChainCanvas.modelService.detectChanges()}objectsSelected(){return this.ruleChainCanvas.modelService.nodes.getSelectedNodes().length>0||this.ruleChainCanvas.modelService.edges.getSelectedEdges().length>0}deleteSelected(){this.ruleChainCanvas.modelService.deleteSelected()}isDebugSettingsEnabled(){return typeof this.ruleChainModel.nodes.find(t=>t?.debugSettings&&this.isDebugSettingsActive(t.debugSettings))<"u"}resetDebugSettingsInAllNodes(){let e=!1;this.ruleChainModel.nodes.forEach(t=>{if(t.component.type!==O.INPUT){let i=t?.debugSettings&&this.isDebugSettingsActive(t.debugSettings);e=e||i,i&&(t.debugSettings={allEnabled:!1,failuresEnabled:!1,allEnabledUntil:0})}}),e&&this.onModelChanged()}isDebugSettingsActive(e){return e.allEnabled||e.failuresEnabled||e.allEnabledUntil>new Date().getTime()}validate(){setTimeout(()=>{this.isInvalid=!1,this.ruleChainModel.nodes.forEach(e=>{e.error&&(this.isInvalid=!0),this.updateNodeErrorTooltip(e)})},0)}saveRuleChain(){let e=new Tt,t;return this.isImport?t=this.ruleChainService.saveRuleChain(this.ruleChain):t=X(this.ruleChain),t.subscribe(i=>{this.ruleChain=i;let n={ruleChainId:this.ruleChain.id,nodes:[],connections:[],version:i.version},s=[];this.ruleChainModel.nodes.forEach(u=>{if(u.component.type!==O.INPUT){let N={id:u.ruleNodeId,type:u.component.clazz,name:u.name,configurationVersion:_t(u.configurationVersion)?u.configurationVersion:u.component.configurationVersion,configuration:u.configuration,additionalInfo:u.additionalInfo?u.additionalInfo:{},debugSettings:u.debugSettings,singletonMode:u.singletonMode,queueName:u.queueName};N.additionalInfo.layoutX=Math.round(u.x),N.additionalInfo.layoutY=Math.round(u.y),n.nodes.push(N),s.push(u)}});let p=this.ruleChainModel.edges.find(u=>u.source===this.inputConnectorId+"");if(p){let u=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(p.destination);n.firstNodeIndex=s.indexOf(u)}this.ruleChainModel.edges.forEach(u=>{let N=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(u.source),E=this.ruleChainCanvas.modelService.nodes.getNodeByConnectorId(u.destination);if(N.component.type!==O.INPUT){let B=s.indexOf(N),A=s.indexOf(E),ie={fromIndex:B,toIndex:A};u.labels.forEach(k=>{let pe=D(ie);pe.type=k,n.connections.push(pe)})}}),this.ruleChainService.saveRuleChainMetadata(n).pipe(ze(u=>u.status===qt.Conflict?this.ruleChainService.getRuleChainMetadata(n.ruleChainId.id):Mt(()=>u))).subscribe(u=>{this.ruleChain.version=u.version,this.ruleChainMetaData=u,this.isImport?(this.isDirtyValue=!1,this.isImport=!1,this.ruleChainType!==je.EDGE?this.router.navigateByUrl(`ruleChains/${this.ruleChain.id.id}`):this.router.navigateByUrl(`edgeManagement/ruleChains/${this.ruleChain.id.id}`)):this.createRuleChainModel(),e.next()})}),e}reloadRuleChain(){this.ruleChainService.getRuleChain(this.ruleChain.id.id).subscribe(e=>{this.ruleChain=e,this.updateBreadcrumbs.emit(),this.ruleChainService.getRuleChainMetadata(this.ruleChain.id.id).subscribe(t=>{this.ruleChainMetaData=t,this.isDirtyValue=!1,this.createRuleChainModel()})})}revertRuleChain(){this.createRuleChainModel()}addRuleNode(e){e.configuration=D(e.component.configurationDescriptor.nodeDefinition.defaultConfiguration);let t=this.ruleChain.id?this.ruleChain.id.id:null;this.enableHotKeys=!1;let i=this.ruleChainType;this.dialog.open(oo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{ruleNode:e,ruleChainId:t,ruleChainType:i}}).afterClosed().subscribe(n=>{n&&(n.id="rule-chain-node-"+this.nextNodeID++,n.connectors=[],n.component.configurationDescriptor.nodeDefinition.inEnabled&&n.connectors.push({id:this.nextConnectorID+++"",type:R.leftConnectorType}),n.component.configurationDescriptor.nodeDefinition.outEnabled&&n.connectors.push({id:this.nextConnectorID+++"",type:R.rightConnectorType}),this.ruleChainModel.nodes.push(n),this.onModelChanged(),this.updateRuleNodesHighlight()),this.enableHotKeys=!0})}addRuleNodeLink(e,t,i,n){return this.dialog.open(no,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{link:e,labels:t,allowCustomLabels:i,sourceRuleChainId:n}}).afterClosed()}toggleVersionControl(e,t){e&&e.stopPropagation();let i=t._elementRef.nativeElement;if(this.popoverService.hasPopover(i))this.popoverService.hidePopover(i);else{let n=this.popoverService.displayPopover(i,this.renderer,this.viewContainerRef,Ui,"leftTop",!0,null,{detailsMode:!0,active:!0,singleEntityMode:!0,externalEntityId:this.ruleChain.externalId||this.ruleChain.id,entityId:this.ruleChain.id,entityName:this.ruleChain.name,onBeforeCreateVersion:()=>this.isDirty?this.saveRuleChain():X(null)},{},{},{},!0);n.tbComponentRef.instance.popoverComponent=n,n.tbComponentRef.instance.versionRestored.subscribe(()=>{this.reloadRuleChain()})}}updateNodeErrorTooltip(e){if(e.error){let t=$("#"+e.id),i=this.errorTooltips[e.id];if(!i||!t.hasClass("tooltipstered")){t.tooltipster({theme:"tooltipster-shadow",delay:0,animationDuration:0,trigger:"custom",triggerOpen:{click:!1,tap:!1},triggerClose:{click:!1,tap:!1,scroll:!1},side:"top",trackOrigin:!0});let n='<div class="tb-rule-node-error-tooltip"><div id="tooltip-content"><div class="tb-node-details">'+e.error+"</div></div></div>",s=$(n);i=t.tooltipster("instance"),i.isErrorTooltip=!0,i.content(s),this.errorTooltips[e.id]=i}setTimeout(()=>{i.open()},0)}else this.errorTooltips[e.id]&&(this.errorTooltips[e.id].destroy(),delete this.errorTooltips[e.id])}updateErrorTooltips(e){for(let t of Object.keys(this.errorTooltips)){let i=this.errorTooltips[t];e?i.close():i.open()}}displayTooltip(e,t){this.destroyTooltips(),this.tooltipTimeout=setTimeout(()=>{let i=$(e.target);i.tooltipster({theme:"tooltipster-shadow",delay:100,trigger:"custom",triggerOpen:{click:!1,tap:!1},triggerClose:{click:!0,tap:!0,scroll:!0},side:"right",distance:12,trackOrigin:!0});let n=$(t),s=i.tooltipster("instance");s.content(n),s.open()},500)}static{this.\u0275fac=function(t){return new(t||o)(b(Be),b(Ut),b(_e),b(Re),b(Yt),b(De),b(Li),b(Ri),b(Pt),b($e),b(jt),b(Kt),b(ti),b(ri))}}static{this.\u0275cmp=q({type:o,selectors:[["tb-rulechain-page"]],viewQuery:function(t,i){if(t&1&&(V(kn,7),V(Ln,7),V(Vn,5),V(Ji,5),V(Fn,5),V(Pn,5,at)),t&2){let n;F(n=P())&&(i.ruleChainCanvas=n.first),F(n=P())&&(i.ruleChainMenuTrigger=n.first),F(n=P())&&(i.drawer=n.first),F(n=P())&&(i.ruleNodeComponent=n.first),F(n=P())&&(i.ruleNodeLinkComponent=n.first),F(n=P())&&(i.expansionPanels=n)}},hostVars:4,hostBindings:function(t,i){t&2&&yt("width",i.width)("height",i.height)},features:[Ce],decls:67,vars:70,consts:[["cheatSheetComponent",""],["drawer",""],["ruleChainMenuTrigger","matMenuTrigger"],["ruleChainMenu","matMenu"],["ruleChainCanvas",""],["ruleNodeTypeExpansionPanels",""],["tbRuleNode",""],["eventsTab","matTab"],["tbRuleNodeLink",""],["versionControlButton",""],["tb-fullscreen","",1,"mat-content","tb-rulechain","flex","flex-1","flex-col",3,"fullscreen","tb-hotkeys","cheatSheet"],[1,"tb-rulechain-container","flex","flex-1","flex-col"],[1,"tb-rulechain-layout","flex","flex-1","flex-row"],[1,"size-full"],["disableClose","true","mode","side","opened","","position","start",1,"tb-rulechain-library","mat-elevation-z4","flex","flex-col"],["color","primary",1,"tb-dark"],["class","flex-1",3,"ruleChainType","disabled","ngModel","ngModelChange",4,"ngIf"],[1,"mat-toolbar-tools"],[1,"tb-appearance-transparent","flex-1"],["mat-icon-button","","matPrefix","","matTooltipPosition","above",1,"tb-small",3,"matTooltip"],["matInput","",3,"formControl","placeholder"],["mat-icon-button","","matSuffix","","matTooltipPosition","above",1,"tb-small",3,"click","matTooltip"],[1,"tb-rulechain-library-panel-group"],["class","mat-elevation-z2",3,"expanded",4,"ngFor","ngForOf"],["mode","over","position","end",1,"tb-details-drawer",3,"closed","opened"],["class","flex-1",3,"headerTitle","headerSubtitle","isReadOnly","isAlwaysEdit","theForm","closeDetails","toggleDetailsEditMode","applyDetails",4,"ngIf"],[1,"tb-rulechain-graph-content"],["color","primary","mat-mini-fab","","matTooltipPosition","above",1,"tb-library-node-btn",3,"click","matTooltip"],[1,"tb-library-node-btn-icon"],["color","primary","type","button","mat-mini-fab","","class","version-control-button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-fullscreen-button","tb-mat-40",3,"click","matTooltip"],[1,"tb-absolute-fill","tb-rulechain-graph",3,"tbcontextmenu"],[2,"visibility","hidden","position","fixed",3,"matMenuTriggerFor"],[1,"tb-rule-chain-context-menu",3,"overlapTrigger"],["matMenuContent",""],["id","tb-rulchain-canvas","fitModelSizeByDefault","false",3,"modelChanged","model","selectedObjects","edgeStyle","automaticResize","nodeWidth","nodeHeight","dragAnimation","userCallbacks"],[1,"tb-footer-buttons","flex","flex-row","flex-wrap","items-end","justify-start"],["mat-fab","","color","accent","matTooltipPosition","above",1,"tb-btn-footer",3,"click","disabled","matTooltip"],[1,"flex-1",3,"ngModelChange","ruleChainType","disabled","ngModel"],[1,"mat-elevation-z2",3,"expanded"],["expandedHeight","48px",3,"mouseenter","mouseleave"],["translate","",1,"tb-panel-title"],["fitModelSizeByDefault","",3,"id","model","selectedObjects","automaticResize","userCallbacks","nodeWidth","nodeHeight","dropTargetId"],[1,"flex-1",3,"closeDetails","toggleDetailsEditMode","applyDetails","headerTitle","headerSubtitle","isReadOnly","isAlwaysEdit","theForm"],[1,"details-buttons"],[3,"tb-help"],["mat-stretch-tabs","false",1,"tb-absolute-fill","tb-rulenode-details","flex-1",3,"selectedIndexChange","selectedIndex"],[3,"label"],[3,"initRuleNode","changeScript","ruleNode","ruleChainId","ruleChainType"],[3,"label",4,"ngIf"],[1,"tb-rule-node-help"],["id","tb-node-content",1,"mat-padding","flex","flex-col"],[1,"tb-node-title"],[1,"tb-node-description",3,"innerHtml"],[1,"tb-node-details",3,"innerHtml"],[3,"debugEventSelected","debugEventTypes","defaultEventType","active","tenantId","entityId","functionTestButtonLabel"],[1,"flex-1",3,"ngModelChange","ngModel","allowedLabels","allowCustom","sourceRuleChainId"],["color","primary","type","button","mat-mini-fab","","matTooltipPosition","above",1,"version-control-button",3,"click","matTooltip"],[1,"tb-rule-chain-context-menu-container",3,"mouseleave"],[4,"ngIf"],[3,"src",4,"ngIf"],[1,"flex-1"],[1,"tb-context-menu-title"],[1,"tb-context-menu-subtitle"],[4,"ngFor","ngForOf"],[3,"src"],["mat-menu-item","",3,"disabled","click",4,"ngIf"],["mat-menu-item","",3,"click","disabled"],["class","tb-alt-text",4,"ngIf"],["translate",""],[1,"tb-alt-text"]],template:function(t,i){if(t&1){let n=T();r(0,"div",10),x(1,"tb-hotkeys-cheatsheet",null,0),r(3,"section",11)(4,"div",12)(5,"mat-drawer-container",13)(6,"mat-drawer",14,1)(8,"mat-toolbar",15),I(9,On,1,3,"tb-rule-chain-select",16),d(),r(10,"mat-toolbar")(11,"div",17)(12,"mat-form-field",18)(13,"button",19),f(14,"translate"),r(15,"mat-icon"),h(16,"search"),d()(),x(17,"input",20),f(18,"translate"),r(19,"button",21),f(20,"translate"),_("click",function(){return v(n),y(i.ruleNodeTypeSearch.reset())}),r(21,"mat-icon"),h(22,"close"),d()()()()(),r(23,"div",22),I(24,An,9,12,"mat-expansion-panel",23),d()(),r(25,"mat-drawer",24),_("closed",function(){return v(n),y(i.onDetailsDrawerClosed())}),I(26,jn,24,28,"tb-details-panel",25)(27,qn,6,12,"tb-details-panel",25),d(),r(28,"mat-drawer-content",26)(29,"button",27),f(30,"translate"),_("click",function(){v(n);let p=j(7);return y(p.toggle())}),r(31,"mat-icon",28),h(32,"chevron_right"),d()(),I(33,Un,5,3,"button",29),r(34,"button",30),f(35,"translate"),_("click",function(){return v(n),y(i.isFullscreen=!i.isFullscreen)}),r(36,"mat-icon"),h(37),d()(),r(38,"div",31),_("tbcontextmenu",function(p){return v(n),y(i.openRuleChainContextMenu(p))}),x(39,"div",32,2),r(41,"mat-menu",33,3),I(43,Yn,10,8,"ng-template",34),d(),r(44,"fc-canvas",35,4),_("modelChanged",function(){return v(n),y(i.onModelChanged())}),d()(),r(46,"section",36)(47,"button",37),f(48,"translate"),f(49,"async"),_("click",function(){return v(n),y(i.deleteSelected())}),r(50,"mat-icon"),h(51,"delete"),d()(),r(52,"button",37),f(53,"translate"),f(54,"async"),_("click",function(){return v(n),y(i.resetDebugSettingsInAllNodes())}),r(55,"mat-icon"),h(56,"bug_report"),d()(),r(57,"button",37),f(58,"translate"),f(59,"async"),_("click",function(){return v(n),y(i.saveRuleChain())}),r(60,"mat-icon"),h(61,"done"),d()(),r(62,"button",37),f(63,"translate"),f(64,"async"),_("click",function(){return v(n),y(i.revertRuleChain())}),r(65,"mat-icon"),h(66,"close"),d()()()()()()()()}if(t&2){let n=j(2),s=j(7),p=j(42);l("fullscreen",i.isFullscreen)("tb-hotkeys",i.hotKeys)("cheatSheet",n),a(9),l("ngIf",!i.isImport),a(4),M("matTooltip",g(14,44,"rulenode.search")),a(4),M("placeholder",g(18,46,"rulenode.search")),l("formControl",i.ruleNodeTypeSearch),a(2),ve("!hidden",i.ruleNodeTypeSearch.value===""),M("matTooltip",g(20,48,"action.clear-search")),a(5),l("ngForOf",i.ruleNodeTypesLibraryArray),a(),l("opened",i.isEditingRuleNode||i.isEditingRuleNodeLink),a(),l("ngIf",i.editingRuleNode),a(),l("ngIf",i.editingRuleNodeLink),a(2),M("matTooltip",g(30,50,s.opened?"rulenode.close-node-library":"rulenode.open-node-library")),a(2),ve("tb-library-node-btn-icon-toggled",s.opened),a(2),l("ngIf",!i.isImport),a(),M("matTooltip",g(35,52,i.isFullscreen?"fullscreen.exit":"fullscreen.expand")),a(3),z(i.isFullscreen?"fullscreen_exit":"fullscreen"),a(2),yt("left",i.ruleChainMenuPosition.x)("top",i.ruleChainMenuPosition.y),l("matMenuTriggerFor",p),a(2),l("overlapTrigger",!0),a(3),l("model",i.ruleChainModel)("selectedObjects",i.selectedObjects)("edgeStyle",i.flowchartConstants.curvedStyle)("automaticResize",!0)("nodeWidth",170)("nodeHeight",50)("dragAnimation",i.flowchartConstants.dragAnimationRepaint)("userCallbacks",i.editCallbacks),a(3),ve("tb-hide",!i.objectsSelected()),M("matTooltip",g(48,54,"rulenode.delete-selected-objects")),l("disabled",g(49,56,i.isLoading$)),a(5),M("matTooltip",g(53,58,"rulenode.reset-debug-settings")),l("disabled",g(54,60,i.isLoading$)||!i.isDebugSettingsEnabled()),a(5),M("matTooltip",g(58,62,"action.apply-changes")),l("disabled",g(59,64,i.isLoading$)||i.isInvalid||!i.isDirtyValue&&!i.isImport),a(5),M("matTooltip",g(63,66,"action.decline-changes")),l("disabled",g(64,68,i.isLoading$)||!i.isDirtyValue)}},dependencies:[Ze,Y,Mi,Pi,ut,Fi,Oe,Wt,$t,ce,Se,Ie,ai,li,_i,Ni,yi,Ae,Ci,gi,bi,vi,Jt,fi,xi,Ii,at,Zt,ei,Ne,Q,ni,oi,ii,Si,de,Ai,Gi,Hi,Te,Rt,ye,Vi,Xt,J],styles:[`@charset "UTF-8";.tb-rulechain{width:100%;height:100%}.tb-rulechain .mat-mdc-tab-group.tb-rulenode-details>.mat-mdc-tab-body-wrapper{position:absolute;inset:49px 0 0}.tb-rulechain .mat-mdc-tab-group.tb-rulenode-details>.mat-mdc-tab-header .mat-mdc-tab{min-width:40px}.tb-rulechain button.mdc-icon-button.tb-fullscreen-button{position:absolute;top:10px;right:10px;background:#ccc;color:#666;opacity:.85;margin:0 6px;z-index:2}.tb-rulechain button.mdc-fab.version-control-button{position:absolute;top:10px;right:60px;opacity:.85;margin:0 6px;z-index:2}.tb-rulechain .tb-library-node-btn{width:20px;height:90px;position:absolute;top:50%;z-index:1000;opacity:.5;border-radius:0 15px 15px 0!important;transform:translateY(-50%)}.tb-rulechain .tb-library-node-btn-icon{transition:transform .4s!important}.tb-rulechain .tb-library-node-btn-icon-toggled{transform:rotate(180deg)}.tb-rulechain .tb-library-node-btn:before{width:20px;height:30px;top:-28px;left:0;content:"";pointer-events:none;border-radius:0 0 0 15px;box-shadow:-10px 0 #305680;border:none}.tb-rulechain .tb-library-node-btn:after{position:absolute;width:20px;height:30px;bottom:-28px;left:0;content:"";pointer-events:none;border-top-left-radius:15px;box-shadow:-10px 0 #305680;border:none}.tb-rulechain .tb-rulechain-library{z-index:1;width:250px;min-width:250px}.tb-rulechain .tb-rulechain-library .mat-toolbar{height:min-content;padding:0}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools{height:48px;padding:0 6px;font-size:14px}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools .mat-mdc-icon-button{margin:0}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools .mat-mdc-icon-button.tb-small{width:32px;height:32px;min-height:32px;padding:6px;line-height:20px}.tb-rulechain .tb-rulechain-library .mat-toolbar .mat-toolbar-tools .mat-mdc-icon-button.tb-small .mat-icon{width:20px;min-width:20px;height:20px;min-height:20px;font-size:20px;line-height:20px}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group{overflow-x:hidden;overflow-y:auto}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel{border-radius:0}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel:last-child{margin-bottom:5px}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header{background:#e6e6e6}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header:hover{background:#dadada}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header .mat-expansion-panel-header-title{line-height:48px;height:48px;overflow:hidden}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header .mat-expansion-panel-header-title .mat-icon{min-width:24px;margin:auto 8px auto 0}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel .mat-expansion-panel-header .mat-expansion-panel-header-title .tb-panel-title{min-width:130px;-webkit-user-select:none;user-select:none}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel.mat-expanded .mat-expansion-panel-header{border-bottom:1px solid;border-color:#909090}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .mat-expansion-panel-body{padding:0}.tb-rulechain .tb-rulechain-library .tb-rulechain-library-panel-group .fc-canvas{background:#f9f9f9}.tb-rulechain .mat-drawer-content.tb-rulechain-graph-content{overflow:hidden;z-index:0}.tb-rulechain .mat-drawer-content.tb-rulechain-graph-content .tb-rulechain-graph{z-index:0;overflow:auto}.tb-rulechain .fc-canvas .fc-node{border-radius:8px}.tb-rulechain .fc-canvas .fc-node.fc-selected{z-index:2}.tb-rulechain .fc-canvas .fc-node.fc-selected:not(.fc-edit){margin:-3px;border:solid 3px #f00}.tb-rulechain .fc-canvas .fc-edit .fc-nodeedit,.tb-rulechain .fc-canvas .fc-edit .fc-nodedelete{box-sizing:content-box;border:solid 2px #fff;background:#f83e05;outline:none}.tb-rulechain .fc-canvas .fc-nodeopen{display:block;position:absolute;top:11px;right:10px;border:1px solid #FFFFFF;border-radius:4px;line-height:18px;height:22px;width:22px;background:#886cb1;color:#fff;text-align:center;cursor:pointer;box-sizing:border-box}.tb-rulechain .fc-canvas .fc-nodeopen .mat-icon{width:16px;min-width:16px;height:16px;min-height:16px;font-size:16px}.tb-rulechain .fc-canvas .fc-nodeopen:hover{background-color:#4e2d7e}.tb-rulechain .fc-canvas .fc-arrow-marker polygon{fill:gray;stroke:gray}.tb-rulechain .fc-canvas .fc-arrow-marker-selected polygon{fill:red;stroke:red}.tb-rulechain .fc-canvas .fc-edge{outline:none;stroke:gray}.tb-rulechain .fc-canvas .fc-edge.fc-selected{stroke:red}.tb-rulechain .fc-canvas .fc-edge.fc-hover{stroke:gray}.tb-rulechain .fc-canvas .edge-endpoint{fill:gray}.tb-rulechain .fc-canvas .fc-edge-label{opacity:1!important}.tb-rulechain .fc-canvas .fc-edge-label:focus{outline:0}.tb-rulechain .fc-canvas .fc-edge-label.fc-selected .fc-edge-label-text span{color:#fff!important;background-color:red!important;border:solid #f00!important}.tb-rulechain .fc-canvas .fc-edge-label .fc-edge-label-text{font-size:14px!important;font-weight:600!important}.tb-rulechain .fc-canvas .fc-edge-label .fc-edge-label-text span{background-color:#fff!important;color:#003a79!important;border:solid 2px #003a79!important}.tb-rule-node-tooltip,.tb-rule-node-help{color:#333}.tb-rule-node-tooltip{max-width:300px;font-size:14px}.tb-rule-node-tooltip.tb-lib-tooltip{width:300px}.tb-rule-node-help{font-size:16px}.tb-rule-node-error-tooltip{font-size:16px;color:#ea0d0d}.tb-rule-node-tooltip #tb-node-content .tb-node-title,.tb-rule-node-error-tooltip #tb-node-content .tb-node-title,.tb-rule-node-help #tb-node-content .tb-node-title{font-weight:600}.tb-rule-node-tooltip #tb-node-content .tb-node-description,.tb-rule-node-error-tooltip #tb-node-content .tb-node-description,.tb-rule-node-help #tb-node-content .tb-node-description{font-style:italic;color:#555}.tb-rule-node-tooltip #tb-node-content .tb-node-details,.tb-rule-node-error-tooltip #tb-node-content .tb-node-details,.tb-rule-node-help #tb-node-content .tb-node-details{padding-top:10px;padding-bottom:10px}.tb-rule-node-tooltip #tb-node-content code,.tb-rule-node-error-tooltip #tb-node-content code,.tb-rule-node-help #tb-node-content code{padding:0 3px 2px;margin:1px;font-size:12px;color:#ad1625;white-space:nowrap;background-color:#f7f7f9;border:1px solid #e1e1e8;border-radius:2px}.tb-rule-chain-context-menu.mat-mdc-menu-panel{min-width:320px;max-height:404px;border-radius:8px;margin-left:-20px}.tb-rule-chain-context-menu.mat-mdc-menu-panel.mat-menu-below{margin-top:-60px}.tb-rule-chain-context-menu.mat-mdc-menu-panel .mat-mdc-menu-content{padding:0;display:flex;flex-direction:column}.tb-rule-chain-context-menu.mat-mdc-menu-panel .mat-mdc-menu-content .tb-rule-chain-context-menu-container{pointer-events:auto;padding:0 0 8px;display:flex;flex-direction:column;overflow-y:auto}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header{display:flex;box-sizing:content-box;flex-direction:row;height:36px;min-height:36px;padding:8px 5px 5px;font-size:14px}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-filter-type{background-color:#f1e861}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-enrichment-type{background-color:#cdf14e}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-transformation-type{background-color:#79cef1}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-action-type{background-color:#f1928f}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-external-type{background-color:#fbc766}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-flow-type{background-color:#d6c4f1}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-unknown-type{background-color:#f16c29}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-rulechain-header,.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header.tb-link-header{background-color:#aac7e4}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header .mat-icon{margin:auto 10px auto 2px}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header .tb-context-menu-title{font-weight:500;line-height:normal}.tb-rule-chain-context-menu.mat-mdc-menu-panel .tb-context-menu-header .tb-context-menu-subtitle{font-size:12px;line-height:normal}
`],encapsulation:2})}}return o})(),no=(()=>{class o extends rt{constructor(e,t,i,n,s,p){super(e,t,s),this.store=e,this.router=t,this.data=i,this.errorStateMatcher=n,this.dialogRef=s,this.fb=p,this.submitted=!1,this.link=this.data.link,this.labels=this.data.labels,this.allowCustomLabels=this.data.allowCustomLabels,this.sourceRuleChainId=this.data.sourceRuleChainId,this.ruleNodeLinkFormGroup=this.fb.group({link:[D(this.link),[U.required]]})}ngOnInit(){}isErrorState(e,t){let i=this.errorStateMatcher.isErrorState(e,t),n=!!(e&&e.invalid&&this.submitted);return i||n}cancel(){this.dialogRef.close(null)}add(){this.submitted=!0;let e=this.ruleNodeLinkFormGroup.get("link").value;this.link=gt(gt({},this.link),e),this.dialogRef.close(this.link)}static{this.\u0275fac=function(t){return new(t||o)(b(Be),b(_e),b(it),b(fe,4),b(tt),b(te))}}static{this.\u0275cmp=q({type:o,selectors:[["tb-add-rule-node-link-dialog"]],features:[ae([{provide:fe,useExisting:o}]),Ce],decls:24,vars:23,consts:[[2,"width","480px",3,"ngSubmit","formGroup"],["color","primary"],["translate",""],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],[3,"disabled"],["required","","formControlName","link",3,"allowedLabels","allowCustom","sourceRuleChainId"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(t,i){t&1&&(r(0,"form",0),_("ngSubmit",function(){return i.add()}),r(1,"mat-toolbar",1)(2,"h2",2),h(3,"rulenode.add-link"),d(),x(4,"span",3)(5,"div",4),r(6,"button",5),_("click",function(){return i.cancel()}),r(7,"mat-icon",6),h(8,"close"),d()()(),I(9,Jn,1,0,"mat-progress-bar",7),f(10,"async"),r(11,"div",8)(12,"fieldset",9),f(13,"async"),x(14,"tb-rule-node-link",10),d()(),r(15,"div",11)(16,"button",12),f(17,"async"),_("click",function(){return i.cancel()}),h(18),f(19,"translate"),d(),r(20,"button",13),f(21,"async"),h(22),f(23,"translate"),d()()()),t&2&&(l("formGroup",i.ruleNodeLinkFormGroup),a(5),l("tb-help","ruleEngine"),a(4),l("ngIf",g(10,11,i.isLoading$)),a(3),l("disabled",g(13,13,i.isLoading$)),a(2),l("allowedLabels",i.labels)("allowCustom",i.allowCustomLabels)("sourceRuleChainId",i.sourceRuleChainId),a(2),l("disabled",g(17,15,i.isLoading$)),a(2),w(" ",g(19,17,"action.cancel")," "),a(2),l("disabled",g(21,19,i.isLoading$)||i.ruleNodeLinkFormGroup.invalid||!i.ruleNodeLinkFormGroup.dirty),a(2),w(" ",g(23,21,"action.add")," "))},dependencies:[Y,ut,we,Oe,ce,dt,Ae,ot,nt,ge,Q,K,xe,Z,ee,de,Rt,ye,J],styles:['@charset "UTF-8";[_nghost-%COMP%]     tb-rule-node-link form{overflow:hidden!important}']})}}return o})(),oo=(()=>{class o extends rt{constructor(e,t,i,n,s){super(e,t,s),this.store=e,this.router=t,this.data=i,this.errorStateMatcher=n,this.dialogRef=s,this.submitted=!1,this.ruleNode=this.data.ruleNode,this.ruleChainId=this.data.ruleChainId,this.ruleChainType=this.data.ruleChainType}ngOnInit(){}isErrorState(e,t){let i=this.errorStateMatcher.isErrorState(e,t),n=!!(e&&e.invalid&&this.submitted);return i||n}helpLinkIdForRuleNodeType(){return It(this.ruleNode.component)}cancel(){this.dialogRef.close(null)}add(){this.submitted=!0,this.ruleNodeDetailsComponent.validate(),this.ruleNodeDetailsComponent.ruleNodeFormGroup.valid&&this.dialogRef.close(this.ruleNode)}static{this.\u0275fac=function(t){return new(t||o)(b(Be),b(_e),b(it),b(fe,4),b(tt))}}static{this.\u0275cmp=q({type:o,selectors:[["tb-add-rule-node-dialog"]],viewQuery:function(t,i){if(t&1&&V(Ji,7),t&2){let n;F(n=P())&&(i.ruleNodeDetailsComponent=n.first)}},features:[ae([{provide:fe,useExisting:o}]),Ce],decls:24,vars:20,consts:[["tbRuleNode",""],[1,"dialog-container",3,"ngSubmit"],["color","primary"],["translate",""],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],["isAdd","",3,"ruleNode","ruleChainId","ruleChainType"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(t,i){if(t&1){let n=T();r(0,"form",1),_("ngSubmit",function(){return v(n),y(i.add())}),r(1,"mat-toolbar",2)(2,"h2",3),h(3,"rulenode.add"),d(),r(4,"span",4),h(5),d(),x(6,"div",5),r(7,"button",6),_("click",function(){return v(n),y(i.cancel())}),r(8,"mat-icon",7),h(9,"close"),d()()(),I(10,Zn,1,0,"mat-progress-bar",8),f(11,"async"),r(12,"div",9),x(13,"tb-rule-node",10,0),d(),r(15,"div",11)(16,"button",12),f(17,"async"),_("click",function(){return v(n),y(i.cancel())}),h(18),f(19,"translate"),d(),r(20,"button",13),f(21,"async"),h(22),f(23,"translate"),d()()()}if(t&2){let n=j(14);a(5),w(": ",i.ruleNode.component.name,""),a(),l("tb-help",i.helpLinkIdForRuleNodeType()),a(4),l("ngIf",g(11,10,i.isLoading$)),a(3),l("ruleNode",i.ruleNode)("ruleChainId",i.ruleChainId)("ruleChainType",i.ruleChainType),a(3),l("disabled",g(17,12,i.isLoading$)),a(2),w(" ",g(19,14,"action.cancel")," "),a(2),l("disabled",g(21,16,i.isLoading$)||n.ruleNodeFormGroup.invalid||!n.ruleNodeFormGroup.dirty),a(2),w(" ",g(23,18,"action.add")," ")}},dependencies:[Y,ut,we,Oe,ce,dt,Ae,ot,nt,ge,K,Nt,de,Te,ye,J],styles:['@charset "UTF-8";[_nghost-%COMP%]   .dialog-container[_ngcontent-%COMP%]{min-width:750px!important;max-width:750px!important}[_nghost-%COMP%]   .dialog-container[_ngcontent-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{padding:8px}@media screen and (max-width: 959px){[_nghost-%COMP%]   .dialog-container[_ngcontent-%COMP%]{min-width:100%!important}}']})}}return o})(),ro=(()=>{class o extends rt{constructor(e,t,i,n,s,p,u){super(e,t,u),this.store=e,this.router=t,this.data=i,this.errorStateMatcher=n,this.fb=s,this.ruleChainService=p,this.dialogRef=u,this.submitted=!1}ngOnInit(){this.createNestedRuleChainFormGroup=this.fb.group({name:["",[U.required,U.maxLength(255)]],additionalInfo:this.fb.group({description:[""]})})}isErrorState(e,t){let i=this.errorStateMatcher.isErrorState(e,t),n=!!(e&&e.invalid&&this.submitted);return i||n}cancel(){this.dialogRef.close(null)}add(){this.submitted=!0;let e={name:this.createNestedRuleChainFormGroup.get("name").value,debugMode:!1,type:this.data.ruleChainType,additionalInfo:{description:this.createNestedRuleChainFormGroup.get("additionalInfo").get("description").value}};this.ruleChainService.saveRuleChain(e).subscribe(t=>{this.dialogRef.close(t)})}static{this.\u0275fac=function(t){return new(t||o)(b(Be),b(_e),b(it),b(fe,4),b(te),b(Re),b(tt))}}static{this.\u0275cmp=q({type:o,selectors:[["tb-create-nested-rulechain-dialog"]],features:[ae([{provide:fe,useExisting:o}]),Ce],decls:34,vars:21,consts:[[2,"min-width","650px",3,"ngSubmit"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],[1,"mat-padding",3,"formGroup"],[3,"disabled"],[1,"mat-block","flex-1"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formGroupName","additionalInfo"],[1,"mat-block"],["matInput","","formControlName","description","rows","2"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(t,i){t&1&&(r(0,"form",0),_("ngSubmit",function(){return i.add()}),r(1,"mat-toolbar",1)(2,"h2",2),h(3,"rulenode.create-nested-rulechain"),d(),x(4,"span",3),r(5,"button",4),_("click",function(){return i.cancel()}),r(6,"mat-icon",5),h(7,"close"),d()()(),I(8,eo,1,0,"mat-progress-bar",6),f(9,"async"),r(10,"div",7)(11,"form",8)(12,"fieldset",9),f(13,"async"),r(14,"mat-form-field",10)(15,"mat-label",2),h(16,"rulechain.name"),d(),x(17,"input",11),I(18,to,3,3,"mat-error",12)(19,io,3,3,"mat-error",12),d(),r(20,"div",13)(21,"mat-form-field",14)(22,"mat-label",2),h(23,"rulechain.description"),d(),x(24,"textarea",15),d()()()()(),r(25,"div",16)(26,"button",17),f(27,"async"),_("click",function(){return i.cancel()}),h(28),f(29,"translate"),d(),r(30,"button",18),f(31,"async"),h(32),f(33,"translate"),d()()()),t&2&&(a(8),l("ngIf",g(9,9,i.isLoading$)),a(3),l("formGroup",i.createNestedRuleChainFormGroup),a(),l("disabled",g(13,11,i.isLoading$)),a(6),l("ngIf",i.createNestedRuleChainFormGroup.get("name").hasError("required")),a(),l("ngIf",i.createNestedRuleChainFormGroup.get("name").hasError("maxlength")),a(7),l("disabled",g(27,13,i.isLoading$)),a(2),w(" ",g(29,15,"action.cancel")," "),a(2),l("disabled",g(31,17,i.isLoading$)||i.createNestedRuleChainFormGroup.invalid||!i.createNestedRuleChainFormGroup.dirty),a(2),w(" ",g(33,19,"action.create")," "))},dependencies:[Y,we,Oe,ce,dt,Se,Ie,Le,st,Ae,ot,nt,ge,Ne,Q,K,xe,Nt,Z,ee,lt,de,ye,J],encapsulation:2})}}return o})();export{Ki as a,Te as b,Yi as c,Rt as d,Aa as e,no as f,oo as g,ro as h};
