import{e as yo}from"./chunk-BKPL7UKU.js";import{a as xe,b as Lt,c as Hf,d as zf,e as $f,f as Jf,g as Fs,h as As,i as Ns,j as Dd}from"./chunk-K6B5PI3R.js";import{$ as wf,A as ff,Aa as Gf,B as Ss,Ba as Md,C as gf,Ca as Uf,D as ai,Da as ws,E as hf,F as Ts,Fa as wa,G as ri,Ga as wd,H as bf,Ha as po,I as vf,Ia as Ds,J as yf,Ja as qf,K as _f,Ka as Wf,L as Cf,La as Ps,M as Sf,Ma as mo,N as Tf,O as xf,Oa as ve,P as ki,Q as xs,R as Oi,S as Es,T as Ia,U as Ef,V as Td,W as xd,X as Za,Y as If,Z as Mf,_ as Ed,a as Z0,aa as Df,b as Xa,ba as $i,c as ef,ca as Ai,d as xa,da as vi,e as kn,ea as yi,f as tf,g as nf,h as of,ha as Pf,i as af,ia as Ff,j as rf,ja as Af,k as sf,ka as Is,l as Sd,la as Nf,m as lf,ma as kf,n as pf,na as Of,o as mf,oa as Rf,pa as Bf,qa as Ms,ra as Vf,s as df,sa as jf,t as cf,ta as Id,u as Ea,ua as Ma,v as uf,va as ro,w as Le,wa as so,x as oi,xa as lo,y as rt,ya as _i,z as On,za as Lf}from"./chunk-MHBQMIF2.js";import"./chunk-LLNMKMJT.js";import"./chunk-55DCILP6.js";import"./chunk-GDJ62QVF.js";import"./chunk-GBVWTJHZ.js";import"./chunk-2AOTBPXD.js";import"./chunk-57DBVAFV.js";import{a as yt,b as Cs}from"./chunk-BXXDAGRQ.js";import{$a as bu,$b as Iu,$d as es,$i as u0,A as ou,Af as zu,Al as ga,Ao as X0,Ba as oa,Bf as md,Bh as ss,Bn as H0,Cc as Pn,Cd as Xr,Cf as $u,Dd as dn,Df as Ju,Dh as ua,Ea as Wr,Fh as io,Fl as M0,Gc as Du,Gl as w0,Gn as Ta,Hb as Qr,Hl as D0,Hn as Qt,Ib as Yr,Ig as dd,Il as P0,In as ys,Jb as St,Jg as is,Jh as r0,Jl as F0,Jn as z0,K as ta,Ka as he,Kb as aa,Kg as Ya,Ki as m0,Kl as ha,Lg as ns,Lh as s0,Li as ud,Mc as Pu,Mi as d0,Mn as $0,Na as mn,Nf as Yu,Ng as Ku,Nh as l0,Nn as J0,O as wi,Og as Hi,Ol as ba,On as _s,Pa as fu,Pn as Q0,Q as xn,Qa as gu,Qc as Di,Qm as va,Rh as cn,Rm as ya,S as be,Sa as Hr,Sc as Fu,Sm as _a,Ua as zr,Uc as Pi,Ui as Ka,Va as $r,W as au,Wb as Eu,Wc as Kr,We as ts,Wg as Xu,Wi as Ki,Wl as A0,X as hi,Xe as xi,Xg as Zu,Xi as ps,Ye as rd,Yg as e0,Yi as ms,Yl as N0,Z as mi,Za as to,Zg as t0,Zi as c0,_d as ma,_i as fd,aa as ad,ab as vu,ae as Wi,af as Uu,aj as f0,ba as ru,be as ju,bf as qu,bj as g0,cb as yu,ce as Lu,cf as ca,cj as h0,da as su,db as _u,dd as Au,dj as ds,eb as Cu,ed as Jt,ee as Gu,ef as Wu,ej as b0,el as us,fa as lu,fd as Nu,fh as si,fi as p0,fj as v0,g as Pt,ga as pu,gd as ku,gj as y0,gl as Fi,ha as du,hc as wt,hm as k0,i as an,id as Ou,il as gd,in as V0,ja as cu,jb as ht,jc as Mu,jd as Fn,jj as _0,jl as hd,jm as O0,jn as j0,kd as An,kl as fs,kn as bd,l as eo,lc as wu,ld as Ru,lf as Hu,lm as R0,ln as L0,m as Gi,mj as C0,ml as gs,mn as vd,n as rn,nh as os,nj as S0,nl as T0,nn as G0,o as nu,ob as In,oh as i0,oi as Bt,ol as x0,om as hs,on as yd,p as sn,pb as Mn,pf as sd,ph as n0,pi as fa,pj as oo,pm as ao,pn as U0,po as Y0,q as Ur,qa as Xt,qc as ra,qh as bi,qi as Y,qm as bs,qo as K0,ra as di,rb as wn,rf as ld,ri as cd,rn as q0,sa as ni,sb as Dn,sl as E0,sn as _d,t as jt,ta as uu,tb as xu,te as Ti,th as o0,ti as We,tn as Cd,ua as qr,ub as Jr,ui as no,un as Ca,uo as oe,va as ci,ve as da,vh as as,vi as Ge,vn as Sa,wh as gn,wi as Ft,wl as I0,wm as B0,wn as W0,xa as $t,xd as sa,xh as Nn,xo as zi,yf as vo,yh as a0,ym as vs,yo as un,zd as Bu,zf as pd,zh as rs}from"./chunk-NP42USWW.js";import{G as it,H as Ot,J as je,M as mt,N as Rt,Q as nt,W as Zn,aa as qe,da as at,e as Vi,g as pe,h as _c,j as B,ja as pa,ka as Qu,l as Cc,la as ls,m as Sn,ma as cs,r as jc,v as Lc,x as Qo,z as E}from"./chunk-NKKV3KXS.js";import{b as Be,c as iu,d as Su,e as Tu,h as Zt,j as la,n as Vu,w as Zr}from"./chunk-QR6ZNJZ6.js";import{$c as na,A as kr,Bc as S,E as Tn,Ec as W,Fc as K,H as Gc,Hc as En,Ic as ia,J as Or,K as Uc,Ka as tu,Kc as Ye,L as qc,Lc as ce,Mc as Ui,N as Yo,Nc as ii,Oc as ie,P as Li,Pc as bt,Q as kt,Qb as on,Qc as mu,Rc as se,T as pi,Vc as ln,Wc as qi,Xc as ue,Ya as $g,_c as pn,bd as dt,cd as de,dc as gt,f as Mr,hd as Ce,id as Pe,jd as Kt,kc as ee,lc as ea,ld as zt,ob as Xn,oc as Ee,od as me,pa as eu,sd as vt,td as hu,uc as ae,xc as ot,yc as ge,zc as Ht}from"./chunk-HBCL52P7.js";import{a as Xo,k as Gr}from"./chunk-OG6B6UFA.js";import{A as R,E as Rr,G as Ko,I as Wc,J as Hc,L as Qa,M as zc,Md as jr,O as $c,Od as Si,Pd as Zo,Ud as Lr,_a as Kc,a as Ne,aa as Jc,ba as Qc,bd as Xc,ca as Br,he as Zc,ic as Vr,jc as Mt,m as F,ma as Yc,n as Wt,y as Z,z as J}from"./chunk-HA3FE6NY.js";import{$c as h,$e as k,Ac as r,Af as Ho,Bc as a,Bf as $a,C as ze,Cc as f,Cf as Mc,D as sc,Dc as Gt,Df as wc,Dh as Vc,E as _t,Ea as Re,Ec as Ut,Ee as Er,Fa as Se,Fc as Vt,Fe as Ir,Ga as H,Gc as j,Gf as Ar,Ig as kc,J as Nt,Jb as zn,Jc as _,Jd as Qe,Kb as $n,Lc as v,Lg as Tt,Ma as D,Mc as Lo,N as lc,Na as qt,Nc as Jn,Ne as Uo,Ng as Nr,Oc as T,P as pc,Pb as o,Pc as bo,Qb as g,Rb as fc,Re as Ae,S as Qi,Sc as Ie,Sd as Go,Se as qo,Ta as P,Tc as Me,Td as vc,Te as Sc,Tg as Jo,Ua as z,Uc as we,Ue as ji,Va as _r,Ve as wr,Vg as Oc,Wb as vn,We as Yn,X as mc,Xb as nn,Xe as Dr,Xf as zo,Yc as U,Ye as Kn,Z as ti,Zc as p,Ze as Tc,_c as O,_f as Dc,ad as za,ag as Pc,bb as Vo,bd as Xe,bf as Ue,cb as I,cd as Ze,cf as tt,da as yr,db as M,dc as L,dd as et,ed as $e,fc as jo,g as At,ga as dc,gd as hc,gf as Mi,hd as Q,hg as Fc,i as br,id as Et,ig as Ac,j as rc,jb as ft,jc as b,jd as pt,je as Te,jg as Vn,kd as Sr,ke as G,kf as xc,kg as Oe,lb as Dt,ld as yn,le as _n,lf as Yi,mb as Cr,me as Cn,mg as $o,oc as s,od as d,of as Ec,pc as Bi,pd as c,pe as Qn,ph as jn,q as Ro,qa as cc,qb as bn,qc as V,qd as Yt,qe as le,qh as Rc,r as Bo,rd as bc,re as yc,sa as uc,sc as nd,se as Tr,sg as Nc,tc as gc,td as It,te as ke,th as Ja,ua as ho,ue as xr,uf as Ic,v as Ha,va as tn,ve as ne,vf as fi,vh as od,w as ut,wa as lt,wf as gi,x as vr,xf as Pr,ya as xt,yf as Fr,yh as Bc,zf as Wo}from"./chunk-PQ6EZO2H.js";import{a as _e,b as Ii,d as id,i as C}from"./chunk-GHMOB5KC.js";C();C();C();C();function Qg(i,m){i&1&&f(0,"mat-progress-bar",31)}function Yg(i,m){i&1&&f(0,"div",32)}function Kg(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.mail-from-required")," "))}function Xg(i,m){if(i&1&&(r(0,"mat-option",25),p(1),a()),i&2){let e,n=m.$implicit,t=v();s("value",n),o(),h(" ",((e=t.templates.get(n))==null?null:e.name)||"Custom"," ")}}function Zg(i,m){if(i&1&&(r(0,"mat-option",25),p(1),a()),i&2){let e=m.$implicit;s("value",e),o(),h(" ",e.toUpperCase()," ")}}function eh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.smtp-host-required")," "))}function th(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.smtp-port-required")," "))}function ih(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.smtp-port-invalid")," "))}function nh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.timeout-required")," "))}function oh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.timeout-invalid")," "))}function ah(i,m){if(i&1&&(r(0,"mat-option",25),p(1),a()),i&2){let e=m.$implicit;s("value",e),o(),h(" ",e," ")}}function rh(i,m){if(i&1&&(r(0,"mat-form-field",44)(1,"mat-label",12),p(2,"admin.tls-version"),a(),r(3,"mat-select",45),b(4,ah,2,2,"mat-option",16),a()()),i&2){let e=v(2);o(4),s("ngForOf",e.tlsVersions)}}function sh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.proxy-host-required")," "))}function lh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.proxy-port-required")," "))}function ph(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.proxy-port-range")," "))}function mh(i,m){if(i&1&&(r(0,"div")(1,"div",46)(2,"mat-form-field",35)(3,"mat-label",12),p(4,"admin.proxy-host"),a(),f(5,"input",47),b(6,sh,3,3,"mat-error",14),a(),r(7,"mat-form-field",37)(8,"mat-label",12),p(9,"admin.proxy-port"),a(),f(10,"input",48),b(11,lh,3,3,"mat-error",14)(12,ph,3,3,"mat-error",14),a()(),r(13,"div",49)(14,"mat-form-field",44)(15,"mat-label",12),p(16,"admin.proxy-user"),a(),f(17,"input",50),a(),r(18,"mat-form-field",44)(19,"mat-label",12),p(20,"admin.proxy-password"),a(),f(21,"input",51)(22,"tb-toggle-password",52),a()()()),i&2){let e=v(2);o(6),s("ngIf",e.mailSettings.get("proxyHost").hasError("required")),o(5),s("ngIf",e.mailSettings.get("proxyPort").hasError("required")),o(),s("ngIf",e.mailSettings.get("proxyPort").hasError("pattern")||e.mailSettings.get("proxyPort").hasError("min")||e.mailSettings.get("proxyPort").hasError("max"))}}function dh(i,m){if(i&1&&(r(0,"mat-form-field",11)(1,"mat-label",12),p(2,"admin.smtp-protocol"),a(),r(3,"mat-select",33),b(4,Zg,2,2,"mat-option",16),a()(),r(5,"div",34)(6,"mat-form-field",35)(7,"mat-label",12),p(8,"admin.smtp-host"),a(),f(9,"input",36),b(10,eh,3,3,"mat-error",14),a(),r(11,"mat-form-field",37)(12,"mat-label",12),p(13,"admin.smtp-port"),a(),f(14,"input",38,0),r(16,"mat-hint",39),p(17),a(),b(18,th,3,3,"mat-error",14)(19,ih,3,3,"mat-error",14),a()(),r(20,"mat-form-field",11)(21,"mat-label",12),p(22,"admin.timeout-msec"),a(),f(23,"input",40,1),r(25,"mat-hint",39),p(26),a(),b(27,nh,3,3,"mat-error",14)(28,oh,3,3,"mat-error",14),a(),r(29,"mat-slide-toggle",41),p(30),d(31,"translate"),a(),b(32,rh,5,1,"mat-form-field",42),r(33,"mat-slide-toggle",43),p(34),d(35,"translate"),a(),b(36,mh,23,3,"div",14)),i&2){let e=U(15),n=U(24),t=v();o(4),s("ngForOf",t.smtpProtocols),o(6),s("ngIf",t.mailSettings.get("smtpHost").hasError("required")),o(7),h("",(e.value==null?null:e.value.length)||0,"/5"),o(),s("ngIf",t.mailSettings.get("smtpPort").hasError("required")),o(),s("ngIf",t.mailSettings.get("smtpPort").hasError("pattern")||t.mailSettings.get("smtpPort").hasError("maxlength")),o(7),h("",(n.value==null?null:n.value.length)||0,"/6"),o(),s("ngIf",t.mailSettings.get("timeout").hasError("required")),o(),s("ngIf",t.mailSettings.get("timeout").hasError("pattern")||t.mailSettings.get("timeout").hasError("maxlength")),o(2),h(" ",c(31,12,"admin.enable-tls")," "),o(2),s("ngIf",t.mailSettings.get("enableTls").value),o(2),h(" ",c(35,14,"admin.enable-proxy")," "),o(2),s("ngIf",t.mailSettings.get("enableProxy").value)}}function ch(i,m){if(i&1&&(r(0,"div",53),f(1,"div",54),a()),i&2){let e=v();o(),s("tb-help",e.helpLink)}}function uh(i,m){i&1&&(r(0,"mat-checkbox",57),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.change-password")," "))}function fh(i,m){i&1&&(r(0,"mat-form-field",11)(1,"mat-label",12),p(2,"common.password"),a(),f(3,"input",58),d(4,"translate"),f(5,"tb-toggle-password",52),a()),i&2&&(o(3),T("placeholder",c(4,1,"common.enter-password")))}function gh(i,m){if(i&1&&(r(0,"section"),b(1,uh,3,3,"mat-checkbox",55)(2,fh,6,3,"mat-form-field",56),a()),i&2){let e=v();o(),s("ngIf",e.showChangePassword),o(),s("ngIf",e.mailSettings.get("changePassword").value||!e.showChangePassword)}}function hh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-id-required")," "))}function bh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-id-max-length")," "))}function vh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-secret-required")," "))}function yh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-secret-max-length")," "))}function _h(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.microsoft-tenant-id-required")," "))}function Ch(i,m){if(i&1&&(r(0,"mat-form-field",44)(1,"mat-label",12),p(2,"admin.oauth2.microsoft-tenant-id"),a(),f(3,"input",72),b(4,_h,3,3,"mat-error",14),a()),i&2){let e=v(2);o(4),s("ngIf",e.mailSettings.get("providerTenantId").hasError("required"))}}function Sh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.access-token-uri-required")," "))}function Th(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.uri-pattern-error")," "))}function xh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.access-token-uri-required")," "))}function Eh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.uri-pattern-error")," "))}function Ih(i,m){if(i&1){let e=j();r(0,"div",49)(1,"mat-form-field",44)(2,"mat-label",12),p(3,"admin.oauth2.authorization-uri"),a(),f(4,"input",73),r(5,"button",74),_("click",function(){I(e);let t=v(2);return M(t.toggleEditMode("authUri"))}),r(6,"mat-icon",75),p(7,"create"),a()(),b(8,Sh,3,3,"mat-error",14)(9,Th,3,3,"mat-error",14),a(),r(10,"mat-form-field",44)(11,"mat-label",12),p(12,"admin.oauth2.token-uri"),a(),f(13,"input",76),r(14,"button",74),_("click",function(){I(e);let t=v(2);return M(t.toggleEditMode("tokenUri"))}),r(15,"mat-icon",75),p(16,"create"),a()(),b(17,xh,3,3,"mat-error",14)(18,Eh,3,3,"mat-error",14),a()(),f(19,"tb-string-items-list",77),d(20,"translate"),d(21,"translate")}if(i&2){let e=v(2);o(8),s("ngIf",e.mailSettings.get("authUri").hasError("required")),o(),s("ngIf",e.mailSettings.get("authUri").hasError("pattern")),o(8),s("ngIf",e.mailSettings.get("tokenUri").hasError("required")),o(),s("ngIf",e.mailSettings.get("tokenUri").hasError("pattern")),o(),T("label",c(20,6,"admin.oauth2.scope")),T("requiredText",c(21,8,"admin.oauth2.scope-required"))}}function Mh(i,m){if(i&1&&(r(0,"mat-option",25),p(1),d(2,"translate"),d(3,"uppercase"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(3,4,c(2,2,n.domainSchemaTranslations.get(e)))," ")}}function wh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.error-verification-url")," "))}function Dh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.domain-name-max-length")," "))}function Ph(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.domain-name-unique")," "))}function Fh(i,m){if(i&1&&(r(0,"section")(1,"div",49)(2,"mat-form-field",44)(3,"mat-label",12),p(4,"admin.oauth2.client-id"),a(),f(5,"input",59),b(6,hh,3,3,"mat-error",14)(7,bh,3,3,"mat-error",14),a(),r(8,"mat-form-field",44)(9,"mat-label",12),p(10,"admin.oauth2.client-secret"),a(),f(11,"input",60),b(12,vh,3,3,"mat-error",14)(13,yh,3,3,"mat-error",14),a()(),b(14,Ch,5,1,"mat-form-field",42),r(15,"mat-expansion-panel",61)(16,"mat-expansion-panel-header")(17,"mat-panel-description",62),p(18," tenant-profile.advanced-settings "),a()(),b(19,Ih,22,10,"ng-template",19),a(),r(20,"fieldset",20)(21,"legend",21),p(22,"admin.oauth2.redirect-uri"),a(),r(23,"div",63)(24,"div",64)(25,"div",65)(26,"mat-form-field",66)(27,"mat-label",12),p(28,"admin.oauth2.protocol"),a(),r(29,"mat-select",67),b(30,Mh,4,6,"mat-option",16),a()(),r(31,"mat-form-field",44)(32,"mat-label",12),p(33,"admin.domain-name"),a(),f(34,"input",68),b(35,wh,3,3,"mat-error",14)(36,Dh,3,3,"mat-error",14),a()(),b(37,Ph,3,3,"mat-error",14),a(),r(38,"div",69)(39,"mat-form-field",44)(40,"mat-label",12),p(41,"admin.oauth2.redirect-uri-template"),a(),f(42,"input",70)(43,"tb-copy-button",71),d(44,"translate"),a()()()()()),i&2){let e=v();o(6),s("ngIf",e.mailSettings.get("clientId").hasError("required")),o(),s("ngIf",e.mailSettings.get("clientId").hasError("maxlen gth")),o(5),s("ngIf",e.mailSettings.get("clientSecret").hasError("required")),o(),s("ngIf",e.mailSettings.get("clientSecret").hasError("maxlength")),o(),s("ngIf",e.mailSettings.get("providerId").value===e.mailServerOauth2Provider.OFFICE_365),o(),s("expanded",e.mailSettings.get("providerId").value===e.mailServerOauth2Provider.CUSTOM),o(9),s("formGroup",e.domainForm),o(6),s("ngForOf",e.protocols),o(5),s("ngIf",e.domainForm.get("name").hasError("pattern")),o(),s("ngIf",e.domainForm.get("name").hasError("maxlength")),o(),s("ngIf",e.domainForm.hasError("unique")),o(6),T("tooltipText",c(44,13,"admin.oauth2.copy-redirect-uri")),s("copyText",e.mailSettings.get("redirectUri").value)}}function Ah(i,m){if(i&1){let e=j();r(0,"section",78)(1,"div")(2,"span",79),p(3,"admin.oauth2.access-token-status"),a(),r(4,"span"),p(5),a()(),r(6,"button",80),d(7,"async"),_("click",function(){I(e);let t=v();return M(t.generateAccessToken())}),p(8),a()()}if(i&2){let e=v();o(5),h(" ",e.accessTokenStatus," "),o(),s("disabled",c(7,3,e.isLoading$)||e.mailSettings.invalid||e.domainForm.invalid||e.mailSettings.dirty||e.domainForm.dirty),o(2),h(" ",e.accessTokenButtonName," ")}}var Os=(()=>{class i extends Mt{constructor(e,n,t,l,u){super(e),this.store=e,this.adminService=n,this.translate=t,this.fb=l,this.window=u,this.smtpProtocols=Object.values(Xa),this.showChangePassword=!1,this.protocols=Object.values(qo).filter(y=>y!==qo.MIXED),this.domainSchemaTranslations=Sc,this.mailServerOauth2Provider=ef,this.tlsVersions=["TLSv1","TLSv1.1","TLSv1.2","TLSv1.3"],this.templates=new Map,this.templateProvider=["CUSTOM"],this.destroy$=new At,this.DOMAIN_AND_PORT_REGEXP=/^(?:\w+(?::\w+)?@)?[^\s/]+(?::\d+)?$/,this.URL_REGEXP=/^[A-Za-z][A-Za-z\d.+-]*:\/*(?:\w+(?::\w+)?@)?[^\s/]+(?::\d+)?(?:\/[\w#!:.,?+=&%@\-/]*)?$/,this.mailSettings=this.fb.group({mailFrom:["",[S.required]],smtpProtocol:[Xa.SMTP],smtpHost:["localhost",[S.required]],smtpPort:[25,[S.required,S.pattern(Z0),S.maxLength(5)]],timeout:[1e4,[S.required,S.pattern(/^[0-9]{1,6}$/),S.maxLength(6)]],enableTls:[!1],tlsVersion:[{value:null,disabled:!0}],enableProxy:[!1],proxyHost:[{value:"",disabled:!0},[S.required]],proxyPort:[{value:null,disabled:!0},[S.required,S.min(1),S.max(65535)]],proxyUser:[{value:"",disabled:!0}],proxyPassword:[{value:"",disabled:!0}],username:[""],changePassword:[!1],password:[""],enableOauth2:[!1],providerId:["CUSTOM",[S.required]],clientId:[{value:"",disabled:!0},[S.required,S.maxLength(255)]],clientSecret:[{value:"",disabled:!0},[S.required,S.maxLength(2048)]],providerTenantId:[{value:"",disabled:!0},[S.required]],authUri:[{value:"",disabled:!0},[S.required,S.pattern(this.URL_REGEXP)]],tokenUri:[{value:"",disabled:!0},[S.required,S.pattern(this.URL_REGEXP)]],scope:this.fb.control({value:[],disabled:!0},S.required),redirectUri:[{value:"",disabled:!0}]}),this.defaultConfiguration={providerId:"CUSTOM",smtpProtocol:Xa.SMTP,smtpHost:"",smtpPort:null,timeout:null,enableTls:!1,tlsVersion:null,enableProxy:!1,proxyHost:"",proxyPort:null,proxyUser:"",proxyPassword:"",enableOauth2:!1,clientId:"",clientSecret:"",providerTenantId:"",authUri:"",tokenUri:"",scope:[],redirectUri:""},this.domainForm=this.fb.group({name:[this.window.location.hostname,[S.required,S.maxLength(255),S.pattern(this.DOMAIN_AND_PORT_REGEXP)]],scheme:[qo.HTTPS,S.required]})}ngOnInit(){this.mailServerSettingsForm(),this.domainFormConfiguration(),Nt({loginProcessingUrl:this.adminService.getLoginProcessingUrl(),mailConfigTemplate:this.adminService.getMailConfigTemplate(),adminSettings:this.adminService.getAdminSettings("mail")}).subscribe(e=>{this.loginProcessingUrl=e.loginProcessingUrl,this.initTemplates(e.mailConfigTemplate),this.adminSettings=e.adminSettings,this.adminSettings.jsonValue&&Nc(this.adminSettings.jsonValue.enableTls)&&(this.adminSettings.jsonValue.enableTls=this.adminSettings.jsonValue.enableTls==="true"),this.showChangePassword=Oe(this.adminSettings.jsonValue.showChangePassword)?this.adminSettings.jsonValue.showChangePassword:!0,delete this.adminSettings.jsonValue.showChangePassword,this.adminSettings.jsonValue.providerId||(this.adminSettings.jsonValue.providerId="CUSTOM"),this.mailSettings.reset(this.adminSettings.jsonValue,{emitEvent:!1}),this.enableMailPassword(!this.showChangePassword),this.enableProxyChanged(),this.enableTls(this.adminSettings.jsonValue.enableTls),this.helpLink=this.templates.get(this.adminSettings.jsonValue.providerId)?.helpLink||null,this.adminSettings.jsonValue.enableOauth2?(this.enableOauth2(!!this.adminSettings.jsonValue.enableOauth2),this.enableProviderTenantIdChanged(this.adminSettings.jsonValue.providerId),this.parseUrl(this.adminSettings.jsonValue.redirectUri),this.mailSettings.get("redirectUri").patchValue(this.adminSettings.jsonValue.redirectUri,{emitEvent:!1})):this.mailSettings.get("enableOauth2").patchValue(!1,{emitEvent:!1})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),super.ngOnDestroy()}initTemplates(e){e.map(n=>{delete n.additionalInfo,this.templates.set(n.providerId,n)}),this.templateProvider.push(...Array.from(this.templates.keys())),this.templateProvider.sort()}mailServerSettingsForm(){this.registerDisableOnLoadFormControl(this.mailSettings.get("smtpProtocol")),this.registerDisableOnLoadFormControl(this.mailSettings.get("enableTls")),this.registerDisableOnLoadFormControl(this.mailSettings.get("enableProxy")),this.registerDisableOnLoadFormControl(this.mailSettings.get("changePassword")),this.mailSettings.get("enableTls").valueChanges.pipe(lt(this.destroy$)).subscribe(e=>this.enableTls(e)),this.mailSettings.get("enableProxy").valueChanges.pipe(lt(this.destroy$)).subscribe(()=>{this.enableProxyChanged()}),this.mailSettings.get("changePassword").valueChanges.pipe(lt(this.destroy$)).subscribe(e=>{this.enableMailPassword(e)}),this.mailSettings.get("enableOauth2").valueChanges.pipe(lt(this.destroy$)).subscribe(e=>{this.enableOauth2(e),this.enableProviderTenantIdChanged(this.mailSettings.get("providerId").value),e&&!this.mailSettings.get("redirectUri").value&&this.mailSettings.get("redirectUri").patchValue(this.redirectURI(),{emitEvent:!1})}),this.mailSettings.get("providerTenantId").valueChanges.pipe(lt(this.destroy$)).subscribe(e=>{let n=this.templates.get(this.mailServerOauth2Provider.OFFICE_365).authorizationUri.replace("%s",`${e}`),t=this.templates.get(this.mailServerOauth2Provider.OFFICE_365).accessTokenUri.replace("%s",`${e}`);this.mailSettings.get("authUri").patchValue(n,{emitEvent:!1}),this.mailSettings.get("tokenUri").patchValue(t,{emitEvent:!1})}),this.mailSettings.get("providerId").valueChanges.pipe(lt(this.destroy$)).subscribe(e=>{if(e===this.mailServerOauth2Provider.CUSTOM||!e)this.mailSettings.reset(_e(_e({},this.adminSettings.jsonValue),this.defaultConfiguration),{emitEvent:!1});else{let n=this.templates.get(e);this.helpLink=n.helpLink,this.mailSettings.patchValue({smtpProtocol:Xa[n.smtpProtocol],smtpHost:n.smtpHost,smtpPort:n.smtpPort,timeout:n.timeout,enableTls:n.enableTls,tlsVersion:n.tlsVersion,authUri:n.authorizationUri,tokenUri:n.accessTokenUri,scope:n.scope,enableOauth2:!1,enableProxy:!1,proxyHost:"",proxyPort:null,proxyUser:"",proxyPassword:"",clientId:"",clientSecret:"",providerTenantId:"",redirectUri:""},{emitEvent:!1})}this.enableTls(this.mailSettings.get("enableTls").value),this.enableOauth2(this.mailSettings.get("enableOauth2").value),this.enableProviderTenantIdChanged(e)})}domainFormConfiguration(){this.domainForm.get("name").valueChanges.pipe(lt(this.destroy$)).subscribe(e=>this.mailSettings.get("redirectUri").patchValue(this.redirectURI(this.domainForm.get("scheme").value,e),{emitEvent:!1})),this.domainForm.get("scheme").valueChanges.pipe(lt(this.destroy$)).subscribe(e=>this.mailSettings.get("redirectUri").patchValue(this.redirectURI(e),{emitEvent:!1}))}enableOauth2(e){e?(this.mailSettings.get("clientId").enable({emitEvent:!1}),this.mailSettings.get("clientSecret").enable({emitEvent:!1}),this.mailSettings.get("redirectUri").enable({emitEvent:!1}),this.mailSettings.get("scope").enable({emitEvent:!1}),this.mailSettings.get("providerId").value===this.mailServerOauth2Provider.CUSTOM?(this.mailSettings.get("authUri").enable({emitEvent:!1}),this.mailSettings.get("tokenUri").enable({emitEvent:!1})):(this.mailSettings.get("authUri").disable({emitEvent:!1}),this.mailSettings.get("tokenUri").disable({emitEvent:!1}))):(this.mailSettings.get("clientId").disable({emitEvent:!1}),this.mailSettings.get("clientSecret").disable({emitEvent:!1}),this.mailSettings.get("redirectUri").disable({emitEvent:!1}),this.mailSettings.get("authUri").disable({emitEvent:!1}),this.mailSettings.get("tokenUri").disable({emitEvent:!1}),this.mailSettings.get("scope").disable({emitEvent:!1}))}enableProviderTenantIdChanged(e){e===this.mailServerOauth2Provider.OFFICE_365&&this.mailSettings.get("enableOauth2").value?this.mailSettings.get("providerTenantId").enable({emitEvent:!1}):this.mailSettings.get("providerTenantId").disable({emitEvent:!1})}enableProxyChanged(){this.mailSettings.get("enableProxy").value?(this.mailSettings.get("proxyHost").enable({emitEvent:!1}),this.mailSettings.get("proxyPort").enable({emitEvent:!1}),this.mailSettings.get("proxyUser").enable({emitEvent:!1}),this.mailSettings.get("proxyPassword").enable({emitEvent:!1})):(this.mailSettings.get("proxyHost").disable({emitEvent:!1}),this.mailSettings.get("proxyPort").disable({emitEvent:!1}),this.mailSettings.get("proxyUser").disable({emitEvent:!1}),this.mailSettings.get("proxyPassword").disable({emitEvent:!1}))}enableMailPassword(e){e?this.mailSettings.get("password").enable({emitEvent:!1}):this.mailSettings.get("password").disable({emitEvent:!1})}enableTls(e){e?this.mailSettings.get("tlsVersion").enable({emitEvent:!1}):this.mailSettings.get("tlsVersion").disable({emitEvent:!1})}sendTestMail(){this.adminSettings.jsonValue=_e(_e({},this.adminSettings.jsonValue),this.mailSettingsFormValue),this.adminService.sendTestMail(this.adminSettings).subscribe({next:()=>this.store.dispatch(new Be({message:this.translate.instant("admin.test-mail-sent"),type:"success"})),error:e=>this.store.dispatch(new Be({message:e.error.message,type:"error"}))})}save(){this.adminSettings.jsonValue=_e(_e({},this.adminSettings.jsonValue),this.mailSettingsFormValue),this.adminService.saveAdminSettings(this.adminSettings).subscribe(e=>{this.adminSettings=e,this.showChangePassword=!0,this.mailSettings.reset(this.adminSettings.jsonValue,{emitEvent:!1}),this.domainForm.reset(this.domainForm.value),this.parseUrl(this.adminSettings.jsonValue.redirectUri)})}generateAccessToken(){this.adminService.generateAccessToken().subscribe(e=>this.window.location.href=e)}redirectURI(e,n){let t=this.domainForm.value;if(t.name!==""){let l=Vn(e)?e.toLowerCase():t.scheme.toLowerCase(),u=Vn(n)?n:t.name;return`${l}://${u}${this.loginProcessingUrl}`}return""}parseUrl(e){if(e){let n=new URL(e);this.domainForm.get("scheme").patchValue(n.protocol.startsWith("https")?qo.HTTPS:qo.HTTP,{emitEvent:!1}),this.domainForm.get("name").patchValue(n.host,{emitEvent:!1})}}get accessTokenButtonName(){return this.translate.instant(this.adminSettings.jsonValue.tokenGenerated?"admin.oauth2.update-access-token":"admin.oauth2.generate-access-token")}get accessTokenStatus(){return this.translate.instant(this.adminSettings.jsonValue.tokenGenerated?"admin.oauth2.token-status-generated":"admin.oauth2.token-status-not-generated")}confirmForm(){return this.mailSettings}get mailSettingsFormValue(){let e=this.mailSettings.getRawValue();return delete e.changePassword,Oe(e.password)||delete e.password,e}toggleEditMode(e){this.mailSettings.get(e).disabled?this.mailSettings.get(e).enable():this.mailSettings.get(e).disable()}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(kn),g(Z),g(dt),g(Xo))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-mail-server"]],features:[L],decls:60,vars:42,consts:[["smtpPortInput",""],["timeoutInput",""],["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","outgoingMailSettings"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[3,"ngSubmit","formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","formControlName","mailFrom","required",""],[4,"ngIf"],["formControlName","providerId"],[3,"value",4,"ngFor","ngForOf"],[1,"configuration-panel","mat-elevation-z0",3,"expanded"],["translate","",1,"flex","items-center","justify-start"],["matExpansionPanelContent",""],[1,"fields-group","flex","flex-col"],["translate","",1,"group-title"],["matInput","","formControlName","username","autocomplete","new-username",3,"placeholder"],[1,"flex","items-center","justify-between",2,"height","50px","padding-bottom","20px"],["formControlName","enableOauth2","appearance","fill",1,"w-52"],[3,"value"],["class","details-buttons",4,"ngIf"],["class","flex flex-row pb-3 xs:flex-col gt-xs:items-center gt-xs:justify-between",4,"ngIf"],[1,"flex","flex-row","items-center","justify-end","gap-4","xs:flex-col","xs:items-stretch"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],["formControlName","smtpProtocol"],[1,"gt-sm:flex","gt-sm:flex-row","gt-sm:gap-2.5"],[1,"mat-block","flex-full","gt-sm:max-w-60%"],["matInput","","formControlName","smtpHost","placeholder","localhost","required",""],[1,"mat-block","flex-full","gt-sm:max-w-40%"],["matInput","","formControlName","smtpPort","placeholder","25","maxlength","5","required",""],["align","end"],["matInput","","formControlName","timeout","placeholder","10000","maxlength","6","required",""],["formControlName","enableTls",1,"flex-1",2,"display","block","padding-bottom","22px"],["class","mat-block flex-1",4,"ngIf"],["formControlName","enableProxy",2,"display","block","padding-bottom","22px"],[1,"mat-block","flex-1"],["formControlName","tlsVersion"],[1,"gt-sm:flex","gt-sm:flex-row","gt-sm:gap-2"],["matInput","","required","","formControlName","proxyHost"],["matInput","","required","","formControlName","proxyPort","type","number","step","1","min","1","max","65535"],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],["matInput","","formControlName","proxyUser"],["matInput","","type","password","formControlName","proxyPassword","autocomplete","new-proxy-password"],["matSuffix",""],[1,"details-buttons"],[3,"tb-help"],["formControlName","changePassword","style","padding-bottom: 16px;",4,"ngIf"],["class","mat-block",4,"ngIf"],["formControlName","changePassword",2,"padding-bottom","16px"],["matInput","","formControlName","password","type","password","autocomplete","new-password",3,"placeholder"],["matInput","","formControlName","clientId","required",""],["matInput","","formControlName","clientSecret","required",""],[1,"mat-elevation-z0",3,"expanded"],["translate","",1,"flex","items-stretch","justify-end"],[1,"flex","flex-1","flex-row","gap-2","xs:flex-col"],[1,"flex","flex-col","sm:max-w-60%","sm:flex-full","gt-sm:max-w-50%","gt-sm:flex-full",3,"formGroup"],[1,"flex","flex-row","gap-2","xs:flex-col","md:flex-col","md:gap-0"],[1,"mat-block","max-w-30%","flex-full","xs:max-w-full","xs:flex-1","md:max-w-full","md:flex-1"],["formControlName","scheme"],["matInput","","formControlName","name","required",""],[1,"flex","flex-1","flex-col"],["matInput","","formControlName","redirectUri","readonly",""],["matSuffix","","color","primary","tooltipPosition","above","icon","mdi:clipboard-arrow-left",3,"copyText","tooltipText"],["matInput","","formControlName","providerTenantId","required",""],["matInput","","formControlName","authUri","required",""],["mat-icon-button","","matSuffix","","type","button",3,"click"],[1,"material-icons"],["matInput","","formControlName","tokenUri","required",""],["formControlName","scope","required","",3,"label","requiredText"],[1,"flex","flex-row","pb-3","xs:flex-col","gt-xs:items-center","gt-xs:justify-between"],["translate","",1,"token-status"],["mat-raised-button","","type","button","color","primary",3,"click","disabled"]],template:function(n,t){n&1&&(r(0,"div")(1,"mat-card",2)(2,"mat-card-header")(3,"mat-card-title")(4,"span",3),p(5,"admin.outgoing-mail-settings"),a()(),f(6,"span",4)(7,"div",5),a(),b(8,Qg,1,0,"mat-progress-bar",6),d(9,"async"),b(10,Yg,1,0,"div",7),d(11,"async"),r(12,"mat-card-content",8)(13,"form",9),_("ngSubmit",function(){return t.save()}),r(14,"fieldset",10),d(15,"async"),r(16,"mat-form-field",11)(17,"mat-label",12),p(18,"admin.mail-from"),a(),f(19,"input",13),b(20,Kg,3,3,"mat-error",14),a(),r(21,"mat-form-field",11)(22,"mat-label",12),p(23,"admin.oauth2.smtp-provider"),a(),r(24,"mat-select",15),b(25,Xg,2,2,"mat-option",16),a()(),r(26,"mat-expansion-panel",17)(27,"mat-expansion-panel-header")(28,"mat-panel-title",18),p(29," admin.connection-settings "),a()(),b(30,dh,37,16,"ng-template",19),a(),r(31,"fieldset",20)(32,"legend",21),p(33,"admin.oauth2.authentication"),a(),r(34,"mat-form-field",11)(35,"mat-label",12),p(36,"common.username"),a(),f(37,"input",22),d(38,"translate"),a(),r(39,"div",23)(40,"tb-toggle-select",24)(41,"tb-toggle-option",25),p(42),d(43,"translate"),a(),r(44,"tb-toggle-option",25),p(45),d(46,"translate"),a()(),b(47,ch,2,1,"div",26),a(),b(48,gh,3,2,"section",14)(49,Fh,45,15,"section",14)(50,Ah,9,5,"section",27),a(),r(51,"div",28)(52,"button",29),d(53,"async"),_("click",function(){return t.sendTestMail()}),p(54),d(55,"translate"),a(),r(56,"button",30),d(57,"async"),p(58),d(59,"translate"),a()()()()()()()),n&2&&(o(8),s("ngIf",c(9,22,t.isLoading$)),o(2),s("ngIf",!c(11,24,t.isLoading$)),o(3),s("formGroup",t.mailSettings),o(),s("disabled",c(15,26,t.isLoading$)),o(6),s("ngIf",t.mailSettings.get("mailFrom").hasError("required")),o(5),s("ngForOf",t.templateProvider),o(),s("expanded",t.mailSettings.get("providerId").value===t.mailServerOauth2Provider.CUSTOM),o(11),T("placeholder",c(38,28,"common.enter-username")),o(2),V("!hidden",t.mailSettings.get("providerId").value==="SENDGRID"),o(2),s("value",!1),o(),O(c(43,30,"admin.oauth2.basic")),o(2),s("value",!0),o(),O(c(46,32,"admin.oauth2.oauth2")),o(2),s("ngIf",t.helpLink&&t.mailSettings.get("enableOauth2").value),o(),s("ngIf",!t.mailSettings.get("enableOauth2").value),o(),s("ngIf",t.mailSettings.get("enableOauth2").value),o(),s("ngIf",t.mailSettings.get("enableOauth2").value),o(2),s("disabled",c(53,34,t.isLoading$)||t.mailSettings.get("enableOauth2").value?t.mailSettings.invalid||t.domainForm.invalid||t.mailSettings.dirty||t.domainForm.dirty:t.mailSettings.invalid),o(2),h(" ",c(55,36,"admin.send-test-mail")," "),o(2),s("disabled",c(57,38,t.isLoading$)||t.mailSettings.invalid||t.domainForm.invalid||!t.mailSettings.dirty&&!t.domainForm.dirty),o(2),h("",c(59,40,"action.save")," "))},dependencies:[Te,G,wt,cn,ee,Ee,$t,ae,Xt,ni,ci,di,qe,he,me,Ce,Kt,Pe,zt,vt,gt,ht,Gi,rn,sn,nu,eo,ce,ge,Ui,W,K,ue,pn,qi,ln,ie,se,J,ga,vs,Di,Pi,le,Tr,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 8px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{margin-bottom:8px;color:#000000b3;width:fit-content}[_nghost-%COMP%]   .token-status[_ngcontent-%COMP%]{font:400 14px/16px Roboto,Helvetica Neue,sans-serif;color:#0009;letter-spacing:.25px;padding:8px 0}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-header{height:48px;padding:0 12px}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-header.mat-expanded{height:48px}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-body{padding:0 12px}[_nghost-%COMP%]     .mat-expansion-panel.configuration-panel{border:1px solid rgba(0,0,0,.2)}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   mat-card-header.mat-mdc-card-header[_ngcontent-%COMP%]{align-items:center}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}return i})();C();var Da=i=>({protocol:i});function kh(i,m){i&1&&f(0,"mat-progress-bar",25)}function Oh(i,m){i&1&&f(0,"div",26)}function Rh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.base-url-required")," "))}function Bh(i,m){i&1&&f(0,"mat-progress-bar",25)}function Vh(i,m){i&1&&f(0,"div",26)}function jh(i,m){i&1&&Vt(0)}function Lh(i,m){i&1&&Vt(0)}function Gh(i,m){if(i&1&&(Gt(0),b(1,jh,1,0,"ng-container",27)(2,Lh,1,0,"ng-container",27),Ut()),i&2){let e=v(),n=U(63);o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(4,Da,e.protocol)),o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(6,Da,e.protocol+"s"))}}function Uh(i,m){i&1&&Vt(0)}function qh(i,m){i&1&&Vt(0)}function Wh(i,m){if(i&1&&(Gt(0),b(1,Uh,1,0,"ng-container",27)(2,qh,1,0,"ng-container",27),Ut()),i&2){let e=v(),n=U(63);o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(4,Da,e.protocol)),o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(6,Da,e.protocol+"s"))}}function Hh(i,m){i&1&&Vt(0)}function zh(i,m){i&1&&Vt(0)}function $h(i,m){if(i&1&&(Gt(0),b(1,Hh,1,0,"ng-container",27)(2,zh,1,0,"ng-container",27),Ut()),i&2){let e=v(),n=U(63);o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(4,Da,e.protocol)),o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(6,Da,e.protocol+"s"))}}function Jh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.device-connectivity.port-pattern")," "))}function Qh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.device-connectivity.port-range")," "))}function Yh(i,m){if(i&1&&(r(0,"div",28)(1,"mat-slide-toggle",29),p(2),d(3,"translate"),a(),r(4,"div",30)(5,"mat-form-field",31)(6,"mat-label",9),p(7,"admin.device-connectivity.host"),a(),f(8,"input",32),a(),r(9,"mat-form-field",31)(10,"mat-label",9),p(11,"admin.device-connectivity.port"),a(),f(12,"input",33),b(13,Jh,3,3,"mat-error",11)(14,Qh,3,3,"mat-error",11),a()()()),i&2){let e=m.protocol,n=v();s("formGroupName",e),o(2),h(" ",c(3,4,"admin.device-connectivity."+e)," "),o(11),s("ngIf",n.deviceConnectivitySettingsForm.get(e+".port").hasError("pattern")),o(),s("ngIf",n.deviceConnectivitySettingsForm.get(e+".port").hasError("min")||n.deviceConnectivitySettingsForm.get(e+".port").hasError("max"))}}var Rs=(()=>{class i extends Mt{constructor(e,n,t){super(e),this.store=e,this.adminService=n,this.fb=t,this.protocol="http",this.destroy$=new At,this.buildGeneralServerSettingsForm(),this.adminService.getAdminSettings("general").subscribe(l=>this.processGeneralSettings(l)),this.buildDeviceConnectivitySettingsForm(),this.adminService.getAdminSettings("connectivity").subscribe(l=>this.processDeviceConnectivitySettings(l))}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}buildGeneralServerSettingsForm(){this.generalSettings=this.fb.group({baseUrl:["",[S.required]],prohibitDifferentUrl:["",[]]})}buildDeviceConnectivitySettingsForm(){this.deviceConnectivitySettingsForm=this.fb.group({http:this.buildDeviceConnectivityInfoForm(),https:this.buildDeviceConnectivityInfoForm(),mqtt:this.buildDeviceConnectivityInfoForm(),mqtts:this.buildDeviceConnectivityInfoForm(),coap:this.buildDeviceConnectivityInfoForm(),coaps:this.buildDeviceConnectivityInfoForm()})}buildDeviceConnectivityInfoForm(){let e=this.fb.group({enabled:[!1,[]],host:[{value:"",disabled:!0}],port:[{value:null,disabled:!0},[S.min(1),S.max(65535),S.pattern("[0-9]*")]]});return e.get("enabled").valueChanges.pipe(lt(this.destroy$)).subscribe(n=>{n?(e.get("host").enable({emitEvent:!1}),e.get("port").enable({emitEvent:!1})):(e.get("host").disable({emitEvent:!1}),e.get("port").disable({emitEvent:!1}))}),e}save(){this.adminSettings.jsonValue=_e(_e({},this.adminSettings.jsonValue),this.generalSettings.value),this.adminService.saveAdminSettings(this.adminSettings).subscribe(e=>this.processGeneralSettings(e))}saveDeviceConnectivitySettings(){this.deviceConnectivitySettings.jsonValue=_e(_e({},this.deviceConnectivitySettings.jsonValue),this.deviceConnectivitySettingsForm.getRawValue()),this.adminService.saveAdminSettings(this.deviceConnectivitySettings).subscribe(e=>this.processDeviceConnectivitySettings(e))}discardGeneralSettings(){this.generalSettings.reset(this.adminSettings.jsonValue)}discardDeviceConnectivitySettings(){this.deviceConnectivitySettingsForm.reset(this.deviceConnectivitySettings.jsonValue)}processGeneralSettings(e){this.adminSettings=e,this.generalSettings.reset(this.adminSettings.jsonValue)}processDeviceConnectivitySettings(e){this.deviceConnectivitySettings=e,this.deviceConnectivitySettingsForm.reset(this.deviceConnectivitySettings.jsonValue)}confirmForm(){return this.generalSettings.dirty?this.generalSettings:this.deviceConnectivitySettingsForm}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(kn),g(dt))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-general-settings"]],features:[L],decls:72,vars:60,consts:[["connectivitySettings",""],["appearance","outlined",1,"settings-card"],[1,"flex","flex-row"],["translate","",1,"mat-headline-5"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[1,"tb-form-panel","no-border","no-padding",3,"ngSubmit","formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","formControlName","baseUrl","required",""],[4,"ngIf"],[1,"tb-form-row",3,"tb-hint-tooltip-icon"],["formControlName","prohibitDifferentUrl",1,"mat-slide","margin"],[1,"flex","flex-row","flex-wrap","items-center","justify-end","gap-2"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],[1,"tb-form-panel","no-border","no-padding"],[1,"tb-form-panel","no-border","no-padding","toggle-group"],["appearance","fill",3,"ngModelChange","ngModel"],["value","http"],["value","mqtt"],["value","coap"],[1,"tb-form-hint","tb-primary-fill"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"tb-form-panel","stroked","no-padding-bottom",3,"formGroupName"],["formControlName","enabled",1,"mat-slide"],[1,"tb-form-row","column-xs","no-border","no-padding","tb-standard-fields"],[1,"flex-1"],["matInput","","formControlName","host"],["matInput","","type","number","min","0","max","65535","formControlName","port"]],template:function(n,t){if(n&1){let l=j();r(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title")(3,"div",2)(4,"span",3),p(5,"admin.general-settings"),a()()()(),b(6,kh,1,0,"mat-progress-bar",4),d(7,"async"),b(8,Oh,1,0,"div",5),d(9,"async"),r(10,"mat-card-content")(11,"form",6),_("ngSubmit",function(){return I(l),M(t.save())}),r(12,"fieldset",7),d(13,"async"),r(14,"div")(15,"mat-form-field",8)(16,"mat-label",9),p(17,"admin.base-url"),a(),f(18,"input",10),b(19,Rh,3,3,"mat-error",11),a(),r(20,"div",12),d(21,"translate"),r(22,"mat-slide-toggle",13),p(23),d(24,"translate"),a()()()(),r(25,"div",14)(26,"button",15),_("click",function(){return I(l),M(t.discardGeneralSettings())}),p(27),d(28,"translate"),a(),r(29,"button",16),d(30,"async"),p(31),d(32,"translate"),a()()()()(),r(33,"mat-card",1)(34,"mat-card-header")(35,"mat-card-title")(36,"div",3),p(37,"admin.device-connectivity.device-connectivity"),a()()(),b(38,Bh,1,0,"mat-progress-bar",4),d(39,"async"),b(40,Vh,1,0,"div",5),d(41,"async"),r(42,"mat-card-content")(43,"section",17)(44,"div",18)(45,"tb-toggle-select",19),et("ngModelChange",function(y){return I(l),Ze(t.protocol,y)||(t.protocol=y),M(y)}),r(46,"tb-toggle-option",20),p(47),d(48,"translate"),a(),r(49,"tb-toggle-option",21),p(50),d(51,"translate"),a(),r(52,"tb-toggle-option",22),p(53),d(54,"translate"),a()(),r(55,"div",23),p(56),d(57,"translate"),a()(),r(58,"form",6),_("ngSubmit",function(){return I(l),M(t.saveDeviceConnectivitySettings())}),b(59,Gh,3,8,"ng-container",11)(60,Wh,3,8,"ng-container",11)(61,$h,3,8,"ng-container",11)(62,Yh,15,6,"ng-template",null,0,It),r(64,"div",14)(65,"button",15),_("click",function(){return I(l),M(t.discardDeviceConnectivitySettings())}),p(66),d(67,"translate"),a(),r(68,"button",24),d(69,"async"),p(70),d(71,"translate"),a()()()()()()}n&2&&(o(6),s("ngIf",c(7,26,t.isLoading$)),o(2),s("ngIf",!c(9,28,t.isLoading$)),o(3),s("formGroup",t.generalSettings),o(),s("disabled",c(13,30,t.isLoading$)),o(7),s("ngIf",t.generalSettings.get("baseUrl").hasError("required")),o(),T("tb-hint-tooltip-icon",c(21,32,"admin.prohibit-different-url-hint")),o(3),h(" ",c(24,34,"admin.prohibit-different-url")," "),o(3),s("disabled",t.generalSettings.pristine),o(),h("",c(28,36,"action.undo")," "),o(2),s("disabled",c(30,38,t.isLoading$)||t.generalSettings.invalid||!t.generalSettings.dirty),o(2),h("",c(32,40,"action.save")," "),o(7),s("ngIf",c(39,42,t.isLoading$)),o(2),s("ngIf",!c(41,44,t.isLoading$)),o(5),Xe("ngModel",t.protocol),o(2),O(c(48,46,"admin.device-connectivity.http-s")),o(3),O(c(51,48,"admin.device-connectivity.mqtt-s")),o(3),O(c(54,50,"admin.device-connectivity.coap-s")),o(3),O(c(57,52,"admin.device-connectivity.hint")),o(2),s("formGroup",t.deviceConnectivitySettingsForm),o(),s("ngIf",t.protocol==="http"),o(),s("ngIf",t.protocol==="mqtt"),o(),s("ngIf",t.protocol==="coap"),o(4),s("disabled",t.deviceConnectivitySettingsForm.pristine),o(),h("",c(67,54,"action.undo")," "),o(2),s("disabled",c(69,56,t.isLoading$)||t.deviceConnectivitySettingsForm.invalid||!t.deviceConnectivitySettingsForm.dirty),o(2),h("",c(71,58,"action.save")," "))},dependencies:[G,Qn,ee,Xt,ni,ci,di,qe,he,me,Ce,Pe,ht,ce,ge,Ui,W,K,ue,qi,ln,Ye,ie,se,bt,J,Di,Pi,Kr,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .settings-card[_ngcontent-%COMP%]   .toggle-group[_ngcontent-%COMP%]{max-width:670px;width:100%;margin:0 auto}[_nghost-%COMP%]   .settings-card[_ngcontent-%COMP%]   .toggle-group[_ngcontent-%COMP%]   .tb-form-hint[_ngcontent-%COMP%]{text-align:center}@media screen and (max-width: 599px){[_nghost-%COMP%]   .settings-card[_ngcontent-%COMP%]   .tb-form-row[_ngcontent-%COMP%]{gap:0}}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   mat-card-header.mat-mdc-card-header[_ngcontent-%COMP%]{align-items:center}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}return i})();C();function Kh(i,m){i&1&&f(0,"mat-progress-bar",47)}function Xh(i,m){i&1&&f(0,"div",48)}function Zh(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-max-failed-login-attempts-range")," "))}function eb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.user-activation-token-ttl-range")," "))}function tb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.user-activation-token-ttl-range")," "))}function ib(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.password-reset-token-ttl-range")," "))}function nb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.password-reset-token-ttl-range")," "))}function ob(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.mobile-secret-key-length-range")," "))}function ab(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-password-length-required")," "))}function rb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-password-length-range")," "))}function sb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-password-length-range")," "))}function lb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.maximum-password-length-min")," "))}function pb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.maximum-password-length-less-min")," "))}function mb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-uppercase-letters-range")," "))}function db(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-lowercase-letters-range")," "))}function cb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-digits-range")," "))}function ub(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.minimum-special-characters-range")," "))}function fb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.password-expiration-period-days-range")," "))}function gb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.password-reuse-frequency-days-range")," "))}function hb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.issuer-name-required")," "))}function bb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.signings-key-required")," "))}function vb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.signings-key-base64")," "))}function yb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.signings-key-min-length")," "))}function _b(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.expiration-time-required")," "))}function Cb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.expiration-time-max")," "))}function Sb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.expiration-time-min")," "))}function Tb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.refresh-expiration-time-required")," "))}function xb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.refresh-expiration-time-max")," "))}function Eb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.refresh-expiration-time-min")," "))}function Ib(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.jwt.refresh-expiration-time-less-token")," "))}var Bs=(()=>{class i extends Mt{constructor(e,n,t,l,u,y,w,x){super(e),this.store=e,this.router=n,this.adminService=t,this.authService=l,this.dialogService=u,this.translate=y,this.fb=w,this.destroyRef=x,this.showMainLoadingBar=!1,this.buildSecuritySettingsForm(),this.buildJwtSecuritySettingsForm(),this.adminService.getSecuritySettings().subscribe(q=>this.processSecuritySettings(q)),this.adminService.getJwtSettings().subscribe(q=>this.processJwtSettings(q))}buildSecuritySettingsForm(){this.securitySettingsFormGroup=this.fb.group({maxFailedLoginAttempts:[null,[S.min(0)]],userLockoutNotificationEmail:["",[]],userActivationTokenTtl:[24,[S.required,S.min(1),S.max(24)]],passwordResetTokenTtl:[24,[S.required,S.min(1),S.max(24)]],mobileSecretKeyLength:[null,[S.min(1)]],passwordPolicy:this.fb.group({minimumLength:[null,[S.required,S.min(6),S.max(50)]],maximumLength:[null,[S.min(6),this.maxPasswordValidation()]],minimumUppercaseLetters:[null,S.min(0)],minimumLowercaseLetters:[null,S.min(0)],minimumDigits:[null,S.min(0)],minimumSpecialCharacters:[null,S.min(0)],passwordExpirationPeriodDays:[null,S.min(0)],passwordReuseFrequencyDays:[null,S.min(0)],allowWhitespaces:[!0],forceUserToResetPasswordIfNotValid:[!1]})})}buildJwtSecuritySettingsForm(){this.jwtSecuritySettingsFormGroup=this.fb.group({tokenIssuer:["",S.required],tokenSigningKey:["",[S.required,this.base64Format]],tokenExpirationTime:[0,[S.required,S.min(60),S.max(2147483647)]],refreshTokenExpTime:[0,[S.required,S.min(900),S.max(2147483647)]]},{validators:this.refreshTokenTimeGreatTokenTime.bind(this)}),this.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>this.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").updateValueAndValidity({onlySelf:!0}))}save(){this.securitySettings=_e(_e({},this.securitySettings),this.securitySettingsFormGroup.value),this.adminService.saveSecuritySettings(this.securitySettings).subscribe(e=>this.processSecuritySettings(e))}saveJwtSettings(){let e=this.jwtSecuritySettingsFormGroup.value;this.confirmChangeJWTSettings().pipe(_t(n=>n?this.adminService.saveJwtSettings(e).pipe(xt(t=>this.authService.setUserFromJwtToken(t.token,t.refreshToken,!1)),_t(()=>this.adminService.getJwtSettings()),xt(t=>this.processJwtSettings(t))):ut(null))).subscribe(()=>{})}maxPasswordValidation(){return e=>{let n=e.value;return n&&n<e.parent.value?.minimumLength?{lessMin:!0}:null}}discardSetting(){this.securitySettingsFormGroup.reset(this.securitySettings)}discardJwtSetting(){this.jwtSecuritySettingsFormGroup.reset(this.jwtSettings)}markAsTouched(){this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").markAsTouched()}confirmChangeJWTSettings(){return this.jwtSecuritySettingsFormGroup.get("tokenIssuer").value!==(this.jwtSettings?.tokenIssuer||"")||this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").value!==(this.jwtSettings?.tokenSigningKey||"")?this.dialogService.confirm(this.translate.instant("admin.jwt.info-header"),`<div style="max-width: 640px">${this.translate.instant("admin.jwt.info-message")}</div>`,this.translate.instant("action.discard-changes"),this.translate.instant("action.confirm")):ut(!0)}generateSigningKey(){this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").setValue(btoa(Ja(64))),this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").pristine&&(this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").markAsDirty(),this.jwtSecuritySettingsFormGroup.get("tokenSigningKey").markAsTouched())}processSecuritySettings(e){this.securitySettings=e,this.securitySettingsFormGroup.reset(this.securitySettings)}processJwtSettings(e){this.jwtSettings=e,this.jwtSecuritySettingsFormGroup.reset(e)}refreshTokenTimeGreatTokenTime(e){if(e){let n=e.value.tokenExpirationTime,t=e.value.refreshTokenExpTime;if(n>=t)return e.get("refreshTokenExpTime").untouched&&e.get("refreshTokenExpTime").markAsTouched(),e.get("refreshTokenExpTime").setErrors({lessToken:!0}),{lessToken:!0}}return null}base64Format(e){if(e.value===""||e.value==="thingsboardDefaultSigningKey")return null;try{return atob(e.value).length<64?{minLength:!0}:null}catch{return{base64:!0}}}confirmForm(){return this.securitySettingsFormGroup.dirty?this.securitySettingsFormGroup:this.jwtSecuritySettingsFormGroup}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(kn),g(Zn),g(jt),g(Z),g(de),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-security-settings"]],features:[L],decls:168,vars:71,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","securitySettings"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["autocomplete","off",3,"ngSubmit","formGroup"],[3,"disabled"],[1,"fields-group"],["translate","",1,"group-title"],[1,"mat-block"],["translate",""],["matInput","","type","number","formControlName","maxFailedLoginAttempts","step","1","min","0"],[4,"ngIf"],["matInput","","type","email","formControlName","userLockoutNotificationEmail"],["matInput","","type","number","formControlName","userActivationTokenTtl","step","1","min","1","max","24"],["matInput","","type","number","formControlName","passwordResetTokenTtl","step","1","min","1","max","24"],["matInput","","type","number","formControlName","mobileSecretKeyLength","step","1","min","1"],["formGroupName","passwordPolicy"],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-1"],["matInput","","type","number","formControlName","minimumLength","step","1","min","6","max","50","required",""],["subscriptSizing","dynamic",1,"mat-block","flex-1"],["matInput","","type","number","formControlName","maximumLength","step","1","min","6"],["matInput","","type","number","formControlName","minimumUppercaseLetters","step","1","min","0"],["matInput","","type","number","formControlName","minimumLowercaseLetters","step","1","min","0"],["matInput","","type","number","formControlName","minimumDigits","step","1","min","0"],["matInput","","type","number","formControlName","minimumSpecialCharacters","step","1","min","0"],["matInput","","type","number","formControlName","passwordExpirationPeriodDays","step","1","min","0"],["matInput","","type","number","formControlName","passwordReuseFrequencyDays","step","1","min","0"],["formControlName","allowWhitespaces",1,"flex-1",2,"margin-bottom","16px"],["formControlName","forceUserToResetPasswordIfNotValid",1,"flex-1",2,"margin-bottom","16px"],[3,"tb-hint-tooltip-icon"],[1,"flex","flex-row","flex-wrap","items-center","justify-end","gap-2",2,"margin-top","16px"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["tb-help","jwtSecuritySettings"],[2,"padding-top","16px"],[1,"flex","flex-col","gap-2",3,"disabled"],[1,"flex","flex-row","gap-2","xs:flex-col"],["matInput","","required","","formControlName","tokenIssuer"],["matInput","","required","","formControlName","tokenSigningKey",3,"focus"],["type","button","matSuffix","","mat-button","","color","primary",2,"line-height","32px",3,"click"],["matInput","","type","number","required","","formControlName","tokenExpirationTime","step","1","min","60"],["matInput","","type","number","required","","formControlName","refreshTokenExpTime","step","1","min","900"],[1,"flex","flex-row","flex-wrap","items-center","justify-end","gap-2"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){n&1&&(r(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title")(3,"span",1),p(4,"admin.security-settings"),a()(),f(5,"span",2)(6,"div",3),a(),b(7,Kh,1,0,"mat-progress-bar",4),d(8,"async"),b(9,Xh,1,0,"div",5),d(10,"async"),r(11,"mat-card-content")(12,"form",6),_("ngSubmit",function(){return t.save()}),r(13,"fieldset",7),d(14,"async"),r(15,"fieldset",8)(16,"legend",9),p(17,"admin.general-policy"),a(),r(18,"mat-form-field",10)(19,"mat-label",11),p(20,"admin.max-failed-login-attempts"),a(),f(21,"input",12),b(22,Zh,3,3,"mat-error",13),a(),r(23,"mat-form-field",10)(24,"mat-label",11),p(25,"admin.user-lockout-notification-email"),a(),f(26,"input",14),a(),r(27,"mat-form-field",10)(28,"mat-label",11),p(29,"admin.user-activation-token-ttl"),a(),f(30,"input",15),b(31,eb,3,3,"mat-error",13)(32,tb,3,3,"mat-error",13),a(),r(33,"mat-form-field",10)(34,"mat-label",11),p(35,"admin.password-reset-token-ttl"),a(),f(36,"input",16),b(37,ib,3,3,"mat-error",13)(38,nb,3,3,"mat-error",13),a(),r(39,"mat-form-field",10)(40,"mat-label",11),p(41,"admin.mobile-secret-key-length"),a(),f(42,"input",17),b(43,ob,3,3,"mat-error",13),a()(),r(44,"fieldset",8)(45,"legend",9),p(46,"admin.password-policy"),a(),r(47,"section",18)(48,"div",19)(49,"mat-form-field",20)(50,"mat-label",11),p(51,"admin.minimum-password-length"),a(),f(52,"input",21),b(53,ab,3,3,"mat-error",13)(54,rb,3,3,"mat-error",13)(55,sb,3,3,"mat-error",13),a(),r(56,"mat-form-field",22)(57,"mat-label",11),p(58,"admin.maximum-password-length"),a(),f(59,"input",23)(60,"mat-hint"),b(61,lb,3,3,"mat-error",13)(62,pb,3,3,"mat-error",13),a()(),r(63,"div",19)(64,"mat-form-field",20)(65,"mat-label",11),p(66,"admin.minimum-uppercase-letters"),a(),f(67,"input",24),b(68,mb,3,3,"mat-error",13),a(),r(69,"mat-form-field",20)(70,"mat-label",11),p(71,"admin.minimum-lowercase-letters"),a(),f(72,"input",25),b(73,db,3,3,"mat-error",13),a()(),r(74,"div",19)(75,"mat-form-field",20)(76,"mat-label",11),p(77,"admin.minimum-digits"),a(),f(78,"input",26),b(79,cb,3,3,"mat-error",13),a(),r(80,"mat-form-field",20)(81,"mat-label",11),p(82,"admin.minimum-special-characters"),a(),f(83,"input",27),b(84,ub,3,3,"mat-error",13),a()(),r(85,"div",19)(86,"mat-form-field",20)(87,"mat-label",11),p(88,"admin.password-expiration-period-days"),a(),f(89,"input",28),b(90,fb,3,3,"mat-error",13),a(),r(91,"mat-form-field",20)(92,"mat-label",11),p(93,"admin.password-reuse-frequency-days"),a(),f(94,"input",29),b(95,gb,3,3,"mat-error",13),a()(),r(96,"div",19)(97,"mat-checkbox",30)(98,"mat-label",11),p(99,"admin.allow-whitespace"),a()(),r(100,"mat-checkbox",31)(101,"mat-label",32),d(102,"translate"),p(103),d(104,"translate"),a()()()()(),r(105,"div",33)(106,"button",34),_("click",function(){return t.discardSetting()}),p(107),d(108,"translate"),a(),r(109,"button",35),d(110,"async"),p(111),d(112,"translate"),a()()()()()(),r(113,"mat-card",0)(114,"mat-card-header")(115,"mat-card-title")(116,"span",1),p(117,"admin.jwt.security-settings"),a()(),f(118,"span",2)(119,"div",36),a(),r(120,"mat-card-content",37)(121,"form",6),_("ngSubmit",function(){return t.saveJwtSettings()}),r(122,"fieldset",38),d(123,"async"),r(124,"div",39)(125,"mat-form-field",22)(126,"mat-label",11),p(127,"admin.jwt.issuer-name"),a(),f(128,"input",40),b(129,hb,3,3,"mat-error",13),a(),r(130,"mat-form-field",22)(131,"mat-label",11),p(132,"admin.jwt.signings-key"),a(),r(133,"input",41),_("focus",function(){return t.markAsTouched()}),a(),r(134,"button",42),_("click",function(){return t.generateSigningKey()}),p(135),d(136,"translate"),a(),r(137,"mat-hint",11),p(138,"admin.jwt.signings-key-hint"),a(),b(139,bb,3,3,"mat-error",13)(140,vb,3,3,"mat-error",13)(141,yb,3,3,"mat-error",13),a()(),r(142,"div",39)(143,"mat-form-field",22)(144,"mat-label",11),p(145,"admin.jwt.expiration-time"),a(),f(146,"input",43)(147,"mat-hint"),b(148,_b,3,3,"mat-error",13)(149,Cb,3,3,"mat-error",13)(150,Sb,3,3,"mat-error",13),a(),r(151,"mat-form-field",22)(152,"mat-label",11),p(153,"admin.jwt.refresh-expiration-time"),a(),f(154,"input",44)(155,"mat-hint"),b(156,Tb,3,3,"mat-error",13)(157,xb,3,3,"mat-error",13)(158,Eb,3,3,"mat-error",13)(159,Ib,3,3,"mat-error",13),a()(),r(160,"div",45)(161,"button",34),_("click",function(){return t.discardJwtSetting()}),p(162),d(163,"translate"),a(),r(164,"button",46),d(165,"async"),p(166),d(167,"translate"),a()()()()()()),n&2&&(o(7),s("ngIf",c(8,45,t.isLoading$)),o(2),s("ngIf",!c(10,47,t.isLoading$)),o(3),s("formGroup",t.securitySettingsFormGroup),o(),s("disabled",c(14,49,t.isLoading$)),o(9),s("ngIf",t.securitySettingsFormGroup.get("maxFailedLoginAttempts").hasError("min")),o(9),s("ngIf",t.securitySettingsFormGroup.get("userActivationTokenTtl").hasError("min")),o(),s("ngIf",t.securitySettingsFormGroup.get("userActivationTokenTtl").hasError("max")),o(5),s("ngIf",t.securitySettingsFormGroup.get("passwordResetTokenTtl").hasError("min")),o(),s("ngIf",t.securitySettingsFormGroup.get("passwordResetTokenTtl").hasError("max")),o(5),s("ngIf",t.securitySettingsFormGroup.get("mobileSecretKeyLength").hasError("min")),o(10),s("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumLength").hasError("required")),o(),s("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumLength").hasError("min")),o(),s("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumLength").hasError("max")),o(6),s("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.maximumLength").hasError("min")),o(),s("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.maximumLength").hasError("lessMin")),o(6),s("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumUppercaseLetters").hasError("min")),o(5),s("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumLowercaseLetters").hasError("min")),o(6),s("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumDigits").hasError("min")),o(5),s("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.minimumSpecialCharacters").hasError("min")),o(6),s("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.passwordExpirationPeriodDays").hasError("min")),o(5),s("ngIf",t.securitySettingsFormGroup.get("passwordPolicy.passwordReuseFrequencyDays").hasError("min")),o(6),T("tb-hint-tooltip-icon",c(102,51,"admin.force-reset-password-if-no-valid-hint")),o(2),h(" ",c(104,53,"admin.force-reset-password-if-no-valid")," "),o(3),s("disabled",t.securitySettingsFormGroup.pristine),o(),h("",c(108,55,"action.undo")," "),o(2),s("disabled",c(110,57,t.isLoading$)||t.securitySettingsFormGroup.invalid||!t.securitySettingsFormGroup.dirty),o(2),h("",c(112,59,"action.save")," "),o(10),s("formGroup",t.jwtSecuritySettingsFormGroup),o(),s("disabled",c(123,61,t.isLoading$)),o(7),s("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenIssuer").hasError("required")),o(6),h(" ",c(136,63,"admin.jwt.generate-key")," "),o(4),s("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenSigningKey").hasError("required")),o(),s("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenSigningKey").hasError("base64")),o(),s("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenSigningKey").hasError("minLength")),o(7),s("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").hasError("required")),o(),s("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").hasError("max")),o(),s("ngIf",t.jwtSecuritySettingsFormGroup.get("tokenExpirationTime").hasError("min")),o(6),s("ngIf",t.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("required")),o(),s("ngIf",t.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("max")),o(),s("ngIf",t.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("min")),o(),s("ngIf",t.jwtSecuritySettingsFormGroup.get("refreshTokenExpTime").hasError("lessToken")),o(2),s("disabled",t.jwtSecuritySettingsFormGroup.pristine),o(),h("",c(163,65,"action.undo")," "),o(2),s("disabled",c(165,67,t.isLoading$)||t.jwtSecuritySettingsFormGroup.invalid||!t.jwtSecuritySettingsFormGroup.dirty),o(2),h("",c(167,69,"action.save")," "))},dependencies:[G,wt,ee,$t,Xt,ni,ci,di,qe,he,me,Ce,Kt,Pe,zt,ce,ge,Ui,W,K,ue,qi,ln,ie,se,bt,J,Kr,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:8px 16px 0;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   mat-card-header.mat-mdc-card-header[_ngcontent-%COMP%]{align-items:center}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}return i})();C();C();function Mb(i,m){i&1&&f(0,"mat-progress-bar",17)}function wb(i,m){i&1&&f(0,"div",18)}function Db(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.sms-message-required")," "))}function Pb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.sms-message-max-length")," "))}var Vs=(()=>{class i extends nt{constructor(e,n,t,l,u,y,w){super(e,n,y),this.store=e,this.router=n,this.data=t,this.adminService=l,this.translate=u,this.dialogRef=y,this.fb=w,this.phoneNumberPattern=xa,this.smsProviderConfiguration=this.data.smsProviderConfiguration}ngOnInit(){this.sendTestSmsFormGroup=this.fb.group({numberTo:[null,[S.required,S.pattern(xa)]],message:[null,[S.required,S.maxLength(1600)]]})}close(){this.dialogRef.close()}sendTestSms(){let e={providerConfiguration:this.smsProviderConfiguration,numberTo:this.sendTestSmsFormGroup.value.numberTo,message:this.sendTestSmsFormGroup.value.message};this.adminService.sendTestSms(e).subscribe(()=>{this.store.dispatch(new Be({message:this.translate.instant("admin.test-sms-sent"),target:"sendTestSmsDialogContent",verticalPosition:"bottom",horizontalPosition:"left",type:"success"}))})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(Ot),g(kn),g(Z),g(it),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-send-test-sms-dialog"]],features:[L],decls:32,vars:29,consts:[[2,"min-width","500px","position","relative",3,"formGroup"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","","toastTarget","sendTestSmsDialogContent"],[3,"disabled"],["required","","formControlName","numberTo",3,"enableFlagsSelect","label"],[1,"mat-block"],["required","","matInput","","rows","3","formControlName","message",3,"maxLength"],[4,"ngIf"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){n&1&&(r(0,"form",0)(1,"mat-toolbar",1)(2,"h2",2),p(3,"admin.send-test-sms"),a(),f(4,"span",3),r(5,"button",4),_("click",function(){return t.close()}),r(6,"mat-icon",5),p(7,"close"),a()()(),b(8,Mb,1,0,"mat-progress-bar",6),d(9,"async"),b(10,wb,1,0,"div",7),d(11,"async"),r(12,"div",8)(13,"fieldset",9),d(14,"async"),f(15,"tb-phone-input",10),d(16,"translate"),r(17,"mat-form-field",11)(18,"mat-label",2),p(19,"admin.sms-message"),a(),f(20,"textarea",12),b(21,Db,3,3,"mat-error",13)(22,Pb,3,3,"mat-error",13),a()()(),r(23,"div",14)(24,"button",15),d(25,"async"),_("click",function(){return t.close()}),p(26),d(27,"translate"),a(),r(28,"button",16),d(29,"async"),_("click",function(){return t.sendTestSms()}),p(30),d(31,"translate"),a()()()),n&2&&(s("formGroup",t.sendTestSmsFormGroup),o(8),s("ngIf",c(9,13,t.isLoading$)),o(2),s("ngIf",!c(11,15,t.isLoading$)),o(3),s("disabled",c(14,17,t.isLoading$)),o(2),T("label",c(16,19,"admin.number-to")),s("enableFlagsSelect",!1),o(5),s("maxLength",1600),o(),s("ngIf",t.sendTestSmsFormGroup.get("message").hasError("required")),o(),s("ngIf",t.sendTestSmsFormGroup.get("message").hasError("maxLength")),o(2),s("disabled",c(25,21,t.isLoading$)),o(2),h(" ",c(27,23,"action.close")," "),o(2),s("disabled",c(29,25,t.isLoading$)||t.sendTestSmsFormGroup.invalid),o(2),h(" ",c(31,27,"admin.send-test-sms")," "))},dependencies:[G,wi,ee,Ee,ae,qe,he,me,Ce,Pe,at,Rt,mt,ce,ge,W,K,ue,ie,se,J,ao,le,R],encapsulation:2})}}return i})();function Fb(i,m){i&1&&f(0,"mat-progress-bar",22)}function Ab(i,m){i&1&&f(0,"div",23)}function Nb(i,m){if(i&1){let e=j();r(0,"mat-card",16)(1,"mat-card-header")(2,"mat-card-title")(3,"span",3),p(4,"admin.sms-provider-settings"),a()(),f(5,"span",4)(6,"div",17),a(),b(7,Fb,1,0,"mat-progress-bar",6),d(8,"async"),b(9,Ab,1,0,"div",7),d(10,"async"),r(11,"mat-card-content")(12,"form",1),_("ngSubmit",function(){I(e);let t=v();return M(t.save())}),f(13,"tb-sms-provider-configuration",18),r(14,"div",19)(15,"button",20),d(16,"async"),_("click",function(){I(e);let t=v();return M(t.sendTestSms())}),p(17),d(18,"translate"),a(),r(19,"button",21),d(20,"async"),p(21),d(22,"translate"),a()()()()()}if(i&2){let e=v();o(7),s("ngIf",c(8,7,e.isLoading$)),o(2),s("ngIf",!c(10,9,e.isLoading$)),o(3),s("formGroup",e.smsProvider),o(3),s("disabled",c(16,11,e.isLoading$)||e.smsProvider.invalid),o(2),h(" ",c(18,13,"admin.send-test-sms")," "),o(2),s("disabled",c(20,15,e.isLoading$)||e.smsProvider.invalid||!e.smsProvider.dirty),o(2),h("",c(22,17,"action.save")," ")}}function kb(i,m){i&1&&f(0,"mat-progress-bar",22)}function Ob(i,m){i&1&&f(0,"div",23)}function Rb(i,m){i&1&&(r(0,"mat-card-header")(1,"mat-card-title")(2,"span",3),p(3,"admin.mobile-settings"),a()(),f(4,"span",4),a())}function Bb(i,m){if(i&1){let e=j();r(0,"mat-card-content",24)(1,"tb-file-input",25),d(2,"translate"),d(3,"translate"),_("fileNameChanged",function(t){I(e);let l=v();return M(l.notificationSettingsForm==null?null:l.notificationSettingsForm.get("deliveryMethodsConfigs.MOBILE_APP.firebaseServiceAccountCredentialsFileName").patchValue(t))}),a()()}if(i&2){let e,n=v();o(),T("dropLabel",c(2,3,"admin.select-firebase-service-account-file")),T("label",c(3,5,"admin.firebase-service-account-file")),s("existingFileName",(e=n.notificationSettingsForm.get("deliveryMethodsConfigs.MOBILE_APP.firebaseServiceAccountCredentialsFileName"))==null?null:e.value)}}var js=(()=>{class i extends Mt{constructor(e,n,t,l,u,y){super(e),this.store=e,this.router=n,this.adminService=t,this.notificationService=l,this.dialog=u,this.fb=y,this.authUser=kt(this.store),this.buildSmsProviderForm(),this.buildGeneralServerSettingsForm(),this.notificationService.getNotificationSettings().subscribe(w=>{this.notificationSettings=w,this.notificationSettingsForm.reset(this.notificationSettings)}),this.isSysAdmin()&&this.adminService.getAdminSettings("sms",{ignoreErrors:!0}).subscribe({next:w=>{this.adminSettings=w,this.smsProvider.reset({configuration:this.adminSettings.jsonValue})},error:()=>{this.adminSettings={key:"sms",jsonValue:null},this.smsProvider.reset({configuration:this.adminSettings.jsonValue})}})}buildSmsProviderForm(){this.smsProvider=this.fb.group({configuration:[null,[S.required]]}),this.registerDisableOnLoadFormControl(this.smsProvider.get("configuration"))}sendTestSms(){this.dialog.open(Vs,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{smsProviderConfiguration:this.smsProvider.value.configuration}})}save(){this.adminSettings.jsonValue=this.smsProvider.value.configuration,this.adminService.saveAdminSettings(this.adminSettings).subscribe(e=>{this.adminSettings=e,this.smsProvider.reset({configuration:this.adminSettings.jsonValue})})}confirmForm(){return this.smsProvider.dirty?this.smsProvider:this.notificationSettingsForm}buildGeneralServerSettingsForm(){this.notificationSettingsForm=this.fb.group({deliveryMethodsConfigs:this.fb.group({SLACK:this.fb.group({botToken:[""]}),MOBILE_APP:this.fb.group({firebaseServiceAccountCredentialsFileName:[""],firebaseServiceAccountCredentials:[""]})})}),this.registerDisableOnLoadFormControl(this.notificationSettingsForm.get("deliveryMethodsConfigs"))}saveNotification(){this.notificationSettings=jn(_e(_e({},this.notificationSettings),this.notificationSettingsForm.value));for(let e in this.notificationSettings.deliveryMethodsConfigs)Object.keys(this.notificationSettings.deliveryMethodsConfigs[e]).some(t=>!$o(this.notificationSettings.deliveryMethodsConfigs[e][t]))?delete this.notificationSettings.deliveryMethodsConfigs[e]:this.notificationSettings.deliveryMethodsConfigs[e].method=e;this.notificationService.saveNotificationSettings(this.notificationSettings).subscribe(e=>{this.notificationSettings=e,this.notificationSettingsForm.reset(this.notificationSettings)})}isSysAdmin(){return this.authUser.authority===E.SYS_ADMIN}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(kn),g(bi),g(je),g(dt))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-sms-provider"]],features:[L],decls:25,vars:16,consts:[["appearance","outlined","class","settings-card",4,"ngIf"],[3,"ngSubmit","formGroup"],["appearance","outlined","formGroupName","deliveryMethodsConfigs",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","slackSettings"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["formGroupName","SLACK"],["subscriptSizing","dynamic",1,"mat-block"],["translate",""],["matInput","","formControlName","botToken"],[4,"ngIf"],["formGroupName","MOBILE_APP",4,"ngIf"],[1,"flex","items-center","justify-end","xs:flex-col","xs:items-stretch"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["appearance","outlined",1,"settings-card"],["tb-help","smsProviderSettings"],["required","","formControlName","configuration"],[1,"flex","flex-row","items-center","justify-end","gap-4","xs:flex-col","xs:items-stretch"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],["formGroupName","MOBILE_APP"],["formControlName","firebaseServiceAccountCredentials","accept",".json,application/json","allowedExtensions","json",3,"fileNameChanged","dropLabel","label","existingFileName"]],template:function(n,t){n&1&&(b(0,Nb,23,19,"mat-card",0),r(1,"form",1),_("ngSubmit",function(){return t.saveNotification()}),r(2,"mat-card",2)(3,"mat-card-header")(4,"mat-card-title")(5,"span",3),p(6,"admin.slack-settings"),a()(),f(7,"span",4)(8,"div",5),a(),b(9,kb,1,0,"mat-progress-bar",6),d(10,"async"),b(11,Ob,1,0,"div",7),d(12,"async"),r(13,"mat-card-content",8)(14,"mat-form-field",9)(15,"mat-label",10),p(16,"admin.slack-api-token"),a(),f(17,"input",11),a()(),b(18,Rb,5,0,"mat-card-header",12)(19,Bb,4,7,"mat-card-content",13),r(20,"mat-card-actions",14)(21,"button",15),d(22,"async"),p(23),d(24,"translate"),a()()()()),n&2&&(s("ngIf",t.isSysAdmin()),o(),s("formGroup",t.notificationSettingsForm),o(8),s("ngIf",c(10,8,t.isLoading$)),o(2),s("ngIf",!c(12,10,t.isLoading$)),o(7),s("ngIf",t.isSysAdmin()),o(),s("ngIf",t.isSysAdmin()),o(2),s("disabled",c(22,12,t.isLoading$)||t.notificationSettingsForm.invalid||!t.notificationSettingsForm.dirty),o(2),h("",c(24,14,"action.save")," "))},dependencies:[G,wt,ee,Xt,qr,ni,ci,di,qe,he,me,Ce,ce,ge,W,K,ue,ie,se,bt,oo,J,tf,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{min-height:64px}[_nghost-%COMP%]   .mdc-card__actions[_ngcontent-%COMP%]{padding:16px}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   mat-card-header.mat-mdc-card-header[_ngcontent-%COMP%]{align-items:center}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}return i})();C();function Vb(i,m){i&1&&f(0,"mat-progress-bar",13)}function jb(i,m){i&1&&f(0,"div",14)}var Ls=(()=>{class i extends Mt{constructor(e,n,t,l){super(e),this.store=e,this.router=n,this.dashboardService=t,this.fb=l}ngOnInit(){this.homeSettings=this.fb.group({dashboardId:[null],hideDashboardToolbar:[!0]}),this.dashboardService.getTenantHomeDashboardInfo().subscribe(e=>{this.setHomeDashboardInfo(e)})}save(){let e=this.homeSettings.get("dashboardId").value,n=e?new nf(e):null,t=this.homeSettings.get("hideDashboardToolbar").value,l={dashboardId:n,hideDashboardToolbar:t};this.dashboardService.setTenantHomeDashboardInfo(l).subscribe(()=>{this.setHomeDashboardInfo(l)})}confirmForm(){return this.homeSettings}setHomeDashboardInfo(e){this.homeSettings.reset({dashboardId:e?.dashboardId?.id,hideDashboardToolbar:Oe(e?.hideDashboardToolbar)?e?.hideDashboardToolbar:!0})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(Xr),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-home-settings"]],features:[L],decls:26,vars:24,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[3,"ngSubmit","formGroup"],[3,"disabled"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","dashboardId",1,"flex-1",3,"label","dashboardsScope","selectFirstDashboard"],["formControlName","hideDashboardToolbar",1,"flex-1"],[1,"flex","w-full","flex-row","flex-wrap","items-center","justify-end"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){n&1&&(r(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"mat-card-title")(4,"span",1),p(5,"admin.home-settings"),a()()(),b(6,Vb,1,0,"mat-progress-bar",2),d(7,"async"),b(8,jb,1,0,"div",3),d(9,"async"),r(10,"mat-card-content",4)(11,"form",5),_("ngSubmit",function(){return t.save()}),r(12,"fieldset",6),d(13,"async"),r(14,"section",7)(15,"section",8),f(16,"tb-dashboard-autocomplete",9),d(17,"translate"),r(18,"mat-checkbox",10),p(19),d(20,"translate"),a()()(),r(21,"div",11)(22,"button",12),d(23,"async"),p(24),d(25,"translate"),a()()()()()()()),n&2&&(o(6),s("ngIf",c(7,10,t.isLoading$)),o(2),s("ngIf",c(9,12,t.isLoading$)===!1),o(3),s("formGroup",t.homeSettings),o(),s("disabled",c(13,14,t.isLoading$)),o(4),T("label",c(17,16,"dashboard.home-dashboard")),s("dashboardsScope","tenant")("selectFirstDashboard",!1),o(3),h(" ",c(20,18,"dashboard.home-dashboard-hide-toolbar")," "),o(3),s("disabled",c(23,20,t.isLoading$)||t.homeSettings.invalid||!t.homeSettings.dirty),o(2),h("",c(25,22,"action.save")," "))},dependencies:[G,dn,ee,$t,Xt,ni,ci,di,qe,ce,W,K,ie,se,J,le,R],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   mat-card-header.mat-mdc-card-header[_ngcontent-%COMP%]{align-items:center}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}return i})();C();C();function Lb(i,m){if(i&1&&(r(0,"mat-option",15),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.resourceTypesTranslationMap.get(e))," ")}}function Gb(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"resource.title-required")," "))}function Ub(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"resource.title-max-length")," "))}function qb(i,m){if(i&1&&(r(0,"mat-form-field",9)(1,"mat-label",5),p(2,"resource.title"),a(),f(3,"input",16),b(4,Gb,3,3,"mat-error",17)(5,Ub,3,3,"mat-error",17),a()),i&2){let e=v();o(4),s("ngIf",e.entityForm.get("title").hasError("required")),o(),s("ngIf",e.entityForm.get("title").hasError("maxlength"))}}function Wb(i,m){if(i&1){let e=j();r(0,"tb-file-input",18),d(1,"translate"),d(2,"translate"),_("fileNameChanged",function(t){I(e);let l=v();return M(l.entityForm==null?null:l.entityForm.get("fileName").patchValue(t))}),a()}if(i&2){let e,n=v();T("label",c(1,9,n.entityForm.get("resourceType").value===n.resourceType.LWM2M_MODEL?"resource.resource-files":"resource.resource-file")),T("dropLabel",c(2,11,"resource.drop-resource-file-or")),s("readAsBinary",!0)("maxSizeByte",n.maxResourceSize)("allowedExtensions",n.getAllowedExtensions())("contentConvertFunction",n.convertToBase64File)("accept",n.getAcceptType())("multipleFile",n.entityForm.get("resourceType").value===n.resourceType.LWM2M_MODEL)("existingFileName",(e=n.entityForm.get("fileName"))==null?null:e.value)}}function Hb(i,m){i&1&&(r(0,"div",19)(1,"mat-form-field",20)(2,"mat-label",5),p(3,"resource.file-name"),a(),f(4,"input",21),a()())}var Gs=(()=>{class i extends Bt{constructor(e,n,t,l,u,y){super(e,u,t,l,y),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.fb=u,this.cd=y,this.resourceType=fi,this.resourceTypes=[fi.LWM2M_MODEL,fi.PKCS_12,fi.JKS],this.resourceTypesTranslationMap=Wo,this.maxResourceSize=Li(this.store).maxResourceSize,this.destroy$=new At}ngOnInit(){super.ngOnInit(),this.isAdd&&this.observeResourceTypeChange()}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){return this.fb.group({title:[e?e.title:"",[S.required,S.maxLength(255)]],resourceType:[e?.resourceType?e.resourceType:fi.LWM2M_MODEL,S.required],fileName:[e?e.fileName:null,S.required],data:[e?e.data:null,this.isAdd?[S.required]:[]]})}updateForm(e){this.entityForm.patchValue(e)}updateFormState(){super.updateFormState(),this.isEdit&&this.entityForm&&!this.isAdd&&(this.entityForm.get("resourceType").disable({emitEvent:!1}),this.entityForm.get("fileName").disable({emitEvent:!1}))}prepareFormValue(e){return this.isEdit&&!Oe(e.data)&&delete e.data,super.prepareFormValue(e)}getAllowedExtensions(){try{return Fr.get(this.entityForm.get("resourceType").value)}catch{return""}}getAcceptType(){try{return Pr.get(this.entityForm.get("resourceType").value)}catch{return"*/*"}}convertToBase64File(e){return window.btoa(e)}onResourceIdCopied(){this.store.dispatch(new Be({message:this.translate.instant("resource.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}observeResourceTypeChange(){this.entityForm.get("resourceType").valueChanges.pipe(ho(fi.LWM2M_MODEL),lt(this.destroy$)).subscribe(e=>this.onResourceTypeChange(e))}onResourceTypeChange(e){e===this.resourceType.LWM2M_MODEL?(this.entityForm.get("title").disable({emitEvent:!1}),this.entityForm.patchValue({title:""},{emitEvent:!1})):this.entityForm.get("title").enable({emitEvent:!1}),this.entityForm.patchValue({data:null,fileName:null},{emitEvent:!1})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g("entity"),g("entitiesTableConfig"),g(dt),g(Qe))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-resources-library"]],features:[L],decls:30,vars:35,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["formControlName","resourceType","required",""],[3,"value",4,"ngFor","ngForOf"],["class","mat-block",4,"ngIf"],["formControlName","data","required","",3,"label","readAsBinary","maxSizeByte","allowedExtensions","contentConvertFunction","accept","multipleFile","dropLabel","existingFileName","fileNameChanged",4,"ngIf"],["class","flex flex-row xs:flex-col sm:gap-2 md:flex-col gt-md:gap-2",4,"ngIf"],[3,"value"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formControlName","data","required","",3,"fileNameChanged","label","readAsBinary","maxSizeByte","allowedExtensions","contentConvertFunction","accept","multipleFile","dropLabel","existingFileName"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-md:gap-2"],[1,"flex-1"],["matInput","","formControlName","fileName","type","text"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"button",1),d(2,"async"),_("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),a(),r(5,"button",1),d(6,"async"),_("click",function(u){return t.onEntityAction(u,"downloadResource")}),p(7),d(8,"translate"),a(),r(9,"button",1),d(10,"async"),_("click",function(u){return t.onEntityAction(u,"delete")}),p(11),d(12,"translate"),a(),r(13,"div",2)(14,"button",3),_("cbOnSuccess",function(){return t.onResourceIdCopied()}),f(15,"mat-icon",4),r(16,"span",5),p(17,"resource.copyId"),a()()()(),r(18,"div",6)(19,"form",7)(20,"fieldset",8),d(21,"async"),r(22,"mat-form-field",9)(23,"mat-label",5),p(24,"resource.resource-type"),a(),r(25,"mat-select",10),b(26,Lb,3,4,"mat-option",11),a()(),b(27,qb,6,2,"mat-form-field",12)(28,Wb,3,13,"tb-file-input",13)(29,Hb,5,0,"div",14),a()()()),n&2&&(o(),V("!hidden",t.isEdit||t.isDetailsPage),s("disabled",c(2,21,t.isLoading$)),o(2),h(" ",c(4,23,"common.open-details-page")," "),o(2),V("!hidden",t.isEdit),s("disabled",c(6,25,t.isLoading$)),o(2),h(" ",c(8,27,"resource.download")," "),o(2),V("!hidden",t.hideDelete()||t.isEdit),s("disabled",c(10,29,t.isLoading$)),o(2),h(" ",c(12,31,"resource.delete")," "),o(3),V("!hidden",t.isEdit),s("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),s("formGroup",t.entityForm),o(),s("disabled",c(21,33,t.isLoading$)||!t.isEdit),o(6),s("ngForOf",t.resourceTypes),o(),s("ngIf",t.entityForm.get("resourceType").value!==t.resourceType.LWM2M_MODEL||!t.isAdd),o(),s("ngIf",t.isAdd),o(),s("ngIf",!t.isAdd))},dependencies:[Te,G,ee,ae,he,me,Ce,Pe,vt,gt,Jt,ce,ge,W,K,ue,ie,se,oo,J,le,R],encapsulation:2})}}return i})();C();function zb(i,m){if(i&1&&(r(0,"mat-option",5),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.resourceTypesTranslationMap.get(e))," ")}}var Us=(()=>{class i extends oi{constructor(e){super(e),this.store=e,this.resourceTypes=[fi.LWM2M_MODEL,fi.PKCS_12,fi.JKS],this.resourceTypesTranslationMap=Wo}resourceTypeChanged(e){this.entitiesTableConfig.componentsData.resourceType=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-resources-table-header"]],features:[L],decls:9,vars:8,consts:[["subscriptSizing","dynamic",1,"mat-block"],["translate",""],[3,"ngModelChange","ngModel","placeholder"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,t){n&1&&(r(0,"mat-form-field",0)(1,"mat-label",1),p(2,"resource.resource-type"),a(),r(3,"mat-select",2),d(4,"translate"),_("ngModelChange",function(u){return t.resourceTypeChanged(u)}),r(5,"mat-option",3),p(6),d(7,"translate"),a(),b(8,zb,3,4,"mat-option",4),a()()),n&2&&(o(3),T("placeholder",c(4,4,"resource.resource-type")),s("ngModel",t.entitiesTableConfig.componentsData.resourceType),o(3),h(" ",c(7,6,"resource.all-types")," "),o(2),s("ngForOf",t.resourceTypes))},dependencies:[Te,me,Ce,vt,gt,W,Ye,J,R],encapsulation:2})}}return i})();var qs=(()=>{class i{constructor(e,n,t,l,u){this.store=e,this.resourceService=n,this.translate=t,this.router=l,this.datePipe=u,this.config=new Ge,this.resourceTypesTranslationMap=Wo,this.config.entityType=k.TB_RESOURCE,this.config.entityComponent=Gs,this.config.entityTranslations=Ue.get(k.TB_RESOURCE),this.config.entityResources=tt.get(k.TB_RESOURCE),this.config.headerComponent=Us,this.config.entityTitle=y=>y?y.title:"",this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("title","resource.title","60%"),new Y("resourceType","resource.resource-type","40%",y=>this.translate.instant(this.resourceTypesTranslationMap.get(y.resourceType))),new Y("tenantId","resource.system","60px",y=>Ft(y.tenantId.id===Ae))),this.config.cellActionDescriptors.push({name:this.translate.instant("resource.download"),icon:"file_download",isEnabled:()=>!0,onAction:(y,w)=>this.downloadResource(y,w)}),this.config.deleteEntityTitle=y=>this.translate.instant("resource.delete-resource-title",{resourceTitle:y.title}),this.config.deleteEntityContent=()=>this.translate.instant("resource.delete-resource-text"),this.config.deleteEntitiesTitle=y=>this.translate.instant("resource.delete-resources-title",{count:y}),this.config.deleteEntitiesContent=()=>this.translate.instant("resource.delete-resources-text"),this.config.entitiesFetchFunction=y=>this.resourceService.getResources(y,this.config.componentsData.resourceType),this.config.loadEntity=y=>this.resourceService.getResourceInfoById(y.id),this.config.saveEntity=y=>this.saveResource(y),this.config.deleteEntity=y=>this.resourceService.deleteResource(y.id),this.config.onEntityAction=y=>this.onResourceAction(y)}saveResource(e){if(Array.isArray(e.data)){let n=[];return e.data.forEach((t,l)=>{n.push({resourceType:e.resourceType,data:t,fileName:e.fileName[l],title:e.title})}),this.resourceService.saveResources(n,{resendRequest:!0}).pipe(ze(t=>t[0]))}else return this.resourceService.saveResource(e)}resolve(){this.config.tableTitle=this.translate.instant("resource.resources-library"),this.config.componentsData={resourceType:""};let e=kt(this.store);return this.config.deleteEnabled=n=>this.isResourceEditable(n,e.authority),this.config.entitySelectionEnabled=n=>this.isResourceEditable(n,e.authority),this.config.detailsReadonly=n=>this.detailsReadonly(n,e.authority),this.config}openResource(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["resources","resources-library",n.id.id]);this.router.navigateByUrl(t).then(()=>{})}downloadResource(e,n){e&&e.stopPropagation(),this.resourceService.downloadResource(n.id.id).subscribe()}onResourceAction(e){switch(e.action){case"open":return this.openResource(e.event,e.entity),!0;case"downloadResource":return this.downloadResource(e.event,e.entity),!0}return!1}detailsReadonly(e,n){return e?.resourceType===fi.LWM2M_MODEL?!0:!this.isResourceEditable(e,n)}isResourceEditable(e,n){return n===E.TENANT_ADMIN?e&&e.tenantId&&e.tenantId.id!==Ae:n===E.SYS_ADMIN}static{this.\u0275fac=function(n){return new(n||i)(D(F),D(as),D(Z),D(pe),D(ke))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();var st=(i,m,e)=>{switch(e.entitiesTableConfig.entityType){case k.TB_RESOURCE:case k.OTA_PACKAGE:return e.entity?.title;default:return e.entity?.name}};C();C();var Ws=(()=>{class i extends Bt{constructor(e,n,t,l,u,y){super(e,y,t,l,u),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.cd=u,this.fb=y,this.entityType=k,this.submitStrategies=[],this.processingStrategies=[]}ngOnInit(){super.ngOnInit()}buildForm(e){return this.fb.group({queue:[e]})}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}updateForm(e){this.entityForm.patchValue({queue:e},{emitEvent:!1})}prepareFormValue(e){return super.prepareFormValue(e.queue)}onQueueIdCopied(e){this.store.dispatch(new Be({message:this.translate.instant("queue.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g("entity"),g("entitiesTableConfig"),g(Qe),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-queue"]],features:[L],decls:16,vars:22,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col",3,"formGroup"],["formControlName","queue",3,"newQueue","systemQueue"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"button",1),d(2,"async"),_("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),a(),r(5,"button",1),d(6,"async"),_("click",function(u){return t.onEntityAction(u,"delete")}),p(7),d(8,"translate"),a(),r(9,"div",2)(10,"button",3),_("cbOnSuccess",function(u){return t.onQueueIdCopied(u)}),f(11,"mat-icon",4),r(12,"span",5),p(13,"queue.copyId"),a()()()(),r(14,"div",6),f(15,"tb-queue-form",7),a()),n&2&&(o(),V("!hidden",t.isEdit||t.isDetailsPage),s("disabled",c(2,14,t.isLoading$)),o(2),h(" ",c(4,16,"common.open-details-page")," "),o(2),V("!hidden",t.hideDelete()||t.isEdit),s("disabled",c(6,18,t.isLoading$)),o(2),h(" ",c(8,20,"queue.delete")," "),o(3),V("!hidden",t.isEdit),s("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(4),s("formGroup",t.entityForm),o(),s("newQueue",t.isAdd)("systemQueue",!0))},dependencies:[ee,ae,Jt,W,K,ie,se,J,ff,le,R],encapsulation:2})}}return i})();var $s=(()=>{class i{constructor(e,n,t,l,u,y,w,x){this.store=e,this.broadcast=n,this.queueService=t,this.customerService=l,this.dialogService=u,this.homeDialogs=y,this.router=w,this.translate=x,this.queueType=k0.TB_RULE_ENGINE,this.config=new Ge,this.config.entityType=k.QUEUE,this.config.entityComponent=Ws,this.config.entityTranslations=Ue.get(k.QUEUE),this.config.entityResources=tt.get(k.QUEUE),this.config.deleteEntityTitle=q=>this.translate.instant("queue.delete-queue-title",{queueName:q.name}),this.config.deleteEntityContent=()=>this.translate.instant("queue.delete-queue-text"),this.config.deleteEntitiesTitle=q=>this.translate.instant("queue.delete-queues-title",{count:q}),this.config.deleteEntitiesContent=()=>this.translate.instant("queue.delete-queues-text"),this.config.onEntityAction=q=>this.onQueueAction(q)}resolve(e){return this.config.componentsData={queueType:this.queueType},this.store.pipe(Wt(Tn),ti(1)).pipe(ze(()=>(this.config.tableTitle=this.translate.instant("admin.queues"),this.config.columns=this.configureColumns(),this.configureEntityFunctions(),this.config)))}configureColumns(){return[new Y("name","admin.queue-name","25%"),new Y("partitions","admin.queue-partitions","25%"),new Y("submitStrategy","admin.queue-submit-strategy","25%",e=>this.translate.instant(O0.get(e.submitStrategy.type).label),()=>({}),!1),new Y("processingStrategy","admin.queue-processing-strategy","25%",e=>this.translate.instant(R0.get(e.processingStrategy.type).label),()=>({}),!1)]}configureEntityFunctions(){this.config.entitiesFetchFunction=e=>this.queueService.getTenantQueuesByServiceType(e,this.queueType),this.config.loadEntity=e=>this.queueService.getQueueById(e.id),this.config.saveEntity=e=>this.queueService.saveQueue(e,this.queueType).pipe(_t(n=>this.queueService.getQueueById(n.id.id))),this.config.deleteEntity=e=>this.queueService.deleteQueue(e.id),this.config.deleteEnabled=e=>e&&e.name!=="Main",this.config.entitySelectionEnabled=e=>e&&e.name!=="Main"}onQueueAction(e){switch(e.action){case"open":return this.openQueue(e.event,e.entity),!0}return!1}openQueue(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["settings","queues",n.id.id]);this.router.navigateByUrl(t)}static{this.\u0275fac=function(n){return new(n||i)(D(F),D(xn),D(i0),D(Wi),D(jt),D(On),D(pe),D(Z))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();var Qb=["repositorySettingsComponent"],Js=(()=>{class i extends Mt{constructor(e){super(e),this.store=e}ngOnInit(){}confirmForm(){return this.repositorySettingsComponent?.repositorySettingsForm}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-repository-admin-settings"]],viewQuery:function(n,t){if(n&1&&Ie(Qb,5),n&2){let l;Me(l=we())&&(t.repositorySettingsComponent=l.first)}},features:[L],decls:2,vars:0,consts:[["repositorySettingsComponent",""]],template:function(n,t){n&1&&f(0,"tb-repository-settings",null,0)},dependencies:[Ss],encapsulation:2})}}return i})();C();var Yb=["repositorySettingsComponent"],Kb=["autoCommitSettingsComponent"];function Xb(i,m){i&1&&f(0,"tb-repository-settings",null,1)}function Zb(i,m){i&1&&f(0,"tb-auto-commit-settings",null,2)}var Qs=(()=>{class i extends Mt{constructor(e){super(e),this.store=e,this.hasRepository$=this.store.pipe(Wt(Gc))}ngOnInit(){}confirmForm(){return this.repositorySettingsComponent?this.repositorySettingsComponent?.repositorySettingsForm:this.autoCommitSettingsComponent?.autoCommitSettingsForm}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-auto-commit-admin-settings"]],viewQuery:function(n,t){if(n&1&&(Ie(Yb,5),Ie(Kb,5)),n&2){let l;Me(l=we())&&(t.repositorySettingsComponent=l.first),Me(l=we())&&(t.autoCommitSettingsComponent=l.first)}},features:[L],decls:4,vars:4,consts:[["autoCommitSettings",""],["repositorySettingsComponent",""],["autoCommitSettingsComponent",""],[4,"ngIf","ngIfElse"]],template:function(n,t){if(n&1&&(b(0,Xb,2,0,"tb-repository-settings",3),d(1,"async"),b(2,Zb,2,0,"ng-template",null,0,It)),n&2){let l=U(3);s("ngIf",!c(1,2,t.hasRepository$))("ngIfElse",l)}},dependencies:[G,Ss,gf,le],encapsulation:2})}}return i})();C();function e1(i,m){i&1&&f(0,"mat-progress-bar",25)}function t1(i,m){i&1&&f(0,"div",26)}function i1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.issuer-name-required")," "))}function n1(i,m){if(i&1&&(Gt(0),r(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.issuer-name"),a(),f(4,"input",32),b(5,i1,3,3,"mat-error",16),a(),Ut()),i&2){let e=v(2).$implicit;o(5),s("ngIf",e.get("issuerName").hasError("required")||e.get("issuerName").hasError("pattern"))}}function o1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.verification-message-template-required")," "))}function a1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.verification-message-template-pattern")," "))}function r1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.verification-code-lifetime-required")," "))}function s1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.verification-code-lifetime-pattern")," "))}function l1(i,m){if(i&1&&(r(0,"div",33)(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.verification-message-template"),a(),f(4,"input",34),b(5,o1,3,3,"mat-error",16)(6,a1,3,3,"mat-error",16),a(),r(7,"mat-form-field",13)(8,"mat-label",14),p(9,"admin.2fa.verification-code-lifetime"),a(),f(10,"input",35),b(11,r1,3,3,"mat-error",16)(12,s1,3,3,"mat-error",16),a()()),i&2){let e=v(2).$implicit;o(5),s("ngIf",e.get("smsVerificationMessageTemplate").hasError("required")),o(),s("ngIf",e.get("smsVerificationMessageTemplate").hasError("pattern")),o(5),s("ngIf",e.get("verificationCodeLifetime").hasError("required")),o(),s("ngIf",e.get("verificationCodeLifetime").hasError("min")||e.get("verificationCodeLifetime").hasError("pattern"))}}function p1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.verification-code-lifetime-required")," "))}function m1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.verification-code-lifetime-pattern")," "))}function d1(i,m){if(i&1&&(r(0,"div")(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.verification-code-lifetime"),a(),f(4,"input",35),b(5,p1,3,3,"mat-error",16)(6,m1,3,3,"mat-error",16),a()()),i&2){let e=v(2).$implicit;o(5),s("ngIf",e.get("verificationCodeLifetime").hasError("required")),o(),s("ngIf",e.get("verificationCodeLifetime").hasError("min")||e.get("verificationCodeLifetime").hasError("pattern"))}}function c1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.number-of-codes-required")," "))}function u1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.number-of-codes-pattern")," "))}function f1(i,m){if(i&1&&(r(0,"div")(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.number-of-codes"),a(),f(4,"input",36),b(5,c1,3,3,"mat-error",16)(6,u1,3,3,"mat-error",16),a()()),i&2){let e=v(2).$implicit;o(5),s("ngIf",e.get("codesQuantity").hasError("required")),o(),s("ngIf",e.get("codesQuantity").hasError("min")||e.get("codesQuantity").hasError("pattern"))}}function g1(i,m){if(i&1&&(Gt(0,29),b(1,n1,6,1,"ng-container",30)(2,l1,13,4,"div",31)(3,d1,7,2,"div",30)(4,f1,7,2,"div",30),Ut()),i&2){let e=v().$implicit,n=v();s("ngSwitch",e.get("providerType").value),o(),s("ngSwitchCase",n.twoFactorAuthProviderType.TOTP),o(),s("ngSwitchCase",n.twoFactorAuthProviderType.SMS),o(),s("ngSwitchCase",n.twoFactorAuthProviderType.EMAIL),o(),s("ngSwitchCase",n.twoFactorAuthProviderType.BACKUP_CODE)}}function h1(i,m){i&1&&f(0,"mat-divider")}function b1(i,m){if(i&1){let e=j();Gt(0),r(1,"mat-expansion-panel",27)(2,"mat-expansion-panel-header")(3,"mat-panel-title",20)(4,"mat-slide-toggle",28),_("mousedown",function(t){let l=I(e),u=l.$implicit,y=l.index,w=v();return M(w.toggleExtensionPanel(t,y,u.get("enable").value))}),p(5),d(6,"translate"),a()()(),b(7,g1,5,5,"ng-template",22),a(),b(8,h1,1,0,"mat-divider",16),Ut()}if(i&2){let e=m.$implicit,n=m.index,t=m.last,l=v();o(),s("formGroupName",n),o(4),h(" ",c(6,3,l.twoFactorAuthProvidersData.get(e.value.providerType).name)," "),o(3),s("ngIf",!t)}}function v1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.total-allowed-time-for-verification-required")," "))}function y1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.total-allowed-time-for-verification-pattern")," "))}function _1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.retry-verification-code-period-required")," "))}function C1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.retry-verification-code-period-pattern")," "))}function S1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.max-verification-failures-before-user-lockout-pattern")," "))}function T1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.number-of-checking-attempts-required")," "))}function x1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.number-of-checking-attempts-pattern")," "))}function E1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.within-time-required")," "))}function I1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.2fa.within-time-pattern")," "))}function M1(i,m){if(i&1&&(r(0,"div",33)(1,"mat-form-field",13)(2,"mat-label",14),p(3,"admin.2fa.number-of-checking-attempts"),a(),f(4,"input",37),b(5,T1,3,3,"mat-error",16)(6,x1,3,3,"mat-error",16),a(),r(7,"mat-form-field",13)(8,"mat-label",14),p(9,"admin.2fa.within-time"),a(),f(10,"input",38),b(11,E1,3,3,"mat-error",16)(12,I1,3,3,"mat-error",16),a()()),i&2){let e=v();o(5),s("ngIf",e.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").hasError("required")),o(),s("ngIf",e.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").hasError("pattern")||e.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").hasError("min")),o(5),s("ngIf",e.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").hasError("required")),o(),s("ngIf",e.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").hasError("pattern")||e.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").hasError("min"))}}var Ys=(()=>{class i extends Mt{constructor(e,n,t){super(e),this.store=e,this.twoFaService=n,this.fb=t,this.destroy$=new At,this.posIntValidation=[S.required,S.min(1),S.pattern(/^\d*$/)],this.twoFactorAuthProviderType=yt,this.twoFactorAuthProvidersData=Cs,this.showMainLoadingBar=!1}ngOnInit(){this.build2faSettingsForm(),this.twoFaService.getTwoFaSettings().subscribe(e=>{this.setAuthConfigFormValue(e)})}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}confirmForm(){return this.twoFaFormGroup}save(){if(this.twoFaFormGroup.valid){let e=this.twoFaFormGroup.getRawValue();this.joinRateLimit(e,"verificationCodeCheckRateLimit");let n=e.providers.filter(l=>l.enable);n.forEach(l=>delete l.enable);let t=Object.assign(e,{providers:n});this.twoFaService.saveTwoFaSettings(t).subscribe(l=>{this.setAuthConfigFormValue(l),this.twoFaFormGroup.markAsUntouched(),this.twoFaFormGroup.markAsPristine()})}else Object.keys(this.twoFaFormGroup.controls).forEach(e=>{this.twoFaFormGroup.get(e).markAsTouched({onlySelf:!0})})}toggleExtensionPanel(e,n,t){e&&e.stopPropagation(),t?this.getByIndexPanel(n).open():this.getByIndexPanel(n).close()}trackByElement(e,n){return n}get providersForm(){return this.twoFaFormGroup.get("providers")}build2faSettingsForm(){this.twoFaFormGroup=this.fb.group({maxVerificationFailuresBeforeUserLockout:[30,[S.pattern(/^\d*$/),S.min(0),S.max(65535)]],totalAllowedTimeForVerification:[3600,[S.required,S.min(60),S.pattern(/^\d*$/)]],verificationCodeCheckRateLimitEnable:[!1],verificationCodeCheckRateLimitNumber:[{value:3,disabled:!0},this.posIntValidation],verificationCodeCheckRateLimitTime:[{value:900,disabled:!0},this.posIntValidation],minVerificationCodeSendPeriod:["30",[S.required,S.min(5),S.pattern(/^\d*$/)]],providers:this.fb.array([])}),Object.values(yt).forEach(e=>{this.buildProvidersSettingsForm(e)}),this.twoFaFormGroup.get("verificationCodeCheckRateLimitEnable").valueChanges.pipe(lt(this.destroy$)).subscribe(e=>{e?(this.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").enable({emitEvent:!1}),this.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").enable({emitEvent:!1})):(this.twoFaFormGroup.get("verificationCodeCheckRateLimitNumber").disable({emitEvent:!1}),this.twoFaFormGroup.get("verificationCodeCheckRateLimitTime").disable({emitEvent:!1}))}),this.providersForm.valueChanges.pipe(lt(this.destroy$)).subscribe(e=>{let n=e.filter(l=>l.enable),t=Object.values(yt).indexOf(yt.BACKUP_CODE);!n.length||n.length===1&&n[0].providerType===yt.BACKUP_CODE?(this.providersForm.at(t).get("enable").setValue(!1,{emitEvent:!1}),this.providersForm.at(t).disable({emitEvent:!1}),this.providersForm.at(t).get("providerType").enable({emitEvent:!1})):this.providersForm.at(t).get("enable").enable({emitEvent:!1})})}setAuthConfigFormValue(e){let[n,t]=this.splitRateLimit(e?.verificationCodeCheckRateLimit),l=e?.providers.map(y=>y.providerType)||[],u=Object.assign({},e,{verificationCodeCheckRateLimitEnable:n>0,verificationCodeCheckRateLimitNumber:n||3,verificationCodeCheckRateLimitTime:t||900,providers:[]});n>0&&this.getByIndexPanel(this.providersForm.length).open(),Object.values(yt).forEach((y,w)=>{let x=l.indexOf(y);x>-1?(u.providers.push(Object.assign(e.providers[x],{enable:!0})),this.getByIndexPanel(w).open()):u.providers.push({enable:!1})}),this.twoFaFormGroup.patchValue(u)}buildProvidersSettingsForm(e){let n={providerType:[e],enable:[!1]};switch(e){case yt.TOTP:n.issuerName=[{value:"ThingsBoard",disabled:!0},[S.required,S.pattern(/^(?!^\s+$).*$/)]];break;case yt.SMS:n.smsVerificationMessageTemplate=[{value:"Verification code: ${code}",disabled:!0},[S.required,S.pattern(/\${code}/)]],n.verificationCodeLifetime=[{value:120,disabled:!0},this.posIntValidation];break;case yt.EMAIL:n.verificationCodeLifetime=[{value:120,disabled:!0},this.posIntValidation];break;case yt.BACKUP_CODE:n.codesQuantity=[{value:10,disabled:!0},this.posIntValidation];break}let t=this.fb.group(n);t.get("enable").valueChanges.pipe(lt(this.destroy$)).subscribe(l=>{l?t.enable({emitEvent:!1}):(t.disable({emitEvent:!1}),t.get("enable").enable({emitEvent:!1}),t.get("providerType").enable({emitEvent:!1}))}),this.providersForm.push(t,{emitEvent:!1})}getByIndexPanel(e){return this.expansionPanel.find((n,t)=>t===e)}splitRateLimit(e){if($o(e)){let[n,t]=e.split(":");return[parseInt(n,10),parseInt(t,10)]}return[0,0]}joinRateLimit(e,n){e[`${n}Enable`]&&(e[n]=[e[`${n}Number`],e[`${n}Time`]].join(":")),delete e[`${n}Enable`],delete e[`${n}Number`],delete e[`${n}Time`]}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(zi),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-2fa-settings"]],viewQuery:function(n,t){if(n&1&&Ie(Gi,5),n&2){let l;Me(l=we())&&(t.expansionPanel=l)}},features:[L],decls:54,vars:26,consts:[["appearance","outlined",1,"settings-card"],["translate","",1,"mat-headline-5"],[1,"flex-1"],["tb-help","twoFactorAuthentication"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[3,"ngSubmit","formGroup"],[3,"disabled"],["formArrayName","providers",1,"fields-group"],["translate","",1,"group-title"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"fields-group"],[1,"input-row","flex","flex-row","xs:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-1"],["translate",""],["matInput","","required","","formControlName","totalAllowedTimeForVerification","type","number","step","1","min","60"],[4,"ngIf"],["matInput","","required","","formControlName","minVerificationCodeSendPeriod","type","number","step","1","min","5"],["matInput","","formControlName","maxVerificationFailuresBeforeUserLockout","type","number","step","1","min","0","max","65535"],[1,"provider"],[1,"flex","items-center","justify-start"],["formControlName","verificationCodeCheckRateLimitEnable",3,"mousedown"],["matExpansionPanelContent",""],[1,"flex","flex-row","items-center","justify-end","gap-2"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"provider",3,"formGroupName"],["formControlName","enable",3,"mousedown"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","flex flex-row xs:flex-col gt-xs:gap-2",4,"ngSwitchCase"],["matInput","","formControlName","issuerName","required",""],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],["matInput","","formControlName","smsVerificationMessageTemplate","required",""],["matInput","","formControlName","verificationCodeLifetime","type","number","step","1","min","1","required",""],["matInput","","formControlName","codesQuantity","type","number","step","1","min","1","required",""],["matInput","","formControlName","verificationCodeCheckRateLimitNumber","required","","type","number","step","1","min","1"],["matInput","","formControlName","verificationCodeCheckRateLimitTime","required","","type","number","step","1","min","1"]],template:function(n,t){n&1&&(r(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"mat-card-title")(4,"span",1),p(5,"admin.2fa.2fa"),a()(),f(6,"span",2)(7,"div",3),a(),b(8,e1,1,0,"mat-progress-bar",4),d(9,"async"),b(10,t1,1,0,"div",5),d(11,"async"),r(12,"mat-card-content")(13,"form",6),_("ngSubmit",function(){return t.save()}),r(14,"fieldset",7),d(15,"async"),r(16,"div")(17,"fieldset",8)(18,"legend",9),p(19,"admin.2fa.available-providers"),a(),b(20,b1,9,5,"ng-container",10),a(),r(21,"fieldset",11)(22,"legend",9),p(23,"admin.2fa.verification-limitations"),a(),r(24,"div",12)(25,"mat-form-field",13)(26,"mat-label",14),p(27,"admin.2fa.total-allowed-time-for-verification"),a(),f(28,"input",15),b(29,v1,3,3,"mat-error",16)(30,y1,3,3,"mat-error",16),a(),r(31,"mat-form-field",13)(32,"mat-label",14),p(33,"admin.2fa.retry-verification-code-period"),a(),f(34,"input",17),b(35,_1,3,3,"mat-error",16)(36,C1,3,3,"mat-error",16),a(),r(37,"mat-form-field",13)(38,"mat-label",14),p(39,"admin.2fa.max-verification-failures-before-user-lockout"),a(),f(40,"input",18),b(41,S1,3,3,"mat-error",16),a()(),r(42,"mat-expansion-panel",19)(43,"mat-expansion-panel-header")(44,"mat-panel-title",20)(45,"mat-slide-toggle",21),_("mousedown",function(u){return t.toggleExtensionPanel(u,t.providersForm.length,t.twoFaFormGroup.get("verificationCodeCheckRateLimitEnable").value)}),a(),p(46),d(47,"translate"),a()(),b(48,M1,13,4,"ng-template",22),a()()(),r(49,"div",23)(50,"button",24),d(51,"async"),p(52),d(53,"translate"),a()()()()()()()),n&2&&(o(8),s("ngIf",c(9,14,t.isLoading$)),o(2),s("ngIf",!c(11,16,t.isLoading$)),o(3),s("formGroup",t.twoFaFormGroup),o(),s("disabled",c(15,18,t.isLoading$)),o(6),s("ngForOf",t.providersForm.controls)("ngForTrackBy",t.trackByElement),o(9),s("ngIf",t.twoFaFormGroup.get("totalAllowedTimeForVerification").hasError("required")),o(),s("ngIf",t.twoFaFormGroup.get("totalAllowedTimeForVerification").hasError("pattern")||t.twoFaFormGroup.get("totalAllowedTimeForVerification").hasError("min")),o(5),s("ngIf",t.twoFaFormGroup.get("minVerificationCodeSendPeriod").hasError("required")),o(),s("ngIf",t.twoFaFormGroup.get("minVerificationCodeSendPeriod").hasError("pattern")||t.twoFaFormGroup.get("minVerificationCodeSendPeriod").hasError("min")),o(5),s("ngIf",t.twoFaFormGroup.get("maxVerificationFailuresBeforeUserLockout").hasError("pattern")||t.twoFaFormGroup.get("maxVerificationFailuresBeforeUserLockout").hasError("min")||t.twoFaFormGroup.get("maxVerificationFailuresBeforeUserLockout").hasError("max")),o(5),h(" ",c(47,20,"admin.2fa.verification-code-check-rate-limit")," "),o(4),s("disabled",c(51,22,t.isLoading$)||t.twoFaFormGroup.invalid||!t.twoFaFormGroup.dirty),o(2),h(" ",c(53,24,"action.save")," "))},dependencies:[Te,G,_n,Cn,wt,ee,Xt,ni,ci,di,qe,he,me,Ce,Pe,mn,ht,Gi,rn,sn,eo,ce,ge,Ui,W,K,ue,qi,ln,ie,se,bt,mu,J,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   mat-card-header.mat-mdc-card-header[_ngcontent-%COMP%]{align-items:center}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}','@charset "UTF-8";@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:90%}}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{margin:8px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px;position:relative;padding-bottom:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3;width:fit-content;margin:0 8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   .input-row[_ngcontent-%COMP%]{padding:8px 8px 0}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel[_ngcontent-%COMP%]{box-shadow:none;margin:1px 0 0}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]{overflow:inherit}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]{padding:0 24px 0 8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]{height:48px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-expansion-panel.provider[_ngcontent-%COMP%]   .mat-expansion-panel-header-title[_ngcontent-%COMP%]{height:40px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-form-field-infix{width:100%}[_nghost-%COMP%]     .mat-expansion-panel .mat-expansion-panel-content{font-size:16px}[_nghost-%COMP%]     .mat-expansion-panel.provider .mat-expansion-panel-header>.mat-content{overflow:inherit}[_nghost-%COMP%]     .mat-expansion-panel.provider .mat-expansion-panel-body{padding:0 16px 8px 8px}']})}}return i})();C();C();C();function w1(i,m){if(i&1){let e=j();r(0,"mat-tab",2,0),d(2,"translate"),r(3,"tb-version-control",3),_("versionRestored",function(){I(e);let t=v();return M(t.entitiesTableConfig.updateData())}),a()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),s("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.title)("externalEntityId",n.entity.externalId||n.entity.id)}}var Ks=(()=>{class i extends Lt{constructor(e){super(e),this.store=e}isTenantWidgetsBundle(){return this.entity&&this.entity.tenantId.id!==Ae}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-widgets-bundle-tabs"]],features:[L],decls:1,vars:1,consts:[["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,w1,4,7,"mat-tab",1),n&2&&s("ngIf",t.isTenantWidgetsBundle()&&t.authUser.authority===t.authorities.TENANT_ADMIN)},dependencies:[G,St,ai,R],encapsulation:2})}}return i})();var Xs=(()=>{class i{constructor(e,n,t,l,u,y,w){this.store=e,this.dialogService=n,this.widgetsService=t,this.translate=l,this.importExport=u,this.datePipe=y,this.router=w,this.config=new Ge,this.config.entityType=k.WIDGETS_BUNDLE,this.config.entityComponent=gs,this.config.entityTabsComponent=Ks,this.config.entityTranslations=Ue.get(k.WIDGETS_BUNDLE),this.config.entityResources=tt.get(k.WIDGETS_BUNDLE),this.config.defaultSortOrder={property:"title",direction:Zt.ASC},this.config.rowPointer=!0,this.config.entityTitle=x=>x?x.title:"",this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("title","widgets-bundle.title","100%"),new Y("tenantId","widgets-bundle.system","60px",x=>Ft(x.tenantId.id===Ae))),this.config.addActionDescriptors.push({name:this.translate.instant("widgets-bundle.create-new-widgets-bundle"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:x=>this.config.getTable().addEntity(x)},{name:this.translate.instant("widgets-bundle.import"),icon:"file_upload",isEnabled:()=>!0,onAction:x=>this.importWidgetsBundle(x)}),this.config.cellActionDescriptors.push({name:this.translate.instant("widgets-bundle.export"),icon:"file_download",isEnabled:()=>!0,onAction:(x,q)=>this.exportWidgetsBundle(x,q)},{name:this.translate.instant("widgets-bundle.widgets-bundle-details"),icon:"edit",isEnabled:()=>!0,onAction:(x,q)=>this.config.toggleEntityDetails(x,q)}),this.config.deleteEntityTitle=x=>this.translate.instant("widgets-bundle.delete-widgets-bundle-title",{widgetsBundleTitle:x.title}),this.config.deleteEntityContent=()=>this.translate.instant("widgets-bundle.delete-widgets-bundle-text"),this.config.deleteEntitiesTitle=x=>this.translate.instant("widgets-bundle.delete-widgets-bundles-title",{count:x}),this.config.deleteEntitiesContent=()=>this.translate.instant("widgets-bundle.delete-widgets-bundles-text"),this.config.loadEntity=x=>this.widgetsService.getWidgetsBundle(x.id),this.config.saveEntity=x=>this.widgetsService.saveWidgetsBundle(x),this.config.deleteEntity=x=>this.widgetsService.deleteWidgetsBundle(x.id),this.config.onEntityAction=x=>this.onWidgetsBundleAction(x,this.config),this.config.handleRowClick=(x,q)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(x,q):this.openWidgetsBundle(x,q),!0),this.config.entityAdded=x=>{this.openWidgetsBundle(null,x)}}resolve(){this.config.tableTitle=this.translate.instant("widgets-bundle.widgets-bundles");let e=kt(this.store);this.config.deleteEnabled=t=>this.isWidgetsBundleEditable(t,e.authority),this.config.entitySelectionEnabled=t=>this.isWidgetsBundleEditable(t,e.authority),this.config.detailsReadonly=t=>!this.isWidgetsBundleEditable(t,e.authority);let n=Li(this.store);return this.config.entitiesFetchFunction=t=>this.widgetsService.getWidgetBundles(t),this.config}isWidgetsBundleEditable(e,n){return n===E.TENANT_ADMIN?e&&e.tenantId&&e.tenantId.id!==Ae:n===E.SYS_ADMIN}importWidgetsBundle(e){this.importExport.importWidgetsBundle().subscribe(n=>{n&&this.config.updateData()})}openWidgetsBundle(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`resources/widgets-bundles/${n.id.id}/widgetTypes`)}openWidgetsBundleDetails(e,n,t){e&&e.stopPropagation();let l=this.router.createUrlTree(["details",n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(l)}exportWidgetsBundle(e,n){e&&e.stopPropagation(),this.importExport.exportWidgetsBundle(n.id.id)}onWidgetsBundleAction(e,n){switch(e.action){case"open":return this.openWidgetsBundle(e.event,e.entity),!0;case"openDetails":return this.openWidgetsBundleDetails(e.event,e.entity,n),!0;case"export":return this.exportWidgetsBundle(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(D(F),D(jt),D(si),D(Z),D(Fi),D(ke),D(pe))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();C();function D1(i,m){i&1&&f(0,"mat-progress-bar",16)}function P1(i,m){i&1&&f(0,"div",17)}function F1(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"widget.title-required")," "))}var Aa=(()=>{class i extends nt{constructor(e,n,t,l,u){super(e,n,l),this.store=e,this.router=n,this.data=t,this.dialogRef=l,this.fb=u,this.dialogTitle="widget.save-widget-as",this.saveAsActionTitle="action.saveAs",kt(e).authority===E.TENANT_ADMIN?this.bundlesScope="tenant":this.bundlesScope="system",this.data?.dialogTitle&&(this.dialogTitle=this.data.dialogTitle),this.data?.saveAsActionTitle&&(this.saveAsActionTitle=this.data.saveAsActionTitle)}ngOnInit(){this.saveWidgetTypeAsFormGroup=this.fb.group({title:[this.data?.title,[S.required]],widgetsBundle:[null]})}cancel(){this.dialogRef.close(null)}saveAs(){let e=this.saveWidgetTypeAsFormGroup.get("title").value,n=this.saveWidgetTypeAsFormGroup.get("widgetsBundle").value?.id?.id,t={widgetName:e,widgetBundleId:n};this.dialogRef.close(t)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(Ot),g(it),g(dt))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-save-widget-type-as-dialog"]],features:[L],decls:30,vars:23,consts:[[2,"min-width","360px",3,"ngSubmit","formGroup"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[1,"mat-block"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formControlName","widgetsBundle","createNew","",3,"bundlesScope"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){n&1&&(r(0,"form",0),_("ngSubmit",function(){return t.saveAs()}),r(1,"mat-toolbar",1)(2,"h2",2),p(3),a(),f(4,"span",3),r(5,"button",4),_("click",function(){return t.cancel()}),r(6,"mat-icon",5),p(7,"close"),a()()(),b(8,D1,1,0,"mat-progress-bar",6),d(9,"async"),b(10,P1,1,0,"div",7),d(11,"async"),r(12,"div",8)(13,"span",2),p(14),a(),r(15,"mat-form-field",9)(16,"mat-label",2),p(17,"widget.title"),a(),f(18,"input",10),b(19,F1,3,3,"mat-error",11),a(),f(20,"tb-widgets-bundle-select",12),a(),r(21,"div",13)(22,"button",14),d(23,"async"),_("click",function(){return t.cancel()}),p(24),d(25,"translate"),a(),r(26,"button",15),d(27,"async"),p(28),d(29,"translate"),a()()()),n&2&&(s("formGroup",t.saveWidgetTypeAsFormGroup),o(3),O(t.dialogTitle),o(5),s("ngIf",c(9,11,t.isLoading$)),o(2),s("ngIf",!c(11,13,t.isLoading$)),o(4),O(t.dialogTitle),o(5),s("ngIf",t.saveWidgetTypeAsFormGroup.get("title").hasError("required")),o(),T("bundlesScope",t.bundlesScope),o(2),s("disabled",c(23,15,t.isLoading$)),o(2),h(" ",c(25,17,"action.cancel")," "),o(2),s("disabled",c(27,19,t.isLoading$)||t.saveWidgetTypeAsFormGroup.invalid||!t.saveWidgetTypeAsFormGroup.dirty),o(2),h(" ",c(29,21,t.saveAsActionTitle)," "))},dependencies:[G,x0,ee,Ee,ae,qe,he,me,Ce,Pe,at,Rt,mt,ce,ge,W,K,ue,ie,se,J,le,R],encapsulation:2})}}return i})();C();var A1=i=>({self:{description:"Built-in variable <b>self</b> that is a reference to the widget instance",type:'<a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L350" target="_blank">WidgetTypeInstance</a>',meta:"object",children:_e({onInit:{description:"The first function which is called when widget is ready for initialization.<br>Should be used to prepare widget DOM, process widget settings and initial subscription information.",meta:"function"},onDataUpdated:{description:'Called when the new data is available from the widget subscription.<br>Latest data can be accessed from the <code>defaultSubscription</code> property of <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onResize:{description:'Called when widget container is resized. Latest <code>width</code> and <code>height</code> can be obtained from <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onEditModeChanged:{description:'Called when dashboard editing mode is changed. Latest mode is handled by <code>isEdit</code> property of <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onMobileModeChanged:{description:'Called when dashboard view width crosses mobile breakpoint. Latest state is handled by <code>isMobile</code> property of <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/modules/home/models/widget-component.models.ts#L83" target="_blank">widget context (<code>ctx</code>)</a>.',meta:"function"},onDestroy:{description:"Called when widget element is destroyed. Should be used to cleanup all resources if necessary.",meta:"function"},getSettingsForm:{description:"Optional function returning widget settings form array as alternative to <b>Settings form</b> tab of settings section.",meta:"function",return:{description:"An array of widget settings form properties",type:"Array&lt;FormProperty&gt;"}},getDataKeySettingsForm:{description:"Optional function returning particular data key settings form array as alternative to <b>Data key settings form</b> tab of settings section.",meta:"function",return:{description:"An array of data key settings form properties",type:"Array&lt;FormProperty&gt;"}},getSettingsSchema:{description:"<b>Deprecated</b>. Use getSettingsForm() function.",meta:"function",return:{description:"An widget settings schema json",type:"object"}},getDataKeySettingsSchema:{description:"<b>Deprecated</b>. Use getDataKeySettingsForm() function.",meta:"function",return:{description:"A particular data key settings schema json",type:"object"}},typeParameters:{description:"Returns object describing widget datasource parameters.",meta:"function",return:{description:"An object describing widget datasource parameters.",type:'<a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/shared/models/widget.models.ts#L146" target="_blank">WidgetTypeParameters</a>'}},actionSources:{description:"Returns map describing available widget action sources used to define user actions.",meta:"function",return:{description:"A map of action sources by action source id.",type:'{[actionSourceId: string]: <a href="https://github.com/thingsboard/thingsboard/blob/13e6b10b7ab830e64d31b99614a9d95a1a25928a/ui-ngx/src/app/shared/models/widget.models.ts#L118" target="_blank">WidgetActionSource</a>}'}}},hf(i))}}),Yf=i=>new zo(A1(i));var B1=["topPanel"],V1=["topLeftPanel"],j1=["topRightPanel"],L1=["bottomPanel"],G1=["javascriptPanel"],U1=["framePanel"],q1=["htmlInput"],W1=["cssInput"],H1=["javascriptInput"],z1=["widgetIFrame"],$1=()=>({maxWidth:"1200px"});function J1(i,m){if(i&1&&(r(0,"mat-option",70),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.widgetTypesDataMap.get(n.widgetTypes[e]).name)," ")}}function Q1(i,m){if(i&1){let e=j();r(0,"button",27),d(1,"translate"),d(2,"async"),_("click",function(){I(e);let t=v();return M(t.saveWidget())}),r(3,"mat-icon"),p(4,"save"),a(),r(5,"span",24),p(6,"action.save"),a()()}if(i&2){let e=v();bo("matTooltip","",c(1,4,"widget.save")," (CTRL + S)"),s("disabled",c(2,6,e.isLoading$)||e.saveDisabled())("tb-circular-progress",e.saveWidgetPending)}}function Y1(i,m){if(i&1){let e=j();r(0,"button",32),d(1,"async"),_("click",function(){I(e);let t=v();return M(t.saveWidget())}),r(2,"mat-icon"),p(3,"save"),a(),r(4,"span",24),p(5,"action.save"),a()()}if(i&2){let e=v();s("disabled",c(1,1,e.isLoading$)||e.saveDisabled())}}function K1(i,m){if(i&1){let e=j();r(0,"div",71)(1,"tb-resource-autocomplete",72),d(2,"translate"),et("ngModelChange",function(t){let l=I(e).$implicit;return Ze(l.url,t)||(l.url=t),M(t)}),_("ngModelChange",function(){I(e);let t=v();return M(t.isDirty=!0)}),a(),r(3,"mat-checkbox",73),et("ngModelChange",function(t){let l=I(e).$implicit;return Ze(l.isModule,t)||(l.isModule=t),M(t)}),_("ngModelChange",function(){I(e);let t=v();return M(t.isDirty=!0)}),p(4),d(5,"translate"),a(),r(6,"button",74),d(7,"translate"),d(8,"async"),_("click",function(){let t=I(e).index,l=v();return M(l.removeResource(t))}),r(9,"mat-icon"),p(10,"close"),a()()()}if(i&2){let e=m.$implicit,n=v();o(),T("placeholder",c(2,7,"widget.resource-url")),s("allowAutocomplete",e.isModule),Xe("ngModel",e.url),o(2),Xe("ngModel",e.isModule),o(),h(" ",c(5,9,"widget.resource-is-extension")," "),o(2),T("matTooltip",c(7,11,"widget.remove-resource")),s("disabled",c(8,13,n.isLoading$))}}function X1(i,m){if(i&1){let e=j();r(0,"mat-form-field",52)(1,"mat-label",24),p(2,"widget.latest-data-key-settings-form-selector"),a(),r(3,"input",58),et("ngModelChange",function(t){I(e);let l=v();return Ze(l.widget.latestDataKeySettingsDirective,t)||(l.widget.latestDataKeySettingsDirective=t),M(t)}),_("ngModelChange",function(){I(e);let t=v();return M(t.isDirty=!0)}),a()()}if(i&2){let e=v();o(3),Xe("ngModel",e.widget.latestDataKeySettingsDirective)}}function Z1(i,m){if(i&1){let e=j();r(0,"mat-form-field",52)(1,"mat-label",24),p(2,"widget.basic-mode-form-selector"),a(),r(3,"input",58),et("ngModelChange",function(t){I(e);let l=v();return Ze(l.widget.basicModeDirective,t)||(l.widget.basicModeDirective=t),M(t)}),_("ngModelChange",function(){I(e);let t=v();return M(t.isDirty=!0)}),a()()}if(i&2){let e=v();o(3),Xe("ngModel",e.widget.basicModeDirective)}}function ev(i,m){i&1&&(r(0,"div",75),f(1,"mat-spinner",76),a())}var el=(()=>{class i extends Mt{get isDirty(){return this._isDirty||this.isEditModeWidget}set isDirty(e){e||(this.isEditModeWidget=!1),this._isDirty=e}constructor(e,n,t,l,u,y,w,x,q,De,Ve,Ct,en){super(e),this.store=e,this.window=n,this.route=t,this.router=l,this.widgetService=u,this.translate=y,this.raf=w,this.dialog=x,this.popoverService=q,this.renderer=De,this.viewContainerRef=Ve,this.customTranslate=Ct,this.http=en,this.widgetTypes=Si,this.allWidgetTypes=Object.keys(Si),this.widgetTypesDataMap=Zo,this.isEditModeWidget=!1,this._isDirty=!1,this.fullscreen=!1,this.htmlFullscreen=!1,this.cssFullscreen=!1,this.javascriptFullscreen=!1,this.iFrameFullscreen=!1,this.aceEditors=[],this.editorsResizeCafs={},this.onWindowMessageListener=this.onWindowMessage.bind(this),this.iframeWidgetEditModeInited=!1,this.saveWidgetPending=!1,this.saveWidgetAsPending=!1,this.gotError=!1,this.errorMarkers=[],this.errorAnnotationId=-1,this.hotKeys=[],this.updateBreadcrumbs=new Dt,this.rxSubscriptions=new Array,this.authUser=kt(e),this.rxSubscriptions.push(this.route.data.subscribe(td=>{this.init(td)})),this.initHotKeys()}init(e){if(this.widgetTypeDetails=e.widgetEditorData.widgetTypeDetails,this.widget=e.widgetEditorData.widget,this.authUser.authority===E.TENANT_ADMIN?this.isReadOnly=this.widgetTypeDetails&&this.widgetTypeDetails.tenantId.id===Ae:this.isReadOnly=this.authUser.authority!==E.SYS_ADMIN,this.widgetTypeDetails){let n=JSON.parse(this.widget.defaultConfig);this.widget.defaultConfig=JSON.stringify(n)}this.origWidget=Tt(this.widget),this.widgetTypeDetails||(this.isDirty=!0)}ngOnInit(){this.initSplitLayout(),this.initAceEditors(),this.iframe=$(this.widgetIFrameElmRef.nativeElement),this.window.addEventListener("message",this.onWindowMessageListener),this.iframe.attr("data-widget",JSON.stringify(this.widget)),this.iframe.attr("src","/widget-editor")}ngOnDestroy(){this.window.removeEventListener("message",this.onWindowMessageListener),this.aceEditors.forEach(e=>e.destroy()),this.aceResize$.disconnect(),this.rxSubscriptions.forEach(e=>{e.unsubscribe()}),this.rxSubscriptions.length=0}initHotKeys(){this.hotKeys.push(new ta("ctrl+q",e=>(!Vr(this.store)&&!this.undoDisabled()&&(e.preventDefault(),this.undoWidget()),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.undo"))),this.hotKeys.push(new ta("ctrl+s",e=>(!Vr(this.store)&&!this.saveDisabled()&&(e.preventDefault(),this.saveWidget()),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.save"))),this.hotKeys.push(new ta("shift+ctrl+s",e=>(!Vr(this.store)&&!this.saveAsDisabled()&&(e.preventDefault(),this.saveWidgetAs()),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.saveAs"))),this.hotKeys.push(new ta("shift+ctrl+f",e=>(e.preventDefault(),this.fullscreen=!this.fullscreen,!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.toggle-fullscreen"))),this.hotKeys.push(new ta("ctrl+enter",e=>(e.preventDefault(),this.applyWidgetScript(),!1),["INPUT","SELECT","TEXTAREA"],this.translate.instant("widget.run")))}initSplitLayout(){Split([this.topPanelElmRef.nativeElement,this.bottomPanelElmRef.nativeElement],{sizes:[35,65],gutterSize:8,cursor:"row-resize",direction:"vertical"}),Split([this.topLeftPanelElmRef.nativeElement,this.topRightPanelElmRef.nativeElement],{sizes:[50,50],gutterSize:8,cursor:"col-resize"}),Split([this.javascriptPanelElmRef.nativeElement,this.framePanelElmRef.nativeElement],{sizes:[50,50],gutterSize:8,cursor:"col-resize"})}initAceEditors(){this.aceResize$=new ResizeObserver(n=>{n.forEach(t=>{let l=this.aceEditors.find(u=>u.container===t.target);this.onAceEditorResize(l)})});let e=[];e.push(this.createAceEditor(this.htmlInputElmRef,"html").pipe(xt(n=>{this.htmlEditor=n,this.htmlEditor.on("input",()=>{let t=this.htmlEditor.getValue();this.widget.templateHtml!==t&&(this.widget.templateHtml=t,this.isDirty=!0)})}))),e.push(this.createAceEditor(this.cssInputElmRef,"css").pipe(xt(n=>{this.cssEditor=n,this.cssEditor.on("input",()=>{let t=this.cssEditor.getValue();this.widget.templateCss!==t&&(this.widget.templateCss=t,this.isDirty=!0)})}))),e.push(this.createAceEditor(this.javascriptInputElmRef,"javascript").pipe(xt(n=>{this.jsEditor=n,this.jsEditor.on("input",()=>{let t=this.jsEditor.getValue();this.controllerScriptBody!==t&&(this.controllerScriptBody=t,this.isDirty=!0)}),this.jsEditor.on("change",()=>{this.cleanupJsErrors()}),this.jsEditor.completer||(this.jsEditor.execCommand("startAutocomplete"),this.jsEditor.completer.detach()),this.jsEditor.completer.popup.container.style.width="500px",this.initialCompleters=this.jsEditor.completers||[]}))),Nt(e).subscribe(()=>{this.setAceEditorValues()})}setAceEditorValues(){this.htmlEditor.setValue(this.widget.templateHtml?this.widget.templateHtml:"",-1),this.cssEditor.setValue(this.widget.templateCss?this.widget.templateCss:"",-1),this.jsEditor.setValue(this.controllerScriptBody?this.controllerScriptBody:"",-1),this.updateControllerScriptCompleters()}createAceEditor(e,n){let t=e.nativeElement,l={mode:`ace/mode/${n}`,showGutter:!0,showPrintMargin:!0},u={enableSnippets:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0};return l=_e(_e({},l),u),ku().pipe(ze(y=>{let w=y.edit(t,l);return w.session.setUseWrapMode(!0),this.aceEditors.push(w),this.aceResize$.observe(t),w}))}onAceEditorResize(e){this.editorsResizeCafs[e.id]&&(this.editorsResizeCafs[e.id](),delete this.editorsResizeCafs[e.id]),this.editorsResizeCafs[e.id]=this.raf.raf(()=>{e.resize(),e.renderer.updateFull()})}onWindowMessage(e){let n;if(e.data)try{n=JSON.parse(e.data)}catch{}if(n)switch(n.type){case"widgetException":this.onWidgetException(n.data);break;case"widgetEditModeInited":this.onWidgetEditModeInited();break;case"widgetEditUpdated":this.onWidgetEditUpdated(n.data),this.onWidgetEditModeToggled(!1);break;case"widgetEditModeToggle":this.onWidgetEditModeToggled(n.data);break}}onWidgetEditModeInited(){this.iframeWidgetEditModeInited=!0,(this.saveWidgetPending||this.saveWidgetAsPending)&&(this.saveWidgetTimeout||(this.saveWidgetTimeout=setTimeout(()=>{this.gotError?(this.store.dispatch(new Be({message:this.translate.instant("widget.unable-to-save-widget-error"),type:"error"})),this.saveWidgetPending=!1,this.saveWidgetAsPending=!1):this.saveWidgetPending?this.commitSaveWidget():this.saveWidgetAsPending&&this.commitSaveWidgetAs(),this.saveWidgetTimeout=void 0},1500)))}onWidgetEditUpdated(e){this.widget.sizeX=e.sizeX/2,this.widget.sizeY=e.sizeY/2,this.widget.defaultConfig=JSON.stringify(e.config),this.iframe.attr("data-widget",JSON.stringify(this.widget)),this.isDirty=!0}onWidgetEditModeToggled(e){this.isEditModeWidget=e}onWidgetException(e){if(!this.gotError){this.gotError=!0;let n="Error:";if(e.message&&(n+=" "+e.message),e.lineNumber&&(n+="<br>Line "+e.lineNumber,e.columnNumber&&(n+=" column "+e.columnNumber),n+=" of script."),!this.saveWidgetPending&&!this.saveWidgetAsPending&&this.store.dispatch(new Be({message:n,type:"error",target:"javascriptPanel"})),e.lineNumber){let t=e.lineNumber-1,l=0;e.columnNumber&&(l=e.columnNumber);let u=this.jsEditor.session.addMarker(new Ou(t,0,t,1/0),"ace_active-line","screenLine");this.errorMarkers.push(u);let y=this.jsEditor.session.getAnnotations(),w={row:t,column:l,text:e.message,type:"error"};this.errorAnnotationId=y.push(w)-1,this.jsEditor.session.setAnnotations(y)}}}cleanupJsErrors(){if(this.store.dispatch(new iu({})),this.errorMarkers.forEach(e=>{this.jsEditor.session.removeMarker(e)}),this.errorMarkers.length=0,this.errorAnnotationId>-1){let e=this.jsEditor.session.getAnnotations();e.splice(this.errorAnnotationId,1),this.jsEditor.session.setAnnotations(e),this.errorAnnotationId=-1}}commitSaveWidget(){let e=this.widgetTypeDetails&&this.widgetTypeDetails.id?this.widgetTypeDetails.id:void 0,n=this.widgetTypeDetails?.version??null,t=this.widgetTypeDetails&&this.widgetTypeDetails.createdTime?this.widgetTypeDetails.createdTime:void 0;this.saveWidgetPending=!1,this.widgetService.saveWidgetTypeDetails(this.widget,e,t,n).pipe(_t(l=>{this.saveWidgetPending=!0;let u=this.route.snapshot.params.widgetsBundleId;return u&&!e?this.widgetService.addWidgetFqnToWidgetBundle(u,l.fqn).pipe(ze(()=>l)):ut(l)}),Qi(l=>e&&l.status===Er.Conflict?this.widgetService.getWidgetTypeById(e.id).pipe(ze(u=>Lr(u))):vr(()=>l))).subscribe({next:l=>{this.saveWidgetPending=!1,this.widgetTypeDetails?.id?this.setWidgetTypeDetails(l):(this.isDirty=!1,this.router.navigate(["..",l.id.id],{relativeTo:this.route})),this.store.dispatch(new Be({message:this.translate.instant("widget.widget-saved"),type:"success",duration:500}))},error:()=>{this.saveWidgetPending=!1}})}commitSaveWidgetAs(){this.dialog.open(Aa,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(e=>{if(e){this.widget.widgetName=e.widgetName,this.widget.fullFqn=void 0;let n=JSON.parse(this.widget.defaultConfig);n.title=this.widget.widgetName,this.widget.defaultConfig=JSON.stringify(n),this.isDirty=!1,this.widgetService.saveWidgetTypeDetails(this.widget,void 0,void 0,void 0).pipe(_t(t=>e.widgetBundleId?this.widgetService.addWidgetFqnToWidgetBundle(e.widgetBundleId,t.fqn).pipe(ze(()=>t)):ut(t))).subscribe({next:t=>{this.saveWidgetAsPending=!1,e.widgetBundleId?this.router.navigate(["resources","widgets-library","widgets-bundles",e.widgetBundleId,t.id.id]):this.router.navigate(["resources","widgets-library","widget-types",t.id.id])},error:()=>{this.saveWidgetAsPending=!1}})}else this.saveWidgetAsPending=!1})}setWidgetTypeDetails(e){this.widgetTypeDetails=e,this.widget=Zr(this.widgetTypeDetails);let n=JSON.parse(this.widget.defaultConfig);this.widget.defaultConfig=JSON.stringify(n),this.origWidget=Tt(this.widget),this.isDirty=!1,this.updateBreadcrumbs.emit()}applyWidgetScript(){this.cleanupJsErrors(),this.gotError=!1,this.iframeWidgetEditModeInited=!1;let e=JSON.parse(this.widget.defaultConfig);e.title||(e.title=this.widget.widgetName),this.widget.defaultConfig=JSON.stringify(e),this.iframe.attr("data-widget",JSON.stringify(this.widget)),this.iframe[0].contentWindow.location.reload(!0)}undoWidget(){this.widget=Tt(this.origWidget),this.setAceEditorValues(),this.isDirty=!1,this.applyWidgetScript()}saveWidget(){this.widget.widgetName?(this.saveWidgetPending=!0,this.applyWidgetScript()):this.store.dispatch(new Be({message:this.translate.instant("widget.missing-widget-title-error"),type:"error"}))}saveWidgetAs(){this.saveWidgetAsPending=!0,this.applyWidgetScript()}undoDisabled(){return!this._isDirty||!this.iframeWidgetEditModeInited||this.saveWidgetPending||this.saveWidgetAsPending}saveDisabled(){return this.isReadOnly||!this._isDirty||!this.iframeWidgetEditModeInited||this.saveWidgetPending||this.saveWidgetAsPending}saveAsDisabled(){return!this.iframeWidgetEditModeInited||this.saveWidgetPending||this.saveWidgetAsPending}beautifyCss(){w0(this.widget.templateCss,{indent_size:4}).subscribe(e=>{this.widget.templateCss!==e&&(this.isDirty=!0,this.widget.templateCss=e,this.cssEditor.setValue(this.widget.templateCss?this.widget.templateCss:"",-1))})}beautifyHtml(){D0(this.widget.templateHtml,{indent_size:4,wrap_line_length:60}).subscribe(e=>{this.widget.templateHtml!==e&&(this.isDirty=!0,this.widget.templateHtml=e,this.htmlEditor.setValue(this.widget.templateHtml?this.widget.templateHtml:"",-1))})}beautifyJs(){M0(this.controllerScriptBody,{indent_size:4,wrap_line_length:60}).subscribe(e=>{this.controllerScriptBody!==e&&(this.isDirty=!0,this.controllerScriptBody=e,this.jsEditor.setValue(this.controllerScriptBody?this.controllerScriptBody:"",-1))})}removeResource(e){e>-1&&this.widget.resources.splice(e,1).length>0&&(this.isDirty=!0)}addResource(){this.widget.resources.push({url:""}),this.isDirty=!0}widgetTypeChanged(){let e=JSON.parse(this.widget.defaultConfig);this.widget.type!==Si.rpc&&this.widget.type!==Si.alarm?(e.targetDevice&&delete e.targetDevice,e.alarmSource&&delete e.alarmSource,e.datasources||(e.datasources=[]),e.timewindow||(e.timewindow={realtime:{timewindowMs:6e4}})):this.widget.type===Si.rpc?(e.datasources&&delete e.datasources,e.alarmSource&&delete e.alarmSource,e.timewindow&&delete e.timewindow,e.targetDevice||(e.targetDevice={type:Zc.device})):(e.datasources&&delete e.datasources,e.targetDevice&&delete e.targetDevice,e.alarmSource||(e.alarmSource={}),e.timewindow||(e.timewindow={realtime:{timewindowMs:24*60*60*1e3}})),this.widget.defaultConfig=JSON.stringify(e),this.isDirty=!0}settingsFormUpdated(){this.isDirty=!0,this.updateControllerScriptCompleters()}dataKeySettingsFormUpdated(){this.isDirty=!0}latestDataKeySettingsFormUpdated(){this.isDirty=!0}editControllerScriptModules(e,n){e&&e.stopPropagation();let t=n._elementRef.nativeElement;if(this.popoverService.hasPopover(t))this.popoverService.hidePopover(t);else{let l={modules:Tt(this.controllerScriptModules)},u=this.popoverService.displayPopover({trigger:t,renderer:this.renderer,hostView:this.viewContainerRef,componentType:F0,preferredPlacement:["leftOnly","leftTopOnly","leftBottomOnly"],context:l,isModal:!0});u.tbComponentRef.instance.popover=u,u.tbComponentRef.instance.modulesApplied.subscribe(y=>{u.hide(),this.controllerScriptModules=y,this.updateControllerScriptCompleters(),this.isDirty=!0})}}get controllerScriptBody(){return typeof this.widget.controllerScript=="string"?this.widget.controllerScript:this.widget.controllerScript.body}set controllerScriptBody(e){typeof this.widget.controllerScript=="string"?this.widget.controllerScript=e:this.widget.controllerScript.body=e}get controllerScriptModules(){return typeof this.widget.controllerScript=="string"?null:this.widget.controllerScript.modules}set controllerScriptModules(e){e&&Object.keys(e).length?typeof this.widget.controllerScript=="string"?this.widget.controllerScript={body:this.widget.controllerScript,modules:e}:this.widget.controllerScript.modules=e:typeof this.widget.controllerScript!="string"&&(this.widget.controllerScript=this.widget.controllerScript.body)}get confirmOnExitMessage(){return this.isEditModeWidget&&!this._isDirty?this.translate.instant("widget.confirm-to-exit-editor-html"):""}updateControllerScriptCompleters(){Pc(this.http,this.controllerScriptModules).subscribe(n=>{let t=[],l=jr(this.widget.settingsForm||[],this.customTranslate);t.push(Yf(l)),n&&t.push(n),t.push(...this.initialCompleters),this.jsEditor.completers=t})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Xo),g(Vi),g(pe),g(si),g(Z),g(Nu),g(je),g(Pn),g(vn),g(nn),g(mi),g(Ir))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-widget-editor"]],viewQuery:function(n,t){if(n&1&&(Ie(B1,7),Ie(V1,7),Ie(j1,7),Ie(L1,7),Ie(G1,7),Ie(U1,7),Ie(q1,7),Ie(W1,7),Ie(H1,7),Ie(z1,7)),n&2){let l;Me(l=we())&&(t.topPanelElmRef=l.first),Me(l=we())&&(t.topLeftPanelElmRef=l.first),Me(l=we())&&(t.topRightPanelElmRef=l.first),Me(l=we())&&(t.bottomPanelElmRef=l.first),Me(l=we())&&(t.javascriptPanelElmRef=l.first),Me(l=we())&&(t.framePanelElmRef=l.first),Me(l=we())&&(t.htmlInputElmRef=l.first),Me(l=we())&&(t.cssInputElmRef=l.first),Me(l=we())&&(t.javascriptInputElmRef=l.first),Me(l=we())&&(t.widgetIFrameElmRef=l.first)}},features:[L],decls:194,vars:150,consts:[["cheatSheetComponent",""],["widgetEditMenu","matMenu"],["topPanel",""],["topLeftPanel",""],["htmlInput",""],["cssInput",""],["topRightPanel",""],["descriptionInput",""],["bottomPanel",""],["javascriptPanel",""],["editModulesButton",""],["javascriptInput",""],["framePanel",""],["widgetIFrame",""],[1,"flex","flex-1","flex-col"],["tb-fullscreen","",1,"flex","flex-1","flex-col",3,"fullscreen","tb-hotkeys","cheatSheet"],[1,"mat-elevation-z1","tb-edit-toolbar","mat-hue-3","gap-4","lt-xl:gap-2"],[1,"tb-widget-title","tb-appearance-transparent"],["matInput","","required","","maxlength","255",3,"ngModelChange","disabled","ngModel","placeholder"],[1,"tb-appearance-transparent"],[3,"ngModelChange","disabled","placeholder","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"flex-1"],["mat-button","","matTooltipPosition","below",1,"lt-md:!hidden",3,"click","disabled","matTooltip"],["translate",""],["mat-raised-button","","matTooltipPosition","below",1,"lt-md:!hidden",3,"click","disabled","matTooltip"],["mat-raised-button","","class","lt-md:!hidden","matTooltipPosition","below",3,"disabled","tb-circular-progress","matTooltip","click",4,"ngIf"],["mat-raised-button","","matTooltipPosition","below",1,"lt-md:!hidden",3,"click","disabled","tb-circular-progress","matTooltip"],["mat-button","","matTooltipPosition","below",1,"lt-lg:!hidden",3,"click","matTooltip"],["mat-icon-button","","matTooltipPosition","below",1,"lt-md:!hidden","gt-md:!hidden",3,"click","matTooltip"],["mat-icon-button","",1,"gt-md:!hidden",3,"matMenuTriggerFor"],["xPosition","before"],["mat-menu-item","",3,"click","disabled"],["mat-menu-item","",3,"disabled","click",4,"ngIf"],[1,"flex-1",2,"position","relative"],[1,"tb-editor","tb-absolute-fill"],[1,"tb-split","tb-split-vertical"],[1,"tb-split","tb-content"],["mat-stretch-tabs","false","selectedIndex","1","dynamicHeight","true",2,"width","100%","height","100%"],[3,"label"],[1,"tb-resize-container",2,"background-color","#fff"],[1,"mat-padding"],["class","flex flex-1 flex-row items-center justify-start","style","max-height: 40px;",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","matTooltipPosition","above",2,"margin-top","8px",3,"click","disabled","matTooltip"],["tb-fullscreen","",1,"tb-resize-container",3,"fullscreen"],[1,"tb-editor-area-title-panel"],["mat-button","",3,"click"],["mat-icon-button","","matTooltipPosition","above",1,"tb-mat-32",3,"click","matTooltip"],["mat-stretch-tabs","false","dynamicHeight","true",2,"width","100%","height","100%"],["importExport","","noBorder","","fillHeight","",3,"ngModelChange","exportFileName","ngModel"],[3,"aria-labelledby","label"],[1,"flex-1",3,"ngModelChange","label","ngModel"],[1,"mat-block"],["matInput","","rows","2","maxlength","1024",3,"ngModelChange","ngModel"],["align","end"],[3,"ngModelChange","label","ngModel"],[1,"flex","flex-col","gap-4",2,"padding-bottom","16px"],[1,"mat-block",3,"ngModelChange","ngModel"],["matInput","",3,"ngModelChange","ngModel"],["class","mat-block",4,"ngIf"],[1,"mat-block",2,"padding-bottom","16px",3,"ngModelChange","ngModel"],["tb-toast","","toastTarget","javascriptPanel",1,"tb-split","tb-content"],["color","primary","matButtonIcon",""],["tb-help-popup","widget/editor/widget_js_fn","tb-help-popup-placement","top",3,"tb-help-popup-style"],[1,"tb-split","tb-content",2,"overflow-y","hidden","position","relative"],["class","mat-content tb-progress-cover flex flex-1 flex-col items-center justify-center",4,"ngIf"],["tb-fullscreen","",2,"width","100%","height","100%",3,"fullscreen"],["height","100%","width","100%",2,"border","0"],[2,"position","absolute","top","10px","left","10px","bottom","initial"],["mat-icon-button","","matTooltipPosition","above",1,"tb-fullscreen-button-style",3,"click","matTooltip"],[3,"value"],[1,"flex","flex-1","flex-row","items-center","justify-start",2,"max-height","40px"],["hideRequiredMarker","","required","","subscriptSizing","dynamic",1,"mat-block","resource-field","flex-1",3,"ngModelChange","allowAutocomplete","ngModel","placeholder"],[3,"ngModelChange","ngModel"],["mat-icon-button","","color","primary","matTooltipPosition","above",3,"click","disabled","matTooltip"],[1,"mat-content","tb-progress-cover","flex","flex-1","flex-col","items-center","justify-center"],["diameter","100","mode","indeterminate","color","warn"]],template:function(n,t){if(n&1){let l=j();r(0,"div",14)(1,"div",15),f(2,"tb-hotkeys-cheatsheet",null,0),r(4,"mat-toolbar",16)(5,"mat-form-field",17)(6,"input",18),d(7,"translate"),et("ngModelChange",function(y){return I(l),Ze(t.widget.widgetName,y)||(t.widget.widgetName=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.isDirty=!0)}),a()(),r(8,"mat-form-field",19)(9,"mat-select",20),d(10,"translate"),et("ngModelChange",function(y){return I(l),Ze(t.widget.type,y)||(t.widget.type=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.widgetTypeChanged())}),b(11,J1,3,4,"mat-option",21),a()(),f(12,"span",22),r(13,"button",23),d(14,"translate"),_("click",function(){return I(l),M(t.applyWidgetScript())}),r(15,"mat-icon"),p(16,"play_arrow"),a(),r(17,"span",24),p(18,"action.run"),a()(),r(19,"button",25),d(20,"translate"),d(21,"async"),_("click",function(){return I(l),M(t.undoWidget())}),r(22,"mat-icon"),p(23,"undo"),a(),r(24,"span",24),p(25,"action.undo"),a()(),b(26,Q1,7,8,"button",26),r(27,"button",27),d(28,"translate"),d(29,"async"),_("click",function(){return I(l),M(t.saveWidgetAs())}),r(30,"mat-icon"),p(31,"save_as"),a(),r(32,"span",24),p(33,"action.saveAs"),a()(),r(34,"button",28),d(35,"translate"),_("click",function(){return I(l),M(t.fullscreen=!t.fullscreen)}),r(36,"mat-icon"),p(37),a(),r(38,"span",24),p(39,"widget.toggle-fullscreen"),a()(),r(40,"button",29),d(41,"translate"),_("click",function(){return I(l),M(t.fullscreen=!t.fullscreen)}),r(42,"mat-icon"),p(43),a()(),r(44,"button",30)(45,"mat-icon"),p(46,"more_vert"),a()(),r(47,"mat-menu",31,1)(49,"button",32),_("click",function(){return I(l),M(t.applyWidgetScript())}),r(50,"mat-icon"),p(51,"play_arrow"),a(),r(52,"span",24),p(53,"action.run"),a()(),r(54,"button",32),d(55,"async"),_("click",function(){return I(l),M(t.undoWidget())}),r(56,"mat-icon"),p(57,"undo"),a(),r(58,"span",24),p(59,"action.undo"),a()(),b(60,Y1,6,3,"button",33),r(61,"button",32),d(62,"async"),_("click",function(){return I(l),M(t.saveWidgetAs())}),r(63,"mat-icon"),p(64,"save_as"),a(),r(65,"span",24),p(66,"action.saveAs"),a()()()(),r(67,"div",34)(68,"div",35)(69,"div",36,2)(71,"div",37,3)(73,"mat-tab-group",38)(74,"mat-tab",39),d(75,"translate"),r(76,"div",40)(77,"div",41),b(78,K1,11,15,"div",42),r(79,"button",43),d(80,"translate"),d(81,"async"),_("click",function(){return I(l),M(t.addResource())}),r(82,"span",24),p(83,"action.add"),a()()()()(),r(84,"mat-tab",39),d(85,"translate"),r(86,"div",44)(87,"div",45)(88,"button",46),_("click",function(){return I(l),M(t.beautifyHtml())}),p(89),d(90,"translate"),a(),r(91,"button",47),d(92,"translate"),_("click",function(){return I(l),M(t.htmlFullscreen=!t.htmlFullscreen)}),r(93,"mat-icon"),p(94),a()()(),f(95,"div",null,4),a()(),r(97,"mat-tab",39),d(98,"translate"),r(99,"div",44)(100,"div",45)(101,"button",46),_("click",function(){return I(l),M(t.beautifyCss())}),p(102),d(103,"translate"),a(),r(104,"button",47),d(105,"translate"),_("click",function(){return I(l),M(t.cssFullscreen=!t.cssFullscreen)}),r(106,"mat-icon"),p(107),a()()(),f(108,"div",null,5),a()()()(),r(110,"div",37,6)(112,"mat-tab-group",48)(113,"mat-tab",39),d(114,"translate"),r(115,"div",40)(116,"tb-dynamic-form-properties",49),et("ngModelChange",function(y){return I(l),Ze(t.widget.settingsForm,y)||(t.widget.settingsForm=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.settingsFormUpdated())}),a()()(),r(117,"mat-tab",39),d(118,"translate"),r(119,"div",40)(120,"tb-dynamic-form-properties",49),et("ngModelChange",function(y){return I(l),Ze(t.widget.dataKeySettingsForm,y)||(t.widget.dataKeySettingsForm=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.dataKeySettingsFormUpdated())}),a()()(),r(121,"mat-tab",50),d(122,"translate"),r(123,"div",40)(124,"tb-dynamic-form-properties",49),et("ngModelChange",function(y){return I(l),Ze(t.widget.latestDataKeySettingsForm,y)||(t.widget.latestDataKeySettingsForm=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.latestDataKeySettingsFormUpdated())}),a()()(),r(125,"mat-tab",39),d(126,"translate"),r(127,"div",40)(128,"div",41)(129,"tb-gallery-image-input",51),d(130,"translate"),et("ngModelChange",function(y){return I(l),Ze(t.widget.image,y)||(t.widget.image=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.isDirty=!0)}),a(),r(131,"mat-form-field",52)(132,"mat-label",24),p(133,"widget.description"),a(),r(134,"textarea",53,7),et("ngModelChange",function(y){return I(l),Ze(t.widget.description,y)||(t.widget.description=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.isDirty=!0)}),a(),r(136,"mat-hint",54),p(137),a()(),r(138,"tb-string-items-list",55),d(139,"translate"),et("ngModelChange",function(y){return I(l),Ze(t.widget.tags,y)||(t.widget.tags=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.isDirty=!0)}),a(),r(140,"div",56)(141,"mat-slide-toggle",57),et("ngModelChange",function(y){return I(l),Ze(t.widget.scada,y)||(t.widget.scada=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.isDirty=!0)}),p(142),d(143,"translate"),a(),r(144,"mat-slide-toggle",57),et("ngModelChange",function(y){return I(l),Ze(t.widget.deprecated,y)||(t.widget.deprecated=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.isDirty=!0)}),p(145),d(146,"translate"),a()(),r(147,"mat-form-field",52)(148,"mat-label",24),p(149,"widget.settings-form-selector"),a(),r(150,"input",58),et("ngModelChange",function(y){return I(l),Ze(t.widget.settingsDirective,y)||(t.widget.settingsDirective=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.isDirty=!0)}),a()(),r(151,"mat-form-field",52)(152,"mat-label",24),p(153,"widget.data-key-settings-form-selector"),a(),r(154,"input",58),et("ngModelChange",function(y){return I(l),Ze(t.widget.dataKeySettingsDirective,y)||(t.widget.dataKeySettingsDirective=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.isDirty=!0)}),a()(),b(155,X1,4,1,"mat-form-field",59),r(156,"mat-slide-toggle",60),et("ngModelChange",function(y){return I(l),Ze(t.widget.hasBasicMode,y)||(t.widget.hasBasicMode=y),M(y)}),_("ngModelChange",function(){return I(l),M(t.isDirty=!0)}),p(157),d(158,"translate"),a(),b(159,Z1,4,1,"mat-form-field",59),a()()()()()(),r(160,"div",36,8)(162,"div",61,9)(164,"div",44)(165,"div",45)(166,"label",24),p(167,"widget.javascript"),a(),r(168,"button",47,10),d(170,"translate"),_("click",function(y){I(l);let w=U(169);return M(t.editControllerScriptModules(y,w))}),r(171,"tb-icon",62),p(172,"mdi:application-braces-outline"),a()(),r(173,"button",46),_("click",function(){return I(l),M(t.beautifyJs())}),p(174),d(175,"translate"),a(),f(176,"span",63),r(177,"button",47),d(178,"translate"),_("click",function(){return I(l),M(t.javascriptFullscreen=!t.javascriptFullscreen)}),r(179,"mat-icon"),p(180),a()()(),f(181,"div",null,11),a()(),r(183,"div",64,12),b(185,ev,2,0,"div",65),r(186,"div",66),f(187,"iframe",67,13),r(189,"div",68)(190,"button",69),d(191,"translate"),_("click",function(){return I(l),M(t.iFrameFullscreen=!t.iFrameFullscreen)}),r(192,"mat-icon"),p(193),a()()()()()()()()()()}if(n&2){let l=U(3),u=U(48),y=U(135);o(),s("fullscreen",t.fullscreen)("tb-hotkeys",t.hotKeys)("cheatSheet",l),o(5),T("placeholder",c(7,83,"widget.widget-title")),s("disabled",t.isReadOnly),Xe("ngModel",t.widget.widgetName),o(3),T("placeholder",c(10,85,"widget.type")),s("disabled",t.isReadOnly),Xe("ngModel",t.widget.type),o(2),s("ngForOf",t.allWidgetTypes),o(2),bo("matTooltip","",c(14,87,"widget.run")," (CTRL + Return)"),s("disabled",!t.iframeWidgetEditModeInited),o(6),bo("matTooltip","",c(20,89,"widget.undo")," (CTRL + Q)"),s("disabled",c(21,91,t.isLoading$)||t.undoDisabled()),o(7),s("ngIf",!t.isReadOnly),o(),bo("matTooltip","",c(28,93,"widget.saveAs")," (Shift + CTRL + S)"),s("disabled",c(29,95,t.isLoading$)||t.saveAsDisabled())("tb-circular-progress",t.saveWidgetAsPending),o(7),bo("matTooltip","",c(35,97,"widget.toggle-fullscreen")," (Shift + CTRL + F)"),o(3),O(t.fullscreen?"fullscreen_exit":"fullscreen"),o(3),bo("matTooltip","",c(41,99,"widget.toggle-fullscreen")," (Shift + CTRL + F)"),o(3),O(t.fullscreen?"fullscreen_exit":"fullscreen"),o(),s("matMenuTriggerFor",u),o(5),s("disabled",!t.iframeWidgetEditModeInited),o(5),s("disabled",c(55,101,t.isLoading$)||t.undoDisabled()),o(6),s("ngIf",!t.isReadOnly),o(),s("disabled",c(62,103,t.isLoading$)||t.saveAsDisabled()),o(13),T("label",c(75,105,"widget.resources")),o(4),s("ngForOf",t.widget.resources),o(),T("matTooltip",c(80,107,"widget.add-resource")),s("disabled",c(81,109,t.isLoading$)),o(5),T("label",c(85,111,"widget.html")),o(2),s("fullscreen",t.htmlFullscreen),o(3),h(" ",c(90,113,"widget.tidy")," "),o(2),T("matTooltip",c(92,115,t.htmlFullscreen?"fullscreen.exit":"fullscreen.expand")),o(3),O(t.htmlFullscreen?"fullscreen_exit":"fullscreen"),o(3),T("label",c(98,117,"widget.css")),o(2),s("fullscreen",t.cssFullscreen),o(3),h(" ",c(103,119,"widget.tidy")," "),o(2),T("matTooltip",c(105,121,t.cssFullscreen?"fullscreen.exit":"fullscreen.expand")),o(3),O(t.cssFullscreen?"fullscreen_exit":"fullscreen"),o(6),T("label",c(114,123,"widget.settings-form")),o(3),s("exportFileName",(t.widget.widgetName||"widget")+"-settings-form"),Xe("ngModel",t.widget.settingsForm),o(),T("label",c(118,125,"widget.data-key-settings-form")),o(3),s("exportFileName",(t.widget.widgetName||"widget")+"-data-key-settings-form"),Xe("ngModel",t.widget.dataKeySettingsForm),o(),T("label",c(122,127,"widget.latest-data-key-settings-form")),s("aria-labelledby",t.widget.type!==t.widgetTypes.timeseries?"hidden":""),o(3),s("exportFileName",(t.widget.widgetName||"widget")+"-latest-data-key-settings-form"),Xe("ngModel",t.widget.latestDataKeySettingsForm),o(),T("label",c(126,129,"widget.widget-settings")),o(4),T("label",c(130,131,"widget.image-preview")),Xe("ngModel",t.widget.image),o(5),Xe("ngModel",t.widget.description),o(3),h("",(y.value==null?null:y.value.length)||0,"/1024"),o(),T("label",c(139,133,"widget.tags")),Xe("ngModel",t.widget.tags),o(3),Xe("ngModel",t.widget.scada),o(),h(" ",c(143,135,"widget.scada")," "),o(2),Xe("ngModel",t.widget.deprecated),o(),h(" ",c(146,137,"widget.deprecated")," "),o(5),Xe("ngModel",t.widget.settingsDirective),o(4),Xe("ngModel",t.widget.dataKeySettingsDirective),o(),s("ngIf",t.widget.type===t.widgetTypes.timeseries),o(),Xe("ngModel",t.widget.hasBasicMode),o(),h(" ",c(158,139,"widget.has-basic-mode")," "),o(2),s("ngIf",t.widget.hasBasicMode),o(5),s("fullscreen",t.javascriptFullscreen),o(4),T("matTooltip",c(170,141,"js-func.modules")),o(6),h(" ",c(175,143,"widget.tidy")," "),o(2),s("tb-help-popup-style",Et(149,$1)),o(),T("matTooltip",c(178,145,t.javascriptFullscreen?"fullscreen.exit":"fullscreen.expand")),o(3),O(t.javascriptFullscreen?"fullscreen_exit":"fullscreen"),o(5),s("ngIf",!t.iframeWidgetEditModeInited),o(),s("fullscreen",t.iFrameFullscreen),o(4),T("matTooltip",c(191,147,t.iFrameFullscreen?"fullscreen.exit":"fullscreen.expand")),o(3),O(t.iFrameFullscreen?"fullscreen_exit":"fullscreen")}},dependencies:[Te,G,wi,Ru,p0,N0,Bu,A0,cn,ee,Ee,$t,ae,he,me,Ce,Kt,at,zr,Hr,$r,vt,gt,Pt,to,St,aa,ht,ge,W,ue,pn,Ye,J,P0,hi,fs,Ts,le,R],styles:[`@charset "UTF-8";tb-widget-editor{flex:1;display:flex;flex-direction:column}.tb-editor .tb-split{box-sizing:border-box;overflow-x:hidden;overflow-y:auto}.tb-editor .resource-field mat-form-field .mat-mdc-text-field-wrapper{padding-bottom:0;height:40px}.tb-editor .resource-field mat-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex{max-height:40px}.tb-editor .resource-field mat-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix{border:0;padding-top:7px;padding-bottom:7px;min-height:32px}.tb-editor .ace_editor{font-size:14px!important}.tb-editor .tb-content{border:1px solid #c0c0c0}.tb-editor .gutter{background-color:transparent;background-repeat:no-repeat;background-position:50%}.tb-editor .gutter.gutter-horizontal{cursor:col-resize;background-image:url("./vertical-6GFVMCUE.png")}.tb-editor .gutter.gutter-vertical{cursor:row-resize;background-image:url("./horizontal-2FDVWMXP.png")}.tb-editor .tb-split.tb-split-horizontal,.tb-editor .gutter.gutter-horizontal{float:left;height:100%}.tb-editor .tb-split.tb-split-vertical{display:flex}.tb-editor .tb-split.tb-split-vertical .tb-split.tb-content{height:100%}.tb-editor .container{width:100%;height:100%}.tb-editor .mdc-tab[aria-labelledby=hidden]{width:0!important;min-width:0;padding:0;overflow:hidden}.tb-split-vertical .mat-mdc-tab-group .mat-mdc-tab-body-wrapper{height:calc(100% - 49px)}.tb-split-vertical .mat-mdc-tab-group .mat-mdc-tab-body-wrapper .mat-mdc-tab-body{height:100%}.tb-split-vertical .mat-mdc-tab-group .mat-mdc-tab-body-wrapper .mat-mdc-tab-body>div{height:100%}div.tb-editor-area-title-panel{position:absolute;top:5px;right:20px;z-index:5;font-size:.8rem;font-weight:500}div.tb-editor-area-title-panel>*:not(:last-child){margin-right:4px}div.tb-editor-area-title-panel label{padding:4px;color:#00acc1;background:#dcdcdc59;border-radius:5px}div.tb-editor-area-title-panel button.mat-mdc-button-base,div.tb-editor-area-title-panel button.mat-mdc-button-base.tb-mat-32{align-items:center;vertical-align:middle;min-width:32px;min-height:15px;padding:4px;font-size:.8rem;line-height:15px;background:#dcdcdc59}div.tb-editor-area-title-panel button.mat-mdc-button-base:not(.tb-help-popup-button),div.tb-editor-area-title-panel button.mat-mdc-button-base.tb-mat-32:not(.tb-help-popup-button){color:#7b7b7b}div.tb-editor-area-title-panel button.mat-mdc-button-base:not(.mat-mdc-icon-button){height:23px}div.tb-editor-area-title-panel .tb-help-popup-button-loading{background:#f3f3f3}.tb-resize-container{position:relative;width:100%;height:100%;overflow-y:auto}.tb-resize-container .ace_editor{height:100%}mat-toolbar.tb-edit-toolbar{min-height:40px!important;max-height:40px!important}mat-toolbar.tb-edit-toolbar button.mat-mdc-button-base:not(.mat-mdc-icon-button){font-size:12px;line-height:28px;padding:0 8px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:28px}mat-toolbar.tb-edit-toolbar button.mat-mdc-button-base:not(.mat-mdc-icon-button) .mat-icon{height:20px;width:20px;font-size:20px}mat-toolbar.tb-edit-toolbar .mat-mdc-form-field input,mat-toolbar.tb-edit-toolbar .mat-mdc-form-field .mat-mdc-select{font-size:1.1rem;font-weight:400;letter-spacing:.005em}mat-toolbar.tb-edit-toolbar .mat-mdc-form-field.tb-widget-title{min-width:250px}@media screen and (max-width: 1279px){mat-toolbar.tb-edit-toolbar .mat-mdc-form-field.tb-widget-title{min-width:0}}
`],encapsulation:2})}}return i})();C();C();function tv(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"widget.title-required")," "))}function iv(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"widget.title-max-length")," "))}var tl=(()=>{class i extends Bt{constructor(e,n,t,l,u){super(e,l,n,t,u),this.store=e,this.entityValue=n,this.entitiesTableConfigValue=t,this.fb=l,this.cd=u}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){return this.fb.group({name:[e?e.name:"",[S.required,S.maxLength(255)]],image:[e?e.image:""],description:[e?e.description:"",S.maxLength(1024)],tags:[e?e.tags:[]],scada:[e?e.scada:!1],deprecated:[e?e.deprecated:!1]})}updateForm(e){this.entityForm.patchValue({name:e.name,image:e.image,description:e.description,tags:e.tags,scada:e.scada,deprecated:e.deprecated})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g("entity"),g("entitiesTableConfig"),g(de),g(Qe))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-widget-type"]],features:[L],decls:45,vars:51,consts:[["descriptionInput",""],[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","image",1,"flex-1",3,"label"],["matInput","","formControlName","description","rows","2","maxlength","1024"],["align","end"],["formControlName","tags",3,"label"],[1,"flex","flex-col","gap-4"],["formControlName","scada"],["formControlName","deprecated"]],template:function(n,t){if(n&1){let l=j();r(0,"div",1)(1,"button",2),d(2,"async"),_("click",function(y){return I(l),M(t.onEntityAction(y,"edit"))}),p(3),d(4,"translate"),a(),r(5,"button",2),d(6,"async"),_("click",function(y){return I(l),M(t.onEntityAction(y,"openDetails"))}),p(7),d(8,"translate"),a(),r(9,"button",2),d(10,"async"),_("click",function(y){return I(l),M(t.onEntityAction(y,"export"))}),p(11),d(12,"translate"),a(),r(13,"button",2),d(14,"async"),_("click",function(y){return I(l),M(t.onEntityAction(y,"delete"))}),p(15),d(16,"translate"),a()(),r(17,"div",3)(18,"form",4)(19,"fieldset",5),d(20,"async"),r(21,"mat-form-field",6)(22,"mat-label",7),p(23,"widget.title"),a(),f(24,"input",8),b(25,tv,3,3,"mat-error",9)(26,iv,3,3,"mat-error",9),a(),f(27,"tb-gallery-image-input",10),d(28,"translate"),r(29,"mat-form-field",6)(30,"mat-label",7),p(31,"widget.description"),a(),f(32,"textarea",11,0),r(34,"mat-hint",12),p(35),a()(),f(36,"tb-string-items-list",13),d(37,"translate"),r(38,"div",14)(39,"mat-slide-toggle",15),p(40),d(41,"translate"),a(),r(42,"mat-slide-toggle",16),p(43),d(44,"translate"),a()()()()()}if(n&2){let l=U(33);o(),V("!hidden",t.isEdit),s("disabled",c(2,25,t.isLoading$)),o(2),h(" ",c(4,27,"widget.edit")," "),o(2),V("!hidden",t.isEdit||t.isDetailsPage),s("disabled",c(6,29,t.isLoading$)),o(2),h(" ",c(8,31,"common.open-details-page")," "),o(2),V("!hidden",t.isEdit),s("disabled",c(10,33,t.isLoading$)),o(2),h(" ",c(12,35,"widget.export")," "),o(2),V("!hidden",t.hideDelete()||t.isEdit),s("disabled",c(14,37,t.isLoading$)),o(2),h(" ",c(16,39,"widget.delete-widget")," "),o(3),s("formGroup",t.entityForm),o(),s("disabled",c(20,41,t.isLoading$)||!t.isEdit),o(6),s("ngIf",t.entityForm.get("name").hasError("required")),o(),s("ngIf",t.entityForm.get("name").hasError("maxlength")),o(),T("label",c(28,43,"widget.image-preview")),o(8),h("",(l.value==null?null:l.value.length)||0,"/1024"),o(),T("label",c(37,45,"widget.tags")),o(4),h(" ",c(41,47,"widget.scada")," "),o(3),h(" ",c(44,49,"widget.deprecated")," ")}},dependencies:[G,cn,ee,he,me,Ce,Kt,Pe,ht,ce,ge,W,K,ue,pn,ie,se,J,fs,le,R],encapsulation:2})}}return i})();C();function nv(i,m){if(i&1){let e=j();r(0,"mat-tab",2,0),d(2,"translate"),r(3,"tb-version-control",3),_("versionRestored",function(){I(e);let t=v();return M(t.entitiesTableConfig.updateData())}),a()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),s("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var il=(()=>{class i extends Lt{constructor(e){super(e),this.store=e}isTenantWidgetType(){return this.entity&&this.entity.tenantId.id!==Ae}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-widget-type-tabs"]],features:[L],decls:1,vars:1,consts:[["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,nv,4,7,"mat-tab",1),n&2&&s("ngIf",t.isTenantWidgetType()&&t.authUser.authority===t.authorities.TENANT_ADMIN)},dependencies:[G,St,ai,R],encapsulation:2})}}return i})();C();function ov(i,m){i&1&&f(0,"mat-progress-bar",15)}function av(i,m){i&1&&f(0,"div",16)}function rv(i,m){if(i&1){let e=j();r(0,"button",17),_("click",function(){let t=I(e).$implicit,l=v();return M(l.typeSelected(l.widgetTypes[t]))}),r(1,"tb-icon",18),p(2),a(),r(3,"span",2),p(4),a()()}if(i&2){let e=m.$implicit,n=v();o(2),h(" ",n.widgetTypesDataMap.get(n.widgetTypes[e]).icon," "),o(2),O(n.widgetTypesDataMap.get(n.widgetTypes[e]).name)}}var Na=(()=>{class i extends nt{constructor(e,n,t){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.widgetTypes=Si,this.allWidgetTypes=Object.keys(Si),this.widgetTypesDataMap=Zo}cancel(){this.dialogRef.close(null)}typeSelected(e){this.dialogRef.close(e)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(it))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-select-widget-type-dialog"]],features:[L],decls:23,vars:16,consts:[[2,"width","800px"],["color","primary"],["translate",""],[1,"flex-1"],["tb-help","widgetTypes"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[3,"disabled"],[1,"flex","flex-col","items-center","justify-center","gap-4","gt-sm:flex-row"],["class","tb-card-button","mat-raised-button","","color","primary","type","button",3,"click",4,"ngFor","ngForOf"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],["mat-raised-button","","color","primary","type","button",1,"tb-card-button",3,"click"],["matButtonIcon","",1,"tb-mat-96"]],template:function(n,t){n&1&&(r(0,"form",0)(1,"mat-toolbar",1)(2,"h2",2),p(3,"widget.select-widget-type"),a(),f(4,"span",3)(5,"div",4),r(6,"button",5),_("click",function(){return t.cancel()}),r(7,"mat-icon",6),p(8,"close"),a()()(),b(9,ov,1,0,"mat-progress-bar",7),d(10,"async"),b(11,av,1,0,"div",8),d(12,"async"),r(13,"div",9)(14,"fieldset",10),d(15,"async"),r(16,"div",11),b(17,rv,5,2,"button",12),a()()(),r(18,"div",13)(19,"button",14),d(20,"async"),_("click",function(){return t.cancel()}),p(21),d(22,"translate"),a()()()),n&2&&(o(9),s("ngIf",c(10,6,t.isLoading$)),o(2),s("ngIf",!c(12,8,t.isLoading$)),o(3),s("disabled",c(15,10,t.isLoading$)),o(3),s("ngForOf",t.allWidgetTypes),o(2),s("disabled",c(20,12,t.isLoading$)),o(2),h(" ",c(22,14,"action.cancel")," "))},dependencies:[Te,G,wt,ee,Ee,ae,qe,at,Rt,mt,ce,K,En,J,hi,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button{width:100%;height:100%;max-width:240px;display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button .mat-icon{margin:auto}[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button span.mdc-button__label{height:18px;min-height:18px;max-height:18px;margin:0 0 20px;font-size:18px;font-weight:400;line-height:18px;white-space:normal}[_nghost-%COMP%]     .mat-mdc-button-base.tb-card-button.mat-mdc-raised-button.mat-primary .mat-ripple-element{opacity:.3;background-color:#ffffff4d}']})}}return i})();var nl=(()=>{class i{constructor(e,n,t,l,u,y,w){this.store=e,this.dialog=n,this.widgetsService=t,this.translate=l,this.importExport=u,this.datePipe=y,this.router=w,this.config=new Ge,this.config.entityType=k.WIDGETS_BUNDLE,this.config.entityComponent=tl,this.config.entityTabsComponent=il,this.config.entityTranslations=Ue.get(k.WIDGET_TYPE),this.config.entityResources=tt.get(k.WIDGET_TYPE),this.config.defaultSortOrder={property:"name",direction:Zt.ASC},this.config.rowPointer=!0,this.config.entityTitle=x=>x?x.name:"",this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("name","widget.title","60%"),new no("bundles","entity.type-widgets-bundles","40%",()=>"/resources/widgets-library/widgets-bundles"),new Y("widgetType","widget.type","150px",x=>x?.widgetType?this.translate.instant(Zo.get(x.widgetType).name):"",void 0,!1),new Y("tenantId","widget.system","60px",x=>Ft(x.tenantId.id===Ae)),new Y("deprecated","widget.deprecated","60px",x=>Ft(x.deprecated))),this.config.addActionDescriptors.push({name:this.translate.instant("dashboard.create-new-widget"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:x=>this.addWidgetType(x)},{name:this.translate.instant("widget.import"),icon:"file_upload",isEnabled:()=>!0,onAction:x=>this.importWidgetType(x)}),this.config.cellActionDescriptors.push({name:this.translate.instant("widget.export"),icon:"file_download",isEnabled:()=>!0,onAction:(x,q)=>this.exportWidgetType(x,q)},{name:this.translate.instant("widget.widget-details"),icon:"edit",isEnabled:()=>!0,onAction:(x,q)=>this.config.toggleEntityDetails(x,q)}),this.config.groupActionDescriptors.push({name:this.translate.instant("widget.export-widgets"),icon:"file_download",isEnabled:!0,onAction:(x,q)=>this.exportWidgetTypes(x,q)}),this.config.deleteEntityTitle=x=>this.translate.instant("widget.delete-widget-title",{widgetName:x.name}),this.config.deleteEntityContent=()=>this.translate.instant("widget.delete-widget-text"),this.config.deleteEntitiesTitle=x=>this.translate.instant("widget.delete-widgets-title",{count:x}),this.config.deleteEntitiesContent=()=>this.translate.instant("widget.delete-widgets-text"),this.config.loadEntity=x=>this.widgetsService.getWidgetTypeById(x.id),this.config.saveEntity=x=>this.widgetsService.saveWidgetType(x),this.config.deleteEntity=x=>this.widgetsService.deleteWidgetType(x.id),this.config.onEntityAction=x=>this.onWidgetTypeAction(x,this.config),this.config.handleRowClick=(x,q)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(x,q):this.openWidgetEditor(x,q),!0)}resolve(){this.config.tableTitle=this.translate.instant("widget.widgets");let e=kt(this.store);return this.config.deleteEnabled=n=>this.isWidgetTypeEditable(n,e.authority),this.config.entitySelectionEnabled=n=>this.isWidgetTypeEditable(n,e.authority),this.config.detailsReadonly=n=>!this.isWidgetTypeEditable(n,e.authority),this.config.entitiesFetchFunction=n=>this.widgetsService.getWidgetTypes(n),this.config}isWidgetTypeEditable(e,n){return n===E.TENANT_ADMIN?e&&e.tenantId&&e.tenantId.id!==Ae:n===E.SYS_ADMIN}addWidgetType(e){e&&e.stopPropagation(),this.dialog.open(Na,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(n=>{n&&this.router.navigateByUrl(`resources/widgets-library/widget-types/${n}`)})}importWidgetType(e){this.importExport.importWidgetType().subscribe(n=>{n&&this.config.updateData()})}openWidgetEditor(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`resources/widgets-library/widget-types/${n.id.id}`)}openWidgetTypeDetails(e,n,t){e&&e.stopPropagation();let l=this.router.createUrlTree(["details",n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(l)}exportWidgetType(e,n){e&&e.stopPropagation(),this.importExport.exportWidgetType(n.id.id)}exportWidgetTypes(e,n){e&&e.stopPropagation(),this.importExport.exportWidgetTypes(n.map(t=>t.id.id)).subscribe(()=>{this.config.getTable().clearSelection()})}onWidgetTypeAction(e,n){switch(e.action){case"edit":return this.openWidgetEditor(e.event,e.entity),!0;case"openDetails":return this.openWidgetTypeDetails(e.event,e.entity,n),!0;case"export":return this.exportWidgetType(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(D(F),D(je),D(si),D(Z),D(Fi),D(ke),D(pe))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();C();var lv=["widgetTypeInput"],pv=[[["","tb-error",""]],[["","tb-hint",""]]],mv=["[tb-error]","[tb-hint]"],dv=()=>({preview:!0,emptyUrl:"/assets/widget-preview-empty.svg"}),cv=i=>({entity:i});function uv(i,m){if(i&1&&(r(0,"mat-label"),p(1),a()),i&2){let e=v();o(),O(e.label)}}function fv(i,m){if(i&1){let e=j();r(0,"button",10),_("click",function(){I(e);let t=v();return M(t.clear())}),r(1,"mat-icon",11),p(2,"close"),a()()}}function gv(i,m){i&1&&(r(0,"div",18),p(1),d(2,"translate"),a()),i&2&&(o(),O(c(2,1,"widget.deprecated")))}function hv(i,m){if(i&1&&(r(0,"mat-option",12)(1,"div",13),f(2,"img",14),d(3,"image"),d(4,"async"),r(5,"div",15),f(6,"div",16),d(7,"highlight"),b(8,gv,3,3,"div",17),a()()()),i&2){let e=m.$implicit,n=v();s("value",e),o(2),T("alt",e.name),s("src",c(4,8,Yt(3,5,e.image,Et(14,dv))),$n),o(4),s("innerHTML",bc(7,10,e.name,n.searchText,!0),zn),o(2),s("ngIf",e.deprecated)}}function bv(i,m){i&1&&(r(0,"div")(1,"span"),p(2),d(3,"translate"),a()()),i&2&&(o(2),O(c(3,1,"widget.no-widgets-text")))}function vv(i,m){if(i&1&&(r(0,"span"),p(1),d(2,"async"),a()),i&2){let e=v(2);o(),h(" ",c(2,1,e.translate.get("widget.no-widgets-matching",pt(3,cv,e.searchText)))," ")}}function yv(i,m){if(i&1){let e=j();r(0,"mat-option",12)(1,"div",19),_("click",function(t){return I(e),M(t.stopPropagation())}),b(2,bv,4,3,"div",20)(3,vv,3,5,"ng-template",null,2,It),a()()}if(i&2){let e=U(4),n=v();s("value",null),o(2),s("ngIf",!n.textIsNotEmpty(n.searchText))("ngIfElse",e)}}var Io=class i{constructor(m,e,n){this.translate=m,this.widgetService=e,this.fb=n,this.dirty=!1,this.label=this.translate.instant("widget.widget"),this.floatLabel="auto",this.appearance="fill",this.subscriptSizing="fixed",this.searchText="",this.propagateChange=t=>{},this.selectWidgetTypeFormGroup=this.fb.group({widgetType:[null]})}registerOnChange(m){this.propagateChange=m}registerOnTouched(m){}ngOnInit(){this.filteredWidgetTypes=this.selectWidgetTypeFormGroup.get("widgetType").valueChanges.pipe(mc(150),xt(m=>{let e;typeof m=="string"||!m?e=null:e=m,this.updateView(e)}),ze(m=>m?typeof m=="string"?m:m.name:""),yr(),tn(m=>this.fetchWidgetTypes(m)),cc())}ngAfterViewInit(){}setDisabledState(m){this.disabled=m,this.disabled?this.selectWidgetTypeFormGroup.disable({emitEvent:!1}):this.selectWidgetTypeFormGroup.enable({emitEvent:!1})}writeValue(m){this.searchText="",m!=null?typeof m=="string"?this.widgetService.getWidgetTypeInfoById(m).subscribe(e=>{this.modelValue=e,this.selectWidgetTypeFormGroup.get("widgetType").patchValue(e,{emitEvent:!1})}):(this.modelValue=m,this.selectWidgetTypeFormGroup.get("widgetType").patchValue(m,{emitEvent:!1})):(this.modelValue=null,this.selectWidgetTypeFormGroup.get("widgetType").patchValue("",{emitEvent:!1})),this.dirty=!0}updateView(m){this.modelValue!==m&&(this.modelValue=m,this.propagateChange(this.modelValue))}displayWidgetTypeFn(m){return m?m.name:void 0}fetchWidgetTypes(m){this.searchText=m;let e=new Vu(10,0,m,{property:"name",direction:Zt.ASC});return this.getWidgetTypes(e)}getWidgetTypes(m,e=[]){return this.widgetService.getWidgetTypes(m,!0).pipe(Qi(()=>ut(la())),tn(n=>{if(this.excludeWidgetTypeIds?.length){let t=n.data.filter(l=>!this.excludeWidgetTypeIds.includes(l.id.id));e=e.concat(t)}else e=n.data;return e.length>=m.pageSize||!this.excludeWidgetTypeIds?.length||!n.hasNext?ut(e):this.getWidgetTypes(m.nextPageLink(),e)}))}onFocus(){this.dirty&&(this.selectWidgetTypeFormGroup.get("widgetType").updateValueAndValidity({onlySelf:!0}),this.dirty=!1)}clear(){this.selectWidgetTypeFormGroup.get("widgetType").patchValue(""),setTimeout(()=>{this.widgetTypeInput.nativeElement.blur(),this.widgetTypeInput.nativeElement.focus()},0)}textIsNotEmpty(m){return m&&m.length>0}static{this.\u0275fac=function(e){return new(e||i)(g(Z),g(si),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-widget-type-autocomplete"]],viewQuery:function(e,n){if(e&1&&Ie(lv,7),e&2){let t;Me(t=we())&&(n.widgetTypeInput=t.first)}},inputs:{label:"label",placeholder:"placeholder",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",required:"required",disabled:"disabled",excludeWidgetTypeIds:"excludeWidgetTypeIds"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0}])],ngContentSelectors:mv,decls:15,vars:16,consts:[["widgetTypeInput",""],["widgetTypeAutocomplete",""],["searchNotEmpty",""],[1,"mat-block",3,"formGroup","floatLabel","appearance","subscriptSizing"],[4,"ngIf"],["matInput","","type","text","formControlName","widgetType",3,"focusin","placeholder","required","matAutocomplete"],["type","button","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click",4,"ngIf"],[1,"tb-autocomplete","tb-widget-type-autocomplete",3,"displayWith"],[3,"value",4,"ngFor","ngForOf"],[3,"value",4,"ngIf"],["type","button","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"],[1,"material-icons"],[3,"value"],[1,"tb-widget-type-option-container"],[1,"tb-widget-type-option-image-preview",3,"src","alt"],[1,"tb-widget-type-option-details"],[1,"tb-widget-type-option-text",3,"innerHTML"],["class","tb-widget-type-option-deprecated",4,"ngIf"],[1,"tb-widget-type-option-deprecated"],[3,"click"],[4,"ngIf","ngIfElse"]],template:function(e,n){if(e&1){let t=j();Lo(pv),r(0,"mat-form-field",3),b(1,uv,2,1,"mat-label",4),r(2,"input",5,0),_("focusin",function(){return I(t),M(n.onFocus())}),a(),b(4,fv,3,0,"button",6),r(5,"mat-autocomplete",7,1),b(7,hv,9,15,"mat-option",8),d(8,"async"),b(9,yv,5,3,"mat-option",9),d(10,"async"),a(),r(11,"mat-error"),Jn(12),a(),r(13,"mat-hint"),Jn(14,1),a()()}if(e&2){let t,l=U(6);s("formGroup",n.selectWidgetTypeFormGroup)("floatLabel",n.floatLabel)("appearance",n.appearance)("subscriptSizing",n.subscriptSizing),o(),s("ngIf",n.label),o(),T("placeholder",n.placeholder),s("required",n.required)("matAutocomplete",l),o(2),s("ngIf",n.selectWidgetTypeFormGroup.get("widgetType").value&&!n.disabled),o(),s("displayWith",n.displayWidgetTypeFn),o(2),s("ngForOf",c(8,12,n.filteredWidgetTypes)),o(2),s("ngIf",!((t=c(10,14,n.filteredWidgetTypes))!=null&&t.length))}},dependencies:[Te,G,Ee,ae,he,me,Ce,Kt,Pe,zt,gt,du,cu,ge,W,K,ue,ie,se,le,Pu,cs,R],styles:[`@charset "UTF-8";.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text{width:100%}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-container{display:flex;gap:8px;align-items:center}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-image-preview{width:36px;max-height:100%;object-fit:contain;border-radius:6px}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-details{flex:1;display:flex;align-items:center;justify-content:space-between}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-details .tb-widget-type-option-text{font-size:14px;font-weight:400;letter-spacing:.2px}.tb-widget-type-autocomplete .mat-mdc-option .mdc-list-item__primary-text .tb-widget-type-option-details .tb-widget-type-option-deprecated{font-size:13px;font-weight:400;color:#0000008a}
`],encapsulation:2})}};Ro([ra(),Bo("design:type",Boolean)],Io.prototype,"required",void 0);var Cv=()=>({preview:!0,emptyUrl:"/assets/widget-preview-empty.svg"});function Sv(i,m){if(i&1&&(r(0,"button",19),d(1,"translate"),d(2,"async"),r(3,"mat-icon"),p(4,"add"),a()()),i&2){let e=v(),n=U(14);T("matTooltip",c(1,3,"widget.add-new-widget")),s("disabled",c(2,5,e.isLoading$))("matMenuTriggerFor",n)}}function Tv(i,m){i&1&&f(0,"mat-progress-bar",20)}function xv(i,m){i&1&&f(0,"div",21)}function Ev(i,m){i&1&&(r(0,"div",30),p(1),d(2,"translate"),a()),i&2&&(o(),O(c(2,1,"widget.deprecated")))}function Iv(i,m){if(i&1){let e=j();r(0,"button",3),d(1,"translate"),_("click",function(t){I(e);let l=v().$implicit,u=v();return M(u.openWidgetEditor(t,l))}),r(2,"mat-icon"),p(3,"edit"),a()()}i&2&&T("matTooltip",c(1,1,"widget.edit"))}function Mv(i,m){if(i&1){let e=j();r(0,"button",3),d(1,"translate"),_("click",function(t){I(e);let l=v().$implicit,u=v();return M(u.exportWidgetType(t,l))}),r(2,"mat-icon"),p(3,"file_download"),a()()}i&2&&T("matTooltip",c(1,1,"widget.export"))}function wv(i,m){if(i&1){let e=j();r(0,"button",3),d(1,"translate"),_("click",function(t){I(e);let l=v().$implicit,u=v();return M(u.removeWidgetType(t,l))}),r(2,"mat-icon"),p(3,"delete"),a()()}i&2&&T("matTooltip",c(1,1,"widget.remove"))}function Dv(i,m){if(i&1&&(r(0,"button",31),d(1,"translate"),r(2,"tb-icon"),p(3,"drag_indicator"),a()()),i&2){let e=v(2);V("!hidden",!e.widgets||e.widgets.length<=1),T("matTooltip",c(1,3,"action.drag"))}}function Pv(i,m){if(i&1&&(r(0,"div",22)(1,"div",23),f(2,"img",24),d(3,"image"),d(4,"async"),r(5,"div",25)(6,"div",26),p(7),a(),b(8,Ev,3,3,"div",27),a()(),b(9,Iv,4,3,"button",28)(10,Mv,4,3,"button",28)(11,wv,4,3,"button",28)(12,Dv,4,5,"button",29),a()),i&2){let e=m.$implicit,n=v();o(2),T("alt",e.name),s("src",c(4,11,Yt(3,8,e.image,Et(13,Cv))),$n),o(5),O(e.name),o(),s("ngIf",e.deprecated),o(),s("ngIf",!n.editMode),o(),s("ngIf",!n.editMode),o(),s("ngIf",n.editMode&&!n.addMode),o(),s("ngIf",n.editMode)}}function Fv(i,m){if(i&1){let e=j();r(0,"div",32),d(1,"translate"),_("click",function(){I(e);let t=v();return M(t.addWidgetMode())}),r(2,"tb-icon",33),p(3,"add"),a()()}i&2&&T("matTooltip",c(1,1,"widget.add-existing-widget"))}function Av(i,m){if(i&1){let e=j();r(0,"div",34)(1,"div",35),_("click",function(){I(e);let t=v();return M(t.addWidgetMode())}),r(2,"tb-icon",33),p(3,"add"),a(),r(4,"div",36),p(5,"widget.add-existing-widget"),a()()()}}function Nv(i,m){i&1&&(r(0,"div",37),f(1,"div",38),r(2,"div",39),p(3,"widget.no-widgets"),a()())}function kv(i,m){if(i&1){let e=j();r(0,"div",40),f(1,"tb-widget-type-autocomplete",41),d(2,"translate"),r(3,"div",42)(4,"button",43),d(5,"async"),_("click",function(){I(e);let t=v();return M(t.cancelAddWidgetMode())}),p(6),d(7,"translate"),a()()()}if(i&2){let e=v();o(),T("placeholder",c(2,5,"widget.select-widget")),s("excludeWidgetTypeIds",e.excludeWidgetTypeIds)("formControl",e.addWidgetFormControl),o(3),s("disabled",c(5,7,e.isLoading$)),o(2),h("",c(7,9,"action.cancel")," ")}}function Ov(i,m){if(i&1){let e=j();r(0,"button",43),d(1,"async"),_("click",function(){I(e);let t=v();return M(t.cancel())}),p(2),d(3,"translate"),a()}if(i&2){let e=v();s("disabled",c(1,2,e.isLoading$)),o(2),h("",c(3,4,"action.cancel")," ")}}function Rv(i,m){if(i&1){let e=j();r(0,"button",44),d(1,"async"),_("click",function(){I(e);let t=v();return M(t.save())}),p(2),d(3,"translate"),a()}if(i&2){let e=v();s("disabled",c(1,2,e.isLoading$)||!e.isDirty),o(2),h("",c(3,4,"action.save")," ")}}function Bv(i,m){if(i&1){let e=j();r(0,"button",44),d(1,"async"),_("click",function(){I(e);let t=v();return M(t.edit())}),p(2),d(3,"translate"),a()}if(i&2){let e=v();s("disabled",c(1,2,e.isLoading$)),o(2),h("",c(3,4,"action.edit")," ")}}var ol=(()=>{class i extends Mt{constructor(e,n,t,l,u,y,w){super(e),this.store=e,this.router=n,this.route=t,this.widgetsService=l,this.importExport=u,this.cd=y,this.dialog=w,this.editMode=!1,this.addMode=!1,this.isDirty=!1,this.addWidgetFormControl=new ia(null,[S.required]),this.authUser=kt(this.store),this.widgetsBundle=this.route.snapshot.data.widgetsBundle,this.widgets=[...this.route.snapshot.data.widgets],this.authUser.authority===E.TENANT_ADMIN?this.isReadOnly=!this.widgetsBundle||this.widgetsBundle.tenantId.id===Ae:this.isReadOnly=this.authUser.authority!==E.SYS_ADMIN,!this.isReadOnly&&!this.widgets.length&&(this.editMode=!0),this.addWidgetFormControl.valueChanges.pipe(Ne()).subscribe(x=>{x&&this.addWidget(x)})}ngOnInit(){}trackByWidget(e,n){return n}widgetDrop(e){let n=this.widgets[e.previousIndex];this.widgets.splice(e.previousIndex,1),this.widgets.splice(e.currentIndex,0,n),this.isDirty=!0}addWidgetMode(){this.addWidgetFormControl.patchValue(null,{emitEvent:!1}),this.excludeWidgetTypeIds=this.widgets.map(e=>e.id.id),this.addMode=!0}cancelAddWidgetMode(){this.addMode=!1}addWidget(e){this.widgets.push(e),this.isDirty=!0,this.addMode=!1}openWidgetEditor(e,n){e&&e.stopPropagation(),this.router.navigate([n.id.id],{relativeTo:this.route}).then(()=>{})}exportWidgetType(e,n){e&&e.stopPropagation(),this.importExport.exportWidgetType(n.id.id)}removeWidgetType(e,n){e&&e.stopPropagation();let t=this.widgets.indexOf(n);this.widgets.splice(t,1),this.isDirty=!0}goBack(){this.router.navigate([".."],{relativeTo:this.route})}exportWidgetsBundle(){this.importExport.exportWidgetsBundle(this.widgetsBundle.id.id)}edit(){this.editMode=!0}cancel(){this.isDirty?this.widgetsService.getBundleWidgetTypeInfosList(this.widgetsBundle.id.id).subscribe(e=>{this.widgets=[...e],this.isDirty=!1,this.addMode=!1,this.editMode=!this.widgets.length,this.cd.markForCheck()}):(this.addMode=!1,this.editMode=!this.widgets.length)}save(){let e=this.widgets.map(n=>n.id.id);this.widgetsService.updateWidgetsBundleWidgetTypes(this.widgetsBundle.id.id,e).subscribe(()=>{this.isDirty=!1,this.editMode=!1,this.addMode=!1})}addWidgetType(e){e&&e.stopPropagation(),this.dialog.open(Na,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(n=>{n&&this.router.navigate([n],{relativeTo:this.route}).then(()=>{})})}importWidgetType(){this.importExport.importWidgetType().subscribe(e=>{if(e){let n=this.widgets.some(t=>t.id.id===e.id.id);n&&(this.widgets=this.widgets.map(t=>t.id.id!==e.id.id?t:e)),this.editMode?(this.widgets.push(e),this.isDirty=!0,this.cd.markForCheck()):n||this.widgetsService.addWidgetFqnToWidgetBundle(this.widgetsBundle.id.id,e.fqn).subscribe(()=>{this.widgets.push(e),this.cd.markForCheck()})}})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(Vi),g(si),g(Fi),g(Qe),g(je))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-widgets-bundle-widget"]],features:[L],decls:46,vars:33,consts:[["addWidgetMenu","matMenu"],["appearance","outlined",1,"tb-bundle-widgets-card"],[1,"title-container"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],[1,"mat-headline-5"],[1,"flex-1"],["mat-icon-button","","matTooltipPosition","above",3,"disabled","matTooltip","matMenuTriggerFor",4,"ngIf"],["xPosition","before"],["mat-menu-item","",3,"click"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-drop-list","tb-bundle-widgets-container",3,"cdkDropListDropped","cdkDropListDisabled"],["cdkDrag","","class","tb-draggable tb-bundle-widget-row",4,"ngFor","ngForOf","ngForTrackBy"],["class","tb-add-widget-button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["class","tb-add-widget-button-panel",4,"ngIf"],["class","tb-no-data-available",4,"ngIf"],["class","tb-add-bundle-widget-form",4,"ngIf"],["mat-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"disabled","matTooltip","matMenuTriggerFor"],["color","warn","mode","indeterminate"],[2,"height","4px"],["cdkDrag","",1,"tb-draggable","tb-bundle-widget-row"],[1,"tb-bundle-widget-row-details"],[1,"tb-bundle-widget-image-preview",3,"src","alt"],[1,"tb-bundle-widget-details"],[1,"tb-bundle-widget-title"],["class","tb-bundle-widget-deprecated",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above","class","tb-drag-handle",3,"!hidden","matTooltip",4,"ngIf"],[1,"tb-bundle-widget-deprecated"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above",1,"tb-drag-handle",3,"matTooltip"],["matTooltipPosition","above",1,"tb-add-widget-button",3,"click","matTooltip"],["color","primary",1,"tb-add-widget-icon"],[1,"tb-add-widget-button-panel"],[1,"tb-add-widget-button-with-text",3,"click"],["translate","",1,"tb-add-widget-button-text"],[1,"tb-no-data-available"],[1,"tb-no-data-bg"],["translate","",1,"tb-no-data-text"],[1,"tb-add-bundle-widget-form"],["required","",3,"placeholder","excludeWidgetTypeIds","formControl"],[1,"tb-add-bundle-widget-actions"],["mat-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(n,t){if(n&1){let l=j();r(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title")(3,"div",2)(4,"button",3),d(5,"translate"),_("click",function(){return I(l),M(t.goBack())}),r(6,"mat-icon"),p(7,"arrow_back"),a()(),r(8,"span",4),p(9),d(10,"translate"),a(),f(11,"span",5),b(12,Sv,5,7,"button",6),r(13,"mat-menu",7,0)(15,"button",8),_("click",function(y){return I(l),M(t.addWidgetType(y))}),r(16,"mat-icon"),p(17,"insert_drive_file"),a(),r(18,"span"),p(19),d(20,"translate"),a()(),r(21,"button",8),_("click",function(){return I(l),M(t.importWidgetType())}),r(22,"mat-icon"),p(23,"file_upload"),a(),r(24,"span"),p(25),d(26,"translate"),a()()(),r(27,"button",3),d(28,"translate"),_("click",function(){return I(l),M(t.exportWidgetsBundle())}),r(29,"mat-icon"),p(30,"file_download"),a()()()()(),b(31,Tv,1,0,"mat-progress-bar",9),d(32,"async"),b(33,xv,1,0,"div",10),d(34,"async"),r(35,"mat-card-content")(36,"div",11),_("cdkDropListDropped",function(y){return I(l),M(t.widgetDrop(y))}),b(37,Pv,13,14,"div",12),a(),b(38,Fv,4,3,"div",13)(39,Av,6,0,"div",14)(40,Nv,4,0,"div",15)(41,kv,8,11,"div",16),a(),r(42,"mat-card-actions"),b(43,Ov,4,6,"button",17)(44,Rv,4,6,"button",18)(45,Bv,4,6,"button",18),a()()}n&2&&(o(4),T("matTooltip",c(5,19,"action.back")),o(5),za("",t.widgetsBundle.title,": ",c(10,21,"widget.widgets"),""),o(3),s("ngIf",!t.isReadOnly),o(7),O(c(20,23,"dashboard.create-new-widget")),o(6),O(c(26,25,"widget.import")),o(2),T("matTooltip",c(28,27,"widgets-bundle.export")),o(4),s("ngIf",c(32,29,t.isLoading$)),o(2),s("ngIf",c(34,31,t.isLoading$)===!1),o(3),s("cdkDropListDisabled",!t.editMode||(t.widgets==null?null:t.widgets.length)<2),o(),s("ngForOf",t.widgets)("ngForTrackBy",t.trackByWidget),o(),s("ngIf",t.editMode&&!t.addMode&&(t.widgets==null?null:t.widgets.length)),o(),s("ngIf",t.editMode&&!t.addMode&&!(t.widgets!=null&&t.widgets.length)),o(),s("ngIf",t.isReadOnly&&!(t.widgets!=null&&t.widgets.length)),o(),s("ngIf",t.addMode),o(2),s("ngIf",t.editMode&&((t.widgets==null?null:t.widgets.length)||t.isDirty)),o(),s("ngIf",t.editMode&&((t.widgets==null?null:t.widgets.length)||t.isDirty)),o(),s("ngIf",!t.isReadOnly&&!t.editMode))},dependencies:[Te,G,ee,Ee,ae,Xt,qr,ni,ci,di,qe,zr,Hr,$r,Pt,_a,ya,va,W,ue,ii,J,hi,Io,le,cs,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%;height:100%;padding:8px}[_nghost-%COMP%]     .tb-bundle-widgets-card .mat-mdc-card-header-text{flex:1}.tb-bundle-widgets-card[_ngcontent-%COMP%]{padding:0;width:100%;height:100%;display:flex;flex-direction:column}@media screen and (min-width: 960px) and (max-width: 1279px){.tb-bundle-widgets-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){.tb-bundle-widgets-card[_ngcontent-%COMP%]{width:60%}}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:8px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin:0}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{flex:1;padding:16px;min-height:0;overflow:hidden;display:flex;flex-direction:column;gap:8px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button[_ngcontent-%COMP%]{min-height:56px;cursor:pointer;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff;padding:8px;border:2px dashed rgba(0,0,0,.08);border-radius:10px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button-panel[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button-panel[_ngcontent-%COMP%]   .tb-add-widget-button-with-text[_ngcontent-%COMP%]{cursor:pointer;display:flex;padding:24px 40px 24px 24px;justify-content:center;align-items:center;gap:8px;border:2px dashed rgba(0,0,0,.12);border-radius:10px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-widget-button-panel[_ngcontent-%COMP%]   .tb-add-widget-button-with-text[_ngcontent-%COMP%]   .tb-add-widget-button-text[_ngcontent-%COMP%]{font-size:16px;font-style:normal;font-weight:500;line-height:24px;letter-spacing:.25px;color:#305680}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-bundle-widget-form[_ngcontent-%COMP%]{display:flex;padding:16px;flex-direction:column;gap:12px;border-radius:10px;border:1px solid rgba(0,0,0,.05);box-shadow:0 5px 16px #0000000a}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .tb-add-bundle-widget-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:flex-start;gap:16px}.tb-bundle-widgets-card[_ngcontent-%COMP%]   .mat-mdc-card-actions[_ngcontent-%COMP%]{justify-content:end;gap:8px}.tb-bundle-widgets-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;min-height:0;overflow:auto;padding-top:8px;padding-bottom:8px}.tb-bundle-widget-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;padding:6px 12px 6px 6px;background:#fff;gap:12px;border-radius:10px;border:1px solid rgba(0,0,0,.05);box-shadow:0 5px 16px #0000000a}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:row;align-items:center;gap:12px}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-image-preview[_ngcontent-%COMP%]{width:64px;max-height:52px;height:100%;object-fit:contain;border-radius:6px}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-details[_ngcontent-%COMP%]{padding:18px 0;flex:1;display:flex;flex-direction:row;align-items:center;justify-content:space-between}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-details[_ngcontent-%COMP%]   .tb-bundle-widget-title[_ngcontent-%COMP%]{font-size:14px;font-weight:400;letter-spacing:.2px;color:#000000c2}.tb-bundle-widget-row[_ngcontent-%COMP%]   .tb-bundle-widget-row-details[_ngcontent-%COMP%]   .tb-bundle-widget-details[_ngcontent-%COMP%]   .tb-bundle-widget-deprecated[_ngcontent-%COMP%]{font-size:13px;font-weight:400;color:#0000008a}.tb-bundle-widget-row[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{color:#0000008a}']})}}return i})();var Vv=i=>{let m=i.params.widgetsBundleId;return qt(si).getWidgetsBundle(m)},jv=i=>{let m=i.params.widgetsBundleId;return qt(si).getBundleWidgetTypeInfosList(m)},Lv=i=>{let m=i.params.widgetTypeId;if(!m||Object.keys(Si).includes(m)){let e=m;return e||(e=Si.timeseries),qt(si).getWidgetTemplate(e).pipe(ze(n=>(n.widgetName=null,{widgetTypeDetails:null,widget:n})))}else return qt(si).getWidgetTypeById(m).pipe(ze(e=>(e=Lr(e),{widgetTypeDetails:e,widget:Zr(e)})))},Gv=i=>i.data.widgetsBundle.title,Uv=(i,m,e)=>e?.widget?.widgetName?e.widget.widgetName+(e.widget.deprecated?` (${m.instant("widget.deprecated")})`:""):"",Xf=[{path:":widgetTypeId",component:el,canDeactivate:[xe],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"widget.editor",breadcrumb:{labelFunction:Uv,icon:"insert_chart"},hideTabs:!0},resolve:{widgetEditorData:Lv}}],qv=[{path:"widget-types",data:{breadcrumb:{menuId:be.widget_types}},children:[{path:"",component:Le,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"widget.widgets"},resolve:{entitiesTableConfig:nl}},{path:"details",children:[{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"now_widgets"},auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"widget.widgets",hideTabs:!0,backNavigationCommands:["../.."]},resolve:{entitiesTableConfig:nl}}]},...Xf]}],Wv=[{path:"widgets-bundles",data:{breadcrumb:{menuId:be.widgets_bundles}},children:[{path:"",component:Le,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"widgets-bundle.widgets-bundles"},resolve:{entitiesTableConfig:Xs}},{path:"details",children:[{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"now_widgets"},auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"widgets-bundle.widgets-bundles",hideTabs:!0,backNavigationCommands:["../.."]},resolve:{entitiesTableConfig:Xs}}]},{path:":widgetsBundleId",data:{breadcrumb:{labelFunction:Gv,icon:"now_widgets"}},resolve:{widgetsBundle:Vv},children:[{path:"",component:ol,canDeactivate:[xe],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"widgets-bundle.widgets-bundle-widgets",hideTabs:!0},resolve:{widgets:jv}},...Xf]}]}],Zf=[{path:"widgets-library",component:un,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],breadcrumb:{menuId:be.widget_library}},children:[{path:"",children:[],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],redirectTo:"/resources/widgets-library/widget-types"}},...qv,...Wv]}],Hv=[{path:"widgets-bundles",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles"},{path:"resources/widgets-bundles",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles"},{path:"widgets-bundles/:widgetsBundleId/widgetTypes",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles/:widgetsBundleId"},{path:"resources/widgets-bundles/:widgetsBundleId/widgetTypes",pathMatch:"full",redirectTo:"/resources/widgets-library/widgets-bundles/:widgetsBundleId"},{path:"widgets-bundles/:widgetsBundleId/widgetTypes/:widgetTypeId",pathMatch:"full",redirectTo:"/resources/widgets-library/widget-types/:widgetTypeId"},{path:"resources/widgets-bundles/:widgetsBundleId/widgetTypes/:widgetTypeId",pathMatch:"full",redirectTo:"/resources/widgets-library/widget-types/:widgetTypeId"},{path:"widgets-bundles/:widgetsBundleId/widgetTypes/add/:widgetType",redirectTo:"/resources/widgets-library/widget-types/:widgetType"},{path:"resources/widgets-bundles/:widgetsBundleId/widgetTypes/add/:widgetType",redirectTo:"/resources/widgets-library/widget-types/:widgetType"}],al=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[nl,Xs],imports:[B.forChild(Hv),B]})}}return i})();(function(){Q(al,{imports:[B],exports:[B]})})();C();var eg=[{path:"auditLogs",component:ri,data:{auth:[E.TENANT_ADMIN],title:"audit-log.audit-logs",breadcrumb:{menuId:be.audit_log},isPage:!0}}],zv=[{path:"auditLogs",redirectTo:"/security-settings/auditLogs"}],rl=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[B.forChild(zv),B]})}}return i})();(function(){Q(rl,{imports:[B],exports:[B]})})();C();C();C();var $v=()=>({standalone:!0});function Jv(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-title-required")," "))}function Qv(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-title-max-length")," "))}function Yv(i,m){if(i&1&&(r(0,"mat-option",17),p(1),a()),i&2){let e=m.$implicit;s("value",e),o(),h(" ",e," ")}}function Kv(i,m){if(i&1&&(r(0,"mat-option",17),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.platformTypeTranslations.get(e))," ")}}function Xv(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-id-required")," "))}function Zv(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-id-max-length")," "))}function ey(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-secret-required")," "))}function ty(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.client-secret-max-length")," "))}function iy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.access-token-uri-required")," "))}function ny(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.uri-pattern-error")," "))}function oy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.authorization-uri-required")," "))}function ay(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.uri-pattern-error")," "))}function ry(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.uri-pattern-error")," "))}function sy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.uri-pattern-error")," "))}function ly(i,m){if(i&1&&(r(0,"mat-option",17),p(1),d(2,"uppercase"),a()),i&2){let e=m.$implicit;s("value",e),o(),h(" ",c(2,2,e)," ")}}function py(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.login-button-label-required")," "))}function my(i,m){if(i&1&&(r(0,"div",6)(1,"mat-form-field",10)(2,"mat-label",3),p(3,"admin.oauth2.login-button-label"),a(),f(4,"input",35),d(5,"translate"),b(6,py,3,3,"mat-error",5),a(),r(7,"mat-form-field",2)(8,"mat-label",3),p(9,"admin.oauth2.login-button-icon"),a(),f(10,"input",36),a()()),i&2){let e=v(3);o(4),T("placeholder",c(5,2,"admin.oauth2.login-button-label-placeholder")),o(2),s("ngIf",e.entityForm.get("loginButtonLabel").hasError("required"))}}function dy(i,m){if(i&1&&(r(0,"section",23)(1,"div",6)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.access-token-uri"),a(),f(5,"input",24),b(6,iy,3,3,"mat-error",5)(7,ny,3,3,"mat-error",5),a(),r(8,"mat-form-field",2)(9,"mat-label",3),p(10,"admin.oauth2.authorization-uri"),a(),f(11,"input",25),b(12,oy,3,3,"mat-error",5)(13,ay,3,3,"mat-error",5),a()(),r(14,"div",6)(15,"mat-form-field",2)(16,"mat-label",3),p(17,"admin.oauth2.jwk-set-uri"),a(),f(18,"input",26),b(19,ry,3,3,"mat-error",5),a(),r(20,"mat-form-field",2)(21,"mat-label",3),p(22,"admin.oauth2.user-info-uri"),a(),f(23,"input",27),b(24,sy,3,3,"mat-error",5),a()(),r(25,"div",1)(26,"mat-form-field",2)(27,"mat-label",3),p(28,"admin.oauth2.client-authentication-method"),a(),r(29,"mat-select",28),b(30,ly,3,4,"mat-option",9),a()()(),b(31,my,11,4,"div",29),r(32,"section",30)(33,"div",31)(34,"mat-slide-toggle",32),p(35),d(36,"translate"),a()(),r(37,"div",31)(38,"mat-slide-toggle",33),p(39),d(40,"translate"),a()()(),f(41,"tb-string-items-list",34),d(42,"translate"),d(43,"translate"),a()),i&2){let e=v(2);o(6),s("ngIf",e.entityForm.get("accessTokenUri").hasError("required")),o(),s("ngIf",e.entityForm.get("accessTokenUri").hasError("pattern")),o(5),s("ngIf",e.entityForm.get("authorizationUri").hasError("required")),o(),s("ngIf",e.entityForm.get("authorizationUri").hasError("pattern")),o(6),s("ngIf",e.entityForm.get("jwkSetUri").hasError("pattern")),o(5),s("ngIf",e.entityForm.get("userInfoUri").hasError("pattern")),o(6),s("ngForOf",e.clientAuthenticationMethods),o(),s("ngIf",e.isCustomProvider()),o(4),h(" ",c(36,12,"admin.oauth2.allow-user-creation")," "),o(4),h(" ",c(40,14,"admin.oauth2.activate-user")," "),o(2),T("label",c(42,16,"admin.oauth2.scope")),T("requiredText",c(43,18,"admin.oauth2.scope-required"))}}function cy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.user-name-attribute-name-required")," "))}function uy(i,m){if(i&1&&(r(0,"mat-option",17),p(1),a()),i&2){let e=m.$implicit;s("value",e),o(),h(" ",e," ")}}function fy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.email-attribute-key-required")," "))}function gy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.email-attribute-key-max-length")," "))}function hy(i,m){if(i&1&&(r(0,"div",1)(1,"mat-form-field",2)(2,"mat-label",3),p(3,"admin.oauth2.email-attribute-key"),a(),f(4,"input",52),b(5,fy,3,3,"mat-error",5)(6,gy,3,3,"mat-error",5),a()()),i&2){let e=v(4);o(5),s("ngIf",e.entityForm.get("mapperConfig.basic.emailAttributeKey").hasError("required")),o(),s("ngIf",e.entityForm.get("mapperConfig.basic.emailAttributeKey").hasError("maxlength"))}}function by(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.first-name-attribute-key-max-length")," "))}function vy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.last-name-attribute-key-max-length")," "))}function yy(i,m){if(i&1&&(r(0,"mat-option",17),p(1),a()),i&2){let e=m.$implicit;s("value",e),o(),h(" ",e," ")}}function _y(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.tenant-name-pattern-required")," "))}function Cy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.tenant-name-pattern-max-length")," "))}function Sy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.customer-name-pattern-max-length")," "))}function Ty(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.default-dashboard-name-max-length")," "))}function xy(i,m){if(i&1&&(r(0,"section",43),b(1,hy,7,2,"div",44),r(2,"div",6)(3,"mat-form-field",2)(4,"mat-label",3),p(5,"admin.oauth2.first-name-attribute-key"),a(),f(6,"input",45),b(7,by,3,3,"mat-error",5),a(),r(8,"mat-form-field",2)(9,"mat-label",3),p(10,"admin.oauth2.last-name-attribute-key"),a(),f(11,"input",46),b(12,vy,3,3,"mat-error",5),a()(),r(13,"div",6)(14,"mat-form-field",2)(15,"mat-label",3),p(16,"admin.oauth2.tenant-name-strategy"),a(),r(17,"mat-select",47),b(18,yy,2,2,"mat-option",9),a()(),r(19,"mat-form-field",2)(20,"mat-label",3),p(21,"admin.oauth2.tenant-name-pattern"),a(),f(22,"input",48),b(23,_y,3,3,"mat-error",5)(24,Cy,3,3,"mat-error",5),a()(),r(25,"div",1)(26,"mat-form-field",2)(27,"mat-label",3),p(28,"admin.oauth2.customer-name-pattern"),a(),f(29,"input",49),b(30,Sy,3,3,"mat-error",5),a()(),r(31,"div",6)(32,"mat-form-field",2)(33,"mat-label",3),p(34,"admin.oauth2.default-dashboard-name"),a(),f(35,"input",50),b(36,Ty,3,3,"mat-error",5),a(),r(37,"mat-slide-toggle",51),p(38),d(39,"translate"),a()()()),i&2){let e=v(3);o(),s("ngIf",e.entityForm.get("mapperConfig.type").value!==e.mapperType.GITHUB),o(6),s("ngIf",e.entityForm.get("mapperConfig.basic.firstNameAttributeKey").hasError("maxlength")),o(5),s("ngIf",e.entityForm.get("mapperConfig.basic.lastNameAttributeKey").hasError("maxlength")),o(6),s("ngForOf",e.tenantNameStrategies),o(),V("!hidden",e.entityForm.get("mapperConfig.basic.tenantNameStrategy").value!=="CUSTOM"),o(3),s("required",e.entityForm.get("mapperConfig.basic.tenantNameStrategy").value==="CUSTOM"),o(),s("ngIf",e.entityForm.get("mapperConfig.basic.tenantNamePattern").hasError("required")),o(),s("ngIf",e.entityForm.get("mapperConfig.basic.tenantNamePattern").hasError("maxlength")),o(6),s("ngIf",e.entityForm.get("mapperConfig.basic.customerNamePattern").hasError("maxlength")),o(6),s("ngIf",e.entityForm.get("mapperConfig.basic.defaultDashboardName").hasError("maxlength")),o(2),h(" ",c(39,12,"admin.oauth2.always-fullscreen")," ")}}function Ey(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.url-required")," "))}function Iy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.url-pattern")," "))}function My(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.url-max-length")," "))}function wy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.username-max-length")," "))}function Dy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.password-max-length")," "))}function Py(i,m){if(i&1&&(r(0,"section",53)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.url"),a(),f(5,"input",54),b(6,Ey,3,3,"mat-error",5)(7,Iy,3,3,"mat-error",5)(8,My,3,3,"mat-error",5),a()(),r(9,"div",6)(10,"mat-form-field",2)(11,"mat-label",3),p(12,"common.username"),a(),f(13,"input",55),b(14,wy,3,3,"mat-error",5),a(),r(15,"mat-form-field",2)(16,"mat-label",3),p(17,"common.password"),a(),f(18,"input",56),b(19,Dy,3,3,"mat-error",5),a()(),r(20,"mat-slide-toggle",57),p(21),d(22,"translate"),a()()),i&2){let e=v(3);o(6),s("ngIf",e.entityForm.get("mapperConfig.custom.url").hasError("required")),o(),s("ngIf",e.entityForm.get("mapperConfig.custom.url").hasError("pattern")),o(),s("ngIf",e.entityForm.get("mapperConfig.custom.url").hasError("maxlength")),o(6),s("ngIf",e.entityForm.get("mapperConfig.custom.username").hasError("maxlength")),o(5),s("ngIf",e.entityForm.get("mapperConfig.custom.password").hasError("maxlength")),o(2),h(" ",c(22,6,"admin.oauth2.send-token")," ")}}function Fy(i,m){if(i&1&&(r(0,"section",37)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.user-name-attribute-name"),a(),f(5,"input",38),b(6,cy,3,3,"mat-error",5),a()(),r(7,"section",39)(8,"div",1)(9,"mat-form-field",2)(10,"mat-label",3),p(11,"admin.oauth2.type"),a(),r(12,"mat-select",40),b(13,uy,2,2,"mat-option",9),a()()(),b(14,xy,40,14,"section",41)(15,Py,23,8,"section",42),a()()),i&2){let e=v(2);o(6),s("ngIf",e.entityForm.get("userNameAttributeName").hasError("required")),o(7),s("ngForOf",e.mapperTypes),o(),s("ngIf",e.entityForm.get("mapperConfig.type").value!==e.mapperType.CUSTOM&&e.entityForm.get("mapperConfig.basic")),o(),s("ngIf",e.entityForm.get("mapperConfig.type").value===e.mapperType.CUSTOM&&e.entityForm.get("mapperConfig.custom"))}}function Ay(i,m){if(i&1){let e=j();r(0,"section",18)(1,"div",19),f(2,"span"),r(3,"tb-toggle-select",20),et("ngModelChange",function(t){I(e);let l=v();return Ze(l.generalSettingsMode,t)||(l.generalSettingsMode=t),M(t)}),r(4,"tb-toggle-option",17),p(5),d(6,"translate"),a(),r(7,"tb-toggle-option",17),p(8),d(9,"translate"),a()()(),b(10,dy,44,20,"section",21)(11,Fy,16,4,"section",22),a()}if(i&2){let e=v();o(3),Xe("ngModel",e.generalSettingsMode),s("ngModelOptions",Et(12,$v)),o(),s("value",!0),o(),O(c(6,8,"admin.oauth2.general")),o(2),s("value",!1),o(),O(c(9,10,"admin.oauth2.mapper")),o(2),s("ngIf",e.generalSettingsMode),o(),s("ngIf",!e.generalSettingsMode)}}var Un=class i extends Bt{constructor(m,e,n,t,l,u,y){super(m,y,t,l,u),this.store=m,this.translate=e,this.oauth2Service=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.cd=u,this.fb=y,this.createNewDialog=!1,this.templateProvider=["Custom"],this.templates=new Map,this.defaultProvider={additionalInfo:{providerName:"Custom"},clientAuthenticationMethod:wr.POST,userNameAttributeName:"email",mapperConfig:{allowUserCreation:!0,activateUser:!1,type:Yn.BASIC,basic:{emailAttributeKey:"email",tenantNameStrategy:Dr.DOMAIN,alwaysFullScreen:!1}}},this.URL_REGEXP=/^[A-Za-z][A-Za-z\d.+-]*:\/*(?:\w+(?::\w+)?@)?[^\s/]+(?::\d+)?(?:\/[\w#!:.,?+=&%@\-/]*)?$/,this.subscriptions=[],this.separatorKeysCodes=[13,188],this.clientAuthenticationMethods=Object.keys(wr),this.mapperType=Yn,this.mapperTypes=Object.keys(Yn),this.tenantNameStrategies=Object.keys(Dr),this.platformTypes=Object.values(ji),this.platformTypeTranslations=Kn,this.generalSettingsMode=!0,this.advancedExpanded=!1,this.oauth2Service.getOAuth2Template().subscribe(w=>{this.initTemplates(w)}),kt(this.store).authority===E.TENANT_ADMIN&&(this.platformTypes=this.platformTypes.filter(w=>w!==ji.WEB))}ngOnDestroy(){super.ngOnDestroy(),this.subscriptions.forEach(m=>{m.unsubscribe()})}buildForm(m){return this.fb.group({title:[m?.title?m.title:"",[S.required,S.maxLength(100)]],additionalInfo:this.fb.group({providerName:[m?.additionalInfo?.providerName?m?.additionalInfo?.providerName:"",S.required]}),platforms:[m?.platforms?m.platforms:[]],clientId:[m?.clientId?m.clientId:"",[S.required,S.maxLength(255)]],clientSecret:[m?.clientSecret?m.clientSecret:"",[S.required,S.maxLength(2048)]],accessTokenUri:[m?.accessTokenUri?m.accessTokenUri:"",[S.required,S.pattern(this.URL_REGEXP)]],authorizationUri:[m?.authorizationUri?m.authorizationUri:"",[S.required,S.pattern(this.URL_REGEXP)]],jwkSetUri:[m?.jwkSetUri?m.jwkSetUri:"",S.pattern(this.URL_REGEXP)],userInfoUri:[m?.userInfoUri?m.userInfoUri:"",[S.pattern(this.URL_REGEXP)]],clientAuthenticationMethod:[m?.clientAuthenticationMethod?m.clientAuthenticationMethod:wr.POST,S.required],loginButtonLabel:[m?.loginButtonLabel?m.loginButtonLabel:null,S.required],loginButtonIcon:[m?.loginButtonIcon?m.loginButtonIcon:null],userNameAttributeName:[m?.userNameAttributeName?m.userNameAttributeName:"email",S.required],scope:[m?.scope?m.scope:[],S.required],mapperConfig:this.fb.group({allowUserCreation:[Oe(m?.mapperConfig?.allowUserCreation)?m.mapperConfig.allowUserCreation:!0],activateUser:[Oe(m?.mapperConfig?.activateUser)?m.mapperConfig.activateUser:!1],type:[m?.mapperConfig?.type?m.mapperConfig.type:Yn.BASIC,S.required]})})}updateForm(m){this.entityForm.patchValue({title:m.title,additionalInfo:{providerName:m.additionalInfo.providerName},platforms:m.platforms,clientId:m.clientId,clientSecret:m.clientSecret,accessTokenUri:m.accessTokenUri,scope:m.scope,authorizationUri:m.authorizationUri,jwkSetUri:m.jwkSetUri,userInfoUri:m.userInfoUri,clientAuthenticationMethod:m.clientAuthenticationMethod,loginButtonLabel:m.loginButtonLabel,loginButtonIcon:m.loginButtonIcon,userNameAttributeName:m.userNameAttributeName,mapperConfig:{allowUserCreation:m.mapperConfig.allowUserCreation,activateUser:m.mapperConfig.activateUser,type:m.mapperConfig.type}},{emitEvent:!1}),this.changeMapperConfigType(this.entityForm,this.entityValue.mapperConfig.type,this.entityValue.mapperConfig)}getProviderName(){return this.entityForm.get("additionalInfo.providerName").value}isCustomProvider(){return this.getProviderName()==="Custom"}initTemplates(m){m.map(t=>{delete t.additionalInfo,this.templates.set(t.name,t)}),this.templateProvider.push(...Array.from(this.templates.keys())),this.templateProvider.sort();let e=null;Oe(this.entityValue?.additionalInfo)&&(e=this.entityValue.additionalInfo,this.templateProvider.indexOf(e.providerName)===-1&&(e.providerName="Custom"));let n="Custom";this.templateProvider.indexOf("Google")&&(n="Google"),this.entityForm.get("additionalInfo.providerName").setValue(e?.providerName?e?.providerName:n),this.changeMapperConfigType(this.entityForm,Yn.BASIC),(this.createNewDialog||this.isAdd)&&this.setProviderDefaultValue(n,this.entityForm),this.subscriptions.push(this.entityForm.get("mapperConfig.type").valueChanges.subscribe(t=>{this.changeMapperConfigType(this.entityForm,t)})),this.subscriptions.push(this.entityForm.get("additionalInfo.providerName").valueChanges.subscribe(t=>{this.entityForm.get("scope").setValue([]),this.setProviderDefaultValue(t,this.entityForm)}))}changeMapperConfigType(m,e,n){let t=m.get("mapperConfig");e===Yn.CUSTOM?(t.removeControl("basic"),t.get("custom")?t.get("custom").patchValue(n.custom,{emitEvent:!1}):t.addControl("custom",this.formCustomGroup(n?.custom))):(t.removeControl("custom"),t.get("basic")?n?.basic&&(t.get("basic").patchValue(n.basic,{emitEvent:!1}),t.get("basic.tenantNameStrategy").updateValueAndValidity({onlySelf:!0})):t.addControl("basic",this.formBasicGroup(n?.basic)),e===Yn.GITHUB?(t.get("basic.emailAttributeKey").disable(),t.get("basic.emailAttributeKey").patchValue(null,{emitEvent:!1})):(this.createNewDialog||this.isEdit||this.isAdd)&&t.get("basic.emailAttributeKey").enable())}formCustomGroup(m){let e=this.fb.group({url:[m?.url?m.url:null,[S.required,S.pattern(this.URL_REGEXP),S.maxLength(255)]],username:[m?.username?m.username:null,S.maxLength(255)],password:[m?.password?m.password:null,S.maxLength(255)],sendToken:[Oe(m?.sendToken)?m.sendToken:!1]});return!this.createNewDialog&&!(this.isEdit||this.isAdd)&&e.disable(),e}formBasicGroup(m){let e;m?.tenantNamePattern?e=m.tenantNamePattern:e={value:null,disabled:!0};let n=this.fb.group({emailAttributeKey:[m?.emailAttributeKey?m.emailAttributeKey:"email",[S.required,S.maxLength(31)]],firstNameAttributeKey:[m?.firstNameAttributeKey?m.firstNameAttributeKey:"",S.maxLength(31)],lastNameAttributeKey:[m?.lastNameAttributeKey?m.lastNameAttributeKey:"",S.maxLength(31)],tenantNameStrategy:[m?.tenantNameStrategy?m.tenantNameStrategy:Dr.DOMAIN],tenantNamePattern:[e,[S.required,S.maxLength(255)]],customerNamePattern:[m?.customerNamePattern?m.customerNamePattern:null,S.maxLength(255)],defaultDashboardName:[m?.defaultDashboardName?m.defaultDashboardName:null,S.maxLength(255)],alwaysFullScreen:[Oe(m?.alwaysFullScreen)?m.alwaysFullScreen:!1]});return!this.createNewDialog&&!(this.isEdit||this.isAdd)&&n.disable(),this.subscriptions.push(n.get("tenantNameStrategy").valueChanges.subscribe(t=>{t==="CUSTOM"&&(this.createNewDialog||this.isEdit||this.isAdd)?n.get("tenantNamePattern").enable():n.get("tenantNamePattern").disable()})),n}setProviderDefaultValue(m,e){if(m==="Custom"){let n=e.get("title").value;e.reset(this.defaultProvider,{emitEvent:!1}),e.patchValue({title:n},{emitEvent:!1}),this.advancedExpanded=!0}else{let n=this.templates.get(m);n.clientId="",n.clientSecret="",e.patchValue(n)}}static{this.\u0275fac=function(e){return new(e||i)(g(F),g(Z),g(gn),g("entity",8),g("entitiesTableConfig",8),g(Qe),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-client"]],inputs:{createNewDialog:"createNewDialog"},features:[L],decls:39,vars:15,consts:[[1,"tb-form-panel","no-gap","no-border",3,"formGroup"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding"],[1,"flex"],["translate",""],["matInput","","formControlName","title"],[4,"ngIf"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding","column-xs"],["formGroupName","additionalInfo",1,"tb-flex"],["formControlName","providerName"],[3,"value",4,"ngFor","ngForOf"],["floatLabel","always",1,"flex"],["formControlName","platforms","multiple","",3,"placeholder"],["matInput","","formControlName","clientId"],["matInput","","formControlName","clientSecret"],[1,"configuration-panel","mat-elevation-z0",3,"expanded"],["translate","",1,"flex","items-center","justify-start"],["matExpansionPanelContent",""],[3,"value"],[1,"tb-form-panel","no-border","no-padding"],[1,"tb-form-row","column-xs","no-border","no-padding","space-between"],["appearance","fill",3,"ngModelChange","ngModel","ngModelOptions"],["class","tb-form-panel no-gap no-border no-padding","style","padding-bottom: 16px",4,"ngIf"],["class","tb-form-panel no-border no-padding no-gap",4,"ngIf"],[1,"tb-form-panel","no-gap","no-border","no-padding",2,"padding-bottom","16px"],["matInput","","formControlName","accessTokenUri"],["matInput","","formControlName","authorizationUri","required",""],["matInput","","formControlName","jwkSetUri"],["matInput","","formControlName","userInfoUri"],["formControlName","clientAuthenticationMethod"],["class","tb-form-row tb-standard-fields no-border no-padding column-xs",4,"ngIf"],["formGroupName","mapperConfig",2,"margin-bottom","22px"],[1,"tb-form-row","no-border","no-padding"],["formControlName","allowUserCreation",1,"mat-slide"],["formControlName","activateUser",1,"mat-slide"],["formControlName","scope","required","",3,"label","requiredText"],["matInput","","formControlName","loginButtonLabel",3,"placeholder"],["matInput","","formControlName","loginButtonIcon"],[1,"tb-form-panel","no-border","no-padding","no-gap"],["matInput","","formControlName","userNameAttributeName"],["formGroupName","mapperConfig",1,"tb-form-panel","no-border","no-padding","no-gap"],["formControlName","type"],["class","tb-form-panel no-border no-padding no-gap","formGroupName","basic",4,"ngIf"],["class","tb-form-panel no-border no-padding no-gap","formGroupName","custom",4,"ngIf"],["formGroupName","basic",1,"tb-form-panel","no-border","no-padding","no-gap"],["class","tb-form-row tb-standard-fields no-border no-padding",4,"ngIf"],["matInput","","formControlName","firstNameAttributeKey"],["matInput","","formControlName","lastNameAttributeKey"],["formControlName","tenantNameStrategy"],["matInput","","formControlName","tenantNamePattern",3,"required"],["matInput","","formControlName","customerNamePattern"],["matInput","","formControlName","defaultDashboardName"],["formControlName","alwaysFullScreen",1,"tb-flex","mat-slide",2,"margin-bottom","16px"],["matInput","","formControlName","emailAttributeKey"],["formGroupName","custom",1,"tb-form-panel","no-border","no-padding","no-gap"],["matInput","","formControlName","url"],["matInput","","formControlName","username","autocomplete","new-username"],["matInput","","formControlName","password","autocomplete","new-password"],["formControlName","sendToken",1,"tb-flex","mat-slide",2,"margin-bottom","16px"]],template:function(e,n){e&1&&(r(0,"section",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.title"),a(),f(5,"input",4),b(6,Jv,3,3,"mat-error",5)(7,Qv,3,3,"mat-error",5),a()(),r(8,"div",6)(9,"div",7)(10,"mat-form-field",2)(11,"mat-label",3),p(12,"admin.oauth2.provider"),a(),r(13,"mat-select",8),b(14,Yv,2,2,"mat-option",9),a()()(),r(15,"mat-form-field",10)(16,"mat-label",3),p(17,"admin.oauth2.allowed-platforms"),a(),r(18,"mat-select",11),d(19,"translate"),b(20,Kv,3,4,"mat-option",9),a()()(),r(21,"div",6)(22,"mat-form-field",2)(23,"mat-label",3),p(24,"admin.oauth2.client-id"),a(),f(25,"input",12),b(26,Xv,3,3,"mat-error",5)(27,Zv,3,3,"mat-error",5),a(),r(28,"mat-form-field",2)(29,"mat-label",3),p(30,"admin.oauth2.client-secret"),a(),f(31,"input",13),b(32,ey,3,3,"mat-error",5)(33,ty,3,3,"mat-error",5),a()(),r(34,"mat-expansion-panel",14)(35,"mat-expansion-panel-header")(36,"mat-panel-title",15),p(37," admin.oauth2.advanced-settings "),a()(),b(38,Ay,12,13,"ng-template",16),a()()),e&2&&(V("no-padding",n.isAdd),s("formGroup",n.entityForm),o(6),s("ngIf",n.entityForm.get("title").hasError("required")),o(),s("ngIf",n.entityForm.get("title").hasError("maxlength")),o(7),s("ngForOf",n.templateProvider),o(4),T("placeholder",c(19,13,"admin.oauth2.all-platforms")),o(2),s("ngForOf",n.platformTypes),o(6),s("ngIf",n.entityForm.get("clientId").hasError("required")),o(),s("ngIf",n.entityForm.get("clientId").hasError("maxlength")),o(5),s("ngIf",n.entityForm.get("clientSecret").hasError("required")),o(),s("ngIf",n.entityForm.get("clientSecret").hasError("maxlength")),o(),s("expanded",n.advancedExpanded))},dependencies:[Te,G,cn,he,me,Ce,Pe,vt,gt,ht,Gi,rn,sn,eo,ge,W,K,ue,Ye,ie,se,bt,J,Di,Pi,Tr,R],styles:['@charset "UTF-8";  .mat-expansion-panel .mat-expansion-panel-header{height:48px;padding:0 12px}  .mat-expansion-panel .mat-expansion-panel-header.mat-expanded{height:48px}  .mat-expansion-panel .mat-expansion-panel-body{padding:0 12px}  .mat-expansion-panel.configuration-panel{border:1px solid rgba(0,0,0,.2)}']})}};Ro([ra(),Bo("design:type",Object)],Un.prototype,"createNewDialog",void 0);C();var sl=(()=>{class i extends oi{constructor(e){super(e),this.store=e,this.width="100%"}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-client-table-header"]],hostVars:2,hostBindings:function(n,t){n&2&&Bi("width",t.width)},features:[L],decls:4,vars:1,consts:[[1,"flex","items-center"],["tbTruncateWithTooltip","","translate",""],[3,"tb-help"]],template:function(n,t){n&1&&(r(0,"section",0)(1,"div",1),p(2,"admin.oauth2.clients"),a(),f(3,"div",2),a()),n&2&&(o(3),s("tb-help",t.entitiesTableConfig.entityResources.helpLinkId))},dependencies:[wt,an,J],encapsulation:2})}}return i})();var ll=(()=>{class i{constructor(e,n,t){this.translate=e,this.datePipe=n,this.oauth2Service=t,this.config=new Ge,this.config.selectionEnabled=!1,this.config.entityType=k.OAUTH2_CLIENT,this.config.rowPointer=!0,this.config.entityTranslations=Ue.get(k.OAUTH2_CLIENT),this.config.entityResources=tt.get(k.OAUTH2_CLIENT),this.config.entityComponent=Un,this.config.headerComponent=sl,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:Zt.DESC},this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"170px"),new Y("title","admin.oauth2.title","350px"),new Y("platforms","admin.oauth2.allowed-platforms","100%",l=>l.platforms&&l.platforms.length?l.platforms.map(u=>this.translate.instant(Kn.get(u))).join(", "):this.translate.instant("admin.oauth2.all-platforms"),()=>({}),!1)),this.config.deleteEntityTitle=l=>this.translate.instant("admin.oauth2.delete-client-title",{clientName:l.title}),this.config.deleteEntityContent=()=>this.translate.instant("admin.oauth2.delete-client-text"),this.config.entitiesFetchFunction=l=>this.oauth2Service.findTenantOAuth2ClientInfos(l),this.config.loadEntity=l=>this.oauth2Service.getOAuth2ClientById(l.id),this.config.saveEntity=l=>this.oauth2Service.saveOAuth2Client(l),this.config.deleteEntity=l=>this.oauth2Service.deleteOauth2Client(l.id)}resolve(){return this.config}static{this.\u0275fac=function(n){return new(n||i)(D(Z),D(ke),D(gn))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();C();var tg=(()=>{class i{constructor(e){this.http=e}saveDomain(e,n,t){let l="/api/domain";return n?.length&&(l+=`?oauth2ClientIds=${n.join(",")}`),this.http.post(l,e,Uo(t))}updateOauth2Clients(e,n,t){return this.http.put(`/api/domain/${e}/oauth2Clients`,n,Uo(t))}getTenantDomainInfos(e,n){return this.http.get(`/api/domain/infos${e.toQuery()}`,Uo(n))}getDomainInfoById(e,n){return this.http.get(`/api/domain/info/${e}`,Uo(n))}deleteDomain(e,n){return this.http.delete(`/api/domain/${e}`,Uo(n))}static{this.\u0275fac=function(n){return new(n||i)(D(Ir))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();C();C();var Oy=["clientComponent"];function Ry(i,m){i&1&&f(0,"mat-progress-bar",14)}function By(i,m){i&1&&f(0,"div",15)}var ka=(()=>{class i extends nt{constructor(e,n,t,l,u){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.oauth2Service=l,this.errorStateMatcher=u,this.submitted=!1}ngAfterViewInit(){setTimeout(()=>{this.clientComponent.entityForm.markAsDirty()},0)}isErrorState(e,n){let t=this.errorStateMatcher.isErrorState(e,n),l=!!(e&&e.invalid&&this.submitted);return t||l}cancel(){this.dialogRef.close(null)}save(){this.submitted=!0,this.clientComponent.entityForm.valid&&this.oauth2Service.saveOAuth2Client(this.clientComponent.entityFormValue()).subscribe(e=>{this.dialogRef.close(e)})}helpLinkId(){return Tc(this.clientComponent.entityForm.get("additionalInfo.providerName")?.value)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(it),g(gn),g(on,4))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-client-dialog"]],viewQuery:function(n,t){if(n&1&&Ie(Oy,7),n&2){let l;Me(l=we())&&(t.clientComponent=l.first)}},features:[$e([{provide:on,useExisting:i}]),L],decls:26,vars:22,consts:[["clientComponent",""],[2,"width","850px","max-height","100vh",3,"ngSubmit"],["color","primary"],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","",2,"padding","0"],["createNewDialog",""],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){if(n&1){let l=j();r(0,"form",1),_("ngSubmit",function(){return I(l),M(t.save())}),r(1,"mat-toolbar",2)(2,"h2"),p(3),d(4,"translate"),a(),f(5,"span",3)(6,"div",4),r(7,"button",5),_("click",function(){return I(l),M(t.cancel())}),r(8,"mat-icon",6),p(9,"close"),a()()(),b(10,Ry,1,0,"mat-progress-bar",7),d(11,"async"),b(12,By,1,0,"div",8),d(13,"async"),r(14,"div",9),f(15,"tb-client",10,0),a(),r(17,"div",11)(18,"button",12),d(19,"async"),_("click",function(){return I(l),M(t.cancel())}),p(20),d(21,"translate"),a(),r(22,"button",13),d(23,"async"),p(24),d(25,"translate"),a()()()}if(n&2){let l=U(16);o(3),O(c(4,8,"admin.oauth2.add-client")),o(3),s("tb-help",t.helpLinkId()),o(4),s("ngIf",c(11,10,t.isLoading$)),o(2),s("ngIf",!c(13,12,t.isLoading$)),o(6),s("disabled",c(19,14,t.isLoading$)),o(2),h(" ",c(21,16,"action.cancel")," "),o(2),s("disabled",c(23,18,t.isLoading$)||(l.entityForm==null?null:l.entityForm.invalid)||!(l.entityForm!=null&&l.entityForm.dirty)),o(2),h(" ",c(25,20,"action.add")," ")}},dependencies:[G,wt,ee,Ee,ae,qe,at,Rt,mt,ce,K,En,Un,le,R],encapsulation:2})}}return i})();function Vy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.oauth2.domain-name-required")," "))}function jy(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.domain-name-max-length")," "))}function Ly(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"admin.error-verification-url")," "))}var pl=(()=>{class i extends Bt{constructor(e,n,t,l,u,y,w,x,q){super(e,w,l,u,y),this.store=e,this.translate=n,this.oauth2Service=t,this.entityValue=l,this.entitiesTableConfigValue=u,this.cd=y,this.fb=w,this.window=x,this.dialog=q,this.loginProcessingUrl="",this.entityType=k,this.entityForm.get("name").setValue(this.window.location.hostname),this.entityForm.markAsDirty(),this.oauth2Service.getLoginProcessingUrl().subscribe(De=>{this.loginProcessingUrl=De})}buildForm(e){return this.fb.group({name:[e?.name?e.name:"",[S.required,S.maxLength(255),S.pattern("^(?:\\w+(?::\\w+)?@)?[^\\s/]+(?::\\d+)?$")]],oauth2Enabled:Oe(e?.oauth2Enabled)?e.oauth2Enabled:!0,oauth2ClientInfos:e?.oauth2ClientInfos?e.oauth2ClientInfos.map(n=>n.id.id):[],propagateToEdge:Oe(e?.propagateToEdge)?e.propagateToEdge:!1})}updateForm(e){this.entityForm.patchValue({name:e.name,oauth2Enabled:e.oauth2Enabled,oauth2ClientInfos:e.oauth2ClientInfos?.map(n=>n.id?n.id.id:n),propagateToEdge:e.propagateToEdge})}redirectURI(){let e=this.entityForm.get("name").value;return e!==""?`${e}${this.loginProcessingUrl}`:""}createClient(e){e&&(e.stopPropagation(),e.preventDefault()),this.dialog.open(ka,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(n=>{if(n){let t=this.entityForm.get("oauth2ClientInfos").value?[...this.entityForm.get("oauth2ClientInfos").value]:[];t.push(n.id.id),this.entityForm.get("oauth2ClientInfos").patchValue(t),this.entityForm.get("oauth2ClientInfos").markAsDirty()}})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g(gn),g("entity"),g("entitiesTableConfig"),g(Qe),g(de),g(Xo),g(je))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-domain"]],features:[L],decls:31,vars:28,consts:[[1,"tb-form-panel","no-gap","no-border",3,"formGroup"],[1,"tb-form-row","tb-standard-fields","no-border","no-padding"],[1,"flex"],["translate",""],["matInput","","formControlName","name"],[4,"ngIf"],["matInput","","readonly","",3,"value"],["matSuffix","","miniButton","false","color","primary","tooltipPosition","above","icon","content_copy",3,"copyText","tooltipText"],[1,"tb-form-row","no-border","no-padding",2,"margin-bottom","22px"],["formControlName","oauth2Enabled",1,"mat-slide"],["formControlName","oauth2ClientInfos",3,"entityType","labelText","placeholderText"],["mat-button","","color","primary","matSuffix","",3,"click","disabled"],[2,"white-space","nowrap"],[1,"tb-form-row","no-border","no-padding"],["formControlName","propagateToEdge",1,"mat-slide"]],template:function(n,t){n&1&&(r(0,"section",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"admin.oauth2.domain-name"),a(),f(5,"input",4),b(6,Vy,3,3,"mat-error",5)(7,jy,3,3,"mat-error",5)(8,Ly,3,3,"mat-error",5),a()(),r(9,"div",1)(10,"mat-form-field",2)(11,"mat-label",3),p(12,"admin.oauth2.redirect-url-template"),a(),f(13,"input",6)(14,"tb-copy-button",7),d(15,"translate"),a()(),r(16,"div",8)(17,"mat-slide-toggle",9),p(18),d(19,"translate"),a()(),r(20,"tb-entity-list",10),d(21,"translate"),d(22,"translate"),r(23,"button",11),_("click",function(u){return t.createClient(u)}),r(24,"span",12),p(25),d(26,"translate"),a()()(),r(27,"div",13)(28,"mat-slide-toggle",14),p(29),d(30,"translate"),a()()()),n&2&&(V("no-padding",t.isAdd),s("formGroup",t.entityForm),o(6),s("ngIf",t.entityForm.get("name").hasError("required")),o(),s("ngIf",t.entityForm.get("name").hasError("maxlength")),o(),s("ngIf",t.entityForm.get("name").hasError("pattern")),o(5),s("value",t.redirectURI()),o(),T("tooltipText",c(15,16,"admin.oauth2.copy-redirect-uri")),s("copyText",t.redirectURI()),o(4),h(" ",c(19,18,"admin.oauth2.enable")," "),o(2),T("labelText",c(21,20,"admin.oauth2.clients")),T("placeholderText",c(22,22,"admin.oauth2.add-client")),s("entityType",t.entityType.OAUTH2_CLIENT),o(3),s("disabled",!t.isEdit),o(2),O(c(26,24,"admin.oauth2.create-new")),o(4),h(" ",c(30,26,"admin.oauth2.edge")," "))},dependencies:[G,io,ee,he,me,Ce,Pe,zt,ht,ge,W,K,ie,se,J,ga,R],encapsulation:2})}}return i})();C();var ml=(()=>{class i extends oi{constructor(e){super(e),this.store=e,this.width="100%"}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-domain-table-header"]],hostVars:2,hostBindings:function(n,t){n&2&&Bi("width",t.width)},features:[L],decls:4,vars:1,consts:[[1,"flex","items-center"],["tbTruncateWithTooltip","","translate",""],[3,"tb-help"]],template:function(n,t){n&1&&(r(0,"section",0)(1,"div",1),p(2,"admin.oauth2.domains"),a(),f(3,"div",2),a()),n&2&&(o(3),s("tb-help",t.entitiesTableConfig.entityResources.helpLinkId))},dependencies:[wt,an,J],encapsulation:2})}}return i})();var Od=(()=>{class i{constructor(e,n,t){this.translate=e,this.datePipe=n,this.domainService=t,this.config=new Ge,this.config.selectionEnabled=!1,this.config.entityType=k.DOMAIN,this.config.rowPointer=!0,this.config.entityTranslations=Ue.get(k.DOMAIN),this.config.entityResources=tt.get(k.DOMAIN),this.config.entityComponent=pl,this.config.headerComponent=ml,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:Zt.DESC},this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"170px"),new Y("name","admin.oauth2.domain-name","170px"),new no("oauth2ClientInfos","admin.oauth2.clients","40%"),new cd("oauth2Enabled","admin.oauth2.enable",{name:"",nameFunction:l=>this.translate.instant(l.oauth2Enabled?"admin.oauth2.disable":"admin.oauth2.enable"),icon:"mdi:toggle-switch",iconFunction:l=>l.oauth2Enabled?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",isEnabled:()=>!0,onAction:(l,u)=>this.toggleEnableOAuth(l,u)}),new cd("propagateToEdge","admin.oauth2.edge",{name:"",nameFunction:l=>this.translate.instant(l.propagateToEdge?"admin.oauth2.edge-disable":"admin.oauth2.edge-enable"),icon:"mdi:toggle-switch",iconFunction:l=>l.propagateToEdge?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",isEnabled:()=>!0,onAction:(l,u)=>this.togglePropagateToEdge(l,u)})),this.config.deleteEntityTitle=l=>this.translate.instant("admin.oauth2.delete-domain-title",{domainName:l.name}),this.config.deleteEntityContent=()=>this.translate.instant("admin.oauth2.delete-domain-text"),this.config.entitiesFetchFunction=l=>this.domainService.getTenantDomainInfos(l),this.config.loadEntity=l=>this.domainService.getDomainInfoById(l.id),this.config.saveEntity=(l,u)=>{let y=l.oauth2ClientInfos||[],w=l.id&&!Nr(l.oauth2ClientInfos?.sort(),u.oauth2ClientInfos?.map(x=>x.id?x.id.id:x).sort());return delete l.oauth2ClientInfos,this.domainService.saveDomain(l,l.id?null:y).pipe(tn(x=>w?this.domainService.updateOauth2Clients(l.id.id,y).pipe(ze(()=>x)):ut(x)),ze(x=>(x.oauth2ClientInfos=y,x)))},this.config.deleteEntity=l=>this.domainService.deleteDomain(l.id)}resolve(e){return this.config}toggleEnableOAuth(e,n){e&&e.stopPropagation();let y=n,{oauth2ClientInfos:t,oauth2Enabled:l}=y,u=id(y,["oauth2ClientInfos","oauth2Enabled"]);this.domainService.saveDomain(Ii(_e({},u),{oauth2Enabled:!l}),null,{ignoreLoading:!0}).subscribe(w=>{n.oauth2Enabled=w.oauth2Enabled,this.config.getTable().detectChanges()})}togglePropagateToEdge(e,n){e&&e.stopPropagation();let y=n,{oauth2ClientInfos:t,propagateToEdge:l}=y,u=id(y,["oauth2ClientInfos","propagateToEdge"]);this.domainService.saveDomain(Ii(_e({},u),{propagateToEdge:!l}),null,{ignoreLoading:!0}).subscribe(w=>{n.propagateToEdge=w.propagateToEdge,this.config.getTable().detectChanges()})}static{this.\u0275fac=function(n){return new(n||i)(D(Z),D(ke),D(tg))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var Gy=(()=>{class i{constructor(e){this.oauth2Service=e}resolve(){return this.oauth2Service.getLoginProcessingUrl()}static{this.\u0275fac=function(n){return new(n||i)(D(gn))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})(),Rd=[{path:"oauth2",component:un,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],breadcrumb:{label:"admin.oauth2.oauth2",icon:"mdi:shield-account"}},children:[{path:"",children:[],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],redirectTo:{SYS_ADMIN:"/security-settings/oauth2/domains",TENANT_ADMIN:"/security-settings/oauth2/clients"}}},{path:"domains",component:Le,data:{auth:[E.SYS_ADMIN],title:"admin.oauth2.domains",breadcrumb:{menuId:be.domains}},resolve:{entitiesTableConfig:Od}},{path:"clients",data:{title:"admin.oauth2.clients",breadcrumb:{menuId:be.clients}},children:[{path:"",component:Le,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"admin.oauth2.clients"},resolve:{entitiesTableConfig:ll}},{path:"details",children:[{path:":entityId",component:rt,data:{breadcrumb:{labelFunction:st,icon:"public"},auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"admin.oauth2.clients",hideTabs:!0,backNavigationCommands:["../.."]},resolve:{entitiesTableConfig:ll}}]}]}]}],dl=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[Gy,ll,Od],imports:[B.forChild(Rd),B]})}}return i})();(function(){Q(dl,{imports:[B],exports:[B]})})();C();C();C();C();var Uy=["tagField"],sr=`@charset "UTF-8";.tb-scada-symbol-tooltip-panel{display:flex;flex-direction:row;align-items:center;gap:8px}.tb-scada-symbol-tooltip-panel.column{flex-direction:column}.tb-scada-symbol-tooltip-panel.flex-start{align-items:start}.tb-scada-symbol-tooltip-panel .tb-confirm-text{font-size:14px;line-height:16px;text-align:center;font-weight:400}.tb-scada-symbol-tooltip-panel .mdc-button{line-height:20px;font-size:12px}.tb-scada-symbol-tooltip-panel .mdc-button.mat-mdc-button-base,.tb-scada-symbol-tooltip-panel .mdc-button.mat-mdc-button-base .mat-mdc-button-touch-target{height:20px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field{font-size:12px;line-height:12px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field .mat-mdc-text-field-wrapper{padding:0 8px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix{padding-top:4px;padding-bottom:4px;min-height:20px}.tb-scada-symbol-tooltip-panel .mat-mdc-form-field.tb-inline-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-form-field-infix .mat-mdc-input-element{font-size:12px;line-height:12px;height:12px}
`,qy=["tagSettingsButton"],Wy=["removeTagButton"];function Hy(i,m){if(i&1){let e=j();r(0,"button",5),d(1,"translate"),_("click",function(){I(e);let t=v();return M(t.onUpdateTag())}),r(2,"mat-icon"),p(3,"edit"),a()()}i&2&&T("matTooltip",c(1,1,"scada.tag.update-tag"))}function zy(i,m){i&1&&(r(0,"button",6,0),d(2,"translate"),r(3,"mat-icon"),p(4,"settings"),a()()),i&2&&T("matTooltip",c(2,1,"scada.tag.tag-settings"))}function $y(i,m){i&1&&(r(0,"button",6,1),d(2,"translate"),r(3,"mat-icon"),p(4,"delete"),a()()),i&2&&T("matTooltip",c(2,1,"scada.tag.remove-tag"))}var Jy=["yesButton"];function Qy(i,m){i&1&&(r(0,"div",3),p(1,"scada.state-render-function"),a())}function Yy(i,m){if(i&1){let e=j();r(0,"button",4),_("click",function(){I(e);let t=v();return M(t.editStateRenderFunction())}),r(1,"mat-icon"),p(2),a(),r(3,"span"),p(4),d(5,"translate"),a()()}if(i&2){let e=v();o(2),O(e.symbolElement!=null&&e.symbolElement.readonly?"visibility":"edit"),o(2),O(c(5,2,e.symbolElement!=null&&e.symbolElement.readonly?"action.view":"action.edit"))}}function Ky(i,m){if(i&1){let e=j();r(0,"button",4),_("click",function(){I(e);let t=v();return M(t.editStateRenderFunction())}),r(1,"mat-icon"),p(2,"add"),a(),r(3,"span",3),p(4,"action.add"),a()()}}function Xy(i,m){i&1&&(r(0,"div",3),p(1,"scada.tag.on-click-action"),a())}function Zy(i,m){if(i&1){let e=j();r(0,"button",4),_("click",function(){I(e);let t=v();return M(t.editClickAction())}),r(1,"mat-icon"),p(2),a(),r(3,"span"),p(4),d(5,"translate"),a()()}if(i&2){let e=v();o(2),O(e.symbolElement!=null&&e.symbolElement.readonly?"visibility":"edit"),o(2),O(c(5,2,e.symbolElement!=null&&e.symbolElement.readonly?"action.view":"action.edit"))}}function e_(i,m){if(i&1){let e=j();r(0,"button",4),_("click",function(){I(e);let t=v();return M(t.editClickAction())}),r(1,"mat-icon"),p(2,"add"),a(),r(3,"span",3),p(4,"action.add"),a()()}}var lr=(()=>{class i{constructor(e){this.element=e,this.viewInited=new Dt}ngAfterViewInit(){this.viewInited.emit()}static{this.\u0275fac=function(n){return new(n||i)(g(bn))}}static{this.\u0275dir=_r({type:i,inputs:{symbolElement:"symbolElement"},outputs:{viewInited:"viewInited"}})}}return i})(),ig=(()=>{class i extends lr{constructor(e){super(e),this.element=e,this.addTag=new Dt}onAddTag(){this.addTag.emit()}static{this.\u0275fac=function(n){return new(n||i)(g(bn))}}static{this.\u0275cmp=P({type:i,selectors:[["ng-component"]],outputs:{addTag:"addTag"},features:[L],decls:9,vars:4,consts:[[1,"tb-scada-symbol-tooltip-panel"],["mat-stroked-button","","color","primary",3,"click"],["translate",""]],template:function(n,t){n&1&&(r(0,"div",0)(1,"span"),p(2),d(3,"translate"),a(),r(4,"button",1),_("click",function(){return t.onAddTag()}),r(5,"mat-icon"),p(6,"add"),a(),r(7,"span",2),p(8,"scada.tag.add-tag"),a()()()),n&2&&(o(2),za("",t.symbolElement==null||t.symbolElement.element==null?null:t.symbolElement.element.type,"",t.symbolElement!=null&&t.symbolElement.invisible?" ("+c(3,2,"scada.hidden")+")":"",""))},dependencies:[ee,ae,J,R],styles:[sr],encapsulation:2})}}return i})(),ng=(()=>{class i extends lr{constructor(e){super(e),this.element=e,this.apply=new Dt,this.cancel=new Dt,this.closed=!1}ngAfterViewInit(){super.ngAfterViewInit(),setTimeout(()=>{this.tagField.nativeElement.focus()})}ngOnDestroy(){this.blurTimeout&&(clearTimeout(this.blurTimeout),this.blurTimeout=null)}tagEnter(e){e.keyCode===13&&(e.preventDefault(),this.tag&&(this.closed=!0,this.apply.emit(this.tag)))}onApply(){this.closed=!0,this.tag?this.apply.emit(this.tag):this.cancel.emit()}onCancel(){this.closed=!0,this.cancel.emit()}onBlur(){this.blurTimeout=setTimeout(()=>{this.closed||(this.closed=!0,this.cancel.emit())},300)}static{this.\u0275fac=function(n){return new(n||i)(g(bn))}}static{this.\u0275cmp=P({type:i,selectors:[["ng-component"]],viewQuery:function(n,t){if(n&1&&Ie(Uy,5),n&2){let l;Me(l=we())&&(t.tagField=l.first)}},inputs:{isAdd:"isAdd",tag:"tag"},outputs:{apply:"apply",cancel:"cancel"},features:[L],decls:16,vars:14,consts:[["tagField",""],[1,"tb-scada-symbol-tooltip-panel"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field"],["matInput","",3,"ngModelChange","keydown","blur","ngModel","placeholder"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"click","matTooltip","disabled"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"click","matTooltip"]],template:function(n,t){if(n&1){let l=j();r(0,"div",1)(1,"span"),p(2),d(3,"translate"),a(),r(4,"mat-form-field",2)(5,"input",3,0),d(7,"translate"),et("ngModelChange",function(y){return I(l),Ze(t.tag,y)||(t.tag=y),M(y)}),_("keydown",function(y){return I(l),M(t.tagEnter(y))})("blur",function(){return I(l),M(t.onBlur())}),a()(),r(8,"button",4),d(9,"translate"),_("click",function(){return I(l),M(t.onApply())}),r(10,"mat-icon"),p(11,"done"),a()(),r(12,"button",5),d(13,"translate"),_("click",function(){return I(l),M(t.onCancel())}),r(14,"mat-icon"),p(15,"close"),a()()()}n&2&&(o(2),h("",c(3,6,t.isAdd?"scada.tag.enter-tag":"scada.tag.update-tag"),":"),o(3),T("placeholder",c(7,8,"widget-config.set")),Xe("ngModel",t.tag),o(3),T("matTooltip",c(9,10,"action.apply")),s("disabled",!t.tag),o(4),T("matTooltip",c(13,12,"action.cancel")))},dependencies:[Ee,ae,he,me,Pt,ge,W,Ye,R],styles:[sr],encapsulation:2})}}return i})(),og=(()=>{class i extends lr{constructor(e,n){super(e),this.element=e,this.container=n,this.updateTag=new Dt,this.removeTag=new Dt,this.displayTagSettings=!0}ngOnInit(){this.symbolElement?.readonly&&(this.displayTagSettings=this.symbolElement?.hasStateRenderFunction()||this.symbolElement?.hasClickAction())}ngAfterViewInit(){super.ngAfterViewInit(),setTimeout(()=>{if(this.displayTagSettings){let e=$(this.tagSettingsButton.nativeElement);e.tooltipster({parent:this.symbolElement.tooltipContainer,zIndex:200,arrow:!0,theme:["scada-symbol","tb-active"],interactive:!0,trigger:"click",trackOrigin:!0,trackerInterval:100,side:"top",content:""});let n=e.tooltipster("instance"),t=rr(this.symbolElement,this.container,rg,n);n.on("ready",()=>{t.instance.updateFunctionsState()})}if(!this.symbolElement.readonly){let e=$(this.removeTagButton.nativeElement);e.tooltipster({parent:this.symbolElement.tooltipContainer,zIndex:200,arrow:!0,theme:["scada-symbol","tb-active"],interactive:!0,trigger:"click",trackOrigin:!0,trackerInterval:100,side:"top",content:""});let n=e.tooltipster("instance"),t=rr(this.symbolElement,this.container,ag,n);t.instance.removeTag.subscribe(()=>{n.destroy(),this.removeTag.emit()}),t.instance.cancel.subscribe(()=>{n.close()}),n.on("ready",()=>{t.instance.yesButton.focus()})}})}onUpdateTag(){this.updateTag.emit()}static{this.\u0275fac=function(n){return new(n||i)(g(bn),g(nn))}}static{this.\u0275cmp=P({type:i,selectors:[["ng-component"]],viewQuery:function(n,t){if(n&1&&(Ie(qy,5,bn),Ie(Wy,5,bn)),n&2){let l;Me(l=we())&&(t.tagSettingsButton=l.first),Me(l=we())&&(t.removeTagButton=l.first)}},outputs:{updateTag:"updateTag",removeTag:"removeTag"},features:[L],decls:10,vars:8,consts:[["tagSettingsButton",""],["removeTagButton",""],[1,"tb-scada-symbol-tooltip-panel"],["type","button","mat-icon-button","","class","tb-mat-20","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["type","button","mat-icon-button","","class","tb-mat-20","matTooltipPosition","above",3,"matTooltip",4,"ngIf"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"click","matTooltip"],["type","button","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-20",3,"matTooltip"]],template:function(n,t){n&1&&(r(0,"div",2)(1,"span"),p(2),d(3,"translate"),a(),r(4,"span")(5,"b"),p(6),a()(),b(7,Hy,4,3,"button",3)(8,zy,5,3,"button",4)(9,$y,5,3,"button",4),a()),n&2&&(o(2),za("",t.symbolElement==null||t.symbolElement.element==null?null:t.symbolElement.element.type,"",t.symbolElement!=null&&t.symbolElement.invisible?" ("+c(3,6,"scada.hidden")+")":"",":"),o(4),O(t.symbolElement==null?null:t.symbolElement.tag),o(),s("ngIf",!(t.symbolElement!=null&&t.symbolElement.readonly)),o(),s("ngIf",t.displayTagSettings),o(),s("ngIf",!(t.symbolElement!=null&&t.symbolElement.readonly)))},dependencies:[G,Ee,ae,Pt,R],styles:[sr],encapsulation:2})}}return i})(),ag=(()=>{class i extends lr{constructor(e,n){super(e),this.element=e,this.translate=n,this.cancel=new Dt,this.removeTag=new Dt}ngOnInit(){this.deleteText=this.translate.instant("scada.tag.delete-tag-text",{tag:this.symbolElement?.tag,elementType:this.symbolElement?.element?.type})}onCancel(){this.cancel.emit()}onRemoveTag(){this.removeTag.emit()}static{this.\u0275fac=function(n){return new(n||i)(g(bn),g(Z))}}static{this.\u0275cmp=P({type:i,selectors:[["ng-component"]],viewQuery:function(n,t){if(n&1&&Ie(Jy,5),n&2){let l;Me(l=we())&&(t.yesButton=l.first)}},outputs:{cancel:"cancel",removeTag:"removeTag"},features:[L],decls:14,vars:1,consts:[["yesButton",""],[1,"tooltipster-content","tb-scada-symbol-tooltip-panel","column"],[1,"tb-confirm-text",3,"innerHTML"],[1,"tb-scada-symbol-tooltip-panel"],["mat-stroked-button","","color","primary",3,"click"],["translate",""]],template:function(n,t){if(n&1){let l=j();r(0,"div",1),f(1,"div",2),r(2,"div",3)(3,"button",4),_("click",function(){return I(l),M(t.onCancel())}),r(4,"mat-icon"),p(5,"close"),a(),r(6,"span",5),p(7,"action.no"),a()(),r(8,"button",4,0),_("click",function(){return I(l),M(t.onRemoveTag())}),r(10,"mat-icon"),p(11,"done"),a(),r(12,"span",5),p(13,"action.yes"),a()()()()}n&2&&(o(),s("innerHTML",t.deleteText,zn))},dependencies:[ee,ae,J],styles:[sr],encapsulation:2})}}return i})(),rg=(()=>{class i extends lr{constructor(e){super(e),this.element=e,this.hasStateRenderFunction=!1,this.hasClickAction=!1}ngOnInit(){this.updateFunctionsState()}updateFunctionsState(){this.hasStateRenderFunction=this.symbolElement.hasStateRenderFunction(),this.hasClickAction=this.symbolElement.hasClickAction()}editStateRenderFunction(){this.symbolElement.editStateRenderFunction()}editClickAction(){this.symbolElement.editClickAction()}static{this.\u0275fac=function(n){return new(n||i)(g(bn))}}static{this.\u0275cmp=P({type:i,selectors:[["ng-component"]],features:[L],decls:7,vars:6,consts:[[1,"tooltipster-content","tb-scada-symbol-tooltip-panel","column","flex-start"],["translate","",4,"ngIf"],["mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["translate",""],["mat-stroked-button","","color","primary",3,"click"]],template:function(n,t){n&1&&(r(0,"div",0),b(1,Qy,2,0,"div",1)(2,Yy,6,4,"button",2)(3,Ky,5,0,"button",2)(4,Xy,2,0,"div",1)(5,Zy,6,4,"button",2)(6,e_,5,0,"button",2),a()),n&2&&(o(),s("ngIf",!(t.symbolElement!=null&&t.symbolElement.readonly)||t.hasStateRenderFunction),o(),s("ngIf",t.hasStateRenderFunction),o(),s("ngIf",!t.hasStateRenderFunction&&!(t.symbolElement!=null&&t.symbolElement.readonly)),o(),s("ngIf",!(t.symbolElement!=null&&t.symbolElement.readonly)||t.hasClickAction),o(),s("ngIf",t.hasClickAction),o(),s("ngIf",!t.hasClickAction&&!(t.symbolElement!=null&&t.symbolElement.readonly)))},dependencies:[G,ee,ae,J,R],styles:[sr],encapsulation:2})}}return i})(),cl=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe]})}}return i})();(function(){Q(cl,{declarations:[ig,ng,og,ag,rg],imports:[ne,oe]})})();var Bd=(i,m)=>{i.stopEdit(),i.tooltip.off("close");let e=rr(i,m,ig);e.instance.addTag.subscribe(()=>{e.destroy(),sg(i,m,!0)})},Vd=(i,m)=>{i.stopEdit(),i.unhighlight();let e=rr(i,m,og);e.instance.updateTag.subscribe(()=>{e.destroy(),sg(i,m,!1)}),e.instance.removeTag.subscribe(()=>{e.destroy(),i.clearTag()}),i.tooltip.open()},sg=(i,m,e)=>{i.startEdit(()=>{e?(i.unhighlight(),i.tooltip.close()):(n.destroy(),Vd(i,m))});let n=rr(i,m,ng);n.instance.isAdd=e,e||(n.instance.tag=i.tag),n.instance.apply.subscribe(t=>{n.destroy(),e&&i.tooltip.off("close"),i.setTag(t)}),n.instance.cancel.subscribe(()=>{i.stopEdit(!0)}),e&&(i.tooltip.option("delay",[0,1e7]),i.tooltip.on("close",()=>{n.destroy(),i.tooltip.option("delay",[0,300]),Bd(i,m)}))},rr=(i,m,e,n)=>{n||(n=i.tooltip);let t=m.createComponent(e);t.instance.symbolElement=i,t.instance.viewInited.subscribe(()=>{n.status().open&&n.reposition()}),n.on("destroyed",()=>{t.destroy()});let l=t.instance.element.nativeElement,u=l.firstChild;return l.removeChild(u),l.style.display="none",n.content(u),t};var ul=.75,jd=4,fl=class{constructor(m,e,n,t,l,u){this.rootElement=m,this.tooltipsContainer=e,this.viewContainerRef=n,this.zone=t,this.callbacks=l,this.readonly=u,this.elements=[],this.performSetup=!1,this.showHidden=!1,this.scale=1,this.tags=[],this.zoomFactor=.34,this.shapeResize$=new ResizeObserver(()=>{this.resize()})}setReadOnly(m){this.readonly=m}setContent(m){this.shapeResize$.unobserve(this.rootElement),this.svgShape&&(this.destroyElements(),this.svgShape.remove()),this.scale=1,this.showHidden=!1;let e=h0(m);this.svgRootNodePart=e.svgRootNode,this.svgShape=ud().svg(e.innerSvg),this.svgShape.node.style.overflow="visible",this.svgShape.node.style["user-select"]="none";let n=ud(`${e.svgRootNode}
${e.innerSvg}
</svg>`);n.type==="svg"?(this.box=n.viewbox(),n.fill()&&this.svgShape.fill(n.fill())):this.box=this.svgShape.bbox(),n.remove(),this.svgShape.size(this.box.width,this.box.height),this.svgShape.viewbox(`0 0 ${this.box.width} ${this.box.height}`),this.svgShape.style().attr("tb:inner",!0).rule(".tb-element",{cursor:"pointer",transition:"0.2s filter ease-in-out"}),this.svgShape.addTo(this.rootElement),this.updateHoverFilterStyle(),this.performSetup=!0,this.shapeResize$.observe(this.rootElement)}getContent(){if(this.svgShape){this.elements.forEach(e=>e.restoreOrigVisibility());let m=this.svgShape.svg(e=>{if(e.node.hasAttribute("tb:inner"))return!1;e.node.classList.remove("tb-element","tooltipstered"),e.node.classList.length||e.node.removeAttribute("class"),e.attr("svgjs:data",null)},!1);return this.showHiddenElements(this.showHidden),`${this.svgRootNodePart}
${m}
</svg>`}else return null}cancelEdit(){this.elements.filter(m=>m.isEditing()).forEach(m=>m.stopEdit(!0))}zoomIn(){let m=Math.min(Math.pow(1+this.zoomFactor,1.2)*this.svgShape.zoom(),jd);this.zoomAnimate(m)}zoomOut(){let m=Math.max(Math.pow(1+this.zoomFactor,-1.2)*this.svgShape.zoom(),ul);this.zoomAnimate(m)}showHiddenElements(m){this.showHidden=m,this.elements.forEach(e=>m?e.showInvisible():e.hideInvisible())}zoomAnimate(m,e=200){m!==this.svgShape.zoom()&&(this.hideTooltips(),this.svgShape.animate(e).ease("<>").zoom(m).during(()=>{let t=this.restrictToMargins(this.svgShape.viewbox());this.svgShape.viewbox(t)}).after(()=>{this.postZoom(this.callbacks.onZoom)}))}zoomInDisabled(){return Number(this.svgShape.zoom().toFixed(5))>=jd}zoomOutDisabled(){return Number(this.svgShape.zoom().toFixed(5))<=ul}doSetup(){this.setupZoomPan(),window.SVG=d0,Nt([Ha(import("./chunk-OWQOMBUM.js")),Ha(import("./chunk-5IFT3VLX.js"))]).subscribe(()=>{this.zone.run(()=>{this.setupElements()})})}setupZoomPan(){this.svgShape.panZoom({zoomMin:ul,zoomMax:jd,zoomFactor:this.zoomFactor}),this.svgShape.on("zoom",m=>{let{detail:{level:e,focus:n}}=m;this.svgShape.zoom(e,n),this.postZoom(this.callbacks.onZoom,m)}),this.svgShape.on("panning",m=>{let e=m.detail.box;this.svgShape.viewbox(this.restrictToMargins(e)),m.preventDefault()}),this.svgShape.on("panStart",m=>{this.hideTooltips(),this.svgShape.node.style.cursor="grab"}),this.svgShape.on("panEnd",m=>{this.restoreTooltips(),this.svgShape.node.style.cursor="default"}),this.svgShape.zoom(ul)}postZoom(m,e){let n=this.restrictToMargins(this.svgShape.viewbox());this.svgShape.viewbox(n),setTimeout(()=>{this.updateTooltipPositions()}),e?.preventDefault(),m&&m()}restrictToMargins(m){let e=Math.max(m.width-this.box.width,0),n=Math.max(m.height-this.box.height,0);return m.x<-e?m.x=-e:m.x+m.width>this.box.width+e&&(m.x=this.box.width+e-m.width),m.y<-n?m.y=-n:m.y+m.height>this.box.height+n&&(m.y=this.box.height+n-m.height),m}setupElements(){this.svgShape.children().forEach(n=>{this.addElement(n)});let m=[];for(let n of this.elements)for(let t of this.elements)if(n!==t&&n.overlappingCenters(t)){let l;for(let u of m)if(u.includes(t)||u.includes(n)){l=u;break}l?l.includes(n)?l.includes(t)||l.push(t):l.push(n):(l=[n,t],m.push(l))}for(let n of m){let t=n.map(x=>x.box.cy),l=t.reduce((x,q)=>x+q,0)/t.length,u=n.find(x=>x.isText()),y=u&&n.length%2===0?n.length+1:n.length;u&&(u.setInnerTooltipOffset(0,l),n.splice(n.indexOf(u),1));let w=-(Oa*y)/2+Oa/2;for(let x of n)u&&w===0&&(w+=Oa),x.setInnerTooltipOffset(w,l),w+=Oa}for(let n of this.elements)n.init();this.updateTags();let e=this.elements.some(n=>n.invisible);this.callbacks.hasHiddenElements&&this.callbacks.hasHiddenElements(e)}addElement(m,e=!1){if(t_(m)){let n=e||!m.visible(),t=new Ld(this,m,n);this.elements.push(t),m.children().forEach(l=>{l.type==="tspan"&&m.type==="text"||this.addElement(l,n)},!0)}}destroy(){this.shapeResize$&&this.shapeResize$.disconnect(),this.destroyElements()}destroyElements(){this.elements.forEach(m=>{m.destroy()}),this.elements.length=0}resize(){if(this.svgShape){let m=this.rootElement.getBoundingClientRect().width,e=this.rootElement.getBoundingClientRect().height;if(m&&e){let n=this.box.width/this.box.height,t=m/e,l;n>t?l=m/this.box.width:l=e/this.box.height,this.scale!==l&&(this.scale=l,this.svgShape.node.style.transform=`scale(${this.scale})`,this.updateHoverFilterStyle(),this.updateTooltipPositions()),this.performSetup&&(this.performSetup=!1,this.doSetup())}}}updateHoverFilterStyle(){this.hoverFilterStyle&&this.hoverFilterStyle.remove();let m=(2.8/this.scale).toFixed(2),e=(1.2/this.scale).toFixed(2);this.hoverFilterStyle=this.svgShape.style().attr("tb:inner",!0).rule(".hovered",{filter:`drop-shadow(0px 0px ${m}px white) drop-shadow(0px 0px ${m}px white)
             drop-shadow(0px 0px ${m}px white) drop-shadow(0px 0px ${m}px white)
             drop-shadow(0px 0px ${e}px black)`})}updateTooltipPositions(){for(let m of this.elements)m.updateTooltipPosition()}hideTooltips(){for(let m of this.elements)m.hideTooltip()}restoreTooltips(){for(let m of this.elements)m.restoreTooltip()}updateTags(){this.tags=this.elements.filter(m=>m.hasTag()).map(m=>m.tag).filter((m,e,n)=>n.indexOf(m)===e).sort(),this.callbacks.tagsUpdated(this.tags)}getTags(){return this.tags}tagHasStateRenderFunction(m){return this.callbacks.tagHasStateRenderFunction(m)}tagHasClickAction(m){return this.callbacks.tagHasClickAction(m)}editTagStateRenderFunction(m){this.callbacks.editTagStateRenderFunction(m)}editTagClickAction(m){this.callbacks.editTagClickAction(m)}setDirty(m){this.callbacks.onSymbolEditObjectDirty(m)}},t_=i=>{try{if(i.bbox){let m=i.bbox();return!m.width&&!m.height&&!i.visible()&&(i.show(),m=i.bbox(),i.hide()),!!m.width||!!m.height}else return!1}catch{return!1}},Oa=44,i_=100,pr=2,Mo=2,Ld=class{get readonly(){return this.editObject.readonly}constructor(m,e,n=!1){this.editObject=m,this.element=e,this.invisible=n,this.editing=!1,this.innerTooltipOffset=0,this.highlighted=!1,this.origVisibility=!0,this.tag=e.attr("tb:tag"),this.origVisibility=e.visible(),this.invisible&&e.show(),this.box=e.rbox(this.editObject.svgShape)}init(){this.isGroup()?(this.highlightRect=this.editObject.svgShape.rect(this.box.width+Mo*2,this.box.height+Mo*2).x(this.box.x-Mo).y(this.box.y-Mo).attr({"tb:inner":!0,fill:"none",rx:this.unscaled(6),stroke:"rgba(0, 0, 0, 0.38)","stroke-dasharray":"1","stroke-width":this.unscaled(pr),opacity:0}),this.highlightRectTimeline=new m0,this.highlightRect.timeline(this.highlightRectTimeline),this.highlightRect.hide()):this.element.addClass("tb-element"),this.element.on("mouseenter",m=>{this.highlight()}),this.element.on("mouseleave",m=>{this.unhighlight()}),this.invisible||this.setupTooltips(),this.hideInvisible()}setupTooltips(){this.hasTag()?this.createTagTooltip():this.readonly||this.createAddTagTooltip()}showInvisible(){this.invisible&&(this.element.show(),this.tooltip||this.setupTooltips())}hideInvisible(){this.invisible&&(this.element.hide(),this.tooltip&&(this.tooltip.destroy(),this.tooltip=null))}restoreOrigVisibility(){this.origVisibility?this.element.show():this.element.hide()}overlappingCenters(m){return this.isGroup()||m.isGroup()?!1:Math.abs(this.box.cx-m.box.cx)*this.editObject.scale<i_&&Math.abs(this.box.cy-m.box.cy)*this.editObject.scale<Oa}highlight(){this.highlighted||(this.highlighted=!0,this.isGroup()?(this.highlightRectTimeline.finish(),this.highlightRect.attr({rx:this.unscaled(6),"stroke-width":this.unscaled(pr)}),this.highlightRect.show(),this.highlightRect.animate(300).attr({opacity:1})):this.element.addClass("hovered"),this.hasTag()&&(this.tooltip.reposition(),$(this.tooltip.elementTooltip()).addClass("tb-active")))}unhighlight(){this.highlighted&&(this.highlighted=!1,this.isGroup()?(this.highlightRectTimeline.finish(),this.highlightRect.animate(300).attr({opacity:0}).after(()=>{this.highlightRect.hide()})):this.element.removeClass("hovered"),this.hasTag()&&!this.editing&&$(this.tooltip.elementTooltip()).removeClass("tb-active"))}clearTag(){this.tooltip.destroy(),this.tag=null,this.element.attr("tb:tag",null),this.unhighlight(),this.createAddTagTooltip(),this.editObject.setDirty(!0),this.editObject.updateTags()}setTag(m){this.tooltip.destroy(),this.tag=m,this.element.attr("tb:tag",m),this.createTagTooltip(),this.editObject.setDirty(!0),this.editObject.updateTags()}hasStateRenderFunction(){return this.hasTag()?this.editObject.tagHasStateRenderFunction(this.tag):!1}hasClickAction(){return this.hasTag()?this.editObject.tagHasClickAction(this.tag):!1}editStateRenderFunction(){this.hasTag()&&this.editObject.editTagStateRenderFunction(this.tag)}editClickAction(){this.hasTag()&&this.editObject.editTagClickAction(this.tag)}startEdit(m){this.editing||(this.editObject.cancelEdit(),this.editing=!0,this.onCancelEdit=m)}stopEdit(m=!1){this.editing&&(this.editing=!1,m&&this.onCancelEdit&&this.onCancelEdit(),this.onCancelEdit=null,this.hasTag()&&!this.highlighted&&$(this.tooltip.elementTooltip()).removeClass("tb-active"))}isEditing(){return this.editing}updateTooltipPosition(){if(this.tooltip&&!this.tooltip.status().destroyed){this.tooltip.reposition();let m=this.tooltip.elementTooltip();m&&(m.style.visibility=null)}}hideTooltip(){if(this.tooltip&&!this.tooltip.status().destroyed){let m=this.tooltip.elementTooltip();m&&(m.style.visibility="hidden")}}restoreTooltip(){this.updateTooltipPosition()}setInnerTooltipOffset(m,e){this.innerTooltipOffset=m+(e-this.box.cy)*this.editObject.scale}destroy(){this.tooltip&&this.tooltip.destroy()}get tooltipContainer(){return $(this.editObject.tooltipsContainer)}unscaled(m){return m/(this.editObject.scale*this.editObject.svgShape.zoom())}scaled(m){return m*(this.editObject.scale*this.editObject.svgShape.zoom())}createTagTooltip(){let m=$(this.element.node);m.tooltipster({parent:this.tooltipContainer,zIndex:100,arrow:this.isGroup(),distance:this.isGroup()?this.scaled(Mo)+pr:6,theme:["scada-symbol"],delay:0,animationDuration:0,interactive:!0,trigger:"custom",side:"top",trackOrigin:!1,content:"",functionPosition:(e,n,t)=>this.innerTagTooltipPosition(e,n,t),functionReady:(e,n)=>{let t=$(n.tooltip);t.on("mouseenter",()=>{this.highlight()}),t.on("mouseleave",()=>{this.unhighlight()})}}),this.tooltip=m.tooltipster("instance"),this.setupTagPanel()}setupTagPanel(){Vd(this,this.editObject.viewContainerRef)}createAddTagTooltip(){let m=$(this.element.node);m.tooltipster({parent:this.tooltipContainer,zIndex:100,arrow:!0,theme:["scada-symbol","tb-active"],delay:[0,300],interactive:!0,trigger:"hover",side:["top","left","bottom","right"],trackOrigin:!1,content:"",functionBefore:(e,n)=>{let t=n.event;this.tooltipMouseX=t.clientX,this.tooltipMouseY=t.clientY;let l;this.isGroup()?l="top":l=this.calculateTooltipSide(n.origin.getBoundingClientRect(),t.clientX,t.clientY),e.option("side",l)},functionPosition:(e,n,t)=>this.innerAddTagTooltipPosition(e,n,t),functionReady:(e,n)=>{let t=$(n.tooltip);t.on("mouseenter",()=>{this.highlight()}),t.on("mouseleave",()=>{this.unhighlight()})}}),this.tooltip=m.tooltipster("instance"),this.setupAddTagPanel()}setupAddTagPanel(){Bd(this,this.editObject.viewContainerRef)}innerTagTooltipPosition(m,e,n){let t=e.origin.getBoundingClientRect();return this.isGroup()?(n.distance=this.scaled(Mo)+pr,n.coord.top=t.top-n.size.height-(this.scaled(Mo)+pr)):(n.coord.top=t.top+(t.height-n.size.height)/2+this.innerTooltipOffset*this.editObject.svgShape.zoom(),n.coord.left=t.left+(t.width-n.size.width)/2),n}innerAddTagTooltipPosition(m,e,n){let l=this.tooltipContainer[0].getBoundingClientRect();switch(n.side){case"right":n.coord.top=this.tooltipMouseY-n.size.height/2,n.coord.left=this.tooltipMouseX+10,n.target=this.tooltipMouseY;break;case"top":n.coord.top=this.tooltipMouseY-n.size.height-10,n.coord.left=this.tooltipMouseX-n.size.width/2,n.target=this.tooltipMouseX,this.isGroup()&&(n.coord.top-=Oa);break;case"left":n.coord.top=this.tooltipMouseY-n.size.height/2,n.coord.left=this.tooltipMouseX-n.size.width-10,n.target=this.tooltipMouseY;break;case"bottom":n.coord.top=this.tooltipMouseY+10,n.coord.left=this.tooltipMouseX-n.size.width/2,n.target=this.tooltipMouseX;break}let u=l.right-(n.coord.left+n.size.width);u<0&&(n.coord.left+=u);let y=l.left-n.coord.left;return y>0&&(n.coord.left+=y),n}calculateTooltipSide(m,e,n){let t,l=m.left+m.width/2,u=m.top+m.height/2;return m.width>m.height?Math.abs(l-e)>m.width/4?e<l?t="left":t="right":n<u?t="top":t="bottom":Math.abs(u-n)>m.height/4?n<u?t="top":t="bottom":e<l?t="left":t="right",t}hasTag(){return!!this.tag}isGroup(){return this.element.type==="g"}isText(){return this.element.type==="text"}},uo=/[a-zA-Z$_\u00a1-\uffff][a-zA-Z\d$_\u00a1-\uffff]*/,Gd={token:"tb.scada-symbol-ctx",regex:/\bctx\b/,next:"scadaSymbolCtxApi"},n_={token:"tb.scada-symbol-svg",regex:/\bsvg\b/,next:"scadaSymbolSVGApi"},lg={token:"tb.scada-symbol-element",regex:/\belement\b/,next:"scadaSymbolElementApi"},o_={token:"tb.scada-symbol-event",regex:/\bevent\b/,next:"scadaSymbolEventApi"},Ud={scadaSymbolCtxApi:[Fn,{token:"tb.scada-symbol-ctx-properties",regex:/properties/,next:"scadaSymbolCtxPropertiesApi"},{token:"tb.scada-symbol-ctx-tags",regex:/tags/,next:"scadaSymbolCtxTagsApi"},{token:"tb.scada-symbol-ctx-values",regex:/values/,next:"scadaSymbolCtxValuesApi"},{token:"tb.scada-symbol-ctx-api",regex:/api/,next:"scadaSymbolCtxApiMethodApi"},{token:"tb.scada-symbol-ctx-svg",regex:/svg/,next:"scadaSymbolCtxSVGMethodApi"},An],scadaSymbolCtxPropertiesApi:[Fn,{token:"tb.scada-symbol-ctx-property",regex:uo,next:"no_regex"},An],scadaSymbolCtxTagsApi:[Fn,{token:"tb.scada-symbol-ctx-tag",regex:uo,next:"no_regex"},An],scadaSymbolCtxValuesApi:[Fn,{token:"tb.scada-symbol-ctx-value",regex:uo,next:"no_regex"},An],scadaSymbolCtxApiMethodApi:[Fn,{token:"tb.scada-symbol-ctx-api-method",regex:uo,next:"no_regex"},An],scadaSymbolCtxSVGMethodApi:[Fn,{token:"tb.scada-symbol-ctx-svg-method",regex:uo,next:"no_regex"},An]},a_={scadaSymbolSVGApi:[Fn,{token:"tb.scada-symbol-svg-properties",regex:uo,next:"no_regex"},An]},pg={scadaSymbolElementApi:[Fn,{token:"tb.scada-symbol-element-properties",regex:uo,next:"no_regex"},An]},r_={scadaSymbolEventApi:[Fn,{token:"tb.scada-symbol-event-properties",regex:uo,next:"no_regex"},An]},mg=_e(_e({start:[Gd,n_]},Ud),a_),dg=_e(_e({no_regex:[Gd,lg]},Ud),pg),cg=_e(_e(_e({start:[Gd,lg,o_]},Ud),pg),r_),ug=i=>({ctx:i,svg:{meta:"argument",type:'<a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>',description:'A root svg node. Instance of <a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>.'}}),qd=i=>({ctx:i,element:{meta:"argument",type:"Element",description:'SVG element.<br>See <a href="https://svgjs.dev/docs/3.2/manipulating/" target="_blank">Manipulating</a> section to manipulate the element.<br>See <a href="https://svgjs.dev/docs/3.2/animating/" target="_blank">Animating</a> section to animate the element.'}}),fg=i=>{let m=qd(i);return m.event={meta:"argument",type:"Event",description:"DOM event."},m},gg=(i,m,e)=>{let t=`<a href="${xc.linksMap.scadaSymbolDevAnimation}" target="_blank">ScadaSymbolAnimation</a>`,l={meta:"object",type:"object",description:"An object holding all defined SCADA symbol properties.",children:jr(i.properties,e)},u={meta:"object",type:"object",description:'An object holding all values obtained using behaviors of type <b>"Value"</b>',children:{}},y=i.behavior.filter(x=>x.type===Ki.value);for(let x of y)u.children[x.id]=s_(x,e);let w={meta:"object",type:"object",description:"An object holding all tagged SVG elements grouped by tags (object keys).",children:{}};if(m?.length)for(let x of m)w.children[x]={meta:"property",description:"An array of SVG elements.",type:"Array<Element>"};return{meta:"argument",type:"ScadaSymbolContext",description:"Context of the SCADA symbol.",children:{api:{meta:"object",type:"ScadaSymbolApi",description:"SCADA symbol API",children:{cssAnimate:{meta:"function",description:"Finishes any previous CSS animation and starts new CSS animation for SVG element.",args:[{name:"element",description:"SVG element",type:"Element"},{name:"duration",description:"Animation duration in milliseconds",type:"number"}],return:{description:`Instance of ${t} class with API to setup and control the animation.`,type:t}},cssAnimation:{meta:"function",description:"Get the current CSS animation applied for the SVG element.",args:[{name:"element",description:"SVG element",type:"Element"}],return:{description:`Instance of ${t} class with API to setup and control the animation.`,type:t}},resetCssAnimation:{meta:"function",description:"Stops CSS animation if any and restore SVG element initial state, removes CSS animation instance.",args:[{name:"element",description:"SVG element",type:"Element"}]},finishCssAnimation:{meta:"function",description:"Finishes CSS animation if any, SVG element state updated according to the end animation values, removes CSS animation instance.",args:[{name:"element",description:"SVG element",type:"Element"}]},generateElementId:{meta:"function",description:"Generates new unique element id.",args:[],return:{type:"string",description:"Newly generated element id."}},formatValue:{meta:"function",description:"Formats numeric value according to specified decimals and units",args:[{name:"value",description:"Numeric value to be formatted",type:"any"},{name:"dec",description:"Number of decimal digits",type:"number",optional:!0},{name:"units",description:"Units to append to the formatted value",type:"string",optional:!0},{name:"showZeroDecimals",description:"Whether to keep zero decimal digits",type:"boolean",optional:!0}],return:{type:"string",description:"Formatted value"}},text:{meta:"function",description:'Set text to element(s). Only applicable for elements of type <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-text" target="_blank">SVG.Text</a> or <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-tspan" target="_blank">SVG.Tspan</a>.',args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"},{name:"text",description:"Text to be set",type:"string"}]},font:{meta:"function",description:'Set element(s) text font and color. Only applicable for elements of type <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-text" target="_blank">SVG.Text</a> or <a href="https://svgjs.dev/docs/3.2/shape-elements/#svg-tspan" target="_blank">SVG.Tspan</a>.',args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"},{name:"font",description:"Font settings object used to apply text element font",type:"Font"},{name:"color",description:"Color string used to apply text color of the element",type:"string"}]},icon:{meta:"function",description:'Draws icon inside element(s). Only applicable for elements of type <a href="https://svgjs.dev/docs/3.2/container-elements/#svg-g" target="_blank">SVG.G</a>.',args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"},{name:"icon",description:"Icon to draw",type:"string"},{name:"size",description:"Optional icon size in pixels. Default 12 pixels.",type:"number",optional:!0},{name:"color",description:"Optional icon color. Default #0000008A.",type:"string",optional:!0},{name:"center",description:"Whether to center icon inside group element. Default true.",type:"boolean",optional:!0}]},disable:{meta:"function",description:"Disables element(s). Disabled element doesn't accept any user interaction. For ex. if disabled element has click action, no click action will be performed on user click.",args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"}]},enable:{meta:"function",description:"Enables disabled element(s). Enabled element accepts user interaction. For ex. if element has click action, click action will be performed on user click.",args:[{name:"element",description:"SVG element or an array of SVG elements",type:"Element | Array&lt;Element&gt;"}]},callAction:{meta:"function",description:'Invokes action specified by behavior of type <b>"Action"</b> found by <b>behaviorId</b>.',args:[{name:"event",description:"DOM event",type:"Event"},{name:"behaviorId",description:'Id of the <b>"Action"</b> behavior',type:"string"},{name:"value",description:"Optional value passed to behavior",type:"any",optional:!0},{name:"observer",description:"Optional observer callback",type:"Partial&lt;Observer&lt;void&gt;&gt;",optional:!0}]},setValue:{meta:"function",description:"Updates value by <b>valueId</b>. See <code>ctx.values</code> for reference. Value update triggers all render functions.",args:[{name:"valueId",description:"Id of the value to be updated",type:"string"},{name:"value",description:"New value to be set",type:"any"}]}}},properties:l,values:u,tags:w,svg:{meta:"argument",type:'<a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>',description:'A root svg node. Instance of <a href="https://svgjs.dev/docs/3.2/container-elements/#svg-svg" target="_blank">SVG.Svg</a>.'}}}},s_=(i,m)=>({meta:"property",description:m.transform(i.name,i.name),type:l_(i.valueType)}),l_=i=>{switch(i){case Yi.STRING:return"string";case Yi.INTEGER:case Yi.DOUBLE:return"number";case Yi.BOOLEAN:return"boolean";case Yi.JSON:return"object"}};var p_=["scadaSymbolShape"],m_=["tooltipsContainer"],d_=["tooltipsContainerComponent"];function c_(i,m){if(i&1){let e=j();r(0,"div",13)(1,"button",14),d(2,"translate"),_("click",function(){I(e);let t=v();return M(t.toggleShowHidden())}),r(3,"mat-icon"),p(4),a()()()}if(i&2){let e=v();V("!hidden",e.editorMode!=="svg"),o(),T("matTooltip",c(2,4,e.showHiddenElements?"scada.hide-hidden-elements":"scada.show-hidden-elements")),o(3),O(e.showHiddenElements?"visibility_off":"visibility")}}var gl=(()=>{class i{get editorMode(){return this.editorModeValue}set editorMode(e){this.updateEditorMode(e)}constructor(e,n,t){this.cd=e,this.zone=n,this.destroyRef=t,this.updateScadaSymbol=new Dt,this.downloadScadaSymbol=new Dt,this.zoomInDisabled=!1,this.zoomOutDisabled=!1,this.showHiddenElements=!1,this.showHiddenElementsChange=new Dt,this.displayShowHidden=!1,this.svgContentFormControl=new ia,this.editorModeValue="svg"}ngOnInit(){this.readonly?this.svgContentFormControl.disable({emitEvent:!1}):this.svgContentFormControl.enable({emitEvent:!1}),this.svgContentFormControl.valueChanges.pipe(Ne(this.destroyRef)).subscribe(e=>{this.svgContent!==e&&(this.svgContent=e,this.editObjectCallbacks.onSymbolEditObjectDirty(!0)),this.editObjectCallbacks.onSymbolEditObjectValid(this.svgContentFormControl.valid)})}ngAfterViewInit(){this.editObjectCallbacks.onZoom=()=>{this.updateZoomButtonsState()},this.editObjectCallbacks.hasHiddenElements=e=>{this.displayShowHidden=e,e&&this.scadaSymbolEditObject.showHiddenElements(this.showHiddenElements),this.cd.markForCheck()},this.scadaSymbolEditObject=new fl(this.scadaSymbolShape.nativeElement,this.tooltipsContainer.nativeElement,this.tooltipsContainerComponent.viewContainerRef,this.zone,this.editObjectCallbacks,this.readonly),this.data&&this.updateContent(this.data.scadaSymbolContent)}ngOnChanges(e){for(let n of Object.keys(e)){let t=e[n];!t.firstChange&&t.currentValue!==t.previousValue&&(n==="data"?setTimeout(()=>{this.updateContent(this.data.scadaSymbolContent)}):n==="readonly"&&(this.scadaSymbolEditObject.setReadOnly(this.readonly),this.readonly?this.svgContentFormControl.disable({emitEvent:!1}):this.svgContentFormControl.enable({emitEvent:!1})))}}ngOnDestroy(){this.scadaSymbolEditObject.destroy()}getContent(){return this.editorMode==="svg"?this.scadaSymbolEditObject?.getContent():this.svgContent}getTags(){return this.editorMode==="svg"?this.scadaSymbolEditObject?.getTags():u0(this.svgContent)}zoomIn(){this.scadaSymbolEditObject.zoomIn()}zoomOut(){this.scadaSymbolEditObject.zoomOut()}toggleShowHidden(){this.showHiddenElements=!this.showHiddenElements,this.showHiddenElementsChange.emit(this.showHiddenElements),this.scadaSymbolEditObject.showHiddenElements(this.showHiddenElements)}updateEditorMode(e){this.editorModeValue=e,e==="xml"?(this.svgContent=this.scadaSymbolEditObject.getContent(),this.svgContentFormControl.setValue(this.svgContent,{emitEvent:!1})):this.updateEditObjectContent(this.svgContent)}updateContent(e){this.svgContent=g0(e),this.editorMode==="xml"?this.svgContentFormControl.setValue(this.svgContent,{emitEvent:!1}):this.updateEditObjectContent(this.svgContent)}updateEditObjectContent(e){this.scadaSymbolEditObject&&(this.displayShowHidden=!1,this.scadaSymbolEditObject.setContent(e),setTimeout(()=>{this.updateZoomButtonsState()}))}updateZoomButtonsState(){this.zoomInDisabled=this.scadaSymbolEditObject.zoomInDisabled(),this.zoomOutDisabled=this.scadaSymbolEditObject.zoomOutDisabled(),this.cd.markForCheck()}static{this.\u0275fac=function(n){return new(n||i)(g(Qe),g(Cr),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-scada-symbol-editor"]],viewQuery:function(n,t){if(n&1&&(Ie(p_,5),Ie(m_,5),Ie(d_,7)),n&2){let l;Me(l=we())&&(t.scadaSymbolShape=l.first),Me(l=we())&&(t.tooltipsContainer=l.first),Me(l=we())&&(t.tooltipsContainerComponent=l.first)}},inputs:{data:"data",editObjectCallbacks:"editObjectCallbacks",readonly:"readonly",showHiddenElements:"showHiddenElements"},outputs:{updateScadaSymbol:"updateScadaSymbol",downloadScadaSymbol:"downloadScadaSymbol",showHiddenElementsChange:"showHiddenElementsChange"},features:[Vo],decls:38,vars:32,consts:[["scadaSymbolShape",""],["tooltipsContainer",""],["tooltipsContainerComponent",""],[1,"tb-scada-symbol-editor-shape"],[1,"tb-scada-symbol-editor-tooltips"],[1,"tb-scada-symbol-editor-svg-xml"],["fillHeight","","noLabel","",3,"formControl"],[1,"tb-scada-symbol-editor-buttons"],[1,"tb-scada-symbol-editor-view-buttons"],[1,"tb-scada-symbol-editor-zoom-buttons","tb-primary-fill"],["mat-icon-button","","matTooltipPosition","above",3,"click","disabled","matTooltip"],["class","tb-primary-fill",3,"!hidden",4,"ngIf"],[1,"tb-scada-symbol-editor-right-buttons"],[1,"tb-primary-fill"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["appearance","fill","fillHeight","","extraPadding","","primaryBackground","",3,"ngModelChange","disabled","ngModel"],["value","svg"],["value","xml"]],template:function(n,t){if(n&1){let l=j();f(0,"div",3,0),r(2,"div",4,1),f(4,"tb-anchor",null,2),a(),r(6,"div",5),f(7,"tb-svg-xml",6),a(),r(8,"div",7)(9,"div",8)(10,"div",9)(11,"button",10),d(12,"translate"),_("click",function(){return I(l),M(t.zoomIn())}),r(13,"mat-icon"),p(14,"add"),a()(),r(15,"button",10),d(16,"translate"),_("click",function(){return I(l),M(t.zoomOut())}),r(17,"mat-icon"),p(18,"remove"),a()()(),b(19,c_,5,6,"div",11),a(),r(20,"div",12)(21,"div",13)(22,"button",14),d(23,"translate"),_("click",function(){return I(l),M(t.updateScadaSymbol.emit())}),r(24,"mat-icon"),p(25,"file_upload"),a()()(),r(26,"div",13)(27,"button",14),d(28,"translate"),_("click",function(){return I(l),M(t.downloadScadaSymbol.emit())}),r(29,"mat-icon"),p(30,"download"),a()()(),r(31,"tb-toggle-select",15),et("ngModelChange",function(y){return I(l),Ze(t.editorMode,y)||(t.editorMode=y),M(y)}),r(32,"tb-toggle-option",16),p(33),d(34,"translate"),a(),r(35,"tb-toggle-option",17),p(36),d(37,"translate"),a()()()()}n&2&&(V("!hidden",t.editorMode!=="svg"),o(2),V("!hidden",t.editorMode!=="svg"),o(4),V("!hidden",t.editorMode!=="xml"),o(),s("formControl",t.svgContentFormControl),o(3),V("!hidden",t.editorMode!=="svg"),o(),T("matTooltip",c(12,20,"scada.zoom-in")),s("disabled",t.zoomInDisabled),o(4),T("matTooltip",c(16,22,"scada.zoom-out")),s("disabled",t.zoomOutDisabled),o(4),s("ngIf",t.displayShowHidden),o(3),T("matTooltip",c(23,24,"scada.update-symbol")),o(5),T("matTooltip",c(28,26,"scada.download-symbol")),o(4),s("disabled",!t.readonly&&!t.svgContentFormControl.valid),Xe("ngModel",t.editorMode),o(2),O(c(34,28,"scada.mode-svg")),o(3),O(c(37,30,"scada.mode-xml")))},dependencies:[G,Mu,K0,Ee,ae,Pt,W,Ye,ii,Di,Pi,R],styles:[`@charset "UTF-8";.tb-scada-symbol-editor-shape{width:100%;height:100%;display:flex;align-items:center;justify-content:center}.tb-scada-symbol-editor-tooltips{position:absolute;inset:0;pointer-events:none}.tb-scada-symbol-editor-svg-xml{width:100%;height:100%;padding-top:88px}.tb-scada-symbol-editor-buttons{pointer-events:none;position:absolute;left:20px;top:20px;right:20px;display:flex;justify-content:space-between;align-items:flex-start}.tb-scada-symbol-editor-buttons .tb-primary-fill{background:#fff;border-radius:50%}.tb-scada-symbol-editor-buttons .tb-primary-fill:before{opacity:.1}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-view-buttons{display:flex;flex-direction:column;gap:8px;z-index:101}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-zoom-buttons{display:flex;flex-direction:column;z-index:101;background:#fff;border-radius:24px}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-zoom-buttons.tb-primary-fill{border-radius:24px}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-zoom-buttons.tb-primary-fill:before{opacity:.1}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-right-buttons{display:flex;flex-direction:row;gap:8px;z-index:101}.tb-scada-symbol-editor-buttons .tb-scada-symbol-editor-right-buttons tb-toggle-select{pointer-events:auto}.tooltipster-sidetip.scada-symbol{position:fixed}.tooltipster-sidetip.scada-symbol .tooltipster-box{-webkit-user-select:none;user-select:none;background:#0000008a;border:1px solid rgba(0,0,0,0);border-radius:8px;display:flex;align-items:center}.tooltipster-sidetip.scada-symbol .tooltipster-box .tooltipster-content{padding:4px 8px;font-size:12px;line-height:12px;font-weight:500;color:#fff}.tooltipster-sidetip.scada-symbol.tb-active .tooltipster-box{background:#fff;border:1px solid rgba(0,0,0,.38);box-shadow:0 0 10px 6px #0003}.tooltipster-sidetip.scada-symbol.tb-active .tooltipster-box .tooltipster-content{color:#000000c2}.tooltipster-sidetip.scada-symbol.tb-active .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-width:12px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-top .tooltipster-arrow{bottom:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-top-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-top-color:#fff;left:-2px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-bottom .tooltipster-arrow{top:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-bottom-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-bottom-color:#fff;left:-2px;top:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-left .tooltipster-arrow{right:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-left-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-left-color:#fff;top:-2px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-right .tooltipster-arrow{left:-1px}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-right-color:#00000061}.tooltipster-sidetip.scada-symbol.tb-active.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-right-color:#fff;top:-2px;left:-1px}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-box,.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-box{min-height:36px}.tooltipster-sidetip.scada-symbol.tooltipster-top .tooltipster-arrow{bottom:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-top-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-top .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-top-color:transparent}.tooltipster-sidetip.scada-symbol.tooltipster-bottom .tooltipster-arrow{top:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-bottom-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-bottom .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-bottom-color:transparent}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-arrow{right:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-left-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-left .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-left-color:transparent}.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-arrow{left:-2px}.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-border{border-right-color:#0000008a}.tooltipster-sidetip.scada-symbol.tooltipster-right .tooltipster-arrow .tooltipster-arrow-uncropped .tooltipster-arrow-background{border-right-color:transparent}
`],encapsulation:2})}}return i})();C();C();C();C();var f_=["tagFunctionComponent"];function g_(i,m){if(i&1){let e=j();r(0,"button",9),_("click",function(){I(e);let t=v();return M(t.applyTagFunction())}),p(1),d(2,"translate"),a()}if(i&2){let e=v();s("disabled",e.tagFunctionFormGroup.invalid||!e.tagFunctionFormGroup.dirty),o(),h(" ",c(2,2,"action.apply")," ")}}var hl=(()=>{class i{constructor(e,n){this.fb=e,this.widgetService=n,this.tagFunctionApplied=new Dt,this.functionScopeVariables=this.widgetService.getWidgetScopeVariables()}ngOnInit(){this.tagFunctionFormGroup=this.fb.group({tagFunction:[this.tagFunction,[]]}),this.disabled&&this.tagFunctionFormGroup.disable({emitEvent:!1}),this.tagFunctionType==="renderFunction"?(this.panelTitle="scada.state-render-function",this.tagFunctionArgs=["ctx","element"],this.highlightRules=dg,this.tagFunctionHelpId="scada/tag_state_render_fn"):this.tagFunctionType==="clickAction"&&(this.panelTitle="scada.tag.on-click-action",this.tagFunctionArgs=["ctx","element","event"],this.highlightRules=cg,this.tagFunctionHelpId="scada/tag_click_action_fn")}ngAfterViewInit(){this.tagFunctionComponent.focus()}cancel(){this.popover?.hide()}applyTagFunction(){let e=this.tagFunctionFormGroup.get("tagFunction").value;this.tagFunctionApplied.emit(e)}static{this.\u0275fac=function(n){return new(n||i)(g(de),g(si))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-scada-symbol-metadata-tag-function-panel"]],viewQuery:function(n,t){if(n&1&&Ie(f_,5),n&2){let l;Me(l=we())&&(t.tagFunctionComponent=l.first)}},inputs:{tagFunction:"tagFunction",tagFunctionType:"tagFunctionType",tag:"tag",completer:"completer",disabled:"disabled",popover:"popover"},outputs:{tagFunctionApplied:"tagFunctionApplied"},decls:17,vars:13,consts:[["tagFunctionComponent",""],[1,"tb-scada-symbol-metadata-tag-function-panel",3,"formGroup"],[1,"tb-scada-symbol-metadata-tag-function-title-container"],[1,"tb-scada-symbol-metadata-tag-function-title"],[1,"tb-scada-symbol-metadata-tag-function-panel-content"],["minHeight","300px","formControlName","tagFunction",3,"highlightRules","editorCompleter","functionArgs","helpId"],[1,"tb-scada-symbol-metadata-tag-function-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){if(n&1){let l=j();r(0,"div",1)(1,"div",2)(2,"mat-chip-set")(3,"mat-chip")(4,"span"),p(5),a()()(),r(6,"div",3),p(7),d(8,"translate"),a()(),r(9,"div",4),f(10,"tb-js-func",5,0),a(),r(12,"div",6)(13,"button",7),_("click",function(){return I(l),M(t.cancel())}),p(14),d(15,"translate"),a(),b(16,g_,3,4,"button",8),a()()}n&2&&(s("formGroup",t.tagFunctionFormGroup),o(5),h(" ",t.tag," "),o(2),O(c(8,9,t.panelTitle)),o(3),s("highlightRules",t.highlightRules)("editorCompleter",t.completer)("functionArgs",t.tagFunctionArgs)("helpId",t.tagFunctionHelpId),o(4),h(" ",c(15,11,t.disabled?"action.close":"action.cancel")," "),o(2),s("ngIf",!t.disabled))},dependencies:[G,ha,ee,oa,Wr,W,K,ie,se,R],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-tag-function-panel{width:800px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-scada-symbol-metadata-tag-function-panel{width:90vw}}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-title-container{display:flex;flex-direction:row;gap:16px;align-items:center}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-scada-symbol-metadata-tag-function-panel .tb-scada-symbol-metadata-tag-function-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2})}}return i})();var h_=["editStateRenderFunctionButton"],b_=["editClickActionButton"];function v_(i,m){if(i&1){let e=j();r(0,"button",8,0),_("click",function(){I(e);let t=v();return M(t.editTagStateRenderFunction())}),r(2,"mat-icon"),p(3),a(),r(4,"span"),p(5),d(6,"translate"),a()()}if(i&2){let e=v();o(3),O(e.disabled?"visibility":e.tagFormGroup.get("stateRenderFunction").value?"edit":"add"),o(2),O(c(6,2,e.disabled?"action.view":e.tagFormGroup.get("stateRenderFunction").value?"action.edit":"action.add"))}}function y_(i,m){if(i&1){let e=j();r(0,"button",8,1),_("click",function(){I(e);let t=v();return M(t.editClickAction())}),r(2,"mat-icon"),p(3),a(),r(4,"span"),p(5),d(6,"translate"),a()()}if(i&2){let e=v();o(3),O(e.disabled?"visibility":e.tagFormGroup.get("clickAction").value?"edit":"add"),o(2),O(c(6,2,e.disabled?"action.view":e.tagFormGroup.get("clickAction").value?"action.edit":"action.add"))}}var Ra=(()=>{class i{constructor(e,n,t,l){this.fb=e,this.popoverService=n,this.renderer=t,this.viewContainerRef=l,this.propagateChange=u=>{}}ngOnInit(){this.tagFormGroup=this.fb.group({tag:[null,[]],stateRenderFunction:[null,[]],clickAction:[null,[]]})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.tagFormGroup.disable({emitEvent:!1}):this.tagFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e;let n=e?.actions?.click?.actionFunction;this.tagFormGroup.patchValue({tag:e?.tag,stateRenderFunction:e?.stateRenderFunction,clickAction:n},{emitEvent:!1})}validate(e){return this.tagFormGroup.valid?null:{tag:{valid:!1}}}editTagStateRenderFunction(){this.openTagFunction("renderFunction",this.editStateRenderFunctionButton)}editClickAction(){this.openTagFunction("clickAction",this.editClickActionButton)}openTagFunction(e,n){let t=n._elementRef.nativeElement;if(t.scrollIntoView(),this.popoverService.hasPopover(t))this.popoverService.hidePopover(t);else{let l,u;e==="renderFunction"?(l=this.tagFormGroup.get("stateRenderFunction"),u=this.elementStateRenderFunctionCompleter):e==="clickAction"&&(l=this.tagFormGroup.get("clickAction"),u=this.clickActionFunctionCompleter);let y=this.popoverService.displayPopover({trigger:t,renderer:this.renderer,componentType:hl,hostView:this.viewContainerRef,preferredPlacement:["leftOnly","leftTopOnly","leftBottomOnly"],context:{tagFunction:l.value,tagFunctionType:e,tag:this.tagFormGroup.get("tag").value,completer:u,disabled:this.disabled},isModal:!0});y.tbComponentRef.instance.popover=y,y.tbComponentRef.instance.tagFunctionApplied.subscribe(w=>{y.hide(),l.patchValue(w,{emitEvent:!1}),this.updateModel()})}}updateModel(){let e=this.tagFormGroup.value;this.modelValue={tag:e.tag,stateRenderFunction:e.stateRenderFunction},e.clickAction?this.modelValue.actions={click:{actionFunction:e.clickAction}}:this.modelValue.actions=null,this.propagateChange(this.modelValue)}static{this.\u0275fac=function(n){return new(n||i)(g(de),g(Pn),g(vn),g(nn))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-scada-symbol-metadata-tag"]],viewQuery:function(n,t){if(n&1&&(Ie(h_,5),Ie(b_,5)),n&2){let l;Me(l=we())&&(t.editStateRenderFunctionButton=l.first),Me(l=we())&&(t.editClickActionButton=l.first)}},inputs:{disabled:"disabled",elementStateRenderFunctionCompleter:"elementStateRenderFunctionCompleter",clickActionFunctionCompleter:"clickActionFunctionCompleter"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}])],decls:10,vars:4,consts:[["editStateRenderFunctionButton",""],["editClickActionButton",""],[1,"tb-form-table-row","tb-scada-symbol-metadata-tag-row",3,"formGroup"],[1,"tb-tag-field"],[1,"tb-scada-symbol-metadata-tag-label"],[1,"tb-state-render-function-field"],["mat-button","","color","primary",3,"click",4,"ngIf"],[1,"tb-on-click-action-field"],["mat-button","","color","primary",3,"click"]],template:function(n,t){n&1&&(r(0,"div",2)(1,"div",3)(2,"mat-chip-set")(3,"mat-chip")(4,"span",4),p(5),a()()()(),r(6,"div",5),b(7,v_,7,4,"button",6),a(),r(8,"div",7),b(9,y_,7,4,"button",6),a()()),n&2&&(s("formGroup",t.tagFormGroup),o(5),h(" ",t.tagFormGroup.get("tag").value," "),o(2),s("ngIf",!t.disabled||t.tagFormGroup.get("stateRenderFunction").value),o(2),s("ngIf",!t.disabled||t.tagFormGroup.get("clickAction").value))},dependencies:[G,ee,ae,oa,Wr,K,ie,R],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-tag-row .tb-tag-field{flex:1 1 70%}.tb-scada-symbol-metadata-tag-row .tb-state-render-function-field,.tb-scada-symbol-metadata-tag-row .tb-on-click-action-field{flex:1 1 15%}.tb-scada-symbol-metadata-tag-row .tb-state-render-function-field,.tb-scada-symbol-metadata-tag-row .tb-on-click-action-field{display:flex;justify-content:flex-end}.tb-scada-symbol-metadata-tag-row .tb-state-render-function-field .mdc-button .mat-mdc-button-touch-target,.tb-scada-symbol-metadata-tag-row .tb-on-click-action-field .mdc-button .mat-mdc-button-touch-target{height:36px}
`],encapsulation:2})}}return i})();function C_(i,m){i&1&&f(0,"mat-divider")}function S_(i,m){if(i&1&&(r(0,"div"),f(1,"tb-scada-symbol-metadata-tag",10),b(2,C_,1,0,"mat-divider",11),a()),i&2){let e=m.$implicit,n=m.last,t=v(2);o(),s("elementStateRenderFunctionCompleter",t.elementStateRenderFunctionCompleter)("clickActionFunctionCompleter",t.clickActionFunctionCompleter)("formControl",e),o(),s("ngIf",!n)}}function T_(i,m){if(i&1&&(r(0,"div",8),b(1,S_,3,4,"div",9),a()),i&2){let e=v();o(),s("ngForOf",e.tagsFormArray().controls)("ngForTrackBy",e.trackByTag)}}function x_(i,m){i&1&&(r(0,"span",12),p(1),d(2,"translate"),a()),i&2&&(o(),O(c(2,1,"scada.tag.no-tags")))}var vg=i=>!i.stateRenderFunction&&!i.actions?.click?.actionFunction,bl=(()=>{class i{constructor(e,n){this.fb=e,this.destroyRef=n,this.styleDisplay="flex",this.styleOverflow="hidden",this.propagateChange=t=>{}}ngOnInit(){this.tagsFormGroup=this.fb.group({tags:this.fb.array([])});let e=this.setupTags();this.tagsFormGroup.setControl("tags",this.prepareTagsFormArray(e.tags),{emitEvent:!1}),this.tagsFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{let n=this.tagsFormGroup.get("tags").value;n&&(n=n.filter(t=>!vg(t))),this.modelValue=n,this.propagateChange(this.modelValue)})}ngOnChanges(e){for(let n of Object.keys(e)){let t=e[n];if(!t.firstChange&&t.currentValue!==t.previousValue&&["tags"].includes(n)){let l=this.setupTags(this.modelValue),u=this.prepareTagsFormArray(l.tags);l.emitEvent?setTimeout(()=>{this.tagsFormGroup.setControl("tags",u,{emitEvent:!0}),this.setDisabledState(this.disabled)}):(this.tagsFormGroup.setControl("tags",u,{emitEvent:!1}),this.setDisabledState(this.disabled))}}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.tagsFormGroup.disable({emitEvent:!1}):this.tagsFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e||[];let n=this.setupTags(this.modelValue);this.tagsFormGroup.setControl("tags",this.prepareTagsFormArray(n.tags),{emitEvent:!1}),this.setDisabledState(this.disabled)}validate(e){return this.tagsFormGroup.valid?null:{tags:{valid:!1}}}tagsFormArray(){return this.tagsFormGroup.get("tags")}trackByTag(e,n){return n}editTagStateRenderFunction(e){setTimeout(()=>{let t=this.tagsFormGroup.get("tags").value.findIndex(u=>u.tag===e);this.metadataTags.get(t)?.editTagStateRenderFunction()})}editTagClickAction(e){setTimeout(()=>{let t=this.tagsFormGroup.get("tags").value.findIndex(u=>u.tag===e);this.metadataTags.get(t)?.editClickAction()})}setupTags(e){e=(e||[]).filter(l=>!vg(l));let n=(this.tags||[]).sort().map(l=>({tag:l,stateRenderFunction:null,actions:null}));for(let l of e){let u=n.find(y=>y.tag===l.tag);u&&(u.stateRenderFunction=l.stateRenderFunction,l.actions?.click?.actionFunction&&(u.actions={click:{actionFunction:l.actions.click.actionFunction}}))}let t=!!e.find(l=>!n.find(u=>u.tag===l.tag));return{tags:n,emitEvent:t}}prepareTagsFormArray(e){let n=[];return e&&e.forEach(t=>{n.push(this.fb.control(t,[]))}),this.fb.array(n)}static{this.\u0275fac=function(n){return new(n||i)(g(de),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-scada-symbol-metadata-tags"]],viewQuery:function(n,t){if(n&1&&Ie(Ra,5),n&2){let l;Me(l=we())&&(t.metadataTags=l)}},hostVars:4,hostBindings:function(n,t){n&2&&Bi("display",t.styleDisplay)("overflow",t.styleOverflow)},inputs:{disabled:"disabled",tags:"tags",elementStateRenderFunctionCompleter:"elementStateRenderFunctionCompleter",clickActionFunctionCompleter:"clickActionFunctionCompleter"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}]),Vo],decls:12,vars:2,consts:[["noTags",""],[1,"tb-form-panel","tb-scada-symbol-metadata-tags"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","tb-tag-header"],["translate","",1,"tb-form-table-header-cell","tb-state-render-function-header"],["translate","",1,"tb-form-table-header-cell","tb-on-click-action-header"],["class","tb-form-table-body",4,"ngIf","ngIfElse"],[1,"tb-form-table-body"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex-1",3,"elementStateRenderFunctionCompleter","clickActionFunctionCompleter","formControl"],[4,"ngIf"],[1,"tb-prompt","flex","items-center","justify-center"]],template:function(n,t){if(n&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),p(4,"scada.tag.tag"),a(),r(5,"div",5),p(6,"scada.state-render-function"),a(),r(7,"div",6),p(8,"scada.tag.on-click-action"),a()(),b(9,T_,2,2,"div",7),a()(),b(10,x_,3,3,"ng-template",null,0,It)),n&2){let l=U(11);o(9),s("ngIf",t.tagsFormArray().controls.length)("ngIfElse",l)}},dependencies:[Te,G,mn,W,ii,J,Ra,R],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-tags{flex:1;margin:12px}.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-tag-header{flex:1 1 70%}.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-state-render-function-header,.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-on-click-action-header{flex:1 1 15%}.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-state-render-function-header,.tb-scada-symbol-metadata-tags .tb-form-table-header-cell.tb-on-click-action-header{display:flex;justify-content:flex-end}.tb-scada-symbol-metadata-tags .tb-form-table{overflow:hidden}.tb-scada-symbol-metadata-tags .tb-form-table-body{overflow:auto}.tb-scada-symbol-metadata-tags .tb-form-table-body tb-scada-symbol-metadata-tag{overflow:hidden}.tb-scada-symbol-metadata-tags .tb-form-table-body .mat-divider{margin-top:8px}
`],encapsulation:2})}}return i})();C();C();C();var I_=(i,m)=>[i,m];function M_(i,m){if(i&1&&(r(0,"mat-option",17),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.scadaSymbolBehaviorTypeTranslations.get(e))," ")}}function w_(i,m){if(i&1&&(r(0,"mat-select-trigger")(1,"div",20),f(2,"mat-icon",21),r(3,"span"),p(4),d(5,"translate"),a()()()),i&2){let e=v(2);o(2),T("svgIcon",e.valueTypesMap.get(e.behaviorFormGroup.get("valueType").value).icon),o(2),O(c(5,2,e.valueTypesMap.get(e.behaviorFormGroup.get("valueType").value).name))}}function D_(i,m){if(i&1&&(r(0,"mat-option",17),f(1,"mat-icon",22),r(2,"span"),p(3),d(4,"translate"),a()()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),T("svgIcon",n.valueTypesMap.get(e).icon),o(2),O(c(4,3,n.valueTypesMap.get(e).name))}}function P_(i,m){if(i&1&&(r(0,"div",3)(1,"div",4),p(2,"scada.behavior.value-type"),a(),r(3,"mat-form-field",18)(4,"mat-select",19),b(5,w_,6,4,"mat-select-trigger",13)(6,D_,5,5,"mat-option",11),a()()()),i&2){let e=v();o(5),s("ngIf",e.behaviorFormGroup.get("valueType").value),o(),s("ngForOf",e.valueTypes)}}function F_(i,m){i&1&&(Gt(0),r(1,"div",3)(2,"div",4),p(3,"scada.behavior.true-label"),a(),r(4,"mat-form-field",5),f(5,"input",24),d(6,"translate"),a()(),r(7,"div",3)(8,"div",4),p(9,"scada.behavior.false-label"),a(),r(10,"mat-form-field",5),f(11,"input",25),d(12,"translate"),a()(),r(13,"div",3)(14,"div",4),p(15,"scada.behavior.state-label"),a(),r(16,"mat-form-field",5),f(17,"input",26),d(18,"translate"),a()(),Ut()),i&2&&(o(5),T("placeholder",c(6,3,"widget-config.set")),o(6),T("placeholder",c(12,5,"widget-config.set")),o(6),T("placeholder",c(18,7,"widget-config.set")))}function A_(i,m){if(i&1&&(Gt(0),b(1,F_,19,9,"ng-container",13),r(2,"div",3)(3,"div",4),p(4,"scada.behavior.default-settings"),a(),f(5,"tb-get-value-action-settings",23),d(6,"customTranslate"),d(7,"customTranslate"),d(8,"customTranslate"),d(9,"customTranslate"),a(),Ut()),i&2){let e=v();o(),s("ngIf",e.behaviorFormGroup.get("valueType").value===e.ValueType.BOOLEAN),o(4),T("panelTitle",c(6,8,e.behaviorFormGroup.get("name").value)),s("valueType",e.behaviorFormGroup.get("valueType").value)("trueLabel",c(7,10,e.behaviorFormGroup.get("trueLabel").value))("falseLabel",c(8,12,e.behaviorFormGroup.get("falseLabel").value))("stateLabel",c(9,14,e.behaviorFormGroup.get("stateLabel").value))("aliasController",e.aliasController)("widgetType",e.widgetType.rpc)}}function N_(i,m){if(i&1&&(Gt(0),r(1,"div",3)(2,"div",4),p(3,"scada.behavior.default-settings"),a(),f(4,"tb-set-value-action-settings",27),d(5,"customTranslate"),a(),Ut()),i&2){let e=v();o(4),T("panelTitle",c(5,4,e.behaviorFormGroup.get("name").value)),s("valueType",e.behaviorFormGroup.get("valueType").value)("aliasController",e.aliasController)("widgetType",e.widgetType.rpc)}}function k_(i,m){if(i&1&&(Gt(0),r(1,"div",3)(2,"div",4),p(3,"scada.behavior.default-settings"),a(),f(4,"tb-widget-action-settings",28),d(5,"customTranslate"),a(),Ut()),i&2){let e=v();o(4),T("panelTitle",c(5,3,e.behaviorFormGroup.get("name").value)),s("callbacks",e.callbacks)("widgetType",e.widgetType.rpc)}}function O_(i,m){if(i&1){let e=j();r(0,"button",29),_("click",function(){I(e);let t=v();return M(t.applyBehaviorSettings())}),p(1),d(2,"translate"),a()}if(i&2){let e=v();s("disabled",e.behaviorFormGroup.invalid||!e.behaviorFormGroup.dirty),o(),h(" ",c(2,2,e.isAdd?"action.add":"action.apply")," ")}}var vl=(()=>{class i{constructor(e,n,t){this.fb=e,this.widgetService=n,this.destroyRef=t,this.widgetType=Si,this.ScadaSymbolBehaviorType=Ki,this.ValueType=Yi,this.ValueToDataType=Ka,this.scadaSymbolBehaviorTypes=ps,this.scadaSymbolBehaviorTypeTranslations=ms,this.valueTypes=Object.keys(Yi),this.valueTypesMap=Ec,this.isAdd=!1,this.behaviorSettingsApplied=new Dt,this.functionScopeVariables=this.widgetService.getWidgetScopeVariables()}ngOnInit(){this.panelTitle=this.isAdd?"scada.behavior.add-behavior":"scada.behavior.behavior-settings",this.behaviorFormGroup=this.fb.group({id:[this.behavior.id,[S.required]],name:[this.behavior.name,[S.required]],hint:[this.behavior.hint,[]],group:[this.behavior.group,[]],type:[this.behavior.type,[S.required]],valueType:[this.behavior.valueType,[S.required]],trueLabel:[this.behavior.trueLabel,[]],falseLabel:[this.behavior.falseLabel,[]],stateLabel:[this.behavior.stateLabel,[]],defaultGetValueSettings:[this.behavior.defaultGetValueSettings,[S.required]],defaultSetValueSettings:[this.behavior.defaultSetValueSettings,[S.required]],defaultWidgetActionSettings:[this.behavior.defaultWidgetActionSettings,[S.required]]}),this.disabled?this.behaviorFormGroup.disable({emitEvent:!1}):(lc(this.behaviorFormGroup.get("type").valueChanges,this.behaviorFormGroup.get("valueType").valueChanges).pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateValidators()}),this.updateValidators())}cancel(){this.popover?.hide()}applyBehaviorSettings(){let e=this.behaviorFormGroup.getRawValue();this.behaviorSettingsApplied.emit(e)}updateValidators(){let e=this.behaviorFormGroup.get("type").value,n=this.behaviorFormGroup.get("valueType").value,t=this.behaviorFormGroup.get("defaultGetValueSettings").value,l=this.behaviorFormGroup.get("defaultSetValueSettings").value,u=this.behaviorFormGroup.get("defaultWidgetActionSettings").value;switch(this.behaviorFormGroup.disable({emitEvent:!1}),this.behaviorFormGroup.get("id").enable({emitEvent:!1}),this.behaviorFormGroup.get("name").enable({emitEvent:!1}),this.behaviorFormGroup.get("type").enable({emitEvent:!1}),this.behaviorFormGroup.get("hint").enable({emitEvent:!1}),this.behaviorFormGroup.get("group").enable({emitEvent:!1}),e){case Ki.value:this.behaviorFormGroup.get("valueType").enable({emitEvent:!1}),this.behaviorFormGroup.get("defaultGetValueSettings").enable({emitEvent:!1}),n===Yi.BOOLEAN&&(this.behaviorFormGroup.get("trueLabel").enable({emitEvent:!1}),this.behaviorFormGroup.get("falseLabel").enable({emitEvent:!1}),this.behaviorFormGroup.get("stateLabel").enable({emitEvent:!1})),t||(t=Jo({},ds(n)),this.behaviorFormGroup.get("defaultGetValueSettings").patchValue(t,{emitEvent:!0})),l&&this.behaviorFormGroup.get("defaultSetValueSettings").patchValue(null,{emitEvent:!0}),u&&this.behaviorFormGroup.get("defaultWidgetActionSettings").patchValue(null,{emitEvent:!0});break;case Ki.action:this.behaviorFormGroup.get("valueType").enable({emitEvent:!1}),this.behaviorFormGroup.get("defaultSetValueSettings").enable({emitEvent:!1}),l||(l=Jo({},b0(n)),this.behaviorFormGroup.get("defaultSetValueSettings").patchValue(l,{emitEvent:!0})),t&&this.behaviorFormGroup.get("defaultGetValueSettings").patchValue(null,{emitEvent:!0}),u&&this.behaviorFormGroup.get("defaultWidgetActionSettings").patchValue(null,{emitEvent:!0});break;case Ki.widgetAction:this.behaviorFormGroup.get("defaultWidgetActionSettings").enable({emitEvent:!1}),u||(u=Jo({},v0),this.behaviorFormGroup.get("defaultWidgetActionSettings").patchValue(u,{emitEvent:!0})),t&&this.behaviorFormGroup.get("defaultGetValueSettings").patchValue(null,{emitEvent:!0}),l&&this.behaviorFormGroup.get("defaultSetValueSettings").patchValue(null,{emitEvent:!0});break}}static{this.\u0275fac=function(n){return new(n||i)(g(de),g(si),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-scada-symbol-behavior-panel"]],inputs:{isAdd:"isAdd",behavior:"behavior",aliasController:"aliasController",callbacks:"callbacks",disabled:"disabled",popover:"popover"},outputs:{behaviorSettingsApplied:"behaviorSettingsApplied"},decls:44,vars:28,consts:[[1,"tb-scada-symbol-behavior-settings-panel",3,"formGroup"],[1,"tb-scada-symbol-behavior-settings-title"],[1,"tb-scada-symbol-behavior-settings-panel-content"],[1,"tb-form-row"],["translate","",1,"fixed-title-width"],["appearance","outline","subscriptSizing","dynamic",1,"flex"],["required","","matInput","","formControlName","id",3,"placeholder"],["required","","matInput","","formControlName","name",3,"placeholder"],["matInput","","formControlName","hint",3,"placeholder"],["matInput","","formControlName","group",3,"placeholder"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],["class","tb-form-row",4,"ngIf"],[4,"ngIf"],[1,"tb-scada-symbol-behavior-settings-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],[3,"value"],["appearance","outline","subscriptSizing","dynamic",1,"tb-value-type","flex"],["formControlName","valueType"],[1,"tb-value-type-row"],[1,"tb-mat-18",3,"svgIcon"],[1,"tb-mat-20",3,"svgIcon"],["formControlName","defaultGetValueSettings",1,"flex-1",3,"panelTitle","valueType","trueLabel","falseLabel","stateLabel","aliasController","widgetType"],["matInput","","formControlName","trueLabel",3,"placeholder"],["matInput","","formControlName","falseLabel",3,"placeholder"],["matInput","","formControlName","stateLabel",3,"placeholder"],["formControlName","defaultSetValueSettings",1,"flex-1",3,"panelTitle","valueType","aliasController","widgetType"],["formControlName","defaultWidgetActionSettings",1,"flex-1",3,"panelTitle","callbacks","widgetType"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"div",1),p(2),d(3,"translate"),a(),r(4,"div",2)(5,"div",3)(6,"div",4),p(7,"scada.behavior.id"),a(),r(8,"mat-form-field",5),f(9,"input",6),d(10,"translate"),a()(),r(11,"div",3)(12,"div",4),p(13,"scada.behavior.name"),a(),r(14,"mat-form-field",5),f(15,"input",7),d(16,"translate"),a()(),r(17,"div",3)(18,"div",4),p(19,"scada.behavior.hint"),a(),r(20,"mat-form-field",5),f(21,"input",8),d(22,"translate"),a()(),r(23,"div",3)(24,"div",4),p(25,"scada.behavior.group-title"),a(),r(26,"mat-form-field",5),f(27,"input",9),d(28,"translate"),a()(),r(29,"div",3)(30,"div",4),p(31,"scada.behavior.type"),a(),r(32,"mat-form-field",5)(33,"mat-select",10),b(34,M_,3,4,"mat-option",11),a()()(),b(35,P_,7,2,"div",12)(36,A_,10,16,"ng-container",13)(37,N_,6,6,"ng-container",13)(38,k_,6,5,"ng-container",13),a(),r(39,"div",14)(40,"button",15),_("click",function(){return t.cancel()}),p(41),d(42,"translate"),a(),b(43,O_,3,4,"button",16),a()()),n&2&&(s("formGroup",t.behaviorFormGroup),o(2),O(c(3,13,t.panelTitle)),o(7),T("placeholder",c(10,15,"widget-config.set")),o(6),T("placeholder",c(16,17,"widget-config.set")),o(6),T("placeholder",c(22,19,"widget-config.set")),o(6),T("placeholder",c(28,21,"widget-config.set")),o(7),s("ngForOf",t.scadaSymbolBehaviorTypes),o(),s("ngIf",Sr(25,I_,t.ScadaSymbolBehaviorType.value,t.ScadaSymbolBehaviorType.action).includes(t.behaviorFormGroup.get("type").value)),o(),s("ngIf",t.behaviorFormGroup.get("type").value===t.ScadaSymbolBehaviorType.value),o(),s("ngIf",t.behaviorFormGroup.get("type").value===t.ScadaSymbolBehaviorType.action),o(),s("ngIf",t.behaviorFormGroup.get("type").value===t.ScadaSymbolBehaviorType.widgetAction),o(3),h(" ",c(42,23,t.disabled?"action.close":"action.cancel")," "),o(2),s("ngIf",!t.disabled))},dependencies:[Te,G,ee,ae,he,me,vt,hu,gt,ge,W,K,ue,ie,se,J,yf,_f,Cf,mi,R],styles:[`@charset "UTF-8";.tb-scada-symbol-behavior-settings-panel{width:540px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-scada-symbol-behavior-settings-panel{width:90vw}}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content .mat-mdc-form-field.tb-value-type .mat-mdc-form-field-infix{max-height:40px}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content .mat-mdc-form-field.tb-value-type mat-select-trigger .tb-value-type-row{display:flex;flex-direction:row;align-items:center;justify-content:flex-start;gap:10px}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-content .mat-mdc-form-field.tb-value-type mat-select-trigger .tb-value-type-row .mat-icon{color:#00000061;vertical-align:bottom}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-scada-symbol-behavior-settings-panel .tb-scada-symbol-behavior-settings-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2})}}return i})();var R_=["idInput"],B_=["editButton"];function V_(i,m){if(i&1&&(r(0,"mat-option",13),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.scadaSymbolBehaviorTypeTranslations.get(e))," ")}}function j_(i,m){if(i&1){let e=j();r(0,"button",11),d(1,"translate"),_("click",function(){I(e);let t=v();return M(t.behaviorRemoved.emit())}),r(2,"mat-icon"),p(3,"delete"),a()()}i&2&&T("matTooltip",c(1,1,"scada.behavior.remove-behavior"))}var mr=i=>{if(!i.id||!i.name||!i.type)return!1;switch(i.type){case Ki.value:if(!i.valueType||!i.defaultGetValueSettings)return!1;break;case Ki.action:if(!i.defaultSetValueSettings||i.defaultSetValueSettings.valueToData?.type===Ka.CONSTANT&&Ac(i.defaultSetValueSettings.valueToData?.constantValue)||i.defaultSetValueSettings.valueToData?.type===Ka.FUNCTION&&!Dc(i.defaultSetValueSettings.valueToData?.valueToDataFunction))return!1;break;case Ki.widgetAction:break}return!0},dr=(()=>{class i{constructor(e,n,t,l,u,y,w){this.fb=e,this.cd=n,this.popoverService=t,this.renderer=l,this.viewContainerRef=u,this.behaviorsComponent=y,this.destroyRef=w,this.scadaSymbolBehaviorTypes=ps,this.scadaSymbolBehaviorTypeTranslations=ms,this.behaviorRemoved=new Dt,this.propagateChange=x=>{}}ngOnInit(){this.behaviorRowFormGroup=this.fb.group({id:[null,[this.behaviorIdValidator()]],name:[null,[S.required]],type:[null,[S.required]]}),this.behaviorRowFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>this.updateModel()),this.behaviorRowFormGroup.get("type").valueChanges.pipe(Ne(this.destroyRef)).subscribe(e=>{this.onTypeChanged(e)})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.behaviorRowFormGroup.disable({emitEvent:!1}):this.behaviorRowFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e,this.behaviorRowFormGroup.patchValue({id:e?.id,name:e?.name,type:e?.type},{emitEvent:!1}),this.cd.markForCheck()}editBehavior(e,n,t=!1,l=()=>{}){e&&e.stopPropagation();let u=n._elementRef.nativeElement;if(this.popoverService.hasPopover(u))this.popoverService.hidePopover(u);else{let y=this.popoverService.displayPopover({trigger:u,renderer:this.renderer,componentType:vl,hostView:this.viewContainerRef,preferredPlacement:["leftOnly","leftTopOnly","leftBottomOnly"],context:{isAdd:t,disabled:this.disabled,aliasController:this.aliasController,callbacks:this.callbacks,behavior:Tt(this.modelValue)},isModal:!0});y.tbComponentRef.instance.popover=y,y.tbComponentRef.instance.behaviorSettingsApplied.subscribe(w=>{y.hide(),this.behaviorRowFormGroup.patchValue({id:w.id,name:w.name,type:w.type},{emitEvent:!1}),this.modelValue=w,this.propagateChange(this.modelValue)}),y.tbDestroy.subscribe(()=>{mr(this.modelValue)||l()})}}focus(){this.idInput.nativeElement.scrollIntoView(),this.idInput.nativeElement.focus()}onAdd(e){this.idInput.nativeElement.scrollIntoView(),this.editBehavior(null,this.editButton,!0,e)}validate(e){let n=this.behaviorRowFormGroup.get("id");if(n.hasError("behaviorIdNotUnique")&&n.updateValueAndValidity({onlySelf:!1,emitEvent:!1}),n.hasError("behaviorIdNotUnique"))return this.behaviorRowFormGroup.get("id").markAsTouched(),{behaviorIdNotUnique:!0};let t=_e(_e({},this.modelValue),this.behaviorRowFormGroup.value);return mr(t)?null:{behavior:!0}}behaviorIdValidator(){return e=>e.value?this.behaviorsComponent.behaviorIdUnique(e.value,this.index)?null:{behaviorIdNotUnique:!0}:{required:!0}}onTypeChanged(e){let n=Tt(this.modelValue);this.modelValue=Ii(_e({},this.modelValue),{type:e}),this.modelValue=y0(this.modelValue),mr(this.modelValue)||this.editBehavior(null,this.editButton,!1,()=>{this.modelValue=n,this.behaviorRowFormGroup.patchValue({type:n.type},{emitEvent:!0})})}updateModel(){let e=this.behaviorRowFormGroup.value;this.modelValue=_e(_e({},this.modelValue),e),this.propagateChange(this.modelValue)}static{this.\u0275fac=function(n){return new(n||i)(g(de),g(Qe),g(Pn),g(vn),g(nn),g(wo),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-scada-symbol-metadata-behavior-row"]],viewQuery:function(n,t){if(n&1&&(Ie(R_,5),Ie(B_,5)),n&2){let l;Me(l=we())&&(t.idInput=l.first),Me(l=we())&&(t.editButton=l.first)}},inputs:{disabled:"disabled",index:"index",aliasController:"aliasController",callbacks:"callbacks"},outputs:{behaviorRemoved:"behaviorRemoved"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}])],decls:18,vars:12,consts:[["idInput",""],["editButton",""],[1,"tb-form-table-row","tb-scada-symbol-metadata-behavior-row",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-id-field"],["required","","matInput","","formControlName","id",3,"placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-name-field"],["required","","matInput","","formControlName","name",3,"placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"tb-inline-field","tb-type-field","fixed-height"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],[1,"tb-form-table-row-cell-buttons"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],[3,"value"]],template:function(n,t){if(n&1){let l=j();r(0,"div",2)(1,"mat-form-field",3),f(2,"input",4,0),d(4,"translate"),a(),r(5,"mat-form-field",5),f(6,"input",6),d(7,"translate"),a(),r(8,"mat-form-field",7)(9,"mat-select",8),b(10,V_,3,4,"mat-option",9),a()(),r(11,"div",10)(12,"button",11,1),d(14,"translate"),_("click",function(y){I(l);let w=U(13);return M(t.editBehavior(y,w))}),r(15,"mat-icon"),p(16,"settings"),a()(),b(17,j_,4,3,"button",12),a()()}n&2&&(s("formGroup",t.behaviorRowFormGroup),o(2),T("placeholder",c(4,6,"widget-config.set")),o(4),T("placeholder",c(7,8,"widget-config.set")),o(4),s("ngForOf",t.scadaSymbolBehaviorTypes),o(2),T("matTooltip",c(14,10,"scada.behavior.behavior-settings")),o(5),s("ngIf",!t.disabled))},dependencies:[Te,G,Ee,ae,he,me,vt,gt,Pt,ge,W,K,ue,ie,se,R],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata-behavior-row .tb-id-field,.tb-scada-symbol-metadata-behavior-row .tb-name-field{flex:1 1 40%}.tb-scada-symbol-metadata-behavior-row .tb-type-field{flex:1 1 20%}
`],encapsulation:2})}}return i})();function L_(i,m){if(i&1&&(r(0,"button",17),d(1,"translate"),r(2,"mat-icon"),p(3,"drag_indicator"),a()()),i&2){let e=v(3);V("tb-hidden",!e.dragEnabled),T("matTooltip",c(1,3,"action.drag"))}}function G_(i,m){if(i&1){let e=j();r(0,"div",13)(1,"tb-scada-symbol-metadata-behavior-row",14),_("behaviorRemoved",function(){let t=I(e).index,l=v(2);return M(l.removeBehavior(t))}),a(),r(2,"div",15),b(3,L_,4,5,"button",16),a()()}if(i&2){let e=m.$implicit,n=m.index,t=v(2);V("tb-draggable",!t.disabled)("tb-draggable-form-table-row",!t.disabled),s("cdkDragDisabled",!t.dragEnabled),o(),s("index",n)("formControl",e)("aliasController",t.aliasController)("callbacks",t.callbacks),o(2),s("ngIf",!t.disabled)}}function U_(i,m){if(i&1){let e=j();r(0,"div",11),_("cdkDropListDropped",function(t){I(e);let l=v();return M(l.behaviorDrop(t))}),b(1,G_,4,10,"div",12),a()}if(i&2){let e=v();s("cdkDropListDisabled",!e.dragEnabled),o(),s("ngForOf",e.behaviorsFormArray().controls)("ngForTrackBy",e.trackByBehavior)}}function q_(i,m){if(i&1&&f(0,"tb-error",18),i&2){let e=v();s("error",e.errorText)}}function W_(i,m){if(i&1){let e=j();r(0,"div")(1,"button",19),_("click",function(){I(e);let t=v();return M(t.addBehavior())}),p(2),d(3,"translate"),a()()}i&2&&(o(2),h(" ",c(3,1,"scada.behavior.add-behavior")," "))}function H_(i,m){i&1&&(r(0,"span",20),p(1),d(2,"translate"),a()),i&2&&(o(),O(c(2,1,"scada.behavior.no-behaviors")))}var wo=(()=>{class i{get dragEnabled(){return!this.disabled&&this.behaviorsFormArray().controls.length>1}constructor(e,n,t){this.fb=e,this.translate=n,this.destroyRef=t,this.styleDisplay="flex",this.styleOverflow="hidden",this.errorText="",this.propagateChange=l=>{}}ngOnInit(){this.behaviorsFormGroup=this.fb.group({behaviors:this.fb.array([])}),this.behaviorsFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{let e=this.behaviorsFormGroup.get("behaviors").value;e&&(e=e.filter(n=>mr(n))),this.propagateChange(e)})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.behaviorsFormGroup.disable({emitEvent:!1}):this.behaviorsFormGroup.enable({emitEvent:!1})}writeValue(e){let n=e||[];this.behaviorsFormGroup.setControl("behaviors",this.prepareBehaviorsFormArray(n),{emitEvent:!1})}validate(e){this.errorText="";let t=this.behaviorsFormGroup.get("behaviors").controls.filter(u=>u.hasError("behaviorIdNotUnique"));for(let u of t)u.updateValueAndValidity({onlySelf:!1,emitEvent:!1}),u.hasError("behaviorIdNotUnique")&&(this.errorText=this.translate.instant("scada.behavior.not-unique-behavior-ids-error"));return this.behaviorsFormGroup.valid?null:{behaviors:{valid:!1}}}behaviorIdUnique(e,n){let t=this.behaviorsFormGroup.get("behaviors");for(let l=0;l<t.controls.length;l++)if(l!==n){let u=t.controls[l];if(e===u.value.id)return!1}return!0}behaviorDrop(e){let n=this.behaviorsFormGroup.get("behaviors"),t=n.at(e.previousIndex);n.removeAt(e.previousIndex,{emitEvent:!1}),n.insert(e.currentIndex,t,{emitEvent:!0})}behaviorsFormArray(){return this.behaviorsFormGroup.get("behaviors")}trackByBehavior(e,n){return n}removeBehavior(e,n=!0){this.behaviorsFormGroup.get("behaviors").removeAt(e,{emitEvent:n})}addBehavior(){let e={id:"",name:"",type:Ki.value,valueType:Yi.BOOLEAN,defaultGetValueSettings:Jo({},ds(Yi.BOOLEAN))},n=this.behaviorsFormGroup.get("behaviors"),t=this.fb.control(e,[]);n.push(t),setTimeout(()=>{this.behaviorRows.get(this.behaviorRows.length-1).onAdd(()=>{this.removeBehavior(n.length-1)})})}prepareBehaviorsFormArray(e){let n=[];return e&&e.forEach(t=>{n.push(this.fb.control(t,[]))}),this.fb.array(n)}static{this.\u0275fac=function(n){return new(n||i)(g(de),g(Z),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-scada-symbol-metadata-behaviors"]],viewQuery:function(n,t){if(n&1&&Ie(dr,5),n&2){let l;Me(l=we())&&(t.behaviorRows=l)}},hostVars:4,hostBindings:function(n,t){n&2&&Bi("display",t.styleDisplay)("overflow",t.styleOverflow)},inputs:{aliasController:"aliasController",callbacks:"callbacks",disabled:"disabled"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}])],decls:15,vars:8,consts:[["noBehaviors",""],[1,"tb-form-panel","tb-scada-symbol-behaviors"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","tb-id-header"],["translate","",1,"tb-form-table-header-cell","tb-name-header"],["translate","",1,"tb-form-table-header-cell","tb-type-header"],[1,"tb-form-table-header-cell","tb-actions-header"],["class","tb-form-table-body tb-drop-list","cdkDropList","","cdkDropListOrientation","vertical",3,"cdkDropListDisabled","cdkDropListDropped",4,"ngIf","ngIfElse"],["noMargin","","style","padding-left: 12px;",3,"error",4,"ngIf"],[4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-form-table-body","tb-drop-list",3,"cdkDropListDropped","cdkDropListDisabled"],["cdkDrag","",3,"cdkDragDisabled","tb-draggable","tb-draggable-form-table-row",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",3,"cdkDragDisabled"],[1,"flex-1",3,"behaviorRemoved","index","formControl","aliasController","callbacks"],[1,"tb-form-table-row-cell-buttons"],["mat-icon-button","","type","button","cdkDragHandle","","matTooltipPosition","above",3,"tb-hidden","matTooltip",4,"ngIf"],["mat-icon-button","","type","button","cdkDragHandle","","matTooltipPosition","above",3,"matTooltip"],["noMargin","",2,"padding-left","12px",3,"error"],["type","button","mat-stroked-button","","color","primary",3,"click"],[1,"tb-prompt","flex","items-center","justify-center"]],template:function(n,t){if(n&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),p(4,"scada.behavior.id"),a(),r(5,"div",5),p(6,"scada.behavior.name"),a(),r(7,"div",6),p(8,"scada.behavior.type"),a(),f(9,"div",7),a(),b(10,U_,2,3,"div",8)(11,q_,1,1,"tb-error",9),a(),b(12,W_,4,3,"div",10),a(),b(13,H_,3,3,"ng-template",null,0,It)),n&2){let l=U(14);o(2),V("no-padding-right",!t.disabled),o(7),V("disabled",t.disabled),o(),s("ngIf",t.behaviorsFormArray().controls.length)("ngIfElse",l),o(),s("ngIf",t.errorText),o(),s("ngIf",!t.disabled)}},styles:[`@charset "UTF-8";.tb-scada-symbol-behaviors{flex:1;margin:12px}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-id-header,.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-name-header{flex:1 1 40%}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-type-header{flex:1 1 20%}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-actions-header{width:120px;min-width:120px}.tb-scada-symbol-behaviors .tb-form-table-header-cell.tb-actions-header.disabled{width:40px;min-width:40px}.tb-scada-symbol-behaviors .tb-form-table{overflow:hidden}.tb-scada-symbol-behaviors .tb-form-table-body{overflow:auto}.tb-scada-symbol-behaviors .tb-form-table-body tb-scada-symbol-metadata-behavior-row{overflow:hidden}
`],encapsulation:2})}}return i})();var z_=["symbolMetadataTags"],$_=[[["",8,"tb-scada-symbol-metadata-header-prefix"]],[["",8,"tb-scada-symbol-metadata-header-suffix"]]],J_=[".tb-scada-symbol-metadata-header-prefix",".tb-scada-symbol-metadata-header-suffix"],Q_=()=>["ctx","svg"];function Y_(i,m){if(i&1&&f(0,"tb-js-func",28),i&2){let e=v();s("editorCompleter",e.generalStateRenderFunctionCompleter)("highlightRules",e.highlightRules)("functionArgs",Et(3,Q_))}}var cr=(()=>{class i extends Mt{constructor(e,n,t,l,u){super(e),this.store=e,this.fb=n,this.translate=t,this.customTranslate=l,this.destroyRef=u,this.propagateChange=null,this.headerOptions=[{name:this.translate.instant("scada.general"),value:"general"},{name:this.translate.instant("scada.tags"),value:"tags"},{name:this.translate.instant("scada.behavior.behavior"),value:"behavior"},{name:this.translate.instant("scada.properties"),value:"properties"}],this.selectedOption="general",this.highlightRules=mg}ngOnInit(){this.metadataFormGroup=this.fb.group({title:[null,[S.required]],description:[null],searchTags:[null],widgetSizeX:[null,[S.min(1),S.max(24),S.required]],widgetSizeY:[null,[S.min(1),S.max(24),S.required]],stateRenderFunction:[null],tags:[null],behavior:[null],properties:[null]}),this.updateFunctionCompleters(c0()),this.metadataFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}ngOnChanges(e){for(let n of Object.keys(e)){let t=e[n];!t.firstChange&&t.currentValue!==t.previousValue&&["tags"].includes(n)&&this.updateFunctionCompleters(this.modelValue)}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.metadataFormGroup.disable({emitEvent:!1}):this.metadataFormGroup.enable({emitEvent:!1})}writeValue(e){this.modelValue=e,this.metadataFormGroup.patchValue({title:e?.title,description:e?.description,searchTags:e?.searchTags,widgetSizeX:e?.widgetSizeX||3,widgetSizeY:e?.widgetSizeY||3,stateRenderFunction:e?.stateRenderFunction,tags:e?.tags,behavior:e?.behavior,properties:e?.properties},{emitEvent:!1}),this.updateFunctionCompleters(e)}editTagStateRenderFunction(e){this.selectedOption="tags",this.symbolMetadataTags.editTagStateRenderFunction(e)}editTagClickAction(e){this.selectedOption="tags",this.symbolMetadataTags.editTagClickAction(e)}validate(e){return this.metadataFormGroup.valid?null:{metadata:{valid:!1}}}updateModel(){let e=this.metadataFormGroup.getRawValue();this.modelValue=e,this.propagateChange(this.modelValue),this.updateFunctionCompleters(e)}updateFunctionCompleters(e){let n=gg(e,this.tags,this.customTranslate),t=ug(n);this.generalStateRenderFunctionCompleter?this.generalStateRenderFunctionCompleter.updateCompletions(t):this.generalStateRenderFunctionCompleter=new zo(t);let l=qd(n);this.elementStateRenderFunctionCompleter?this.elementStateRenderFunctionCompleter.updateCompletions(l):this.elementStateRenderFunctionCompleter=new zo(l);let u=fg(n);this.clickActionFunctionCompleter?this.clickActionFunctionCompleter.updateCompletions(u):this.clickActionFunctionCompleter=new zo(u)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(de),g(Z),g(mi),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-scada-symbol-metadata"]],viewQuery:function(n,t){if(n&1&&Ie(z_,5),n&2){let l;Me(l=we())&&(t.symbolMetadataTags=l.first)}},inputs:{aliasController:"aliasController",callbacks:"callbacks",disabled:"disabled",tags:"tags"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}]),L,Vo],ngContentSelectors:J_,decls:55,vars:41,consts:[["symbolMetadataTags",""],[1,"tb-scada-symbol-metadata","tb-absolute-fill"],[1,"tb-scada-symbol-metadata-header"],["appearance","fill",3,"ngModelChange","options","ngModel"],[1,"tb-scada-symbol-metadata-header-components"],[1,"tb-scada-symbol-metadata-content",3,"formGroup"],[1,"mat-content"],[1,"tb-form-panel"],[1,"tb-form-row"],["translate","",1,"fixed-title-width"],["appearance","outline","subscriptSizing","dynamic",1,"flex-1"],["matInput","","required","","formControlName","title",3,"placeholder"],["matInput","","formControlName","description","rows","2"],[1,"flex","flex-1","flex-row","items-center","justify-start"],["formControlName","searchTags","appearance","outline","subscriptSizing","dynamic",1,"flex-1",2,"display","flex"],[1,"flex","flex-1","flex-row","items-center","justify-end","gap-2"],[1,"tb-small-label"],["appearance","outline","subscriptSizing","dynamic",1,"number","flex"],["matInput","","formControlName","widgetSizeX","required","","type","number",3,"min","max","step","placeholder"],["matInput","","formControlName","widgetSizeY","required","","type","number",3,"min","max","step","placeholder"],[1,"tb-form-panel","stroked"],["expanded","",1,"tb-settings"],[1,"flex","flex-row","flex-wrap"],["matExpansionPanelContent",""],[1,"mat-content","overflow-hidden"],["formControlName","tags",3,"tags","clickActionFunctionCompleter","elementStateRenderFunctionCompleter"],["formControlName","behavior",3,"aliasController","callbacks"],["importExport","","formControlName","properties",3,"exportFileName"],["formControlName","stateRenderFunction","minHeight","300px","helpId","scada/symbol_state_render_fn",3,"editorCompleter","highlightRules","functionArgs"]],template:function(n,t){if(n&1){let l=j();Lo($_),r(0,"div",1)(1,"div",2)(2,"tb-toggle-select",3),et("ngModelChange",function(y){return I(l),Ze(t.selectedOption,y)||(t.selectedOption=y),M(y)}),a(),r(3,"div",4),Jn(4),Jn(5,1),a()(),r(6,"div",5)(7,"div",6)(8,"div",7)(9,"div",8)(10,"div",9),p(11,"scada.title"),a(),r(12,"mat-form-field",10),f(13,"input",11),d(14,"translate"),a()(),r(15,"div",8)(16,"div",9),p(17,"scada.description"),a(),r(18,"mat-form-field",10),f(19,"textarea",12),a()(),r(20,"div",8)(21,"div",9),p(22,"scada.search-tags"),a(),r(23,"div",13),f(24,"tb-string-items-list",14),a()(),r(25,"div",8)(26,"div",9),p(27,"scada.widget-size"),a(),r(28,"div",15)(29,"div",16),p(30),d(31,"translate"),a(),r(32,"mat-form-field",17),f(33,"input",18),d(34,"translate"),a(),r(35,"div",16),p(36),d(37,"translate"),a(),r(38,"mat-form-field",17),f(39,"input",19),d(40,"translate"),a()()(),r(41,"div",20)(42,"mat-expansion-panel",21)(43,"mat-expansion-panel-header",22)(44,"mat-panel-title"),p(45),d(46,"translate"),a()(),b(47,Y_,1,4,"ng-template",23),a()()()(),r(48,"div",24),f(49,"tb-scada-symbol-metadata-tags",25,0),a(),r(51,"div",24),f(52,"tb-scada-symbol-metadata-behaviors",26),a(),r(53,"div",24),f(54,"tb-dynamic-form-properties",27),a()()()}n&2&&(o(2),s("options",t.headerOptions),Xe("ngModel",t.selectedOption),o(4),s("formGroup",t.metadataFormGroup),o(),V("!hidden",t.selectedOption!=="general"),o(6),T("placeholder",c(14,29,"widget-config.set")),o(17),O(c(31,31,"scada.cols")),o(3),T("placeholder",c(34,33,"widget-config.set")),s("min",1)("max",24)("step",1),o(3),O(c(37,35,"scada.rows")),o(3),T("placeholder",c(40,37,"widget-config.set")),s("min",1)("max",24)("step",1),o(6),h(" ",c(46,39,"scada.state-render-function")," "),o(3),V("!hidden",t.selectedOption!=="tags"),o(),s("tags",t.tags)("clickActionFunctionCompleter",t.clickActionFunctionCompleter)("elementStateRenderFunctionCompleter",t.elementStateRenderFunctionCompleter),o(2),V("!hidden",t.selectedOption!=="behavior"),o(),s("aliasController",t.aliasController)("callbacks",t.callbacks),o(),V("!hidden",t.selectedOption!=="properties"),o(),s("exportFileName",((t.modelValue==null?null:t.modelValue.title)||"scada-symbol")+"-properties"))},dependencies:[cn,ha,he,me,Gi,rn,sn,eo,ge,Ui,W,K,ue,qi,ln,Ye,ie,se,J,Pi,Ts,bl,wo,R],styles:[`@charset "UTF-8";.tb-scada-symbol-metadata{display:flex;flex-direction:column;gap:8px}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-header{padding:24px 24px 0;display:flex;gap:12px;flex-direction:column-reverse;align-items:flex-start}@media screen and (min-width: 960px){.tb-scada-symbol-metadata .tb-scada-symbol-metadata-header{gap:0;flex-direction:row;align-items:center;justify-content:space-between}}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-header .tb-scada-symbol-metadata-header-components{width:100%;flex:1;display:flex;flex-direction:row;align-items:center;justify-content:space-between}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content{display:flex;flex:1;overflow:auto}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content>.mat-content{padding-top:8px}@media screen and (max-width: 599px){.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content>.mat-content{padding-left:8px;padding-right:8px}}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content>div{padding:16px}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .mat-content{display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 599px){.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .mat-content{gap:8px}}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .mat-content.overflow-hidden{overflow:hidden}.tb-scada-symbol-metadata .tb-scada-symbol-metadata-content .tb-form-panel .mat-expansion-panel.tb-settings>.mat-expansion-panel-header{font-weight:400}.tb-js-func .ace_tb.ace_scada-symbol-ctx{color:#c52f00}.tb-js-func .ace_tb.ace_scada-symbol-ctx-properties,.tb-js-func .ace_tb.ace_scada-symbol-ctx-property{color:#185f2a}.tb-js-func .ace_tb.ace_scada-symbol-ctx-values,.tb-js-func .ace_tb.ace_scada-symbol-ctx-value{color:#2caa00}.tb-js-func .ace_tb.ace_scada-symbol-ctx-tags,.tb-js-func .ace_tb.ace_scada-symbol-ctx-tag{color:#df8600}.tb-js-func .ace_tb.ace_scada-symbol-ctx-api,.tb-js-func .ace_tb.ace_scada-symbol-ctx-api-method{color:#7214d0}.tb-js-func .ace_tb.ace_scada-symbol-ctx-svg,.tb-js-func .ace_tb.ace_scada-symbol-ctx-svg-method{color:#c24c1a}.tb-js-func .ace_tb.ace_scada-symbol-ctx-property,.tb-js-func .ace_tb.ace_scada-symbol-ctx-value,.tb-js-func .ace_tb.ace_scada-symbol-ctx-tag,.tb-js-func .ace_tb.ace_scada-symbol-ctx-api-method{font-weight:700}.tb-js-func .ace_tb.ace_scada-symbol-svg,.tb-js-func .ace_tb.ace_scada-symbol-element,.tb-js-func .ace_tb.ace_scada-symbol-event{color:#c52f00}.tb-js-func .ace_tb.ace_scada-symbol-svg-properties,.tb-js-func .ace_tb.ace_scada-symbol-element-properties,.tb-js-func .ace_tb.ace_scada-symbol-event-properties{color:#7214d0;font-weight:700}
`],encapsulation:2})}}return i})();var Z_=["symbolEditor"],eC=["symbolMetadata"];function tC(i,m){if(i&1){let e=j();r(0,"div",22)(1,"div",23)(2,"button",24),_("click",function(){I(e);let t=v();return M(t.exitPreviewMode())}),r(3,"mat-icon"),p(4,"chevron_left"),a(),p(5),d(6,"translate"),a(),f(7,"span",25),r(8,"button",26),_("click",function(){I(e);let t=v();return M(t.onRevertPreviewSettings())}),r(9,"mat-icon"),p(10,"close"),a(),p(11),d(12,"translate"),a(),r(13,"button",27),_("click",function(){I(e);let t=v();return M(t.onApplyPreviewSettings())}),r(14,"mat-icon"),p(15,"done"),a(),p(16),d(17,"translate"),a()(),r(18,"div",28)(19,"div",29)(20,"div",30)(21,"div",31),p(22,"scada.symbol.symbol"),a(),f(23,"tb-scada-symbol-input",32),a(),f(24,"tb-scada-symbol-object-settings",33),a()()()}if(i&2){let e=v();o(5),h(" ",c(6,12,"action.back")," "),o(3),s("disabled",!e.scadaPreviewFormGroup.dirty),o(3),h(" ",c(12,14,"action.decline")," "),o(2),s("disabled",!e.scadaPreviewFormGroup.valid||!e.scadaPreviewFormGroup.dirty),o(3),h(" ",c(17,16,"action.apply")," "),o(2),s("formGroup",e.scadaPreviewFormGroup),o(5),s("scadaSymbolContent",e.symbolData.scadaSymbolContent)("scadaSymbolMetadata",e.previewMetadata),o(),s("scadaSymbolMetadata",e.previewMetadata)("aliasController",e.aliasController)("widgetType",e.widgetType.rpc)("callbacks",e.widgetActionCallbacks)}}function iC(i,m){if(i&1){let e=j();r(0,"div",34)(1,"button",26),_("click",function(){I(e);let t=v();return M(t.onRevertScadaSymbolConfig())}),r(2,"mat-icon"),p(3,"close"),a(),p(4),d(5,"translate"),a(),r(6,"button",27),_("click",function(){I(e);let t=v();return M(t.onApplyScadaSymbolConfig())}),r(7,"mat-icon"),p(8,"done"),a(),p(9),d(10,"translate"),a()()}if(i&2){let e=v();o(),s("disabled",!(e.scadaSymbolFormGroup.dirty||e.symbolEditorDirty)),o(3),h(" ",c(5,4,"action.decline")," "),o(2),s("disabled",!e.scadaSymbolFormGroup.valid||!e.symbolEditorValid||!(e.scadaSymbolFormGroup.dirty||e.symbolEditorDirty)),o(3),h(" ",c(10,6,"action.apply")," ")}}function nC(i,m){if(i&1){let e=j();r(0,"tb-scada-symbol-editor",35,1),et("showHiddenElementsChange",function(t){I(e);let l=v();return Ze(l.showHiddenElements,t)||(l.showHiddenElements=t),M(t)}),_("updateScadaSymbol",function(){I(e);let t=v();return M(t.updateScadaSymbol())})("downloadScadaSymbol",function(){I(e);let t=v();return M(t.downloadScadaSymbol())}),a()}if(i&2){let e=v();s("readonly",e.readonly),Xe("showHiddenElements",e.showHiddenElements),s("data",e.symbolEditorData)("editObjectCallbacks",e.editObjectCallbacks)}}function oC(i,m){if(i&1&&f(0,"tb-dashboard",36),i&2){let e=v();s("aliasController",e.aliasController)("widgets",e.previewWidgets)("autofillHeight",!1)("gridType",e.previewWidget.sizeX>=e.previewWidget.sizeY?e.GridType.ScrollVertical:e.GridType.ScrollHorizontal)("columns",e.previewWidget.sizeX)("centerVertical",e.previewWidget.sizeX>=e.previewWidget.sizeY)("centerHorizontal",e.previewWidget.sizeX<e.previewWidget.sizeY)("margin",0)("isEdit",!1)("isMobileDisabled",!0)("isEditActionEnabled",!1)("isRemoveActionEnabled",!1)}}var yl=(()=>{class i extends Mt{get isDirty(){return(this.scadaSymbolFormGroup.dirty||this.symbolEditorDirty)&&!this.forcePristine}set isDirty(e){this.forcePristine=!e}constructor(e,n,t,l,u,y,w,x,q,De){super(e),this.store=e,this.route=n,this.fb=t,this.cd=l,this.entityService=u,this.utils=y,this.translate=w,this.imageService=x,this.widgetService=q,this.dialog=De,this.widgetType=Si,this.GridType=Eu,this.width="100%",this.height="100%",this.previewMode=!1,this.destroy$=new At,this.updateBreadcrumbs=new Dt,this.widgetActionCallbacks={fetchDashboardStates:()=>[],fetchCellClickColumns:()=>[]},this.previewWidgets=[],this.editObjectCallbacks=this,this.symbolEditorDirty=!1,this.symbolEditorValid=!0,this.forcePristine=!1,this.authUser=kt(this.store),this.showHiddenElements=!1}ngOnInit(){this.scadaSymbolFormGroup=this.fb.group({metadata:[null]}),this.scadaPreviewFormGroup=this.fb.group({scadaSymbolObjectSettings:[null]});let e={},n={getStateParams:()=>({})},t={};this.aliasController=new bf(this.utils,this.entityService,this.translate,()=>n,e,t),this.route.data.pipe(lt(this.destroy$)).subscribe(()=>{this.reset(),this.init(this.route.snapshot.data.symbolData)})}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}onApplyScadaSymbolConfig(){if(this.scadaSymbolFormGroup.valid){if(this.symbolEditor.editorMode==="xml"){let n=this.symbolEditor.getTags();this.editObjectCallbacks.tagsUpdated(n)}let e=this.scadaSymbolFormGroup.get("metadata").value;try{let n=this.prepareScadaSymbolContent(e),t=kc(n,this.symbolData.imageResource.fileName,this.symbolData.imageResource.descriptor.mediaType),l=Mc(this.symbolData.imageResource),u=this.imageService.updateImage(l,this.symbolData.imageResource.resourceKey,t);e.title!==this.symbolData.imageResource.title&&(u=u.pipe(tn(y=>(y.title=e.title,this.imageService.updateImageInfo(y))))),u.pipe(tn(y=>this.imageService.getImageString(`${Ar}/${l}/${encodeURIComponent(y.resourceKey)}`).pipe(ze(w=>({imageResource:y,scadaSymbolContent:w}))))).subscribe(y=>{this.init(y),this.updateBreadcrumbs.emit()})}catch(n){this.store.dispatch(new Be({message:n.message,type:"error"}))}}}onRevertScadaSymbolConfig(){this.init(this.origSymbolData)}enterPreviewMode(){this.previewMetadata=this.scadaSymbolFormGroup.get("metadata").value;try{this.symbolData.scadaSymbolContent=this.prepareScadaSymbolContent(this.previewMetadata),this.previewScadaSymbolObjectSettings={behavior:{},properties:{}},this.scadaPreviewFormGroup.patchValue({scadaSymbolObjectSettings:this.previewScadaSymbolObjectSettings},{emitEvent:!1}),this.scadaPreviewFormGroup.markAsPristine();let e=Ii(_e({},vf),{simulated:!0,scadaSymbolUrl:null,scadaSymbolContent:this.symbolData.scadaSymbolContent,scadaSymbolObjectSettings:this.previewScadaSymbolObjectSettings,padding:"0",background:Xc("rgba(0,0,0,0)")});this.previewWidget={typeFullFqn:"system.scada_symbol",type:Si.rpc,sizeX:this.previewMetadata.widgetSizeX||3,sizeY:this.previewMetadata.widgetSizeY||3,row:0,col:0,config:{settings:e,showTitle:!1,dropShadow:!1,padding:"0",margin:"0",backgroundColor:"rgba(0,0,0,0)"}},this.previewWidgets=[this.previewWidget],this.previewMode=!0}catch(e){this.store.dispatch(new Be({message:e.message,type:"error"}))}}exitPreviewMode(){this.symbolEditorData={scadaSymbolContent:this.symbolData.scadaSymbolContent},this.previewMode=!1}onRevertPreviewSettings(){this.scadaPreviewFormGroup.patchValue({scadaSymbolObjectSettings:this.previewScadaSymbolObjectSettings},{emitEvent:!1}),this.scadaPreviewFormGroup.markAsPristine()}onApplyPreviewSettings(){this.scadaPreviewFormGroup.markAsPristine(),this.previewScadaSymbolObjectSettings=this.scadaPreviewFormGroup.get("scadaSymbolObjectSettings").value,this.updatePreviewWidgetSettings()}tagsUpdated(e){this.tags=e}tagHasStateRenderFunction(e){let n=this.scadaSymbolFormGroup.get("metadata").value;return n.tags?!!n.tags.find(l=>l.tag===e)?.stateRenderFunction:!1}tagHasClickAction(e){let n=this.scadaSymbolFormGroup.get("metadata").value;return n.tags?!!n.tags.find(l=>l.tag===e)?.actions?.click?.actionFunction:!1}editTagStateRenderFunction(e){this.symbolMetadata.editTagStateRenderFunction(e)}editTagClickAction(e){this.symbolMetadata.editTagClickAction(e)}onSymbolEditObjectDirty(e){this.symbolEditorDirty=e}onSymbolEditObjectValid(e){this.symbolEditorValid=e}updateScadaSymbol(){this.dialog.open(C0,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{imageSubType:this.symbolData.imageResource.resourceSubType,image:this.symbolData.imageResource}}).afterClosed().subscribe(e=>{e?.scadaSymbolContent&&(this.symbolData.scadaSymbolContent=e.scadaSymbolContent,this.symbolEditorData={scadaSymbolContent:this.symbolData.scadaSymbolContent},this.symbolEditorDirty=!0,this.symbolEditorValid=!0)})}downloadScadaSymbol(){let e;this.scadaSymbolFormGroup.valid?e=this.scadaSymbolFormGroup.get("metadata").value:e=fd(this.origSymbolData.scadaSymbolContent);let n=document.createElement("a");try{let t=this.prepareScadaSymbolContent(e),l=new Blob([t],{type:this.symbolData.imageResource.descriptor.mediaType}),u=URL.createObjectURL(l);n.setAttribute("href",u),n.setAttribute("download",this.symbolData.imageResource.fileName);let y=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});n.dispatchEvent(y)}catch(t){this.store.dispatch(new Be({message:t.message,type:"error"}))}}createWidget(){let e=this.scadaSymbolFormGroup.get("metadata").value;this.dialog.open(Aa,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{title:e.title,dialogTitle:"scada.create-widget-from-symbol",saveAsActionTitle:"action.create"}}).afterClosed().subscribe(n=>{n&&this.widgetService.getWidgetType("system.scada_symbol").subscribe(t=>{let l=wc+this.symbolData.imageResource.link,u=_e({image:l,description:e.description,tags:e.searchTags},t);u.fqn=void 0,u.id=void 0,u.name=n.widgetName;let y=u.descriptor;y.sizeX=e.widgetSizeX,y.sizeY=e.widgetSizeY;let w;typeof y.controllerScript=="string"?w=y.controllerScript:w=y.controllerScript.body,w=w.replace(/previewWidth: '\d*px'/gm,`previewWidth: '${e.widgetSizeX*100}px'`),w=w.replace(/previewHeight: '\d*px'/gm,`previewHeight: '${e.widgetSizeY*100+20}px'`),typeof y.controllerScript=="string"?y.controllerScript=w:y.controllerScript.body=w;let x=JSON.parse(y.defaultConfig);x.title=n.widgetName,x.settings=x.settings||{},x.settings.scadaSymbolUrl=l,y.defaultConfig=JSON.stringify(x),this.widgetService.saveWidgetType(u).subscribe(q=>{n.widgetBundleId&&this.widgetService.addWidgetFqnToWidgetBundle(n.widgetBundleId,q.fqn).subscribe()})})})}updatePreviewWidgetSettings(){this.previewWidget=Tt(this.previewWidget),this.previewWidget.config.settings.scadaSymbolObjectSettings=this.previewScadaSymbolObjectSettings,this.previewWidgets=[this.previewWidget]}prepareScadaSymbolContent(e){let n=this.symbolEditor.getContent();return f0(n,e)}reset(){this.symbolMetadata&&(this.symbolMetadata.selectedOption="general"),this.previewMode=!1}init(e){this.authUser.authority===E.TENANT_ADMIN?this.readonly=e.imageResource.tenantId.id===Ae:this.readonly=this.authUser.authority!==E.SYS_ADMIN,this.origSymbolData=e,this.symbolData=Tt(e),this.symbolEditorData={scadaSymbolContent:this.symbolData.scadaSymbolContent};let n=fd(this.symbolData.scadaSymbolContent);this.scadaSymbolFormGroup.patchValue({metadata:n},{emitEvent:!1}),this.readonly?this.scadaSymbolFormGroup.disable({emitEvent:!1}):this.scadaSymbolFormGroup.enable({emitEvent:!1}),this.scadaSymbolFormGroup.markAsPristine(),this.symbolEditorDirty=!1,this.symbolEditorValid=!0,this.cd.markForCheck()}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Vi),g(de),g(Qe),g(a0),g(Gr),g(Z),g(ls),g(si),g(je))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-scada-symbol"]],viewQuery:function(n,t){if(n&1&&(Ie(Z_,5),Ie(eC,5)),n&2){let l;Me(l=we())&&(t.symbolEditor=l.first),Me(l=we())&&(t.symbolMetadata=l.first)}},hostVars:4,hostBindings:function(n,t){n&2&&Bi("width",t.width)("height",t.height)},features:[L],decls:31,vars:27,consts:[["symbolMetadata",""],["symbolEditor",""],[1,"tb-scada-symbol-editor","mat-content","flex","flex-col"],[1,"tb-scada-symbol-editor-container","flex","flex-1","flex-col"],[1,"tb-scada-symbol-editor-layout","flex","flex-1","flex-row"],[1,"size-full"],["disableClose","true","mode","side","opened","","position","end",1,"tb-scada-symbol-editor-details-drawer","mat-elevation-z4"],["headerHeightPx","64",1,"flex-1",3,"isReadOnly","showCloseDetails","headerTitle"],[1,"details-buttons","flex","flex-row","items-center","justify-start","gap-4"],["tb-help","scadaSymbolDev"],["mat-stroked-button","",3,"click","disabled"],["class","tb-scada-symbol-editor-preview-content tb-absolute-fill",4,"ngIf"],[3,"formGroup"],["formControlName","metadata",3,"tags","aliasController","callbacks"],[1,"tb-scada-symbol-metadata-header-prefix"],["mat-button","","color","primary",1,"gt-sm:!hidden",3,"click","disabled"],[1,"tb-scada-symbol-metadata-header-suffix","flex","flex-row","items-center","justify-end","gap-3","lt-md:flex-1"],["mat-button","","color","primary",1,"lt-md:!hidden",3,"click","disabled"],["class","flex flex-row items-center justify-start gap-3",4,"ngIf"],[1,"tb-scada-symbol-editor-content"],[3,"readonly","showHiddenElements","data","editObjectCallbacks","showHiddenElementsChange","updateScadaSymbol","downloadScadaSymbol",4,"ngIf"],["class","tb-absolute-fill","displayGrid","always","setGridSize","",3,"aliasController","widgets","autofillHeight","gridType","columns","centerVertical","centerHorizontal","margin","isEdit","isMobileDisabled","isEditActionEnabled","isRemoveActionEnabled",4,"ngIf"],[1,"tb-scada-symbol-editor-preview-content","tb-absolute-fill"],[1,"tb-scada-symbol-editor-preview-header"],["mat-button","",3,"click"],[2,"flex","1"],["mat-stroked-button","","color","primary",3,"click","disabled"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"tb-scada-symbol-editor-preview-settings",3,"formGroup"],[1,"mat-content"],[1,"tb-form-panel"],["translate","",1,"tb-form-panel-title"],[3,"scadaSymbolContent","scadaSymbolMetadata"],["formControlName","scadaSymbolObjectSettings",3,"scadaSymbolMetadata","aliasController","widgetType","callbacks"],[1,"flex","flex-row","items-center","justify-start","gap-3"],[3,"showHiddenElementsChange","updateScadaSymbol","downloadScadaSymbol","readonly","showHiddenElements","data","editObjectCallbacks"],["displayGrid","always","setGridSize","",1,"tb-absolute-fill",3,"aliasController","widgets","autofillHeight","gridType","columns","centerVertical","centerHorizontal","margin","isEdit","isMobileDisabled","isEditActionEnabled","isRemoveActionEnabled"]],template:function(n,t){if(n&1){let l=j();r(0,"div",2)(1,"section",3)(2,"div",4)(3,"mat-drawer-container",5)(4,"mat-drawer",6)(5,"tb-details-panel",7)(6,"div",8),f(7,"div",9),r(8,"button",10),_("click",function(){return I(l),M(t.createWidget())}),p(9),d(10,"translate"),a()(),b(11,tC,25,18,"div",11),r(12,"div",12)(13,"tb-scada-symbol-metadata",13,0)(15,"div",14)(16,"button",15),_("click",function(){return I(l),M(t.enterPreviewMode())}),r(17,"mat-icon"),p(18,"visibility"),a(),p(19),d(20,"translate"),a()(),r(21,"div",16)(22,"button",17),_("click",function(){return I(l),M(t.enterPreviewMode())}),r(23,"mat-icon"),p(24,"visibility"),a(),p(25),d(26,"translate"),a(),b(27,iC,11,8,"div",18),a()()()()(),r(28,"mat-drawer-content",19),b(29,nC,2,4,"tb-scada-symbol-editor",20)(30,oC,1,12,"tb-dashboard",21),a()()()()()}n&2&&(o(5),T("headerTitle",t.symbolData==null||t.symbolData.imageResource==null?null:t.symbolData.imageResource.title),s("isReadOnly",!0)("showCloseDetails",!1),o(3),s("disabled",t.scadaSymbolFormGroup.invalid),o(),h(" ",c(10,21,"scada.create-widget")," "),o(2),s("ngIf",t.previewMode),o(),V("!hidden",t.previewMode),s("formGroup",t.scadaSymbolFormGroup),o(),s("tags",t.tags)("aliasController",t.aliasController)("callbacks",t.widgetActionCallbacks),o(3),s("disabled",t.scadaSymbolFormGroup.invalid||!t.symbolEditorValid),o(3),h(" ",c(20,23,"scada.preview")," "),o(3),s("disabled",t.scadaSymbolFormGroup.invalid||!t.symbolEditorValid),o(3),h(" ",c(26,25,"scada.preview")," "),o(2),s("ngIf",!t.readonly),o(),V("preview",t.previewMode),o(),s("ngIf",!t.previewMode),o(),s("ngIf",t.previewMode))},dependencies:[G,wt,ee,ae,_u,Cu,yu,W,K,ie,se,J,Y0,af,wf,cr,Df,gl,R],styles:[`@charset "UTF-8";.tb-scada-symbol-editor{width:100%;height:100%}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer{width:50%}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content{display:flex;flex-direction:column;gap:8px}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-header{padding:24px 24px 0;display:flex;gap:12px;flex-direction:row;align-items:center;justify-content:space-between}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings{flex:1;overflow:auto}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings>.mat-content{padding-top:8px}@media screen and (max-width: 599px){.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings>.mat-content{padding-left:8px;padding-right:8px}}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings>div{padding:16px}.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings .mat-content{display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 599px){.tb-scada-symbol-editor .tb-scada-symbol-editor-details-drawer .tb-scada-symbol-editor-preview-content .tb-scada-symbol-editor-preview-settings .mat-content{gap:8px}}.tb-scada-symbol-editor .tb-scada-symbol-editor-content{flex:1;min-width:0;min-height:0;width:50%;max-width:50%;background:#fff}.tb-scada-symbol-editor .tb-scada-symbol-editor-content.preview #gridster-parent #gridster-background{background-color:#eee}
`],encapsulation:2})}}return i})();C();C();function aC(i,m){if(i&1&&(r(0,"mat-option",5),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.resourceSubTypesTranslationMap.get(e))," ")}}var _l=(()=>{class i extends oi{constructor(e){super(e),this.store=e,this.jsResourceSubTypes=[gi.EXTENSION,gi.MODULE],this.resourceSubTypesTranslationMap=Ho}jsResourceSubTypeChanged(e){this.entitiesTableConfig.componentsData.resourceSubType=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-js-library-table-header"]],features:[L],decls:9,vars:8,consts:[["subscriptSizing","dynamic",1,"mat-block"],["translate",""],[3,"ngModelChange","ngModel","placeholder"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,t){n&1&&(r(0,"mat-form-field",0)(1,"mat-label",1),p(2,"javascript.javascript-type"),a(),r(3,"mat-select",2),d(4,"translate"),_("ngModelChange",function(u){return t.jsResourceSubTypeChanged(u)}),r(5,"mat-option",3),p(6),d(7,"translate"),a(),b(8,aC,3,4,"mat-option",4),a()()),n&2&&(o(3),T("placeholder",c(4,4,"javascript.javascript-type")),s("ngModel",t.entitiesTableConfig.componentsData.resourceSubType),o(3),h(" ",c(7,6,"javascript.all-types")," "),o(2),s("ngForOf",t.jsResourceSubTypes))},dependencies:[Te,me,Ce,vt,gt,W,Ye,J,R],encapsulation:2})}}return i})();C();var rC=()=>({width:"1000px"}),sC=()=>({standalone:!0});function lC(i,m){if(i&1&&(r(0,"mat-option",17),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.ResourceSubTypeTranslationMap.get(e))," ")}}function pC(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"resource.title-required")," "))}function mC(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"resource.title-max-length")," "))}function dC(i,m){if(i&1){let e=j();r(0,"tb-file-input",18),d(1,"translate"),d(2,"translate"),_("fileNameChanged",function(t){I(e);let l=v();return M(l.entityForm==null?null:l.entityForm.get("fileName").patchValue(t))}),a()}if(i&2){let e,n=v();T("label",c(1,9,"javascript.resource-file")),T("dropLabel",c(2,11,"javascript.drop-resource-file-or")),s("required",n.isAdd)("readAsBinary",!0)("maxSizeByte",n.maxResourceSize)("allowedExtensions",n.getAllowedExtensions())("contentConvertFunction",n.convertToBase64File)("accept",n.getAcceptType())("existingFileName",(e=n.entityForm.get("fileName"))==null?null:e.value)}}function cC(i,m){if(i&1){let e=j();r(0,"tb-file-input",23),d(1,"translate"),_("ngModelChange",function(t){I(e);let l=v(2);return M(l.uploadContentFromFile(t))})("fileNameChanged",function(t){I(e);let l=v(2);return M(l.entityForm==null?null:l.entityForm.get("fileName").patchValue(t))}),a()}if(i&2){let e=v(2);T("uploadButtonText",c(1,5,"javascript.upload-from-file")),s("maxSizeByte",e.maxResourceSize)("allowedExtensions",e.getAllowedExtensions())("accept",e.getAcceptType())("ngModelOptions",Et(7,sC))}}function uC(i,m){if(i&1&&(r(0,"tb-js-func",19)(1,"div",20)(2,"label",21),p(3),d(4,"translate"),a(),b(5,cC,2,8,"tb-file-input",22),a()()),i&2){let e=v();s("helpPopupStyle",Et(7,rC)),o(2),V("tb-error",e.entityForm.get("content").invalid&&e.entityForm.get("content").touched),o(),h(" ",c(4,5,"javascript.module-script"),""),o(2),s("ngIf",e.isAdd||e.isEdit)}}function fC(i,m){i&1&&(r(0,"div",24)(1,"mat-form-field",25)(2,"mat-label",5),p(3,"resource.file-name"),a(),f(4,"input",26),a()())}var Cl=(()=>{class i extends Bt{constructor(e,n,t,l,u,y){super(e,u,t,l,y),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.fb=u,this.cd=y,this.ResourceSubType=gi,this.jsResourceSubTypes=[gi.EXTENSION,gi.MODULE],this.ResourceSubTypeTranslationMap=Ho,this.maxResourceSize=Li(this.store).maxResourceSize,this.destroy$=new At}ngOnInit(){super.ngOnInit(),this.isAdd&&this.observeResourceSubTypeChange()}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){return this.fb.group({title:[e?e.title:"",[S.required,S.maxLength(255)]],resourceSubType:[e?.resourceSubType?e.resourceSubType:gi.EXTENSION,S.required],fileName:[e?e.fileName:null,S.required],data:[e?e.data:null,this.isAdd?[S.required]:[]],content:[e?.data?.length?window.atob(e.data):"",S.required]})}updateForm(e){this.entityForm.patchValue(e);let n=e.resourceSubType===gi.MODULE&&e?.data?.length?window.atob(e.data):"";this.entityForm.get("content").patchValue(n)}updateFormState(){super.updateFormState(),this.isEdit&&this.entityForm&&!this.isAdd&&(this.entityForm.get("resourceSubType").disable({emitEvent:!1}),this.updateResourceSubTypeFieldsState(this.entityForm.get("resourceSubType").value))}prepareFormValue(e){return this.isEdit&&!Oe(e.data)&&delete e.data,e.resourceSubType===gi.MODULE&&(e.fileName||(e.fileName=e.title+".js"),e.data=window.btoa(e.content),delete e.content),super.prepareFormValue(e)}getAllowedExtensions(){return Fr.get(fi.JS_MODULE)}getAcceptType(){return Pr.get(fi.JS_MODULE)}convertToBase64File(e){return window.btoa(e)}onResourceIdCopied(){this.store.dispatch(new Be({message:this.translate.instant("resource.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}uploadContentFromFile(e){this.entityForm.get("content").patchValue(e),this.entityForm.markAsDirty()}observeResourceSubTypeChange(){this.entityForm.get("resourceSubType").valueChanges.pipe(ho(gi.EXTENSION),lt(this.destroy$)).subscribe(e=>this.onResourceSubTypeChange(e))}onResourceSubTypeChange(e){this.updateResourceSubTypeFieldsState(e),this.entityForm.patchValue({data:null,fileName:null},{emitEvent:!1})}updateResourceSubTypeFieldsState(e){e===gi.EXTENSION?(this.entityForm.get("data").enable({emitEvent:!1}),this.entityForm.get("fileName").enable({emitEvent:!1}),this.entityForm.get("content").disable({emitEvent:!1})):(this.entityForm.get("data").disable({emitEvent:!1}),this.entityForm.get("fileName").disable({emitEvent:!1}),this.entityForm.get("content").enable({emitEvent:!1}))}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g("entity"),g("entitiesTableConfig"),g(dt),g(Qe))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-js-resource"]],features:[L],decls:36,vars:37,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["formControlName","resourceSubType","required",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formControlName","data",3,"required","label","readAsBinary","maxSizeByte","allowedExtensions","contentConvertFunction","accept","dropLabel","existingFileName","fileNameChanged",4,"ngIf"],["helpId","resource/js-resource-module_fn","formControlName","content","required","","hideBrackets","","hideLabel","","minHeight","300px",3,"helpPopupStyle",4,"ngIf"],["class","flex flex-row xs:flex-col sm:gap-2 md:flex-col gt-md:gap-2",4,"ngIf"],[3,"value"],["formControlName","data",3,"fileNameChanged","required","label","readAsBinary","maxSizeByte","allowedExtensions","contentConvertFunction","accept","dropLabel","existingFileName"],["helpId","resource/js-resource-module_fn","formControlName","content","required","","hideBrackets","","hideLabel","","minHeight","300px",3,"helpPopupStyle"],["toolbarStartButton","",1,"flex","flex-row","gap-4"],[1,"tb-title","no-padding","tb-required",2,"font-size","16px"],["asButton","","uploadButtonClass","tb-ignore-browse-file-button-style",3,"uploadButtonText","maxSizeByte","allowedExtensions","accept","ngModel","ngModelOptions","ngModelChange","fileNameChanged",4,"ngIf"],["asButton","","uploadButtonClass","tb-ignore-browse-file-button-style",3,"ngModelChange","fileNameChanged","uploadButtonText","maxSizeByte","allowedExtensions","accept","ngModel","ngModelOptions"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-md:gap-2"],[1,"flex-1"],["matInput","","formControlName","fileName","type","text"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"button",1),d(2,"async"),_("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),a(),r(5,"button",1),d(6,"async"),_("click",function(u){return t.onEntityAction(u,"downloadResource")}),p(7),d(8,"translate"),a(),r(9,"button",1),d(10,"async"),_("click",function(u){return t.onEntityAction(u,"deleteLibrary")}),p(11),d(12,"translate"),a(),r(13,"div",2)(14,"button",3),_("cbOnSuccess",function(){return t.onResourceIdCopied()}),f(15,"mat-icon",4),r(16,"span",5),p(17,"resource.copyId"),a()()()(),r(18,"div",6)(19,"form",7)(20,"fieldset",8),d(21,"async"),r(22,"mat-form-field",9)(23,"mat-label",5),p(24,"javascript.javascript-type"),a(),r(25,"mat-select",10),b(26,lC,3,4,"mat-option",11),a()(),r(27,"mat-form-field",9)(28,"mat-label",5),p(29,"resource.title"),a(),f(30,"input",12),b(31,pC,3,3,"mat-error",13)(32,mC,3,3,"mat-error",13),a(),b(33,dC,3,13,"tb-file-input",14)(34,uC,6,8,"tb-js-func",15)(35,fC,5,0,"div",16),a()()()),n&2&&(o(),V("!hidden",t.isEdit||t.isDetailsPage),s("disabled",c(2,23,t.isLoading$)),o(2),h(" ",c(4,25,"common.open-details-page")," "),o(2),V("!hidden",t.isEdit),s("disabled",c(6,27,t.isLoading$)),o(2),h(" ",c(8,29,"javascript.download")," "),o(2),V("!hidden",t.hideDelete()||t.isEdit),s("disabled",c(10,31,t.isLoading$)),o(2),h(" ",c(12,33,"javascript.delete")," "),o(3),V("!hidden",t.isEdit),s("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),s("formGroup",t.entityForm),o(),s("disabled",c(21,35,t.isLoading$)||!t.isEdit),o(6),s("ngForOf",t.jsResourceSubTypes),o(5),s("ngIf",t.entityForm.get("title").hasError("required")),o(),s("ngIf",t.entityForm.get("title").hasError("maxlength")),o(),s("ngIf",(t.isAdd||t.isEdit)&&t.entityForm.get("resourceSubType").value===t.ResourceSubType.EXTENSION),o(),s("ngIf",t.entityForm.get("resourceSubType").value===t.ResourceSubType.MODULE),o(),s("ngIf",!t.isAdd&&!t.isEdit&&t.entityForm.get("resourceSubType").value===t.ResourceSubType.EXTENSION))},dependencies:[Te,G,ha,ee,ae,he,me,Ce,Pe,vt,gt,Jt,ce,ge,W,K,ue,Ye,ie,se,oo,J,le,R],encapsulation:2})}}return i})();C();function gC(i,m){if(i&1&&(r(0,"mat-tab",3,0),d(2,"translate"),f(3,"tb-audit-log-table",4),a()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),s("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function hC(i,m){if(i&1){let e=j();r(0,"mat-tab",3,1),d(2,"translate"),r(3,"tb-version-control",5),_("versionRestored",function(){I(e);let t=v();return M(t.entitiesTableConfig.updateData())}),a()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),s("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var Sl=(()=>{class i extends Lt{constructor(e){super(e),this.store=e,this.NULL_UUID=Ae}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-resource-tabs"]],features:[L],decls:2,vars:2,consts:[["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,gC,4,6,"mat-tab",2)(1,hC,4,7,"mat-tab",2),n&2&&(s("ngIf",t.entity&&t.entity.tenantId.id!==t.NULL_UUID&&t.authUser.authority===t.authorities.TENANT_ADMIN&&!t.isEdit),o(),s("ngIf",t.entity&&t.entity.tenantId.id!==t.NULL_UUID&&t.authUser.authority===t.authorities.TENANT_ADMIN&&!t.isEdit))},dependencies:[G,St,ri,ai,R],encapsulation:2})}}return i})();C();var Tl=class{constructor(m,e,n){this.resourceService=m,this.resources=e,this.selectionEnabledFunction=n,this.selection=new eu(!0,[]),this.dataLoading=!0,this.resources&&this.resources.length?this.entitiesSubject=new br(this.resources):(this.entitiesSubject=new br([]),this.pageDataSubject=new br(la()),this.pageData$=this.pageDataSubject.asObservable())}connect(m){return this.entitiesSubject.asObservable()}disconnect(m){this.entitiesSubject.complete(),this.pageDataSubject&&this.pageDataSubject.complete()}reset(){this.entitiesSubject.next([]),this.pageDataSubject&&this.pageDataSubject.next(la())}loadEntities(m,e,n){this.dataLoading=!0;let t=new rc;return this.fetchEntities(m,e,n).pipe(xt(()=>{this.selection.clear()}),Qi(()=>ut(la()))).subscribe(l=>{this.entitiesSubject.next(l.data),this.pageDataSubject.next(l),t.next(l),this.dataLoading=!1}),t}fetchEntities(m,e,n){return this.resourceService.getResources(m,e,n)}isAllSelected(){let m=this.selection.selected.length;return this.entitiesSubject.pipe(ze(e=>m===e.length))}isEmpty(){return this.entitiesSubject.pipe(ze(m=>!m.length))}total(){return this.pageDataSubject.pipe(ze(m=>m.totalElements))}masterToggle(){this.entitiesSubject.pipe(xt(m=>{this.selection.selected.length===this.selectableEntitiesCount(m)?this.selection.clear():m.forEach(n=>{this.selectionEnabledFunction(n)&&this.selection.select(n)})}),ti(1)).subscribe()}selectableEntitiesCount(m){return m.filter(e=>this.selectionEnabledFunction(e)).length}};var xl=(()=>{class i{constructor(e,n,t,l,u,y,w){this.store=e,this.resourceService=n,this.translate=t,this.dialog=l,this.dialogService=u,this.router=y,this.datePipe=w,this.config=new Ge,this.config.entityType=k.TB_RESOURCE,this.config.entityComponent=Cl,this.config.entityTabsComponent=Sl,this.config.entityTranslations={details:"javascript.javascript-resource-details",add:"javascript.add",noEntities:"javascript.no-javascript-resource-text",search:"javascript.search",selectedEntities:"javascript.selected-javascript-resources"},this.config.entityResources=tt.get(k.TB_RESOURCE),this.config.headerComponent=_l,this.config.entityTitle=x=>x?x.title:"",this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("title","resource.title","60%"),new Y("resourceSubType","javascript.javascript-type","40%",x=>this.translate.instant(Ho.get(x.resourceSubType))),new Y("tenantId","resource.system","60px",x=>Ft(x.tenantId.id===Ae))),this.config.cellActionDescriptors=this.configureCellActions(),this.config.groupActionDescriptors=[{name:this.translate.instant("action.delete"),icon:"delete",isEnabled:!0,onAction:(x,q)=>this.deleteResources(x,q)}],this.config.entitiesDeleteEnabled=!1,this.config.entitiesFetchFunction=x=>this.resourceService.getResources(x,fi.JS_MODULE,this.config.componentsData.resourceSubType),this.config.loadEntity=x=>{let q=this.config.getTable()?.dataSource?.currentEntity;return!q||q?.resourceSubType===gi.MODULE?this.resourceService.getResource(x.id):this.resourceService.getResourceInfoById(x.id)},this.config.saveEntity=x=>{x.resourceType=fi.JS_MODULE;let q=this.resourceService.saveResource(x);return x.resourceSubType===gi.MODULE&&(q=q.pipe(tn(De=>this.resourceService.getResource(De.id.id)))),q},this.config.onEntityAction=x=>this.onResourceAction(x)}resolve(){this.config.tableTitle=this.translate.instant("javascript.javascript-library"),this.config.componentsData={resourceSubType:""};let e=kt(this.store);return this.config.deleteEnabled=n=>this.isResourceEditable(n,e.authority),this.config.entitySelectionEnabled=n=>this.isResourceEditable(n,e.authority),this.config.detailsReadonly=n=>this.detailsReadonly(n,e.authority),this.config}openResource(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["resources","javascript-library",n.id.id]);this.router.navigateByUrl(t).then(()=>{})}downloadResource(e,n){e&&e.stopPropagation(),this.resourceService.downloadResource(n.id.id).subscribe()}onResourceAction(e){switch(e.action){case"open":return this.openResource(e.event,e.entity),!0;case"downloadResource":return this.downloadResource(e.event,e.entity),!0;case"deleteLibrary":this.deleteResource(e.event,e.entity)}return!1}detailsReadonly(e,n){return!this.isResourceEditable(e,n)}isResourceEditable(e,n){return n===E.TENANT_ADMIN?e&&e.tenantId&&e.tenantId.id!==Ae:n===E.SYS_ADMIN}deleteResource(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("javascript.delete-javascript-resource-title",{resourceTitle:n.title}),this.translate.instant("javascript.delete-javascript-resource-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.resourceService.deleteResource(n.id.id,!1,{ignoreErrors:!0}).pipe(ze(()=>$a(n)),Qi(l=>ut($a(n,l)))).subscribe(l=>{if(l.success)this.config.getEntityDetailsPage()?this.config.getEntityDetailsPage().goBack():this.config.updateData(!0);else if(l.resourceIsReferencedError){let u=[Ii(_e({},n),{references:l.references})],y={multiple:!1,resources:u,configuration:{title:"javascript.javascript-resource-is-in-use",message:this.translate.instant("javascript.javascript-resource-is-in-use-text",{title:u[0].title}),deleteText:"javascript.delete-javascript-resource-in-use-text",selectedText:"javascript.selected-javascript-resources",columns:["select","title","references"]}};this.dialog.open(gd,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:y}).afterClosed().subscribe(w=>{w&&this.resourceService.deleteResource(n.id.id,!0).subscribe(()=>{this.config.getEntityDetailsPage()?this.config.getEntityDetailsPage().goBack():this.config.updateData(!0)})})}else{let u=od(l.error,this.translate);setTimeout(()=>{this.store.dispatch(new Be({message:u.message,type:"error"}))},u.timeout)}})})}deleteResources(e,n){if(e&&e.stopPropagation(),n&&n.length){let t=this.translate.instant("javascript.delete-javascript-resources-title",{count:n.length}),l=this.translate.instant("javascript.delete-javascript-resources-text");this.dialogService.confirm(t,l,this.translate.instant("action.no"),this.translate.instant("action.yes")).subscribe(u=>{if(u){let y=n.map(w=>this.resourceService.deleteResource(w.id.id,!1,{ignoreErrors:!0}).pipe(ze(()=>$a(w)),Qi(x=>ut($a(w,x)))));Nt(y).subscribe(w=>{let x=w.some(Ve=>Ve.success),q=w.filter(Ve=>Ve.resourceIsReferencedError),De=w.find(Ve=>!Ve.success);if(x&&this.config.updateData(),q?.length){let Ve=q.map(en=>Ii(_e({},en.resource),{references:en.references})),Ct={multiple:!0,resources:Ve,configuration:{title:"javascript.javascript-resources-are-in-use",message:this.translate.instant("javascript.javascript-resources-are-in-use-text"),deleteText:"javascript.delete-javascript-resource-in-use-text",selectedText:"javascript.selected-javascript-resources",datasource:new Tl(this.resourceService,Ve,()=>!0),columns:["select","title","references"]}};this.dialog.open(gd,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:Ct}).afterClosed().subscribe(en=>{if(en&&en.length){let td=en.map(zg=>this.resourceService.deleteResource(zg.id.id,!0));Nt(td).subscribe(()=>{this.config.updateData()})}})}else if(De){let Ve=od(De.error,this.translate);setTimeout(()=>{this.store.dispatch(new Be({message:Ve.message,type:"error"}))},Ve.timeout)}})}})}}configureCellActions(){let e=[];return e.push({name:this.translate.instant("javascript.download"),icon:"file_download",isEnabled:()=>!0,onAction:(n,t)=>this.downloadResource(n,t)},{name:this.translate.instant("javascript.delete"),icon:"delete",isEnabled:n=>this.config.deleteEnabled(n),onAction:(n,t)=>this.deleteResource(n,t)}),e}static{this.\u0275fac=function(n){return new(n||i)(D(F),D(as),D(Z),D(je),D(jt),D(pe),D(ke))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var bC=(i,m,e=qt(pe),n=qt(ls))=>{let t=i.params.type,l=decodeURIComponent(i.params.key);return Nt({imageResource:n.getImageInfo(t,l),scadaSymbolContent:n.getImageString(`${Ar}/${t}/${encodeURIComponent(l)}`)}).pipe(Qi(()=>(e.navigate(["/resources/scada-symbols"]),ut(null))))},vC=(i,m,e)=>e.symbolData?.imageResource?.title,yC=[{path:"resources",data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],breadcrumb:{menuId:be.resources}},children:[{path:"",children:[],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],redirectTo:"/resources/widgets-library"}},...Zf,{path:"images",data:{breadcrumb:{menuId:be.images}},children:[{path:"",component:hd,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"image.gallery",imageSubType:gi.IMAGE}}]},{path:"scada-symbols",data:{breadcrumb:{menuId:be.scada_symbols}},children:[{path:"",component:hd,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"scada.symbols",imageSubType:gi.SCADA_SYMBOL}},{path:":type/:key",component:yl,canDeactivate:[xe],data:{breadcrumb:{labelFunction:vC,icon:"view_in_ar"},auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"scada.symbol.symbol"},resolve:{symbolData:bC}}]},{path:"resources-library",data:{breadcrumb:{menuId:be.resources_library}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"resource.resources-library"},resolve:{entitiesTableConfig:qs}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"mdi:rhombus-split"},auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"resource.resources-library"},resolve:{entitiesTableConfig:qs}}]},{path:"javascript-library",data:{breadcrumb:{menuId:be.javascript_library}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"javascript.javascript-library"},resolve:{entitiesTableConfig:xl}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"mdi:language-javascript"},auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"javascript.javascript-library"},resolve:{entitiesTableConfig:xl}}]}]},{path:"settings",component:un,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],showMainLoadingBar:!1,breadcrumb:{menuId:be.settings}},children:[{path:"",children:[],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],redirectTo:{SYS_ADMIN:"/settings/general",TENANT_ADMIN:"/settings/home"}}},{path:"general",component:Rs,canDeactivate:[xe],data:{auth:[E.SYS_ADMIN],title:"admin.general-settings",breadcrumb:{menuId:be.general}}},{path:"outgoing-mail",component:Os,canDeactivate:[xe],data:{auth:[E.SYS_ADMIN],title:"admin.outgoing-mail-settings",breadcrumb:{menuId:be.mail_server}}},{path:"notifications",component:js,canDeactivate:[xe],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"admin.notifications-settings",breadcrumb:{menuId:be.notification_settings}}},{path:"queues",data:{breadcrumb:{menuId:be.queues}},children:[{path:"",component:Le,data:{auth:[E.SYS_ADMIN],title:"admin.queues"},resolve:{entitiesTableConfig:$s}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"swap_calls"},auth:[E.SYS_ADMIN],title:"admin.queues"},resolve:{entitiesTableConfig:$s}}]},{path:"home",component:Ls,canDeactivate:[xe],data:{auth:[E.TENANT_ADMIN],title:"admin.home-settings",breadcrumb:{menuId:be.home_settings}}},{path:"repository",component:Js,canDeactivate:[xe],data:{auth:[E.TENANT_ADMIN],title:"admin.repository-settings",breadcrumb:{menuId:be.repository_settings}}},{path:"auto-commit",component:Qs,canDeactivate:[xe],data:{auth:[E.TENANT_ADMIN],title:"admin.auto-commit-settings",breadcrumb:{menuId:be.auto_commit_settings}}},{path:"security-settings",redirectTo:"/security-settings/general"},{path:"oauth2",redirectTo:"/security-settings/oauth2"},{path:"resources-library",pathMatch:"full",redirectTo:"/resources/resources-library"},{path:"resources-library/:entityId",redirectTo:"/resources/resources-library/:entityId"},{path:"2fa",redirectTo:"/security-settings/2fa"},{path:"sms-provider",redirectTo:"/settings/notifications"}]},{path:"security-settings",data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],breadcrumb:{menuId:be.security_settings}},children:[{path:"",children:[],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN],redirectTo:{SYS_ADMIN:"/security-settings/general",TENANT_ADMIN:"/security-settings/auditLogs"}}},{path:"general",component:Bs,canDeactivate:[xe],data:{auth:[E.SYS_ADMIN],title:"admin.general",breadcrumb:{menuId:be.security_settings_general}}},{path:"2fa",component:Ys,canDeactivate:[xe],data:{auth:[E.SYS_ADMIN],title:"admin.2fa.2fa",breadcrumb:{menuId:be.two_fa}}},...Rd,...eg]}],El=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[qs,xl,$s],imports:[B.forChild(yC),B]})}}return i})();(function(){Q(El,{imports:[B],exports:[B]})})();C();var Il=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[dl,ne,oe,ve]})}}return i})();(function(){Q(Il,{declarations:[Un,ka,sl,pl,ml],imports:[dl,ne,oe,ve]})})();var Ml=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,El,Il,ad]})}}return i})();(function(){Q(Ml,{declarations:[Rs,Os,js,Vs,Bs,Ls,Gs,Sl,Us,Cl,_l,Ws,Js,Qs,Ys],imports:[ne,oe,ve,El,Il,ad]})})();C();C();C();function _C(i,m){if(i&1&&f(0,"tb-dashboard-page",2),i&2){let e=v();s("embedded",!0)("dashboard",e.homeDashboard)("hideToolbar",e.homeDashboard.hideDashboardToolbar)}}function CC(i,m){if(i&1&&(r(0,"mat-grid-tile")(1,"a",10)(2,"tb-icon",11),p(3),a(),r(4,"span"),p(5),d(6,"customTranslate"),d(7,"translate"),a()()()),i&2){let e=m.$implicit;o(),T("routerLink",e.path),o(2),O(e.icon),o(2),O(e.customTranslate?c(6,3,e.name):c(7,5,e.name))}}function SC(i,m){if(i&1&&(r(0,"mat-grid-tile",5)(1,"mat-card",6)(2,"mat-card-title")(3,"span",7),p(4),a()(),r(5,"mat-card-content")(6,"mat-grid-list",8),b(7,CC,8,7,"mat-grid-tile",9),a()()()()),i&2){let e=m.$implicit,n=v(2);s("colspan",n.sectionColspan(e)),o(4),O(e.name),o(2),s("cols",e.places.length),o(),s("ngForOf",e.places)}}function TC(i,m){if(i&1&&(r(0,"mat-grid-list",3),b(1,SC,8,4,"mat-grid-tile",4),d(2,"async"),a()),i&2){let e=v();s("cols",e.cols),o(),s("ngForOf",c(2,2,e.homeSections$))}}var wl=(()=>{class i{constructor(e,n,t,l){this.menuService=e,this.breakpointObserver=n,this.cd=t,this.route=l,this.homeSections$=this.menuService.homeSections(),this.cols=2,this.homeDashboard=this.route.snapshot.data.homeDashboard}ngOnInit(){this.homeDashboard||(this.updateColumnCount(),this.breakpointObserver.observe([Mi.lg,Mi["gt-lg"]]).subscribe(e=>this.updateColumnCount()))}updateColumnCount(){this.cols=2,this.breakpointObserver.isMatched(Mi.lg)&&(this.cols=3),this.breakpointObserver.isMatched(Mi["gt-lg"])&&(this.cols=4),this.cd.detectChanges()}sectionColspan(e){if(this.breakpointObserver.isMatched(Mi["gt-sm"])){let n=this.cols;return e&&e.places&&e.places.length<=n&&(n=e.places.length),n}else return 2}static{this.\u0275fac=function(n){return new(n||i)(g(au),g(Xn),g(Qe),g(Vi))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-home-links"]],decls:3,vars:2,consts:[["homeLinks",""],[3,"embedded","dashboard","hideToolbar",4,"ngIf","ngIfElse"],[3,"embedded","dashboard","hideToolbar"],["rowHeight","280px",1,"tb-home-links",3,"cols"],[3,"colspan",4,"ngFor","ngForOf"],[3,"colspan"],["appearance","outlined",2,"width","100%"],["translate","",1,"mat-headline-5"],["rowHeight","170px",3,"cols"],[4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",1,"tb-card-button",3,"routerLink"],["matButtonIcon","",1,"tb-mat-96"]],template:function(n,t){if(n&1&&b(0,_C,1,3,"tb-dashboard-page",1)(1,TC,3,4,"ng-template",null,0,It),n&2){let l=U(2);s("ngIf",t.homeDashboard)("ngIfElse",l)}},dependencies:[Te,G,ea,Xt,ni,di,gu,fu,_c,J,hi,Ma,le,mi,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .tb-home-links .mat-headline-5{font-size:20px}@media screen and (min-width: 1600px){[_nghost-%COMP%]     .tb-home-links .mat-headline-5{font-size:24px}}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card{padding:0;margin:8px}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card .mat-mdc-card-title{margin:0;padding:24px 16px 16px}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card .mat-mdc-card-title+.mat-mdc-card-content{padding-top:0}[_nghost-%COMP%]     .tb-home-links .mat-mdc-card .mat-mdc-card-content{padding:16px}[_nghost-%COMP%]     .tb-home-links .tb-card-button{width:100%;height:100%;max-width:240px;display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]     .tb-home-links .tb-card-button:hover{border-bottom:none}[_nghost-%COMP%]     .tb-home-links .tb-card-button:focus{border-bottom:none}[_nghost-%COMP%]     .tb-home-links .tb-card-button .mat-icon{margin:auto}[_nghost-%COMP%]     .tb-home-links .tb-card-button span.mdc-button__label{height:18px;min-height:36px;max-height:36px;padding:0 0 20px;margin:auto;font-size:18px;font-weight:400;line-height:18px;white-space:normal;text-align:center}[_nghost-%COMP%]     .tb-home-links .tb-card-button.mat-mdc-raised-button.mat-primary .mat-ripple-element{opacity:.3;background-color:#ffffff4d}'],changeDetection:0})}}return i})();var xC="/assets/dashboard/sys_admin_home_page.json",EC="/assets/dashboard/tenant_admin_home_page.json",IC="/assets/dashboard/customer_user_home_page.json",MC=(i,m)=>{let e=kt(i).authority;switch(e){case E.SYS_ADMIN:return Hd(i,m.loadJsonResource(xC),e);case E.TENANT_ADMIN:return Hd(i,m.loadJsonResource(EC),e);case E.CUSTOMER_USER:return Hd(i,m.loadJsonResource(IC),e);default:return ut(null)}},Hd=(i,m,e)=>{let n;switch(e){case E.SYS_ADMIN:n=i.pipe(Wt(Uc),ze(t=>({mobileQrEnabled:t})));break;case E.TENANT_ADMIN:n=i.pipe(Wt(qc));break;case E.CUSTOMER_USER:n=i.pipe(Wt(Or),ze(t=>({persistDeviceStateToTelemetry:t})));break}return n.pipe(_t(t=>m.pipe(ze(l=>{if(t.persistDeviceStateToTelemetry)for(let u of Object.keys(l.configuration.filters))["Active Devices","Inactive Devices"].includes(l.configuration.filters[u].filter)&&(l.configuration.filters[u].keyFilters[0].key.type=Yu.TIME_SERIES);if(Oe(t.mobileQrEnabled)){for(let u of Object.keys(l.configuration.widgets))if(l.configuration.widgets[u].config.title==="Select show mobile QR code"){l.configuration.widgets[u].config.settings.markdownTextFunction=l.configuration.widgets[u].config.settings.markdownTextFunction.replace(/\${mobileQrEnabled:([^}]+)}/,`\${mobileQrEnabled:${String(t.mobileQrEnabled)}}`);break}}return l.hideDashboardToolbar=!0,l}))))},wC=(i,m,e=qt(Xr),n=qt(pa),t=qt(F))=>e.getHomeDashboard().pipe(_t(l=>l?ut(l):MC(t,n))),DC=[{path:"home",component:wl,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN,E.CUSTOMER_USER],title:"home.home",breadcrumb:{menuId:be.home}},resolve:{homeDashboard:wC}}],Dl=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[B.forChild(DC),B]})}}return i})();(function(){Q(Dl,{imports:[B],exports:[B]})})();var Pl=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,Dl]})}}return i})();(function(){Q(Pl,{declarations:[wl],imports:[ne,oe,ve,Dl]})})();C();C();function PC(i,m){i&1&&f(0,"mat-progress-bar",25)}function FC(i,m){i&1&&f(0,"div",26)}function AC(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"user.email-required")," "))}function NC(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"user.invalid-email-format")," "))}function kC(i,m){if(i&1&&(r(0,"mat-option",27),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit;s("value",e),o(),h(" ",e?c(2,2,"language.locales."+e):""," ")}}function OC(i,m){if(i&1&&(r(0,"section",28),f(1,"tb-dashboard-autocomplete",29),d(2,"translate"),r(3,"mat-checkbox",30),p(4),d(5,"translate"),a()()),i&2){let e=v();o(),T("label",c(2,6,"dashboard.home-dashboard")),s("dashboardsScope",(e.user==null?null:e.user.authority)===e.authorities.TENANT_ADMIN?"tenant":"customer")("tenantId",e.user==null||e.user.tenantId==null?null:e.user.tenantId.id)("customerId",e.user==null||e.user.customerId==null?null:e.user.customerId.id)("selectFirstDashboard",!1),o(3),h(" ",c(5,8,"dashboard.home-dashboard-hide-toolbar")," ")}}var Al=(()=>{class i extends Mt{constructor(e,n,t,l,u,y){super(e),this.store=e,this.route=n,this.userService=t,this.authService=l,this.translate=u,this.fb=y,this.authorities=E,this.languageList=Cc.supportedLangs,this.authUser=kt(this.store)}ngOnInit(){this.buildProfileForm(),this.userLoaded(this.route.snapshot.data.user)}buildProfileForm(){this.profile=this.fb.group({email:["",[S.required,S.email]],firstName:[""],lastName:[""],phone:[""],language:[""],homeDashboardId:[null],homeDashboardHideToolbar:[!0]})}save(){this.user=_e(_e({},this.user),this.profile.value),this.user.additionalInfo||(this.user.additionalInfo={}),this.user.additionalInfo.lang=this.profile.get("language").value,this.user.additionalInfo.homeDashboardId=this.profile.get("homeDashboardId").value,this.user.additionalInfo.homeDashboardHideToolbar=this.profile.get("homeDashboardHideToolbar").value,this.userService.saveUser(this.user).subscribe(e=>{this.userLoaded(e),this.store.dispatch(new jc({userDetails:{additionalInfo:_e({},e.additionalInfo),authority:e.authority,createdTime:e.createdTime,tenantId:e.tenantId,customerId:e.customerId,email:e.email,phone:e.phone,firstName:e.firstName,id:e.id,lastName:e.lastName}})),this.store.dispatch(new ou({userLang:e.additionalInfo.lang})),this.authService.refreshJwtToken(!1)})}userLoaded(e){this.user=e,this.profile.reset(e);let n,t,l=!0;e.additionalInfo&&(e.additionalInfo.lang&&(n=e.additionalInfo.lang),t=e.additionalInfo.homeDashboardId,Oe(e.additionalInfo.homeDashboardHideToolbar)&&(l=e.additionalInfo.homeDashboardHideToolbar)),n||(n=this.translate.currentLang),this.profile.get("language").setValue(n),this.profile.get("homeDashboardId").setValue(t),this.profile.get("homeDashboardHideToolbar").setValue(l)}confirmForm(){return this.profile}isSysAdmin(){return this.authUser.authority===E.SYS_ADMIN}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Vi),g(Sn),g(Zn),g(Z),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-profile"]],features:[L],decls:50,vars:30,consts:[["appearance","outlined",1,"profile-card"],[1,"flex","flex-1","flex-row","items-start","justify-between","xs:flex-col","xs:justify-start","xs:gap-2"],[1,"flex","flex-1","flex-col"],["translate","",1,"mat-headline-5"],[1,"profile-email",2,"opacity","0.7"],[1,"flex","flex-col"],["translate","",1,"mat-mdc-subheader"],[1,"profile-last-login-ts",2,"opacity","0.7"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[3,"ngSubmit","formGroup"],[3,"disabled"],[1,"mat-block"],["translate",""],["matInput","","type","email","formControlName","email","required",""],[4,"ngIf"],["matInput","","formControlName","firstName"],["matInput","","formControlName","lastName"],["formControlName","phone",3,"required","label","enableFlagsSelect"],["formControlName","language"],[3,"value",4,"ngFor","ngForOf"],["class","tb-home-dashboard flex flex-1 flex-col gt-sm:flex-row",4,"ngIf"],[1,"flex","flex-row","items-start","justify-end"],["mat-button","","mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"],[1,"tb-home-dashboard","flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","customerId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(n,t){n&1&&(r(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"div",1)(4,"div",2)(5,"span",3),p(6,"profile.profile"),a(),r(7,"span",4),p(8),a()(),r(9,"div",5)(10,"span",6),p(11,"profile.last-login-time"),a(),r(12,"span",7),p(13),d(14,"date"),a()()()(),b(15,PC,1,0,"mat-progress-bar",8),d(16,"async"),b(17,FC,1,0,"div",9),d(18,"async"),r(19,"mat-card-content",10)(20,"form",11),_("ngSubmit",function(){return t.save()}),r(21,"fieldset",12),d(22,"async"),r(23,"mat-form-field",13)(24,"mat-label",14),p(25,"user.email"),a(),f(26,"input",15),b(27,AC,3,3,"mat-error",16)(28,NC,3,3,"mat-error",16),a(),r(29,"mat-form-field",13)(30,"mat-label",14),p(31,"user.first-name"),a(),f(32,"input",17),a(),r(33,"mat-form-field",13)(34,"mat-label",14),p(35,"user.last-name"),a(),f(36,"input",18),a(),f(37,"tb-phone-input",19),d(38,"translate"),r(39,"mat-form-field",13)(40,"mat-label",14),p(41,"language.language"),a(),r(42,"mat-select",20),b(43,kC,3,4,"mat-option",21),a()(),b(44,OC,6,10,"section",22),r(45,"div",23)(46,"button",24),d(47,"async"),p(48),d(49,"translate"),a()()()()()()()),n&2&&(o(8),O(t.profile?t.profile.get("email").value:""),o(5),O(Yt(14,15,t.user==null||t.user.additionalInfo==null?null:t.user.additionalInfo.lastLoginTs,"yyyy-MM-dd HH:mm:ss")),o(2),s("ngIf",c(16,18,t.isLoading$)),o(2),s("ngIf",!c(18,20,t.isLoading$)),o(3),s("formGroup",t.profile),o(),s("disabled",c(22,22,t.isLoading$)),o(6),s("ngIf",t.profile.get("email").hasError("required")),o(),s("ngIf",t.profile.get("email").hasError("email")),o(9),T("label",c(38,24,"contact.phone")),s("required",!1)("enableFlagsSelect",!0),o(6),s("ngForOf",t.languageList),o(),s("ngIf",!t.isSysAdmin()),o(2),s("disabled",c(47,26,t.isLoading$)||t.profile.invalid||!t.profile.dirty),o(2),h(" ",c(49,28,"action.save")," "))},dependencies:[Te,G,dn,ee,$t,Xt,ni,ci,qe,he,me,Ce,Pe,vt,gt,ce,ge,W,K,ue,ie,se,J,ao,le,ke,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{margin:8px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .profile-email[_ngcontent-%COMP%]{font-size:16px;font-weight:400}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .mat-mdc-subheader[_ngcontent-%COMP%]{line-height:24px;color:#0000008a;font-size:14px;font-weight:400}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .profile-last-login-ts[_ngcontent-%COMP%]{font-size:16px;font-weight:400}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .tb-home-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .tb-home-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .tb-home-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']})}}return i})();C();var _g=(()=>{class i{constructor(e,n){this.store=e,this.userService=n}resolve(){let e=kt(this.store).userId;return this.userService.getUser(e)}static{this.\u0275fac=function(n){return new(n||i)(D(F),D(Sn))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})(),Cg=[{path:"profile",component:Al,canDeactivate:[xe],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN,E.CUSTOMER_USER],title:"profile.profile",breadcrumb:{label:"profile.profile",icon:"account_circle"}},resolve:{user:_g}}],RC=[{path:"profile",redirectTo:"account/profile"}],Nl=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[_g],imports:[B.forChild(RC),B]})}}return i})();(function(){Q(Nl,{imports:[B],exports:[B]})})();var kl=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,Nl]})}}return i})();(function(){Q(kl,{declarations:[Al],imports:[ne,oe,Nl]})})();C();C();C();C();var BC=["stepper"],VC=["canvas"];function jC(i,m){i&1&&f(0,"mat-progress-bar",28)}function LC(i,m){i&1&&f(0,"div",29)}function GC(i,m){i&1&&(r(0,"mat-icon"),p(1,"done"),a())}function UC(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"security.2fa.dialog.totp-step-label"))}function qC(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"security.2fa.dialog.verification-step-label"))}function WC(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"security.2fa.dialog.verification-code-invalid")," "))}function HC(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"security.2fa.dialog.activation-step-label"))}var Rl=(()=>{class i extends nt{constructor(e,n,t,l,u){super(e,n,l),this.store=e,this.router=n,this.twoFaService=t,this.dialogRef=l,this.fb=u,this.twoFaService.generateTwoFaAccountConfig(yt.TOTP).subscribe(y=>{this.authAccountConfig=y,this.totpAuthURL=this.authAccountConfig.authUrl,this.authAccountConfig.useByDefault=!0,import("./chunk-ZCOP4236.js").then(w=>{Vc(w).toCanvas(this.canvasRef.nativeElement,this.totpAuthURL),this.canvasRef.nativeElement.style.width="auto",this.canvasRef.nativeElement.style.height="auto"})}),this.totpConfigForm=this.fb.group({verificationCode:["",[S.required,S.minLength(6),S.maxLength(6),S.pattern(/^\d*$/)]]})}onSaveConfig(){this.totpConfigForm.valid?this.twoFaService.verifyAndSaveTwoFaAccountConfig(this.authAccountConfig,this.totpConfigForm.get("verificationCode").value).subscribe(e=>{this.config=e,this.stepper.next()}):Object.keys(this.totpConfigForm.controls).forEach(e=>{this.totpConfigForm.get(e).markAsTouched({onlySelf:!0})})}closeDialog(){return this.dialogRef.close(this.config)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(zi),g(it),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-totp-auth-dialog"]],viewQuery:function(n,t){if(n&1&&(Ie(BC,5),Ie(VC,5)),n&2){let l;Me(l=we())&&(t.stepper=l.first),Me(l=we())&&(t.canvasRef=l.first)}},features:[L],decls:55,vars:26,consts:[["stepper",""],["canvas",""],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",2,"padding","0"],["linear",""],["matStepperIcon","edit"],["matStepLabel",""],["translate","",1,"mat-body-2"],[1,"flex","flex-row","items-center","justify-end"],["mat-raised-button","","type","button","color","primary","matStepperNext",""],[3,"stepControl"],[1,"flex","flex-col","items-center","justify-start",3,"ngSubmit","formGroup"],["translate","",1,"mat-body","qr-code-description"],["translate","",1,"mat-body","qr-code-description",2,"margin-top","30px"],[1,"mat-block","code-container","flex-1"],["matInput","","formControlName","verificationCode","maxlength","6","type","text","required","","inputmode","numeric","pattern","[0-9]*","autocomplete","off",3,"placeholder"],[4,"ngIf"],["mat-raised-button","","type","button","color","primary",3,"click","disabled"],["matStepLabel","","matStepperIcon","done"],["translate","",1,"result-title"],["translate","",1,"mat-body","result-description"],["mat-raised-button","","type","button","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){if(n&1){let l=j();r(0,"mat-toolbar",2)(1,"h2",3),p(2,"security.2fa.dialog.enable-totp-title"),a(),f(3,"span",4),r(4,"button",5),_("click",function(){return I(l),M(t.closeDialog())}),r(5,"mat-icon",6),p(6,"close"),a()()(),b(7,jC,1,0,"mat-progress-bar",7),d(8,"async"),b(9,LC,1,0,"div",8),d(10,"async"),r(11,"div",9)(12,"mat-stepper",10,0),b(14,GC,2,0,"ng-template",11),r(15,"mat-step"),b(16,UC,2,3,"ng-template",12),r(17,"div")(18,"p",13),p(19,"security.2fa.dialog.totp-step-description-open"),a(),r(20,"p",13),p(21,"security.2fa.dialog.totp-step-description-install"),a(),r(22,"div",14)(23,"button",15),p(24),d(25,"translate"),a()()()(),r(26,"mat-step",16),b(27,qC,2,3,"ng-template",12),r(28,"form",17),_("ngSubmit",function(){return I(l),M(t.onSaveConfig())}),r(29,"p",18),p(30,"security.2fa.dialog.scan-qr-code"),a(),f(31,"canvas",4,1),r(33,"p",19),p(34,"security.2fa.dialog.enter-verification-code"),a(),r(35,"mat-form-field",20),f(36,"input",21),d(37,"translate"),b(38,WC,3,3,"mat-error",22),a()(),r(39,"div",14)(40,"button",23),d(41,"async"),_("click",function(){return I(l),M(t.onSaveConfig())}),p(42),d(43,"translate"),a()()(),r(44,"mat-step"),b(45,HC,2,3,"ng-template",24),r(46,"div")(47,"h3",25),p(48,"security.2fa.dialog.success"),a(),r(49,"p",26),p(50,"security.2fa.dialog.activation-step-description-totp"),a(),r(51,"div",14)(52,"button",27),_("click",function(){return I(l),M(t.closeDialog())}),p(53),d(54,"translate"),a()()()()()()}n&2&&(o(7),s("ngIf",c(8,12,t.isLoading$)),o(2),s("ngIf",!c(10,14,t.isLoading$)),o(15),h(" ",c(25,16,"security.2fa.dialog.next")," "),o(2),s("stepControl",t.totpConfigForm),o(2),s("formGroup",t.totpConfigForm),o(3),Bi("display",t.totpAuthURL?"block":"none"),o(5),T("placeholder",c(37,18,"security.2fa.dialog.verification-code")),o(2),s("ngIf",t.totpConfigForm.get("verificationCode").invalid),o(2),s("disabled",c(41,20,t.isLoading$)||t.totpConfigForm.invalid),o(2),h(" ",c(43,22,"security.2fa.dialog.next")," "),o(11),h(" ",c(54,24,"action.done")," "))},dependencies:[G,wi,ee,Ee,ae,qe,he,me,Pe,at,mt,wn,In,Dn,xu,Mn,ce,ge,W,K,ue,pn,na,ie,se,J,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']})}}return i})();C();var zC=["stepper"],$C=i=>({address:i});function JC(i,m){i&1&&f(0,"mat-progress-bar",30)}function QC(i,m){i&1&&f(0,"div",31)}function YC(i,m){i&1&&(r(0,"mat-icon"),p(1,"done"),a())}function KC(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"security.2fa.dialog.sms-step-label"))}function XC(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"security.2fa.dialog.verification-step-label"))}function ZC(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"security.2fa.dialog.verification-code-invalid")," "))}function e2(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"security.2fa.dialog.activation-step-label"))}var Bl=(()=>{class i extends nt{constructor(e,n,t,l,u){super(e,n,l),this.store=e,this.router=n,this.twoFaService=t,this.dialogRef=l,this.fb=u,this.phoneNumberPattern=xa,this.smsConfigForm=this.fb.group({phone:["",[S.required,S.pattern(xa)]]}),this.smsVerificationForm=this.fb.group({verificationCode:["",[S.required,S.minLength(6),S.maxLength(6),S.pattern(/^\d*$/)]]})}nextStep(){switch(this.stepper.selectedIndex){case 0:this.smsConfigForm.valid?(this.authAccountConfig={providerType:yt.SMS,useByDefault:!0,phoneNumber:this.smsConfigForm.get("phone").value},this.twoFaService.submitTwoFaAccountConfig(this.authAccountConfig).subscribe(()=>{this.stepper.next()})):this.showFormErrors(this.smsConfigForm);break;case 1:this.smsVerificationForm.valid?this.twoFaService.verifyAndSaveTwoFaAccountConfig(this.authAccountConfig,this.smsVerificationForm.get("verificationCode").value).subscribe(e=>{this.config=e,this.stepper.next()}):this.showFormErrors(this.smsVerificationForm);break}}closeDialog(){return this.dialogRef.close(this.config)}showFormErrors(e){Object.keys(e.controls).forEach(n=>{e.get(n).markAsTouched({onlySelf:!0})})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(zi),g(it),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-sms-auth-dialog"]],viewQuery:function(n,t){if(n&1&&Ie(zC,5),n&2){let l;Me(l=we())&&(t.stepper=l.first)}},features:[L],decls:58,vars:45,consts:[["stepper",""],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",2,"padding","0"],["linear",""],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[3,"ngSubmit","formGroup"],["translate","",1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","gap-3.75"],["formControlName","phone",1,"flex-1",3,"floatLabel","placeholder"],["mat-raised-button","","type","submit","color","primary",3,"disabled"],[1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","xs:flex-col","xs:items-end","xs:justify-start"],[1,"mat-block","code-container","full-width-xs","flex-1"],["matInput","","formControlName","verificationCode","maxlength","6","type","text","required","","inputmode","numeric","pattern","[0-9]*","autocomplete","off",3,"placeholder"],[4,"ngIf"],[1,"flex","gap-2"],["mat-button","","matStepperPrevious","",3,"disabled"],["matStepLabel","","matStepperIcon","done"],["translate","",1,"result-title"],["translate","",1,"mat-body","result-description"],[1,"flex","flex-row","items-center","justify-end"],["mat-raised-button","","type","button","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){if(n&1){let l=j();r(0,"mat-toolbar",1)(1,"h2",2),p(2,"security.2fa.dialog.enable-sms-title"),a(),f(3,"span",3),r(4,"button",4),_("click",function(){return I(l),M(t.closeDialog())}),r(5,"mat-icon",5),p(6,"close"),a()()(),b(7,JC,1,0,"mat-progress-bar",6),d(8,"async"),b(9,QC,1,0,"div",7),d(10,"async"),r(11,"div",8)(12,"mat-stepper",9,0),b(14,YC,2,0,"ng-template",10),r(15,"mat-step",11),b(16,KC,2,3,"ng-template",12),r(17,"form",13),_("ngSubmit",function(){return I(l),M(t.nextStep())}),r(18,"p",14),p(19,"security.2fa.dialog.sms-step-description"),a(),r(20,"div",15),f(21,"tb-phone-input",16),d(22,"translate"),r(23,"button",17),d(24,"async"),p(25),d(26,"translate"),a()()()(),r(27,"mat-step",11),b(28,XC,2,3,"ng-template",12),r(29,"form",13),_("ngSubmit",function(){return I(l),M(t.nextStep())}),r(30,"p",18),p(31),d(32,"translate"),a(),r(33,"div",19)(34,"mat-form-field",20),f(35,"input",21),d(36,"translate"),b(37,ZC,3,3,"mat-error",22),a(),r(38,"div",23)(39,"button",24),d(40,"async"),p(41),d(42,"translate"),a(),r(43,"button",17),d(44,"async"),p(45),d(46,"translate"),a()()()()(),r(47,"mat-step"),b(48,e2,2,3,"ng-template",25),r(49,"div")(50,"h3",26),p(51,"security.2fa.dialog.success"),a(),r(52,"p",27),p(53,"security.2fa.dialog.activation-step-description-sms"),a(),r(54,"div",28)(55,"button",29),_("click",function(){return I(l),M(t.closeDialog())}),p(56),d(57,"translate"),a()()()()()()}n&2&&(o(7),s("ngIf",c(8,18,t.isLoading$)),o(2),s("ngIf",!c(10,20,t.isLoading$)),o(6),s("stepControl",t.smsConfigForm),o(2),s("formGroup",t.smsConfigForm),o(4),T("placeholder",c(22,22,"security.2fa.dialog.sms-step-label")),s("floatLabel","never"),o(2),s("disabled",c(24,24,t.isLoading$)||t.smsConfigForm.invalid),o(2),h(" ",c(26,26,"security.2fa.dialog.send-code")," "),o(2),s("stepControl",t.smsVerificationForm),o(2),s("formGroup",t.smsVerificationForm),o(2),h(" ",Yt(32,28,"security.2fa.dialog.verification-step-description",pt(43,$C,t.smsConfigForm.get("phone").value))," "),o(4),T("placeholder",c(36,31,"security.2fa.dialog.verification-code")),o(2),s("ngIf",t.smsVerificationForm.get("verificationCode").invalid),o(2),s("disabled",c(40,33,t.isLoading$)),o(2),h(" ",c(42,35,"action.back")," "),o(2),s("disabled",c(44,37,t.isLoading$)||t.smsVerificationForm.invalid),o(2),h(" ",c(46,39,"action.activate")," "),o(11),h(" ",c(57,41,"action.done")," "))},dependencies:[G,wi,ee,Ee,ae,qe,he,me,Pe,at,mt,wn,In,Dn,Jr,Mn,ce,ge,W,K,ue,pn,na,ie,se,J,ao,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']})}}return i})();C();var t2=["stepper"],i2=i=>({address:i});function n2(i,m){i&1&&f(0,"mat-progress-bar",31)}function o2(i,m){i&1&&f(0,"div",32)}function a2(i,m){i&1&&(r(0,"mat-icon"),p(1,"done"),a())}function r2(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"security.2fa.dialog.email-step-label"))}function s2(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"user.email-required")," "))}function l2(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"user.invalid-email-format")," "))}function p2(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"security.2fa.dialog.verification-step-label"))}function m2(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"security.2fa.dialog.verification-code-invalid")," "))}function d2(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"security.2fa.dialog.activation-step-label"))}var Vl=(()=>{class i extends nt{constructor(e,n,t,l,u,y){super(e,n,u),this.store=e,this.router=n,this.twoFaService=t,this.data=l,this.dialogRef=u,this.fb=y,this.emailConfigForm=this.fb.group({email:[this.data.email,[S.required,S.email]]}),this.emailVerificationForm=this.fb.group({verificationCode:["",[S.required,S.minLength(6),S.maxLength(6),S.pattern(/^\d*$/)]]})}nextStep(){switch(this.stepper.selectedIndex){case 0:this.emailConfigForm.valid?(this.authAccountConfig={providerType:yt.EMAIL,useByDefault:!0,email:this.emailConfigForm.get("email").value},this.twoFaService.submitTwoFaAccountConfig(this.authAccountConfig).subscribe(()=>{this.stepper.next()})):this.showFormErrors(this.emailConfigForm);break;case 1:this.emailVerificationForm.valid?this.twoFaService.verifyAndSaveTwoFaAccountConfig(this.authAccountConfig,this.emailVerificationForm.get("verificationCode").value).subscribe(e=>{this.config=e,this.stepper.next()}):this.showFormErrors(this.emailVerificationForm);break}}closeDialog(){return this.dialogRef.close(this.config)}showFormErrors(e){Object.keys(e.controls).forEach(n=>{e.get(n).markAsTouched({onlySelf:!0})})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(zi),g(Ot),g(it),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-email-auth-dialog"]],viewQuery:function(n,t){if(n&1&&Ie(t2,5),n&2){let l;Me(l=we())&&(t.stepper=l.first)}},features:[L],decls:61,vars:47,consts:[["stepper",""],["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",2,"padding","0"],[3,"linear"],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[3,"ngSubmit","formGroup"],["translate","",1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","gap-2"],[1,"mat-block","input-container","flex-1"],["matInput","","formControlName","email","type","email","required","",3,"placeholder"],[4,"ngIf"],["mat-raised-button","","type","submit","color","primary",3,"disabled"],[1,"mat-body","step-description","input"],[1,"flex","flex-row","items-center","justify-between","xs:flex-col","xs:items-end","xs:justify-start"],[1,"mat-block","code-container","full-width-xs","flex-1"],["matInput","","formControlName","verificationCode","maxlength","6","type","text","required","","inputmode","numeric","pattern","[0-9]*","autocomplete","off",3,"placeholder"],[1,"flex","gap-2"],["mat-button","","matStepperPrevious","",3,"disabled"],["matStepLabel","","matStepperIcon","done"],["translate","",1,"result-title"],["translate","",1,"mat-body","result-description"],[1,"flex","flex-row","items-center","justify-end"],["mat-raised-button","","type","button","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){if(n&1){let l=j();r(0,"mat-toolbar",1)(1,"h2",2),p(2,"security.2fa.dialog.enable-email-title"),a(),f(3,"span",3),r(4,"button",4),_("click",function(){return I(l),M(t.closeDialog())}),r(5,"mat-icon",5),p(6,"close"),a()()(),b(7,n2,1,0,"mat-progress-bar",6),d(8,"async"),b(9,o2,1,0,"div",7),d(10,"async"),r(11,"div",8)(12,"mat-stepper",9,0),b(14,a2,2,0,"ng-template",10),r(15,"mat-step",11),b(16,r2,2,3,"ng-template",12),r(17,"form",13),_("ngSubmit",function(){return I(l),M(t.nextStep())}),r(18,"p",14),p(19,"security.2fa.dialog.email-step-description"),a(),r(20,"div",15)(21,"mat-form-field",16),f(22,"input",17),d(23,"translate"),b(24,s2,3,3,"mat-error",18)(25,l2,3,3,"mat-error",18),a(),r(26,"button",19),d(27,"async"),p(28),d(29,"translate"),a()()()(),r(30,"mat-step",11),b(31,p2,2,3,"ng-template",12),r(32,"form",13),_("ngSubmit",function(){return I(l),M(t.nextStep())}),r(33,"p",20),p(34),d(35,"translate"),a(),r(36,"div",21)(37,"mat-form-field",22),f(38,"input",23),d(39,"translate"),b(40,m2,3,3,"mat-error",18),a(),r(41,"div",24)(42,"button",25),d(43,"async"),p(44),d(45,"translate"),a(),r(46,"button",19),d(47,"async"),p(48),d(49,"translate"),a()()()()(),r(50,"mat-step"),b(51,d2,2,3,"ng-template",26),r(52,"div")(53,"h3",27),p(54,"security.2fa.dialog.success"),a(),r(55,"p",28),p(56,"security.2fa.dialog.activation-step-description-email"),a(),r(57,"div",29)(58,"button",30),_("click",function(){return I(l),M(t.closeDialog())}),p(59),d(60,"translate"),a()()()()()()}n&2&&(o(7),s("ngIf",c(8,20,t.isLoading$)),o(2),s("ngIf",!c(10,22,t.isLoading$)),o(3),s("linear",!0),o(3),s("stepControl",t.emailConfigForm),o(2),s("formGroup",t.emailConfigForm),o(5),T("placeholder",c(23,24,"security.2fa.dialog.email-step-label")),o(2),s("ngIf",t.emailConfigForm.get("email").hasError("required")),o(),s("ngIf",t.emailConfigForm.get("email").hasError("email")),o(),s("disabled",c(27,26,t.isLoading$)||t.emailConfigForm.invalid),o(2),h(" ",c(29,28,"security.2fa.dialog.send-code")," "),o(2),s("stepControl",t.emailVerificationForm),o(2),s("formGroup",t.emailVerificationForm),o(2),h(" ",Yt(35,30,"security.2fa.dialog.verification-step-description",pt(45,i2,t.emailConfigForm.get("email").value))," "),o(4),T("placeholder",c(39,33,"security.2fa.dialog.verification-code")),o(2),s("ngIf",t.emailVerificationForm.get("verificationCode").invalid),o(2),s("disabled",c(43,35,t.isLoading$)),o(2),h(" ",c(45,37,"action.back")," "),o(2),s("disabled",c(47,39,t.isLoading$)||t.emailVerificationForm.invalid),o(2),h(" ",c(49,41,"action.activate")," "),o(11),h(" ",c(60,43,"action.done")," "))},dependencies:[G,wi,ee,Ee,ae,qe,he,me,Pe,at,mt,wn,In,Dn,Jr,Mn,ce,ge,W,K,ue,pn,na,ie,se,J,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']})}}return i})();C();var Sg=`<html lang="en">
<head>
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Backup code</title>

    <style>
        .code-block {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }
        .code-row {
            margin: 0 6px 8px;
            display: flex;
            min-width: 130px;
        }
        .code {
            font: 400 16px / 20px Roboto Mono, "Helvetica Neue", monospace;
            margin-left: 6px;
        }
        input[type="checkbox"] {
            -webkit-appearance: none;
            appearance: none;
            background-color: #fff;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1em;
            height: 1em;
            border: 0.1em solid currentColor;
            border-radius: 0.15em;
            transform: translateY(0em);
        }
    </style>
</head>

<body style="margin: 0">
    <div style="margin: 8px; max-width: 286px">
        <div style="border: #d0d7de solid 1px; border-radius:4px">
            <h3 style="padding: 16px 24px; margin: 0; font: 500 20px / 24px Roboto, 'Helvetica Neue', sans-serif; text-align: center">
                Backup codes
            </h3>
            <div class="code-block">
                \${codesBlock}
            </div>
        </div>
    </div>
</body>
</html>
`;function u2(i,m){i&1&&f(0,"mat-progress-bar",15)}function f2(i,m){i&1&&f(0,"div",16)}function g2(i,m){if(i&1&&(r(0,"div",17),p(1),a()),i&2){let e=m.$implicit,n=m.even;V("even",n),o(),h(" ",e," ")}}var jl=(()=>{class i extends nt{constructor(e,n,t,l,u,y){super(e,n,u),this.store=e,this.router=n,this.twoFaService=t,this.importExportService=l,this.dialogRef=u,this.fb=y,this.twoFaService.generateTwoFaAccountConfig(yt.BACKUP_CODE).pipe(xt(w=>this.backupCode=w),_t(w=>this.twoFaService.verifyAndSaveTwoFaAccountConfig(w,null,{ignoreLoading:!0}))).subscribe(w=>{this.config=w})}closeDialog(){this.dialogRef.close(this.config)}downloadFile(){this.importExportService.exportText(this.backupCode.codes,"backup-codes")}printCode(){let e=Tt(this.backupCode.codes).map(l=>`<div class="code-row"><input type="checkbox"><span class="code">${l}</span></div>`).join(""),n=Sg.replace("${codesBlock}",e),t=window.open("","Print backup code");t.document.open(),t.document.write(n),setTimeout(()=>{t.print(),t.document.close(),setTimeout(()=>{t.close()},10)},0)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(zi),g(Fi),g(it),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-backup-code-auth-dialog"]],features:[L],decls:29,vars:16,consts:[["color","primary",1,"flex","flex-row"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","",1,"backup-code"],["translate","",1,"mat-body-2","description"],[1,"container","flex","flex-row","flex-wrap"],["class","code max-w-50% flex-full",3,"even",4,"ngFor","ngForOf"],[1,"action-buttons","flex","flex-row","items-center","justify-start","gap-4"],["type","button","mat-stroked-button","","color","primary",3,"click"],["type","button","mat-raised-button","","color","primary",3,"click"],[1,"flex","flex-row","items-start","justify-end"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"code","max-w-50%","flex-full"]],template:function(n,t){n&1&&(r(0,"mat-toolbar",0)(1,"h2",1),p(2,"security.2fa.dialog.get-backup-code-title"),a(),f(3,"span",2),r(4,"button",3),_("click",function(){return t.closeDialog()}),r(5,"mat-icon",4),p(6,"close"),a()()(),b(7,u2,1,0,"mat-progress-bar",5),d(8,"async"),b(9,f2,1,0,"div",6),d(10,"async"),r(11,"div",7)(12,"p",8),p(13,"security.2fa.dialog.backup-code-description"),a(),r(14,"div",9),b(15,g2,2,3,"div",10),a(),r(16,"div",11)(17,"button",12),_("click",function(){return t.downloadFile()}),p(18),d(19,"translate"),a(),r(20,"button",13),_("click",function(){return t.printCode()}),p(21),d(22,"translate"),a()(),r(23,"p",8),p(24,"security.2fa.dialog.backup-code-warn"),a(),r(25,"div",14)(26,"button",13),_("click",function(){return t.closeDialog()}),p(27),d(28,"translate"),a()()()),n&2&&(o(7),s("ngIf",c(8,6,t.isLoading$)),o(2),s("ngIf",!c(10,8,t.isLoading$)),o(6),s("ngForOf",t.backupCode==null?null:t.backupCode.codes),o(3),h(" ",c(19,10,"security.2fa.dialog.download-txt")," "),o(3),h(" ",c(22,12,"action.print")," "),o(6),h(" ",c(28,14,"action.done")," "))},dependencies:[Te,G,wi,ee,Ee,ae,qe,at,mt,J,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > h2[_ngcontent-%COMP%]{font-weight:400;letter-spacing:.25px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:0;letter-spacing:.25px}[_nghost-%COMP%]   .mat-body-2[_ngcontent-%COMP%]:not(:first-of-type){margin:0 0 8px}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]{margin:0;color:#0000008a}[_nghost-%COMP%]   .mat-body-2.description[_ngcontent-%COMP%]:last-of-type{margin-bottom:24px}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{max-width:290px}[_nghost-%COMP%]   .code-container[_ngcontent-%COMP%]{max-width:170px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .code-container.full-width-xs[_ngcontent-%COMP%]{max-width:100%;width:100%}}[_nghost-%COMP%]   .result-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.1px;margin:8px 0;text-align:center}[_nghost-%COMP%]   .result-description[_ngcontent-%COMP%]{text-align:center;margin:0 0 16px;letter-spacing:.25px;max-width:500px}[_nghost-%COMP%]   .step-description[_ngcontent-%COMP%]{max-width:450px}[_nghost-%COMP%]   .step-description.input[_ngcontent-%COMP%]{margin:12px 0 0}[_nghost-%COMP%]   .qr-code-description[_ngcontent-%COMP%]{text-align:center;max-width:180px;letter-spacing:.25px;color:#000000de;margin-bottom:0}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]{max-width:500px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{max-width:500px;margin:40px 0 8px}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{letter-spacing:.25px;padding:0 24px;margin-bottom:16px;font-family:Roboto Mono,Helvetica Neue,monospace}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .code.even[_ngcontent-%COMP%]{text-align:right}[_nghost-%COMP%]   .backup-code[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:40px}[_nghost-%COMP%]     .mat-horizontal-stepper-header{pointer-events:none!important}']})}}return i})();var Tg=new Map([[yt.TOTP,Rl],[yt.SMS,Bl],[yt.EMAIL,Vl],[yt.BACKUP_CODE,jl]]);var Ba=i=>({count:i});function h2(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"security.password-requirement.incorrect-password-try-again")," "))}function b2(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"security.password-requirement.password-not-meet-requirements")," "))}function v2(i,m){if(i&1&&(r(0,"mat-error"),p(1),a()),i&2){let e=v();o(),h(" ",e.changePassword.get("newPassword").getError("alreadyUsed")," ")}}function y2(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"security.password-requirement.password-should-difference")," "))}function _2(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"security.password-requirement.password-should-not-contain-spaces")," "))}function C2(i,m){i&1&&Vt(0)}function S2(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"security.password-requirement.new-passwords-not-match")," "))}function T2(i,m){i&1&&Vt(0)}function x2(i,m){if(i&1&&(r(0,"p",37)(1,"tb-icon",38),p(2),a(),p(3),d(4,"translate"),a()),i&2){let e=v(3);o(2),h(" ",e.changePassword.get("newPassword").hasError("notUpperCase")?"mdi:circle-small":"mdi:check"," "),o(),h(" ",Yt(4,2,"security.password-requirement.uppercase-letter",pt(5,Ba,e.passwordPolicy.minimumUppercaseLetters))," ")}}function E2(i,m){if(i&1&&(r(0,"p",37)(1,"tb-icon",38),p(2),a(),p(3),d(4,"translate"),a()),i&2){let e=v(3);o(2),h(" ",e.changePassword.get("newPassword").hasError("notLowerCase")?"mdi:circle-small":"mdi:check"," "),o(),h(" ",Yt(4,2,"security.password-requirement.lowercase-letter",pt(5,Ba,e.passwordPolicy.minimumLowercaseLetters))," ")}}function I2(i,m){if(i&1&&(r(0,"p",37)(1,"tb-icon",38),p(2),a(),p(3),d(4,"translate"),a()),i&2){let e=v(3);o(2),h(" ",e.changePassword.get("newPassword").hasError("notNumeric")?"mdi:circle-small":"mdi:check"," "),o(),h(" ",Yt(4,2,"security.password-requirement.digit",pt(5,Ba,e.passwordPolicy.minimumDigits))," ")}}function M2(i,m){if(i&1&&(r(0,"p",37)(1,"tb-icon",38),p(2),a(),p(3),d(4,"translate"),a()),i&2){let e=v(3);o(2),h(" ",e.changePassword.get("newPassword").hasError("notSpecial")?"mdi:circle-small":"mdi:check"," "),o(),h(" ",Yt(4,2,"security.password-requirement.special-character",pt(5,Ba,e.passwordPolicy.minimumSpecialCharacters))," ")}}function w2(i,m){if(i&1&&(r(0,"p",37)(1,"tb-icon",38),p(2),a(),p(3),d(4,"translate"),a()),i&2){let e=v(3);o(2),h(" ",e.changePassword.get("newPassword").hasError("minLength")?"mdi:circle-small":"mdi:check"," "),o(),h(" ",Yt(4,2,"security.password-requirement.character",pt(5,Ba,e.passwordPolicy.minimumLength))," ")}}function D2(i,m){if(i&1&&(r(0,"div",34)(1,"h4",35),p(2,"security.password-requirement.at-most"),a(),r(3,"p",37),f(4,"mat-icon",39),p(5),d(6,"translate"),a()()),i&2){let e=v(3);o(4),s("svgIcon",e.changePassword.get("newPassword").hasError("maxLength")?"mdi:circle-small":"mdi:check"),o(),h(" ",Yt(6,2,"security.password-requirement.character",pt(5,Ba,e.passwordPolicy.maximumLength))," ")}}function P2(i,m){if(i&1&&(r(0,"div",34)(1,"h3",15),p(2,"security.password-requirement.password-requirements"),a(),r(3,"h4",35),p(4,"security.password-requirement.at-least"),a(),b(5,x2,5,7,"p",36)(6,E2,5,7,"p",36)(7,I2,5,7,"p",36)(8,M2,5,7,"p",36)(9,w2,5,7,"p",36)(10,D2,7,7,"div",33),a()),i&2){let e=v(2);o(5),s("ngIf",e.passwordPolicy.minimumUppercaseLetters>0),o(),s("ngIf",e.passwordPolicy.minimumLowercaseLetters>0),o(),s("ngIf",e.passwordPolicy.minimumDigits>0),o(),s("ngIf",e.passwordPolicy.minimumSpecialCharacters>0),o(),s("ngIf",e.passwordPolicy.minimumLength>0),o(),s("ngIf",e.passwordPolicy.maximumLength>0)}}function F2(i,m){if(i&1&&b(0,P2,11,6,"div",33),i&2){let e=v();s("ngIf",e.passwordPolicy)}}function A2(i,m){if(i&1&&(r(0,"div",54),p(1),d(2,"translate"),a()),i&2){let e=v().$implicit,n=v(2);o(),h(" ",c(2,1,n.providersData.get(e).description)," ")}}function N2(i,m){if(i&1&&(r(0,"div",54),p(1),d(2,"translate"),a()),i&2){let e=v().$implicit,n=v(2);o(),h(" ",Yt(2,1,n.providersData.get(e).activatedHint,n.providerDataInfo(e))," ")}}function k2(i,m){if(i&1){let e=j();r(0,"mat-checkbox",55),d(1,"async"),_("change",function(t){I(e);let l=v().$implicit,u=v(2);return M(u.changeDefaultProvider(t,l))}),r(2,"span",56),p(3,"security.2fa.main-2fa-method"),a()()}if(i&2){let e=v().$implicit,n=v(2);s("value",e)("checked",n.useByDefault===e)("disabled",c(1,3,n.isLoading$))}}function O2(i,m){if(i&1){let e=j();r(0,"button",57),_("click",function(){I(e);let t=v(3);return M(t.generateNewBackupCode())}),p(1),d(2,"translate"),a()}i&2&&(o(),h(" ",c(2,1,"security.2fa.get-new-code")," "))}function R2(i,m){i&1&&f(0,"mat-divider")}function B2(i,m){if(i&1){let e=j();Gt(0),r(1,"div",47)(2,"h4",48),p(3),d(4,"translate"),a(),r(5,"div",49),b(6,A2,3,3,"div",50)(7,N2,3,4,"ng-template",null,2,It),r(9,"mat-slide-toggle",51),_("mousedown",function(t){let l=I(e).$implicit,u=v(2);return M(u.confirm2FAChange(t,l))}),a()(),b(10,k2,4,5,"mat-checkbox",52)(11,O2,3,3,"button",53),a(),b(12,R2,1,0,"mat-divider",20),Ut()}if(i&2){let e=m.$implicit,n=m.last,t=U(8),l=v(2);o(3),O(c(4,7,l.providersData.get(e).name)),o(3),s("ngIf",!l.twoFactorAuth.get(e).value)("ngIfElse",t),o(3),s("formControlName",e),o(),s("ngIf",l.twoFactorAuth.get(e).value&&e!==l.twoFactorAuthProviderType.BACKUP_CODE&&!l.activeSingleProvider),o(),s("ngIf",l.twoFactorAuth.get(e).value&&e===l.twoFactorAuthProviderType.BACKUP_CODE),o(),s("ngIf",!n)}}function V2(i,m){if(i&1&&(r(0,"mat-card",40)(1,"mat-card-title",41)(2,"span",6),p(3,"admin.2fa.2fa"),a()(),r(4,"mat-card-subtitle",42)(5,"div",43),p(6,"security.2fa.2fa-description"),a()(),r(7,"h3",44),p(8,"security.2fa.authenticate-with"),a(),r(9,"form",45),b(10,B2,13,9,"ng-container",46),a()()),i&2){let e=v();o(9),s("formGroup",e.twoFactorAuth),o(),s("ngForOf",e.allowTwoFactorProviders)("ngForTrackBy",e.trackByProvider)}}var Ll=(()=>{class i extends Mt{get jwtToken(){return`Bearer ${localStorage.getItem("jwt_token")}`}get jwtTokenExpiration(){return localStorage.getItem("jwt_token_expiration")}get expirationJwtData(){let e=this.datePipe.transform(this.jwtTokenExpiration,"yyyy-MM-dd HH:mm:ss");return this.translate.instant("profile.valid-till",{expirationData:e})}constructor(e,n,t,l,u,y,w,x,q,De){super(e),this.store=e,this.route=n,this.translate=t,this.twoFaService=l,this.dialog=u,this.dialogService=y,this.fb=w,this.datePipe=x,this.authService=q,this.clipboardService=De,this.destroy$=new At,this.allowTwoFactorProviders=[],this.providersData=Cs,this.twoFactorAuthProviderType=yt,this.useByDefault=null,this.activeSingleProvider=!0}ngOnInit(){this.buildTwoFactorForm(),this.user=this.route.snapshot.data.user,this.twoFactorLoad(this.route.snapshot.data.providers),this.buildChangePasswordForm(),this.loadPasswordPolicy()}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}buildTwoFactorForm(){this.twoFactorAuth=this.fb.group({TOTP:[!1],SMS:[!1],EMAIL:[!1],BACKUP_CODE:[{value:!1,disabled:!0}]}),this.twoFactorAuth.valueChanges.pipe(lt(this.destroy$)).subscribe(e=>{let n=Object.keys(e).filter(t=>e[t]&&t!==yt.BACKUP_CODE);this.activeSingleProvider=n.length<2,n.length?this.twoFactorAuth.get("BACKUP_CODE").enable({emitEvent:!1}):this.twoFactorAuth.get("BACKUP_CODE").disable({emitEvent:!1})})}twoFactorLoad(e){e.length&&(this.twoFaService.getAccountTwoFaSettings().subscribe(n=>this.processTwoFactorAuthConfig(n)),Object.values(yt).forEach(n=>{e.includes(n)&&this.allowTwoFactorProviders.push(n)}))}processTwoFactorAuthConfig(e){this.accountConfig=e?.configs||{},Object.values(yt).forEach(n=>{this.accountConfig[n]?(this.twoFactorAuth.get(n).setValue(!0),this.accountConfig[n].useByDefault&&(this.useByDefault=n)):this.twoFactorAuth.get(n).setValue(!1)})}buildChangePasswordForm(){this.changePassword=this.fb.group({currentPassword:[""],newPassword:["",S.required],newPassword2:["",this.samePasswordValidation(!1,"newPassword")]})}loadPasswordPolicy(){this.authService.getUserPasswordPolicy().subscribe(e=>{this.passwordPolicy=e,this.changePassword.get("newPassword").setValidators([this.passwordStrengthValidator(),this.samePasswordValidation(!0,"currentPassword"),S.required]),this.changePassword.get("newPassword").updateValueAndValidity({emitEvent:!1})})}passwordStrengthValidator(){return e=>{let n=e.value,t={};return this.passwordPolicy.minimumUppercaseLetters>0&&!new RegExp(`(?:.*?[A-Z]){${this.passwordPolicy.minimumUppercaseLetters}}`).test(n)&&(t.notUpperCase=!0),this.passwordPolicy.minimumLowercaseLetters>0&&!new RegExp(`(?:.*?[a-z]){${this.passwordPolicy.minimumLowercaseLetters}}`).test(n)&&(t.notLowerCase=!0),this.passwordPolicy.minimumDigits>0&&!new RegExp(`(?:.*?\\d){${this.passwordPolicy.minimumDigits}}`).test(n)&&(t.notNumeric=!0),this.passwordPolicy.minimumSpecialCharacters>0&&!new RegExp(`(?:.*?[\\W_]){${this.passwordPolicy.minimumSpecialCharacters}}`).test(n)&&(t.notSpecial=!0),!this.passwordPolicy.allowWhitespaces&&/\s/.test(n)&&(t.hasWhitespaces=!0),this.passwordPolicy.minimumLength>0&&n.length<this.passwordPolicy.minimumLength&&(t.minLength=!0),(!n.length||this.passwordPolicy.maximumLength>0&&n.length>this.passwordPolicy.maximumLength)&&(t.maxLength=!0),Nr(t,{})?null:t}}samePasswordValidation(e,n){return t=>{let l=t.value,u=t.parent?.value[n];return e?l===u?{samePassword:!0}:null:l!==u?{differencePassword:!0}:null}}trackByProvider(e,n){return n}copyToken(){+this.jwtTokenExpiration<Date.now()?this.store.dispatch(new Be({message:this.translate.instant("profile.tokenCopiedWarnMessage"),type:"warn",duration:1500,verticalPosition:"bottom",horizontalPosition:"right"})):(this.clipboardService.copyFromContent(this.jwtToken),this.store.dispatch(new Be({message:this.translate.instant("profile.tokenCopiedSuccessMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"})))}confirm2FAChange(e,n){if(e.stopPropagation(),e.preventDefault(),!this.twoFactorAuth.get(n).disabled)if(this.twoFactorAuth.get(n).value){let t=this.translate.instant(`security.2fa.provider.${n.toLowerCase()}`);this.dialogService.confirm(this.translate.instant("security.2fa.disable-2fa-provider-title",{name:t}),this.translate.instant("security.2fa.disable-2fa-provider-text",{name:t})).subscribe(l=>{l&&(this.twoFactorAuth.disable({emitEvent:!1}),this.twoFaService.deleteTwoFaAccountConfig(n).pipe(xt(()=>this.twoFactorAuth.enable({emitEvent:!1}))).subscribe(u=>this.processTwoFactorAuthConfig(u)))})}else this.createdNewAuthConfig(n)}createdNewAuthConfig(e){let n=e===yt.EMAIL?{email:this.user.email}:{};this.dialog.open(Tg.get(e),{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:n}).afterClosed().subscribe(t=>{Oe(t)&&this.processTwoFactorAuthConfig(t)})}changeDefaultProvider(e,n){this.useByDefault!==n?(this.twoFactorAuth.disable({emitEvent:!1}),this.twoFaService.updateTwoFaAccountConfig(n,!0).pipe(xt(()=>this.twoFactorAuth.enable({emitEvent:!1}))).subscribe(t=>this.processTwoFactorAuthConfig(t))):e.source.checked=!0}generateNewBackupCode(){let e=this.accountConfig[yt.BACKUP_CODE].codesLeft,n;e?n=this.dialogService.confirm("Get new set of backup codes?",`If you get new backup codes, ${e} remaining codes you have left will be unusable.`,"","Get new codes"):n=ut(!0),n.subscribe(t=>{t&&(this.twoFactorAuth.disable({emitEvent:!1}),this.twoFaService.deleteTwoFaAccountConfig(yt.BACKUP_CODE).pipe(xt(()=>this.twoFactorAuth.enable({emitEvent:!1}))).subscribe(()=>this.createdNewAuthConfig(yt.BACKUP_CODE)))})}providerDataInfo(e){let n={info:null},t=this.accountConfig[e];if(Oe(t))switch(e){case yt.EMAIL:n.info=t.email;break;case yt.SMS:n.info=t.phoneNumber;break;case yt.BACKUP_CODE:n.info=t.codesLeft;break}return n}onChangePassword(e){this.changePassword.valid?this.authService.changePassword(this.changePassword.get("currentPassword").value,this.changePassword.get("newPassword").value,{ignoreErrors:!0}).subscribe(()=>{this.discardChanges(e)},n=>{n.status===400&&n.error.message==="Current password doesn't match!"?this.changePassword.get("currentPassword").setErrors({differencePassword:!0}):n.status===400&&n.error.message.startsWith("Password must")?this.loadPasswordPolicy():n.status===400&&n.error.message.startsWith("Password was already used")?this.changePassword.get("newPassword").setErrors({alreadyUsed:n.error.message}):this.store.dispatch(new Be({message:n.error.message,type:"error",target:"changePassword"}))}):this.changePassword.markAllAsTouched()}discardChanges(e,n){n&&n.stopPropagation(),e.resetForm({currentPassword:"",newPassword:"",newPassword2:""})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Vi),g(Z),g(zi),g(je),g(jt),g(de),g(ke),g(Zn),g(Au))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-security"]],features:[L],decls:63,vars:41,consts:[["changePasswordForm","ngForm"],["passwordRequirements",""],["providerInfo",""],[1,"profile-container","flex","flex-col","gap-2"],["appearance","outlined",1,"profile-card","flex","flex-col"],[2,"margin-bottom","8px"],["translate","",1,"mat-headline-5","card-title"],[1,"flex","flex-row","items-center","justify-between"],[1,"token-text"],[1,"date"],["mat-raised-button","","color","primary","type","button",3,"click"],["tb-toast","","toastTarget","changePassword",1,"change-password"],[3,"ngSubmit","formGroup"],[1,"flex","flex-row","gap-6.25","xs:flex-col","xs:gap-0"],[1,"min-w-72.5","max-w-72.5","flex-1","basis-72.5","xs:min-w-0","xs:max-w-full","xs:basis-full","sm:min-w-62.5","sm:max-w-62.5","sm:basis-62.5"],["translate","",1,"card-title"],["appearance","fill","color","primary",1,"mat-block","same-color"],["translate",""],["matInput","","type","password","name","current-password","formControlName","currentPassword","autocomplete","current-password"],["matSuffix",""],[4,"ngIf"],["hideRequiredMarker","","appearance","fill","color","primary","subscriptSizing","dynamic",1,"mat-block","same-color"],["matInput","","type","password","name","new-password","formControlName","newPassword","autocomplete","new-password","required",""],[1,"flex","flex-1","items-center","justify-start","gt-xs:!hidden"],[4,"ngTemplateOutlet"],["hideRequiredMarker","","appearance","fill","color","primary",1,"mat-block","same-color"],["matInput","","type","password","name","new-password","formControlName","newPassword2","autocomplete","new-password","required",""],[3,"vertical"],[1,"flex","flex-1","items-start","justify-start","xs:!hidden"],[1,"flex","flex-row","gap-2",2,"margin-top","18px"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["appearance","outlined","class","profile-card",4,"ngIf"],["class","password-requirements",4,"ngIf"],[1,"password-requirements"],["translate","",1,"mat-h4"],["class","mat-body",4,"ngIf"],[1,"mat-body"],[1,"tb-mat-20"],[1,"tb-mat-20",3,"svgIcon"],["appearance","outlined",1,"profile-card"],[2,"margin-bottom","20px"],[2,"margin-bottom","40px"],["translate","",1,"mat-body-2","description"],["translate","",1,"mat-h3","auth-title"],[3,"formGroup"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"provider"],[1,"provider-title"],[1,"flex","flex-row","items-start","justify-between"],["class","mat-body-2 description",4,"ngIf","ngIfElse"],[3,"mousedown","formControlName"],[3,"value","checked","disabled","change",4,"ngIf"],["type","button","mat-stroked-button","","color","primary",3,"click",4,"ngIf"],[1,"mat-body-2","description"],[3,"change","value","checked","disabled"],["translate","",1,"checkbox-label"],["type","button","mat-stroked-button","","color","primary",3,"click"]],template:function(n,t){if(n&1){let l=j();r(0,"div",3)(1,"mat-card",4)(2,"mat-card-title",5)(3,"span",6),p(4,"profile.jwt-token"),a()(),r(5,"div",7)(6,"div",8),p(7),d(8,"translate"),r(9,"span",9),p(10),d(11,"date"),a()(),r(12,"button",10),_("click",function(){return I(l),M(t.copyToken())}),r(13,"span"),p(14),d(15,"translate"),a()()()(),r(16,"mat-card",4)(17,"div",11)(18,"form",12,0),_("ngSubmit",function(){I(l);let y=U(19);return M(t.onChangePassword(y))}),r(20,"div",13)(21,"div",14)(22,"h3",15),p(23,"profile.change-password"),a(),r(24,"mat-form-field",16)(25,"mat-label",17),p(26,"profile.current-password"),a(),f(27,"input",18)(28,"tb-toggle-password",19),b(29,h2,3,3,"mat-error",20),a(),r(30,"mat-form-field",21)(31,"mat-label",17),p(32,"login.new-password"),a(),f(33,"input",22)(34,"tb-toggle-password",19)(35,"mat-hint"),b(36,b2,3,3,"mat-error",20)(37,v2,2,1,"mat-error",20)(38,y2,3,3,"mat-error",20)(39,_2,3,3,"mat-error",20),a(),r(40,"div",23),b(41,C2,1,0,"ng-container",24),a(),r(42,"mat-form-field",25)(43,"mat-label",17),p(44,"login.new-password-again"),a(),f(45,"input",26)(46,"tb-toggle-password",19),b(47,S2,3,3,"mat-error",20),a()(),f(48,"mat-divider",27),r(49,"div",28),b(50,T2,1,0,"ng-container",24),a()(),b(51,F2,1,1,"ng-template",null,1,It),r(53,"div",29)(54,"button",30),d(55,"async"),_("click",function(y){I(l);let w=U(19);return M(t.discardChanges(w,y))}),p(56),d(57,"translate"),a(),r(58,"button",31),d(59,"async"),p(60),d(61,"translate"),a()()()()(),b(62,V2,11,3,"mat-card",32),a()}if(n&2){let l=U(52);o(7),h("",c(8,26,"profile.token-valid-till")," "),o(3),O(Yt(11,28,t.jwtTokenExpiration,"yyyy-MM-dd HH:mm:ss")),o(4),O(c(15,31,"profile.copy-jwt-token")),o(4),s("formGroup",t.changePassword),o(10),V("!hidden",!t.changePassword.get("currentPassword").dirty&&!t.changePassword.get("currentPassword").touched),o(),s("ngIf",t.changePassword.get("currentPassword").hasError("differencePassword")),o(5),V("!hidden",!t.changePassword.get("newPassword").dirty&&!t.changePassword.get("newPassword").touched),o(2),s("ngIf",t.changePassword.get("newPassword").errors&&!t.changePassword.get("newPassword").hasError("alreadyUsed")&&!t.changePassword.get("newPassword").hasError("hasWhitespaces")&&!t.changePassword.get("newPassword").hasError("samePassword")),o(),s("ngIf",t.changePassword.get("newPassword").hasError("alreadyUsed")),o(),s("ngIf",t.changePassword.get("newPassword").hasError("samePassword")),o(),s("ngIf",t.changePassword.get("newPassword").hasError("hasWhitespaces")),o(2),s("ngTemplateOutlet",l),o(5),V("!hidden",!t.changePassword.get("newPassword2").dirty&&!t.changePassword.get("newPassword2").touched),o(),s("ngIf",t.changePassword.get("newPassword2").hasError("differencePassword")),o(),s("vertical",!0),o(2),s("ngTemplateOutlet",l),o(3),V("!hidden",!t.changePassword.dirty&&!t.changePassword.touched),o(),s("disabled",c(55,33,t.isLoading$)),o(2),h(" ",c(57,35,"action.discard-changes")," "),o(2),s("disabled",c(59,37,t.isLoading$)),o(2),h(" ",c(61,39,"profile.change-password")," "),o(2),s("ngIf",t.allowTwoFactorProviders.length)}},dependencies:[Te,G,Qn,wi,ee,$t,ae,Xt,uu,di,he,me,Ce,Kt,Pe,zt,mn,ht,ce,ge,W,K,ue,ie,se,J,vs,hi,le,ke,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .profile-container[_ngcontent-%COMP%]{padding:8px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{padding:24px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:55%}}@media screen and (min-width: 1920px){[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]{width:45%}}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font:500 18px/24px Roboto,Helvetica Neue,sans-serif;letter-spacing:.15px;margin-top:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .mat-h4[_ngcontent-%COMP%]{font-weight:500;font-size:14px;letter-spacing:.25px;margin:0 0 4px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .mat-divider.mat-divider-vertical[_ngcontent-%COMP%]{margin-bottom:25px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{margin-bottom:4px}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .password-requirements[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{margin:0 0 8px;letter-spacing:.25px;color:#000000de}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .change-password[_ngcontent-%COMP%]   .mat-icon[data-mat-icon-name=check][_ngcontent-%COMP%]{color:#24a148}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .auth-title[_ngcontent-%COMP%]{font-weight:500;margin:0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .token-text[_ngcontent-%COMP%]{font:400 14px/16px Roboto,Helvetica Neue,sans-serif;letter-spacing:.25px;padding:8px 0}[_nghost-%COMP%]   .mat-mdc-card.profile-card[_ngcontent-%COMP%]   .token-text[_ngcontent-%COMP%] > .date[_ngcontent-%COMP%]{opacity:.7}[_nghost-%COMP%]   .description[_ngcontent-%COMP%]{color:#0000008a;letter-spacing:.25px;margin-right:8px}[_nghost-%COMP%]   .mat-divider-horizontal[_ngcontent-%COMP%]{left:16px;right:16px;width:auto}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]{padding:24px 0}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .provider-title[_ngcontent-%COMP%]{font:400 14px/16px Roboto,Helvetica Neue,sans-serif;letter-spacing:.25px;margin:0 0 8px}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{max-width:85%}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .checkbox-label[_ngcontent-%COMP%]{font-size:14px;letter-spacing:.25px;opacity:.87}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:8px}[_nghost-%COMP%]   .provider[_ngcontent-%COMP%]   .mat-mdc-outlined-button[_ngcontent-%COMP%]{margin-top:8px}']})}}return i})();C();var xg=(()=>{class i{constructor(e,n){this.store=e,this.userService=n}resolve(){let e=kt(this.store).userId;return this.userService.getUser(e)}static{this.\u0275fac=function(n){return new(n||i)(D(F),D(Sn))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})(),Eg=(()=>{class i{constructor(e){this.twoFactorAuthService=e}resolve(){return this.twoFactorAuthService.getAvailableTwoFaProviders()}static{this.\u0275fac=function(n){return new(n||i)(D(zi))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})(),Ig=[{path:"security",component:Ll,canDeactivate:[xe],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN,E.CUSTOMER_USER],title:"security.security",breadcrumb:{label:"security.security",icon:"lock"}},resolve:{user:xg,providers:Eg}}],j2=[{path:"security",redirectTo:"/account/security"}],Gl=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[xg,Eg],imports:[B.forChild(j2),B]})}}return i})();(function(){Q(Gl,{imports:[B],exports:[B]})})();var Ul=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,Gl]})}}return i})();(function(){Q(Ul,{declarations:[Ll,Rl,Bl,Vl,jl],imports:[ne,oe,Gl]})})();C();C();C();var ql=(()=>{class i extends Bt{constructor(e,n,t,l,u,y){super(e,n,t,l,u),this.store=e,this.fb=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.cd=u,this.countryData=y,this.destroyRef=qt(ft)}buildForm(e){let n=this.buildEntityForm(e);return n.addControl("country",this.fb.control(e?e.country:"",[S.maxLength(255)])),n.addControl("city",this.fb.control(e?e.city:"",[S.maxLength(255)])),n.addControl("state",this.fb.control(e?e.state:"",[S.maxLength(255)])),n.addControl("zip",this.fb.control(e?e.zip:"",this.zipValidators(e?e.country:""))),n.addControl("address",this.fb.control(e?e.address:"",[])),n.addControl("address2",this.fb.control(e?e.address2:"",[])),n.addControl("phone",this.fb.control(e?e.phone:"",[S.maxLength(255)])),n.addControl("email",this.fb.control(e?e.email:"",[S.email])),n}updateForm(e){this.updateEntityForm(e),this.entityForm.patchValue({country:e.country}),this.entityForm.patchValue({city:e.city}),this.entityForm.patchValue({state:e.state}),this.entityForm.get("zip").setValidators(this.zipValidators(e.country)),this.entityForm.patchValue({zip:e.zip}),this.entityForm.patchValue({address:e.address}),this.entityForm.patchValue({address2:e.address2}),this.entityForm.patchValue({phone:e.phone}),this.entityForm.patchValue({email:e.email})}ngAfterViewInit(){this.entityForm.get("country").valueChanges.pipe(Ne(this.destroyRef)).subscribe(e=>{this.entityForm.get("zip").setValidators(this.zipValidators(e)),this.entityForm.get("zip").updateValueAndValidity({onlySelf:!0}),this.entityForm.get("zip").markAsTouched({onlySelf:!0})})}zipValidators(e){let n=[];if(e){let t=this.countryData.allCountries.find(l=>l.name===e)?.postCodePattern;t&&n.push(S.pattern(t))}return n}static{this.\u0275fac=function(n){fc()}}static{this.\u0275dir=_r({type:i,features:[L]})}}return i})();function U2(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"tenant.title-required")," "))}function q2(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"tenant.title-max-length")," "))}function W2(i,m){if(i&1&&(r(0,"section",17)(1,"section",18),f(2,"tb-dashboard-autocomplete",19),d(3,"translate"),r(4,"mat-checkbox",20),p(5),d(6,"translate"),a()()()),i&2){let e=v();o(2),T("label",c(3,5,"dashboard.home-dashboard")),s("dashboardsScope","tenant")("tenantId",e.entity==null?null:e.entity.id.id)("selectFirstDashboard",!1),o(3),h(" ",c(6,7,"dashboard.home-dashboard-hide-toolbar")," ")}}var Wl=(()=>{class i extends ql{constructor(e,n,t,l,u,y,w){super(e,u,t,l,y,w),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.fb=u,this.cd=y,this.countryData=w}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildEntityForm(e){return this.fb.group({title:[e?e.title:"",[S.required,S.maxLength(255)]],tenantProfileId:[e?e.tenantProfileId:null,[S.required]],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""],homeDashboardId:[e&&e.additionalInfo?e.additionalInfo.homeDashboardId:null],homeDashboardHideToolbar:[e&&e.additionalInfo&&Oe(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0]})})}updateEntityForm(e){this.entityForm.patchValue({title:e.title}),this.entityForm.patchValue({tenantProfileId:e.tenantProfileId}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),this.entityForm.patchValue({additionalInfo:{homeDashboardId:e.additionalInfo?e.additionalInfo.homeDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{homeDashboardHideToolbar:e.additionalInfo&&Oe(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0}})}updateFormState(){this.entityForm&&(this.isEditValue?this.entityForm.enable({emitEvent:!1}):this.entityForm.disable({emitEvent:!1}))}onTenantIdCopied(e){this.store.dispatch(new Be({message:this.translate.instant("tenant.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onTenantProfileUpdated(){this.entitiesTableConfig.updateData(!1)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g("entity"),g("entitiesTableConfig"),g(de),g(Qe),g(hs))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-tenant"]],features:[L],decls:36,vars:38,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["required","","formControlName","tenantProfileId",3,"tenantProfileUpdated","selectDefaultProfile","showDetailsPageLink"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["class","tb-default-dashboard flex flex-1 flex-col",4,"ngIf"],[3,"parentForm","isEdit"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"button",1),d(2,"async"),_("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),a(),r(5,"button",1),d(6,"async"),_("click",function(u){return t.onEntityAction(u,"manageTenantAdmins")}),p(7),d(8,"translate"),a(),r(9,"button",1),d(10,"async"),_("click",function(u){return t.onEntityAction(u,"delete")}),p(11),d(12,"translate"),a(),r(13,"div",2)(14,"button",3),_("cbOnSuccess",function(u){return t.onTenantIdCopied(u)}),f(15,"mat-icon",4),r(16,"span",5),p(17,"tenant.copyId"),a()()()(),r(18,"div",6)(19,"form",7)(20,"fieldset",8),d(21,"async"),r(22,"mat-form-field",9)(23,"mat-label",5),p(24,"tenant.title"),a(),f(25,"input",10),b(26,U2,3,3,"mat-error",11)(27,q2,3,3,"mat-error",11),a(),r(28,"tb-tenant-profile-autocomplete",12),_("tenantProfileUpdated",function(){return t.onTenantProfileUpdated()}),a(),r(29,"div",13)(30,"mat-form-field",9)(31,"mat-label",5),p(32,"tenant.description"),a(),f(33,"textarea",14),a(),b(34,W2,7,9,"section",15),a(),f(35,"tb-contact",16),a()()()),n&2&&(o(),V("!hidden",t.isEdit||t.isDetailsPage),s("disabled",c(2,24,t.isLoading$)),o(2),h(" ",c(4,26,"common.open-details-page")," "),o(2),V("!hidden",t.isEdit),s("disabled",c(6,28,t.isLoading$)),o(2),h(" ",c(8,30,"tenant.manage-tenant-admins")," "),o(2),V("!hidden",t.hideDelete()||t.isEdit),s("disabled",c(10,32,t.isLoading$)),o(2),h(" ",c(12,34,"tenant.delete")," "),o(3),V("!hidden",t.isEdit),s("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),s("formGroup",t.entityForm),o(),s("disabled",c(21,36,t.isLoading$)||!t.isEdit),o(6),s("ngIf",t.entityForm.get("title").hasError("required")),o(),s("ngIf",t.entityForm.get("title").hasError("maxlength")),o(),s("selectDefaultProfile",t.isAdd)("showDetailsPageLink",!0),o(6),s("ngIf",t.entity==null?null:t.entity.id),o(),s("parentForm",t.entityForm)("isEdit",t.isEdit))},dependencies:[G,dn,ee,$t,ae,he,me,Ce,Pe,Jt,ce,ge,W,K,ue,ie,se,bt,J,bs,Ff,le,R],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']})}}return i})();C();C();C();function H2(i,m){if(i&1&&(r(0,"mat-tab",6,0),d(2,"translate"),f(3,"tb-attribute-table",7),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),s("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function z2(i,m){if(i&1&&(r(0,"mat-tab",6,1),d(2,"translate"),f(3,"tb-attribute-table",8),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),s("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function $2(i,m){if(i&1&&(r(0,"mat-tab",6,2),d(2,"translate"),f(3,"tb-alarm-table",9),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function J2(i,m){if(i&1&&(r(0,"mat-tab",6,3),d(2,"translate"),f(3,"tb-event-table",10),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"tenant.events")),o(3),s("defaultEventType",n.eventTypes.ERROR)("active",e.isActive)("tenantId",n.nullUid)("entityId",n.entity.id)}}function Q2(i,m){if(i&1&&(r(0,"mat-tab",6,4),d(2,"translate"),f(3,"tb-relation-table",9),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}var Hl=(()=>{class i extends Lt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-tenant-tabs"]],features:[L],decls:5,vars:5,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"]],template:function(n,t){n&1&&b(0,H2,4,7,"mat-tab",5)(1,z2,4,7,"mat-tab",5)(2,$2,4,5,"mat-tab",5)(3,J2,4,7,"mat-tab",5)(4,Q2,4,5,"mat-tab",5),n&2&&(s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity))},dependencies:[G,St,$i,Ai,vi,yi,R],encapsulation:2})}}return i})();var zl=(()=>{class i{constructor(e,n,t,l){this.tenantService=e,this.translate=n,this.datePipe=t,this.router=l,this.config=new Ge,this.config.entityType=k.TENANT,this.config.entityComponent=Wl,this.config.entityTabsComponent=Hl,this.config.entityTranslations=Ue.get(k.TENANT),this.config.entityResources=tt.get(k.TENANT),this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("title","tenant.title","20%"),new Y("tenantProfileName","tenant-profile.tenant-profile","20%"),new Y("email","contact.email","20%"),new Y("country","contact.country","20%"),new Y("city","contact.city","20%")),this.config.cellActionDescriptors.push({name:this.translate.instant("tenant.manage-tenant-admins"),icon:"account_circle",isEnabled:()=>!0,onAction:(u,y)=>this.manageTenantAdmins(u,y)}),this.config.deleteEntityTitle=u=>this.translate.instant("tenant.delete-tenant-title",{tenantTitle:u.title}),this.config.deleteEntityContent=()=>this.translate.instant("tenant.delete-tenant-text"),this.config.deleteEntitiesTitle=u=>this.translate.instant("tenant.delete-tenants-title",{count:u}),this.config.deleteEntitiesContent=()=>this.translate.instant("tenant.delete-tenants-text"),this.config.entitiesFetchFunction=u=>this.tenantService.getTenantInfos(u),this.config.loadEntity=u=>this.tenantService.getTenantInfo(u.id),this.config.saveEntity=u=>this.tenantService.saveTenant(u).pipe(_t(y=>this.tenantService.getTenantInfo(y.id.id))),this.config.deleteEntity=u=>this.tenantService.deleteTenant(u.id),this.config.onEntityAction=u=>this.onTenantAction(u,this.config)}resolve(){return this.config.tableTitle=this.translate.instant("tenant.tenants"),this.config}openTenant(e,n,t){e&&e.stopPropagation();let l=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(l)}manageTenantAdmins(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`tenants/${n.id.id}/users`)}onTenantAction(e,n){switch(e.action){case"open":return this.openTenant(e.event,e.entity,n),!0;case"manageTenantAdmins":return this.manageTenantAdmins(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(D(es),D(Z),D(ke),D(pe))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();C();function K2(i,m){if(i&1){let e=j();r(0,"button",1),d(1,"async"),_("click",function(t){I(e);let l=v();return M(l.onEntityAction(t,"loginAsUser"))}),p(2),d(3,"translate"),a()}if(i&2){let e=v();V("!hidden",e.isEdit),s("disabled",c(1,4,e.isLoading$)),o(2),h(" ",c(3,6,(e.entity==null?null:e.entity.authority)===e.authority.TENANT_ADMIN?"user.login-as-tenant-admin":"user.login-as-customer-user")," ")}}function X2(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"user.invalid-email-format")," "))}function Z2(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"user.email-required")," "))}function eS(i,m){if(i&1&&(r(0,"section",19)(1,"section",20),f(2,"tb-dashboard-autocomplete",21),d(3,"translate"),r(4,"mat-checkbox",22),p(5),d(6,"translate"),a()(),r(7,"section",20),f(8,"tb-dashboard-autocomplete",23),d(9,"translate"),r(10,"mat-checkbox",24),p(11),d(12,"translate"),a()()()),i&2){let e=v();o(2),T("label",c(3,12,"user.default-dashboard")),s("dashboardsScope",(e.entity==null?null:e.entity.authority)===e.authority.TENANT_ADMIN?"tenant":"customer")("tenantId",e.entity==null||e.entity.tenantId==null?null:e.entity.tenantId.id)("customerId",e.entity==null||e.entity.customerId==null?null:e.entity.customerId.id)("selectFirstDashboard",!1),o(3),h(" ",c(6,14,"user.always-fullscreen")," "),o(3),T("label",c(9,16,"dashboard.home-dashboard")),s("dashboardsScope",(e.entity==null?null:e.entity.authority)===e.authority.TENANT_ADMIN?"tenant":"customer")("tenantId",e.entity==null||e.entity.tenantId==null?null:e.entity.tenantId.id)("customerId",e.entity==null||e.entity.customerId==null?null:e.entity.customerId.id)("selectFirstDashboard",!1),o(3),h(" ",c(12,18,"dashboard.home-dashboard-hide-toolbar")," ")}}var go=(()=>{class i extends Bt{constructor(e,n,t,l,u,y){super(e,l,n,t,u),this.store=e,this.entityValue=n,this.entitiesTableConfigValue=t,this.fb=l,this.cd=u,this.translate=y,this.authority=E,this.loginAsUserEnabled$=this.store.pipe(Wt(kr),ze(w=>w.userTokenAccessEnabled))}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isUserCredentialsEnabled(){return this.entity?.additionalInfo?.userCredentialsEnabled===!0}isUserActivated(){return this.entity?.additionalInfo?.userActivated===!0}buildForm(e){return this.fb.group({email:[e?e.email:"",[S.required,S.email]],firstName:[e?e.firstName:""],lastName:[e?e.lastName:""],phone:[e?e.phone:""],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""],defaultDashboardId:[e&&e.additionalInfo?e.additionalInfo.defaultDashboardId:null],defaultDashboardFullscreen:[e&&e.additionalInfo?e.additionalInfo.defaultDashboardFullscreen:!1],homeDashboardId:[e&&e.additionalInfo?e.additionalInfo.homeDashboardId:null],homeDashboardHideToolbar:[e&&e.additionalInfo&&Oe(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0]})})}updateForm(e){this.entityForm.patchValue({email:e.email}),this.entityForm.patchValue({firstName:e.firstName}),this.entityForm.patchValue({lastName:e.lastName}),this.entityForm.patchValue({phone:e.phone}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),this.entityForm.patchValue({additionalInfo:{defaultDashboardId:e.additionalInfo?e.additionalInfo.defaultDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{defaultDashboardFullscreen:e.additionalInfo?e.additionalInfo.defaultDashboardFullscreen:!1}}),this.entityForm.patchValue({additionalInfo:{homeDashboardId:e.additionalInfo?e.additionalInfo.homeDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{homeDashboardHideToolbar:e.additionalInfo&&Oe(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0}})}onUserIdCopied(e){this.store.dispatch(new Be({message:this.translate.instant("user.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}static{this.\u0275fac=function(n){return new(n||i)(g(F),g("entity",8),g("entitiesTableConfig",8),g(de),g(Qe),g(Z))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-user"]],features:[L],decls:59,vars:69,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",3,"disabled","!hidden","click",4,"ngIf"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent","disabled"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","type","email","formControlName","email","required",""],[4,"ngIf"],["matInput","","formControlName","firstName"],["matInput","","formControlName","lastName"],["formControlName","phone",3,"required","label","enableFlagsSelect"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["class","tb-default-dashboard flex flex-1 flex-col",4,"ngIf"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","defaultDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","customerId","selectFirstDashboard"],["formControlName","defaultDashboardFullscreen",1,"flex-1"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","tenantId","customerId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"button",1),d(2,"async"),_("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),a(),r(5,"button",1),d(6,"async"),_("click",function(u){return t.onEntityAction(u,"disableAccount")}),p(7),d(8,"translate"),a(),r(9,"button",1),d(10,"async"),_("click",function(u){return t.onEntityAction(u,"enableAccount")}),p(11),d(12,"translate"),a(),r(13,"button",1),d(14,"async"),_("click",function(u){return t.onEntityAction(u,"displayActivationLink")}),p(15),d(16,"translate"),a(),r(17,"button",1),d(18,"async"),_("click",function(u){return t.onEntityAction(u,"resendActivation")}),p(19),d(20,"translate"),a(),b(21,K2,4,8,"button",2),d(22,"async"),r(23,"button",1),d(24,"async"),_("click",function(u){return t.onEntityAction(u,"delete")}),p(25),d(26,"translate"),a(),r(27,"div",3)(28,"button",4),d(29,"async"),_("cbOnSuccess",function(u){return t.onUserIdCopied(u)}),f(30,"mat-icon",5),r(31,"span",6),p(32,"user.copyId"),a()()()(),r(33,"div",7)(34,"form",8)(35,"fieldset",9),d(36,"async"),r(37,"mat-form-field",10)(38,"mat-label",6),p(39,"user.email"),a(),f(40,"input",11),b(41,X2,3,3,"mat-error",12)(42,Z2,3,3,"mat-error",12),a(),r(43,"mat-form-field",10)(44,"mat-label",6),p(45,"user.first-name"),a(),f(46,"input",13),a(),r(47,"mat-form-field",10)(48,"mat-label",6),p(49,"user.last-name"),a(),f(50,"input",14),a(),f(51,"tb-phone-input",15),d(52,"translate"),r(53,"div",16)(54,"mat-form-field",10)(55,"mat-label",6),p(56,"user.description"),a(),f(57,"textarea",17),a(),b(58,eS,13,20,"section",18),a()()()()),n&2&&(o(),V("!hidden",t.isEdit||t.isDetailsPage),s("disabled",c(2,37,t.isLoading$)),o(2),h(" ",c(4,39,"common.open-details-page")," "),o(2),V("!hidden",t.isEdit||!t.isUserActivated()||!t.isUserCredentialsEnabled()),s("disabled",c(6,41,t.isLoading$)),o(2),h(" ",c(8,43,"user.disable-account")," "),o(2),V("!hidden",t.isEdit||!t.isUserActivated()||t.isUserCredentialsEnabled()),s("disabled",c(10,45,t.isLoading$)),o(2),h(" ",c(12,47,"user.enable-account")," "),o(2),V("!hidden",t.isEdit||t.isUserActivated()),s("disabled",c(14,49,t.isLoading$)),o(2),h(" ",c(16,51,"user.display-activation-link")," "),o(2),V("!hidden",t.isEdit||t.isUserActivated()),s("disabled",c(18,53,t.isLoading$)),o(2),h(" ",c(20,55,"user.resend-activation")," "),o(2),s("ngIf",c(22,57,t.loginAsUserEnabled$)),o(2),V("!hidden",t.hideDelete()||t.isEdit),s("disabled",c(24,59,t.isLoading$)),o(2),h(" ",c(26,61,"user.delete")," "),o(3),V("!hidden",t.isEdit),s("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id)("disabled",c(29,63,t.isLoading$)),o(6),s("formGroup",t.entityForm),o(),s("disabled",c(36,65,t.isLoading$)||!t.isEdit),o(6),s("ngIf",t.entityForm.get("email").hasError("email")),o(),s("ngIf",t.entityForm.get("email").hasError("required")),o(9),T("label",c(52,67,"contact.phone")),s("required",!1)("enableFlagsSelect",!0),o(7),s("ngIf",t.entity==null?null:t.entity.id))},dependencies:[G,dn,ee,$t,ae,he,me,Ce,Pe,Jt,ce,ge,W,K,ue,ie,se,bt,J,ao,le,R],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']})}}return i})();C();C();var iS=(i,m)=>({activationLink:i,activationLinkTtl:m});function nS(i,m){i&1&&f(0,"mat-progress-bar",17)}function oS(i,m){i&1&&f(0,"div",18)}var ja=(()=>{class i extends nt{constructor(e,n,t,l,u,y){super(e,n,l),this.store=e,this.router=n,this.data=t,this.dialogRef=l,this.translate=u,this.millisecondsToTimeStringPipe=y,this.activationLink=this.data.activationLinkInfo.value,this.activationLinkTtl=this.millisecondsToTimeStringPipe.transform(this.data.activationLinkInfo.ttlMs)}close(){this.dialogRef.close()}onActivationLinkCopied(){this.store.dispatch(new Be({message:this.translate.instant("user.activation-link-copied-message"),type:"success",target:"activationLinkDialogContent",duration:1200,verticalPosition:"bottom",horizontalPosition:"left"}))}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(Ot),g(it),g(Z),g(wu))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-activation-link-dialog"]],features:[L],decls:28,vars:24,consts:[[2,"min-width","400px","position","relative"],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","","tb-toast","","toastTarget","activationLinkDialogContent"],[1,"mat-content","flex","flex-col"],[3,"innerHTML"],[1,"flex","flex-row","items-center","justify-start"],[1,"tb-highlight","flex-1"],["mat-icon-button","","color","primary","ngxClipboard","","matTooltipPosition","above",3,"cbOnSuccess","cbContent","matTooltip"],["svgIcon","mdi:clipboard-arrow-left"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"]],template:function(n,t){n&1&&(r(0,"form",0)(1,"mat-toolbar",1)(2,"h2",2),p(3,"user.activation-link"),a(),f(4,"span",3),r(5,"button",4),_("click",function(){return t.close()}),r(6,"mat-icon",5),p(7,"close"),a()()(),b(8,nS,1,0,"mat-progress-bar",6),d(9,"async"),b(10,oS,1,0,"div",7),d(11,"async"),r(12,"div",8)(13,"div",9),f(14,"span",10),d(15,"translate"),r(16,"div",11)(17,"pre",12)(18,"code"),p(19),a()(),r(20,"button",13),d(21,"translate"),_("cbOnSuccess",function(){return t.onActivationLinkCopied()}),f(22,"mat-icon",14),a()()()(),r(23,"div",15)(24,"button",16),d(25,"async"),_("click",function(){return t.close()}),p(26),d(27,"translate"),a()()()),n&2&&(o(8),s("ngIf",c(9,8,t.isLoading$)),o(2),s("ngIf",!c(11,10,t.isLoading$)),o(4),s("innerHTML",Yt(15,12,"user.activation-link-text",Sr(21,iS,t.activationLink,t.activationLinkTtl)),zn),o(5),O(t.activationLink),o(),T("cbContent",t.activationLink),T("matTooltip",c(21,15,"user.copy-activation-link")),o(4),s("disabled",c(25,17,t.isLoading$)),o(2),h(" ",c(27,19,"action.ok")," "))},dependencies:[G,wi,ee,Ee,ae,qe,at,Rt,mt,Pt,Jt,ce,K,En,J,le,R],encapsulation:2})}}return i})();var aS=()=>({standalone:!0});function rS(i,m){i&1&&f(0,"mat-progress-bar",16)}function sS(i,m){i&1&&f(0,"div",17)}function lS(i,m){if(i&1&&(r(0,"mat-option",18),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.activationMethodTranslations.get(n.activationMethodEnum[e]))," ")}}var $l=(()=>{class i extends nt{constructor(e,n,t,l,u,y){super(e,n,l),this.store=e,this.router=n,this.data=t,this.dialogRef=l,this.userService=u,this.dialog=y,this.activationMethods=Object.keys(Ea),this.activationMethodEnum=Ea,this.activationMethodTranslations=uf,this.activationMethod=Ea.DISPLAY_ACTIVATION_LINK}ngOnInit(){this.user={},this.userComponent.isEdit=!0,this.userComponent.entity=this.user,this.detailsForm=this.userComponent.entityForm}cancel(){this.dialogRef.close(null)}add(){if(this.detailsForm.valid){this.user=_e(_e({},this.user),this.userComponent.entityForm.value),this.user.authority=this.data.authority,this.user.tenantId=new Rr(this.data.tenantId),this.user.customerId=new Ko(this.data.customerId);let e=this.activationMethod===Ea.SEND_ACTIVATION_MAIL;this.userService.saveUser(this.user,e).subscribe(n=>{this.activationMethod===Ea.DISPLAY_ACTIVATION_LINK?this.userService.getActivationLinkInfo(n.id.id).subscribe(t=>{this.displayActivationLink(t).subscribe(()=>{this.dialogRef.close(n)})}):this.dialogRef.close(n)})}}displayActivationLink(e){return this.dialog.open(ja,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{activationLinkInfo:e}}).afterClosed()}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(Ot),g(it),g(Sn),g(je))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-add-user-dialog"]],viewQuery:function(n,t){if(n&1&&Ie(go,7),n&2){let l;Me(l=we())&&(t.userComponent=l.first)}},features:[L],decls:29,vars:23,consts:[[2,"min-width","450px",3,"ngSubmit"],["color","primary"],["translate",""],[1,"flex-1"],[3,"tb-help"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content",""],[1,"mat-block"],[3,"ngModelChange","ngModelOptions","ngModel"],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions","",1,"flex","items-center","justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"]],template:function(n,t){n&1&&(r(0,"form",0),_("ngSubmit",function(){return t.add()}),r(1,"mat-toolbar",1)(2,"h2",2),p(3,"user.add"),a(),f(4,"span",3)(5,"div",4),r(6,"button",5),_("click",function(){return t.cancel()}),r(7,"mat-icon",6),p(8,"close"),a()()(),b(9,rS,1,0,"mat-progress-bar",7),d(10,"async"),b(11,sS,1,0,"div",8),d(12,"async"),r(13,"div",9),f(14,"tb-user"),r(15,"mat-form-field",10)(16,"mat-label",2),p(17,"user.activation-method"),a(),r(18,"mat-select",11),et("ngModelChange",function(u){return Ze(t.activationMethod,u)||(t.activationMethod=u),u}),b(19,lS,3,4,"mat-option",12),a()()(),r(20,"div",13)(21,"button",14),d(22,"async"),_("click",function(){return t.cancel()}),p(23),d(24,"translate"),a(),r(25,"button",15),d(26,"async"),p(27),d(28,"translate"),a()()()),n&2&&(o(5),s("tb-help","users"),o(4),s("ngIf",c(10,10,t.isLoading$)),o(2),s("ngIf",!c(12,12,t.isLoading$)),o(7),s("ngModelOptions",Et(22,aS)),Xe("ngModel",t.activationMethod),o(),s("ngForOf",t.activationMethods),o(2),s("disabled",c(22,14,t.isLoading$)),o(2),h(" ",c(24,16,"action.cancel")," "),o(2),s("disabled",c(26,18,t.isLoading$)||t.detailsForm.invalid||!t.detailsForm.dirty),o(2),h(" ",c(28,20,"action.add")," "))},dependencies:[Te,G,wt,ee,Ee,ae,qe,me,Ce,at,Rt,mt,vt,gt,ce,W,K,Ye,En,J,go,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]     .mat-padding{padding:0}']})}}return i})();C();function pS(i,m){if(i&1&&(r(0,"mat-tab",5,0),d(2,"translate"),f(3,"tb-attribute-table",6),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),s("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function mS(i,m){if(i&1&&(r(0,"mat-tab",5,1),d(2,"translate"),f(3,"tb-attribute-table",7),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),s("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function dS(i,m){if(i&1&&(r(0,"mat-tab",5,2),d(2,"translate"),f(3,"tb-relation-table",8),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function cS(i,m){if(i&1&&(r(0,"mat-tab",5,3),d(2,"translate"),f(3,"tb-audit-log-table",9),a()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),s("active",e.isActive)("auditLogMode",n.auditLogModes.USER)("userId",n.entity.id)}}var Jl=(()=>{class i extends Lt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-user-tabs"]],features:[L],decls:4,vars:4,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],["detailsMode","true",3,"active","auditLogMode","userId"]],template:function(n,t){n&1&&b(0,pS,4,7,"mat-tab",4)(1,mS,4,7,"mat-tab",4)(2,dS,4,5,"mat-tab",4)(3,cS,4,6,"mat-tab",4),n&2&&(s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[G,St,ri,Ai,yi,R],encapsulation:2})}}return i})();var Wn=(()=>{class i{constructor(e,n,t,l,u,y,w,x,q){this.store=e,this.userService=n,this.authService=t,this.tenantService=l,this.customerService=u,this.translate=y,this.datePipe=w,this.router=x,this.dialog=q,this.config=new Ge,this.config.entityType=k.USER,this.config.entityComponent=go,this.config.entityTabsComponent=Jl,this.config.entityTranslations=Ue.get(k.USER),this.config.entityResources=tt.get(k.USER),this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("firstName","user.first-name","33%"),new Y("lastName","user.last-name","33%"),new Y("email","user.email","33%")),this.config.deleteEnabled=De=>De&&De.id&&De.id.id!==this.authUser.id.id,this.config.deleteEntityTitle=De=>this.translate.instant("user.delete-user-title",{userEmail:De.email}),this.config.deleteEntityContent=()=>this.translate.instant("user.delete-user-text"),this.config.deleteEntitiesTitle=De=>this.translate.instant("user.delete-users-title",{count:De}),this.config.deleteEntitiesContent=()=>this.translate.instant("user.delete-users-text"),this.config.loadEntity=De=>this.userService.getUser(De.id),this.config.saveEntity=De=>this.saveUser(De),this.config.deleteEntity=De=>this.userService.deleteUser(De.id),this.config.onEntityAction=De=>this.onUserAction(De,this.config),this.config.addEntity=()=>this.addUser()}resolve(e){let n=e.params;return this.store.pipe(Wt(kr),ti(1)).pipe(xt(t=>{this.authUser=t.userDetails,this.authority=n.tenantId?E.TENANT_ADMIN:E.CUSTOMER_USER,this.authority===E.TENANT_ADMIN?(this.tenantId=n.tenantId,this.customerId=Ae,this.config.entitiesFetchFunction=l=>this.userService.getTenantAdmins(this.tenantId,l)):(this.tenantId=this.authUser.tenantId.id,this.customerId=n.customerId,this.config.entitiesFetchFunction=l=>this.userService.getCustomerUsers(this.customerId,l)),this.updateActionCellDescriptors(t)}),_t(()=>this.authority===E.TENANT_ADMIN?this.tenantService.getTenant(this.tenantId):Oe(this.customerId)?this.customerService.getCustomer(this.customerId):ut({title:""})),ze(t=>(this.authority===E.TENANT_ADMIN?this.config.tableTitle=t.title+": "+this.translate.instant("user.tenant-admins"):this.config.tableTitle=t.title+": "+this.translate.instant("user.customer-users"),this.config)))}updateActionCellDescriptors(e){this.config.cellActionDescriptors.splice(0),e.userTokenAccessEnabled&&this.config.cellActionDescriptors.push({name:this.authority===E.TENANT_ADMIN?this.translate.instant("user.login-as-tenant-admin"):this.translate.instant("user.login-as-customer-user"),icon:"mdi:login",isEnabled:()=>!0,onAction:(n,t)=>this.loginAsUser(n,t)})}saveUser(e){return e.tenantId=new Rr(this.tenantId),e.customerId=new Ko(this.customerId),e.authority=this.authority,this.userService.saveUser(e)}addUser(){return this.dialog.open($l,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{tenantId:this.tenantId,customerId:this.customerId,authority:this.authority}}).afterClosed()}openUser(e,n,t){e&&e.stopPropagation();let l=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(l)}loginAsUser(e,n){e&&e.stopPropagation(),this.authService.loginAsUser(n.id.id).subscribe()}displayActivationLink(e,n){e&&e.stopPropagation(),this.userService.getActivationLinkInfo(n.id.id).subscribe(t=>{this.dialog.open(ja,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{activationLinkInfo:t}})})}resendActivation(e,n){e&&e.stopPropagation(),this.userService.sendActivationEmail(n.email).subscribe(()=>{this.store.dispatch(new Be({message:this.translate.instant("user.activation-email-sent-message"),type:"success"}))})}setUserCredentialsEnabled(e,n,t){e&&e.stopPropagation(),this.userService.setUserCredentialsEnabled(n.id.id,t).subscribe(()=>{n.additionalInfo||(n.additionalInfo={}),n.additionalInfo.userCredentialsEnabled=t,this.store.dispatch(new Be({message:this.translate.instant(t?"user.enable-account-message":"user.disable-account-message"),type:"success"}))})}onUserAction(e,n){switch(e.action){case"open":return this.openUser(e.event,e.entity,n),!0;case"loginAsUser":return this.loginAsUser(e.event,e.entity),!0;case"displayActivationLink":return this.displayActivationLink(e.event,e.entity),!0;case"resendActivation":return this.resendActivation(e.event,e.entity),!0;case"disableAccount":return this.setUserCredentialsEnabled(e.event,e.entity,!1),!0;case"enableAccount":return this.setUserCredentialsEnabled(e.event,e.entity,!0),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(D(F),D(Sn),D(Zn),D(es),D(Wi),D(Z),D(ke),D(pe),D(je))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var uS=[{path:"tenants",data:{breadcrumb:{menuId:be.tenants}},children:[{path:"",component:Le,data:{auth:[E.SYS_ADMIN],title:"tenant.tenants"},resolve:{entitiesTableConfig:zl}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"supervisor_account"},auth:[E.SYS_ADMIN],title:"tenant.tenants"},resolve:{entitiesTableConfig:zl}},{path:":tenantId/users",data:{breadcrumb:{label:"user.tenant-admins",icon:"account_circle"}},children:[{path:"",component:Le,data:{auth:[E.SYS_ADMIN],title:"user.tenant-admins"},resolve:{entitiesTableConfig:Wn}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"account_circle"},auth:[E.SYS_ADMIN],title:"user.tenant-admins"},resolve:{entitiesTableConfig:Wn}}]}]}],Ql=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[zl],imports:[B.forChild(uS),B]})}}return i})();(function(){Q(Ql,{imports:[B],exports:[B]})})();var Yl=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,Ql]})}}return i})();(function(){Q(Yl,{declarations:[Wl,Hl],imports:[ne,oe,ve,Ql]})})();C();C();function fS(i,m){if(i&1){let e=j();r(0,"button",1),d(1,"async"),_("click",function(t){I(e);let l=v();return M(l.onEntityAction(t,"manageEdges"))}),p(2),d(3,"translate"),a()}if(i&2){let e=v();V("!hidden",e.isEdit),s("disabled",c(1,4,e.isLoading$)),o(2),h(" ",c(3,6,"customer.manage-edges")," ")}}function gS(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"customer.title-required")," "))}function hS(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"customer.title-max-length")," "))}function bS(i,m){if(i&1&&(r(0,"section",17)(1,"section",18),f(2,"tb-dashboard-autocomplete",19),d(3,"translate"),r(4,"mat-checkbox",20),p(5),d(6,"translate"),a()()()),i&2){let e=v();o(2),T("label",c(3,5,"dashboard.home-dashboard")),s("dashboardsScope","customer")("customerId",e.entity==null?null:e.entity.id.id)("selectFirstDashboard",!1),o(3),h(" ",c(6,7,"dashboard.home-dashboard-hide-toolbar")," ")}}var Kl=(()=>{class i extends ql{constructor(e,n,t,l,u,y,w){super(e,u,t,l,y,w),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.fb=u,this.cd=y,this.countryData=w,this.isPublic=!1,this.authState=Li(this.store)}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildEntityForm(e){return this.fb.group({title:[e?e.title:"",[S.required,S.maxLength(255)]],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""],homeDashboardId:[e&&e.additionalInfo?e.additionalInfo.homeDashboardId:null],homeDashboardHideToolbar:[e&&e.additionalInfo&&Oe(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0]})})}updateEntityForm(e){this.isPublic=e.additionalInfo&&e.additionalInfo.isPublic,this.entityForm.patchValue({title:e.title}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),this.entityForm.patchValue({additionalInfo:{homeDashboardId:e.additionalInfo?e.additionalInfo.homeDashboardId:null}}),this.entityForm.patchValue({additionalInfo:{homeDashboardHideToolbar:e.additionalInfo&&Oe(e.additionalInfo.homeDashboardHideToolbar)?e.additionalInfo.homeDashboardHideToolbar:!0}})}onCustomerIdCopied(e){this.store.dispatch(new Be({message:this.translate.instant("customer.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}edgesSupportEnabled(){return this.authState.edgesSupportEnabled}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g("entity"),g("entitiesTableConfig"),g(de),g(Qe),g(hs))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-customer"]],features:[L],decls:48,vars:63,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","primary",3,"disabled","!hidden","click",4,"ngIf"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"],["class","tb-default-dashboard flex flex-1 flex-col",4,"ngIf"],[3,"parentForm","isEdit"],[1,"tb-default-dashboard","flex","flex-1","flex-col"],[1,"flex","flex-1","flex-col","gt-sm:flex-row"],["formControlName","homeDashboardId",1,"flex-1",3,"label","dashboardsScope","customerId","selectFirstDashboard"],["formControlName","homeDashboardHideToolbar",1,"flex-1"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"button",1),d(2,"async"),_("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),a(),r(5,"button",1),d(6,"async"),_("click",function(u){return t.onEntityAction(u,"manageUsers")}),p(7),d(8,"translate"),a(),r(9,"button",1),d(10,"async"),_("click",function(u){return t.onEntityAction(u,"manageAssets")}),p(11),d(12,"translate"),a(),r(13,"button",1),d(14,"async"),_("click",function(u){return t.onEntityAction(u,"manageDevices")}),p(15),d(16,"translate"),a(),r(17,"button",1),d(18,"async"),_("click",function(u){return t.onEntityAction(u,"manageDashboards")}),p(19),d(20,"translate"),a(),b(21,fS,4,8,"button",2),r(22,"button",1),d(23,"async"),_("click",function(u){return t.onEntityAction(u,"delete")}),p(24),d(25,"translate"),a(),r(26,"div",3)(27,"button",4),_("cbOnSuccess",function(u){return t.onCustomerIdCopied(u)}),f(28,"mat-icon",5),r(29,"span",6),p(30,"customer.copyId"),a()()()(),r(31,"div",7)(32,"form",8)(33,"fieldset",9),d(34,"async"),r(35,"mat-form-field",10)(36,"mat-label",6),p(37,"customer.title"),a(),f(38,"input",11),b(39,gS,3,3,"mat-error",12)(40,hS,3,3,"mat-error",12),a(),r(41,"div",13)(42,"mat-form-field",10)(43,"mat-label",6),p(44,"customer.description"),a(),f(45,"textarea",14),a(),b(46,bS,7,9,"section",15),a(),f(47,"tb-contact",16),a()()()),n&2&&(o(),V("!hidden",t.isEdit||t.isDetailsPage),s("disabled",c(2,37,t.isLoading$)),o(2),h(" ",c(4,39,"common.open-details-page")," "),o(2),V("!hidden",t.isEdit||t.isPublic),s("disabled",c(6,41,t.isLoading$)),o(2),h(" ",c(8,43,"customer.manage-users")," "),o(2),V("!hidden",t.isEdit),s("disabled",c(10,45,t.isLoading$)),o(2),h(" ",c(12,47,"customer.manage-assets")," "),o(2),V("!hidden",t.isEdit),s("disabled",c(14,49,t.isLoading$)),o(2),h(" ",c(16,51,"customer.manage-devices")," "),o(2),V("!hidden",t.isEdit),s("disabled",c(18,53,t.isLoading$)),o(2),h(" ",c(20,55,"customer.manage-dashboards")," "),o(2),s("ngIf",t.edgesSupportEnabled()),o(),V("!hidden",t.hideDelete()||t.isEdit||t.isPublic),s("disabled",c(23,57,t.isLoading$)),o(2),h(" ",c(25,59,"customer.delete")," "),o(3),V("!hidden",t.isEdit),s("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),s("formGroup",t.entityForm),o(),V("!hidden",t.isPublic),s("disabled",c(34,61,t.isLoading$)||!t.isEdit),o(6),s("ngIf",t.entityForm.get("title").hasError("required")),o(),s("ngIf",t.entityForm.get("title").hasError("maxlength")),o(6),s("ngIf",t.entity==null?null:t.entity.id),o(),s("parentForm",t.entityForm)("isEdit",t.isEdit))},dependencies:[G,dn,ee,$t,ae,he,me,Ce,Pe,Jt,ce,ge,W,K,ue,ie,se,bt,J,bs,le,R],styles:['@charset "UTF-8";@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-right:12px}}@media screen and (max-width: 959px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   tb-dashboard-autocomplete[_ngcontent-%COMP%]{padding-bottom:12px}}@media screen and (min-width: 960px){[_nghost-%COMP%]   .tb-default-dashboard[_ngcontent-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{margin-top:16px}}']})}}return i})();C();C();C();function vS(i,m){if(i&1&&(r(0,"mat-tab",8,0),d(2,"translate"),f(3,"tb-attribute-table",9),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),s("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function yS(i,m){if(i&1&&(r(0,"mat-tab",8,1),d(2,"translate"),f(3,"tb-attribute-table",10),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),s("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function _S(i,m){if(i&1&&(r(0,"mat-tab",8,2),d(2,"translate"),f(3,"tb-alarm-table",11),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function CS(i,m){if(i&1&&(r(0,"mat-tab",8,3),d(2,"translate"),f(3,"tb-event-table",12),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"customer.events")),o(3),s("defaultEventType",n.eventTypes.ERROR)("active",e.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function SS(i,m){if(i&1&&(r(0,"mat-tab",8,4),d(2,"translate"),f(3,"tb-relation-table",11),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function TS(i,m){if(i&1&&(r(0,"mat-tab",8,5),d(2,"translate"),f(3,"tb-audit-log-table",13),a()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),s("active",e.isActive)("auditLogMode",n.auditLogModes.CUSTOMER)("customerId",n.entity.id)}}function xS(i,m){if(i&1){let e=j();r(0,"mat-tab",8,6),d(2,"translate"),r(3,"tb-version-control",14),_("versionRestored",function(){I(e);let t=v();return M(t.entitiesTableConfig.updateData())}),a()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),s("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var Xl=(()=>{class i extends Lt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-customer-tabs"]],features:[L],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","customerId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,vS,4,7,"mat-tab",7)(1,yS,4,7,"mat-tab",7)(2,_S,4,5,"mat-tab",7)(3,CS,4,7,"mat-tab",7)(4,SS,4,5,"mat-tab",7)(5,TS,4,6,"mat-tab",7)(6,xS,4,7,"mat-tab",7),n&2&&(s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[G,St,ri,$i,Ai,vi,yi,ai,R],encapsulation:2})}}return i})();var Zl=(()=>{class i{constructor(e,n,t,l,u,y){this.customerService=e,this.homeDialogs=n,this.translate=t,this.datePipe=l,this.router=u,this.store=y,this.config=new Ge,this.config.entityType=k.CUSTOMER,this.config.entityComponent=Kl,this.config.entityTabsComponent=Xl,this.config.entityTranslations=Ue.get(k.CUSTOMER),this.config.entityResources=tt.get(k.CUSTOMER);let w=Li(this.store);this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("title","customer.title","25%"),new Y("email","contact.email","25%"),new Y("country","contact.country","25%"),new Y("city","contact.city","25%")),this.config.cellActionDescriptors.push({name:this.translate.instant("customer.manage-customer-users"),icon:"account_circle",isEnabled:x=>!x.additionalInfo||!x.additionalInfo.isPublic,onAction:(x,q)=>this.manageCustomerUsers(x,q)},{name:this.translate.instant("customer.manage-customer-assets"),nameFunction:x=>x.additionalInfo&&x.additionalInfo.isPublic?this.translate.instant("customer.manage-public-assets"):this.translate.instant("customer.manage-customer-assets"),icon:"domain",isEnabled:x=>!0,onAction:(x,q)=>this.manageCustomerAssets(x,q)},{name:this.translate.instant("customer.manage-customer-devices"),nameFunction:x=>x.additionalInfo&&x.additionalInfo.isPublic?this.translate.instant("customer.manage-public-devices"):this.translate.instant("customer.manage-customer-devices"),icon:"devices_other",isEnabled:x=>!0,onAction:(x,q)=>this.manageCustomerDevices(x,q)},{name:this.translate.instant("customer.manage-customer-dashboards"),nameFunction:x=>x.additionalInfo&&x.additionalInfo.isPublic?this.translate.instant("customer.manage-public-dashboards"):this.translate.instant("customer.manage-customer-dashboards"),icon:"dashboard",isEnabled:x=>!0,onAction:(x,q)=>this.manageCustomerDashboards(x,q)}),w.edgesSupportEnabled&&this.config.cellActionDescriptors.push({name:this.translate.instant("customer.manage-customer-edges"),nameFunction:x=>x.additionalInfo&&x.additionalInfo.isPublic?this.translate.instant("customer.manage-public-edges"):this.translate.instant("customer.manage-customer-edges"),icon:"router",isEnabled:x=>!0,onAction:(x,q)=>this.manageCustomerEdges(x,q)}),this.config.deleteEntityTitle=x=>this.translate.instant("customer.delete-customer-title",{customerTitle:x.title}),this.config.deleteEntityContent=()=>this.translate.instant("customer.delete-customer-text"),this.config.deleteEntitiesTitle=x=>this.translate.instant("customer.delete-customers-title",{count:x}),this.config.deleteEntitiesContent=()=>this.translate.instant("customer.delete-customers-text"),this.config.entitiesFetchFunction=x=>this.customerService.getCustomers(x),this.config.loadEntity=x=>this.customerService.getCustomer(x.id),this.config.saveEntity=x=>this.customerService.saveCustomer(x),this.config.deleteEntity=x=>this.customerService.deleteCustomer(x.id),this.config.onEntityAction=x=>this.onCustomerAction(x,this.config),this.config.deleteEnabled=x=>x&&(!x.additionalInfo||!x.additionalInfo.isPublic),this.config.entitySelectionEnabled=x=>x&&(!x.additionalInfo||!x.additionalInfo.isPublic),this.config.detailsReadonly=x=>x&&x.additionalInfo&&x.additionalInfo.isPublic}resolve(){return this.config.tableTitle=this.translate.instant("customer.customers"),this.config}openCustomer(e,n,t){e&&e.stopPropagation();let l=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(l)}manageCustomerUsers(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${n.id.id}/users`)}manageCustomerAssets(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${n.id.id}/assets`)}manageCustomerDevices(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${n.id.id}/devices`)}manageCustomerDashboards(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${n.id.id}/dashboards`)}manageCustomerEdges(e,n){e&&e.stopPropagation(),this.router.navigateByUrl(`customers/${n.id.id}/edgeInstances`)}onCustomerAction(e,n){switch(e.action){case"open":return this.openCustomer(e.event,e.entity,n),!0;case"manageUsers":return this.manageCustomerUsers(e.event,e.entity),!0;case"manageAssets":return this.manageCustomerAssets(e.event,e.entity),!0;case"manageDevices":return this.manageCustomerDevices(e.event,e.entity),!0;case"manageDashboards":return this.manageCustomerDashboards(e.event,e.entity),!0;case"manageEdges":return this.manageCustomerEdges(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(D(Wi),D(On),D(Z),D(ke),D(pe),D(F))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();C();C();C();C();var ep=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,n,t){this.store=e,this.fb=n,this.destroyRef=t,this.propagateChange=l=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.defaultDeviceConfigurationFormGroup=this.fb.group({configuration:[null,S.required]}),this.defaultDeviceConfigurationFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.defaultDeviceConfigurationFormGroup.disable({emitEvent:!1}):this.defaultDeviceConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.defaultDeviceConfigurationFormGroup.patchValue({configuration:e},{emitEvent:!1})}updateModel(){let e=null;this.defaultDeviceConfigurationFormGroup.valid&&(e=this.defaultDeviceConfigurationFormGroup.getRawValue().configuration,e.type=ts.DEFAULT),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(de),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-default-device-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0}])],decls:1,vars:1,consts:[[2,"padding-bottom","16px",3,"formGroup"]],template:function(n,t){n&1&&f(0,"form",0),n&2&&s("formGroup",t.defaultDeviceConfigurationFormGroup)},dependencies:[ce,K,ie],encapsulation:2})}}return i})();function IS(i,m){if(i&1&&f(0,"tb-default-device-configuration",3),i&2){let e=v();s("required",e.required)}}var tp=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,n,t){this.store=e,this.fb=n,this.destroyRef=t,this.deviceProfileType=ts,this.propagateChange=l=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.deviceConfigurationFormGroup=this.fb.group({configuration:[null,S.required]}),this.deviceConfigurationFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.deviceConfigurationFormGroup.disable({emitEvent:!1}):this.deviceConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.type=e?.type;let n=Tt(e);n&&delete n.type,this.deviceConfigurationFormGroup.patchValue({configuration:n},{emitEvent:!1})}updateModel(){let e=null;this.deviceConfigurationFormGroup.valid&&(e=this.deviceConfigurationFormGroup.getRawValue().configuration,e.type=this.type),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(de),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-device-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0}])],decls:3,vars:3,consts:[[3,"formGroup"],[3,"ngSwitch"],[3,"ngSwitchCase"],["formControlName","configuration",3,"required"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"div",1),b(2,IS,1,1,"ng-template",2),a()()),n&2&&(s("formGroup",t.deviceConfigurationFormGroup),o(),s("ngSwitch",t.type),o(),s("ngSwitchCase",t.deviceProfileType.DEFAULT))},dependencies:[_n,Cn,W,K,ue,ie,se,ep],encapsulation:2})}}return i})();C();C();var ip=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,n,t){this.store=e,this.fb=n,this.destroyRef=t,this.propagateChange=l=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.defaultDeviceTransportConfigurationFormGroup=this.fb.group({configuration:[null,S.required]}),this.defaultDeviceTransportConfigurationFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.defaultDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):this.defaultDeviceTransportConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.defaultDeviceTransportConfigurationFormGroup.patchValue({configuration:e},{emitEvent:!1})}updateModel(){let e=null;this.defaultDeviceTransportConfigurationFormGroup.valid&&(e=this.defaultDeviceTransportConfigurationFormGroup.getRawValue().configuration,e.type=xi.DEFAULT),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(de),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-default-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0}])],decls:1,vars:1,consts:[[2,"padding-bottom","16px",3,"formGroup"]],template:function(n,t){n&1&&f(0,"form",0),n&2&&s("formGroup",t.defaultDeviceTransportConfigurationFormGroup)},dependencies:[ce,K,ie],encapsulation:2})}}return i})();C();var np=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,n,t){this.store=e,this.fb=n,this.destroyRef=t,this.propagateChange=l=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.mqttDeviceTransportConfigurationFormGroup=this.fb.group({configuration:[null,S.required]}),this.mqttDeviceTransportConfigurationFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.mqttDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):this.mqttDeviceTransportConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.mqttDeviceTransportConfigurationFormGroup.patchValue({configuration:e},{emitEvent:!1})}updateModel(){let e=null;this.mqttDeviceTransportConfigurationFormGroup.valid&&(e=this.mqttDeviceTransportConfigurationFormGroup.getRawValue().configuration,e.type=xi.MQTT),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(de),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-mqtt-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0}])],decls:1,vars:1,consts:[[2,"padding-bottom","16px",3,"formGroup"]],template:function(n,t){n&1&&f(0,"form",0),n&2&&s("formGroup",t.mqttDeviceTransportConfigurationFormGroup)},dependencies:[ce,K,ie],encapsulation:2})}}return i})();C();var op=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,n){this.store=e,this.fb=n,this.destroy$=new At,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.coapDeviceTransportForm=this.fb.group({powerMode:[null],edrxCycle:[{disabled:!0,value:0},S.required],psmActivityTimer:[{disabled:!0,value:0},S.required],pagingTransmissionWindow:[{disabled:!0,value:0},S.required]}),this.coapDeviceTransportForm.valueChanges.pipe(lt(this.destroy$)).subscribe(()=>{this.updateModel()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setDisabledState(e){this.disabled=e,this.disabled?this.coapDeviceTransportForm.disable({emitEvent:!1}):(this.coapDeviceTransportForm.enable({emitEvent:!1}),this.coapDeviceTransportForm.get("powerMode").updateValueAndValidity({onlySelf:!0}))}writeValue(e){Oe(e)?this.coapDeviceTransportForm.patchValue(e,{emitEvent:!1}):this.coapDeviceTransportForm.get("powerMode").patchValue(null,{emitEvent:!1}),this.disabled||this.coapDeviceTransportForm.get("powerMode").updateValueAndValidity({onlySelf:!0})}updateModel(){let e=null;this.coapDeviceTransportForm.valid&&(e=this.coapDeviceTransportForm.value,e.type=xi.COAP),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-coap-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0}])],decls:2,vars:3,consts:[[2,"padding-bottom","16px",3,"formGroup"],[3,"parentForm","isDeviceSetting"]],template:function(n,t){n&1&&(r(0,"form",0),f(1,"tb-power-mode-settings",1),a()),n&2&&(s("formGroup",t.coapDeviceTransportForm),o(),s("parentForm",t.coapDeviceTransportForm)("isDeviceSetting",!0))},dependencies:[ce,K,ie,Is],encapsulation:2})}}return i})();C();var ap=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,n){this.store=e,this.fb=n,this.destroy$=new At,this.propagateChange=t=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.lwm2mDeviceTransportConfigurationFormGroup=this.fb.group({powerMode:[null],edrxCycle:[{disabled:!0,value:0},S.required],psmActivityTimer:[{disabled:!0,value:0},S.required],pagingTransmissionWindow:[{disabled:!0,value:0},S.required]}),this.lwm2mDeviceTransportConfigurationFormGroup.valueChanges.pipe(lt(this.destroy$)).subscribe(()=>{this.updateModel()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setDisabledState(e){this.disabled=e,this.disabled?this.lwm2mDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):(this.lwm2mDeviceTransportConfigurationFormGroup.enable({emitEvent:!1}),this.lwm2mDeviceTransportConfigurationFormGroup.get("powerMode").updateValueAndValidity({onlySelf:!0}))}writeValue(e){Oe(e)?this.lwm2mDeviceTransportConfigurationFormGroup.patchValue(e,{emitEvent:!1}):this.lwm2mDeviceTransportConfigurationFormGroup.get("powerMode").patchValue(null,{emitEvent:!1}),this.disabled||this.lwm2mDeviceTransportConfigurationFormGroup.get("powerMode").updateValueAndValidity({onlySelf:!0})}updateModel(){let e=null;this.lwm2mDeviceTransportConfigurationFormGroup.valid&&(e=this.lwm2mDeviceTransportConfigurationFormGroup.value,e.type=xi.LWM2M),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-lwm2m-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0}])],decls:2,vars:3,consts:[[2,"padding-bottom","16px",3,"formGroup"],[3,"parentForm","isDeviceSetting"]],template:function(n,t){n&1&&(r(0,"form",0),f(1,"tb-power-mode-settings",1),a()),n&2&&(s("formGroup",t.lwm2mDeviceTransportConfigurationFormGroup),o(),s("parentForm",t.lwm2mDeviceTransportConfigurationFormGroup)("isDeviceSetting",!0))},dependencies:[ce,K,ie,Is],encapsulation:2})}}return i})();C();function NS(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.host-required")," "))}function kS(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.port-required")," "))}function OS(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.port-format")," "))}function RS(i,m){if(i&1&&(r(0,"mat-option",10),p(1),d(2,"lowercase"),a()),i&2){let e=m.$implicit;s("value",e),o(),h(" ",c(2,2,e)," ")}}function BS(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.protocol-version-required")," "))}function VS(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.community-required")," "))}function jS(i,m){if(i&1&&(r(0,"section")(1,"mat-form-field",11)(2,"mat-label",3),p(3,"device-profile.snmp.community"),a(),f(4,"input",12),b(5,VS,3,3,"mat-error",5),a()()),i&2){let e=v();o(5),s("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("community").hasError("required")||e.snmpDeviceTransportConfigurationFormGroup.get("community").hasError("pattern"))}}function LS(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.user-name-required")," "))}function GS(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.security-name-required")," "))}function US(i,m){if(i&1&&(r(0,"mat-option",10),p(1),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",n.snmpAuthenticationProtocolTranslation.get(e)," ")}}function qS(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.authentication-protocol-required")," "))}function WS(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.authentication-passphrase-required")," "))}function HS(i,m){if(i&1&&(r(0,"mat-option",10),p(1),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",n.snmpPrivacyProtocolTranslation.get(e)," ")}}function zS(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.privacy-protocol-required")," "))}function $S(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device-profile.snmp.privacy-passphrase-required")," "))}function JS(i,m){if(i&1&&(r(0,"section")(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"device-profile.snmp.user-name"),a(),f(5,"input",13),b(6,LS,3,3,"mat-error",5),a(),r(7,"mat-form-field",2)(8,"mat-label",3),p(9,"device-profile.snmp.security-name"),a(),f(10,"input",14),b(11,GS,3,3,"mat-error",5),a()(),r(12,"div",1)(13,"mat-form-field",15)(14,"mat-label",3),p(15,"device-profile.snmp.authentication-protocol"),a(),r(16,"mat-select",16),b(17,US,2,2,"mat-option",9),a(),b(18,qS,3,3,"mat-error",5),a(),r(19,"mat-form-field",2)(20,"mat-label",3),p(21,"device-profile.snmp.authentication-passphrase"),a(),f(22,"input",17),b(23,WS,3,3,"mat-error",5),a()(),r(24,"div",1)(25,"mat-form-field",15)(26,"mat-label",3),p(27,"device-profile.snmp.privacy-protocol"),a(),r(28,"mat-select",18),b(29,HS,2,2,"mat-option",9),a(),b(30,zS,3,3,"mat-error",5),a(),r(31,"mat-form-field",2)(32,"mat-label",3),p(33,"device-profile.snmp.privacy-passphrase"),a(),f(34,"input",19),b(35,$S,3,3,"mat-error",5),a()(),r(36,"div",1)(37,"mat-form-field",2)(38,"mat-label",3),p(39,"device-profile.snmp.context-name"),a(),f(40,"input",20),a(),r(41,"mat-form-field",2)(42,"mat-label",3),p(43,"device-profile.snmp.engine-id"),a(),f(44,"input",21),a()()()),i&2){let e=v();o(6),s("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("username").hasError("required")||e.snmpDeviceTransportConfigurationFormGroup.get("username").hasError("pattern")),o(5),s("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("securityName").hasError("required")||e.snmpDeviceTransportConfigurationFormGroup.get("securityName").hasError("pattern")),o(6),s("ngForOf",e.snmpAuthenticationProtocols),o(),s("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("authenticationProtocol").hasError("required")),o(5),s("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").hasError("required")||e.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").hasError("pattern")),o(6),s("ngForOf",e.snmpPrivacyProtocols),o(),s("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("privacyProtocol").hasError("required")),o(5),s("ngIf",e.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").hasError("required")||e.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").hasError("pattern"))}}var rp=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,n,t){this.store=e,this.fb=n,this.destroyRef=t,this.snmpDeviceProtocolVersions=Object.values(vo),this.snmpAuthenticationProtocols=Object.values(pd),this.snmpAuthenticationProtocolTranslation=zu,this.snmpPrivacyProtocols=Object.values(md),this.snmpPrivacyProtocolTranslation=$u,this.propagateChange=l=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.snmpDeviceTransportConfigurationFormGroup=this.fb.group({host:["",[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]],port:[null,[S.required,S.min(0),S.pattern("[0-9]*")]],protocolVersion:[vo.V2C,S.required],community:["public",[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]],username:["",[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]],securityName:["public",[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]],contextName:[null],authenticationProtocol:[pd.SHA_512,S.required],authenticationPassphrase:["",[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]],privacyProtocol:[md.DES,S.required],privacyPassphrase:["",[S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]],engineId:[""]}),this.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").valueChanges.pipe(Ne(this.destroyRef)).subscribe(e=>{this.updateDisabledFormValue(e)}),this.snmpDeviceTransportConfigurationFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}validate(){return this.snmpDeviceTransportConfigurationFormGroup.valid?null:{snmpDeviceTransportConfiguration:!1}}setDisabledState(e){this.disabled=e,this.disabled?this.snmpDeviceTransportConfigurationFormGroup.disable({emitEvent:!1}):(this.snmpDeviceTransportConfigurationFormGroup.enable({emitEvent:!1}),this.updateDisabledFormValue(this.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").value||vo.V2C))}writeValue(e){Oe(e)&&(this.snmpDeviceTransportConfigurationFormGroup.patchValue(e,{emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.enabled&&this.updateDisabledFormValue(e.protocolVersion||vo.V2C))}isV3protocolVersion(){return this.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").value===vo.V3}updateDisabledFormValue(e){e===vo.V3?(this.snmpDeviceTransportConfigurationFormGroup.get("community").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("username").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("securityName").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("contextName").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationProtocol").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyProtocol").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("engineId").enable({emitEvent:!1})):(this.snmpDeviceTransportConfigurationFormGroup.get("community").enable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("username").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("securityName").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("contextName").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationProtocol").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("authenticationPassphrase").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyProtocol").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("privacyPassphrase").disable({emitEvent:!1}),this.snmpDeviceTransportConfigurationFormGroup.get("engineId").disable({emitEvent:!1}))}updateModel(){let e=null;this.snmpDeviceTransportConfigurationFormGroup.valid&&(e=this.snmpDeviceTransportConfigurationFormGroup.value,e.type=xi.SNMP),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(de),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-snmp-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}])],decls:21,vars:8,consts:[[1,"flex","flex-col","gap-2","pb-4",3,"formGroup"],[1,"flex","flex-row","gap-2","xs:flex-col"],[1,"flex-1"],["translate",""],["matInput","","formControlName","host","required",""],[4,"ngIf"],["matInput","","formControlName","port","type","number","min","0","required",""],["floatLabel","always","hideRequiredMarker","",1,"mat-block"],["formControlName","protocolVersion","required",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mat-block"],["matInput","","formControlName","community","required",""],["matInput","","formControlName","username","required",""],["matInput","","formControlName","securityName","required",""],["floatLabel","always","hideRequiredMarker","",1,"flex-1"],["formControlName","authenticationProtocol","required",""],["matInput","","formControlName","authenticationPassphrase","required",""],["formControlName","privacyProtocol","required",""],["matInput","","formControlName","privacyPassphrase","required",""],["matInput","","formControlName","contextName"],["matInput","","formControlName","engineId"]],template:function(n,t){n&1&&(r(0,"form",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label",3),p(4,"device-profile.snmp.host"),a(),f(5,"input",4),b(6,NS,3,3,"mat-error",5),a(),r(7,"mat-form-field",2)(8,"mat-label",3),p(9,"device-profile.snmp.port"),a(),f(10,"input",6),b(11,kS,3,3,"mat-error",5)(12,OS,3,3,"mat-error",5),a()(),r(13,"mat-form-field",7)(14,"mat-label",3),p(15,"device-profile.snmp.protocol-version"),a(),r(16,"mat-select",8),b(17,RS,3,4,"mat-option",9),a(),b(18,BS,3,3,"mat-error",5),a(),b(19,jS,6,1,"section",5)(20,JS,45,8,"section",5),a()),n&2&&(s("formGroup",t.snmpDeviceTransportConfigurationFormGroup),o(6),s("ngIf",t.snmpDeviceTransportConfigurationFormGroup.get("host").hasError("required")||t.snmpDeviceTransportConfigurationFormGroup.get("host").hasError("pattern")),o(5),s("ngIf",t.snmpDeviceTransportConfigurationFormGroup.get("port").hasError("required")),o(),s("ngIf",t.snmpDeviceTransportConfigurationFormGroup.get("port").hasError("pattern")||t.snmpDeviceTransportConfigurationFormGroup.get("port").hasError("min")),o(5),s("ngForOf",t.snmpDeviceProtocolVersions),o(),s("ngIf",t.snmpDeviceTransportConfigurationFormGroup.get("protocolVersion").hasError("required")),o(),s("ngIf",!t.isV3protocolVersion()),o(),s("ngIf",t.isV3protocolVersion()))},dependencies:[Te,G,he,me,Ce,Pe,vt,gt,ce,ge,Ui,W,K,ue,qi,ie,se,J,yc,R],encapsulation:2})}}return i})();function YS(i,m){if(i&1&&f(0,"tb-default-device-transport-configuration",3),i&2){let e=v();s("required",e.required)}}function KS(i,m){if(i&1&&f(0,"tb-mqtt-device-transport-configuration",3),i&2){let e=v();s("required",e.required)}}function XS(i,m){if(i&1&&f(0,"tb-lwm2m-device-transport-configuration",3),i&2){let e=v();s("required",e.required)}}function ZS(i,m){if(i&1&&f(0,"tb-coap-device-transport-configuration",3),i&2){let e=v();s("required",e.required)}}function eT(i,m){if(i&1&&f(0,"tb-snmp-device-transport-configuration",3),i&2){let e=v();s("required",e.required)}}var sp=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,n,t){this.store=e,this.fb=n,this.destroyRef=t,this.deviceTransportType=xi,this.propagateChange=l=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.deviceTransportConfigurationFormGroup=this.fb.group({configuration:[null,S.required]}),this.deviceTransportConfigurationFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.deviceTransportConfigurationFormGroup.disable({emitEvent:!1}):this.deviceTransportConfigurationFormGroup.enable({emitEvent:!1})}writeValue(e){this.transportType=e?.type;let n=Tt(e);n&&delete n.type,this.deviceTransportConfigurationFormGroup.patchValue({configuration:n},{emitEvent:!1})}validate(){return this.deviceTransportConfigurationFormGroup.valid?null:{deviceTransportConfiguration:!1}}updateModel(){let e=null;this.deviceTransportConfigurationFormGroup.valid&&(e=this.deviceTransportConfigurationFormGroup.getRawValue().configuration,e.type=this.transportType),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(de),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-device-transport-configuration"]],inputs:{required:"required",disabled:"disabled"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}])],decls:7,vars:7,consts:[[3,"formGroup"],[3,"ngSwitch"],[3,"ngSwitchCase"],["formControlName","configuration",3,"required"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"div",1),b(2,YS,1,1,"ng-template",2)(3,KS,1,1,"ng-template",2)(4,XS,1,1,"ng-template",2)(5,ZS,1,1,"ng-template",2)(6,eT,1,1,"ng-template",2),a()()),n&2&&(s("formGroup",t.deviceTransportConfigurationFormGroup),o(),s("ngSwitch",t.transportType),o(),s("ngSwitchCase",t.deviceTransportType.DEFAULT),o(),s("ngSwitchCase",t.deviceTransportType.MQTT),o(),s("ngSwitchCase",t.deviceTransportType.LWM2M),o(),s("ngSwitchCase",t.deviceTransportType.COAP),o(),s("ngSwitchCase",t.deviceTransportType.SNMP))},dependencies:[_n,Cn,W,K,ue,ie,se,ip,np,op,ap,rp],encapsulation:2})}}return i})();function iT(i,m){i&1&&(r(0,"mat-expansion-panel",3)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div",4),p(4,"device.device-configuration"),a()()(),f(5,"tb-device-configuration",5),a()),i&2&&s("expanded",!0)}function nT(i,m){i&1&&(r(0,"mat-expansion-panel",3)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div",4),p(4,"device.transport-configuration"),a()()(),f(5,"tb-device-transport-configuration",6),a()),i&2&&s("expanded",!0)}var lp=(()=>{class i{get required(){return this.requiredValue}set required(e){this.requiredValue=pi(e)}constructor(e,n,t){this.store=e,this.fb=n,this.destroyRef=t,this.propagateChange=l=>{}}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){this.deviceDataFormGroup=this.fb.group({configuration:[null,S.required],transportConfiguration:[null,S.required]}),this.deviceDataFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()})}setDisabledState(e){this.disabled=e,this.disabled?this.deviceDataFormGroup.disable({emitEvent:!1}):this.deviceDataFormGroup.enable({emitEvent:!1})}writeValue(e){let n=e?.configuration?.type;this.displayDeviceConfiguration=n&&qu.get(n).hasDeviceConfiguration;let t=e?.transportConfiguration?.type;this.displayTransportConfiguration=t&&Hu.get(t).hasDeviceConfiguration,this.deviceDataFormGroup.patchValue({configuration:e?.configuration},{emitEvent:!1}),this.deviceDataFormGroup.patchValue({transportConfiguration:e?.transportConfiguration},{emitEvent:!1})}validate(){return this.deviceDataFormGroup.valid?null:{deviceDataForm:!1}}updateModel(){let e=null;this.deviceDataFormGroup.valid&&(e=this.deviceDataFormGroup.getRawValue()),this.propagateChange(e)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(de),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-device-data"]],inputs:{required:"required",disabled:"disabled"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}])],decls:4,vars:3,consts:[[2,"padding-bottom","16px",3,"formGroup"],["multi","true"],[3,"expanded",4,"ngIf"],[3,"expanded"],["translate",""],["formControlName","configuration","required",""],["formControlName","transportConfiguration","required",""]],template:function(n,t){n&1&&(r(0,"div",0)(1,"mat-accordion",1),b(2,iT,6,1,"mat-expansion-panel",2)(3,nT,6,1,"mat-expansion-panel",2),a()()),n&2&&(s("formGroup",t.deviceDataFormGroup),o(2),s("ngIf",t.displayDeviceConfiguration),o(),s("ngIf",t.displayTransportConfiguration))},dependencies:[G,Ur,Gi,rn,sn,W,K,ue,ie,se,J,tp,sp],encapsulation:2})}}return i})();function rT(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device.name-required")," "))}function sT(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device.name-max-length")," "))}function lT(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device.label-max-length")," "))}function pT(i,m){i&1&&(r(0,"mat-slide-toggle",25),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device.overwrite-activity-time")," "))}var pp=(()=>{class i extends Bt{constructor(e,n,t,l,u,y,w){super(e,u,t,l,y),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.fb=u,this.cd=y,this.destroyRef=w,this.entityType=k,this.otaUpdateType=Ya}ngOnInit(){this.deviceScope=this.entitiesTableConfig.componentsData.deviceScope,this.deviceCredentials$=this.entitiesTableConfigValue.componentsData.deviceCredentials$,super.ngOnInit()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isAssignedToCustomer(e){return e&&e.customerId&&e.customerId.id!==Ae}buildForm(e){let n=this.fb.group({name:[e?e.name:"",[S.required,S.maxLength(255)]],deviceProfileId:[e?e.deviceProfileId:null,[S.required]],firmwareId:[e?e.firmwareId:null],softwareId:[e?e.softwareId:null],label:[e?e.label:"",[S.maxLength(255)]],deviceData:[e?e.deviceData:null,[S.required]],additionalInfo:this.fb.group({gateway:[e&&e.additionalInfo?e.additionalInfo.gateway:!1],overwriteActivityTime:[e&&e.additionalInfo?e.additionalInfo.overwriteActivityTime:!1],description:[e&&e.additionalInfo?e.additionalInfo.description:""]})});return n.get("deviceProfileId").valueChanges.pipe(yr((t,l)=>t?.id===l?.id),Ne(this.destroyRef)).subscribe(t=>{t&&this.isEdit&&this.entityForm.patchValue({firmwareId:null,softwareId:null},{emitEvent:!1})}),n}updateForm(e){this.entityForm.patchValue({name:e.name,deviceProfileId:e.deviceProfileId,firmwareId:e.firmwareId,softwareId:e.softwareId,label:e.label,deviceData:e.deviceData,additionalInfo:{gateway:e.additionalInfo?e.additionalInfo.gateway:!1,overwriteActivityTime:e.additionalInfo?e.additionalInfo.overwriteActivityTime:!1,description:e.additionalInfo?e.additionalInfo.description:""}})}onDeviceIdCopied(e){this.store.dispatch(new Be({message:this.translate.instant("device.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onDeviceProfileUpdated(){this.entitiesTableConfig.updateData(!1)}onDeviceProfileChanged(e){if(e&&this.isEdit){let n=e.type,t=e.transportType,l=this.entityForm.getRawValue().deviceData;if(!l)l={configuration:sd(n),transportConfiguration:ld(t)},this.entityForm.patchValue({deviceData:l}),this.entityForm.markAsDirty();else{let u=!1;l.configuration.type!==n&&(l.configuration=sd(n),u=!0),l.transportConfiguration.type!==t&&(l.transportConfiguration=ld(t),u=!0),u&&(this.entityForm.patchValue({deviceData:l}),this.entityForm.markAsDirty())}}}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g("entity"),g("entitiesTableConfig"),g(de),g(Qe),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-device"]],features:[L],decls:77,vars:106,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent","disabled"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[3,"disabled","credentials$","deviceId"],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["required","","formControlName","deviceProfileId",3,"deviceProfileUpdated","deviceProfileChanged","selectDefaultProfile","showDetailsPageLink"],["matInput","","formControlName","label"],["formControlName","firmwareId",3,"useFullEntityId","showDetailsPageLink","type","deviceProfileId"],["formControlName","softwareId",3,"useFullEntityId","showDetailsPageLink","type","deviceProfileId"],["formControlName","deviceData","required",""],["formGroupName","additionalInfo",1,"flex","flex-col"],[1,"toggle-group"],["formControlName","gateway",2,"min-width","165px"],["formControlName","overwriteActivityTime",4,"ngIf"],["matInput","","formControlName","description","rows","2"],["formControlName","overwriteActivityTime"]],template:function(n,t){if(n&1&&(r(0,"div",0)(1,"button",1),d(2,"async"),_("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),a(),r(5,"button",1),d(6,"async"),_("click",function(u){return t.onEntityAction(u,"makePublic")}),p(7),d(8,"translate"),a(),r(9,"button",1),d(10,"async"),_("click",function(u){return t.onEntityAction(u,"assignToCustomer")}),p(11),d(12,"translate"),a(),r(13,"button",1),d(14,"async"),_("click",function(u){return t.onEntityAction(u,"unassignFromCustomer")}),p(15),d(16,"translate"),a(),r(17,"button",1),d(18,"async"),_("click",function(u){return t.onEntityAction(u,"manageCredentials")}),p(19),d(20,"translate"),a(),r(21,"button",1),d(22,"async"),_("click",function(u){return t.onEntityAction(u,"checkConnectivity")}),p(23),d(24,"translate"),a(),r(25,"button",1),d(26,"async"),_("click",function(u){return t.onEntityAction(u,"unassignFromEdge")}),p(27),d(28,"translate"),a(),r(29,"button",1),d(30,"async"),_("click",function(u){return t.onEntityAction(u,"delete")}),p(31),d(32,"translate"),a(),r(33,"div",2)(34,"button",3),d(35,"async"),_("cbOnSuccess",function(u){return t.onDeviceIdCopied(u)}),f(36,"mat-icon",4),r(37,"span",5),p(38,"device.copyId"),a()(),f(39,"tb-copy-device-credentials",6),d(40,"async"),a()(),r(41,"div",7)(42,"mat-form-field",8)(43,"mat-label",5),p(44,"device.assignedToCustomer"),a(),f(45,"input",9),a(),r(46,"div",10),p(47),d(48,"translate"),a(),r(49,"form",11)(50,"fieldset",12),d(51,"async"),r(52,"mat-form-field",8)(53,"mat-label",5),p(54,"device.name"),a(),f(55,"input",13),b(56,rT,3,3,"mat-error",14)(57,sT,3,3,"mat-error",14),a(),r(58,"tb-device-profile-autocomplete",15),_("deviceProfileUpdated",function(){return t.onDeviceProfileUpdated()})("deviceProfileChanged",function(u){return t.onDeviceProfileChanged(u)}),a(),r(59,"mat-form-field",8)(60,"mat-label",5),p(61,"device.label"),a(),f(62,"input",16),b(63,lT,3,3,"mat-error",14),a(),f(64,"tb-ota-package-autocomplete",17)(65,"tb-ota-package-autocomplete",18)(66,"tb-device-data",19),r(67,"div",20)(68,"div",21)(69,"mat-slide-toggle",22),p(70),d(71,"translate"),a(),b(72,pT,3,3,"mat-slide-toggle",23),a(),r(73,"mat-form-field",8)(74,"mat-label",5),p(75,"device.description"),a(),f(76,"textarea",24),a()()()()()),n&2){let l,u;o(),V("!hidden",t.isEdit||t.isDetailsPage),s("disabled",c(2,64,t.isLoading$)),o(2),h(" ",c(4,66,"common.open-details-page")," "),o(2),V("!hidden",t.isEdit||t.deviceScope!=="tenant"||t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)),s("disabled",c(6,68,t.isLoading$)),o(2),h(" ",c(8,70,"device.make-public")," "),o(2),V("!hidden",t.isEdit||t.deviceScope!=="tenant"||t.isAssignedToCustomer(t.entity)),s("disabled",c(10,72,t.isLoading$)),o(2),h(" ",c(12,74,"device.assign-to-customer")," "),o(2),V("!hidden",t.isEdit||t.deviceScope!=="customer"&&t.deviceScope!=="tenant"||!t.isAssignedToCustomer(t.entity)),s("disabled",c(14,76,t.isLoading$)),o(2),h(" ",c(16,78,t.entity!=null&&t.entity.customerIsPublic?"device.make-private":"device.unassign-from-customer")," "),o(2),V("!hidden",t.isEdit),s("disabled",c(18,80,t.isLoading$)),o(2),h(" ",c(20,82,t.deviceScope==="customer_user"||t.deviceScope==="edge_customer_user"?"device.view-credentials":"device.manage-credentials")," "),o(2),V("!hidden",t.isEdit),s("disabled",c(22,84,t.isLoading$)),o(2),h(" ",c(24,86,"device.connectivity.check-connectivity")," "),o(2),V("!hidden",t.isEdit||t.deviceScope!=="edge"),s("disabled",c(26,88,t.isLoading$)),o(2),h(" ",c(28,90,"edge.unassign-from-edge")," "),o(2),V("!hidden",t.hideDelete()||t.isEdit),s("disabled",c(30,92,t.isLoading$)),o(2),h(" ",c(32,94,"device.delete")," "),o(3),V("!hidden",t.isEdit),s("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id)("disabled",c(35,96,t.isLoading$)),o(5),V("!hidden",t.isEdit),s("disabled",c(40,98,t.isLoading$))("credentials$",t.deviceCredentials$)("deviceId",t.entity==null?null:t.entity.id),o(3),V("!hidden",t.isEdit||!t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)||t.deviceScope!=="tenant"),o(3),s("ngModel",t.entity==null?null:t.entity.customerTitle),o(),V("!hidden",t.isEdit||!(t.entity!=null&&t.entity.customerIsPublic)||t.deviceScope!=="customer"&&t.deviceScope!=="tenant"),o(),h(" ",c(48,100,"device.device-public")," "),o(2),s("formGroup",t.entityForm),o(),s("disabled",c(51,102,t.isLoading$)||!t.isEdit),o(6),s("ngIf",t.entityForm.get("name").hasError("required")),o(),s("ngIf",t.entityForm.get("name").hasError("maxlength")),o(),s("selectDefaultProfile",t.isAdd)("showDetailsPageLink",!0),o(5),s("ngIf",t.entityForm.get("label").hasError("maxlength")),o(),s("useFullEntityId",!0)("showDetailsPageLink",!0)("type",t.otaUpdateType.FIRMWARE)("deviceProfileId",(l=t.entityForm.get("deviceProfileId").value)==null?null:l.id),o(),s("useFullEntityId",!0)("showDetailsPageLink",!0)("type",t.otaUpdateType.SOFTWARE)("deviceProfileId",(u=t.entityForm.get("deviceProfileId").value)==null?null:u.id),o(5),h(" ",c(71,104,"device.is-gateway")," "),o(2),s("ngIf",t.entityForm.get("additionalInfo.gateway").value)}},dependencies:[G,ee,ae,he,me,Ce,Pe,ht,Jt,ce,ge,W,K,ue,Ye,ie,se,bt,J,B0,Ms,Gf,lp,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .toggle-group[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:16px;margin-bottom:16px}']})}}return i})();C();var mp=(()=>{class i extends oi{constructor(e){super(e),this.store=e,this.entityType=k}deviceInfoFilterChanged(e){this.entitiesTableConfig.componentsData.deviceInfoFilter=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-device-table-header"]],features:[L],decls:1,vars:1,consts:[[3,"ngModelChange","ngModel"]],template:function(n,t){n&1&&(r(0,"tb-device-info-filter",0),_("ngModelChange",function(u){return t.deviceInfoFilterChanged(u)}),a()),n&2&&s("ngModel",t.entitiesTableConfig.componentsData.deviceInfoFilter)},dependencies:[W,Ye,Wf],encapsulation:2})}}return i})();C();function dT(i,m){i&1&&f(0,"mat-progress-bar",11)}function cT(i,m){if(i&1&&(r(0,"section")(1,"form",12),f(2,"tb-device-credentials",13),a()()),i&2){let e=v();o(),s("formGroup",e.deviceCredentialsFormGroup),o(),s("deviceTransportType",e.deviceTransportType)}}function uT(i,m){i&1&&(r(0,"div",14),f(1,"mat-spinner",15),r(2,"span",16),p(3),d(4,"translate"),a()()),i&2&&(o(3),h(" ",c(4,1,"device.loading-device-credentials")," "))}function fT(i,m){if(i&1){let e=j();r(0,"button",17),d(1,"async"),_("click",function(){I(e);let t=v();return M(t.save())}),p(2),d(3,"translate"),a()}if(i&2){let e=v();s("disabled",c(1,2,e.isLoading$)||e.deviceCredentialsFormGroup.invalid||!e.deviceCredentialsFormGroup.dirty),o(2),h(" ",c(3,4,"action.save")," ")}}var dp=(()=>{class i extends nt{constructor(e,n,t,l,u,y,w,x){super(e,n,w),this.store=e,this.router=n,this.data=t,this.deviceService=l,this.deviceProfileService=u,this.errorStateMatcher=y,this.dialogRef=w,this.fb=x,this.loadingCredentials=!0,this.submitted=!1,this.isReadOnly=t.isReadOnly}ngOnInit(){this.deviceCredentialsFormGroup=this.fb.group({credential:[null]}),this.isReadOnly&&this.deviceCredentialsFormGroup.disable({emitEvent:!1}),this.loadDeviceCredentials()}isErrorState(e,n){let t=this.errorStateMatcher.isErrorState(e,n),l=!!(e&&e.invalid&&this.submitted);return t||l}loadDeviceCredentials(){let e=[this.deviceService.getDeviceCredentials(this.data.deviceId),this.deviceProfileService.getDeviceProfileInfo(this.data.deviceProfileId)];Nt(e).subscribe(([n,t])=>{this.deviceTransportType=t.transportType,this.deviceCredentials=n,this.deviceCredentialsFormGroup.patchValue({credential:n},{emitEvent:!1}),this.loadingCredentials=!1})}cancel(){this.dialogRef.close(null)}save(){this.submitted=!0;let e=this.deviceCredentialsFormGroup.value.credential;this.deviceCredentials=_e(_e({},this.deviceCredentials),e),this.deviceService.saveDeviceCredentials(this.deviceCredentials).pipe(Qi(n=>n.status===Er.Conflict?this.deviceService.getDeviceCredentials(this.deviceCredentials.deviceId.id):vr(()=>n))).subscribe(n=>{this.dialogRef.close(n)})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(Ot),g(ma),g(os),g(on,4),g(it),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-device-credentials-dialog"]],features:[$e([{provide:on,useExisting:i}]),L],decls:20,vars:15,consts:[["loadCredentials",""],["color","primary"],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["mat-dialog-content",""],[4,"ngIf","ngIfElse"],["mat-dialog-actions","",1,"tb-dialog-actions"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],["color","warn","mode","indeterminate"],[3,"formGroup"],["formControlName","credential",3,"deviceTransportType"],[1,"flex","flex-col","items-center","justify-center"],["color","accent","diameter","65","strokeWidth","4",2,"margin-bottom","18px"],[1,"mat-subtitle-1",2,"margin-bottom","0"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){if(n&1){let l=j();r(0,"mat-toolbar",1)(1,"h2"),p(2),d(3,"translate"),a(),f(4,"span",2),r(5,"button",3),_("click",function(){return I(l),M(t.cancel())}),r(6,"mat-icon",4),p(7,"close"),a()()(),b(8,dT,1,0,"mat-progress-bar",5),d(9,"async"),r(10,"div",6),b(11,cT,3,2,"section",7)(12,uT,5,3,"ng-template",null,0,It),a(),r(14,"div",8)(15,"button",9),d(16,"async"),_("click",function(){return I(l),M(t.cancel())}),p(17),d(18,"translate"),a(),b(19,fT,4,6,"button",10),a()}if(n&2){let l=U(13);o(2),O(c(3,7,"device.device-credentials")),o(6),s("ngIf",c(9,9,t.isLoading$)),o(3),s("ngIf",!t.loadingCredentials)("ngIfElse",l),o(4),s("disabled",c(16,11,t.isLoading$)),o(2),h(" ",c(18,13,t.isReadOnly?"action.close":"action.cancel")," "),o(2),s("ngIf",!t.isReadOnly)}},dependencies:[G,ee,Ee,ae,qe,at,Rt,mt,to,ce,W,K,ie,se,Vf,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;display:grid;grid-template-rows:min-content 4px auto min-content}@media screen and (min-width: 600px){[_nghost-%COMP%]{min-width:420px}}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{grid-row:4;display:flex;gap:8px;justify-content:flex-end;flex:1}.mat-mdc-dialog-container[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{grid-row:3;padding:24px 24px 4px}']})}}return i})();C();function gT(i,m){if(i&1&&(r(0,"mat-tab",9,0),d(2,"translate"),f(3,"tb-attribute-table",10),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),s("defaultAttributeScope",n.attributeScopes.CLIENT_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function hT(i,m){if(i&1&&(r(0,"mat-tab",9,1),d(2,"translate"),f(3,"tb-attribute-table",11),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),s("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function bT(i,m){if(i&1&&(r(0,"mat-tab",9,2),d(2,"translate"),f(3,"tb-calculated-fields-table",12),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"entity.type-calculated-fields")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function vT(i,m){if(i&1&&(r(0,"mat-tab",9,3),d(2,"translate"),f(3,"tb-alarm-table",12),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function yT(i,m){if(i&1&&(r(0,"mat-tab",9,4),d(2,"translate"),f(3,"tb-event-table",13),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"device.events")),o(3),s("defaultEventType",n.eventTypes.ERROR)("active",e.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function _T(i,m){if(i&1&&(r(0,"mat-tab",9,5),d(2,"translate"),f(3,"tb-relation-table",12),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function CT(i,m){if(i&1&&(r(0,"mat-tab",9,6),d(2,"translate"),f(3,"tb-audit-log-table",14),a()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),s("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function ST(i,m){if(i&1){let e=j();r(0,"mat-tab",9,7),d(2,"translate"),r(3,"tb-version-control",15),_("versionRestored",function(){I(e);let t=v();return M(t.entitiesTableConfig.updateData())}),a()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),s("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var cp=(()=>{class i extends Lt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-device-tabs"]],features:[L],decls:8,vars:8,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["calculatedFieldsTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,gT,4,7,"mat-tab",8)(1,hT,4,7,"mat-tab",8)(2,bT,4,5,"mat-tab",8)(3,vT,4,5,"mat-tab",8)(4,yT,4,7,"mat-tab",8)(5,_T,4,5,"mat-tab",8)(6,CT,4,6,"mat-tab",8)(7,ST,4,7,"mat-tab",8),n&2&&(s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[G,St,ri,$i,Ai,vi,yi,ai,mo,R],encapsulation:2})}}return i})();C();var $d=()=>({text:"",href:""}),Jd=(i,m,e)=>({noSecLabel:"HTTP",noSec:i,secLabel:"HTTPs",sec:m,doc:e}),Hn=i=>({cmd:i}),TT=()=>({text:"device.connectivity.sparkplug-command",href:"https://thingsboard.io/docs/reference/mqtt-sparkplug-api/"}),La=i=>({doc:i}),xT=()=>({text:"device.connectivity.install-mqtt-windows",href:"https://thingsboard.io/docs/reference/mqtt-api/?connectdevice=mqtt-windows#mqtt-connect"}),up=()=>({text:"device.connectivity.mqtts-x509-command",href:"https://thingsboard.io/docs/user-guide/mqtt-over-ssl/"}),fp=(i,m,e)=>({noSecLabel:"MQTT",noSec:i,secLabel:"MQTTs",sec:m,doc:e}),Dg=()=>({text:"device.connectivity.coaps-x509-command",href:"https://thingsboard.io/docs/user-guide/ssl/coap-x509-certificates/"}),Pg=(i,m,e)=>({noSecLabel:"CoAP",noSec:i,secLabel:"CoAPs",sec:m,doc:e}),ET=()=>({text:"device.connectivity.install-coap-client",href:"https://thingsboard.io/docs/user-guide/ssl/coap-access-token/"}),IT=()=>({text:"device.connectivity.snmp-command",href:"https://thingsboard.io/docs/reference/snmp-api/"}),MT=()=>({text:"device.connectivity.lwm2m-command",href:"https://thingsboard.io/docs/reference/lwm2m-api/"});function wT(i,m){if(i&1&&(r(0,"tb-toggle-option",32),p(1),d(2,"translate"),a()),i&2){let e=v(2);s("value",e.BasicTransportType.HTTP),o(),h(" ",c(2,2,e.deviceTransportTypeTranslationMap.get(e.BasicTransportType.HTTP))," ")}}function DT(i,m){if(i&1&&(r(0,"tb-toggle-option",32),p(1),d(2,"translate"),a()),i&2){let e=v(2);s("value",e.DeviceTransportType.MQTT),o(),h(" ",c(2,2,e.deviceTransportTypeTranslationMap.get(e.DeviceTransportType.MQTT))," ")}}function PT(i,m){if(i&1&&(r(0,"tb-toggle-option",32),p(1),d(2,"translate"),a()),i&2){let e=v(2);s("value",e.DeviceTransportType.COAP),o(),h(" ",c(2,2,e.deviceTransportTypeTranslationMap.get(e.DeviceTransportType.COAP))," ")}}function FT(i,m){if(i&1&&(r(0,"tb-toggle-option",32),p(1),d(2,"translate"),a()),i&2){let e=v(2);s("value",e.DeviceTransportType.SNMP),o(),h(" ",c(2,2,e.deviceTransportTypeTranslationMap.get(e.DeviceTransportType.SNMP))," ")}}function AT(i,m){if(i&1&&(r(0,"tb-toggle-option",32),p(1),d(2,"translate"),a()),i&2){let e=v(2);s("value",e.DeviceTransportType.LWM2M),o(),h(" ",c(2,2,e.deviceTransportTypeTranslationMap.get(e.DeviceTransportType.LWM2M))," ")}}function NT(i,m){i&1&&(f(0,"mat-icon",37),p(1," Windows "))}function kT(i,m){i&1&&Vt(0)}function OT(i,m){if(i&1&&(r(0,"div",38)(1,"div",23)(2,"div",25),p(3,"device.connectivity.install-necessary-client-tools"),a(),r(4,"div",39),p(5,"device.connectivity.install-curl-windows"),a()(),b(6,kT,1,0,"ng-container",40),a()),i&2){let e=v(3),n=U(23);o(6),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(7,Hn,yn(3,Jd,e.commands.http.http,e.commands.http.https,Et(2,$d))))}}function RT(i,m){i&1&&(f(0,"mat-icon",41),p(1," MacOS "))}function BT(i,m){i&1&&Vt(0)}function VT(i,m){if(i&1&&(r(0,"div",38)(1,"div",23)(2,"div",25),p(3,"device.connectivity.install-necessary-client-tools"),a(),r(4,"div",39),p(5,"device.connectivity.install-curl-macos"),a()(),b(6,BT,1,0,"ng-container",40),a()),i&2){let e=v(3),n=U(23);o(6),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(7,Hn,yn(3,Jd,e.commands.http.http,e.commands.http.https,Et(2,$d))))}}function jT(i,m){i&1&&(f(0,"mat-icon",42),p(1," Linux "))}function LT(i,m){i&1&&Vt(0)}function GT(i,m){if(i&1&&(r(0,"div",38)(1,"div",23)(2,"div",25),p(3,"device.connectivity.install-necessary-client-tools"),a(),f(4,"tb-markdown",43),a(),b(5,LT,1,0,"ng-container",40),a()),i&2){let e=v(3),n=U(23);o(4),s("data",e.createMarkDownCommand("sudo apt-get install curl")),o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(8,Hn,yn(4,Jd,e.commands.http.http,e.commands.http.https,Et(3,$d))))}}function UT(i,m){if(i&1){let e=j();r(0,"div",33),p(1,"device.connectivity.use-following-instructions"),a(),r(2,"mat-tab-group",34),et("selectedIndexChange",function(t){I(e);let l=v(2);return Ze(l.httpTabIndex,t)||(l.httpTabIndex=t),M(t)}),r(3,"mat-tab"),b(4,NT,2,0,"ng-template",35)(5,OT,7,9,"ng-template",36),a(),r(6,"mat-tab"),b(7,RT,2,0,"ng-template",35)(8,VT,7,9,"ng-template",36),a(),r(9,"mat-tab"),b(10,jT,2,0,"ng-template",35)(11,GT,6,10,"ng-template",36),a()()}if(i&2){let e=v(2);o(2),Xe("selectedIndex",e.httpTabIndex)}}function qT(i,m){i&1&&Vt(0)}function WT(i,m){if(i&1&&(r(0,"div",23),b(1,qT,1,0,"ng-container",40),a()),i&2){v(3);let e=U(25);o(),s("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(3,La,Et(2,TT)))}}function HT(i,m){i&1&&(f(0,"mat-icon",37),p(1," Windows "))}function zT(i,m){i&1&&Vt(0)}function $T(i,m){i&1&&Vt(0)}function JT(i,m){if(i&1&&(r(0,"div",38)(1,"div",23)(2,"div",25),p(3,"device.connectivity.install-necessary-client-tools"),a(),r(4,"div",46),b(5,zT,1,0,"ng-container",40),a()(),b(6,$T,1,0,"ng-container",40),a()),i&2){let e=v(4),n=U(23),t=U(25);o(5),s("ngTemplateOutlet",t)("ngTemplateOutletContext",pt(5,La,Et(4,xT))),o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(12,Hn,yn(8,fp,e.commands.mqtt.mqtt,e.commands.mqtt.mqtts,Et(7,up))))}}function QT(i,m){i&1&&(f(0,"mat-icon",41),p(1," MacOS "))}function YT(i,m){i&1&&Vt(0)}function KT(i,m){if(i&1&&(r(0,"div",38)(1,"div",23)(2,"div",25),p(3,"device.connectivity.install-necessary-client-tools"),a(),f(4,"tb-markdown",43),a(),b(5,YT,1,0,"ng-container",40),a()),i&2){let e=v(4),n=U(23);o(4),s("data",e.createMarkDownCommand("brew install mosquitto")),o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(8,Hn,yn(4,fp,e.commands.mqtt.mqtt,e.commands.mqtt.mqtts,Et(3,up))))}}function XT(i,m){i&1&&(f(0,"mat-icon",42),p(1," Linux "))}function ZT(i,m){i&1&&Vt(0)}function ex(i,m){if(i&1&&(r(0,"div",38)(1,"div",23)(2,"div",25),p(3,"device.connectivity.install-necessary-client-tools"),a(),f(4,"tb-markdown",43),a(),b(5,ZT,1,0,"ng-container",40),a()),i&2){let e=v(4),n=U(23);o(4),s("data",e.createMarkDownCommand("sudo apt-get install curl mosquitto-clients")),o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(8,Hn,yn(4,fp,e.commands.mqtt.mqtt,e.commands.mqtt.mqtts,Et(3,up))))}}function tx(i,m){i&1&&(f(0,"mat-icon",47),p(1," Docker "))}function ix(i,m){i&1&&Vt(0)}function nx(i,m){if(i&1&&(r(0,"div",38),b(1,ix,1,0,"ng-container",40),a()),i&2){let e=v(5),n=U(23);o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(7,Hn,yn(3,fp,e.commands.mqtt.docker.mqtt,e.commands.mqtt.docker.mqtts,Et(2,up))))}}function ox(i,m){i&1&&(r(0,"mat-tab"),b(1,tx,2,0,"ng-template",35)(2,nx,2,9,"ng-template",36),a())}function ax(i,m){if(i&1){let e=j();r(0,"div",33),p(1,"device.connectivity.use-following-instructions"),a(),r(2,"mat-tab-group",34),et("selectedIndexChange",function(t){I(e);let l=v(3);return Ze(l.mqttTabIndex,t)||(l.mqttTabIndex=t),M(t)}),r(3,"mat-tab"),b(4,HT,2,0,"ng-template",35)(5,JT,7,14,"ng-template",36),a(),r(6,"mat-tab"),b(7,QT,2,0,"ng-template",35)(8,KT,6,10,"ng-template",36),a(),r(9,"mat-tab"),b(10,XT,2,0,"ng-template",35)(11,ex,6,10,"ng-template",36),a(),b(12,ox,3,0,"mat-tab",45),a()}if(i&2){let e=v(3);o(2),Xe("selectedIndex",e.mqttTabIndex),o(10),s("ngIf",!!e.commands.mqtt.docker)}}function rx(i,m){if(i&1&&b(0,WT,2,5,"div",44)(1,ax,13,2,"ng-template",null,5,It),i&2){let e=U(2),n=v(2);s("ngIf",n.commands.mqtt.sparkplug)("ngIfElse",e)}}function sx(i,m){i&1&&(f(0,"mat-icon",42),p(1," Linux "))}function lx(i,m){i&1&&Vt(0)}function px(i,m){if(i&1&&(r(0,"div",23)(1,"div",25),p(2,"device.connectivity.install-necessary-client-tools"),a(),r(3,"div",46),b(4,lx,1,0,"ng-container",40),a()()),i&2){v(4);let e=U(25);o(4),s("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(3,La,Et(2,ET)))}}function mx(i,m){i&1&&Vt(0)}function dx(i,m){if(i&1&&(r(0,"div",38),b(1,px,5,5,"div",48)(2,mx,1,0,"ng-container",40),a()),i&2){let e=v(3),n=U(23);o(),s("ngIf",e.commands.coap.coaps!=="Check documentation"),o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(8,Hn,yn(4,Pg,e.commands.coap.coap,e.commands.coap.coaps,Et(3,Dg))))}}function cx(i,m){i&1&&(f(0,"mat-icon",47),p(1," Docker "))}function ux(i,m){i&1&&Vt(0)}function fx(i,m){if(i&1&&(r(0,"div",38),b(1,ux,1,0,"ng-container",40),a()),i&2){let e=v(4),n=U(23);o(),s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(7,Hn,yn(3,Pg,e.commands.coap.docker.coap,e.commands.coap.docker.coaps,Et(2,Dg))))}}function gx(i,m){i&1&&(r(0,"mat-tab"),b(1,cx,2,0,"ng-template",35)(2,fx,2,9,"ng-template",36),a())}function hx(i,m){if(i&1){let e=j();r(0,"div",33),p(1,"device.connectivity.use-following-instructions"),a(),r(2,"mat-tab-group",34),et("selectedIndexChange",function(t){I(e);let l=v(2);return Ze(l.coapTabIndex,t)||(l.coapTabIndex=t),M(t)}),r(3,"mat-tab"),b(4,sx,2,0,"ng-template",35)(5,dx,3,10,"ng-template",36),a(),b(6,gx,3,0,"mat-tab",45),a()}if(i&2){let e=v(2);o(2),Xe("selectedIndex",e.coapTabIndex),o(4),s("ngIf",!!e.commands.coap.docker)}}function bx(i,m){i&1&&Vt(0)}function vx(i,m){if(i&1&&(r(0,"div",23),b(1,bx,1,0,"ng-container",40),a()),i&2){v(2);let e=U(25);o(),s("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(3,La,Et(2,IT)))}}function yx(i,m){i&1&&Vt(0)}function _x(i,m){if(i&1&&(r(0,"div",23),b(1,yx,1,0,"ng-container",40),a()),i&2){v(2);let e=U(25);o(),s("ngTemplateOutlet",e)("ngTemplateOutletContext",pt(3,La,Et(2,MT)))}}function Cx(i,m){if(i&1&&(r(0,"div",51)(1,"div",52),p(2),d(3,"date"),a(),r(4,"div",52),p(5),a(),r(6,"div",52),p(7),a()()),i&2){let e=m.$implicit;o(2),O(Yt(3,3,e.lastUpdateTs,"yyyy-MM-dd HH:mm:ss")),o(3),O(e.key),o(2),O(e.value)}}function Sx(i,m){if(i&1&&(r(0,"div",49),b(1,Cx,8,6,"div",50),a()),i&2){let e=v(2);o(),s("ngForOf",e.latestTelemetry)}}function Tx(i,m){if(i&1&&(r(0,"section",18)(1,"tb-toggle-header",19,4),b(3,wT,3,4,"tb-toggle-option",20)(4,DT,3,4,"tb-toggle-option",20)(5,PT,3,4,"tb-toggle-option",20)(6,FT,3,4,"tb-toggle-option",20)(7,AT,3,4,"tb-toggle-option",20),a(),r(8,"div",18),Gt(9,21),b(10,UT,12,1,"ng-template",22)(11,rx,3,2,"ng-template",22)(12,hx,7,2,"ng-template",22)(13,vx,2,5,"ng-template",22)(14,_x,2,5,"ng-template",22),Ut(),a(),r(15,"div",23)(16,"div",24)(17,"div",25),p(18,"device.state"),a(),r(19,"div",26),p(20),d(21,"translate"),a()(),r(22,"div",27),p(23,"attribute.latest-telemetry"),a(),r(24,"div",28)(25,"div",29)(26,"div",30),p(27,"device.time"),a(),r(28,"div",30),p(29,"attribute.key"),a(),r(30,"div",30),p(31,"attribute.value"),a()(),b(32,Sx,2,1,"div",31),a()()()),i&2){let e=U(2),n=v(),t=U(21);o(),V("!hidden",n.allowTransportType.size<2),T("value",n.selectTransportType),o(2),s("ngIf",n.allowTransportType.has(n.BasicTransportType.HTTP)),o(),s("ngIf",n.allowTransportType.has(n.DeviceTransportType.MQTT)),o(),s("ngIf",n.allowTransportType.has(n.DeviceTransportType.COAP)),o(),s("ngIf",n.allowTransportType.has(n.DeviceTransportType.SNMP)),o(),s("ngIf",n.allowTransportType.has(n.DeviceTransportType.LWM2M)),o(),V("!hidden",!n.allowTransportType.size),o(),s("ngSwitch",e.value),o(),s("ngSwitchCase",n.BasicTransportType.HTTP),o(),s("ngSwitchCase",n.DeviceTransportType.MQTT),o(),s("ngSwitchCase",n.DeviceTransportType.COAP),o(),s("ngSwitchCase",n.DeviceTransportType.SNMP),o(),s("ngSwitchCase",n.DeviceTransportType.LWM2M),o(5),V("inactive",!n.status)("hide",n.status===void 0),o(),h(" ",c(21,23,n.status?"device.active":"device.inactive")," "),o(12),s("ngIf",n.latestTelemetry.length)("ngIfElse",t)}}function xx(i,m){i&1&&(r(0,"div",53),f(1,"mat-spinner",54),r(2,"span",55),p(3),d(4,"translate"),a()()),i&2&&(o(3),h(" ",c(4,1,"device.connectivity.loading-check-connectivity-command")," "))}function Ex(i,m){i&1&&(r(0,"div",56),f(1,"div",57),r(2,"div",33),p(3,"attribute.no-latest-telemetry"),a()())}function Ix(i,m){if(i&1&&f(0,"tb-markdown",43),i&2){let e=v().cmd,n=v();s("data",n.createMarkDownCommand(e.noSec))}}function Mx(i,m){if(i&1&&(r(0,"div"),f(1,"tb-markdown",43),a()),i&2){let e=v(2).cmd,n=v();o(),s("data",n.createMarkDownCommand(e.sec))}}function wx(i,m){i&1&&Vt(0)}function Dx(i,m){if(i&1&&b(0,wx,1,0,"ng-container",40),i&2){let e=v(2).cmd;v();let n=U(25);s("ngTemplateOutlet",n)("ngTemplateOutletContext",pt(2,La,e.doc))}}function Px(i,m){if(i&1&&b(0,Mx,2,1,"div",62)(1,Dx,1,4,"ng-template",null,7,It),i&2){let e=U(2),n=v().cmd;s("ngIf",n.sec!=="Check documentation")("ngIfElse",e)}}function Fx(i,m){if(i&1&&(r(0,"div",23)(1,"div",58)(2,"div",25),p(3,"device.connectivity.execute-following-command"),a(),r(4,"tb-toggle-header",59,6)(6,"tb-toggle-option",60),p(7),a(),r(8,"tb-toggle-option",61),p(9),a()()(),Gt(10,21),b(11,Ix,1,1,"ng-template",22)(12,Px,3,2,"ng-template",22),Ut(),a()),i&2){let e=m.cmd,n=U(5);o(),V("!hidden",!(e.noSec||e.sec!=="Check documentation")),o(3),V("!hidden",!e.noSec||!e.sec),T("value",e.noSec?"noSec":"sec"),o(3),O(e.noSecLabel),o(2),O(e.secLabel),o(),s("ngSwitch",n.value),o(),s("ngSwitchCase","noSec"),o(),s("ngSwitchCase","sec")}}function Ax(i,m){if(i&1&&(r(0,"div",63)(1,"div",64),p(2),d(3,"translate"),a(),r(4,"a",65)(5,"mat-icon"),p(6,"description"),a(),p(7),d(8,"translate"),a()()),i&2){let e=m.doc;o(2),O(c(3,3,e.text)),o(2),T("href",e.href,$n),o(3),h(" ",c(8,5,"common.documentation")," ")}}var gp=(()=>{class i extends nt{constructor(e,n,t,l,u,y,w){super(e,n,l),this.store=e,this.router=n,this.data=t,this.dialogRef=l,this.deviceService=u,this.telemetryWsService=y,this.zone=w,this.loadedCommand=!1,this.latestTelemetry=[],this.allowTransportType=new Set,this.BasicTransportType=rd,this.DeviceTransportType=xi,this.deviceTransportTypeTranslationMap=ca,this.notShowAgain=!1,this.httpTabIndex=0,this.mqttTabIndex=0,this.coapTabIndex=0,this.currentTime=Date.now(),this.transportTypes=[...Object.keys(rd),...Object.keys(xi)],this.data.afterAdd?(this.dialogTitle="device.connectivity.device-created-check-connectivity",this.showDontShowAgain=!0):(this.dialogTitle="device.connectivity.check-connectivity",this.showDontShowAgain=!1)}ngOnInit(){this.loadCommands(),this.subscribeToLatestTelemetry()}ngOnDestroy(){super.ngOnDestroy(),this.telemetrySubscriber?.complete(),this.telemetrySubscriber?.unsubscribe()}close(){this.notShowAgain&&this.showDontShowAgain?(this.store.dispatch(new Qo({notDisplayConnectivityAfterAddDevice:!0})),this.dialogRef.close(null)):this.dialogRef.close(null)}createMarkDownCommand(e){if(Array.isArray(e)){let n=[];return e.forEach(t=>n.push(this.createMarkDownSingleCommand(t))),n.join(`
<br />

`)}else return this.createMarkDownSingleCommand(e)}createMarkDownSingleCommand(e){return"```bash\n"+e+"{:copy-code}\n```"}loadCommands(){this.deviceService.getDevicePublishTelemetryCommands(this.data.deviceId.id).subscribe(e=>{this.commands=e;let n=Object.keys(e);this.transportTypes.forEach(t=>{n.find(u=>u.toUpperCase().startsWith(t))&&this.allowTransportType.add(t)}),this.selectTransportType=this.allowTransportType.values().next().value,this.selectTabIndexForUserOS(),this.loadedCommand=!0})}subscribeToLatestTelemetry(){this.store.pipe(Wt(Or)).pipe(ti(1)).subscribe(e=>{if(this.telemetrySubscriber=Kc.createEntityAttributesSubscription(this.telemetryWsService,this.data.deviceId,Qc.LATEST_TELEMETRY,this.zone),!e){let n=new Yc;n.entityType=this.data.deviceId.entityType,n.entityId=this.data.deviceId.id,n.scope=Br.SERVER_SCOPE,n.keys="active",this.telemetrySubscriber.subscriptionCommands.push(n)}this.telemetrySubscriber.subscribe(),this.telemetrySubscriber.attributeData$().subscribe(n=>{let t=n.reduce((l,u)=>(u.key==="active"?this.status=pi(u.value):u.lastUpdateTs>this.currentTime&&l.push(u),l),[]);this.latestTelemetry=t.sort((l,u)=>u.lastUpdateTs-l.lastUpdateTs)})})}selectTabIndexForUserOS(){switch(Bc()){case"linux":case"android":this.httpTabIndex=2,this.mqttTabIndex=2;break;case"macos":case"ios":this.httpTabIndex=1,this.mqttTabIndex=1,this.coapTabIndex=1;break;case"windows":this.httpTabIndex=0,this.mqttTabIndex=0,this.coapTabIndex=1;break;default:this.mqttTabIndex=this.commands.mqtt?.docker?3:0,this.coapTabIndex=this.commands.coap?.docker?1:0}}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(Ot),g(it),g(ma),g(X0),g(Cr))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-device-check-connectivity-dialog"]],features:[L],decls:26,vars:15,consts:[["loadingCommand",""],["noData",""],["executeCommand",""],["seeDocumentation",""],["transportProtocol",""],["mqttCommands",""],["protocolType",""],["checkDocumentation",""],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],["class","tb-form-panel no-padding no-border",4,"ngIf","ngIfElse"],["mat-dialog-actions","",1,"tb-dialog-actions"],[3,"ngModelChange","ngModel"],["mat-button","",3,"click","disabled"],[1,"tb-form-panel","no-padding","no-border"],["name","TransportProtocol","useSelectOnMdLg","false","appearance","fill",3,"value"],[3,"value",4,"ngIf"],[3,"ngSwitch"],[3,"ngSwitchCase"],[1,"tb-form-panel","stroked"],[1,"flex","flex-1","flex-row"],["translate","",1,"tb-form-panel-title"],[1,"status"],["translate","",1,"tb-form-panel-hint","tb-font-14"],[1,"tb-form-table"],[1,"tb-form-table-header"],["translate","",1,"tb-form-table-header-cell","flex-1"],["class","tb-form-table-body",4,"ngIf","ngIfElse"],[3,"value"],["translate","",1,"tb-no-data-text"],[3,"selectedIndexChange","selectedIndex"],["mat-tab-label",""],["matTabContent",""],["svgIcon","windows",1,"tabs-icon"],[1,"tb-form-panel","no-padding","no-border","tb-tab-body"],["translate","",1,"tb-install-instruction-text"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["svgIcon","macos",1,"tabs-icon"],["svgIcon","linux",1,"tabs-icon"],["usePlainMarkdown","","containerClass","tb-command-code",3,"data"],["class","tb-form-panel stroked",4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"tb-install-instruction-text"],["svgIcon","docker",1,"tabs-icon"],["class","tb-form-panel stroked",4,"ngIf"],[1,"tb-form-table-body"],["class","tb-form-table-row",4,"ngFor","ngForOf"],[1,"tb-form-table-row"],[1,"tb-form-table-row-cell","flex-1"],[1,"tb-loader"],["color","accent","diameter","65","strokeWidth","4"],[1,"mat-subtitle-1","label"],[1,"tb-no-data-available"],[1,"tb-no-data-bg"],[1,"flex","flex-row","items-center","justify-between"],["name","protocolType","useSelectOnMdLg","false",3,"value"],["value","noSec"],["value","sec"],[4,"ngIf","ngIfElse"],[1,"tb-form-row","no-border","no-padding","space-between"],[1,"tb-font-14","tb-flex-1"],["mat-stroked-button","","color","primary","target","_blank",3,"href"]],template:function(n,t){if(n&1){let l=j();r(0,"mat-toolbar",8)(1,"h2",9),p(2),a(),f(3,"span",10),r(4,"button",11),_("click",function(){return I(l),M(t.close())}),r(5,"mat-icon",12),p(6,"close"),a()()(),r(7,"div",13),b(8,Tx,33,25,"section",14),a(),r(9,"div",15)(10,"mat-slide-toggle",16),et("ngModelChange",function(y){return I(l),Ze(t.notShowAgain,y)||(t.notShowAgain=y),M(y)}),p(11),d(12,"translate"),a(),f(13,"span",10),r(14,"button",17),d(15,"async"),_("click",function(){return I(l),M(t.close())}),p(16),d(17,"translate"),a()(),b(18,xx,5,3,"ng-template",null,0,It)(20,Ex,4,0,"ng-template",null,1,It)(22,Fx,13,10,"ng-template",null,2,It)(24,Ax,9,7,"ng-template",null,3,It)}if(n&2){let l=U(19);o(2),O(t.dialogTitle),o(6),s("ngIf",t.loadedCommand)("ngIfElse",l),o(2),V("!hidden",!t.showDontShowAgain),Xe("ngModel",t.notShowAgain),o(),O(c(12,9,"action.dont-show-again")),o(3),s("disabled",c(15,11,t.isLoading$)),o(2),O(c(17,13,"action.close"))}},dependencies:[Te,G,Qn,_n,Cn,sa,ea,ee,Ee,ae,at,Rt,mt,to,Qr,Yr,St,aa,ht,W,Ye,J,Fu,Di,le,ke,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;max-height:100vh;display:grid;grid-template-rows:min-content minmax(auto,1fr) min-content}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;height:300px;max-height:100%}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:0;text-align:center}[_nghost-%COMP%]   .status[_ngcontent-%COMP%]{margin-left:12px;border-radius:12px;height:24px;line-height:24px;padding:0 8px;width:fit-content;color:#198038;background-color:#19803814;font-size:14px}[_nghost-%COMP%]   .status.inactive[_ngcontent-%COMP%]{color:#d12730;background-color:#d1273014}[_nghost-%COMP%]   .tb-hint-instruction[_ngcontent-%COMP%]{border-radius:6px;background-color:#3056800a;padding:6px 16px}[_nghost-%COMP%]   .tb-hint-instruction[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{vertical-align:middle}[_nghost-%COMP%]   .tb-font-14[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   .tb-flex-1[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .tb-form-table-body[_ngcontent-%COMP%]{max-height:108px;min-height:108px;overflow-y:auto;scrollbar-gutter:stable}[_nghost-%COMP%]   .tb-form-table-body[_ngcontent-%COMP%]   .tb-form-table-row[_ngcontent-%COMP%]{min-height:38px}[_nghost-%COMP%]   .tb-no-data-available[_ngcontent-%COMP%]   .tb-no-data-bg[_ngcontent-%COMP%]{min-height:68px}[_nghost-%COMP%]   .tb-install-instruction-text[_ngcontent-%COMP%]{min-height:42px}@media screen and (min-width: 600px) and (max-width: 959px){[_nghost-%COMP%]{width:470px}}@media screen and (min-width: 960px){[_nghost-%COMP%]{width:720px}}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding:8px 16px}.mat-mdc-dialog-container[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{max-height:80vh;padding:16px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper{padding:0}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]{margin:0;background:#f3f6fa;border-color:#305680;padding-right:38px;padding-bottom:4px;min-height:42px;scrollbar-width:thin}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]::-webkit-scrollbar{width:4px;height:4px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn{right:-2px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p{color:#305680}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div{background-color:#f3f6fa}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div img{display:none}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div:after{content:"";position:initial;display:block;width:18px;height:18px;background:#305680;mask-image:url(/assets/copy-code-icon.svg);-webkit-mask-image:url(/assets/copy-code-icon.svg);mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat}[_nghost-%COMP%]     .mdc-button__label>span .mat-icon{vertical-align:text-bottom;box-sizing:initial}[_nghost-%COMP%]     .tabs-icon{margin-right:8px}[_nghost-%COMP%]     .tb-form-panel.tb-tab-body{padding:16px 0 0}']})}}return i})();var Rn=(()=>{class i{constructor(e,n,t,l,u,y,w,x,q,De,Ve){this.store=e,this.broadcast=n,this.deviceService=t,this.customerService=l,this.dialogService=u,this.edgeService=y,this.homeDialogs=w,this.translate=x,this.datePipe=q,this.router=De,this.dialog=Ve,this.config=new Ge,this.config.entityType=k.DEVICE,this.config.entityComponent=pp,this.config.entityTabsComponent=cp,this.config.entityTranslations=Ue.get(k.DEVICE),this.config.entityResources=tt.get(k.DEVICE),this.config.addDialogStyle={width:"600px"},this.config.deleteEntityTitle=Ct=>this.translate.instant("device.delete-device-title",{deviceName:Ct.name}),this.config.deleteEntityContent=()=>this.translate.instant("device.delete-device-text"),this.config.deleteEntitiesTitle=Ct=>this.translate.instant("device.delete-devices-title",{count:Ct}),this.config.deleteEntitiesContent=()=>this.translate.instant("device.delete-devices-text"),this.config.loadEntity=Ct=>this.deviceService.getDeviceInfo(Ct.id),this.config.saveEntity=Ct=>this.deviceService.saveDevice(Ct).pipe(xt(()=>{this.broadcast.broadcast("deviceSaved")}),_t(en=>this.deviceService.getDeviceInfo(en.id.id))),this.config.onEntityAction=Ct=>this.onDeviceAction(Ct,this.config),this.config.detailsReadonly=()=>this.config.componentsData.deviceScope==="customer_user"||this.config.componentsData.deviceScope==="edge_customer_user",this.config.onLoadAction=Ct=>this.onLoadAction(Ct),this.config.headerComponent=mp}resolve(e){let n=e.params;return this.config.componentsData={deviceScope:e.data.devicesType,deviceInfoFilter:{},deviceCredentials$:new At,edgeId:n.edgeId},this.customerId=n.customerId,this.config.componentsData.edgeId=n.edgeId,this.store.pipe(Wt(Tn),ti(1)).pipe(xt(t=>{t.authority===E.CUSTOMER_USER&&(e.data.devicesType==="edge"?this.config.componentsData.deviceScope="edge_customer_user":this.config.componentsData.deviceScope="customer_user",this.customerId=t.customerId)}),_t(()=>this.customerId?this.customerService.getCustomer(this.customerId):ut(null)),ze(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-devices"):this.config.tableTitle=t.title+": "+this.translate.instant("device.devices"):this.config.componentsData.deviceScope==="edge"?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(l=>this.config.tableTitle=l.name+": "+this.translate.instant("device.devices")):this.config.tableTitle=this.translate.instant("device.devices"),this.config.columns=this.configureColumns(this.config.componentsData.deviceScope),this.configureEntityFunctions(this.config.componentsData.deviceScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.deviceScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.deviceScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.deviceScope),this.config.addEnabled=!(this.config.componentsData.deviceScope==="customer_user"||this.config.componentsData.deviceScope==="edge_customer_user"),this.config.entitiesDeleteEnabled=this.config.componentsData.deviceScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.deviceScope==="tenant",this.config)))}onLoadAction(e){let n=e.snapshot.queryParams;if(n){let t=Tt(n),l=!1;n?.deviceProfileId&&(this.config.componentsData.deviceInfoFilter.deviceProfileId=new rf(n?.deviceProfileId),delete t.deviceProfileId,l=!0),Vn(n?.active)&&(this.config.componentsData.deviceInfoFilter.active=n?.active===!0||n?.active==="true",delete t.active,l=!0),l&&this.router.navigate([],{relativeTo:e,queryParams:t,queryParamsHandling:"",replaceUrl:!0})}}configureColumns(e){let n=[new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("name","device.name","25%"),new Y("deviceProfileName","device-profile.device-profile","25%"),new Y("label","device.label","25%"),new Y("active","device.state","80px",t=>this.deviceState(t),t=>this.deviceStateStyle(t))];return e==="tenant"&&n.push(new Y("customerTitle","customer.customer","25%"),new Y("customerIsPublic","device.public","60px",t=>Ft(t.customerIsPublic),()=>({}))),n.push(new Y("gateway","device.is-gateway","60px",t=>Ft(t.additionalInfo&&t.additionalInfo.gateway),()=>({}),!1)),n}deviceState(e){let n="device.active",t="rgba(25, 128, 56, 0.08)";return e.active||(n="device.inactive",t="rgba(209, 39, 48, 0.08)"),`<div class="status" style="border-radius: 16px; height: 32px;
                line-height: 32px; padding: 0 12px; width: fit-content; background-color: ${t}">
                ${this.translate.instant(n)}
            </div>`}deviceStateStyle(e){let n={fontSize:"14px",color:"#198038",cursor:"pointer"};return e.active||(n.color="#d12730"),n}configureEntityFunctions(e){this.config.entitiesFetchFunction=n=>this.deviceService.getDeviceInfosByQuery(this.prepareDeviceInfoQuery(n)),e==="tenant"?this.config.deleteEntity=n=>this.deviceService.deleteDevice(n.id):this.config.deleteEntity=()=>ut()}prepareDeviceInfoQuery(e){let n=Tt(this.config.componentsData.deviceInfoFilter);return this.config.componentsData.deviceScope==="edge"||this.config.componentsData.deviceScope==="edge_customer_user"?n.edgeId=new sf(this.config.componentsData.edgeId):this.config.componentsData.deviceScope!=="tenant"&&(n.customerId=new Ko(this.customerId)),new Ju(e,n)}configureCellActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("device.make-public"),icon:"share",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,l)=>this.makePublic(t,l)},{name:this.translate.instant("device.assign-to-customer"),icon:"assignment_ind",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,l)=>this.assignToCustomer(t,[l.id])},{name:this.translate.instant("device.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)},{name:this.translate.instant("device.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)},{name:this.translate.instant("device.manage-credentials"),icon:"security",isEnabled:()=>!0,onAction:(t,l)=>this.manageCredentials(t,l)}),e==="customer"&&n.push({name:this.translate.instant("device.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)},{name:this.translate.instant("device.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)},{name:this.translate.instant("device.manage-credentials"),icon:"security",isEnabled:()=>!0,onAction:(t,l)=>this.manageCredentials(t,l)}),(e==="customer_user"||e==="edge_customer_user")&&n.push({name:this.translate.instant("device.view-credentials"),icon:"security",isEnabled:()=>!0,onAction:(t,l)=>this.manageCredentials(t,l)}),e==="edge"&&n.push({name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:t=>!0,onAction:(t,l)=>this.unassignFromEdge(t,l)}),n}configureGroupActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("device.assign-devices"),icon:"assignment_ind",isEnabled:!0,onAction:(t,l)=>this.assignToCustomer(t,l.map(u=>u.id))}),e==="customer"&&n.push({name:this.translate.instant("device.unassign-devices"),icon:"assignment_return",isEnabled:!0,onAction:(t,l)=>this.unassignDevicesFromCustomer(t,l)}),e==="edge"&&n.push({name:this.translate.instant("device.unassign-devices-from-edge"),icon:"assignment_return",isEnabled:!0,onAction:(t,l)=>this.unassignDevicesFromEdge(t,l)}),n}configureAddActions(e){this.config.addEntity=null;let n=[];return e==="tenant"&&(n.push({name:this.translate.instant("device.add-device-text"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.deviceWizard(t)},{name:this.translate.instant("device.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importDevices(t)}),this.config.addEntity=()=>(this.deviceWizard(null),ut(null))),e==="customer"&&n.push({name:this.translate.instant("device.assign-new-device"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addDevicesToCustomer(t)}),e==="edge"&&n.push({name:this.translate.instant("device.assign-new-device"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addDevicesToEdge(t)}),n}openDevice(e,n,t){e&&e.stopPropagation();let l=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(l)}importDevices(e){this.homeDialogs.importEntities(k.DEVICE).subscribe(n=>{n&&(this.broadcast.broadcast("deviceSaved"),this.config.updateData())})}deviceWizard(e){this.dialog.open(jf,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(n=>{n&&this.store.pipe(Wt(Yo("notDisplayConnectivityAfterAddDevice"))).pipe(ti(1)).subscribe(t=>{t?this.config.updateData():this.checkConnectivity(null,n.id,!0)})})}addDevicesToCustomer(e){e&&e.stopPropagation(),this.dialog.open(so,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:k.DEVICE}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}makePublic(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.make-public-device-title",{deviceName:n.name}),this.translate.instant("device.make-public-device-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.deviceService.makeDevicePublic(n.id.id).subscribe(()=>{this.config.updateData()})})}assignToCustomer(e,n){e&&e.stopPropagation(),this.dialog.open(ro,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:n,entityType:k.DEVICE}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}unassignFromCustomer(e,n){e&&e.stopPropagation();let t=n.customerIsPublic,l,u;t?(l=this.translate.instant("device.make-private-device-title",{deviceName:n.name}),u=this.translate.instant("device.make-private-device-text")):(l=this.translate.instant("device.unassign-device-title",{deviceName:n.name}),u=this.translate.instant("device.unassign-device-text")),this.dialogService.confirm(l,u,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(y=>{y&&this.deviceService.unassignDeviceFromCustomer(n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.deviceScope!=="tenant")})})}unassignDevicesFromCustomer(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.unassign-devices-title",{count:n.length}),this.translate.instant("device.unassign-devices-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let l=[];n.forEach(u=>{l.push(this.deviceService.unassignDeviceFromCustomer(u.id.id))}),Nt(l).subscribe(()=>{this.config.updateData()})}})}manageCredentials(e,n){e&&e.stopPropagation(),this.dialog.open(dp,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{deviceId:n.id.id,deviceProfileId:n.deviceProfileId.id,isReadOnly:this.config.componentsData.deviceScope==="customer_user"||this.config.componentsData.deviceScope==="edge_customer_user"}}).afterClosed().subscribe(t=>{Oe(t)&&this.config.componentsData.deviceCredentials$.next(t)})}onDeviceAction(e,n){switch(e.action){case"open":return this.openDevice(e.event,e.entity,n),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"assignToCustomer":return this.assignToCustomer(e.event,[e.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0;case"manageCredentials":return this.manageCredentials(e.event,e.entity),!0;case"checkConnectivity":return this.checkConnectivity(e.event,e.entity.id),!0}return!1}addDevicesToEdge(e){e&&e.stopPropagation(),this.dialog.open(lo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:k.DEVICE}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}unassignFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.unassign-device-from-edge-title",{deviceName:n.name}),this.translate.instant("device.unassign-device-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.deviceService.unassignDeviceFromEdge(this.config.componentsData.edgeId,n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.deviceScope!=="tenant")})})}unassignDevicesFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device.unassign-devices-from-edge-title",{count:n.length}),this.translate.instant("device.unassign-devices-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let l=[];n.forEach(u=>{l.push(this.deviceService.unassignDeviceFromEdge(this.config.componentsData.edgeId,u.id.id))}),Nt(l).subscribe(()=>{this.config.updateData()})}})}checkConnectivity(e,n,t=!1){e&&e.stopPropagation(),this.dialog.open(gp,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{deviceId:n,afterAdd:t}}).afterClosed().subscribe(()=>{t&&this.config.updateData()})}static{this.\u0275fac=function(n){return new(n||i)(D(F),D(xn),D(ma),D(Wi),D(jt),D(Hi),D(On),D(Z),D(ke),D(pe),D(je))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();C();function kx(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"asset.name-required")," "))}function Ox(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"asset.name-max-length")," "))}function Rx(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"asset.label-max-length")," "))}function Bx(i,m){if(i&1&&f(0,"tb-entity-autocomplete",19),i&2){let e=v();s("entityType",e.entityType.CUSTOMER)}}var hp=(()=>{class i extends Bt{constructor(e,n,t,l,u,y){super(e,u,t,l,y),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.fb=u,this.cd=y,this.entityType=k}ngOnInit(){this.assetScope=this.entitiesTableConfig.componentsData.assetScope,super.ngOnInit()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isAssignedToCustomer(e){return e&&e.customerId&&e.customerId.id!==Ae}buildForm(e){return this.fb.group({name:[e?e.name:"",[S.required,S.maxLength(255)]],assetProfileId:[e?e.assetProfileId:null,[S.required]],label:[e?e.label:"",S.maxLength(255)],customerId:[e?e.customerId:""],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})})}updateForm(e){this.entityForm.patchValue({name:e.name}),this.entityForm.patchValue({assetProfileId:e.assetProfileId}),this.entityForm.patchValue({label:e.label}),this.entityForm.patchValue({customerId:e.customerId}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}})}onAssetIdCopied(e){this.store.dispatch(new Be({message:this.translate.instant("asset.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onAssetProfileUpdated(){this.entitiesTableConfig.updateData(!1)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g("entity"),g("entitiesTableConfig"),g(de),g(Qe))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-asset"]],features:[L],decls:59,vars:69,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["matInput","","formControlName","label"],["required","","formControlName","assetProfileId",3,"assetProfileUpdated","selectDefaultProfile","showDetailsPageLink"],["useFullEntityId","","formControlName","customerId","labelText","asset.assign-to-customer",3,"entityType",4,"ngIf"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"],["useFullEntityId","","formControlName","customerId","labelText","asset.assign-to-customer",3,"entityType"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"button",1),d(2,"async"),_("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),a(),r(5,"button",1),d(6,"async"),_("click",function(u){return t.onEntityAction(u,"makePublic")}),p(7),d(8,"translate"),a(),r(9,"button",1),d(10,"async"),_("click",function(u){return t.onEntityAction(u,"assignToCustomer")}),p(11),d(12,"translate"),a(),r(13,"button",1),d(14,"async"),_("click",function(u){return t.onEntityAction(u,"unassignFromCustomer")}),p(15),d(16,"translate"),a(),r(17,"button",1),d(18,"async"),_("click",function(u){return t.onEntityAction(u,"unassignFromEdge")}),p(19),d(20,"translate"),a(),r(21,"button",1),d(22,"async"),_("click",function(u){return t.onEntityAction(u,"delete")}),p(23),d(24,"translate"),a(),r(25,"div",2)(26,"button",3),_("cbOnSuccess",function(u){return t.onAssetIdCopied(u)}),f(27,"mat-icon",4),r(28,"span",5),p(29,"asset.copyId"),a()()()(),r(30,"div",6)(31,"mat-form-field",7)(32,"mat-label",5),p(33,"asset.assignedToCustomer"),a(),f(34,"input",8),a(),r(35,"div",9),p(36),d(37,"translate"),a(),r(38,"form",10)(39,"fieldset",11),d(40,"async"),r(41,"mat-form-field",7)(42,"mat-label",5),p(43,"asset.name"),a(),f(44,"input",12),b(45,kx,3,3,"mat-error",13)(46,Ox,3,3,"mat-error",13),a(),r(47,"mat-form-field",7)(48,"mat-label",5),p(49,"asset.label"),a(),f(50,"input",14),b(51,Rx,3,3,"mat-error",13),a(),r(52,"tb-asset-profile-autocomplete",15),_("assetProfileUpdated",function(){return t.onAssetProfileUpdated()}),a(),b(53,Bx,1,1,"tb-entity-autocomplete",16),r(54,"div",17)(55,"mat-form-field",7)(56,"mat-label",5),p(57,"asset.description"),a(),f(58,"textarea",18),a()()()()()),n&2&&(o(),V("!hidden",t.isEdit||t.isDetailsPage),s("disabled",c(2,41,t.isLoading$)),o(2),h(" ",c(4,43,"common.open-details-page")," "),o(2),V("!hidden",t.isEdit||t.assetScope!=="tenant"||t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)),s("disabled",c(6,45,t.isLoading$)),o(2),h(" ",c(8,47,"asset.make-public")," "),o(2),V("!hidden",t.isEdit||t.assetScope!=="tenant"||t.isAssignedToCustomer(t.entity)),s("disabled",c(10,49,t.isLoading$)),o(2),h(" ",c(12,51,"asset.assign-to-customer")," "),o(2),V("!hidden",t.isEdit||t.assetScope!=="customer"&&t.assetScope!=="tenant"||!t.isAssignedToCustomer(t.entity)),s("disabled",c(14,53,t.isLoading$)),o(2),h(" ",c(16,55,t.entity!=null&&t.entity.customerIsPublic?"asset.make-private":"asset.unassign-from-customer")," "),o(2),V("!hidden",t.isEdit||t.assetScope!=="edge"),s("disabled",c(18,57,t.isLoading$)),o(2),h(" ",c(20,59,"edge.unassign-from-edge")," "),o(2),V("!hidden",t.hideDelete()||t.isEdit),s("disabled",c(22,61,t.isLoading$)),o(2),h(" ",c(24,63,"asset.delete")," "),o(3),V("!hidden",t.isEdit),s("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),V("!hidden",t.isEdit||!t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)||t.assetScope!=="tenant"),o(3),s("ngModel",t.entity==null?null:t.entity.customerTitle),o(),V("!hidden",t.isEdit||!(t.entity!=null&&t.entity.customerIsPublic)||t.assetScope!=="customer"&&t.assetScope!=="tenant"),o(),h(" ",c(37,65,"asset.asset-public")," "),o(2),s("formGroup",t.entityForm),o(),s("disabled",c(40,67,t.isLoading$)||!t.isEdit),o(6),s("ngIf",t.entityForm.get("name").hasError("required")),o(),s("ngIf",t.entityForm.get("name").hasError("maxlength")),o(5),s("ngIf",t.entityForm.get("label").hasError("maxlength")),o(),s("selectDefaultProfile",t.isAdd)("showDetailsPageLink",!0),o(),s("ngIf",t.isAdd))},dependencies:[G,ua,ee,ae,he,me,Ce,Pe,Jt,ce,ge,W,K,ue,Ye,ie,se,bt,J,ws,le,R],styles:['@charset "UTF-8";']})}}return i})();C();var bp=(()=>{class i extends oi{constructor(e){super(e),this.store=e,this.entityType=k}assetProfileChanged(e){this.entitiesTableConfig.componentsData.assetProfileId=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-asset-table-header"]],features:[L],decls:1,vars:4,consts:[["subscriptSizing","dynamic",3,"ngModelChange","ngModel","addNewProfile","displayAllOnEmpty","editProfileEnabled"]],template:function(n,t){n&1&&(r(0,"tb-asset-profile-autocomplete",0),_("ngModelChange",function(u){return t.assetProfileChanged(u)}),a()),n&2&&s("ngModel",t.entitiesTableConfig.componentsData.assetProfileId)("addNewProfile",!1)("displayAllOnEmpty",!0)("editProfileEnabled",!1)},dependencies:[W,Ye,ws],encapsulation:2})}}return i})();C();function Vx(i,m){if(i&1&&(r(0,"mat-tab",9,0),d(2,"translate"),f(3,"tb-attribute-table",10),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),s("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function jx(i,m){if(i&1&&(r(0,"mat-tab",9,1),d(2,"translate"),f(3,"tb-attribute-table",11),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),s("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function Lx(i,m){if(i&1&&(r(0,"mat-tab",9,2),d(2,"translate"),f(3,"tb-calculated-fields-table",12),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"entity.type-calculated-fields")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function Gx(i,m){if(i&1&&(r(0,"mat-tab",9,3),d(2,"translate"),f(3,"tb-alarm-table",12),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function Ux(i,m){if(i&1&&(r(0,"mat-tab",9,4),d(2,"translate"),f(3,"tb-event-table",13),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"asset.events")),o(3),s("defaultEventType",n.eventTypes.ERROR)("active",e.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function qx(i,m){if(i&1&&(r(0,"mat-tab",9,5),d(2,"translate"),f(3,"tb-relation-table",12),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function Wx(i,m){if(i&1&&(r(0,"mat-tab",9,6),d(2,"translate"),f(3,"tb-audit-log-table",14),a()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),s("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function Hx(i,m){if(i&1){let e=j();r(0,"mat-tab",9,7),d(2,"translate"),r(3,"tb-version-control",15),_("versionRestored",function(){I(e);let t=v();return M(t.entitiesTableConfig.updateData())}),a()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),s("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var vp=(()=>{class i extends Lt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-asset-tabs"]],features:[L],decls:8,vars:8,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["calculatedFieldsTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,Vx,4,7,"mat-tab",8)(1,jx,4,7,"mat-tab",8)(2,Lx,4,5,"mat-tab",8)(3,Gx,4,5,"mat-tab",8)(4,Ux,4,7,"mat-tab",8)(5,qx,4,5,"mat-tab",8)(6,Wx,4,6,"mat-tab",8)(7,Hx,4,7,"mat-tab",8),n&2&&(s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[G,St,ri,$i,Ai,vi,yi,ai,mo,R],encapsulation:2})}}return i})();var Bn=(()=>{class i{constructor(e,n,t,l,u,y,w,x,q,De,Ve){this.store=e,this.broadcast=n,this.assetService=t,this.customerService=l,this.edgeService=u,this.dialogService=y,this.homeDialogs=w,this.translate=x,this.datePipe=q,this.router=De,this.dialog=Ve,this.config=new Ge,this.config.entityType=k.ASSET,this.config.entityComponent=hp,this.config.entityTabsComponent=vp,this.config.entityTranslations=Ue.get(k.ASSET),this.config.entityResources=tt.get(k.ASSET),this.config.deleteEntityTitle=Ct=>this.translate.instant("asset.delete-asset-title",{assetName:Ct.name}),this.config.deleteEntityContent=()=>this.translate.instant("asset.delete-asset-text"),this.config.deleteEntitiesTitle=Ct=>this.translate.instant("asset.delete-assets-title",{count:Ct}),this.config.deleteEntitiesContent=()=>this.translate.instant("asset.delete-assets-text"),this.config.loadEntity=Ct=>this.assetService.getAssetInfo(Ct.id),this.config.saveEntity=Ct=>this.assetService.saveAsset(Ct).pipe(xt(()=>{this.broadcast.broadcast("assetSaved")}),_t(en=>this.assetService.getAssetInfo(en.id.id))),this.config.onEntityAction=Ct=>this.onAssetAction(Ct,this.config),this.config.detailsReadonly=()=>this.config.componentsData.assetScope==="customer_user"||this.config.componentsData.assetScope==="edge_customer_user",this.config.headerComponent=bp}resolve(e){let n=e.params;return this.config.componentsData={assetScope:e.data.assetsType,assetProfileId:null,assetType:"",edgeId:n.edgeId},this.customerId=n.customerId,this.store.pipe(Wt(Tn),ti(1)).pipe(xt(t=>{t.authority===E.CUSTOMER_USER&&(e.data.assetsType==="edge"?this.config.componentsData.assetScope="edge_customer_user":this.config.componentsData.assetScope="customer_user",this.customerId=t.customerId)}),_t(()=>this.customerId?this.customerService.getCustomer(this.customerId):ut(null)),ze(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-assets"):this.config.tableTitle=t.title+": "+this.translate.instant("asset.assets"):this.config.componentsData.assetScope==="edge"?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(l=>this.config.tableTitle=l.name+": "+this.translate.instant("asset.assets")):this.config.tableTitle=this.translate.instant("asset.assets"),this.config.columns=this.configureColumns(this.config.componentsData.assetScope),this.configureEntityFunctions(this.config.componentsData.assetScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.assetScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.assetScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.assetScope),this.config.addEnabled=!(this.config.componentsData.assetScope==="customer_user"||this.config.componentsData.assetScope==="edge_customer_user"),this.config.entitiesDeleteEnabled=this.config.componentsData.assetScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.assetScope==="tenant",this.config)))}configureColumns(e){let n=[new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("name","asset.name","25%"),new Y("assetProfileName","asset-profile.asset-profile","25%"),new Y("label","asset.label","25%")];return e==="tenant"&&n.push(new Y("customerTitle","customer.customer","25%"),new Y("customerIsPublic","asset.public","60px",t=>Ft(t.customerIsPublic),()=>({}),!1)),n}configureEntityFunctions(e){e==="tenant"?(this.config.entitiesFetchFunction=n=>this.assetService.getTenantAssetInfosByAssetProfileId(n,this.config.componentsData.assetProfileId!==null?this.config.componentsData.assetProfileId.id:""),this.config.deleteEntity=n=>this.assetService.deleteAsset(n.id)):e==="edge"||e==="edge_customer_user"?this.config.entitiesFetchFunction=n=>this.assetService.getEdgeAssets(this.config.componentsData.edgeId,n,this.config.componentsData.assetType):(this.config.entitiesFetchFunction=n=>this.assetService.getCustomerAssetInfosByAssetProfileId(this.customerId,n,this.config.componentsData.assetProfileId!==null?this.config.componentsData.assetProfileId.id:""),this.config.deleteEntity=n=>this.assetService.unassignAssetFromCustomer(n.id))}configureCellActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("asset.make-public"),icon:"share",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,l)=>this.makePublic(t,l)},{name:this.translate.instant("asset.assign-to-customer"),icon:"assignment_ind",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,l)=>this.assignToCustomer(t,[l.id])},{name:this.translate.instant("asset.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)},{name:this.translate.instant("asset.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)}),e==="customer"&&n.push({name:this.translate.instant("asset.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)},{name:this.translate.instant("asset.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)}),e==="edge"&&n.push({name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:t=>!0,onAction:(t,l)=>this.unassignFromEdge(t,l)}),n}configureGroupActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("asset.assign-assets"),icon:"assignment_ind",isEnabled:!0,onAction:(t,l)=>this.assignToCustomer(t,l.map(u=>u.id))}),e==="customer"&&n.push({name:this.translate.instant("asset.unassign-assets"),icon:"assignment_return",isEnabled:!0,onAction:(t,l)=>this.unassignAssetsFromCustomer(t,l)}),e==="edge"&&n.push({name:this.translate.instant("asset.unassign-assets-from-edge"),icon:"assignment_return",isEnabled:!0,onAction:(t,l)=>this.unassignAssetsFromEdge(t,l)}),n}configureAddActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("asset.add-asset-text"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.config.getTable().addEntity(t)},{name:this.translate.instant("asset.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importAssets(t)}),e==="customer"&&n.push({name:this.translate.instant("asset.assign-new-asset"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addAssetsToCustomer(t)}),e==="edge"&&n.push({name:this.translate.instant("asset.assign-new-asset"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addAssetsToEdge(t)}),n}importAssets(e){this.homeDialogs.importEntities(k.ASSET).subscribe(n=>{n&&(this.broadcast.broadcast("assetSaved"),this.config.updateData())})}openAsset(e,n,t){e&&e.stopPropagation();let l=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(l)}addAssetsToCustomer(e){e&&e.stopPropagation(),this.dialog.open(so,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:k.ASSET}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}makePublic(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.make-public-asset-title",{assetName:n.name}),this.translate.instant("asset.make-public-asset-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.assetService.makeAssetPublic(n.id.id).subscribe(()=>{this.config.updateData()})})}assignToCustomer(e,n){e&&e.stopPropagation(),this.dialog.open(ro,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:n,entityType:k.ASSET}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}unassignFromCustomer(e,n){e&&e.stopPropagation();let t=n.customerIsPublic,l,u;t?(l=this.translate.instant("asset.make-private-asset-title",{assetName:n.name}),u=this.translate.instant("asset.make-private-asset-text")):(l=this.translate.instant("asset.unassign-asset-title",{assetName:n.name}),u=this.translate.instant("asset.unassign-asset-text")),this.dialogService.confirm(l,u,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(y=>{y&&this.assetService.unassignAssetFromCustomer(n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.assetScope!=="tenant")})})}unassignAssetsFromCustomer(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.unassign-assets-title",{count:n.length}),this.translate.instant("asset.unassign-assets-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let l=[];n.forEach(u=>{l.push(this.assetService.unassignAssetFromCustomer(u.id.id))}),Nt(l).subscribe(()=>{this.config.updateData()})}})}onAssetAction(e,n){switch(e.action){case"open":return this.openAsset(e.event,e.entity,n),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"assignToCustomer":return this.assignToCustomer(e.event,[e.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0}return!1}addAssetsToEdge(e){e&&e.stopPropagation(),this.dialog.open(lo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:k.ASSET}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}unassignFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.unassign-asset-from-edge-title",{assetName:n.name}),this.translate.instant("asset.unassign-asset-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.assetService.unassignAssetFromEdge(this.config.componentsData.edgeId,n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.assetScope!=="tenant")})})}unassignAssetsFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset.unassign-assets-from-edge-title",{count:n.length}),this.translate.instant("asset.unassign-assets-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let l=[];n.forEach(u=>{l.push(this.assetService.unassignAssetFromEdge(this.config.componentsData.edgeId,u.id.id))}),Nt(l).subscribe(()=>{this.config.updateData()})}})}static{this.\u0275fac=function(n){return new(n||i)(D(F),D(xn),D(ju),D(Wi),D(Hi),D(jt),D(On),D(Z),D(ke),D(pe),D(je))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();C();function $x(i,m){if(i&1){let e=j();Gt(0),r(1,"button",1),d(2,"async"),_("click",function(t){I(e);let l=v();return M(l.onEntityAction(t,"openInstallInstructions"))}),r(3,"mat-icon"),p(4,"info_outline"),a(),r(5,"span"),p(6),d(7,"translate"),a()(),Ut()}if(i&2){let e=v();o(),V("!hidden",e.isEdit||e.edgeScope==="customer_user"),s("disabled",c(2,4,e.isLoading$)),o(5),O(c(7,6,"edge.install-connect-instructions"))}}function Jx(i,m){if(i&1){let e=j();Gt(0),r(1,"button",1),d(2,"async"),_("click",function(t){I(e);let l=v();return M(l.onEntityAction(t,"openUpgradeInstructions"))}),r(3,"mat-icon"),p(4,"info_outline"),a(),r(5,"span"),p(6),d(7,"translate"),a()(),Ut()}if(i&2){let e=v();o(),V("!hidden",e.isEdit||e.edgeScope==="customer_user"),s("disabled",c(2,4,e.isLoading$)),o(5),O(c(7,6,"edge.upgrade-instructions"))}}function Qx(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"edge.name-required")," "))}function Yx(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"edge.name-max-length")," "))}function Kx(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"edge.label-max-length")," "))}var yp=(()=>{class i extends Bt{constructor(e,n,t,l,u,y,w){super(e,y,l,u,w),this.store=e,this.translate=n,this.edgeService=t,this.entityValue=l,this.entitiesTableConfigValue=u,this.fb=y,this.cd=w,this.entityType=k,this.upgradeAvailable=!1}ngOnInit(){this.edgeScope=this.entitiesTableConfig.componentsData.edgeScope,super.ngOnInit()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isAssignedToCustomer(e){return e&&e.customerId&&e.customerId.id!==Ae}buildForm(e){let n=this.fb.group({name:[e?e.name:"",[S.required,S.maxLength(255)]],type:[e?.type?e.type:"default",[S.required,S.maxLength(255)]],label:[e?e.label:"",S.maxLength(255)],routingKey:this.fb.control({value:e?e.routingKey:null,disabled:!0}),secret:this.fb.control({value:e?e.secret:null,disabled:!0}),additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})});return this.generateRoutingKeyAndSecret(e,n),n}updateForm(e){this.entityForm.patchValue({name:e.name,type:e.type,label:e.label,routingKey:e.routingKey,secret:e.secret,additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),this.generateRoutingKeyAndSecret(e,this.entityForm),this.edgeService.isEdgeUpgradeAvailable(this.entity.id.id).subscribe(n=>{this.upgradeAvailable=n})}updateFormState(){super.updateFormState(),this.entityForm.get("routingKey").disable({emitEvent:!1}),this.entityForm.get("secret").disable({emitEvent:!1})}onEdgeIdCopied(e){this.store.dispatch(new Be({message:this.translate.instant("edge.id-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onEdgeInfoCopied(e){let n=e==="key"?"edge.edge-key-copied-message":"edge.edge-secret-copied-message";this.store.dispatch(new Be({message:this.translate.instant(n),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}generateRoutingKeyAndSecret(e,n){e&&!e.id&&(n.get("routingKey").patchValue(Oc(),{emitEvent:!1}),n.get("secret").patchValue(Rc(20),{emitEvent:!1}))}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g(Hi),g("entity"),g("entitiesTableConfig"),g(de),g(Qe))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-edge"]],features:[L],decls:112,vars:138,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","flex-wrap","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent","disabled"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],["mat-raised-button","","ngxClipboard","",3,"click","disabled"],["svgIcon","mdi:sync"],[1,"flex","flex-row","xs:flex-col"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","type",3,"required","entityType"],[1,"flex","flex-row"],[1,"mat-block","flex-1"],["matInput","","formControlName","routingKey"],["mat-icon-button","","type","button","ngxClipboard","",3,"cbOnSuccess","cbContent","matTooltip"],["matInput","","formControlName","secret"],["matInput","","formControlName","label"],["formGroupName","additionalInfo",1,"flex","flex-col"],["matInput","","formControlName","description","rows","2"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"button",1),d(2,"async"),_("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),a(),r(5,"button",1),d(6,"async"),_("click",function(u){return t.onEntityAction(u,"makePublic")}),p(7),d(8,"translate"),a(),r(9,"button",1),d(10,"async"),_("click",function(u){return t.onEntityAction(u,"assignToCustomer")}),p(11),d(12,"translate"),a(),r(13,"button",1),d(14,"async"),_("click",function(u){return t.onEntityAction(u,"unassignFromCustomer")}),p(15),d(16,"translate"),a(),r(17,"button",1),d(18,"async"),_("click",function(u){return t.onEntityAction(u,"openEdgeAssets")}),p(19),d(20,"translate"),a(),r(21,"button",1),d(22,"async"),_("click",function(u){return t.onEntityAction(u,"openEdgeDevices")}),p(23),d(24,"translate"),a(),r(25,"button",1),d(26,"async"),_("click",function(u){return t.onEntityAction(u,"openEdgeEntityViews")}),p(27),d(28,"translate"),a(),r(29,"button",1),d(30,"async"),_("click",function(u){return t.onEntityAction(u,"openEdgeDashboards")}),p(31),d(32,"translate"),a(),r(33,"button",1),d(34,"async"),_("click",function(u){return t.onEntityAction(u,"openEdgeRuleChains")}),p(35),d(36,"translate"),a(),r(37,"button",1),d(38,"async"),_("click",function(u){return t.onEntityAction(u,"delete")}),p(39),d(40,"translate"),a(),r(41,"div",2)(42,"button",3),d(43,"async"),_("cbOnSuccess",function(u){return t.onEdgeIdCopied(u)}),f(44,"mat-icon",4),r(45,"span",5),p(46,"edge.copy-id"),a()(),r(47,"button",3),d(48,"async"),_("cbOnSuccess",function(){return t.onEdgeInfoCopied("key")}),f(49,"mat-icon",4),r(50,"span",5),p(51,"edge.copy-edge-key"),a()(),r(52,"button",3),d(53,"async"),_("cbOnSuccess",function(){return t.onEdgeInfoCopied("secret")}),f(54,"mat-icon",4),r(55,"span",5),p(56,"edge.copy-edge-secret"),a()(),r(57,"button",6),d(58,"async"),_("click",function(u){return t.onEntityAction(u,"syncEdge")}),f(59,"mat-icon",7),r(60,"span",5),p(61,"edge.sync"),a()()(),r(62,"div",8)(63,"div",9),b(64,$x,8,8,"ng-container",10)(65,Jx,8,8,"ng-container",10),a()()(),r(66,"div",11)(67,"mat-form-field",12)(68,"mat-label",5),p(69,"edge.assignedToCustomer"),a(),f(70,"input",13),a(),r(71,"div",14),p(72),d(73,"translate"),a(),r(74,"form",15)(75,"fieldset",16),d(76,"async"),r(77,"mat-form-field",12)(78,"mat-label",5),p(79,"edge.name"),a(),f(80,"input",17),b(81,Qx,3,3,"mat-error",18)(82,Yx,3,3,"mat-error",18),a(),f(83,"tb-entity-subtype-autocomplete",19),a(),r(84,"div",20)(85,"mat-form-field",21)(86,"mat-label",5),p(87,"edge.edge-key"),a(),f(88,"input",22),a(),r(89,"button",23),d(90,"translate"),_("cbOnSuccess",function(){return t.onEdgeInfoCopied("key")}),f(91,"mat-icon",4),a()(),r(92,"div",20)(93,"mat-form-field",21)(94,"mat-label",5),p(95,"edge.edge-secret"),a(),f(96,"input",24),a(),r(97,"button",23),d(98,"translate"),_("cbOnSuccess",function(){return t.onEdgeInfoCopied("secret")}),f(99,"mat-icon",4),a()(),r(100,"fieldset",16),d(101,"async"),r(102,"mat-form-field",12)(103,"mat-label",5),p(104,"edge.label"),a(),f(105,"input",25),b(106,Kx,3,3,"mat-error",18),a(),r(107,"div",26)(108,"mat-form-field",12)(109,"mat-label",5),p(110,"edge.description"),a(),f(111,"textarea",27),a()()()()()),n&2&&(o(),V("!hidden",t.isEdit||t.isDetailsPage),s("disabled",c(2,80,t.isLoading$)),o(2),h(" ",c(4,82,"common.open-details-page")," "),o(2),V("!hidden",t.isEdit||t.edgeScope!=="tenant"||t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)),s("disabled",c(6,84,t.isLoading$)),o(2),h(" ",c(8,86,"edge.make-public")," "),o(2),V("!hidden",t.isEdit||t.edgeScope!=="tenant"||t.isAssignedToCustomer(t.entity)),s("disabled",c(10,88,t.isLoading$)),o(2),h(" ",c(12,90,"edge.assign-to-customer")," "),o(2),V("!hidden",t.isEdit||t.edgeScope!=="customer"&&t.edgeScope!=="tenant"||!t.isAssignedToCustomer(t.entity)),s("disabled",c(14,92,t.isLoading$)),o(2),h(" ",c(16,94,t.entity!=null&&t.entity.customerIsPublic?"edge.make-private":"edge.unassign-from-customer")," "),o(2),V("!hidden",t.isEdit||t.edgeScope==="customer"),s("disabled",c(18,96,t.isLoading$)),o(2),h(" ",c(20,98,"edge.manage-assets")," "),o(2),V("!hidden",t.isEdit||t.edgeScope==="customer"),s("disabled",c(22,100,t.isLoading$)),o(2),h(" ",c(24,102,"edge.manage-devices")," "),o(2),V("!hidden",t.isEdit||t.edgeScope==="customer"),s("disabled",c(26,104,t.isLoading$)),o(2),h(" ",c(28,106,"edge.manage-entity-views")," "),o(2),V("!hidden",t.isEdit||t.edgeScope==="customer"),s("disabled",c(30,108,t.isLoading$)),o(2),h(" ",c(32,110,"edge.manage-dashboards")," "),o(2),V("!hidden",t.isEdit||t.edgeScope!=="tenant"),s("disabled",c(34,112,t.isLoading$)),o(2),h(" ",c(36,114,"edge.manage-rulechains")," "),o(2),V("!hidden",t.hideDelete()||t.isEdit),s("disabled",c(38,116,t.isLoading$)),o(2),h(" ",c(40,118,"edge.delete")," "),o(3),V("!hidden",t.isEdit),s("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id)("disabled",c(43,120,t.isLoading$)),o(5),V("!hidden",t.isEdit||t.edgeScope==="customer_user"),s("cbContent",t.entity==null?null:t.entity.routingKey)("disabled",c(48,122,t.isLoading$)),o(5),V("!hidden",t.isEdit||t.edgeScope==="customer_user"),s("cbContent",t.entity==null?null:t.entity.secret)("disabled",c(53,124,t.isLoading$)),o(5),V("!hidden",t.isEdit||t.edgeScope==="customer_user"),s("disabled",c(58,126,t.isLoading$)),o(6),s("ngSwitch",t.upgradeAvailable),o(),s("ngSwitchCase",!1),o(),s("ngSwitchCase",!0),o(2),V("!hidden",t.isEdit||!t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)||t.edgeScope!=="tenant"),o(3),s("ngModel",t.entity==null?null:t.entity.customerTitle),o(),V("!hidden",t.isEdit||!(t.entity!=null&&t.entity.customerIsPublic)||t.edgeScope!=="tenant"),o(),h(" ",c(73,128,"edge.edge-public")," "),o(2),s("formGroup",t.entityForm),o(),s("disabled",c(76,130,t.isLoading$)||!t.isEdit),o(6),s("ngIf",t.entityForm.get("name").hasError("required")),o(),s("ngIf",t.entityForm.get("name").hasError("maxlength")),o(),s("required",!0)("entityType",t.entityType.EDGE),o(),V("!hidden",t.edgeScope==="customer_user"),o(5),T("matTooltip",c(90,132,"edge.copy-edge-key")),s("cbContent",t.entityForm==null?null:t.entityForm.get("routingKey").value),o(3),V("!hidden",t.edgeScope==="customer_user"),o(5),T("matTooltip",c(98,134,"edge.copy-edge-secret")),s("cbContent",t.entityForm==null?null:t.entityForm.get("secret").value),o(3),s("disabled",c(101,136,t.isLoading$)||!t.isEdit),o(6),s("ngIf",t.entityForm.get("label").hasError("maxlength")))},dependencies:[G,_n,Cn,rs,ee,Ee,ae,he,me,Ce,Pe,Pt,Jt,ce,ge,W,K,ue,Ye,ie,se,bt,J,le,R],styles:['@charset "UTF-8";']})}}return i})();C();var _p=(()=>{class i extends oi{constructor(e){super(e),this.store=e,this.entityType=k}edgeTypeChanged(e){this.entitiesTableConfig.componentsData.edgeType=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-edge-table-header"]],features:[L],decls:1,vars:3,consts:[["subscriptSizing","dynamic",3,"ngModelChange","showLabel","entityType","ngModel"]],template:function(n,t){n&1&&(r(0,"tb-entity-subtype-select",0),_("ngModelChange",function(u){return t.edgeTypeChanged(u)}),a()),n&2&&s("showLabel",!0)("entityType",t.entityType.EDGE)("ngModel",t.entitiesTableConfig.componentsData.edgeType)},dependencies:[ss,W,Ye],encapsulation:2})}}return i})();C();function Zx(i,m){if(i&1&&(r(0,"mat-tab",8,0),d(2,"translate"),f(3,"tb-attribute-table",9),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),s("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function eE(i,m){if(i&1&&(r(0,"mat-tab",8,1),d(2,"translate"),f(3,"tb-attribute-table",10),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),s("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function tE(i,m){if(i&1&&(r(0,"mat-tab",8,2),d(2,"translate"),f(3,"tb-alarm-table",11),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function iE(i,m){if(i&1&&(r(0,"mat-tab",8,3),d(2,"translate"),f(3,"tb-event-table",12),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"edge.events")),o(3),s("defaultEventType",n.eventTypes.ERROR)("active",e.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function nE(i,m){if(i&1&&(r(0,"mat-tab",8,4),d(2,"translate"),f(3,"tb-edge-downlink-table",11),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"edge.downlinks")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function oE(i,m){if(i&1&&(r(0,"mat-tab",8,5),d(2,"translate"),f(3,"tb-relation-table",11),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function aE(i,m){if(i&1&&(r(0,"mat-tab",8,6),d(2,"translate"),f(3,"tb-audit-log-table",13),a()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),s("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}var Cp=(()=>{class i extends Lt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-edge-tabs"]],features:[L],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["downLinksTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"]],template:function(n,t){n&1&&b(0,Zx,4,7,"mat-tab",7)(1,eE,4,7,"mat-tab",7)(2,tE,4,5,"mat-tab",7)(3,iE,4,7,"mat-tab",7)(4,nE,4,5,"mat-tab",7)(5,oE,4,5,"mat-tab",7)(6,aE,4,6,"mat-tab",7),n&2&&(s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[G,St,ri,$i,Lf,Ai,vi,yi,R],encapsulation:2})}}return i})();C();function rE(i,m){i&1&&(f(0,"mat-icon",15),p(1," Ubuntu "))}function sE(i,m){if(i&1&&(r(0,"div",11)(1,"div",16),f(2,"tb-markdown",17),a()()),i&2){let e=v(2);o(2),s("data",e.contentData.ubuntu)}}function lE(i,m){i&1&&(f(0,"mat-icon",18),p(1," CentOS/RHEL "))}function pE(i,m){if(i&1&&(r(0,"div",11)(1,"div",16),f(2,"tb-markdown",17),a()()),i&2){let e=v(2);o(2),s("data",e.contentData.centos)}}function mE(i,m){i&1&&(f(0,"mat-icon",19),p(1," Docker "))}function dE(i,m){if(i&1&&(r(0,"div",11)(1,"div",16),f(2,"tb-markdown",17),a()()),i&2){let e=v(2);o(2),s("data",e.contentData.docker)}}function cE(i,m){if(i&1){let e=j();r(0,"section",11)(1,"div",11)(2,"mat-tab-group",12),et("selectedIndexChange",function(t){I(e);let l=v();return Ze(l.tabIndex,t)||(l.tabIndex=t),M(t)}),_("selectedTabChange",function(){I(e);let t=v();return M(t.selectedTabChange(t.tabIndex))}),r(3,"mat-tab"),b(4,rE,2,0,"ng-template",13)(5,sE,3,1,"ng-template",14),a(),r(6,"mat-tab"),b(7,lE,2,0,"ng-template",13)(8,pE,3,1,"ng-template",14),a(),r(9,"mat-tab"),b(10,mE,2,0,"ng-template",13)(11,dE,3,1,"ng-template",14),a()()()()}if(i&2){let e=v();o(2),Xe("selectedIndex",e.tabIndex)}}function uE(i,m){i&1&&(r(0,"div",20),f(1,"mat-spinner",21),r(2,"span",22),p(3),d(4,"translate"),a()()),i&2&&(o(3),h(" ",c(4,1,"edge.loading-edge-instructions")," "))}var Sp=(()=>{class i extends nt{constructor(e,n,t,l,u,y){super(e,n,l),this.store=e,this.router=n,this.data=t,this.dialogRef=l,this.attributeService=u,this.edgeService=y,this.loadedInstructions=!1,this.notShowAgain=!1,this.tabIndex=0,this.instructionsMethod=Xu,this.contentData={},this.data.afterAdd?(this.dialogTitle="edge.install-connect-instructions-edge-created",this.showDontShowAgain=!0):this.data.upgradeAvailable?(this.dialogTitle="edge.upgrade-instructions",this.showDontShowAgain=!1):(this.dialogTitle="edge.install-connect-instructions",this.showDontShowAgain=!1)}ngOnInit(){this.getInstructions(this.instructionsMethod[this.tabIndex])}ngOnDestroy(){super.ngOnDestroy()}close(){this.notShowAgain&&this.showDontShowAgain?(this.store.dispatch(new Qo({notDisplayInstructionsAfterAddEdge:!0})),this.dialogRef.close(null)):this.dialogRef.close(null)}selectedTabChange(e){this.getInstructions(this.instructionsMethod[e])}getInstructions(e){if(!this.contentData[e]){this.loadedInstructions=!1;let n;this.data.upgradeAvailable?n=this.attributeService.getEntityAttributes(this.data.edge.id,Br.SERVER_SCOPE,[Zu]).pipe(_t(t=>{if(t.length){let l=t[0].value;return this.edgeService.getEdgeUpgradeInstructions(l,e)}})):n=this.edgeService.getEdgeInstallInstructions(this.data.edge.id.id,e),n.subscribe(t=>{this.contentData[e]=t.instructions,this.loadedInstructions=!0})}}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(Ot),g(it),g(Qu),g(Hi))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-edge-installation-dialog"]],features:[L],decls:20,vars:15,consts:[["loadingInstructions",""],["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],["class","tb-form-panel no-padding no-border",4,"ngIf","ngIfElse"],["mat-dialog-actions","",1,"tb-dialog-actions"],[3,"ngModelChange","ngModel"],["mat-button","",3,"click","disabled"],[1,"tb-form-panel","no-padding","no-border"],[3,"selectedIndexChange","selectedTabChange","selectedIndex"],["mat-tab-label",""],["matTabContent",""],["svgIcon","mdi:ubuntu",1,"tabs-icon"],[1,"tb-form-panel","no-padding","stroked"],[3,"data"],["svgIcon","mdi:centos",1,"tabs-icon"],["svgIcon","docker",1,"tabs-icon"],[1,"tb-loader"],["color","accent","diameter","65","strokeWidth","4"],[1,"mat-subtitle-1","label"]],template:function(n,t){if(n&1){let l=j();r(0,"mat-toolbar",1)(1,"h2",2),p(2),a(),f(3,"span",3),r(4,"button",4),_("click",function(){return I(l),M(t.close())}),r(5,"mat-icon",5),p(6,"close"),a()()(),r(7,"div",6),b(8,cE,12,1,"section",7),a(),r(9,"div",8)(10,"mat-slide-toggle",9),et("ngModelChange",function(y){return I(l),Ze(t.notShowAgain,y)||(t.notShowAgain=y),M(y)}),p(11),d(12,"translate"),a(),f(13,"span",3),r(14,"button",10),d(15,"async"),_("click",function(){return I(l),M(t.close())}),p(16),d(17,"translate"),a()(),b(18,uE,5,3,"ng-template",null,0,It)}if(n&2){let l=U(19);o(2),O(t.dialogTitle),o(6),s("ngIf",t.loadedInstructions)("ngIfElse",l),o(2),V("!hidden",!t.showDontShowAgain),Xe("ngModel",t.notShowAgain),o(),O(c(12,9,"action.dont-show-again")),o(3),s("disabled",c(15,11,t.isLoading$)),o(2),O(c(17,13,"action.close"))}},dependencies:[G,sa,ee,Ee,ae,at,Rt,mt,to,Qr,Yr,St,aa,ht,W,Ye,J,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;max-height:100vh;display:grid;grid-template-rows:min-content minmax(auto,1fr) min-content}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;height:300px;max-height:100%}[_nghost-%COMP%]   .tb-loader[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:0;text-align:center}[_nghost-%COMP%]   .tb-font-14[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   .tb-flex-1[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 600px) and (max-width: 959px){[_nghost-%COMP%]{width:705px}}@media screen and (min-width: 960px){[_nghost-%COMP%]{width:1080px}}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding:8px 16px}.mat-mdc-dialog-container[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{max-height:80vh;padding:0 16px 16px;border-top:16px solid #fff}[_nghost-%COMP%]     .tb-markdown-view{padding:16px 16px 32px}[_nghost-%COMP%]     .tb-markdown-view div{background-color:#f3f6fa}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn{right:-2px!important}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn p{color:#305680!important}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn div{background-color:unset!important}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn div img{display:none}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn div:after{content:"";position:initial;display:block;width:18px;height:18px;background:#305680;mask-image:url(/assets/copy-code-icon.svg);-webkit-mask-image:url(/assets/copy-code-icon.svg);mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat}[_nghost-%COMP%]     .tb-markdown-view div.code-wrapper button.clipboard-btn.multiline{right:-2px!important}[_nghost-%COMP%]     .tb-markdown-view>*:not(ul){padding-right:unset!important;padding-left:unset!important}[_nghost-%COMP%]     .tb-markdown-view pre[class*=language-]{border:1px solid #305680!important}[_nghost-%COMP%]     .mdc-button__label>span .mat-icon{vertical-align:text-bottom;box-sizing:initial}[_nghost-%COMP%]     .mat-mdc-tab-header{position:sticky;top:0;z-index:10;background-color:#fff}[_nghost-%COMP%]     .tabs-icon{margin-right:8px}[_nghost-%COMP%]     .tb-form-panel.tb-tab-body{padding:16px 0 0}[_nghost-%COMP%]     .mat-mdc-tab-body{padding:16px 0}']})}}return i})();var Fo=(()=>{class i{constructor(e,n,t,l,u,y,w,x,q,De){this.store=e,this.broadcast=n,this.edgeService=t,this.customerService=l,this.dialogService=u,this.homeDialogs=y,this.translate=w,this.datePipe=x,this.router=q,this.dialog=De,this.config=new Ge,this.config.entityType=k.EDGE,this.config.entityComponent=yp,this.config.entityTabsComponent=Cp,this.config.entityTranslations=Ue.get(k.EDGE),this.config.entityResources=tt.get(k.EDGE),this.config.deleteEntityTitle=Ve=>this.translate.instant("edge.delete-edge-title",{edgeName:Ve.name}),this.config.deleteEntityContent=()=>this.translate.instant("edge.delete-edge-text"),this.config.deleteEntitiesTitle=Ve=>this.translate.instant("edge.delete-edges-title",{count:Ve}),this.config.deleteEntitiesContent=()=>this.translate.instant("edge.delete-edges-text"),this.config.loadEntity=Ve=>this.edgeService.getEdgeInfo(Ve.id),this.config.saveEntity=Ve=>this.edgeService.saveEdge(Ve).pipe(xt(()=>{this.broadcast.broadcast("edgeSaved")}),_t(Ct=>this.edgeService.getEdgeInfo(Ct.id.id))),this.config.onEntityAction=Ve=>this.onEdgeAction(Ve,this.config),this.config.detailsReadonly=()=>this.config.componentsData.edgeScope==="customer_user",this.config.headerComponent=_p}resolve(e){let n=e.params;return this.config.componentsData={edgeScope:e.data.edgesType,edgeType:""},this.customerId=n.customerId,this.store.pipe(Wt(Tn),ti(1)).pipe(xt(t=>{t.authority===E.CUSTOMER_USER&&(this.config.componentsData.edgeScope="customer_user",this.customerId=t.customerId)}),_t(()=>this.customerId?this.customerService.getCustomer(this.customerId):ut(null)),ze(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-edges"):this.config.tableTitle=t.title+": "+this.translate.instant("edge.edge-instances"):this.config.tableTitle=this.translate.instant("edge.edge-instances"),this.config.columns=this.configureColumns(this.config.componentsData.edgeScope),this.configureEntityFunctions(this.config.componentsData.edgeScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.edgeScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.edgeScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.edgeScope),this.config.addEnabled=this.config.componentsData.edgeScope!=="customer_user",this.config.entitiesDeleteEnabled=this.config.componentsData.edgeScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.edgeScope==="tenant",this.config.addEntity=()=>(this.addEdge(),ut(null)),this.config)))}configureColumns(e){let n=[new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("name","edge.name","25%"),new Y("type","edge.edge-type","25%"),new Y("label","edge.label","25%")];return e==="tenant"&&n.push(new Y("customerTitle","customer.customer","25%"),new Y("customerIsPublic","edge.public","60px",t=>Ft(t.customerIsPublic),()=>({}),!1)),n}configureEntityFunctions(e){e==="tenant"&&(this.config.entitiesFetchFunction=n=>this.edgeService.getTenantEdgeInfos(n,this.config.componentsData.edgeType),this.config.deleteEntity=n=>this.edgeService.deleteEdge(n.id)),e==="customer"&&(this.config.entitiesFetchFunction=n=>this.edgeService.getCustomerEdgeInfos(this.customerId,n,this.config.componentsData.edgeType),this.config.deleteEntity=n=>this.edgeService.unassignEdgeFromCustomer(n.id)),e==="customer_user"&&(this.config.entitiesFetchFunction=n=>this.edgeService.getCustomerEdgeInfos(this.customerId,n,this.config.componentsData.edgeType),this.config.deleteEntity=n=>this.edgeService.unassignEdgeFromCustomer(n.id))}configureCellActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("edge.make-public"),icon:"share",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,l)=>this.makePublic(t,l)},{name:this.translate.instant("edge.assign-to-customer"),icon:"assignment_ind",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,l)=>this.assignToCustomer(t,[l.id])},{name:this.translate.instant("edge.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)},{name:this.translate.instant("edge.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)},{name:this.translate.instant("edge.manage-assets"),icon:"domain",isEnabled:t=>!0,onAction:(t,l)=>this.openEdgeEntitiesByType(t,l,k.ASSET)},{name:this.translate.instant("edge.manage-devices"),icon:"devices_other",isEnabled:t=>!0,onAction:(t,l)=>this.openEdgeEntitiesByType(t,l,k.DEVICE)},{name:this.translate.instant("edge.manage-entity-views"),icon:"view_quilt",isEnabled:t=>!0,onAction:(t,l)=>this.openEdgeEntitiesByType(t,l,k.ENTITY_VIEW)},{name:this.translate.instant("edge.manage-dashboards"),icon:"dashboard",isEnabled:t=>!0,onAction:(t,l)=>this.openEdgeEntitiesByType(t,l,k.DASHBOARD)},{name:this.translate.instant("edge.manage-rulechains"),icon:"settings_ethernet",isEnabled:t=>!0,onAction:(t,l)=>this.openEdgeEntitiesByType(t,l,k.RULE_CHAIN)}),e==="customer"&&n.push({name:this.translate.instant("edge.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)},{name:this.translate.instant("edge.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)}),e==="customer_user"&&n.push({name:this.translate.instant("edge.manage-assets"),icon:"domain",isEnabled:t=>!0,onAction:(t,l)=>this.openEdgeEntitiesByType(t,l,k.ASSET)},{name:this.translate.instant("edge.manage-devices"),icon:"devices_other",isEnabled:t=>!0,onAction:(t,l)=>this.openEdgeEntitiesByType(t,l,k.DEVICE)},{name:this.translate.instant("edge.manage-entity-views"),icon:"view_quilt",isEnabled:t=>!0,onAction:(t,l)=>this.openEdgeEntitiesByType(t,l,k.ENTITY_VIEW)},{name:this.translate.instant("edge.manage-dashboards"),icon:"dashboard",isEnabled:t=>!0,onAction:(t,l)=>this.openEdgeEntitiesByType(t,l,k.DASHBOARD)}),n}configureGroupActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("edge.assign-edge-to-customer-text"),icon:"assignment_ind",isEnabled:!0,onAction:(t,l)=>this.assignToCustomer(t,l.map(u=>u.id))}),e==="customer"&&n.push({name:this.translate.instant("edge.unassign-from-customer"),icon:"assignment_return",isEnabled:!0,onAction:(t,l)=>this.unassignEdgesFromCustomer(t,l)}),n}configureAddActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("edge.add-edge-text"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.config.getTable().addEntity(t)},{name:this.translate.instant("edge.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importEdges(t)}),e==="customer"&&n.push({name:this.translate.instant("edge.assign-new-edge"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addEdgesToCustomer(t)}),n}importEdges(e){this.homeDialogs.importEntities(k.EDGE).subscribe(n=>{n&&(this.broadcast.broadcast("edgeSaved"),this.config.updateData())})}addEdgesToCustomer(e){e&&e.stopPropagation(),this.dialog.open(so,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:k.EDGE}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}openEdge(e,n,t){e&&e.stopPropagation();let l=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(l)}makePublic(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("edge.make-public-edge-title",{edgeName:n.name}),this.translate.instant("edge.make-public-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.edgeService.makeEdgePublic(n.id.id).subscribe(()=>{this.config.updateData()})})}openEdgeEntitiesByType(e,n,t){e&&e.stopPropagation();let l;switch(t){case k.DEVICE:l="devices";break;case k.ASSET:l="assets";break;case k.EDGE:l="assets";break;case k.ENTITY_VIEW:l="entityViews";break;case k.DASHBOARD:l="dashboards";break;case k.RULE_CHAIN:l="ruleChains";break}this.router.navigateByUrl(`edgeManagement/instances/${n.id.id}/${l}`)}assignToCustomer(e,n){e&&e.stopPropagation(),this.dialog.open(ro,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:n,entityType:k.EDGE}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}unassignFromCustomer(e,n){e&&e.stopPropagation();let t=n.customerIsPublic,l,u;t?(l=this.translate.instant("edge.make-private-edge-title",{edgeName:n.name}),u=this.translate.instant("edge.make-private-edge-text")):(l=this.translate.instant("edge.unassign-edge-title",{edgeName:n.name}),u=this.translate.instant("edge.unassign-edge-text")),this.dialogService.confirm(l,u,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(y=>{y&&this.edgeService.unassignEdgeFromCustomer(n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.edgeScope!=="tenant")})})}unassignEdgesFromCustomer(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("edge.unassign-edges-title",{count:n.length}),this.translate.instant("edge.unassign-edges-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let l=[];n.forEach(u=>{l.push(this.edgeService.unassignEdgeFromCustomer(u.id.id))}),Nt(l).subscribe(()=>{this.config.updateData()})}})}syncEdge(e,n){e&&e.stopPropagation(),this.edgeService.syncEdge(n.id.id).subscribe(()=>{this.store.dispatch(new Be({message:this.translate.instant("edge.sync-process-started-successfully"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))})}addEdge(){this.dialog.open(of,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entitiesTableConfig:this.config}}).afterClosed().subscribe(e=>{e&&this.store.pipe(Wt(Yo("notDisplayInstructionsAfterAddEdge"))).pipe(ti(1)).subscribe(n=>{n?(this.config.updateData(),this.config.entityAdded(e)):this.openInstructions(null,e,!0)})})}openInstructions(e,n,t=!1,l=!1){e&&e.stopPropagation(),this.dialog.open(Sp,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edge:n,afterAdd:t,upgradeAvailable:l}}).afterClosed().subscribe(()=>{t&&this.config.updateData()})}onEdgeAction(e,n){switch(e.action){case"open":return this.openEdge(e.event,e.entity,n),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"assignToCustomer":return this.assignToCustomer(e.event,[e.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity),!0;case"openEdgeAssets":return this.openEdgeEntitiesByType(e.event,e.entity,k.ASSET),!0;case"openEdgeDevices":return this.openEdgeEntitiesByType(e.event,e.entity,k.DEVICE),!0;case"openEdgeEntityViews":return this.openEdgeEntitiesByType(e.event,e.entity,k.ENTITY_VIEW),!0;case"openEdgeDashboards":return this.openEdgeEntitiesByType(e.event,e.entity,k.DASHBOARD),!0;case"openEdgeRuleChains":return this.openEdgeEntitiesByType(e.event,e.entity,k.RULE_CHAIN),!0;case"syncEdge":return this.syncEdge(e.event,e.entity),!0;case"openInstallInstructions":return this.openInstructions(e.event,e.entity),!0;case"openUpgradeInstructions":return this.openInstructions(e.event,e.entity,!1,!0),!0}}static{this.\u0275fac=function(n){return new(n||i)(D(F),D(xn),D(Hi),D(Wi),D(jt),D(On),D(Z),D(ke),D(pe),D(je))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var fE=[{path:"customers",data:{breadcrumb:{menuId:be.customers}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN],title:"customer.customers"},resolve:{entitiesTableConfig:Zl}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"supervisor_account"},auth:[E.TENANT_ADMIN],title:"customer.customers"},resolve:{entitiesTableConfig:Zl}},{path:":customerId/users",data:{breadcrumb:{label:"user.customer-users",icon:"account_circle"}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN],title:"user.customer-users"},resolve:{entitiesTableConfig:Wn}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"account_circle"},auth:[E.TENANT_ADMIN],title:"user.customer-users"},resolve:{entitiesTableConfig:Wn}}]},{path:":customerId/devices",data:{breadcrumb:{label:"customer.devices",icon:"devices_other"}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN],title:"customer.devices",devicesType:"customer"},resolve:{entitiesTableConfig:Rn}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"devices_other"},auth:[E.TENANT_ADMIN],title:"customer.devices",devicesType:"customer"},resolve:{entitiesTableConfig:Rn}}]},{path:":customerId/assets",data:{breadcrumb:{label:"customer.assets",icon:"domain"}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN],title:"customer.assets",assetsType:"customer"},resolve:{entitiesTableConfig:Bn}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"domain"},auth:[E.TENANT_ADMIN],title:"customer.assets",assetsType:"customer"},resolve:{entitiesTableConfig:Bn}}]},{path:":customerId/edgeInstances",data:{breadcrumb:{label:"customer.edges",icon:"router"}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN],title:"customer.edges",edgesType:"customer"},resolve:{entitiesTableConfig:Fo}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"router"},auth:[E.TENANT_ADMIN],title:"customer.edges",edgesType:"customer"},resolve:{entitiesTableConfig:Fo}}]},{path:":customerId/dashboards",data:{breadcrumb:{label:"customer.dashboards",icon:"dashboard"}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN],title:"customer.dashboards",dashboardsType:"customer"},resolve:{entitiesTableConfig:Fs}},{path:":dashboardId",component:Ma,canDeactivate:[xe],data:{breadcrumb:{labelFunction:Ns,icon:"dashboard"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"customer.dashboard",widgetEditMode:!1},resolve:{dashboard:As}}]}]}],Tp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[Zl],imports:[B.forChild(fE),B]})}}return i})();(function(){Q(Tp,{imports:[B],exports:[B]})})();var xp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,Tp]})}}return i})();(function(){Q(xp,{declarations:[Kl,Xl],imports:[ne,oe,ve,Tp]})})();C();var Ep=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,rl]})}}return i})();(function(){Q(Ep,{imports:[ne,oe,rl]})})();C();C();var gE=[{path:"users",data:{breadcrumb:{skip:!0}},children:[{path:"",redirectTo:"/",pathMatch:"full"},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"account_circle"},auth:[E.SYS_ADMIN,E.TENANT_ADMIN],title:"user.user"},resolve:{entitiesTableConfig:Wn}}]}],Ip=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[Wn],imports:[B.forChild(gE),B]})}}return i})();(function(){Q(Ip,{imports:[B],exports:[B]})})();var Mp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,Ip]})}}return i})();(function(){Q(Mp,{declarations:[go,Jl,$l,ja],imports:[ne,oe,ve,Ip]})})();C();C();var Ag=[{path:"devices",data:{breadcrumb:{menuId:be.devices}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"device.devices",devicesType:"tenant"},resolve:{entitiesTableConfig:Rn}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"devices_other"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"device.devices",devicesType:"tenant"},resolve:{entitiesTableConfig:Rn}}]}],hE=[{path:"devices",pathMatch:"full",redirectTo:"/entities/devices"},{path:"devices/:entityId",redirectTo:"/entities/devices/:entityId"}],wp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[Rn],imports:[B.forChild(hE),B]})}}return i})();(function(){Q(wp,{imports:[B],exports:[B]})})();var Dp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,_i,Md,Id,wp]})}}return i})();(function(){Q(Dp,{declarations:[ep,tp,ip,np,op,ap,rp,sp,lp,pp,cp,mp,dp,gp],imports:[ne,oe,ve,_i,Md,Id,wp]})})();C();C();var Ng=[{path:"assets",data:{breadcrumb:{menuId:be.assets}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"asset.assets",assetsType:"tenant"},resolve:{entitiesTableConfig:Bn}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"domain"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"asset.assets",assetsType:"tenant"},resolve:{entitiesTableConfig:Bn}}]}],bE=[{path:"assets",pathMatch:"full",redirectTo:"/entities/assets"},{path:"assets/:entityId",redirectTo:"/entities/assets/:entityId"}],Pp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[Bn],imports:[B.forChild(bE),B]})}}return i})();(function(){Q(Pp,{imports:[B],exports:[B]})})();var Fp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,_i,Pp]})}}return i})();(function(){Q(Fp,{declarations:[hp,vp,bp],imports:[ne,oe,ve,_i,Pp]})})();C();C();function vE(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"entity-view.name-required")," "))}function yE(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"entity-view.name-max-length")," "))}var Ap=(()=>{class i extends Bt{constructor(e,n,t,l,u,y){super(e,u,t,l,y),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.fb=u,this.cd=y,this.entityType=k,this.dataKeyType=Jc,this.allowedEntityTypes=[k.DEVICE,k.ASSET]}ngOnInit(){this.entityViewScope=this.entitiesTableConfig.componentsData.entityViewScope,super.ngOnInit(),this.maxStartTimeMs=this.entityForm.get("endTimeMs").valueChanges,this.minEndTimeMs=this.entityForm.get("startTimeMs").valueChanges,this.selectedEntityId=this.entityForm.get("entityId").valueChanges}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}isAssignedToCustomer(e){return e&&e.customerId&&e.customerId.id!==Ae}buildForm(e){return this.fb.group({name:[e?e.name:"",[S.required,S.maxLength(255)]],type:[e?e.type:null,S.required],entityId:[e?e.entityId:null,[S.required]],startTimeMs:[e?e.startTimeMs:null],endTimeMs:[e?e.endTimeMs:null],keys:this.fb.group({attributes:this.fb.group({cs:[e&&e.keys&&e.keys.attributes?e.keys.attributes.cs:null],sh:[e&&e.keys&&e.keys.attributes?e.keys.attributes.sh:null],ss:[e&&e.keys&&e.keys.attributes?e.keys.attributes.ss:null]}),timeseries:[e&&e.keys&&e.keys.timeseries?e.keys.timeseries:null]}),additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})})}updateForm(e){this.entityForm.patchValue({name:e.name}),this.entityForm.patchValue({type:e.type}),this.entityForm.patchValue({entityId:e.entityId}),this.entityForm.patchValue({startTimeMs:e.startTimeMs}),this.entityForm.patchValue({endTimeMs:e.endTimeMs}),this.entityForm.patchValue({keys:{attributes:{cs:e.keys&&e.keys.attributes?e.keys.attributes.cs:null,sh:e.keys&&e.keys.attributes?e.keys.attributes.sh:null,ss:e.keys&&e.keys.attributes?e.keys.attributes.ss:null},timeseries:e.keys&&e.keys.timeseries?e.keys.timeseries:null}}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}})}onEntityViewIdCopied(e){this.store.dispatch(new Be({message:this.translate.instant("entity-view.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g("entity"),g("entitiesTableConfig"),g(de),g(Qe))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-entity-view"]],features:[L],decls:95,vars:100,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[1,"mat-block"],["matInput","","disabled","",3,"ngModel"],[1,"tb-small",2,"padding-bottom","10px","padding-left","2px"],[3,"formGroup"],[3,"disabled"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","type",3,"required","entityType"],[1,"flex","flex-col"],["translate","",1,"tb-title","no-padding"],["formControlName","entityId",1,"flex-1",3,"required","allowedEntityTypes"],["formGroupName","keys",1,"mat-accordion-container"],[3,"multi"],["formGroupName","attributes",3,"expanded"],["translate","",1,"tb-panel-title"],["translate","",1,"tb-hint"],["formControlName","cs","keysText","entity-view.client-attributes-placeholder",3,"entityId","dataKeyType"],["formControlName","sh","keysText","entity-view.shared-attributes-placeholder",3,"entityId","dataKeyType"],["formControlName","ss","keysText","entity-view.server-attributes-placeholder",3,"entityId","dataKeyType"],[3,"expanded"],["formControlName","timeseries","keysText","entity-view.timeseries-placeholder",3,"entityId","dataKeyType"],["formControlName","startTimeMs",1,"block",3,"dateText","maxDate"],["formControlName","endTimeMs",1,"block",3,"dateText","minDate"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"button",1),d(2,"async"),_("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),a(),r(5,"button",1),d(6,"async"),_("click",function(u){return t.onEntityAction(u,"makePublic")}),p(7),d(8,"translate"),a(),r(9,"button",1),d(10,"async"),_("click",function(u){return t.onEntityAction(u,"assignToCustomer")}),p(11),d(12,"translate"),a(),r(13,"button",1),d(14,"async"),_("click",function(u){return t.onEntityAction(u,"unassignFromCustomer")}),p(15),d(16,"translate"),a(),r(17,"button",1),d(18,"async"),_("click",function(u){return t.onEntityAction(u,"unassignFromEdge")}),p(19),d(20,"translate"),a(),r(21,"button",1),d(22,"async"),_("click",function(u){return t.onEntityAction(u,"delete")}),p(23),d(24,"translate"),a(),r(25,"div",2)(26,"button",3),_("cbOnSuccess",function(u){return t.onEntityViewIdCopied(u)}),f(27,"mat-icon",4),r(28,"span",5),p(29,"entity-view.copyId"),a()()()(),r(30,"div",6)(31,"mat-form-field",7)(32,"mat-label",5),p(33,"entity-view.assignedToCustomer"),a(),f(34,"input",8),a(),r(35,"div",9),p(36),d(37,"translate"),a(),r(38,"form",10)(39,"fieldset",11),d(40,"async"),r(41,"mat-form-field",7)(42,"mat-label",5),p(43,"entity-view.name"),a(),f(44,"input",12),b(45,vE,3,3,"mat-error",13)(46,yE,3,3,"mat-error",13),a(),f(47,"tb-entity-subtype-autocomplete",14),r(48,"section",15)(49,"label",16),p(50,"entity-view.target-entity"),a(),f(51,"tb-entity-select",17),a(),r(52,"div",18)(53,"mat-accordion",19)(54,"mat-expansion-panel",20)(55,"mat-expansion-panel-header")(56,"mat-panel-title")(57,"div",21),p(58,"entity-view.attributes-propagation"),a()()(),r(59,"div",22),p(60,"entity-view.attributes-propagation-hint"),a(),r(61,"label",16),p(62,"entity-view.client-attributes"),a(),f(63,"tb-entity-keys-list",23),d(64,"async"),r(65,"label",16),p(66,"entity-view.shared-attributes"),a(),f(67,"tb-entity-keys-list",24),d(68,"async"),r(69,"label",16),p(70,"entity-view.server-attributes"),a(),f(71,"tb-entity-keys-list",25),d(72,"async"),a(),r(73,"mat-expansion-panel",26)(74,"mat-expansion-panel-header")(75,"mat-panel-title")(76,"div",21),p(77,"entity-view.timeseries-data"),a()()(),r(78,"div",22),p(79,"entity-view.timeseries-data-hint"),a(),r(80,"label",16),p(81,"entity-view.timeseries"),a(),f(82,"tb-entity-keys-list",27),d(83,"async"),a()()(),f(84,"tb-datetime",28),d(85,"translate"),d(86,"async"),f(87,"tb-datetime",29),d(88,"translate"),d(89,"async"),r(90,"div",30)(91,"mat-form-field",7)(92,"mat-label",5),p(93,"entity-view.description"),a(),f(94,"textarea",31),a()()()()()),n&2&&(o(),V("!hidden",t.isEdit||t.isDetailsPage),s("disabled",c(2,56,t.isLoading$)),o(2),h(" ",c(4,58,"common.open-details-page")," "),o(2),V("!hidden",t.isEdit||t.entityViewScope!=="tenant"||t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)),s("disabled",c(6,60,t.isLoading$)),o(2),h(" ",c(8,62,"entity-view.make-public")," "),o(2),V("!hidden",t.isEdit||t.entityViewScope!=="tenant"||t.isAssignedToCustomer(t.entity)),s("disabled",c(10,64,t.isLoading$)),o(2),h(" ",c(12,66,"entity-view.assign-to-customer")," "),o(2),V("!hidden",t.isEdit||t.entityViewScope!=="customer"&&t.entityViewScope!=="tenant"||!t.isAssignedToCustomer(t.entity)),s("disabled",c(14,68,t.isLoading$)),o(2),h(" ",c(16,70,t.entity!=null&&t.entity.customerIsPublic?"entity-view.make-private":"entity-view.unassign-from-customer")," "),o(2),V("!hidden",t.isEdit||t.entityViewScope!=="edge"),s("disabled",c(18,72,t.isLoading$)),o(2),h(" ",c(20,74,"edge.unassign-from-edge")," "),o(2),V("!hidden",t.hideDelete()||t.isEdit),s("disabled",c(22,76,t.isLoading$)),o(2),h(" ",c(24,78,"entity-view.delete")," "),o(3),V("!hidden",t.isEdit),s("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),V("!hidden",t.isEdit||!t.isAssignedToCustomer(t.entity)||(t.entity==null?null:t.entity.customerIsPublic)||t.entityViewScope!=="tenant"),o(3),s("ngModel",t.entity==null?null:t.entity.customerTitle),o(),V("!hidden",t.isEdit||!(t.entity!=null&&t.entity.customerIsPublic)||t.entityViewScope!=="customer"&&t.entityViewScope!=="tenant"),o(),h(" ",c(37,80,"entity-view.entity-view-public")," "),o(2),s("formGroup",t.entityForm),o(),s("disabled",c(40,82,t.isLoading$)||!t.isEdit),o(6),s("ngIf",t.entityForm.get("name").hasError("required")),o(),s("ngIf",t.entityForm.get("name").hasError("maxlength")),o(),s("required",!0)("entityType",t.entityType.ENTITY_VIEW),o(4),s("required",!0)("allowedEntityTypes",t.allowedEntityTypes),o(2),s("multi",!0),o(),s("expanded",!0),o(9),s("entityId",c(64,84,t.selectedEntityId))("dataKeyType",t.dataKeyType.attribute),o(4),s("entityId",c(68,86,t.selectedEntityId))("dataKeyType",t.dataKeyType.attribute),o(4),s("entityId",c(72,88,t.selectedEntityId))("dataKeyType",t.dataKeyType.attribute),o(2),s("expanded",!0),o(9),s("entityId",c(83,90,t.selectedEntityId))("dataKeyType",t.dataKeyType.timeseries),o(2),T("dateText",c(85,92,"entity-view.start-ts")),s("maxDate",c(86,94,t.maxStartTimeMs)),o(3),T("dateText",c(88,96,"entity-view.end-ts")),s("minDate",c(89,98,t.minEndTimeMs)))},dependencies:[G,s0,rs,r0,l0,ee,ae,he,me,Ce,Pe,Ur,Gi,rn,sn,Jt,ce,ge,W,K,ue,Ye,ie,se,bt,J,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-accordion-container[_ngcontent-%COMP%]{margin-bottom:16px}']})}}return i})();C();var Np=(()=>{class i extends oi{constructor(e){super(e),this.store=e,this.entityType=k}entityViewTypeChanged(e){this.entitiesTableConfig.componentsData.entityViewType=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-entity-view-table-header"]],features:[L],decls:1,vars:3,consts:[["subscriptSizing","dynamic",3,"ngModelChange","showLabel","entityType","ngModel"]],template:function(n,t){n&1&&(r(0,"tb-entity-subtype-select",0),_("ngModelChange",function(u){return t.entityViewTypeChanged(u)}),a()),n&2&&s("showLabel",!0)("entityType",t.entityType.ENTITY_VIEW)("ngModel",t.entitiesTableConfig.componentsData.entityViewType)},dependencies:[ss,W,Ye],encapsulation:2})}}return i})();C();C();C();function _E(i,m){if(i&1&&(r(0,"mat-tab",8,0),d(2,"translate"),f(3,"tb-attribute-table",9),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),s("defaultAttributeScope",n.attributeScopes.CLIENT_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function CE(i,m){if(i&1&&(r(0,"mat-tab",8,1),d(2,"translate"),f(3,"tb-attribute-table",10),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),s("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function SE(i,m){if(i&1&&(r(0,"mat-tab",8,2),d(2,"translate"),f(3,"tb-alarm-table",11),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function TE(i,m){if(i&1&&(r(0,"mat-tab",8,3),d(2,"translate"),f(3,"tb-event-table",12),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"entity-view.events")),o(3),s("defaultEventType",n.eventTypes.ERROR)("active",e.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function xE(i,m){if(i&1&&(r(0,"mat-tab",8,4),d(2,"translate"),f(3,"tb-relation-table",11),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function EE(i,m){if(i&1&&(r(0,"mat-tab",8,5),d(2,"translate"),f(3,"tb-audit-log-table",13),a()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),s("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function IE(i,m){if(i&1){let e=j();r(0,"mat-tab",8,6),d(2,"translate"),r(3,"tb-version-control",14),_("versionRestored",function(){I(e);let t=v();return M(t.entitiesTableConfig.updateData())}),a()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),s("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var kp=(()=>{class i extends Lt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-entity-view-tabs"]],features:[L],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,_E,4,7,"mat-tab",7)(1,CE,4,7,"mat-tab",7)(2,SE,4,5,"mat-tab",7)(3,TE,4,7,"mat-tab",7)(4,xE,4,5,"mat-tab",7)(5,EE,4,6,"mat-tab",7)(6,IE,4,7,"mat-tab",7),n&2&&(s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[G,St,ri,$i,Ai,vi,yi,ai,R],encapsulation:2})}}return i})();var Ao=(()=>{class i{constructor(e,n,t,l,u,y,w,x,q,De){this.store=e,this.broadcast=n,this.entityViewService=t,this.customerService=l,this.edgeService=u,this.dialogService=y,this.translate=w,this.datePipe=x,this.router=q,this.dialog=De,this.config=new Ge,this.config.entityType=k.ENTITY_VIEW,this.config.entityComponent=Ap,this.config.entityTabsComponent=kp,this.config.entityTranslations=Ue.get(k.ENTITY_VIEW),this.config.entityResources=tt.get(k.ENTITY_VIEW),this.config.addDialogStyle={maxWidth:"800px"},this.config.deleteEntityTitle=Ve=>this.translate.instant("entity-view.delete-entity-view-title",{entityViewName:Ve.name}),this.config.deleteEntityContent=()=>this.translate.instant("entity-view.delete-entity-view-text"),this.config.deleteEntitiesTitle=Ve=>this.translate.instant("entity-view.delete-entity-views-title",{count:Ve}),this.config.deleteEntitiesContent=()=>this.translate.instant("entity-view.delete-entity-views-text"),this.config.loadEntity=Ve=>this.entityViewService.getEntityViewInfo(Ve.id),this.config.saveEntity=Ve=>this.entityViewService.saveEntityView(Ve).pipe(xt(()=>{this.broadcast.broadcast("entityViewSaved")}),_t(Ct=>this.entityViewService.getEntityViewInfo(Ct.id.id))),this.config.onEntityAction=Ve=>this.onEntityViewAction(Ve,this.config),this.config.detailsReadonly=()=>this.config.componentsData.entityViewScope==="customer_user"||this.config.componentsData.entityViewScope==="edge_customer_user",this.config.headerComponent=Np}resolve(e){let n=e.params;return this.config.componentsData={entityViewScope:e.data.entityViewsType,entityViewType:"",edgeId:n.edgeId},this.customerId=n.customerId,this.store.pipe(Wt(Tn),ti(1)).pipe(xt(t=>{t.authority===E.CUSTOMER_USER&&(e.data.entityViewsType==="edge"?this.config.componentsData.entityViewScope="edge_customer_user":this.config.componentsData.entityViewScope="customer_user",this.customerId=t.customerId)}),_t(()=>this.customerId?this.customerService.getCustomer(this.customerId):ut(null)),ze(t=>(t?t.additionalInfo&&t.additionalInfo.isPublic?this.config.tableTitle=this.translate.instant("customer.public-entity-views"):this.config.tableTitle=t.title+": "+this.translate.instant("entity-view.entity-views"):this.config.componentsData.entityViewScope==="edge"?this.edgeService.getEdge(this.config.componentsData.edgeId).subscribe(l=>this.config.tableTitle=l.name+": "+this.translate.instant("entity-view.entity-views")):this.config.tableTitle=this.translate.instant("entity-view.entity-views"),this.config.columns=this.configureColumns(this.config.componentsData.entityViewScope),this.configureEntityFunctions(this.config.componentsData.entityViewScope),this.config.cellActionDescriptors=this.configureCellActions(this.config.componentsData.entityViewScope),this.config.groupActionDescriptors=this.configureGroupActions(this.config.componentsData.entityViewScope),this.config.addActionDescriptors=this.configureAddActions(this.config.componentsData.entityViewScope),this.config.addEnabled=!(this.config.componentsData.entityViewScope==="customer_user"||this.config.componentsData.entityViewScope==="edge_customer_user"),this.config.entitiesDeleteEnabled=this.config.componentsData.entityViewScope==="tenant",this.config.deleteEnabled=()=>this.config.componentsData.entityViewScope==="tenant",this.config)))}configureColumns(e){let n=[new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("name","entity-view.name","33%"),new Y("type","entity-view.entity-view-type","33%")];return e==="tenant"&&n.push(new Y("customerTitle","customer.customer","33%"),new Y("customerIsPublic","entity-view.public","60px",t=>Ft(t.customerIsPublic),()=>({}),!1)),n}configureEntityFunctions(e){e==="tenant"?(this.config.entitiesFetchFunction=n=>this.entityViewService.getTenantEntityViewInfos(n,this.config.componentsData.entityViewType),this.config.deleteEntity=n=>this.entityViewService.deleteEntityView(n.id)):e==="edge"||e==="edge_customer_user"?this.config.entitiesFetchFunction=n=>this.entityViewService.getEdgeEntityViews(this.config.componentsData.edgeId,n,this.config.componentsData.entityViewType):(this.config.entitiesFetchFunction=n=>this.entityViewService.getCustomerEntityViewInfos(this.customerId,n,this.config.componentsData.entityViewType),this.config.deleteEntity=n=>this.entityViewService.unassignEntityViewFromCustomer(n.id))}configureCellActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("entity-view.make-public"),icon:"share",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,l)=>this.makePublic(t,l)},{name:this.translate.instant("entity-view.assign-to-customer"),icon:"assignment_ind",isEnabled:t=>!t.customerId||t.customerId.id===Ae,onAction:(t,l)=>this.assignToCustomer(t,[l.id])},{name:this.translate.instant("entity-view.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)},{name:this.translate.instant("entity-view.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)}),e==="customer"&&n.push({name:this.translate.instant("entity-view.unassign-from-customer"),icon:"assignment_return",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&!t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)},{name:this.translate.instant("entity-view.make-private"),icon:"reply",isEnabled:t=>t.customerId&&t.customerId.id!==Ae&&t.customerIsPublic,onAction:(t,l)=>this.unassignFromCustomer(t,l)}),e==="edge"&&n.push({name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:()=>!0,onAction:(t,l)=>this.unassignFromEdge(t,l)}),n}configureGroupActions(e){let n=[];return e==="tenant"&&n.push({name:this.translate.instant("entity-view.assign-entity-views"),icon:"assignment_ind",isEnabled:!0,onAction:(t,l)=>this.assignToCustomer(t,l.map(u=>u.id))}),e==="customer"&&n.push({name:this.translate.instant("entity-view.unassign-entity-views"),icon:"assignment_return",isEnabled:!0,onAction:(t,l)=>this.unassignEntityViewsFromCustomer(t,l)}),e==="edge"&&n.push({name:this.translate.instant("entity-view.unassign-entity-views-from-edge"),icon:"assignment_return",isEnabled:!0,onAction:(t,l)=>this.unassignEntityViewsFromEdge(t,l)}),n}configureAddActions(e){let n=[];return e==="customer"&&n.push({name:this.translate.instant("entity-view.assign-new-entity-view"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addEntityViewsToCustomer(t)}),e==="edge"&&n.push({name:this.translate.instant("entity-view.assign-new-entity-view"),icon:"add",isEnabled:()=>!0,onAction:t=>this.addEntityViewsToEdge(t)}),n}addEntityViewsToCustomer(e){e&&e.stopPropagation(),this.dialog.open(so,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{customerId:this.customerId,entityType:k.ENTITY_VIEW}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}openEntityView(e,n,t){e&&e.stopPropagation();let l=this.router.createUrlTree([n.id.id],{relativeTo:t.getActivatedRoute()});this.router.navigateByUrl(l)}makePublic(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.make-public-entity-view-title",{entityViewName:n.name}),this.translate.instant("entity-view.make-public-entity-view-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.entityViewService.makeEntityViewPublic(n.id.id).subscribe(()=>{this.config.updateData()})})}assignToCustomer(e,n){e&&e.stopPropagation(),this.dialog.open(ro,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{entityIds:n,entityType:k.ENTITY_VIEW}}).afterClosed().subscribe(t=>{t&&this.config.updateData()})}unassignFromCustomer(e,n){e&&e.stopPropagation();let t=n.customerIsPublic,l,u;t?(l=this.translate.instant("entity-view.make-private-entity-view-title",{entityViewName:n.name}),u=this.translate.instant("entity-view.make-private-entity-view-text")):(l=this.translate.instant("entity-view.unassign-entity-view-title",{entityViewName:n.name}),u=this.translate.instant("entity-view.unassign-entity-view-text")),this.dialogService.confirm(l,u,this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(y=>{y&&this.entityViewService.unassignEntityViewFromCustomer(n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.entityViewScope!=="tenant")})})}unassignEntityViewsFromCustomer(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.unassign-entity-views-title",{count:n.length}),this.translate.instant("entity-view.unassign-entity-views-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let l=[];n.forEach(u=>{l.push(this.entityViewService.unassignEntityViewFromCustomer(u.id.id))}),Nt(l).subscribe(()=>{this.config.updateData()})}})}onEntityViewAction(e,n){switch(e.action){case"open":return this.openEntityView(e.event,e.entity,n),!0;case"makePublic":return this.makePublic(e.event,e.entity),!0;case"assignToCustomer":return this.assignToCustomer(e.event,[e.entity.id]),!0;case"unassignFromCustomer":return this.unassignFromCustomer(e.event,e.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0}return!1}addEntityViewsToEdge(e){e&&e.stopPropagation(),this.dialog.open(lo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:k.ENTITY_VIEW}}).afterClosed().subscribe(n=>{n&&this.config.updateData()})}unassignFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.unassign-entity-view-from-edge-title",{entityViewName:n.name}),this.translate.instant("entity-view.unassign-entity-view-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.entityViewService.unassignEntityViewFromEdge(this.config.componentsData.edgeId,n.id.id).subscribe(()=>{this.config.updateData(this.config.componentsData.entityViewScope!=="tenant")})})}unassignEntityViewsFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("entity-view.unassign-entity-views-from-edge-title",{count:n.length}),this.translate.instant("entity-view.unassign-entity-views-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let l=[];n.forEach(u=>{l.push(this.entityViewService.unassignEntityViewFromEdge(this.config.componentsData.edgeId,u.id.id))}),Nt(l).subscribe(()=>{this.config.updateData()})}})}static{this.\u0275fac=function(n){return new(n||i)(D(F),D(xn),D(Lu),D(Wi),D(Hi),D(jt),D(Z),D(ke),D(pe),D(je))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var kg=[{path:"entityViews",data:{breadcrumb:{menuId:be.entity_views}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"entity-view.entity-views",entityViewsType:"tenant"},resolve:{entitiesTableConfig:Ao}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"view_quilt"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"entity-view.entity-views",entityViewsType:"tenant"},resolve:{entitiesTableConfig:Ao}}]}],ME=[{path:"entityViews",pathMatch:"full",redirectTo:"/entities/entityViews"},{path:"entityViews/:entityId",redirectTo:"/entities/entityViews/:entityId"}],Op=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[Ao],imports:[B.forChild(ME),B]})}}return i})();(function(){Q(Op,{imports:[B],exports:[B]})})();var Rp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,_i,Op]})}}return i})();(function(){Q(Rp,{declarations:[Ap,kp,Np],imports:[ne,oe,ve,_i,Op]})})();C();C();function wE(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"rulechain.name-required")," "))}function DE(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"rulechain.name-max-length")," "))}var Bp=(()=>{class i extends Bt{constructor(e,n,t,l,u,y){super(e,u,t,l,y),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.fb=u,this.cd=y}ngOnInit(){this.ruleChainScope=this.entitiesTableConfig.componentsData.ruleChainScope,super.ngOnInit()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){return this.fb.group({name:[e?e.name:"",[S.required,S.maxLength(255)]],debugMode:[e?e.debugMode:!1],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})})}updateForm(e){this.entityForm.patchValue({name:e.name}),this.entityForm.patchValue({debugMode:e.debugMode}),this.entityForm.patchValue({additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}})}onRuleChainIdCopied(e){this.store.dispatch(new Be({message:this.translate.instant("rulechain.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}isEdgeRootRuleChain(){return this.entitiesTableConfig&&this.entityValue?this.entitiesTableConfig.componentsData.edge?.rootRuleChainId?.id==this.entityValue.id.id:!1}isAutoAssignToEdgeRuleChain(){return this.entitiesTableConfig&&this.entityValue?!this.entityValue.root&&this.entitiesTableConfig.componentsData?.autoAssignToEdgeRuleChainIds?.includes(this.entityValue.id.id):!1}isNotAutoAssignToEdgeRuleChain(){return this.entitiesTableConfig&&this.entityValue?!this.entityValue.root&&!this.entitiesTableConfig.componentsData?.autoAssignToEdgeRuleChainIds?.includes(this.entityValue.id.id):!1}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g("entity"),g("entitiesTableConfig"),g(de),g(Qe))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-rulechain"]],features:[L],decls:56,vars:76,consts:[[1,"tb-details-buttons"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col"],[3,"formGroup"],[3,"disabled"],[1,"mat-block"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","debugMode",1,"flex-1",2,"padding-bottom","16px"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"button",1),d(2,"async"),_("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),a(),r(5,"button",1),d(6,"async"),_("click",function(u){return t.onEntityAction(u,"export")}),p(7),d(8,"translate"),a(),r(9,"button",1),d(10,"async"),_("click",function(u){return t.onEntityAction(u,"setRoot")}),p(11),d(12,"translate"),a(),r(13,"button",1),d(14,"async"),_("click",function(u){return t.onEntityAction(u,"setEdgeTemplateRoot")}),p(15),d(16,"translate"),a(),r(17,"button",1),d(18,"async"),_("click",function(u){return t.onEntityAction(u,"setAutoAssignToEdge")}),p(19),d(20,"translate"),a(),r(21,"button",1),d(22,"async"),_("click",function(u){return t.onEntityAction(u,"unsetAutoAssignToEdge")}),p(23),d(24,"translate"),a(),r(25,"button",1),d(26,"async"),_("click",function(u){return t.onEntityAction(u,"unassignFromEdge")}),p(27),d(28,"translate"),a(),r(29,"button",1),d(30,"async"),_("click",function(u){return t.onEntityAction(u,"delete")}),p(31),d(32,"translate"),a(),r(33,"div",2)(34,"button",3),_("cbOnSuccess",function(u){return t.onRuleChainIdCopied(u)}),f(35,"mat-icon",4),r(36,"span",5),p(37,"rulechain.copyId"),a()()()(),r(38,"div",6)(39,"form",7)(40,"fieldset",8),d(41,"async"),r(42,"mat-form-field",9)(43,"mat-label",5),p(44,"rulechain.name"),a(),f(45,"input",10),b(46,wE,3,3,"mat-error",11)(47,DE,3,3,"mat-error",11),a(),r(48,"mat-checkbox",12),p(49),d(50,"translate"),a(),r(51,"div",13)(52,"mat-form-field",9)(53,"mat-label",5),p(54,"rulechain.description"),a(),f(55,"textarea",14),a()()()()()),n&2&&(o(),V("!hidden",t.isEdit),s("disabled",c(2,40,t.isLoading$)),o(2),h(" ",c(4,42,"rulechain.open-rulechain")," "),o(2),V("!hidden",t.isEdit),s("disabled",c(6,44,t.isLoading$)),o(2),h(" ",c(8,46,"rulechain.export")," "),o(2),V("!hidden",t.isEdit||!(!(t.entity!=null&&t.entity.root)&&t.ruleChainScope==="tenant"||!t.isEdgeRootRuleChain()&&t.ruleChainScope==="edge")),s("disabled",c(10,48,t.isLoading$)),o(2),h(" ",c(12,50,"rulechain.set-root")," "),o(2),V("!hidden",t.isEdit||(t.entity==null?null:t.entity.root)||t.ruleChainScope!=="edges"),s("disabled",c(14,52,t.isLoading$)),o(2),h(" ",c(16,54,"rulechain.set-edge-template-root-rulechain")," "),o(2),V("!hidden",t.isEdit||!t.isNotAutoAssignToEdgeRuleChain()||t.ruleChainScope!=="edges"),s("disabled",c(18,56,t.isLoading$)),o(2),h(" ",c(20,58,"rulechain.set-auto-assign-to-edge")," "),o(2),V("!hidden",t.isEdit||!t.isAutoAssignToEdgeRuleChain()||t.ruleChainScope!=="edges"),s("disabled",c(22,60,t.isLoading$)),o(2),h(" ",c(24,62,"rulechain.unset-auto-assign-to-edge")," "),o(2),V("!hidden",t.isEdit||t.isEdgeRootRuleChain()||t.ruleChainScope!=="edges"),s("disabled",c(26,64,t.isLoading$)),o(2),h(" ",c(28,66,"edge.unassign-from-edge")," "),o(2),V("!hidden",t.hideDelete()||t.isEdit||t.ruleChainScope==="edge"),s("disabled",c(30,68,t.isLoading$)),o(2),h(" ",c(32,70,"rulechain.delete")," "),o(3),V("!hidden",t.isEdit),s("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(5),s("formGroup",t.entityForm),o(),s("disabled",c(41,72,t.isLoading$)||!t.isEdit),o(6),s("ngIf",t.entityForm.get("name").hasError("required")),o(),s("ngIf",t.entityForm.get("name").hasError("maxlength")),o(2),h(" ",c(50,74,"rulechain.debug-mode")," "))},dependencies:[G,ee,$t,ae,he,me,Ce,Pe,Jt,ce,ge,W,K,ue,ie,se,bt,J,le,R],styles:['@charset "UTF-8";']})}}return i})();C();C();C();var PE=i=>[i];function FE(i,m){if(i&1&&(r(0,"mat-tab",8,0),d(2,"translate"),f(3,"tb-attribute-table",9),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),s("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function AE(i,m){if(i&1&&(r(0,"mat-tab",8,1),d(2,"translate"),f(3,"tb-attribute-table",10),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),s("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function NE(i,m){if(i&1&&(r(0,"mat-tab",8,2),d(2,"translate"),f(3,"tb-alarm-table",11),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function kE(i,m){if(i&1&&(r(0,"mat-tab",8,3),d(2,"translate"),f(3,"tb-event-table",12),a()),i&2){let e=U(1),n=v();T("label",c(2,6,"rulechain.events")),o(3),s("debugEventTypes",pt(8,PE,n.debugEventTypes.DEBUG_RULE_CHAIN))("defaultEventType",n.debugEventTypes.DEBUG_RULE_CHAIN)("active",e.isActive)("tenantId",n.entity.tenantId.id)("entityId",n.entity.id)}}function OE(i,m){if(i&1&&(r(0,"mat-tab",8,4),d(2,"translate"),f(3,"tb-relation-table",11),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"relation.relations")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}function RE(i,m){if(i&1&&(r(0,"mat-tab",8,5),d(2,"translate"),f(3,"tb-audit-log-table",13),a()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),s("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function BE(i,m){if(i&1){let e=j();r(0,"mat-tab",8,6),d(2,"translate"),r(3,"tb-version-control",14),_("versionRestored",function(){I(e);let t=v();return M(t.entitiesTableConfig.updateData())}),a()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),s("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var Vp=(()=>{class i extends Lt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-rulechain-tabs"]],features:[L],decls:7,vars:7,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],["eventsTab","matTab"],["relationsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"],[3,"debugEventTypes","defaultEventType","active","tenantId","entityId"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,FE,4,7,"mat-tab",7)(1,AE,4,7,"mat-tab",7)(2,NE,4,5,"mat-tab",7)(3,kE,4,10,"mat-tab",7)(4,OE,4,5,"mat-tab",7)(5,RE,4,6,"mat-tab",7)(6,BE,4,7,"mat-tab",7),n&2&&(s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN))},dependencies:[G,St,ri,$i,Ai,vi,yi,ai,R],encapsulation:2})}}return i})();var Ua=(()=>{class i{constructor(e,n,t,l,u,y,w,x,q,De){this.ruleChainService=e,this.dialogService=n,this.dialog=t,this.importExport=l,this.itembuffer=u,this.edgeService=y,this.translate=w,this.datePipe=x,this.router=q,this.customTranslate=De,this.config=new Ge,this.config.entityType=k.RULE_CHAIN,this.config.entityComponent=Bp,this.config.entityTabsComponent=Vp,this.config.entityTranslations=Ue.get(k.RULE_CHAIN),this.config.entityResources=tt.get(k.RULE_CHAIN),this.config.rowPointer=!0,this.config.deleteEntityTitle=Ve=>this.translate.instant("rulechain.delete-rulechain-title",{ruleChainName:Ve.name}),this.config.deleteEntityContent=()=>this.translate.instant("rulechain.delete-rulechain-text"),this.config.deleteEntitiesTitle=Ve=>this.translate.instant("rulechain.delete-rulechains-title",{count:Ve}),this.config.deleteEntitiesContent=()=>this.translate.instant("rulechain.delete-rulechains-text"),this.config.loadEntity=Ve=>this.ruleChainService.getRuleChain(Ve.id),this.config.saveEntity=Ve=>this.saveRuleChain(Ve),this.config.deleteEntity=Ve=>this.ruleChainService.deleteRuleChain(Ve.id),this.config.onEntityAction=Ve=>this.onRuleChainAction(Ve),this.config.handleRowClick=(Ve,Ct)=>(this.config.isDetailsOpen()?this.config.toggleEntityDetails(Ve,Ct):this.openRuleChain(Ve,Ct),!0)}resolve(e){let n=e.params?.edgeId,t=e.data?.ruleChainsType?e.data?.ruleChainsType:"tenant";return this.config.componentsData={ruleChainScope:t,edgeId:n},this.config.columns=this.configureEntityTableColumns(t),this.config.entitiesFetchFunction=this.configureEntityFunctions(t,n),this.config.groupActionDescriptors=this.configureGroupActions(t),this.config.addActionDescriptors=this.configureAddActions(t),this.config.cellActionDescriptors=this.configureCellActions(t),t==="tenant"||t==="edges"?(this.config.entitySelectionEnabled=l=>l&&!l.root,this.config.deleteEnabled=l=>l&&!l.root,this.config.entitiesDeleteEnabled=!0,this.config.tableTitle=this.configureTableTitle(t,null)):t==="edge"&&(this.config.entitySelectionEnabled=l=>this.config.componentsData.edge.rootRuleChainId.id!==l.id.id,this.edgeService.getEdge(n).subscribe(l=>{this.config.componentsData.edge=l,this.config.tableTitle=this.configureTableTitle(t,l)}),this.config.entitiesDeleteEnabled=!1),this.config}configureEntityTableColumns(e){let n=[];return n.push(new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("name","rulechain.name","50%"),new Y("description","rulechain.description","50%",t=>this.customTranslate.transform(t.additionalInfo?.description||""),()=>({}),!1)),e==="tenant"||e==="edge"?n.push(new Y("root","rulechain.root","60px",t=>e==="edge"?Ft(this.config.componentsData.edge.rootRuleChainId.id===t.id.id):Ft(t.root))):e==="edges"&&n.push(new Y("root","rulechain.edge-template-root","100px",t=>Ft(t.root)),new Y("assignToEdge","rulechain.assign-to-edge","100px",t=>Ft(this.isAutoAssignToEdgeRuleChain(t)),()=>({}),!1)),n}configureAddActions(e){let n=[];return(e==="tenant"||e==="edges")&&n.push({name:this.translate.instant("rulechain.create-new-rulechain"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:t=>this.config.getTable().addEntity(t)},{name:this.translate.instant("rulechain.import"),icon:"file_upload",isEnabled:()=>!0,onAction:t=>this.importRuleChain(t)}),e==="edge"&&n.push({name:this.translate.instant("rulechain.assign-to-edge"),icon:"add",isEnabled:()=>!0,onAction:t=>this.assignRuleChainsToEdge(t)}),n}configureEntityFunctions(e,n){if(e==="tenant")return t=>this.fetchRuleChains(t);if(e==="edges")return t=>this.fetchEdgeRuleChains(t);if(e==="edge")return t=>this.ruleChainService.getEdgeRuleChains(n,t)}configureTableTitle(e,n){if(e==="tenant")return this.translate.instant("rulechain.rulechains");if(e==="edges")return this.translate.instant("edge.rulechain-templates");if(e==="edge")return this.config.tableTitle=n.name+": "+this.translate.instant("rulechain.rulechains")}configureGroupActions(e){let n=[];return e==="edge"&&n.push({name:this.translate.instant("rulechain.unassign-rulechains"),icon:"assignment_return",isEnabled:!0,onAction:(t,l)=>this.unassignRuleChainsFromEdge(t,l)}),n}configureCellActions(e){let n=[];return n.push({name:this.translate.instant("rulechain.export"),icon:"file_download",isEnabled:()=>!0,onAction:(t,l)=>this.exportRuleChain(t,l)}),e==="tenant"&&n.push({name:this.translate.instant("rulechain.set-root"),icon:"flag",isEnabled:t=>this.isNonRootRuleChain(t),onAction:(t,l)=>this.setRootRuleChain(t,l)}),e==="edges"&&n.push({name:this.translate.instant("rulechain.set-edge-template-root-rulechain"),icon:"flag",isEnabled:t=>this.isNonRootRuleChain(t),onAction:(t,l)=>this.setEdgeTemplateRootRuleChain(t,l)},{name:this.translate.instant("rulechain.set-auto-assign-to-edge"),icon:"bookmark_outline",isEnabled:t=>this.isNotAutoAssignToEdgeRuleChain(t),onAction:(t,l)=>this.setAutoAssignToEdgeRuleChain(t,l)},{name:this.translate.instant("rulechain.unset-auto-assign-to-edge"),icon:"bookmark",isEnabled:t=>this.isAutoAssignToEdgeRuleChain(t),onAction:(t,l)=>this.unsetAutoAssignToEdgeRuleChain(t,l)}),e==="edge"&&n.push({name:this.translate.instant("rulechain.set-root"),icon:"flag",isEnabled:t=>this.isNonRootRuleChain(t),onAction:(t,l)=>this.setRootRuleChain(t,l)},{name:this.translate.instant("edge.unassign-from-edge"),icon:"assignment_return",isEnabled:t=>t.id.id!==this.config.componentsData.edge.rootRuleChainId.id,onAction:(t,l)=>this.unassignFromEdge(t,l)}),n.push({name:this.translate.instant("rulechain.rulechain-details"),icon:"edit",isEnabled:()=>!0,onAction:(t,l)=>this.config.toggleEntityDetails(t,l)}),n}importRuleChain(e){e&&e.stopPropagation();let n=this.config.componentsData.ruleChainScope==="tenant"?Ti.CORE:Ti.EDGE;this.importExport.importRuleChain(n).subscribe(t=>{t&&(this.itembuffer.storeRuleChainImport(t),this.config.componentsData.ruleChainScope==="edges"?this.router.navigateByUrl("edgeManagement/ruleChains/ruleChain/import"):this.router.navigateByUrl("ruleChains/ruleChain/import"))})}openRuleChain(e,n){e&&e.stopPropagation(),this.config.componentsData.ruleChainScope==="edges"?this.router.navigateByUrl(`edgeManagement/ruleChains/${n.id.id}`):this.config.componentsData.ruleChainScope==="edge"?this.router.navigateByUrl(`edgeInstances/${this.config.componentsData.edgeId}/ruleChains/${n.id.id}`):this.router.navigateByUrl(`ruleChains/${n.id.id}`)}saveRuleChain(e){return Fc(e.type)&&(this.config.componentsData.ruleChainScope==="tenant"?e.type=Ti.CORE:this.config.componentsData.ruleChainScope==="edges"?e.type=Ti.EDGE:e.type=Ti.CORE),this.ruleChainService.saveRuleChain(e)}exportRuleChain(e,n){e&&e.stopPropagation(),this.importExport.exportRuleChain(n.id.id)}setRootRuleChain(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.set-root-rulechain-title",{ruleChainName:n.name}),this.translate.instant("rulechain.set-root-rulechain-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&(this.config.componentsData.ruleChainScope==="edge"?this.ruleChainService.setEdgeRootRuleChain(this.config.componentsData.edgeId,n.id.id).subscribe(l=>{this.config.componentsData.edge=l,this.config.updateData()}):this.ruleChainService.setRootRuleChain(n.id.id).subscribe(()=>{this.config.updateData()}))})}onRuleChainAction(e){switch(e.action){case"open":return this.openRuleChain(e.event,e.entity),!0;case"export":return this.exportRuleChain(e.event,e.entity),!0;case"setRoot":return this.setRootRuleChain(e.event,e.entity),!0;case"setEdgeTemplateRoot":return this.setEdgeTemplateRootRuleChain(e.event,e.entity),!0;case"unassignFromEdge":return this.unassignFromEdge(e.event,e.entity),!0;case"setAutoAssignToEdge":return this.setAutoAssignToEdgeRuleChain(e.event,e.entity),!0;case"unsetAutoAssignToEdge":return this.unsetAutoAssignToEdgeRuleChain(e.event,e.entity),!0}return!1}setEdgeTemplateRootRuleChain(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.set-edge-template-root-rulechain-title",{ruleChainName:n.name}),this.translate.instant("rulechain.set-edge-template-root-rulechain-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.ruleChainService.setEdgeTemplateRootRuleChain(n.id.id).subscribe(()=>{this.config.updateData()})})}checkMissingToRelatedRuleChains(){this.edgeService.findMissingToRelatedRuleChains(this.config.componentsData.edgeId).subscribe(e=>{if(e&&Object.keys(e).length>0){let n=new Array;for(let l of Object.keys(e)){let u=e[l],y="- '"+l+"': '"+u.join("', ")+"'";n.push(y)}let t=this.translate.instant("edge.missing-related-rule-chains-text",{missingRuleChains:n.join("<br>")});this.dialogService.alert(this.translate.instant("edge.missing-related-rule-chains-title"),t,this.translate.instant("action.close"),!0).subscribe(()=>{this.config.updateData()})}else this.config.updateData()})}assignRuleChainsToEdge(e){e&&e.stopPropagation(),this.dialog.open(lo,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{edgeId:this.config.componentsData.edgeId,entityType:k.RULE_CHAIN}}).afterClosed().subscribe(n=>{n&&this.checkMissingToRelatedRuleChains()})}unassignFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.unassign-rulechain-title",{ruleChainName:n.name}),this.translate.instant("rulechain.unassign-rulechain-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.ruleChainService.unassignRuleChainFromEdge(this.config.componentsData.edgeId,n.id.id).subscribe(()=>{this.checkMissingToRelatedRuleChains()})})}unassignRuleChainsFromEdge(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.unassign-rulechains-from-edge-title",{count:n.length}),this.translate.instant("rulechain.unassign-rulechains-from-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{if(t){let l=[];n.forEach(u=>{l.push(this.ruleChainService.unassignRuleChainFromEdge(this.config.componentsData.edgeId,u.id.id))}),Nt(l).subscribe(()=>{this.checkMissingToRelatedRuleChains()})}})}setAutoAssignToEdgeRuleChain(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.set-auto-assign-to-edge-title",{ruleChainName:n.name}),this.translate.instant("rulechain.set-auto-assign-to-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.ruleChainService.setAutoAssignToEdgeRuleChain(n.id.id).subscribe(()=>{this.config.updateData()})})}unsetAutoAssignToEdgeRuleChain(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("rulechain.unset-auto-assign-to-edge-title",{ruleChainName:n.name}),this.translate.instant("rulechain.unset-auto-assign-to-edge-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.ruleChainService.unsetAutoAssignToEdgeRuleChain(n.id.id).subscribe(()=>{this.config.updateData()})})}isNonRootRuleChain(e){return this.config.componentsData.ruleChainScope==="edge"?this.config.componentsData.edge.rootRuleChainId&&this.config.componentsData.edge.rootRuleChainId.id!==e.id.id:!e.root}isAutoAssignToEdgeRuleChain(e){return!e.root&&this.config.componentsData.autoAssignToEdgeRuleChainIds.includes(e.id.id)}isNotAutoAssignToEdgeRuleChain(e){return!e.root&&!this.config.componentsData.autoAssignToEdgeRuleChainIds.includes(e.id.id)}fetchRuleChains(e){return this.ruleChainService.getRuleChains(e,Ti.CORE)}fetchEdgeRuleChains(e){return this.ruleChainService.getAutoAssignToEdgeRuleChains().pipe(_t(n=>(this.config.componentsData.autoAssignToEdgeRuleChainIds=[],n.map(t=>this.config.componentsData.autoAssignToEdgeRuleChainIds.push(t.id.id)),this.ruleChainService.getRuleChains(e,Ti.EDGE))))}static{this.\u0275fac=function(n){return new(n||i)(D(da),D(jt),D(je),D(Fi),D(us),D(Hi),D(Z),D(ke),D(pe),D(mi))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var ur=(()=>{class i{constructor(e){this.ruleChainService=e}resolve(e){let n=e.params.ruleChainId;return this.ruleChainService.getRuleChain(n)}static{this.\u0275fac=function(n){return new(n||i)(D(da))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})(),fr=(()=>{class i{constructor(e){this.ruleChainService=e}resolve(e){let n=e.params.ruleChainId;return this.ruleChainService.getRuleChainMetadata(n)}static{this.\u0275fac=function(n){return new(n||i)(D(da))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})(),No=(()=>{class i{constructor(e,n){this.ruleChainService=e,this.modulesMap=n}resolve(e){return this.ruleChainService.getRuleNodeComponents(this.modulesMap,e.data.ruleChainType)}static{this.\u0275fac=function(n){return new(n||i)(D(da),D(Ic,8))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})(),ko=(()=>{class i{constructor(){}resolve(e){return Ha(import("./chunk-OWQOMBUM.js"))}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})(),jp=(()=>{class i{constructor(e,n){this.itembuffer=e,this.router=n}canActivate(e,n){return this.itembuffer.hasRuleChainImport()?!0:this.router.parseUrl("ruleChains")}static{this.\u0275fac=function(n){return new(n||i)(D(us),D(pe))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})(),Lp=(i,m,e)=>{let n=e.ruleChain.name;return e.ruleChain.root&&(n+=` (${m.instant("rulechain.root")})`),n},Qd=(i,m,e)=>`${m.instant("rulechain.import")}: ${e.ruleChain.name}`,jE=[{path:"ruleChains",data:{breadcrumb:{menuId:be.rule_chains}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN],title:"rulechain.rulechains",ruleChainsType:"tenant"},resolve:{entitiesTableConfig:Ua}},{path:":ruleChainId",component:yo,canDeactivate:[xe],data:{breadcrumb:{labelFunction:Lp,icon:"settings_ethernet"},auth:[E.TENANT_ADMIN],title:"rulechain.rulechain",import:!1,ruleChainType:Ti.CORE},loadChildren:()=>import("./chunk-VWE3O37M.js").then(i=>i.RuleChainPageModule),resolve:{ruleChain:ur,ruleChainMetaData:fr,ruleNodeComponents:No,tooltipster:ko}},{path:"ruleChain/import",component:yo,canActivate:[jp],canDeactivate:[xe],data:{breadcrumb:{labelFunction:Qd,icon:"settings_ethernet"},auth:[E.TENANT_ADMIN],title:"rulechain.rulechain",import:!0,ruleChainType:Ti.CORE},loadChildren:()=>import("./chunk-VWE3O37M.js").then(i=>i.RuleChainPageModule),resolve:{ruleNodeComponents:No,tooltipster:ko}}]}],Gp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[Ua,ur,fr,No,ko,jp],imports:[B.forChild(jE),B]})}}return i})();(function(){Q(Gp,{imports:[B],exports:[B]})})();C();function GE(i,m){if(i&1&&(r(0,"mat-icon",9),p(1),a()),i&2){let e=v();o(),O(e.node.icon)}}function UE(i,m){if(i&1&&f(0,"img",10),i&2){let e=v();s("src",e.iconUrl,$n)}}function qE(i,m){if(i&1&&(r(0,"span",11),p(1),a()),i&2){let e=v();o(),O(e.node.name)}}function WE(i,m){if(i&1&&(r(0,"div",12),f(1,"div",13),a()),i&2){let e=m.$implicit,n=v();s("connector",e)("callbacks",n.callbacks),o(),s("connector",e)("nodeRectInfo",n.nodeRectInfo)("mouseOverConnector",n.mouseOverConnector)("callbacks",n.callbacks)("modelservice",n.modelservice)}}function HE(i,m){if(i&1&&(r(0,"div",12),f(1,"div",13),a()),i&2){let e=m.$implicit,n=v();s("connector",e)("callbacks",n.callbacks),o(),s("connector",e)("nodeRectInfo",n.nodeRectInfo)("mouseOverConnector",n.mouseOverConnector)("callbacks",n.callbacks)("modelservice",n.modelservice)}}function zE(i,m){if(i&1){let e=j();r(0,"section")(1,"div",14),_("click",function(t){I(e);let l=v();return M(l.userNodeCallbacks.nodeEdit(t,l.node))}),f(2,"i",15),a(),r(3,"div",16),_("click",function(){I(e);let t=v();return M(t.modelservice.nodes.delete(t.node))}),p(4," \xD7 "),a()()}}function $E(i,m){if(i&1){let e=j();r(0,"section")(1,"div",17),_("click",function(t){I(e);let l=v();return M(l.openRuleChain(t,l.node))})("mouseenter",function(t){I(e);let l=v();return M(l.displayOpenRuleChainTooltip(t,l.node))}),f(2,"mat-icon",18),a()()}}var Yd=(()=>{class i extends su{constructor(e,n,t){super(),this.sanitizer=e,this.translate=n,this.router=t,this.RuleNodeType=Gu}ngOnInit(){super.ngOnInit(),this.node.iconUrl&&(this.iconUrl=this.sanitizer.bypassSecurityTrustResourceUrl(this.node.iconUrl))}openRuleChain(e,n){e&&e.stopPropagation(),n.configuration?.ruleChainId&&(n.ruleChainType===Ti.EDGE?this.router.navigateByUrl(`/edgeManagement/ruleChains/${n.configuration?.ruleChainId}`):this.router.navigateByUrl(`/ruleChains/${n.configuration?.ruleChainId}`))}displayOpenRuleChainTooltip(e,n){e&&e.stopPropagation(),this.userNodeCallbacks.mouseLeave(e,n);let t='<div class="tb-rule-node-tooltip"><div id="tb-node-content"><div class="tb-node-description">'+this.translate.instant("rulechain.open-rulechain")+"</div></div></div>",l=$(e.target);l.tooltipster({theme:"tooltipster-shadow",delay:100,trigger:"custom",triggerOpen:{click:!1,tap:!1},triggerClose:{click:!0,tap:!0,scroll:!0,mouseleave:!0},side:"top",distance:12,trackOrigin:!0});let u=l.tooltipster("instance"),y=$(t);u.content(y),u.open()}static{this.\u0275fac=function(n){return new(n||i)(g(Mr),g(Z),g(pe))}}static{this.\u0275cmp=P({type:i,selectors:[["rule-node"]],features:[L],decls:15,vars:21,consts:[[3,"dblclick","mousedown","mouseenter","mouseleave"],[1,"fc-node-overlay"],["class","max-w-15% flex-full",4,"ngIf"],["class","max-w-15% flex-full",3,"src",4,"ngIf"],[1,"flex","max-w-85%","flex-full","flex-col","items-stretch","justify-center"],[1,"tb-node-type"],["class","tb-node-title",4,"ngIf"],["fc-magnet","",3,"connector","callbacks",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"max-w-15%","flex-full"],[1,"max-w-15%","flex-full",3,"src"],[1,"tb-node-title"],["fc-magnet","",3,"connector","callbacks"],["fc-connector","",3,"connector","nodeRectInfo","mouseOverConnector","callbacks","modelservice"],[1,"fc-nodeedit",3,"click"],["aria-hidden","true",1,"fa","fa-pencil"],[1,"fc-nodedelete",3,"click"],[1,"fc-nodeopen",3,"click","mouseenter"],["svgIcon","mdi:login",1,"material-icons"]],template:function(n,t){n&1&&(r(0,"div",0),_("dblclick",function(u){return t.userNodeCallbacks.doubleClick(u,t.node)})("mousedown",function(u){return t.userNodeCallbacks.mouseDown(u,t.node)})("mouseenter",function(u){return t.userNodeCallbacks.mouseEnter(u,t.node)})("mouseleave",function(u){return t.userNodeCallbacks.mouseLeave(u,t.node)}),f(1,"div",1),r(2,"div"),b(3,GE,2,1,"mat-icon",2)(4,UE,1,1,"img",3),r(5,"div",4)(6,"span",5),p(7),a(),b(8,qE,2,1,"span",6),a(),r(9,"div"),b(10,WE,2,7,"div",7),a(),r(11,"div"),b(12,HE,2,7,"div",7),a()(),b(13,zE,5,0,"section",8)(14,$E,3,0,"section",8),a()),n&2&&(o(2),gc("tb-rule-node ",t.node.nodeClass,""),V("tb-rule-node-highlighted",t.node.highlighted)("tb-rule-node-invalid",t.node.error),o(),s("ngIf",!t.iconUrl),o(),s("ngIf",t.iconUrl),o(3),O(t.node.component.name),o(),s("ngIf",t.node.name),o(),nd(t.flowchartConstants.leftConnectorClass),o(),s("ngForOf",t.modelservice.nodes.getConnectorsByType(t.node,t.flowchartConstants.leftConnectorType)),o(),nd(t.flowchartConstants.rightConnectorClass),o(),s("ngForOf",t.modelservice.nodes.getConnectorsByType(t.node,t.flowchartConstants.rightConnectorType)),o(),s("ngIf",t.modelservice.isEditable()&&!t.node.readonly),o(),s("ngIf",(t.node.component==null||t.node.component.configurationDescriptor==null||t.node.component.configurationDescriptor.nodeDefinition==null?null:t.node.component.configurationDescriptor.nodeDefinition.ruleChainNode)&&t.modelservice.isEditable()))},dependencies:[Te,G,ae,lu,pu],styles:['@charset "UTF-8";[_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;inset:0;background-color:#000;border-radius:5px;opacity:0}[_nghost-%COMP%]   .fc-hover[_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%], .fc-hover   [_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%]{opacity:.25;transition:opacity .2s}[_nghost-%COMP%]   .fc-selected[_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%], .fc-selected   [_nghost-%COMP%]   .fc-node-overlay[_ngcontent-%COMP%]{opacity:.25}[_nghost-%COMP%]   .fc-edit[_nghost-%COMP%]   .fc-nodeedit[_ngcontent-%COMP%], .fc-edit   [_nghost-%COMP%]   .fc-nodeedit[_ngcontent-%COMP%], [_nghost-%COMP%]   .fc-edit[_nghost-%COMP%]   .fc-nodedelete[_ngcontent-%COMP%], .fc-edit   [_nghost-%COMP%]   .fc-nodedelete[_ngcontent-%COMP%]{box-sizing:content-box;border:solid 2px #fff;background:#f83e05;outline:none}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]{box-sizing:content-box;display:flex;flex-direction:row;min-width:150px;max-width:150px;height:32px;min-height:32px;max-height:32px;padding:5px 10px;font-size:12px;line-height:16px;color:#333;pointer-events:none;background-color:#f15b26;border:solid 1px #777;border-radius:5px}[_nghost-%COMP%]   .tb-rule-node.tb-filter-type[_ngcontent-%COMP%]{background-color:#f1e861}[_nghost-%COMP%]   .tb-rule-node.tb-enrichment-type[_ngcontent-%COMP%]{background-color:#cdf14e}[_nghost-%COMP%]   .tb-rule-node.tb-transformation-type[_ngcontent-%COMP%]{background-color:#79cef1}[_nghost-%COMP%]   .tb-rule-node.tb-action-type[_ngcontent-%COMP%]{background-color:#f1928f}[_nghost-%COMP%]   .tb-rule-node.tb-external-type[_ngcontent-%COMP%]{background-color:#fbc766}[_nghost-%COMP%]   .tb-rule-node.tb-flow-type[_ngcontent-%COMP%]{background-color:#d6c4f1}[_nghost-%COMP%]   .tb-rule-node.tb-unknown-type[_ngcontent-%COMP%]{background-color:#f16c29}[_nghost-%COMP%]   .tb-rule-node.tb-rule-node-highlighted[_ngcontent-%COMP%]:not(.tb-rule-node-invalid){box-shadow:0 0 10px 6px #51cbee}[_nghost-%COMP%]   .tb-rule-node.tb-rule-node-highlighted[_ngcontent-%COMP%]:not(.tb-rule-node-invalid)   .tb-node-title[_ngcontent-%COMP%]{font-weight:700;text-decoration:underline}[_nghost-%COMP%]   .tb-rule-node.tb-rule-node-invalid[_ngcontent-%COMP%]{box-shadow:0 0 10px 6px #ff5c50}[_nghost-%COMP%]   .tb-rule-node.tb-input-type[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;background-color:#a3eaa9}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin:auto;width:20px;min-width:20px;height:20px;min-height:20px;padding-right:4px;font-size:20px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .tb-node-title[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .tb-node-type[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .tb-node-title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-leftConnectors[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-rightConnectors[_ngcontent-%COMP%]{position:absolute;top:0;z-index:0;display:flex;flex-direction:column;height:100%}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-leftConnectors[_ngcontent-%COMP%]   .fc-magnet[_ngcontent-%COMP%], [_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-rightConnectors[_ngcontent-%COMP%]   .fc-magnet[_ngcontent-%COMP%]{align-items:center}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-leftConnectors[_ngcontent-%COMP%]{left:-20px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-rightConnectors[_ngcontent-%COMP%]{right:-20px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-magnet[_ngcontent-%COMP%]{display:flex;flex-grow:1;justify-content:center;height:60px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-connector[_ngcontent-%COMP%]{width:14px;height:14px;margin:10px;pointer-events:all;background-color:#ccc;border:1px solid #333;border-radius:5px}[_nghost-%COMP%]   .tb-rule-node[_ngcontent-%COMP%]   .fc-connector.fc-hover[_ngcontent-%COMP%]{background-color:#000}']})}}return i})();var Up=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[{provide:ru,useValue:{nodeComponentType:Yd}}],imports:[ne,oe,ve,Gp]})}}return i})();(function(){Q(Up,{declarations:[Bp,Vp,Yd],imports:[ne,oe,ve,Gp]})})();C();var qp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,wd,al]})}}return i})();(function(){Q(qp,{declarations:[tl,gs,Io,ol,el,Na,Aa,il,Ks,T0],imports:[ne,oe,ve,wd,al]})})();C();var Wp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,_i,Dd]})}}return i})();(function(){Q(Wp,{declarations:[Hf,Jf,zf,$f],imports:[ne,oe,ve,_i,Dd]})})();C();C();C();C();function JE(i,m){if(i&1&&(r(0,"mat-tab",4,0),d(2,"translate"),f(3,"tb-attribute-table",5),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.attributes")),o(3),s("defaultAttributeScope",n.attributeScopes.SERVER_SCOPE)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function QE(i,m){if(i&1&&(r(0,"mat-tab",4,1),d(2,"translate"),f(3,"tb-attribute-table",6),a()),i&2){let e=U(1),n=v();T("label",c(2,5,"attribute.latest-telemetry")),o(3),s("defaultAttributeScope",n.latestTelemetryTypes.LATEST_TELEMETRY)("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function YE(i,m){if(i&1&&(r(0,"mat-tab",4,2),d(2,"translate"),f(3,"tb-alarm-table",7),a()),i&2){let e=U(1),n=v();T("label",c(2,3,"alarm.alarms")),o(3),s("active",e.isActive)("entityId",n.entity.id)}}var Hp=(()=>{class i extends Lt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-tenant-profile-tabs"]],features:[L],decls:3,vars:3,consts:[["attributesTab","matTab"],["telemetryTab","matTab"],["alarmsTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"defaultAttributeScope","active","entityId","entityName"],["disableAttributeScopeSelection","",3,"defaultAttributeScope","active","entityId","entityName"],[3,"active","entityId"]],template:function(n,t){n&1&&b(0,JE,4,7,"mat-tab",3)(1,QE,4,7,"mat-tab",3)(2,YE,4,5,"mat-tab",3),n&2&&(s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity))},dependencies:[G,St,vi,yi,R],encapsulation:2})}}return i})();var zp=(()=>{class i{constructor(e,n,t,l,u,y,w){this.tenantProfileService=e,this.importExport=n,this.translate=t,this.datePipe=l,this.router=u,this.dialogService=y,this.customTranslate=w,this.config=new Ge,this.config.entityType=k.TENANT_PROFILE,this.config.entityComponent=Pf,this.config.entityTabsComponent=Hp,this.config.entityTranslations=Ue.get(k.TENANT_PROFILE),this.config.entityResources=tt.get(k.TENANT_PROFILE),this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("name","tenant-profile.name","40%"),new Y("description","tenant-profile.description","60%",x=>this.customTranslate.transform(x.description||"")),new Y("isDefault","tenant-profile.default","60px",x=>Ft(x.default))),this.config.cellActionDescriptors.push({name:this.translate.instant("tenant-profile.export"),icon:"file_download",isEnabled:()=>!0,onAction:(x,q)=>this.exportTenantProfile(x,q)},{name:this.translate.instant("tenant-profile.set-default"),icon:"flag",isEnabled:x=>!x.default,onAction:(x,q)=>this.setDefaultTenantProfile(x,q)}),this.config.deleteEntityTitle=x=>this.translate.instant("tenant-profile.delete-tenant-profile-title",{tenantProfileName:x.name}),this.config.deleteEntityContent=()=>this.translate.instant("tenant-profile.delete-tenant-profile-text"),this.config.deleteEntitiesTitle=x=>this.translate.instant("tenant-profile.delete-tenant-profiles-title",{count:x}),this.config.deleteEntitiesContent=()=>this.translate.instant("tenant-profile.delete-tenant-profiles-text"),this.config.entitiesFetchFunction=x=>this.tenantProfileService.getTenantProfiles(x),this.config.loadEntity=x=>this.tenantProfileService.getTenantProfile(x.id),this.config.saveEntity=x=>this.tenantProfileService.saveTenantProfile(x),this.config.deleteEntity=x=>this.tenantProfileService.deleteTenantProfile(x.id),this.config.onEntityAction=x=>this.onTenantProfileAction(x),this.config.deleteEnabled=x=>x&&!x.default,this.config.entitySelectionEnabled=x=>x&&!x.default,this.config.addActionDescriptors=this.configureAddActions()}resolve(){return this.config.tableTitle=this.translate.instant("tenant-profile.tenant-profiles"),this.config}configureAddActions(){let e=[];return e.push({name:this.translate.instant("tenant-profile.create-tenant-profile"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:n=>this.config.getTable().addEntity(n)},{name:this.translate.instant("tenant-profile.import"),icon:"file_upload",isEnabled:()=>!0,onAction:n=>this.importTenantProfile(n)}),e}openTenantProfile(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["tenantProfiles",n.id.id]);this.router.navigateByUrl(t)}setDefaultTenantProfile(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("tenant-profile.set-default-tenant-profile-title",{tenantProfileName:n.name}),this.translate.instant("tenant-profile.set-default-tenant-profile-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.tenantProfileService.setDefaultTenantProfile(n.id.id).subscribe(()=>{this.config.updateData()})})}importTenantProfile(e){this.importExport.importTenantProfile().subscribe(n=>{n&&this.config.updateData()})}exportTenantProfile(e,n){e&&e.stopPropagation(),this.importExport.exportTenantProfile(n.id.id)}onTenantProfileAction(e){switch(e.action){case"open":return this.openTenantProfile(e.event,e.entity),!0;case"setDefault":return this.setDefaultTenantProfile(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(D(o0),D(Fi),D(Z),D(ke),D(pe),D(jt),D(mi))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var KE=[{path:"tenantProfiles",data:{breadcrumb:{menuId:be.tenant_profiles}},children:[{path:"",component:Le,data:{auth:[E.SYS_ADMIN],title:"tenant-profile.tenant-profiles"},resolve:{entitiesTableConfig:zp}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"mdi:alpha-t-box"},auth:[E.SYS_ADMIN],title:"tenant-profile.tenant-profiles"},resolve:{entitiesTableConfig:zp}}]}],$p=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[zp],imports:[B.forChild(KE),B]})}}return i})();(function(){Q($p,{imports:[B],exports:[B]})})();var Jp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,$p]})}}return i})();(function(){Q(Jp,{declarations:[Hp],imports:[ne,oe,ve,$p]})})();C();C();var XE=i=>({count:i});function ZE(i,m){if(i&1&&(r(0,"mat-option",18),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(3);s("value",e),o(),h(" ",c(2,2,n.deviceTransportTypeTranslations.get(e))," ")}}function eI(i,m){if(i&1&&(r(0,"mat-hint"),p(1),d(2,"translate"),a()),i&2){let e=v(3);o(),h(" ",c(2,1,e.deviceTransportTypeHints.get(e.detailsForm.get("transportType").value))," ")}}function tI(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"device-profile.transport-type-required")," "))}function iI(i,m){if(i&1&&(r(0,"div",10)(1,"mat-form-field",11)(2,"mat-label",12),p(3,"device-profile.transport-type"),a(),r(4,"mat-select",13),b(5,ZE,3,4,"mat-option",14),a(),b(6,eI,3,3,"mat-hint",15)(7,tI,3,3,"mat-error",15),a(),r(8,"div",16),f(9,"tb-device-profile-transport-configuration",17),a()()),i&2){let e=v(2);s("formGroup",e.detailsForm),o(5),s("ngForOf",e.deviceTransportTypes),o(),s("ngIf",e.detailsForm.get("transportType").value),o(),s("ngIf",e.detailsForm.get("transportType").hasError("required")),o(2),s("isAdd",e.isTransportTypeChanged)}}function nI(i,m){if(i&1&&(r(0,"mat-tab",8,0),d(2,"translate"),b(3,iI,10,5,"div",9),a()),i&2){let e=U(1);T("label",c(2,2,"device-profile.transport-configuration")),o(3),s("ngIf",e.isActive)}}function oI(i,m){if(i&1&&(r(0,"mat-tab",8,1),d(2,"translate"),f(3,"tb-calculated-fields-table",19),a()),i&2){let e=U(1),n=v();T("label",c(2,4,"entity.type-calculated-fields")),o(3),s("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function aI(i,m){if(i&1&&(r(0,"div",10)(1,"div",16),f(2,"tb-device-profile-alarms",20),a()()),i&2){let e=v(2);s("formGroup",e.detailsForm),o(2),s("deviceProfileId",e.entity.id)}}function rI(i,m){if(i&1&&(r(0,"mat-tab",8,2),d(2,"translate"),d(3,"translate"),b(4,aI,3,2,"div",9),a()),i&2){let e,n=U(1),t=v();T("label",(e=t.detailsForm.get("profileData.alarms").value)!=null&&e.length?Yt(2,2,"device-profile.alarm-rules-with-count",pt(7,XE,t.detailsForm.get("profileData.alarms").value.length)):c(3,5,"device-profile.alarm-rules")),o(4),s("ngIf",n.isActive)}}function sI(i,m){if(i&1&&(r(0,"div",10)(1,"div",16),f(2,"tb-device-profile-provision-configuration",21),a()()),i&2){let e=v(2);s("formGroup",e.detailsForm)}}function lI(i,m){if(i&1&&(r(0,"mat-tab",8,3),d(2,"translate"),b(3,sI,3,1,"div",9),a()),i&2){let e=U(1);T("label",c(2,2,"device-profile.device-provisioning")),o(3),s("ngIf",e.isActive)}}function pI(i,m){if(i&1&&(r(0,"mat-tab",8,4),d(2,"translate"),r(3,"div",10)(4,"div",16),f(5,"tb-device-profile-configuration",22),a()()()),i&2){let e=v();T("label",c(2,2,"device-profile.profile-configuration")),o(3),s("formGroup",e.detailsForm)}}function mI(i,m){if(i&1&&(r(0,"mat-tab",8,5),d(2,"translate"),f(3,"tb-audit-log-table",23),a()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),s("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function dI(i,m){if(i&1){let e=j();r(0,"mat-tab",8,6),d(2,"translate"),r(3,"tb-version-control",24),_("versionRestored",function(){I(e);let t=v();return M(t.entitiesTableConfig.updateData())}),a()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),s("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var Qp=(()=>{class i extends Lt{constructor(e,n){super(e),this.store=e,this.destroyRef=n,this.deviceTransportTypes=Object.values(xi),this.deviceTransportTypeTranslations=ca,this.deviceTransportTypeHints=Wu,this.isTransportTypeChanged=!1}ngOnInit(){super.ngOnInit(),this.detailsForm.get("transportType").valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.isTransportTypeChanged=!0})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(ft))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-device-profile-tabs"]],features:[L],decls:7,vars:7,consts:[["transportType","matTab"],["calculatedFieldsTab","matTab"],["alarmRules","matTab"],["deviceProvisioning","matTab"],["deviceProfile","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],["class","mat-padding",3,"formGroup",4,"ngIf"],[1,"mat-padding",3,"formGroup"],[1,"mat-block"],["translate",""],["formControlName","transportType","required",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["formGroupName","profileData"],["formControlName","transportConfiguration",3,"isAdd"],[3,"value"],[3,"active","entityId","entityName"],["formControlName","alarms",3,"deviceProfileId"],["formControlName","provisionConfiguration"],["formControlName","configuration"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,nI,4,4,"mat-tab",7)(1,oI,4,6,"mat-tab",7)(2,rI,5,9,"mat-tab",7)(3,lI,4,4,"mat-tab",7)(4,pI,6,4,"mat-tab",7)(5,mI,4,6,"mat-tab",7)(6,dI,4,7,"mat-tab",7),n&2&&(s("ngIf",t.entity),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN&&!t.isEdit),o(),s("ngIf",t.entity),o(),s("ngIf",t.entity),o(),s("ngIf",!1),o(),s("ngIf",t.entity&&!t.isEdit),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN&&!t.isEdit))},dependencies:[Te,G,me,Ce,Kt,Pe,vt,gt,St,W,K,ue,ie,se,bt,J,ri,Af,Nf,kf,Of,ai,mo,R],encapsulation:2})}}return i})();C();C();var Yp=(()=>{class i{constructor(e,n,t,l,u,y,w,x){this.deviceProfileService=e,this.importExport=n,this.translate=t,this.datePipe=l,this.dialogService=u,this.router=y,this.dialog=w,this.customTranslate=x,this.config=new Ge,this.config.entityType=k.DEVICE_PROFILE,this.config.entityComponent=Rf,this.config.entityTabsComponent=Qp,this.config.entityTranslations=Ue.get(k.DEVICE_PROFILE),this.config.entityResources=tt.get(k.DEVICE_PROFILE),this.config.hideDetailsTabsOnEdit=!1,this.config.addDialogStyle={width:"1000px"},this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("name","device-profile.name","20%"),new Y("type","device-profile.type","20%",q=>this.translate.instant(Uu.get(q.type))),new Y("transportType","device-profile.transport-type","20%",q=>this.translate.instant(ca.get(q.transportType))),new Y("description","device-profile.description","40%",q=>this.customTranslate.transform(q.description||"")),new Y("isDefault","device-profile.default","60px",q=>Ft(q.default))),this.config.cellActionDescriptors.push({name:this.translate.instant("device-profile.export"),icon:"file_download",isEnabled:()=>!0,onAction:(q,De)=>this.exportDeviceProfile(q,De)},{name:this.translate.instant("device-profile.set-default"),icon:"flag",isEnabled:q=>!q.default,onAction:(q,De)=>this.setDefaultDeviceProfile(q,De)}),this.config.deleteEntityTitle=q=>this.translate.instant("device-profile.delete-device-profile-title",{deviceProfileName:q.name}),this.config.deleteEntityContent=()=>this.translate.instant("device-profile.delete-device-profile-text"),this.config.deleteEntitiesTitle=q=>this.translate.instant("device-profile.delete-device-profiles-title",{count:q}),this.config.deleteEntitiesContent=()=>this.translate.instant("device-profile.delete-device-profiles-text"),this.config.entitiesFetchFunction=q=>this.deviceProfileService.getDeviceProfiles(q),this.config.loadEntity=q=>this.deviceProfileService.getDeviceProfile(q.id),this.config.saveEntity=(q,De)=>this.deviceProfileService.saveDeviceProfileAndConfirmOtaChange(De,q),this.config.deleteEntity=q=>this.deviceProfileService.deleteDeviceProfile(q.id),this.config.onEntityAction=q=>this.onDeviceProfileAction(q),this.config.deleteEnabled=q=>q&&!q.default,this.config.entitySelectionEnabled=q=>q&&!q.default,this.config.addActionDescriptors=this.configureAddActions()}resolve(){return this.config.tableTitle=this.translate.instant("device-profile.device-profiles"),this.config}configureAddActions(){let e=[];return e.push({name:this.translate.instant("device-profile.create-device-profile"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:()=>this.addDeviceProfile()},{name:this.translate.instant("device-profile.import"),icon:"file_upload",isEnabled:()=>!0,onAction:n=>this.importDeviceProfile(n)}),e}addDeviceProfile(){this.dialog.open(Bf,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{deviceProfileName:null,transportType:null}}).afterClosed().subscribe(e=>{e&&this.config.updateData()})}setDefaultDeviceProfile(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("device-profile.set-default-device-profile-title",{deviceProfileName:n.name}),this.translate.instant("device-profile.set-default-device-profile-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.deviceProfileService.setDefaultDeviceProfile(n.id.id).subscribe(()=>{this.config.updateData()})})}openDeviceProfile(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["profiles","deviceProfiles",n.id.id]);this.router.navigateByUrl(t)}importDeviceProfile(e){this.importExport.importDeviceProfile().subscribe(n=>{n&&this.config.updateData()})}exportDeviceProfile(e,n){e&&e.stopPropagation(),this.importExport.exportDeviceProfile(n.id.id)}onDeviceProfileAction(e){switch(e.action){case"open":return this.openDeviceProfile(e.event,e.entity),!0;case"setDefault":return this.setDefaultDeviceProfile(e.event,e.entity),!0;case"export":return this.exportDeviceProfile(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(D(os),D(Fi),D(Z),D(ke),D(jt),D(pe),D(je),D(mi))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var Og=[{path:"deviceProfiles",data:{breadcrumb:{menuId:be.device_profiles}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN],title:"device-profile.device-profiles"},resolve:{entitiesTableConfig:Yp}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"mdi:alpha-d-box"},auth:[E.TENANT_ADMIN],title:"device-profile.device-profiles"},resolve:{entitiesTableConfig:Yp}}]}],Kd=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[Yp]})}}return i})();var Kp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,Kd]})}}return i})();(function(){Q(Kp,{declarations:[Qp],imports:[ne,oe,ve,Kd]})})();C();C();var cI="/assets/dashboard/api_usage.json",uI=(i,m,e=qt(pa))=>e.loadJsonResource(cI),fI=[{path:"usage",component:Ps,data:{auth:[E.TENANT_ADMIN],title:"api-usage.api-usage",breadcrumb:{menuId:be.api_usage}},resolve:{dashboard:uI}}],Xp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[B.forChild(fI),B]})}}return i})();(function(){Q(Xp,{imports:[B],exports:[B]})})();var Zp=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,Xp]})}}return i})();(function(){Q(Zp,{imports:[ne,oe,ve,Xp]})})();C();C();var gI=[{path:"edgeManagement",data:{breadcrumb:{menuId:be.edge_management}},children:[{path:"",children:[],data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],redirectTo:"/edgeManagement/instances"}},{path:"instances",data:{breadcrumb:{menuId:be.edges}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.edge-instances",edgesType:"tenant"},resolve:{entitiesTableConfig:Fo}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"router"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.edge-instances",edgesType:"tenant"},resolve:{entitiesTableConfig:Fo}},{path:":edgeId/assets",data:{breadcrumb:{label:"edge.assets",icon:"domain"}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.assets",assetsType:"edge"},resolve:{entitiesTableConfig:Bn}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"domain"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.assets",assetsType:"edge"},resolve:{entitiesTableConfig:Bn}}]},{path:":edgeId/devices",data:{breadcrumb:{label:"edge.devices",icon:"devices_other"}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.devices",devicesType:"edge"},resolve:{entitiesTableConfig:Rn}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"devices_other"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.devices",devicesType:"edge"},resolve:{entitiesTableConfig:Rn}}]},{path:":edgeId/entityViews",data:{breadcrumb:{label:"edge.entity-views",icon:"view_quilt"}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.entity-views",entityViewsType:"edge"},resolve:{entitiesTableConfig:Ao}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"devices_other"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.entity-views",entityViewsType:"edge"},resolve:{entitiesTableConfig:Ao}}]},{path:":edgeId/dashboards",data:{breadcrumb:{label:"edge.dashboards",icon:"dashboard"}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],dashboardsType:"edge"},resolve:{entitiesTableConfig:Fs}},{path:":dashboardId",component:Ma,canDeactivate:[xe],data:{breadcrumb:{labelFunction:Ns,icon:"dashboard"},auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"edge.dashboard",widgetEditMode:!1},resolve:{dashboard:As}}]},{path:":edgeId/ruleChains",data:{breadcrumb:{label:"edge.rulechains",icon:"settings_ethernet"}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN],title:"edge.rulechains",ruleChainsType:"edge"},resolve:{entitiesTableConfig:Ua}},{path:":ruleChainId",component:yo,canDeactivate:[xe],data:{breadcrumb:{labelFunction:Lp,icon:"settings_ethernet"},auth:[E.TENANT_ADMIN],title:"rulechain.edge-rulechain",import:!1,ruleChainType:Ti.EDGE},loadChildren:()=>import("./chunk-VWE3O37M.js").then(i=>i.RuleChainPageModule),resolve:{ruleChain:ur,ruleChainMetaData:fr,ruleNodeComponents:No,tooltipster:ko}}]}]},{path:"ruleChains",data:{breadcrumb:{menuId:be.rulechain_templates}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN],title:"edge.rulechain-templates",ruleChainsType:"edges"},resolve:{entitiesTableConfig:Ua}},{path:":ruleChainId",component:yo,canDeactivate:[xe],data:{breadcrumb:{labelFunction:Lp,icon:"settings_ethernet"},auth:[E.TENANT_ADMIN],title:"rulechain.edge-rulechain",import:!1,ruleChainType:Ti.EDGE},loadChildren:()=>import("./chunk-VWE3O37M.js").then(i=>i.RuleChainPageModule),resolve:{ruleChain:ur,ruleChainMetaData:fr,ruleNodeComponents:No,tooltipster:ko}},{path:"ruleChain/import",component:yo,canActivate:[jp],canDeactivate:[xe],data:{breadcrumb:{labelFunction:Qd,icon:"settings_ethernet"},auth:[E.TENANT_ADMIN],title:"rulechain.edge-rulechain",import:!0,ruleChainType:Ti.EDGE},loadChildren:()=>import("./chunk-VWE3O37M.js").then(i=>i.RuleChainPageModule),resolve:{ruleNodeComponents:No,tooltipster:ko}}]}]},{path:"edgeInstances",pathMatch:"full",redirectTo:"/edgeManagement/instances"},{path:"edgeInstances/:entityId",pathMatch:"full",redirectTo:"/edgeManagement/instances/:entityId"},{path:"edgeInstances/:edgeId/assets",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/assets"},{path:"edgeInstances/:edgeId/assets/:entityId",redirectTo:"/edgeManagement/instances/:edgeId/assets/:entityId"},{path:"edgeInstances/:edgeId/devices",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/devices"},{path:"edgeInstances/:edgeId/devices/:entityId",redirectTo:"/edgeManagement/instances/:edgeId/devices/:entityId"},{path:"edgeInstances/:edgeId/entityViews",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/entityViews"},{path:"edgeInstances/:edgeId/entityViews/:entityId",redirectTo:"/edgeManagement/instances/:edgeId/entityViews/:entityId"},{path:"edgeInstances/:edgeId/dashboards",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/dashboards"},{path:"edgeInstances/:edgeId/dashboards/:dashboardId",redirectTo:"/edgeManagement/instances/:edgeId/dashboards/:dashboardId"},{path:"edgeInstances/:edgeId/ruleChains",pathMatch:"full",redirectTo:"/edgeManagement/instances/:edgeId/ruleChains"},{path:"edgeInstances/:edgeId/ruleChains/:ruleChainId",redirectTo:"/edgeManagement/instances/:edgeId/ruleChains/:ruleChainId"}],em=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[Fo],imports:[B.forChild(gI),B]})}}return i})();(function(){Q(em,{imports:[B],exports:[B]})})();var tm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,_i,ve,em]})}}return i})();(function(){Q(tm,{declarations:[yp,_p,Cp,Sp],imports:[ne,oe,_i,ve,em]})})();C();C();C();C();function hI(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"ota-update.title-required")," "))}function bI(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"ota-update.title-max-length")," "))}function vI(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"ota-update.version-required")," "))}function yI(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"ota-update.version-max-length")," "))}function _I(i,m){i&1&&(r(0,"mat-hint",5),p(1,"ota-update.version-tag-hint"),a())}function CI(i,m){if(i&1&&(r(0,"mat-option",25),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.otaUpdateTypeTranslationMap.get(e))," ")}}function SI(i,m){i&1&&(r(0,"section")(1,"div",26),p(2,"ota-update.warning-after-save-no-edit"),a(),r(3,"mat-radio-group",27)(4,"mat-radio-button",25),p(5),d(6,"translate"),a(),r(7,"mat-radio-button",25),p(8),d(9,"translate"),a()()()),i&2&&(o(4),s("value",!1),o(),O(c(6,4,"ota-update.upload-binary-file")),o(2),s("value",!0),o(),O(c(9,6,"ota-update.use-external-url")))}function TI(i,m){if(i&1&&(r(0,"section"),f(1,"tb-file-input",29),d(2,"translate"),d(3,"translate"),r(4,"mat-checkbox",30),p(5),d(6,"translate"),a()()),i&2){let e=v(2);o(),T("label",c(2,4,"ota-update.package-file")),T("dropLabel",c(3,6,"ota-update.drop-package-file-or")),s("required",!e.entityForm.get("isURL").value),o(4),h(" ",c(6,8,"ota-update.auto-generate-checksum")," ")}}function xI(i,m){if(i&1&&(r(0,"mat-option",25),p(1),a()),i&2){let e=m.$implicit,n=v(3);s("value",e),o(),h(" ",n.checksumAlgorithmTranslationMap.get(e)," ")}}function EI(i,m){i&1&&(r(0,"mat-hint",5),p(1,"ota-update.checksum-hint"),a())}function II(i,m){if(i&1&&(r(0,"div",31)(1,"mat-form-field",32)(2,"mat-label",5),p(3,"ota-update.checksum-algorithm"),a(),r(4,"mat-select",33),b(5,xI,2,2,"mat-option",21),a()(),r(6,"mat-form-field",13)(7,"mat-label",5),p(8,"ota-update.checksum"),a(),f(9,"input",34),b(10,EI,2,0,"mat-hint",17),a()()),i&2){let e=v(2);o(5),s("ngForOf",e.checksumAlgorithms),o(5),s("ngIf",e.isAdd)}}function MI(i,m){i&1&&(r(0,"section")(1,"div",35)(2,"mat-form-field",32)(3,"mat-label",5),p(4,"ota-update.file-name"),a(),f(5,"input",36),a(),r(6,"mat-form-field",13)(7,"mat-label",5),p(8,"ota-update.file-size-bytes"),a(),f(9,"input",37),a(),r(10,"mat-form-field",13)(11,"mat-label",5),p(12,"ota-update.content-type"),a(),f(13,"input",38),a()()())}function wI(i,m){if(i&1&&(r(0,"section"),b(1,TI,7,10,"section",12)(2,II,11,2,"div",28)(3,MI,14,0,"section",12),a()),i&2){let e=v();o(),s("ngIf",e.isAdd),o(),s("ngIf",!(e.isAdd&&e.entityForm.get("generateChecksum").value)),o(),s("ngIf",!e.isAdd)}}function DI(i,m){i&1&&(r(0,"mat-error",5),p(1," ota-update.direct-url-required "),a())}function PI(i,m){if(i&1&&(r(0,"section",39)(1,"mat-form-field",19)(2,"mat-label",5),p(3,"ota-update.direct-url"),a(),f(4,"input",40),b(5,DI,2,0,"mat-error",17),a()()),i&2){let e=v();o(4),s("required",e.entityForm.get("isURL").value),o(),s("ngIf",e.entityForm.get("url").hasError("required")||e.entityForm.get("url").hasError("pattern"))}}var im=(()=>{class i extends Bt{constructor(e,n,t,l,u,y){super(e,u,t,l,y),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.fb=u,this.cd=y,this.destroy$=new At,this.checksumAlgorithms=Object.values(dd),this.checksumAlgorithmTranslationMap=is,this.packageTypes=Object.values(Ya),this.otaUpdateTypeTranslationMap=ns}ngOnInit(){super.ngOnInit(),this.isAdd&&(this.entityForm.get("isURL").valueChanges.pipe(lt(this.destroy$)).subscribe(e=>{e===!1?(this.entityForm.get("url").clearValidators(),this.entityForm.get("file").setValidators(S.required),this.entityForm.get("url").updateValueAndValidity({emitEvent:!1}),this.entityForm.get("file").updateValueAndValidity({emitEvent:!1})):(this.entityForm.get("file").clearValidators(),this.entityForm.get("url").setValidators([S.required,S.pattern("(.|\\s)*\\S(.|\\s)*")]),this.entityForm.get("file").updateValueAndValidity({emitEvent:!1}),this.entityForm.get("url").updateValueAndValidity({emitEvent:!1}))}),sc([this.entityForm.get("title").valueChanges.pipe(ho("")),this.entityForm.get("version").valueChanges.pipe(ho(""))]).pipe(pc(()=>this.entityForm.get("tag").pristine),lt(this.destroy$)).subscribe(([e,n])=>{let t=`${e} ${n}`.trim();this.entityForm.get("tag").patchValue(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}hideDelete(){return this.entitiesTableConfig?!this.entitiesTableConfig.deleteEnabled(this.entity):!1}buildForm(e){let n=this.fb.group({title:[e?e.title:"",[S.required,S.maxLength(255)]],version:[e?e.version:"",[S.required,S.maxLength(255)]],tag:[e?e.tag:"",[S.maxLength(255)]],type:[e?.type?e.type:Ya.FIRMWARE,S.required],deviceProfileId:[e?e.deviceProfileId:null,S.required],checksumAlgorithm:[e&&e.checksumAlgorithm?e.checksumAlgorithm:dd.SHA256],checksum:[e?e.checksum:"",S.maxLength(1020)],url:[e?e.url:""],isURL:[!1],additionalInfo:this.fb.group({description:[e&&e.additionalInfo?e.additionalInfo.description:""]})});return this.isAdd?(n.addControl("file",this.fb.control(null,S.required)),n.addControl("generateChecksum",this.fb.control(!0))):(n.addControl("fileName",this.fb.control(null)),n.addControl("dataSize",this.fb.control(null)),n.addControl("contentType",this.fb.control(null))),n}updateForm(e){this.entityForm.patchValue({title:e.title,version:e.version,tag:e.tag,type:e.type,deviceProfileId:e.deviceProfileId,checksumAlgorithm:e.checksumAlgorithm,checksum:e.checksum,fileName:e.fileName,dataSize:e.dataSize,contentType:e.contentType,url:e.url,isURL:$o(e.url),additionalInfo:{description:e.additionalInfo?e.additionalInfo.description:""}}),!this.isAdd&&this.entityForm.enabled&&(this.entityForm.disable({emitEvent:!1}),this.entityForm.get("additionalInfo").enable({emitEvent:!1}))}onPackageIdCopied(){this.store.dispatch(new Be({message:this.translate.instant("ota-update.idCopiedMessage"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onPackageChecksumCopied(){this.store.dispatch(new Be({message:this.translate.instant("ota-update.checksum-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}onPackageDirectUrlCopied(){this.store.dispatch(new Be({message:this.translate.instant("ota-update.checksum-copied-message"),type:"success",duration:750,verticalPosition:"bottom",horizontalPosition:"right"}))}prepareFormValue(e){return e.isURL?delete e.file:delete e.url,delete e.generateChecksum,super.prepareFormValue(e)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g("entity"),g("entitiesTableConfig"),g(de),g(Qe))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-ota-update"]],features:[L],decls:62,vars:57,consts:[[1,"tb-details-buttons","xs:flex","xs:flex-col"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"flex","flex-row","xs:flex-col"],["mat-raised-button","","ngxClipboard","",3,"cbOnSuccess","cbContent"],["svgIcon","mdi:clipboard-arrow-left"],["translate",""],[1,"mat-padding","flex","flex-col","gap-2"],[3,"formGroup"],[1,"flex","flex-col",3,"disabled"],[1,"flex","flex-row","xs:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-full","gt-xs:max-w-45%"],["matInput","","formControlName","title","type","text","required","",3,"readonly"],[4,"ngIf"],[1,"mat-block","flex-1"],["matInput","","formControlName","version","type","text","required","",3,"readonly"],[1,"mat-block","flex-1",2,"margin-bottom","8px"],["matInput","","formControlName","tag","type","text",3,"readonly"],["translate","",4,"ngIf"],["formControlName","deviceProfileId","required","",3,"hint","editProfileEnabled","addNewProfile","showDetailsPageLink"],[1,"mat-block"],["formControlName","type","required",""],[3,"value",4,"ngFor","ngForOf"],["style","margin-top: 8px",4,"ngIf"],["formGroupName","additionalInfo"],["matInput","","formControlName","description","rows","2"],[3,"value"],["translate","",1,"mat-caption",2,"margin","-8px 0 8px"],["formControlName","isURL",1,"gap-4"],["class","flex flex-row xs:flex-col sm:gap-2 md:flex-col gt-xs:gap-2",4,"ngIf"],["formControlName","file","workFromFileObj","true",3,"label","required","dropLabel"],["formControlName","generateChecksum",2,"margin-top","16px"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-xs:gap-2"],[1,"mat-block","flex-full","gt-xs:max-w-33%"],["formControlName","checksumAlgorithm"],["matInput","","formControlName","checksum","type","text"],[1,"flex","flex-row","xs:flex-col","sm:gap-2","md:flex-col","gt-md:gap-2"],["matInput","","formControlName","fileName","type","text"],["matInput","","formControlName","dataSize","type","text"],["matInput","","formControlName","contentType","type","text"],[2,"margin-top","8px"],["matInput","","formControlName","url","type","text",3,"required"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"button",1),d(2,"async"),_("click",function(u){return t.onEntityAction(u,"open")}),p(3),d(4,"translate"),a(),r(5,"button",1),d(6,"async"),_("click",function(u){return t.onEntityAction(u,"uploadPackage")}),p(7),d(8,"translate"),a(),r(9,"button",1),d(10,"async"),_("click",function(u){return t.onEntityAction(u,"delete")}),p(11),d(12,"translate"),a(),r(13,"div",2)(14,"button",3),_("cbOnSuccess",function(){return t.onPackageIdCopied()}),f(15,"mat-icon",4),r(16,"span",5),p(17,"ota-update.copyId"),a()(),r(18,"button",3),_("cbOnSuccess",function(){return t.onPackageChecksumCopied()}),f(19,"mat-icon",4),r(20,"span",5),p(21,"ota-update.copy-checksum"),a()(),r(22,"button",3),_("cbOnSuccess",function(){return t.onPackageDirectUrlCopied()}),f(23,"mat-icon",4),r(24,"span",5),p(25,"ota-update.copy-direct-url"),a()()()(),r(26,"div",6)(27,"form",7)(28,"fieldset",8),d(29,"async"),r(30,"div",9)(31,"mat-form-field",10)(32,"mat-label",5),p(33,"ota-update.title"),a(),f(34,"input",11),b(35,hI,3,3,"mat-error",12)(36,bI,3,3,"mat-error",12),a(),r(37,"mat-form-field",13)(38,"mat-label",5),p(39,"ota-update.version"),a(),f(40,"input",14),b(41,vI,3,3,"mat-error",12)(42,yI,3,3,"mat-error",12),a()(),r(43,"mat-form-field",15)(44,"mat-label",5),p(45,"ota-update.version-tag"),a(),f(46,"input",16),b(47,_I,2,0,"mat-hint",17),a(),f(48,"tb-device-profile-autocomplete",18),r(49,"mat-form-field",19)(50,"mat-label",5),p(51,"ota-update.package-type"),a(),r(52,"mat-select",20),b(53,CI,3,4,"mat-option",21),a()(),b(54,SI,10,8,"section",12)(55,wI,4,3,"section",12)(56,PI,6,2,"section",22),r(57,"div",23)(58,"mat-form-field",19)(59,"mat-label",5),p(60,"ota-update.description"),a(),f(61,"textarea",24),a()()()()()),n&2&&(o(),V("!hidden",t.isEdit||t.isDetailsPage),s("disabled",c(2,43,t.isLoading$)),o(2),h(" ",c(4,45,"common.open-details-page")," "),o(2),V("!hidden",t.isEdit),s("disabled",c(6,47,t.isLoading$)||!(t.entity!=null&&t.entity.hasData&&!(t.entity!=null&&t.entity.url))),o(2),h(" ",c(8,49,"ota-update.download")," "),o(2),V("!hidden",t.hideDelete()||t.isEdit),s("disabled",c(10,51,t.isLoading$)),o(2),h(" ",c(12,53,"ota-update.delete")," "),o(3),V("!hidden",t.isEdit),s("cbContent",t.entity==null||t.entity.id==null?null:t.entity.id.id),o(4),V("!hidden",t.isEdit||!(t.entity!=null&&t.entity.checksum)),s("cbContent",t.entity==null?null:t.entity.checksum),o(4),V("!hidden",t.isEdit||!(t.entity!=null&&t.entity.url)),s("cbContent",t.entity==null?null:t.entity.url),o(5),s("formGroup",t.entityForm),o(),s("disabled",c(29,55,t.isLoading$)||!t.isEdit),o(6),s("readonly",!t.isAdd),o(),s("ngIf",t.entityForm.get("title").hasError("required")),o(),s("ngIf",t.entityForm.get("title").hasError("maxlength")),o(4),s("readonly",!t.isAdd),o(),s("ngIf",t.entityForm.get("version").hasError("required")),o(),s("ngIf",t.entityForm.get("version").hasError("maxlength")),o(4),s("readonly",!t.isAdd),o(),s("ngIf",t.isAdd),o(),V("pb-4",t.isAdd)("pb-0",!t.isAdd),s("hint","ota-update.chose-compatible-device-profile")("editProfileEnabled",!1)("addNewProfile",!1)("showDetailsPageLink",!0),o(5),s("ngForOf",t.packageTypes),o(),s("ngIf",t.isAdd),o(),s("ngIf",!t.entityForm.get("isURL").value),o(),s("ngIf",t.entityForm.get("isURL").value))},dependencies:[Te,G,ee,$t,ae,he,me,Ce,Kt,Pe,vt,gt,bu,vu,Jt,ce,ge,W,K,ue,ie,se,bt,oo,J,Ms,le,R],encapsulation:2})}}return i})();var nm=(()=>{class i{constructor(e,n,t,l,u,y){this.translate=e,this.datePipe=n,this.store=t,this.otaPackageService=l,this.router=u,this.fileSize=y,this.config=new Ge,this.config.entityType=k.OTA_PACKAGE,this.config.entityComponent=im,this.config.entityTranslations=Ue.get(k.OTA_PACKAGE),this.config.entityResources=tt.get(k.OTA_PACKAGE),this.config.entityTitle=w=>w?w.title:"",this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("title","ota-update.title","15%"),new Y("version","ota-update.version","15%"),new Y("tag","ota-update.version-tag","15%"),new Y("type","ota-update.package-type","15%",w=>this.translate.instant(ns.get(w.type))),new Y("url","ota-update.direct-url","20%",w=>w.url?w.url.length>20?`${w.url.slice(0,20)}\u2026`:w.url:"",()=>({}),!0,()=>({}),()=>{},!1,{name:this.translate.instant("ota-update.copy-direct-url"),icon:"content_paste",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.87)"},isEnabled:w=>!!w.url,onAction:(w,x)=>x.url,type:fa.COPY_BUTTON}),new Y("fileName","ota-update.file-name","20%"),new Y("dataSize","ota-update.file-size","70px",w=>w.dataSize?this.fileSize.transform(w.dataSize):""),new Y("checksum","ota-update.checksum","220px",w=>w.checksum?this.checksumText(w):"",()=>({}),!0,()=>({}),()=>{},!1,{name:this.translate.instant("ota-update.copy-checksum"),icon:"content_paste",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.87)"},isEnabled:w=>!!w.checksum,onAction:(w,x)=>x.checksum,type:fa.COPY_BUTTON})),this.config.cellActionDescriptors.push({name:this.translate.instant("ota-update.download"),icon:"file_download",isEnabled:w=>w.hasData&&!w.url,onAction:(w,x)=>this.exportPackage(w,x)}),this.config.deleteEntityTitle=w=>this.translate.instant("ota-update.delete-ota-update-title",{title:w.title}),this.config.deleteEntityContent=()=>this.translate.instant("ota-update.delete-ota-update-text"),this.config.deleteEntitiesTitle=w=>this.translate.instant("ota-update.delete-ota-updates-title",{count:w}),this.config.deleteEntitiesContent=()=>this.translate.instant("ota-update.delete-ota-updates-text"),this.config.entitiesFetchFunction=w=>this.otaPackageService.getOtaPackages(w),this.config.loadEntity=w=>this.otaPackageService.getOtaPackageInfo(w.id),this.config.saveEntity=w=>this.otaPackageService.saveOtaPackage(w),this.config.deleteEntity=w=>this.otaPackageService.deleteOtaPackage(w.id),this.config.onEntityAction=w=>this.onPackageAction(w)}resolve(){return this.config.tableTitle=this.translate.instant("ota-update.packages-repository"),this.config}openOtaPackage(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["otaUpdates",n.id.id]);this.router.navigateByUrl(t)}exportPackage(e,n){e&&e.stopPropagation(),n.url?window.open(n.url,"_blank"):this.otaPackageService.downloadOtaPackage(n.id.id).subscribe()}checksumText(e){let n=`${is.get(e.checksumAlgorithm)}: ${e.checksum}`;return n.length>20&&(n=`${n.slice(0,20)}\u2026`),n}onPackageAction(e){switch(e.action){case"open":return this.openOtaPackage(e.event,e.entity),!0;case"uploadPackage":return this.exportPackage(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(D(Z),D(ke),D(F),D(Ku),D(pe),D(_0))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var Rg=[{path:"otaUpdates",data:{breadcrumb:{menuId:be.otaUpdates}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN],title:"ota-update.ota-updates"},resolve:{entitiesTableConfig:nm}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"memory"},auth:[E.TENANT_ADMIN],title:"ota-update.ota-updates"},resolve:{entitiesTableConfig:nm}}]}],FI=[{path:"otaUpdates",pathMatch:"full",redirectTo:"/features/otaUpdates"},{path:"otaUpdates/:entityId",redirectTo:"/features/otaUpdates/:entityId"}],om=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[nm],imports:[B.forChild(FI),B]})}}return i})();(function(){Q(om,{imports:[B],exports:[B]})})();var am=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,om]})}}return i})();(function(){Q(am,{declarations:[im],imports:[ne,oe,ve,om]})})();C();C();var Bg=[{path:"vc",component:ai,canDeactivate:[xe],data:{auth:[E.TENANT_ADMIN],title:"version-control.version-control",breadcrumb:{menuId:be.version_control}}}],AI=[{path:"vc",redirectTo:"/features/vc"}],rm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[B.forChild(AI),B]})}}return i})();(function(){Q(rm,{imports:[B],exports:[B]})})();var sm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,rm]})}}return i})();(function(){Q(sm,{imports:[ne,oe,rm]})})();C();C();function NI(i,m){if(i&1&&(r(0,"mat-tab",4,0),d(2,"translate"),f(3,"tb-calculated-fields-table",5),a()),i&2){let e=U(1),n=v();T("label",c(2,4,"entity.type-calculated-fields")),o(3),s("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)}}function kI(i,m){if(i&1&&(r(0,"mat-tab",4,1),d(2,"translate"),f(3,"tb-audit-log-table",6),a()),i&2){let e=U(1),n=v();T("label",c(2,4,"audit-log.audit-logs")),o(3),s("active",e.isActive)("auditLogMode",n.auditLogModes.ENTITY)("entityId",n.entity.id)}}function OI(i,m){if(i&1){let e=j();r(0,"mat-tab",4,2),d(2,"translate"),r(3,"tb-version-control",7),_("versionRestored",function(){I(e);let t=v();return M(t.entitiesTableConfig.updateData())}),a()()}if(i&2){let e=U(1),n=v();T("label",c(2,5,"version-control.version-control")),o(3),s("active",e.isActive)("entityId",n.entity.id)("entityName",n.entity.name)("externalEntityId",n.entity.externalId||n.entity.id)}}var lm=(()=>{class i extends Lt{constructor(e){super(e),this.store=e}ngOnInit(){super.ngOnInit()}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-asset-profile-tabs"]],features:[L],decls:3,vars:3,consts:[["calculatedFieldsTab","matTab"],["auditLogsTab","matTab"],["versionControlTab","matTab"],[3,"label",4,"ngIf"],[3,"label"],[3,"active","entityId","entityName"],["detailsMode","true",3,"active","auditLogMode","entityId"],["detailsMode","true","singleEntityMode","true",3,"versionRestored","active","entityId","entityName","externalEntityId"]],template:function(n,t){n&1&&b(0,NI,4,6,"mat-tab",3)(1,kI,4,6,"mat-tab",3)(2,OI,4,7,"mat-tab",3),n&2&&(s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN&&!t.isEdit),o(),s("ngIf",t.entity&&!t.isEdit),o(),s("ngIf",t.entity&&t.authUser.authority===t.authorities.TENANT_ADMIN&&!t.isEdit))},dependencies:[G,St,ri,ai,mo,R],encapsulation:2})}}return i})();C();C();var pm=(()=>{class i{constructor(e,n,t,l,u,y,w){this.assetProfileService=e,this.importExport=n,this.translate=t,this.datePipe=l,this.dialogService=u,this.router=y,this.customTranslate=w,this.config=new Ge,this.config.entityType=k.ASSET_PROFILE,this.config.entityComponent=Uf,this.config.entityTabsComponent=lm,this.config.entityTranslations=Ue.get(k.ASSET_PROFILE),this.config.entityResources=tt.get(k.ASSET_PROFILE),this.config.hideDetailsTabsOnEdit=!1,this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"150px"),new Y("name","asset-profile.name","50%"),new Y("description","asset-profile.description","50%",x=>this.customTranslate.transform(x.description||"")),new Y("isDefault","asset-profile.default","60px",x=>Ft(x.default))),this.config.cellActionDescriptors.push({name:this.translate.instant("asset-profile.export"),icon:"file_download",isEnabled:()=>!0,onAction:(x,q)=>this.exportAssetProfile(x,q)},{name:this.translate.instant("asset-profile.set-default"),icon:"flag",isEnabled:x=>!x.default,onAction:(x,q)=>this.setDefaultAssetProfile(x,q)}),this.config.deleteEntityTitle=x=>this.translate.instant("asset-profile.delete-asset-profile-title",{assetProfileName:x.name}),this.config.deleteEntityContent=()=>this.translate.instant("asset-profile.delete-asset-profile-text"),this.config.deleteEntitiesTitle=x=>this.translate.instant("asset-profile.delete-asset-profiles-title",{count:x}),this.config.deleteEntitiesContent=()=>this.translate.instant("asset-profile.delete-asset-profiles-text"),this.config.entitiesFetchFunction=x=>this.assetProfileService.getAssetProfiles(x),this.config.loadEntity=x=>this.assetProfileService.getAssetProfile(x.id),this.config.saveEntity=x=>this.assetProfileService.saveAssetProfile(x),this.config.deleteEntity=x=>this.assetProfileService.deleteAssetProfile(x.id),this.config.onEntityAction=x=>this.onAssetProfileAction(x),this.config.deleteEnabled=x=>x&&!x.default,this.config.entitySelectionEnabled=x=>x&&!x.default,this.config.addActionDescriptors=this.configureAddActions()}resolve(){return this.config.tableTitle=this.translate.instant("asset-profile.asset-profiles"),this.config}configureAddActions(){let e=[];return e.push({name:this.translate.instant("asset-profile.create-asset-profile"),icon:"insert_drive_file",isEnabled:()=>!0,onAction:n=>this.config.getTable().addEntity(n)},{name:this.translate.instant("asset-profile.import"),icon:"file_upload",isEnabled:()=>!0,onAction:n=>this.importAssetProfile(n)}),e}setDefaultAssetProfile(e,n){e&&e.stopPropagation(),this.dialogService.confirm(this.translate.instant("asset-profile.set-default-asset-profile-title",{assetProfileName:n.name}),this.translate.instant("asset-profile.set-default-asset-profile-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(t=>{t&&this.assetProfileService.setDefaultAssetProfile(n.id.id).subscribe(()=>{this.config.updateData()})})}openAssetProfile(e,n){e&&e.stopPropagation();let t=this.router.createUrlTree(["profiles","assetProfiles",n.id.id]);this.router.navigateByUrl(t)}importAssetProfile(e){this.importExport.importAssetProfile().subscribe(n=>{n&&this.config.updateData()})}exportAssetProfile(e,n){e&&e.stopPropagation(),this.importExport.exportAssetProfile(n.id.id)}onAssetProfileAction(e){switch(e.action){case"open":return this.openAssetProfile(e.event,e.entity),!0;case"setDefault":return this.setDefaultAssetProfile(e.event,e.entity),!0;case"export":return this.exportAssetProfile(e.event,e.entity),!0}return!1}static{this.\u0275fac=function(n){return new(n||i)(D(n0),D(Fi),D(Z),D(ke),D(jt),D(pe),D(mi))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var Vg=[{path:"assetProfiles",data:{breadcrumb:{menuId:be.asset_profiles}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN],title:"asset-profile.asset-profiles"},resolve:{entitiesTableConfig:pm}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"mdi:alpha-a-box"},auth:[E.TENANT_ADMIN],title:"asset-profile.asset-profiles"},resolve:{entitiesTableConfig:pm}}]}],Xd=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[pm]})}}return i})();var mm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,Xd]})}}return i})();(function(){Q(mm,{declarations:[lm],imports:[ne,oe,ve,Xd]})})();C();C();var RI=[{path:"profiles",data:{auth:[E.TENANT_ADMIN],breadcrumb:{menuId:be.profiles}},children:[{path:"",children:[],data:{auth:[E.TENANT_ADMIN],redirectTo:"/profiles/deviceProfiles"}},...Og,...Vg]}],dm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[B.forChild(RI),B]})}}return i})();(function(){Q(dm,{imports:[B],exports:[B]})})();var cm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,dm]})}}return i})();(function(){Q(cm,{imports:[ne,oe,dm]})})();C();C();var BI=[{path:"alarms",component:vi,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],title:"alarm.alarms",breadcrumb:{menuId:be.alarms},isPage:!0,alarmsMode:Wc.ALL}}],um=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[B.forChild(BI),B]})}}return i})();(function(){Q(um,{imports:[B],exports:[B]})})();var fm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,_i,um]})}}return i})();(function(){Q(fm,{imports:[ne,oe,ve,_i,um]})})();C();C();C();var VI="/api/resource/dashboard/system/gateways_dashboard.json",jI=(i,m,e=qt(pa))=>e.loadJsonResource(VI),jg=[{path:"gateways",component:Ps,data:{auth:[E.TENANT_ADMIN],title:"gateway.gateways",breadcrumb:{menuId:be.gateways}},resolve:{dashboard:jI}}],LI=[{path:"gateways",pathMatch:"full",redirectTo:"/entities/gateways"}],gm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[B.forChild(LI),B]})}}return i})();(function(){Q(gm,{imports:[B],exports:[B]})})();var GI=[{path:"entities",data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],breadcrumb:{skip:!0}},children:[{path:"",children:[],data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER],redirectTo:"/entities/devices"}},...Ag,...Ng,...kg,...jg]}],hm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[B.forChild(GI),B]})}}return i})();(function(){Q(hm,{imports:[B],exports:[B]})})();var bm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,hm]})}}return i})();(function(){Q(bm,{imports:[ne,oe,hm]})})();C();C();var UI=[{path:"features",data:{auth:[E.TENANT_ADMIN],breadcrumb:{menuId:be.features}},children:[{path:"",children:[],data:{auth:[E.TENANT_ADMIN],redirectTo:"/features/otaUpdates"}},...Rg,...Bg]}],vm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[B.forChild(UI),B]})}}return i})();(function(){Q(vm,{imports:[B],exports:[B]})})();var ym=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,vm]})}}return i})();(function(){Q(ym,{imports:[ne,oe,vm]})})();C();C();C();C();var _m=(()=>{class i extends oi{constructor(e){super(e),this.store=e}changeUnreadOnly(e){this.entitiesTableConfig.componentsData.unreadOnly=e,this.entitiesTableConfig.getTable().resetSortAndFilter(!0)}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-inbox-table-header"]],features:[L],decls:8,vars:9,consts:[[1,"flex","flex-full","flex-row","items-center","justify-start"],["appearance","fill",1,"w-44",3,"ngModelChange","ngModel"],[3,"value"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"tb-toggle-select",1),_("ngModelChange",function(u){return t.changeUnreadOnly(u)}),r(2,"tb-toggle-option",2),p(3),d(4,"translate"),a(),r(5,"tb-toggle-option",2),p(6),d(7,"translate"),a()()()),n&2&&(o(),s("ngModel",t.entitiesTableConfig.componentsData.unreadOnly),o(),s("value",!0),o(),O(c(4,5,"notification.unread")),o(2),s("value",!1),o(),O(c(7,7,"notification.all")))},dependencies:[W,Ye,Di,Pi,R],encapsulation:2})}}return i})();C();var Cm=(()=>{class i extends nt{constructor(e,n,t,l){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.data=l,this.notification=l.notification}markAsRead(e){this.dialogRef.close(e)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(it),g(Ot))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-inbox-notification-dialog"]],features:[L],decls:1,vars:1,consts:[[3,"markAsRead","notification"]],template:function(n,t){n&1&&(r(0,"tb-notification",0),_("markAsRead",function(u){return t.markAsRead(u)}),a()),n&2&&s("notification",t.notification)},dependencies:[z0],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block;max-width:400px;min-width:350px;padding:2px}']})}}return i})();var Zd=(()=>{class i{constructor(e,n,t,l,u){this.notificationService=e,this.translate=n,this.dialog=t,this.datePipe=l,this.utilsService=u,this.config=new Ge,this.config.entityType=k.NOTIFICATION,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=Ue.get(k.NOTIFICATION),this.config.entityResources={},this.config.deleteEntityTitle=()=>this.translate.instant("notification.delete-notification-title"),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-notification-text"),this.config.deleteEntitiesTitle=y=>this.translate.instant("notification.delete-notifications-title",{count:y}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-notifications-text"),this.config.deleteEntity=y=>this.notificationService.deleteNotification(y.id),this.config.entitiesFetchFunction=y=>this.notificationService.getNotifications(y,this.config.componentsData.unreadOnly),this.config.defaultSortOrder={property:"createdTime",direction:Zt.DESC},this.config.handleRowClick=(y,w)=>(this.showNotification(y,w),!0),this.config.componentsData={unreadOnly:!0},this.config.cellActionDescriptors=this.configureCellActions(),this.config.headerComponent=_m,this.config.headerActionDescriptors=[{name:this.translate.instant("notification.mark-all-as-read"),icon:"done_all",isEnabled:()=>!0,onAction:y=>this.markAllRead(y)}],this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"170px"),new Y("type","notification.type","10%",y=>this.translate.instant(Ta.get(y.type).name)),new Y("subject","notification.subject","30%",y=>this.utilsService.customTranslation(y.subject,y.subject)),new Y("text","notification.message","60%",y=>this.utilsService.customTranslation(y.text,y.text)))}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("notification.mark-as-read"),icon:"check_circle_outline",isEnabled:e=>e.status!==_d.READ,onAction:(e,n)=>this.markAsRead(e,n)}]}markAllRead(e){e&&e.stopPropagation(),this.notificationService.markAllNotificationsAsRead().subscribe(()=>{this.config.componentsData.unreadOnly?this.config.getTable().resetSortAndFilter(!0):this.config.updateData()})}markAsRead(e,n){e&&e.stopPropagation(),this.notificationService.markNotificationAsRead(n.id.id).subscribe(()=>{this.config.componentsData.unreadOnly?this.config.getTable().dataSource.pageData$.pipe(ti(1)).subscribe(t=>{t.data.length===1&&this.config.getTable().pageLink.page?this.config.getTable().paginator.previousPage():this.config.updateData()}):(n.status=_d.READ,this.config.getTable().detectChanges())})}showNotification(e,n){e&&e.stopPropagation(),this.dialog.open(Cm,{disableClose:!1,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{notification:n}}).afterClosed().subscribe(t=>{t&&this.markAsRead(null,n)})}static{this.\u0275fac=function(n){return new(n||i)(D(bi),D(Z),D(je),D(ke),D(Gr))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();C();function qI(i,m){if(i&1&&(r(0,"tr")(1,"td")(2,"mat-chip"),p(3),a()(),r(4,"td",9),p(5),a()()),i&2){let e=m.$implicit;o(3),O(e.key),o(2),O(e.value)}}function WI(i,m){i&1&&f(0,"mat-divider")}function HI(i,m){if(i&1&&(r(0,"div")(1,"h6"),p(2),d(3,"translate"),a(),r(4,"table",7),b(5,qI,6,2,"tr",6),d(6,"keyvalue"),a(),b(7,WI,1,0,"mat-divider",8),a()),i&2){let e=m.$implicit,n=m.last,t=v();o(2),O(c(3,3,t.NotificationDeliveryMethodInfoMap.get(e.key).name)),o(3),s("ngForOf",c(6,5,e.value)),o(2),s("ngIf",!n)}}var Sm=(()=>{class i extends nt{constructor(e,n,t,l){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.data=l,this.NotificationDeliveryMethodInfoMap=Ca,this.errorStats=l.notificationRequest.stats.errors}cancel(){this.dialogRef.close(null)}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(it),g(Ot))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-notification-send-error-dialog"]],features:[L],decls:10,vars:3,consts:[["color","primary"],["translate",""],[1,"flex-1"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],[4,"ngFor","ngForOf"],[1,"tb-table-list"],[4,"ngIf"],[1,"tb-row-error"]],template:function(n,t){n&1&&(r(0,"mat-toolbar",0)(1,"h2",1),p(2,"notification.failed-send"),a(),f(3,"span",2),r(4,"button",3),_("click",function(){return t.cancel()}),r(5,"mat-icon",4),p(6,"close"),a()()(),r(7,"div",5),b(8,HI,8,7,"div",6),d(9,"keyvalue"),a()),n&2&&(o(8),s("ngForOf",c(9,1,t.errorStats)))},dependencies:[Te,G,Ee,ae,at,mt,mn,oa,J,xr,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block;width:600px;max-width:100%;color:#000000de}[_nghost-%COMP%]   h6[_ngcontent-%COMP%]{font-weight:500;font-size:16px;line-height:20px;margin-top:0}[_nghost-%COMP%]   .tb-table-list[_ngcontent-%COMP%]{table-layout:fixed;width:100%;border:hidden;border-collapse:collapse}[_nghost-%COMP%]   .tb-table-list[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:8px solid transparent;border-collapse:collapse;font-size:14px}[_nghost-%COMP%]   .tb-table-list[_ngcontent-%COMP%]   .tb-row-error[_ngcontent-%COMP%]{word-wrap:break-word}[_nghost-%COMP%]   .mat-divider[_ngcontent-%COMP%]{margin:24px 0}']})}}return i})();var ec=(()=>{class i{constructor(e,n,t,l){this.notificationService=e,this.translate=n,this.dialog=t,this.datePipe=l,this.config=new Ge,this.config.entityType=k.NOTIFICATION_REQUEST,this.config.detailsPanelEnabled=!1,this.config.addEnabled=!1,this.config.searchEnabled=!1,this.config.entityTranslations=Ue.get(k.NOTIFICATION_REQUEST),this.config.entityResources={},this.config.deleteEntityTitle=()=>this.translate.instant("notification.delete-request-title"),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-request-text"),this.config.deleteEntitiesTitle=u=>this.translate.instant("notification.delete-requests-title",{count:u}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-requests-text"),this.config.deleteEntity=u=>this.notificationService.deleteNotificationRequest(u.id),this.config.entitiesFetchFunction=u=>this.notificationService.getNotificationRequests(u),this.config.cellActionDescriptors=this.configureCellActions(),this.config.onEntityAction=u=>this.onRequestAction(u),this.config.handleRowClick=(u,y)=>((u.target.getElementsByClassName("stats").length||u.target.className==="stats")&&this.openStatsErrorDialog(u,y),!0),this.config.defaultSortOrder={property:"createdTime",direction:Zt.DESC},this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"170px"),new Y("status","notification.status","15%",u=>`<span style="display: flex;">${this.requestStatus(u.status)}${this.requestStats(u.stats)}</span>`,u=>this.requestStatusStyle(u.status)),new Y("deliveryMethods","notification.delivery-method.delivery-method","15%",u=>u.deliveryMethods.map(y=>this.translate.instant(Ca.get(y).name)).join(", "),()=>({}),!1),new Y("templateName","notification.template","70%"))}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("notification.notify-again"),icon:"mdi:repeat-variant",isEnabled:e=>e.status!==Sa.SCHEDULED,onAction:(e,n)=>this.createRequest(e,n)}]}createRequest(e,n,t=!1,l=!0){e&&e.stopPropagation(),this.dialog.open(Ds,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:t,request:n}}).afterClosed().subscribe(u=>{u&&l&&this.config.updateData()})}onRequestAction(e){switch(e.action){case"add":return this.createRequest(e.event,e.entity,!0),!0;case"add-without-update":return this.createRequest(e.event,e.entity,!0,!1),!0}return!1}requestStatus(e){let n=W0.get(e),t="rgba(25, 128, 56, 0.08)";switch(e){case Sa.SCHEDULED:t="rgba(48, 86, 128, 0.08)";break;case Sa.PROCESSING:t="rgba(212, 125, 24, 0.08)";break}return`<div style="border-radius: 12px; height: 24px; line-height: 24px; padding: 0 10px;
                        width: fit-content; background-color: ${t}">
                ${this.translate.instant(n)}
            </div>`}requestStats(e){if(!e?.errors)return"";let n=e.totalErrors;return n===0?"":`<div style="border-radius: 12px; height: 24px; line-height: 24px; padding: 0 10px; width: max-content; cursor: pointer;
                        background-color: #D12730; color: #fff; font-weight: 500; margin-left: 8px" class="stats">
                ${this.translate.instant("notification.fails",{count:n})} >
            </div>`}requestStatusStyle(e){let n={fontSize:"14px",color:"#198038"};switch(e){case Sa.SCHEDULED:n.color="#305680";break;case Sa.PROCESSING:n.color="#D47D18";break}return n}openStatsErrorDialog(e,n){e&&e.stopPropagation(),this.dialog.open(Sm,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{notificationRequest:n}}).afterClosed().subscribe(()=>{})}static{this.\u0275fac=function(n){return new(n||i)(D(bi),D(Z),D(je),D(ke))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();var tc=(()=>{class i{constructor(e,n,t,l,u){this.notificationService=e,this.translate=n,this.dialog=t,this.datePipe=l,this.customTranslate=u,this.config=new Ge,this.config.entityType=k.NOTIFICATION_TARGET,this.config.detailsPanelEnabled=!1,this.config.addAsTextButton=!0,this.config.rowPointer=!0,this.config.entityTranslations=Ue.get(k.NOTIFICATION_TARGET),this.config.entityResources={},this.config.addEntity=()=>this.notificationTargetDialog(null,!0),this.config.entitiesFetchFunction=y=>this.notificationService.getNotificationTargets(y),this.config.deleteEntityTitle=y=>this.translate.instant("notification.delete-recipient-title",{recipientName:y.name}),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-recipient-text"),this.config.deleteEntitiesTitle=y=>this.translate.instant("notification.delete-recipients-title",{count:y}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-recipients-text"),this.config.deleteEntity=y=>this.notificationService.deleteNotificationTarget(y.id),this.config.defaultSortOrder={property:"createdTime",direction:Zt.DESC},this.config.handleRowClick=(y,w)=>(this.editTarget(y,w),!0),this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"170px"),new Y("name","notification.recipient-group","20%"),new Y("configuration.type","notification.type","20%",y=>this.translate.instant(q0.get(y.configuration.type)),()=>({}),!1),new Y("configuration.description","notification.description","60%",y=>this.customTranslate.transform(y.configuration.description||""),()=>({}),!1))}resolve(e){return this.config}editTarget(e,n){e?.stopPropagation(),this.notificationTargetDialog(n).subscribe(t=>t?this.config.updateData():null)}notificationTargetDialog(e,n=!1){return this.dialog.open(po,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:n,target:e}}).afterClosed()}static{this.\u0275fac=function(n){return new(n||i)(D(bi),D(Z),D(je),D(ke),D(mi))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();var ic=(()=>{class i{constructor(e,n,t,l){this.notificationService=e,this.translate=n,this.dialog=t,this.datePipe=l,this.config=new Ge,this.config.entityType=k.NOTIFICATION_TEMPLATE,this.config.detailsPanelEnabled=!1,this.config.addAsTextButton=!0,this.config.rowPointer=!0,this.config.entityTranslations=Ue.get(k.NOTIFICATION_TEMPLATE),this.config.entityResources={},this.config.addEntity=()=>this.notificationTemplateDialog(null,!0),this.config.entitiesFetchFunction=u=>this.notificationService.getNotificationTemplates(u),this.config.deleteEntityTitle=u=>this.translate.instant("notification.delete-template-title",{templateName:u.name}),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-template-text"),this.config.deleteEntitiesTitle=u=>this.translate.instant("notification.delete-templates-title",{count:u}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-templates-text"),this.config.deleteEntity=u=>this.notificationService.deleteNotificationTemplate(u.id),this.config.cellActionDescriptors=this.configureCellActions(),this.config.defaultSortOrder={property:"createdTime",direction:Zt.DESC},this.config.handleRowClick=(u,y)=>(this.editTemplate(u,y),!0),this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"170px"),new Y("notificationType","notification.type","20%",u=>this.translate.instant(Ta.get(u.notificationType).name)),new Y("name","notification.template","80%"))}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("notification.copy-template"),icon:"content_copy",isEnabled:()=>!0,onAction:(e,n)=>this.editTemplate(e,n,!0)}]}editTemplate(e,n,t=!1){e?.stopPropagation(),this.notificationTemplateDialog(n,!1,t).subscribe(l=>l?this.config.updateData():null)}notificationTemplateDialog(e,n=!1,t=!1){return this.dialog.open(_s,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:n,isCopy:t,template:e}}).afterClosed()}static{this.\u0275fac=function(n){return new(n||i)(D(bi),D(Z),D(je),D(ke))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();C();C();C();C();function zI(i,m){i&1&&(r(0,"div",8),p(1,"notification.first-recipient"),a())}function $I(i,m){i&1&&(r(0,"div",9)(1,"span",10),p(2,"notification.after"),a(),f(3,"tb-timeinterval",11),r(4,"span",12),p(5,"notification.notify"),a()())}var Tm=(()=>{class i{constructor(e,n){this.fb=e,this.dialog=n,this.systemEscalation=!1,this.entityType=k,this.notificationType=H0,this.propagateChange=null,this.propagateChangePending=!1,this.destroy$=new At}registerOnChange(e){this.propagateChange=e,this.propagateChangePending&&(this.propagateChangePending=!1,setTimeout(()=>{this.propagateChange(this.modelValue)},0))}registerOnTouched(e){}ngOnInit(){this.escalationFormGroup=this.fb.group({delayInSec:[0],targets:[null,S.required]}),this.escalationFormGroup.valueChanges.pipe(lt(this.destroy$)).subscribe(()=>this.updateModel())}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setDisabledState(e){this.disabled=e,this.disabled?this.escalationFormGroup.disable({emitEvent:!1}):this.escalationFormGroup.enable({emitEvent:!1})}writeValue(e){this.propagateChangePending=!1,this.modelValue=e,this.modelValue.delayInSec=+e.delayInSec,Oe(this.modelValue)&&this.escalationFormGroup.patchValue(this.modelValue,{emitEvent:!1}),!this.disabled&&!this.escalationFormGroup.valid&&this.updateModel()}createTarget(e,n){e&&e.stopPropagation(),n._elementRef.nativeElement.blur(),this.dialog.open(po,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(t=>{if(t){let l=this.escalationFormGroup.get("targets").value;l||(l=[]),l.push(t.id.id),this.escalationFormGroup.get("targets").patchValue(l)}})}validate(e){return this.escalationFormGroup.valid?null:{escalation:{valid:!1}}}updateModel(){let e=this.escalationFormGroup.value;this.modelValue=_e(_e({},this.modelValue),e),this.propagateChange?this.propagateChange(this.modelValue):this.propagateChangePending=!0}static{this.\u0275fac=function(n){return new(n||i)(g(dt),g(je))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-escalation-form"]],inputs:{disabled:"disabled",systemEscalation:"systemEscalation"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}])],decls:12,vars:13,consts:[["selectTime",""],["createTargetButton",""],[1,"flex","flex-col",3,"formGroup"],[1,"escalation","flex","flex-row","items-center","justify-center","xs:flex-col","xs:items-stretch","xs:justify-start"],["class","flex-1","translate","",4,"ngIf","ngIfElse"],["required","","formControlName","targets","subscriptSizing","dynamic",1,"flex-full","xs:max-h-60%","gt-xs:max-w-60%",3,"entityType","subType","placeholderText"],["mat-button","","matSuffix","",3,"click"],[2,"white-space","nowrap"],["translate","",1,"flex-1"],[1,"flex","flex-1","flex-row","items-center","justify-center","xs:flex-col"],["translate",""],["subscriptSizing","dynamic","formControlName","delayInSec","min","60000","max","604800000","disabledAdvanced",""],["translate","",1,"escalation-notify","flex-1"]],template:function(n,t){if(n&1){let l=j();r(0,"form",2)(1,"div",3),b(2,zI,2,0,"div",4)(3,$I,6,0,"ng-template",null,0,It),r(5,"tb-entity-list",5),d(6,"translate"),r(7,"button",6,1),_("click",function(y){I(l);let w=U(8);return M(t.createTarget(y,w))}),r(9,"span",7),p(10),d(11,"translate"),a()()()()()}if(n&2){let l=U(4);s("formGroup",t.escalationFormGroup),o(2),s("ngIf",t.systemEscalation)("ngIfElse",l),o(3),T("entityType",t.entityType.NOTIFICATION_TARGET),T("subType",t.notificationType.ALARM),s("placeholderText",t.escalationFormGroup.get("targets").value?"":c(6,9,"notification.add-recipient")),o(2),V("!hidden",t.disabled),o(3),O(c(11,11,"notification.create-new"))}},dependencies:[G,Du,io,ee,zt,ce,W,K,ue,ie,se,J,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .escalation[_ngcontent-%COMP%]{height:100%;min-height:74px;max-height:100%;border-radius:8px;background:#0000000a;padding:0 10px}[_nghost-%COMP%]   .escalation[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-right:10px}[_nghost-%COMP%]   .escalation-notify[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   tb-timeinterval[_ngcontent-%COMP%]{min-width:100px;padding:0 10px}@media screen and (max-width: 599px){[_nghost-%COMP%]   .escalation[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding:10px 0 0}[_nghost-%COMP%]   tb-timeinterval[_ngcontent-%COMP%]{padding:0}}[_nghost-%COMP%]     .mat-mdc-form-field{min-width:100px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-form-field-infix{width:100%}[_nghost-%COMP%]     .mat-mdc-form-field .mat-mdc-select{min-width:110px!important}']})}}return i})();function QI(i,m){i&1&&f(0,"span",8)}function YI(i,m){if(i&1){let e=j();r(0,"button",9),d(1,"translate"),_("click",function(){I(e);let t=v().index,l=v();return M(l.removeEscalation(t))}),r(2,"mat-icon"),p(3,"close"),a()()}i&2&&T("matTooltip",c(1,1,"action.remove"))}function KI(i,m){if(i&1&&(r(0,"div",4),f(1,"tb-escalation-form",5),b(2,QI,1,0,"span",6)(3,YI,4,3,"button",7),a()),i&2){let e=m.$implicit,n=m.index,t=m.last,l=v();V("pb-2",!t),o(),s("formControl",e)("systemEscalation",n===0),o(),s("ngIf",n===0),o(),s("ngIf",n!==0&&!l.disabled)}}function XI(i,m){i&1&&(r(0,"div")(1,"span",10),p(2,"notification.no-rule"),a()())}function ZI(i,m){if(i&1){let e=j();r(0,"div",11)(1,"button",12),_("click",function(){I(e);let t=v();return M(t.addEscalation())}),r(2,"span",13),p(3,"notification.add-stage"),a()()()}}var Oo=class i{constructor(m,e){this.store=m,this.fb=e,this.destroy$=new At,this.propagateChange=n=>{}}registerOnChange(m){this.propagateChange=m}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}registerOnTouched(m){}ngOnInit(){this.escalationsFormGroup=this.fb.group({escalations:this.fb.array([])}),this.escalationsFormGroup.valueChanges.pipe(lt(this.destroy$)).subscribe(()=>this.updateModel())}get escalationsFormArray(){return this.escalationsFormGroup.get("escalations")}setDisabledState(m){this.disabled=m,this.disabled?this.escalationsFormGroup.disable({emitEvent:!1}):this.escalationsFormGroup.enable({emitEvent:!1})}writeValue(m){let e=[];for(let n in m)e.push({delayInSec:Number(n)*1e3,targets:m[n]});if(e.length===0)this.addEscalation(0);else if(e?.length===this.escalationsFormArray.length)this.escalationsFormArray.patchValue(e,{emitEvent:!1});else{let n=[];e.forEach(t=>{n.push(this.fb.control(t,[S.required]))}),this.escalationsFormGroup.setControl("escalations",this.fb.array(n),{emitEvent:!1}),this.disabled?this.escalationsFormGroup.disable({emitEvent:!1}):this.escalationsFormGroup.enable({emitEvent:!1})}}removeEscalation(m){this.escalationsFormGroup.get("escalations").removeAt(m)}addEscalation(m=36e5){let e={delayInSec:m,targets:null};this.escalationsFormGroup.get("escalations").push(this.fb.control(e,[]),{emitEvent:!1})}validate(m){return this.escalationsFormGroup.valid?null:{escalation:{valid:!1}}}updateModel(){let m={};this.escalationsFormGroup.get("escalations").value.forEach(e=>m[e.delayInSec/1e3]=e.targets),this.propagateChange(m)}static{this.\u0275fac=function(e){return new(e||i)(g(F),g(dt))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-escalations-component"]],inputs:{required:"required",disabled:"disabled"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}])],decls:4,vars:3,consts:[[1,"flex","flex-col"],["class","tb-tenant-profile-queues flex flex-row items-center",3,"pb-2",4,"ngFor","ngForOf"],[4,"ngIf"],["style","padding: 16px 0;",4,"ngIf"],[1,"tb-tenant-profile-queues","flex","flex-row","items-center"],[1,"flex-1",3,"formControl","systemEscalation"],["style","width: 48px;",4,"ngIf"],["mat-icon-button","","style","min-width: 40px;","type","button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],[2,"width","48px"],["mat-icon-button","","type","button","matTooltipPosition","above",2,"min-width","40px",3,"click","matTooltip"],["translate","",1,"tb-prompt","flex","items-center","justify-center"],[2,"padding","16px 0"],["mat-raised-button","","color","primary","type","button",3,"click"],["translate",""]],template:function(e,n){e&1&&(r(0,"div",0),b(1,KI,4,6,"div",1)(2,XI,3,0,"div",2)(3,ZI,4,0,"div",3),a()),e&2&&(o(),s("ngForOf",n.escalationsFormArray.controls),o(),s("ngIf",!n.escalationsFormArray.controls.length),o(),s("ngIf",!n.disabled))},dependencies:[Te,G,ee,Ee,ae,Pt,W,ii,J,Tm,R],encapsulation:2})}};Ro([ra(),Bo("design:type",Boolean)],Oo.prototype,"required",void 0);var tM=["addNotificationRule"];function iM(i,m){i&1&&f(0,"mat-progress-bar",31)}function nM(i,m){i&1&&f(0,"div",32)}function oM(i,m){i&1&&(r(0,"mat-icon"),p(1,"check"),a())}function aM(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.basic-settings"))}function rM(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"notification.rule-name-required")," "))}function sM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.triggerTypeTranslationMap.get(e))," ")}}function lM(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"notification.trigger.trigger-required")," "))}function pM(i,m){if(i&1){let e=j();r(0,"section",34)(1,"tb-entity-list",35),d(2,"translate"),d(3,"translate"),d(4,"translate"),r(5,"button",36,3),_("click",function(t){I(e);let l=U(6),u=v();return M(u.createTarget(t,l))}),r(7,"span",37),p(8),d(9,"translate"),a()()()()}if(i&2){let e=v();o(),T("subType",e.ruleNotificationForm.get("triggerType").value),T("entityType",e.entityType.NOTIFICATION_TARGET),T("labelText",c(2,6,"notification.recipients")),T("requiredText",c(3,8,"notification.recipients-required")),T("placeholderText",c(4,10,"notification.recipient")),o(7),O(c(9,12,"notification.create-new"))}}function mM(i,m){i&1&&Vt(0)}function dM(i,m){if(i&1&&(r(0,"fieldset",38)(1,"legend",19),p(2,"notification.escalation-chain"),a(),r(3,"div",39),p(4,"notification.recipients"),a(),f(5,"tb-escalations-component",40),b(6,mM,1,0,"ng-container",41),a()),i&2){v();let e=U(40);o(6),s("ngTemplateOutlet",e)}}function cM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.alarmSearchStatusTranslationMap.get(e))," ")}}function uM(i,m){if(i&1&&(r(0,"form",17)(1,"section",42)(2,"section",43)(3,"div",39),p(4,"notification.stop-escalation-alarm-status-become"),a(),r(5,"mat-form-field",44)(6,"mat-label",19),p(7,"alarm.alarm-status-list"),a(),r(8,"mat-select",45),d(9,"translate"),b(10,cM,3,4,"mat-option",24),a()()()()()),i&2){let e,n=v();s("formGroup",n.alarmTemplateForm),o(8),T("placeholder",(e=n.alarmTemplateForm.get("triggerConfig.clearRule.alarmStatuses").value)!=null&&e.length?"":c(9,3,"alarm.any-status")),o(2),s("ngForOf",n.alarmSearchStatuses)}}function fM(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.alarm-trigger-settings"))}function gM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.alarmSeverityTranslationMap.get(e))," ")}}function hM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.alarmActionTranslationMap.get(e))," ")}}function bM(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"notification.notify-on-required")," "))}function vM(i,m){if(i&1&&(r(0,"mat-step",15),b(1,fM,2,3,"ng-template",16),r(2,"form",17)(3,"section",42)(4,"fieldset",46)(5,"legend",19),p(6,"notification.filter"),a(),f(7,"tb-string-items-list",47),d(8,"translate"),d(9,"translate"),r(10,"mat-form-field",48)(11,"mat-label",19),p(12,"alarm.alarm-severity-list"),a(),r(13,"mat-select",49),d(14,"translate"),b(15,gM,3,4,"mat-option",24),a()()(),r(16,"mat-form-field",50)(17,"mat-label",19),p(18,"notification.notify-on"),a(),r(19,"mat-select",51),b(20,hM,3,4,"mat-option",24),a(),b(21,bM,3,3,"mat-error",21),a()()(),r(22,"form",17)(23,"section",52)(24,"mat-form-field",18)(25,"mat-label",19),p(26,"notification.description"),a(),f(27,"input",53),a()()()()),i&2){let e,n,t=v();s("stepControl",t.alarmTemplateForm),o(2),s("formGroup",t.alarmTemplateForm),o(5),T("label",c(8,9,"alarm.alarm-type-list")),T("placeholder",(e=t.alarmTemplateForm.get("triggerConfig.alarmTypes").value)!=null&&e.length?"":c(9,11,"alarm.any-type")),o(6),T("placeholder",(n=t.alarmTemplateForm.get("triggerConfig.alarmSeverities").value)!=null&&n.length?"":c(14,13,"alarm.any-severity")),o(2),s("ngForOf",t.alarmSeverities),o(5),s("ngForOf",t.alarmActions),o(),s("ngIf",t.alarmTemplateForm.get("triggerConfig.notifyOn").hasError("required")),o(),s("formGroup",t.ruleNotificationForm)}}function yM(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.device-activity-trigger-settings"))}function _M(i,m){if(i&1&&(Gt(0),f(1,"tb-entity-list",57),d(2,"translate"),d(3,"translate"),d(4,"translate"),Ut()),i&2){let e=v(2);o(),T("labelText",c(2,4,"device.devices")),T("placeholderText",c(3,6,"device.devices")),T("hint",c(4,8,"notification.device-list-rule-hint")),s("entityType",e.entityType.DEVICE)}}function CM(i,m){if(i&1&&(f(0,"tb-entity-list",58),d(1,"translate"),d(2,"translate"),d(3,"translate")),i&2){let e=v(2);T("labelText",c(1,4,"device-profile.device-profiles")),T("placeholderText",c(2,6,"device-profile.device-profiles")),T("hint",c(3,8,"notification.device-profiles-list-rule-hint")),s("entityType",e.entityType.DEVICE_PROFILE)}}function SM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.deviceEventTranslationMap.get(e))," ")}}function TM(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"notification.notify-on-required")," "))}function xM(i,m){if(i&1&&(r(0,"mat-step",15),b(1,yM,2,3,"ng-template",16),r(2,"form",17)(3,"section",42)(4,"div",54)(5,"tb-toggle-select",55)(6,"tb-toggle-option",33),p(7),d(8,"translate"),a(),r(9,"tb-toggle-option",33),p(10),d(11,"translate"),a()()(),b(12,_M,5,10,"ng-container",56)(13,CM,4,10,"ng-template",null,4,It),r(15,"mat-form-field",50)(16,"mat-label",19),p(17,"notification.notify-on"),a(),r(18,"mat-select",51),b(19,SM,3,4,"mat-option",24),a(),b(20,TM,3,3,"mat-error",21),a()()(),r(21,"form",17)(22,"section",52)(23,"mat-form-field",18)(24,"mat-label",19),p(25,"notification.description"),a(),f(26,"input",53),a()()()()),i&2){let e=U(14),n=v();s("stepControl",n.deviceInactivityTemplateForm),o(2),s("formGroup",n.deviceInactivityTemplateForm),o(4),s("value",!0),o(),O(c(8,11,"device.device")),o(2),s("value",!1),o(),O(c(11,13,"device-profile.device-profile")),o(2),s("ngIf",n.deviceInactivityTemplateForm.get("triggerConfig.filterByDevice").value)("ngIfElse",e),o(7),s("ngForOf",n.deviceEvents),o(),s("ngIf",n.deviceInactivityTemplateForm.get("triggerConfig.notifyOn").hasError("required")),o(),s("formGroup",n.ruleNotificationForm)}}function EM(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.entity-action-trigger-settings"))}function IM(i,m){if(i&1&&(r(0,"mat-step",15),b(1,EM,2,3,"ng-template",16),r(2,"form",17)(3,"fieldset",59)(4,"legend",19),p(5,"notification.filter"),a(),f(6,"tb-entity-type-list",60),r(7,"section",61)(8,"span",62),p(9,"notification.status"),a(),r(10,"mat-slide-toggle",63),p(11),d(12,"translate"),a(),r(13,"mat-slide-toggle",64),p(14),d(15,"translate"),a(),r(16,"mat-slide-toggle",65),p(17),d(18,"translate"),a()()()(),r(19,"form",17)(20,"section",52)(21,"mat-form-field",18)(22,"mat-label",19),p(23,"notification.description"),a(),f(24,"input",53),a()()()()),i&2){let e=v();s("stepControl",e.entityActionTemplateForm),o(2),s("formGroup",e.entityActionTemplateForm),o(4),s("allowedEntityTypes",e.allowEntityTypeForEntityAction),o(5),O(c(12,7,"notification.created")),o(3),O(c(15,9,"notification.updated")),o(3),O(c(18,11,"notification.deleted")),o(2),s("formGroup",e.ruleNotificationForm)}}function MM(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.alarm-comment-trigger-settings"))}function wM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.alarmSeverityTranslationMap.get(e))," ")}}function DM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.alarmSearchStatusTranslationMap.get(e))," ")}}function PM(i,m){if(i&1&&(r(0,"mat-step",15),b(1,MM,2,3,"ng-template",16),r(2,"form",17)(3,"section",42)(4,"fieldset",66)(5,"legend",19),p(6,"notification.filter"),a(),f(7,"tb-string-items-list",47),d(8,"translate"),d(9,"translate"),r(10,"mat-form-field",48)(11,"mat-label",19),p(12,"alarm.alarm-severity-list"),a(),r(13,"mat-select",49),d(14,"translate"),b(15,wM,3,4,"mat-option",24),a()(),r(16,"mat-form-field",48)(17,"mat-label",19),p(18,"alarm.alarm-status-list"),a(),r(19,"mat-select",45),d(20,"translate"),b(21,DM,3,4,"mat-option",24),a()()(),r(22,"section",67)(23,"mat-slide-toggle",68),p(24),d(25,"translate"),a(),r(26,"mat-slide-toggle",69),p(27),d(28,"translate"),a()()()(),r(29,"form",17)(30,"section",52)(31,"mat-form-field",18)(32,"mat-label",19),p(33,"notification.description"),a(),f(34,"input",53),a()()()()),i&2){let e,n,t,l=v();s("stepControl",l.alarmCommentTemplateForm),o(2),s("formGroup",l.alarmCommentTemplateForm),o(5),T("label",c(8,11,"alarm.alarm-type-list")),T("placeholder",(e=l.alarmCommentTemplateForm.get("triggerConfig.alarmTypes").value)!=null&&e.length?"":c(9,13,"alarm.any-type")),o(6),T("placeholder",(n=l.alarmCommentTemplateForm.get("triggerConfig.alarmSeverities").value)!=null&&n.length?"":c(14,15,"alarm.any-severity")),o(2),s("ngForOf",l.alarmSeverities),o(4),T("placeholder",(t=l.alarmCommentTemplateForm.get("triggerConfig.alarmStatuses").value)!=null&&t.length?"":c(20,17,"alarm.any-status")),o(2),s("ngForOf",l.alarmSearchStatuses),o(3),h(" ",c(25,19,"notification.notify-only-user-comments")," "),o(3),h(" ",c(28,21,"notification.notify-on-comment-update")," "),o(2),s("formGroup",l.ruleNotificationForm)}}function FM(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.alarm-assignment-trigger-settings"))}function AM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.alarmSeverityTranslationMap.get(e))," ")}}function NM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.alarmSearchStatusTranslationMap.get(e))," ")}}function kM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.alarmAssignmentActionTranslationMap.get(e))," ")}}function OM(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"notification.notify-on-required")," "))}function RM(i,m){if(i&1&&(r(0,"mat-step",15),b(1,FM,2,3,"ng-template",16),r(2,"form",17)(3,"section",42)(4,"fieldset",66)(5,"legend",19),p(6,"notification.filter"),a(),f(7,"tb-string-items-list",47),d(8,"translate"),d(9,"translate"),r(10,"mat-form-field",48)(11,"mat-label",19),p(12,"alarm.alarm-severity-list"),a(),r(13,"mat-select",49),d(14,"translate"),b(15,AM,3,4,"mat-option",24),a()(),r(16,"mat-form-field",48)(17,"mat-label",19),p(18,"alarm.alarm-status-list"),a(),r(19,"mat-select",45),d(20,"translate"),b(21,NM,3,4,"mat-option",24),a()()(),r(22,"mat-form-field",50)(23,"mat-label",19),p(24,"notification.notify-on"),a(),r(25,"mat-select",51),b(26,kM,3,4,"mat-option",24),a(),b(27,OM,3,3,"mat-error",21),a()()(),r(28,"form",17)(29,"section",52)(30,"mat-form-field",18)(31,"mat-label",19),p(32,"notification.description"),a(),f(33,"input",53),a()()()()),i&2){let e,n,t,l=v();s("stepControl",l.alarmAssignmentTemplateForm),o(2),s("formGroup",l.alarmAssignmentTemplateForm),o(5),T("label",c(8,11,"alarm.alarm-type-list")),T("placeholder",(e=l.alarmAssignmentTemplateForm.get("triggerConfig.alarmTypes").value)!=null&&e.length?"":c(9,13,"alarm.any-type")),o(6),T("placeholder",(n=l.alarmAssignmentTemplateForm.get("triggerConfig.alarmSeverities").value)!=null&&n.length?"":c(14,15,"alarm.any-severity")),o(2),s("ngForOf",l.alarmSeverities),o(4),T("placeholder",(t=l.alarmAssignmentTemplateForm.get("triggerConfig.alarmStatuses").value)!=null&&t.length?"":c(20,17,"alarm.any-status")),o(2),s("ngForOf",l.alarmSearchStatuses),o(5),s("ngForOf",l.alarmAssignmentActions),o(),s("ngIf",l.alarmAssignmentTemplateForm.get("triggerConfig.notifyOn").hasError("required")),o(),s("formGroup",l.ruleNotificationForm)}}function BM(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.rule-engine-events-trigger-settings"))}function VM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.componentLifecycleEventTranslationMap.get(e))," ")}}function jM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(3);s("value",e),o(),h(" ",c(2,2,n.componentLifecycleEventTranslationMap.get(e))," ")}}function LM(i,m){if(i&1&&(r(0,"section")(1,"mat-form-field",48)(2,"mat-label",19),p(3,"rulenode.rule-node-events"),a(),r(4,"mat-select",74),d(5,"translate"),b(6,jM,3,4,"mat-option",24),a()(),r(7,"mat-slide-toggle",75),p(8),d(9,"translate"),a()()),i&2){let e,n=v(2);o(4),T("placeholder",(e=n.ruleEngineEventsTemplateForm.get("triggerConfig.ruleNodeEvents").value)!=null&&e.length?"":c(5,3,"event.all-events")),o(2),s("ngForOf",n.componentLifecycleEvents),o(2),h(" ",c(9,5,"notification.only-rule-node-lifecycle-failures")," ")}}function GM(i,m){if(i&1&&(r(0,"mat-step",15),b(1,BM,2,3,"ng-template",16),r(2,"form",17)(3,"section",42)(4,"fieldset",66)(5,"legend",19),p(6,"notification.rule-engine-filter"),a(),f(7,"tb-entity-list",70),d(8,"translate"),d(9,"translate"),d(10,"translate"),r(11,"mat-form-field",48)(12,"mat-label",19),p(13,"rulechain.rulechain-events"),a(),r(14,"mat-select",71),d(15,"translate"),b(16,VM,3,4,"mat-option",24),a()(),r(17,"mat-slide-toggle",72),p(18),d(19,"translate"),a()(),r(20,"fieldset",66)(21,"legend",19),p(22,"notification.rule-node-filter"),a(),r(23,"mat-slide-toggle",73),p(24),d(25,"translate"),a(),b(26,LM,10,7,"section",21),a()()(),r(27,"form",17)(28,"section",52)(29,"mat-form-field",18)(30,"mat-label",19),p(31,"notification.description"),a(),f(32,"input",53),a()()()()),i&2){let e,n=v();s("stepControl",n.ruleEngineEventsTemplateForm),o(2),s("formGroup",n.ruleEngineEventsTemplateForm),o(5),T("labelText",c(8,12,"rulechain.rulechains")),T("placeholderText",c(9,14,"rulechain.rulechains")),T("hint",c(10,16,"notification.rule-chain-list-rule-hint")),s("entityType",n.entityType.RULE_CHAIN),o(7),T("placeholder",(e=n.ruleEngineEventsTemplateForm.get("triggerConfig.ruleChainEvents").value)!=null&&e.length?"":c(15,18,"event.all-events")),o(2),s("ngForOf",n.componentLifecycleEvents),o(2),h(" ",c(19,20,"notification.only-rule-chain-lifecycle-failures")," "),o(6),h(" ",c(25,22,"notification.track-rule-node-events")," "),o(2),s("ngIf",n.ruleEngineEventsTemplateForm.get("triggerConfig.trackRuleNodeEvents").value),o(),s("formGroup",n.ruleNotificationForm)}}function UM(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.edge-trigger-settings"))}function qM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.edgeConnectionEventTranslationMap.get(e))," ")}}function WM(i,m){if(i&1&&(r(0,"mat-step",15),b(1,UM,2,3,"ng-template",16),r(2,"form",17)(3,"section",42)(4,"fieldset",46)(5,"legend",19),p(6,"notification.filter"),a(),f(7,"tb-entity-list",76),d(8,"translate"),d(9,"translate"),d(10,"translate"),r(11,"mat-form-field",48)(12,"mat-label",19),p(13,"notification.notify-on"),a(),r(14,"mat-select",77),d(15,"translate"),b(16,qM,3,4,"mat-option",24),a()()()()(),r(17,"form",17)(18,"section",52)(19,"mat-form-field",18)(20,"mat-label",19),p(21,"notification.description"),a(),f(22,"input",53),a()()()()),i&2){let e,n=v();s("stepControl",n.edgeConnectionTemplateForm),o(2),s("formGroup",n.edgeConnectionTemplateForm),o(5),T("labelText",c(8,9,"edge.edge-instances")),T("placeholderText",c(9,11,"edge.edge-instances")),T("hint",c(10,13,"notification.edge-list-rule-hint")),s("entityType",n.entityType.EDGE),o(7),T("placeholder",(e=n.edgeConnectionTemplateForm.get("triggerConfig.notifyOn").value)!=null&&e.length?"":c(15,15,"event.all-events")),o(2),s("ngForOf",n.edgeConnectionEvents),o(),s("formGroup",n.ruleNotificationForm)}}function HM(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.edge-trigger-settings"))}function zM(i,m){if(i&1&&(r(0,"mat-step",15),b(1,HM,2,3,"ng-template",16),r(2,"form",17)(3,"section",42)(4,"fieldset",46)(5,"legend",19),p(6,"notification.filter"),a(),f(7,"tb-entity-list",78),d(8,"translate"),d(9,"translate"),a()()(),r(10,"form",17)(11,"section",52)(12,"mat-form-field",18)(13,"mat-label",19),p(14,"notification.description"),a(),f(15,"input",53),a()()()()),i&2){let e=v();s("stepControl",e.edgeCommunicationFailureTemplateForm),o(2),s("formGroup",e.edgeCommunicationFailureTemplateForm),o(5),T("labelText",c(8,6,"edge.edge-instances")),T("hint",c(9,8,"notification.edge-list-rule-hint")),s("entityType",e.entityType.EDGE),o(3),s("formGroup",e.ruleNotificationForm)}}function $M(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.entities-limit-trigger-settings"))}function JM(i,m){if(i&1&&(r(0,"mat-step",15),b(1,$M,2,3,"ng-template",16),r(2,"form",17)(3,"fieldset",59)(4,"legend",19),p(5,"notification.filter"),a(),f(6,"tb-entity-type-list",79),r(7,"div",80)(8,"label",19),p(9,"notification.threshold"),a(),r(10,"div",81)(11,"mat-slider",82),f(12,"input",83),a(),r(13,"mat-form-field",84),f(14,"input",85),a()()()()(),r(15,"form",17)(16,"section",52)(17,"mat-form-field",18)(18,"mat-label",19),p(19,"notification.description"),a(),f(20,"input",53),a()()()()),i&2){let e=v();s("stepControl",e.entitiesLimitTemplateForm),o(2),s("formGroup",e.entitiesLimitTemplateForm),o(4),s("allowedEntityTypes",e.allowEntityTypeForEntitiesLimit),o(5),s("displayWith",e.formatLabel),o(3),s("value",e.entitiesLimitTemplateForm.get("triggerConfig.threshold").value),o(),s("formGroup",e.ruleNotificationForm)}}function QM(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.api-usage-trigger-settings"))}function YM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.apiFeatureTranslationMap.get(e))," ")}}function KM(i,m){if(i&1&&(r(0,"mat-option",33),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v(2);s("value",e),o(),h(" ",c(2,2,n.apiUsageStateValueTranslationMap.get(e))," ")}}function XM(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"notification.notify-on-required")," "))}function ZM(i,m){if(i&1&&(r(0,"mat-step",15),b(1,QM,2,3,"ng-template",16),r(2,"form",17)(3,"section",42)(4,"mat-form-field",86)(5,"mat-label",19),p(6,"api-usage.api-features"),a(),r(7,"mat-select",87),b(8,YM,3,4,"mat-option",24),a(),r(9,"mat-hint"),p(10),d(11,"translate"),a()(),r(12,"mat-form-field",50)(13,"mat-label",19),p(14,"notification.notify-on"),a(),r(15,"mat-select",51),b(16,KM,3,4,"mat-option",24),a(),b(17,XM,3,3,"mat-error",21),a()()(),r(18,"form",17)(19,"section",52)(20,"mat-form-field",18)(21,"mat-label",19),p(22,"notification.description"),a(),f(23,"input",53),a()()()()),i&2){let e=v();s("stepControl",e.apiUsageLimitTemplateForm),o(2),s("formGroup",e.apiUsageLimitTemplateForm),o(6),s("ngForOf",e.apiFeatures),o(2),O(c(11,7,"notification.api-feature-hint")),o(6),s("ngForOf",e.apiUsageStateValues),o(),s("ngIf",e.apiUsageLimitTemplateForm.get("triggerConfig.notifyOn").hasError("required")),o(),s("formGroup",e.ruleNotificationForm)}}function ew(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.new-platform-version-trigger-settings"))}function tw(i,m){if(i&1&&(r(0,"mat-step",15),b(1,ew,2,3,"ng-template",16),r(2,"form",17)(3,"section",52)(4,"mat-form-field",18)(5,"mat-label",19),p(6,"notification.description"),a(),f(7,"input",53),a()()()()),i&2){let e=v();s("stepControl",e.newPlatformVersionTemplateForm),o(2),s("formGroup",e.ruleNotificationForm)}}function iw(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.rate-limits-trigger-settings"))}function nw(i,m){if(i&1&&(r(0,"mat-step",15),b(1,iw,2,3,"ng-template",16),r(2,"form",17)(3,"section",42),f(4,"tb-string-items-list",88),d(5,"translate"),d(6,"translate"),a()(),r(7,"form",17)(8,"section",52)(9,"mat-form-field",18)(10,"mat-label",19),p(11,"notification.description"),a(),f(12,"input",53),a()()()()),i&2){let e=v();s("stepControl",e.rateLimitsTemplateForm),o(2),s("formGroup",e.rateLimitsTemplateForm),o(2),T("label",c(5,6,"notification.rate-limits")),T("hint",c(6,8,"notification.api-feature-hint")),s("predefinedValues",e.limitedApis),o(3),s("formGroup",e.ruleNotificationForm)}}function ow(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"notification.task-processing-failure-trigger-settings"))}function aw(i,m){if(i&1&&(r(0,"mat-step",15),b(1,ow,2,3,"ng-template",16),r(2,"form",17)(3,"section",52)(4,"mat-form-field",18)(5,"mat-label",19),p(6,"notification.description"),a(),f(7,"input",53),a()()()()),i&2){let e=v();s("stepControl",e.taskProcessingFailureTemplateForm),o(2),s("formGroup",e.ruleNotificationForm)}}function rw(i,m){if(i&1){let e=j();r(0,"button",89),_("click",function(){I(e);let t=v();return M(t.backStep())}),p(1),d(2,"translate"),a()}i&2&&(o(),O(c(2,1,"action.back")))}var xm=(()=>{class i extends nt{constructor(e,n,t,l,u,y,w,x,q){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.data=l,this.breakpointObserver=u,this.fb=y,this.translate=w,this.notificationService=x,this.dialog=q,this.triggerType=Qt,this.triggerTypeTranslationMap=ys,this.alarmSearchStatuses=[Qa.ACTIVE,Qa.CLEARED,Qa.ACK,Qa.UNACK],this.alarmSearchStatusTranslationMap=$c,this.alarmSeverityTranslationMap=zc,this.alarmSeverities=Object.keys(Hc),this.alarmActions=Object.values(bd),this.alarmActionTranslationMap=L0,this.alarmAssignmentActions=Object.values(vd),this.alarmAssignmentActionTranslationMap=G0,this.componentLifecycleEvents=Object.values(V0),this.componentLifecycleEventTranslationMap=j0,this.deviceEvents=Object.values(yd),this.deviceEventTranslationMap=U0,this.apiUsageStateValues=Object.values(Sd),this.apiUsageStateValueTranslationMap=lf,this.apiFeatures=Object.values(pf),this.apiFeatureTranslationMap=mf,this.edgeConnectionEvents=Object.values(e0),this.edgeConnectionEventTranslationMap=t0,this.entityType=k,this.isAdd=!0,this.allowEntityTypeForEntitiesLimit=[k.DEVICE,k.ASSET,k.CUSTOMER,k.USER,k.DASHBOARD,k.RULE_CHAIN],this.selectedIndex=0,this.dialogTitle="notification.edit-rule",this.destroy$=new At,this.authState=Li(this.store),this.authUser=this.authState.authUser,this.triggerTypes=this.allowTriggerTypes(),Vn(l.isAdd)&&(this.isAdd=l.isAdd),this.limitedApis=Object.values(df).map(De=>({name:this.translate.instant(cf.get(De)),value:De})),this.stepperOrientation=this.breakpointObserver.observe(Mi["gt-xs"]).pipe(ze(({matches:De})=>De?"horizontal":"vertical")),this.ruleNotificationForm=this.fb.group({name:[null,S.required],enabled:[!0,S.required],templateId:[null,S.required],triggerType:[this.isSysAdmin()?Qt.ENTITIES_LIMIT:Qt.ALARM,S.required],recipientsConfig:this.fb.group({targets:[{value:null,disabled:!this.isSysAdmin()},S.required],escalationTable:[{value:null,disabled:this.isSysAdmin()},S.required]}),triggerConfig:[null],additionalConfig:this.fb.group({description:[""]})}),this.ruleNotificationForm.get("triggerType").valueChanges.pipe(lt(this.destroy$)).subscribe(De=>{De===Qt.ALARM?(this.ruleNotificationForm.get("recipientsConfig.escalationTable").enable({emitEvent:!1}),this.ruleNotificationForm.get("recipientsConfig.targets").disable({emitEvent:!1})):(this.ruleNotificationForm.get("recipientsConfig.escalationTable").disable({emitEvent:!1}),this.ruleNotificationForm.get("recipientsConfig.targets").enable({emitEvent:!1}))}),this.ruleNotificationForm.get("recipientsConfig.escalationTable").valueChanges.pipe(lt(this.destroy$)).subscribe(()=>{this.countRecipientsChainConfig()>1?this.alarmTemplateForm.get("triggerConfig.clearRule").enable({emitEvent:!1}):this.alarmTemplateForm.get("triggerConfig.clearRule").disable({emitEvent:!1})}),this.edgeConnectionTemplateForm=this.fb.group({triggerConfig:this.fb.group({edges:[null],notifyOn:[null]})}),this.edgeCommunicationFailureTemplateForm=this.fb.group({triggerConfig:this.fb.group({edges:[null]})}),this.alarmTemplateForm=this.fb.group({triggerConfig:this.fb.group({alarmTypes:[null],alarmSeverities:[[]],clearRule:this.fb.group({alarmStatuses:[[]]}),notifyOn:[[bd.CREATED],S.required]})}),this.deviceInactivityTemplateForm=this.fb.group({triggerConfig:this.fb.group({filterByDevice:[!0],devices:[null],deviceProfiles:[{value:null,disabled:!0}],notifyOn:[[yd.INACTIVE],S.required]})}),this.deviceInactivityTemplateForm.get("triggerConfig.filterByDevice").valueChanges.pipe(lt(this.destroy$)).subscribe(De=>{De?(this.deviceInactivityTemplateForm.get("triggerConfig.devices").enable({emitEvent:!1}),this.deviceInactivityTemplateForm.get("triggerConfig.deviceProfiles").disable({emitEvent:!1})):(this.deviceInactivityTemplateForm.get("triggerConfig.deviceProfiles").enable({emitEvent:!1}),this.deviceInactivityTemplateForm.get("triggerConfig.devices").disable({emitEvent:!1}))}),this.entityActionTemplateForm=this.fb.group({triggerConfig:this.fb.group({entityTypes:[[k.DEVICE],S.required],created:[!1],updated:[!1],deleted:[!1]})}),this.alarmCommentTemplateForm=this.fb.group({triggerConfig:this.fb.group({alarmTypes:[null],alarmSeverities:[[]],alarmStatuses:[[]],onlyUserComments:[!1],notifyOnCommentUpdate:[!1]})}),this.alarmAssignmentTemplateForm=this.fb.group({triggerConfig:this.fb.group({alarmTypes:[null],alarmSeverities:[[]],alarmStatuses:[[]],notifyOn:[[vd.ASSIGNED],S.required]})}),this.ruleEngineEventsTemplateForm=this.fb.group({triggerConfig:this.fb.group({ruleChains:[null],ruleChainEvents:[null],onlyRuleChainLifecycleFailures:[!1],trackRuleNodeEvents:[!1],ruleNodeEvents:[null],onlyRuleNodeLifecycleFailures:[!1]})}),this.entitiesLimitTemplateForm=this.fb.group({triggerConfig:this.fb.group({entityTypes:[],threshold:[.8,[S.min(0),S.max(1)]]})}),this.apiUsageLimitTemplateForm=this.fb.group({triggerConfig:this.fb.group({apiFeatures:[[]],notifyOn:[[Sd.WARNING],S.required]})}),this.newPlatformVersionTemplateForm=this.fb.group({triggerConfig:this.fb.group({})}),this.rateLimitsTemplateForm=this.fb.group({triggerConfig:this.fb.group({apis:[]})}),this.taskProcessingFailureTemplateForm=this.fb.group({triggerConfig:this.fb.group({taskTypes:[]})}),this.triggerTypeFormsMap=new Map([[Qt.ALARM,this.alarmTemplateForm],[Qt.ALARM_COMMENT,this.alarmCommentTemplateForm],[Qt.DEVICE_ACTIVITY,this.deviceInactivityTemplateForm],[Qt.ENTITY_ACTION,this.entityActionTemplateForm],[Qt.ALARM_ASSIGNMENT,this.alarmAssignmentTemplateForm],[Qt.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT,this.ruleEngineEventsTemplateForm],[Qt.ENTITIES_LIMIT,this.entitiesLimitTemplateForm],[Qt.API_USAGE_LIMIT,this.apiUsageLimitTemplateForm],[Qt.NEW_PLATFORM_VERSION,this.newPlatformVersionTemplateForm],[Qt.RATE_LIMITS,this.rateLimitsTemplateForm],[Qt.EDGE_COMMUNICATION_FAILURE,this.edgeCommunicationFailureTemplateForm],[Qt.EDGE_CONNECTION,this.edgeConnectionTemplateForm],[Qt.TASK_PROCESSING_FAILURE,this.taskProcessingFailureTemplateForm]]),(l.isAdd||l.isCopy)&&(this.dialogTitle="notification.add-rule"),this.ruleNotification=Tt(this.data.rule),this.ruleNotification&&(this.data.isCopy?this.ruleNotification.name+=` (${this.translate.instant("action.copy")})`:this.ruleNotificationForm.get("triggerType").disable({emitEvent:!1}),this.ruleNotificationForm.reset({},{emitEvent:!1}),this.ruleNotificationForm.patchValue(this.ruleNotification,{emitEvent:!1}),this.ruleNotificationForm.get("triggerType").updateValueAndValidity({onlySelf:!0}),this.triggerTypeFormsMap.get(this.ruleNotification.triggerType).patchValue(this.ruleNotification,{emitEvent:!1}),this.ruleNotification.triggerType===Qt.DEVICE_ACTIVITY&&this.deviceInactivityTemplateForm.get("triggerConfig.filterByDevice").patchValue(!!this.ruleNotification.triggerConfig.devices,{onlySelf:!0}))}ngOnDestroy(){super.ngOnDestroy(),this.destroy$.next(),this.destroy$.complete()}changeStep(e){this.selectedIndex=e.selectedIndex,e.previouslySelectedIndex>e.selectedIndex&&(e.previouslySelectedStep.interacted=!1)}backStep(){this.addNotificationRule.previous()}nextStep(){this.selectedIndex>=this.maxStepperIndex?this.add():this.addNotificationRule.next()}nextStepLabel(){return this.selectedIndex!==0?this.data.isAdd||this.data.isCopy?"action.add":"action.save":"action.next"}get maxStepperIndex(){return this.addNotificationRule?._steps?.length-1}add(){if(this.allValid()){let e=this.ruleNotificationForm.value,n=this.ruleNotificationForm.get("triggerType").value,t=this.triggerTypeFormsMap.get(n);Object.assign(e,t.value),n===Qt.DEVICE_ACTIVITY&&delete e.triggerConfig.filterByDevice,e.recipientsConfig.triggerType=n,e.triggerConfig.triggerType=n,this.ruleNotification&&!this.data.isCopy&&(e=_e(_e({},this.ruleNotification),e)),this.notificationService.saveNotificationRule(jn(e)).subscribe(l=>this.dialogRef.close(l))}}allValid(){return!this.addNotificationRule.steps.find((e,n)=>e.stepControl.invalid?(e.interacted=!0,this.addNotificationRule.selectedIndex=n,!0):!1)}cancel(){this.dialogRef.close(null)}createTarget(e,n){e&&e.stopPropagation(),n._elementRef.nativeElement.blur(),this.dialog.open(po,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(t=>{if(t){let l=this.ruleNotificationForm.get("recipientsConfig.targets").value;l||(l=[]),l.push(t.id.id),this.ruleNotificationForm.get("recipientsConfig.targets").patchValue(l)}})}countRecipientsChainConfig(){return Object.keys(this.ruleNotificationForm.get("recipientsConfig.escalationTable").value??{}).length}formatLabel(e){return`${(e*100).toFixed()}%`}isSysAdmin(){return this.authUser.authority===E.SYS_ADMIN}allowTriggerTypes(){let e=new Set([Qt.ENTITIES_LIMIT,Qt.API_USAGE_LIMIT,Qt.NEW_PLATFORM_VERSION,Qt.RATE_LIMITS,Qt.TASK_PROCESSING_FAILURE]);return this.isSysAdmin()?Array.from(e):Object.values(Qt).filter(n=>!e.has(n))}get allowEntityTypeForEntityAction(){if(!this._allowEntityTypeForEntityAction){let e=new Set([k.API_USAGE_STATE,k.TENANT_PROFILE,k.RPC,k.QUEUE,k.NOTIFICATION,k.NOTIFICATION_REQUEST,k.WIDGET_TYPE]);this._allowEntityTypeForEntityAction=Object.values(k).filter(n=>!e.has(n))}return this._allowEntityTypeForEntityAction}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(it),g(Ot),g(Xn),g(dt),g(Z),g(bi),g(je))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-rule-notification-dialog"]],viewQuery:function(n,t){if(n&1&&Ie(tM,7),n&2){let l;Me(l=we())&&(t.addNotificationRule=l.first)}},features:[L],decls:61,vars:41,consts:[["addNotificationRule",""],["alarmTargesConfig",""],["clearRules",""],["createTargetButton",""],["deviceProfile",""],["color","primary"],[1,"flex-1"],["tb-help","ruleNotifications"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],["mat-dialog-content","",1,"xs:p-0"],["labelPosition","end",3,"selectionChange","linear","orientation"],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[3,"formGroup"],[1,"mat-block"],["translate",""],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","enabled",2,"margin-bottom","22px"],["formControlName","triggerType","required",""],[3,"value",4,"ngFor","ngForOf"],["required","","allowCreate","","allowEdit","","formControlName","templateId",3,"notificationTypes"],["formGroupName","recipientsConfig",4,"ngIf","ngIfElse"],[3,"stepControl",4,"ngIf"],["mat-dialog-actions","",1,"flex","flex-row"],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],["color","warn","mode","indeterminate"],[2,"height","4px"],[3,"value"],["formGroupName","recipientsConfig"],["required","","formControlName","targets",3,"subType","entityType","labelText","requiredText","placeholderText"],["mat-button","","color","primary","matSuffix","",3,"click"],[2,"white-space","nowrap"],["formGroupName","recipientsConfig",1,"fields-group","tb-hierarchy"],["translate","",1,"mat-body-2"],["formControlName","escalationTable"],[4,"ngTemplateOutlet"],["formGroupName","triggerConfig"],["formGroupName","clearRule"],["floatLabel","always",1,"mat-block","flex-1",2,"margin-right","48px"],["formControlName","alarmStatuses","multiple","",3,"placeholder"],[1,"fields-group","tb-margin-before-field"],["editable","","floatLabel","always","formControlName","alarmTypes",3,"label","placeholder"],["floatLabel","always",1,"mat-block","flex-1"],["formControlName","alarmSeverities","multiple","",3,"placeholder"],[1,"mat-block","flex-1"],["formControlName","notifyOn","multiple",""],["formGroupName","additionalConfig"],["matInput","","formControlName","description"],[1,"mb-4","flex","justify-center"],["appearance","fill","formControlName","filterByDevice",1,"w-60"],[4,"ngIf","ngIfElse"],["formControlName","devices","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formControlName","deviceProfiles","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formGroupName","triggerConfig",1,"fields-group","tb-margin"],["required","","ignoreAuthorityFilter","","formControlName","entityTypes",3,"allowedEntityTypes"],[1,"flex","flex-col","gap-2"],["translate","",1,"flex-1"],["formControlName","created"],["formControlName","updated"],["formControlName","deleted"],[1,"fields-group","tb-margin"],[1,"flex","flex-col"],["formControlName","onlyUserComments",2,"margin-bottom","12px"],["formControlName","notifyOnCommentUpdate",2,"margin-bottom","12px"],["formControlName","ruleChains","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formControlName","ruleChainEvents","multiple","",3,"placeholder"],["formControlName","onlyRuleChainLifecycleFailures"],["formControlName","trackRuleNodeEvents"],["formControlName","ruleNodeEvents","multiple","",3,"placeholder"],["formControlName","onlyRuleNodeLifecycleFailures"],["formControlName","edges","subscriptSizing","dynamic",3,"labelText","placeholderText","hint","entityType"],["formControlName","notifyOn","multiple","",3,"placeholder"],["formControlName","edges",3,"labelText","hint","entityType"],["formControlName","entityTypes","ignoreAuthorityFilter","",3,"allowedEntityTypes"],[1,"limit-slider-container","flex","flex-row","items-center","justify-start","xs:flex-col","xs:items-stretch"],[1,"flex","flex-1","flex-row","items-center","justify-start"],["min","0","max","1","step","0.01","discrete","",1,"flex-1",3,"displayWith"],["matSliderThumb","","formControlName","threshold"],[1,"limit-slider-value"],["matInput","","formControlName","threshold","type","number","step","0.01","min","0","max","1",3,"value"],["subscriptSizing","dynamic",1,"mat-block","flex-1"],["formControlName","apiFeatures","multiple",""],["formControlName","apis",3,"label","hint","predefinedValues"],["mat-stroked-button","",3,"click"]],template:function(n,t){if(n&1){let l=j();r(0,"mat-toolbar",5)(1,"h2"),p(2),d(3,"translate"),a(),f(4,"span",6)(5,"div",7),r(6,"button",8),_("click",function(){return I(l),M(t.cancel())}),r(7,"mat-icon",9),p(8,"close"),a()()(),b(9,iM,1,0,"mat-progress-bar",10),d(10,"async"),b(11,nM,1,0,"div",11),d(12,"async"),r(13,"div",12)(14,"mat-horizontal-stepper",13,0),d(16,"async"),_("selectionChange",function(y){return I(l),M(t.changeStep(y))}),b(17,oM,2,0,"ng-template",14),r(18,"mat-step",15),b(19,aM,2,3,"ng-template",16),r(20,"form",17)(21,"mat-form-field",18)(22,"mat-label",19),p(23,"notification.rule-name"),a(),f(24,"input",20),b(25,rM,3,3,"mat-error",21),a(),r(26,"mat-slide-toggle",22),p(27),d(28,"translate"),a(),r(29,"mat-form-field",18)(30,"mat-label",19),p(31,"notification.trigger.trigger"),a(),r(32,"mat-select",23),b(33,sM,3,4,"mat-option",24),a(),b(34,lM,3,3,"mat-error",21),a(),f(35,"tb-template-autocomplete",25),b(36,pM,10,14,"section",26)(37,dM,7,1,"ng-template",null,1,It),a(),b(39,uM,11,5,"ng-template",null,2,It),a(),b(41,vM,28,15,"mat-step",27)(42,xM,27,15,"mat-step",27)(43,IM,25,13,"mat-step",27)(44,PM,35,23,"mat-step",27)(45,RM,34,19,"mat-step",27)(46,GM,33,24,"mat-step",27)(47,WM,23,17,"mat-step",27)(48,zM,16,10,"mat-step",27)(49,JM,21,6,"mat-step",27)(50,ZM,24,9,"mat-step",27)(51,tw,8,2,"mat-step",27)(52,nw,13,10,"mat-step",27)(53,aw,8,2,"mat-step",27),a()(),f(54,"mat-divider"),r(55,"div",28),b(56,rw,3,3,"button",29),f(57,"span",6),r(58,"button",30),_("click",function(){return I(l),M(t.nextStep())}),p(59),d(60,"translate"),a()()}if(n&2){let l=U(38);o(2),O(c(3,29,t.dialogTitle)),o(7),s("ngIf",c(10,31,t.isLoading$)),o(2),s("ngIf",c(12,33,t.isLoading$)===!1),o(3),s("linear",!0)("orientation",c(16,35,t.stepperOrientation)),o(4),s("stepControl",t.ruleNotificationForm),o(2),s("formGroup",t.ruleNotificationForm),o(5),s("ngIf",t.ruleNotificationForm.get("name").hasError("required")),o(2),h(" ",c(28,37,"notification.rule-enable")," "),o(6),s("ngForOf",t.triggerTypes),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").hasError("required")),o(),s("notificationTypes",t.ruleNotificationForm.get("triggerType").value),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value!==t.triggerType.ALARM)("ngIfElse",l),o(5),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ALARM),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.DEVICE_ACTIVITY),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ENTITY_ACTION),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ALARM_COMMENT),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ALARM_ASSIGNMENT),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.RULE_ENGINE_COMPONENT_LIFECYCLE_EVENT),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.EDGE_CONNECTION),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.EDGE_COMMUNICATION_FAILURE),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.ENTITIES_LIMIT),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.API_USAGE_LIMIT),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.NEW_PLATFORM_VERSION),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.RATE_LIMITS),o(),s("ngIf",t.ruleNotificationForm.get("triggerType").value===t.triggerType.TASK_PROCESSING_FAILURE),o(3),s("ngIf",t.selectedIndex>0),o(3),O(c(60,39,t.nextStepLabel()))}},dependencies:[Te,G,Qn,wt,io,E0,cn,ee,Ee,ae,qe,he,me,Ce,Kt,Pe,zt,at,Rt,mt,vt,gt,mn,ht,Su,Tu,wn,In,Dn,Mn,ce,ge,Ui,W,K,ue,qi,ln,ie,se,bt,J,Q0,Di,Pi,Oo,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:900px;height:100%;max-width:100%;max-height:100vh;display:flex;flex-direction:column}[_nghost-%COMP%]   .tb-hint[_ngcontent-%COMP%]{margin-top:-1.25em;padding:0}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .fields-group.tb-margin[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .fields-group.tb-margin-before-field[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .fields-group.tb-hierarchy[_ngcontent-%COMP%]{padding:0 0 8px 16px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{margin-bottom:8px;color:#000000b3;width:fit-content}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   .mat-body-2[_ngcontent-%COMP%]{margin-bottom:8px;color:#000000c2}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   .clear-button-space[_ngcontent-%COMP%]{margin-right:48px}[_nghost-%COMP%]   .fields-group[_ngcontent-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .limit-slider-container[_ngcontent-%COMP%]   .limit-slider-value[_ngcontent-%COMP%]{margin-left:16px;min-width:25px;max-width:100px}[_nghost-%COMP%]   .limit-slider-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{text-align:center}@media screen and (min-width: 960px){[_nghost-%COMP%]   .history-time-input[_ngcontent-%COMP%]{min-width:364px}[_nghost-%COMP%]   .limit-slider-container[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{margin-right:16px;width:min-content;max-width:40%}}[_nghost-%COMP%]     .mat-mdc-dialog-content{display:flex;flex-direction:column;height:100%;padding:0!important;color:#000000de}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal{display:flex;height:100%;overflow:hidden}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-stepper-wrapper{flex:1 1 100%}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{height:700px;max-height:100%;width:100%;overflow-y:auto;scrollbar-gutter:stable}@media screen and (min-width: 960px){[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{min-width:500px}}']})}}return i})();var nc=(()=>{class i{constructor(e,n,t,l,u){this.notificationService=e,this.translate=n,this.dialog=t,this.datePipe=l,this.customTranslate=u,this.config=new Ge,this.config.entityType=k.NOTIFICATION_RULE,this.config.detailsPanelEnabled=!1,this.config.addAsTextButton=!0,this.config.rowPointer=!0,this.config.entityTranslations=Ue.get(k.NOTIFICATION_RULE),this.config.entityResources={},this.config.addEntity=()=>this.notificationRuleDialog(null,!0),this.config.entitiesFetchFunction=y=>this.notificationService.getNotificationRules(y),this.config.deleteEntityTitle=y=>this.translate.instant("notification.delete-rule-title",{ruleName:y.name}),this.config.deleteEntityContent=()=>this.translate.instant("notification.delete-rule-text"),this.config.deleteEntitiesTitle=y=>this.translate.instant("notification.delete-rules-title",{count:y}),this.config.deleteEntitiesContent=()=>this.translate.instant("notification.delete-rules-text"),this.config.deleteEntity=y=>this.notificationService.deleteNotificationRule(y.id),this.config.cellActionDescriptors=this.configureCellActions(),this.config.defaultSortOrder={property:"createdTime",direction:Zt.DESC},this.config.handleRowClick=(y,w)=>(this.editRule(y,w),!0),this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"170px"),new Y("name","notification.rule-name","30%"),new Y("templateName","notification.template","20%"),new Y("triggerType","notification.trigger.trigger","20%",y=>this.translate.instant(ys.get(y.triggerType))||"",()=>({}),!0),new Y("additionalConfig.description","notification.description","30%",y=>this.customTranslate.transform(y.additionalConfig?.description||""),()=>({}),!1))}resolve(e){return this.config}configureCellActions(){return[{name:"",nameFunction:e=>this.translate.instant(e.enabled?"notification.rule-disable":"notification.rule-enable"),icon:"mdi:toggle-switch",isEnabled:()=>!0,iconFunction:e=>e.enabled?"mdi:toggle-switch":"mdi:toggle-switch-off-outline",onAction:(e,n)=>this.toggleEnableMode(e,n)},{name:this.translate.instant("notification.copy-rule"),icon:"content_copy",isEnabled:()=>!0,onAction:(e,n)=>this.editRule(e,n,!0)}]}editRule(e,n,t=!1){e?.stopPropagation(),this.notificationRuleDialog(n,!1,t).subscribe(l=>l?this.config.updateData():null)}notificationRuleDialog(e,n=!1,t=!1){return this.dialog.open(xm,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:n,isCopy:t,rule:e}}).afterClosed()}toggleEnableMode(e,n){e&&e.stopPropagation();let t=Ii(_e({},n),{enabled:!n.enabled});this.notificationService.saveNotificationRule(t,{ignoreLoading:!0}).subscribe(l=>{n.enabled=l.enabled,this.config.getTable().detectChanges()})}static{this.\u0275fac=function(n){return new(n||i)(D(bi),D(Z),D(je),D(ke),D(mi))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var sw=[{path:"notification",component:un,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER,E.SYS_ADMIN],breadcrumb:{menuId:be.notifications_center},routerTabsHeaderComponent:qf},children:[{path:"",children:[],data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER,E.SYS_ADMIN],redirectTo:"/notification/inbox"}},{path:"inbox",component:Le,data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER,E.SYS_ADMIN],title:"notification.inbox",breadcrumb:{menuId:be.notification_inbox}},resolve:{entitiesTableConfig:Zd}},{path:"sent",component:Le,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"notification.sent",breadcrumb:{menuId:be.notification_sent}},resolve:{entitiesTableConfig:ec}},{path:"templates",component:Le,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"notification.templates",breadcrumb:{menuId:be.notification_templates}},resolve:{entitiesTableConfig:ic}},{path:"recipients",component:Le,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"notification.recipients",breadcrumb:{menuId:be.notification_recipients}},resolve:{entitiesTableConfig:tc}},{path:"rules",component:Le,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"notification.rules",breadcrumb:{menuId:be.notification_rules}},resolve:{entitiesTableConfig:nc}}]}],Em=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[Zd,ec,tc,ic,nc],imports:[B.forChild(sw),B]})}}return i})();(function(){Q(Em,{imports:[B],exports:[B]})})();C();C();function lw(i,m){if(i&1){let e=j();r(0,"div",6)(1,"div",7)(2,"mat-checkbox",8),_("click",function(){let t=I(e).$implicit,l=v();return M(l.toggleDeliviryMethod(t))}),a()()()}if(i&2){let e=m.$implicit,n=v();o(2),s("checked",n.getChecked(e))}}var Im=(()=>{class i{constructor(e){this.fb=e,this.deliveryMethods=[],this.notificationTemplateTypeTranslateMap=Ta,this.propagateChange=null,this.valueChange$=null}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}ngOnInit(){let e={};this.deliveryMethods.forEach(n=>{e[n]=!0}),this.notificationSettingsFormGroup=this.fb.group({name:[""],enabled:[!0],enabledDeliveryMethods:this.fb.group(_e({},e))}),this.valueChange$=this.notificationSettingsFormGroup.valueChanges.subscribe(()=>{this.updateModel()})}ngOnDestroy(){this.valueChange$&&(this.valueChange$.unsubscribe(),this.valueChange$=null)}setDisabledState(e){this.disabled=e,this.disabled?this.notificationSettingsFormGroup.disable({emitEvent:!1}):this.notificationSettingsFormGroup.enable({emitEvent:!1})}getChecked(e){if(e)return this.notificationSettingsFormGroup.get("enabledDeliveryMethods").get(e).value;{let n=Object.values(this.notificationSettingsFormGroup.get("enabledDeliveryMethods").value),t=n.some(l=>l===!0);return t!==this.notificationSettingsFormGroup.get("enabled").value&&setTimeout(()=>this.notificationSettingsFormGroup.get("enabled").patchValue(t),0),n.every(l=>l)}}toggleDeliviryMethod(e){this.notificationSettingsFormGroup.get("enabledDeliveryMethods").get(e).patchValue(!this.notificationSettingsFormGroup.get("enabledDeliveryMethods").get(e).value)}changeInstanceTypeCheckBox(e){let n=Tt(this.notificationSettingsFormGroup.get("enabledDeliveryMethods").value);Object.keys(n).forEach(t=>{n[t]=e}),this.notificationSettingsFormGroup.get("enabled").patchValue(e,{emitEvent:!1}),this.notificationSettingsFormGroup.get("enabledDeliveryMethods").patchValue(n),this.notificationSettingsFormGroup.markAsDirty()}getIndeterminate(){if(!this.notificationSettingsFormGroup.get("enabled").value)return!1;let e=Object.values(this.notificationSettingsFormGroup.get("enabledDeliveryMethods").value),n=e.filter(t=>t);return n.length!==0&&n.length!==e.length}writeValue(e){Oe(e)&&this.notificationSettingsFormGroup.patchValue(e,{emitEvent:!1})}updateModel(){this.propagateChange(this.notificationSettingsFormGroup.value)}static{this.\u0275fac=function(n){return new(n||i)(g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-notification-setting-form"]],inputs:{disabled:"disabled",deliveryMethods:"deliveryMethods"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0}])],decls:8,vars:9,consts:[[1,"flex","flex-col",3,"formGroup"],[1,"flex","flex-row",2,"height","48px"],[1,"flex","max-w-50%","flex-full","items-center","justify-start"],["color","primary",3,"click","change","checked","indeterminate"],[1,"notification-type"],["class","flex flex-1 flex-row",4,"ngFor","ngForOf"],[1,"flex","flex-1","flex-row"],[1,"flex","flex-1","items-center","justify-start"],["color","primary",3,"click","checked"]],template:function(n,t){if(n&1&&(r(0,"form",0)(1,"div",1)(2,"div",2)(3,"mat-checkbox",3),_("click",function(u){return u.stopPropagation()})("change",function(u){return t.changeInstanceTypeCheckBox(u.checked)}),r(4,"span",4),p(5),d(6,"translate"),a()()(),b(7,lw,3,1,"div",5),a()()),n&2){let l;s("formGroup",t.notificationSettingsFormGroup),o(3),s("checked",t.getChecked())("indeterminate",t.getIndeterminate()),o(),V("notification-type-disabled",!t.notificationSettingsFormGroup.get("enabled").value),o(),h(" ",c(6,7,(l=t.notificationTemplateTypeTranslateMap.get(t.notificationSettingsFormGroup.get("name").value))==null?null:l.name)," "),o(2),s("ngForOf",t.deliveryMethods)}},dependencies:[Te,$t,ce,K,ie,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .notification-type[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   .notification-type-disabled[_ngcontent-%COMP%]{color:#00000061}']})}}return i})();function mw(i,m){i&1&&f(0,"mat-progress-bar",20)}function dw(i,m){i&1&&f(0,"div",21)}function cw(i,m){if(i&1){let e=j();r(0,"div",22)(1,"div",23)(2,"mat-checkbox",24),_("change",function(t){let l=I(e).$implicit,u=v();return M(u.changeInstanceTypeCheckBox(t.checked,l))})("click",function(t){return I(e),M(t.stopPropagation())}),r(3,"mat-label"),p(4),d(5,"translate"),a()()()()}if(i&2){let e=m.$implicit,n=v();o(2),s("checked",n.getChecked(e))("indeterminate",n.getIndeterminate(e)),o(2),O(c(5,3,n.notificationDeliveryMethodInfoMap.get(e).name))}}function uw(i,m){i&1&&f(0,"mat-divider")}function fw(i,m){if(i&1&&(r(0,"div"),f(1,"tb-notification-setting-form",25),b(2,uw,1,0,"mat-divider",26),a()),i&2){let e=m.$implicit,n=m.last,t=v();o(),s("formControl",e)("deliveryMethods",t.notificationDeliveryMethods),o(),s("ngIf",!n)}}var Mm=(()=>{class i extends Mt{constructor(e,n,t,l,u,y){super(e),this.store=e,this.route=n,this.translate=t,this.dialogService=l,this.notificationService=u,this.fb=y,this.notificationDeliveryMethodInfoMap=Ca,this.deliveryMethods=new Set([Cd.SLACK,Cd.MICROSOFT_TEAMS]),this.getChecked=(w=null)=>{let x=this.notificationSettings.get("prefs").value;return Oe(w)?Oe(x)&&x.every(q=>q.enabledDeliveryMethods[w]):Oe(x)&&x.every(q=>q.enabled)},this.getSomeChecked=()=>{let w=this.notificationSettings.get("prefs").value;return Oe(w)&&w.some(x=>x.enabled)},this.getIndeterminate=(w=null)=>{let x=this.notificationSettings.get("prefs").value;if(Oe(x)){let q=Oe(w)?x.filter(De=>De.enabledDeliveryMethods[w]):x.filter(De=>De.enabled);return q.length!==0&&q.length!==x.length}return!1},this.changeInstanceTypeCheckBox=(w,x=null)=>{let q=Tt(this.notificationSettings.get("prefs").value);Oe(x)?q.forEach(De=>De.enabledDeliveryMethods[x]=w):q.forEach(De=>{De.enabled=w,De.enabledDeliveryMethods=Object.keys(De.enabledDeliveryMethods).reduce((Ve,Ct)=>Ii(_e({},Ve),{[Ct]:w}),{})}),this.notificationSettings.get("prefs").patchValue(q,{emitEvent:!1}),this.notificationSettings.markAsDirty()},this.notificationService.getAvailableDeliveryMethods({ignoreLoading:!0}).subscribe(w=>{this.notificationDeliveryMethods=w.filter(x=>!this.deliveryMethods.has(x)),this.patchNotificationSettings(this.route.snapshot.data.userSettings)})}ngOnInit(){this.buildNotificationSettingsForm()}buildNotificationSettingsForm(){this.notificationSettings=this.fb.group({prefs:this.fb.array([])})}patchNotificationSettings(e){let n=[];e.prefs&&this.prepareNotificationSettings(e.prefs).forEach(t=>n.push(this.fb.control(t,[S.required]))),this.notificationSettings.setControl("prefs",this.fb.array(n),{emitEvent:!1})}prepareNotificationSettings(e){return Object.entries(e).map(n=>{if(n[1].name=n[0],!n[1].enabled&&Object.values(n[1].enabledDeliveryMethods).some(t=>t===!0)){let t=Tt(n[1].enabledDeliveryMethods);Object.keys(t).forEach(l=>{t[l]=!1}),n[1].enabledDeliveryMethods=t}return n[1].enabledDeliveryMethods=Object.assign(this.notificationDeliveryMethods.reduce((t,l)=>Ii(_e({},t),{[l]:!0}),{}),n[1].enabledDeliveryMethods),n[1]})}resetSettings(){this.dialogService.confirm(this.translate.instant("notification.settings.reset-all-title"),this.translate.instant("notification.settings.reset-all-text"),this.translate.instant("action.no"),this.translate.instant("action.yes"),!0).subscribe(e=>{if(e){let n=this.prepareNotificationSettings(this.route.snapshot.data.userSettings.prefs),t=[];this.notificationSettings.reset({}),n&&n.forEach(l=>{l.enabled=!0,l.enabledDeliveryMethods=this.notificationDeliveryMethods.reduce((u,y)=>Ii(_e({},u),{[y]:!0}),{}),t.push(this.fb.control(l,[S.required]))}),this.notificationSettings.setControl("prefs",this.fb.array(t),{emitEvent:!1}),this.save()}})}get notificationSettingsFormArray(){return this.notificationSettings.get("prefs")}save(){let e={prefs:{}};this.notificationSettings.getRawValue().prefs.forEach(n=>{let t=n.name;delete n.name,e.prefs[t]=n}),this.notificationService.saveNotificationUserSettings(e).subscribe(n=>{this.notificationSettings.get("prefs").reset({}),this.patchNotificationSettings(n)})}confirmForm(){return this.notificationSettings}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Vi),g(Z),g(jt),g(bi),g(de))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-notification-settings"]],features:[L],decls:33,vars:23,consts:[["appearance","outlined",1,"settings-card","tb-absolute-fill"],[1,"flex","flex-1","flex-row","items-start","justify-between","xs:flex-col","xs:justify-start","xs:gap-2"],[1,"flex","flex-1","flex-col"],["translate","",1,"mat-headline-5"],[1,"flex","flex-col"],["mat-button","","color","primary",3,"click","disabled"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px","overflow","hidden"],[1,"notification-form",3,"formGroup"],[1,"notification-section"],[1,"notification-section-block"],[1,"flex","flex-row","items-center","justify-start",2,"height","44px"],[1,"max-w-50%","flex-full"],["color","warn",3,"click","change","indeterminate","checked"],["translate",""],["class","flex-1",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"flex","flex-row","items-start","justify-end",2,"padding","16px"],["mat-button","","mat-raised-button","","color","primary","type","button",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"flex-1"],[1,"flex","flex-1","items-center","justify-start"],["color","warn",3,"change","click","checked","indeterminate"],[3,"formControl","deliveryMethods"],[4,"ngIf"]],template:function(n,t){n&1&&(r(0,"div")(1,"mat-card",0)(2,"mat-card-header")(3,"div",1)(4,"div",2)(5,"span",3),p(6,"notification.settings.notification-settings"),a()(),r(7,"div",4)(8,"button",5),d(9,"async"),_("click",function(){return t.resetSettings()}),p(10),d(11,"translate"),a()()()(),b(12,mw,1,0,"mat-progress-bar",6),d(13,"async"),b(14,dw,1,0,"div",7),d(15,"async"),r(16,"mat-card-content",8)(17,"form",9)(18,"section",10)(19,"div",11)(20,"div",12)(21,"div",13)(22,"mat-checkbox",14),_("click",function(u){return u.stopPropagation()})("change",function(u){return t.changeInstanceTypeCheckBox(u.checked)}),r(23,"mat-label",15),p(24,"notification.settings.type"),a()()(),b(25,cw,6,5,"div",16),a(),f(26,"mat-divider"),b(27,fw,3,3,"div",17),a()()()(),r(28,"div",18)(29,"button",19),d(30,"async"),_("click",function(){return t.save()}),p(31),d(32,"translate"),a()()()()),n&2&&(o(8),s("disabled",c(9,11,t.isLoading$)),o(2),O(c(11,13,"notification.settings.reset-all")),o(2),s("ngIf",c(13,15,t.isLoading$)),o(2),s("ngIf",!c(15,17,t.isLoading$)),o(3),s("formGroup",t.notificationSettings),o(5),s("indeterminate",t.getIndeterminate())("checked",t.getChecked()),o(3),s("ngForOf",t.notificationDeliveryMethods),o(2),s("ngForOf",t.notificationSettingsFormArray.controls),o(2),s("disabled",c(30,19,t.isLoading$)||t.notificationSettings.invalid||!t.notificationSettings.dirty),o(2),h(" ",c(32,21,"action.save")," "))},dependencies:[Te,G,ee,$t,Xt,ni,ci,qe,Ce,mn,ce,W,K,ii,ie,J,Im,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}@media screen and (min-width: 960px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .mat-headline-5[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .notification-form[_ngcontent-%COMP%]{height:100%;min-height:min-content;max-height:min-content}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .notification-section[_ngcontent-%COMP%]{height:100%;border:1px solid rgba(0,0,0,.12);overflow:scroll}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .notification-section-block[_ngcontent-%COMP%]{min-width:470px}']})}}return i})();var wm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,Em,ve]})}}return i})();(function(){Q(wm,{declarations:[_m,Cm,Sm,Ds,po,_s,Tm,Oo,xm,Mm,Im,J0,$0],imports:[ne,oe,Em,ve]})})();C();C();C();var Lg=[{path:"notificationSettings",component:Mm,canDeactivate:[xe],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN,E.CUSTOMER_USER],title:"account.notification-settings",breadcrumb:{label:"account.notification-settings",icon:"settings"}},resolve:{userSettings:()=>qt(bi).getNotificationUserSettings()}}];var gw=[{path:"account",component:un,data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN,E.CUSTOMER_USER],showMainLoadingBar:!1,breadcrumb:{label:"account.account",icon:"account_circle"},useChildrenRoutesForTabs:!0},resolve:{replaceUrl:()=>Li(qt(F)).forceFullscreen},children:[{path:"",children:[],data:{auth:[E.SYS_ADMIN,E.TENANT_ADMIN,E.CUSTOMER_USER],redirectTo:"/account/profile"}},...Cg,...Ig,...Lg]}],Dm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[B.forChild(gw),B]})}}return i})();(function(){Q(Dm,{imports:[B],exports:[B]})})();var Pm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,Dm]})}}return i})();(function(){Q(Pm,{imports:[ne,Dm]})})();C();C();var Fm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,wa]})}}return i})();(function(){Q(Fm,{declarations:[cr,Ra,bl,hl,wo,dr,vl],imports:[ne,oe,wa],exports:[cr]})})();hc(wo,[Te,G,S0,ee,Ee,ae,Pt,_a,ya,va,W,ii,J,dr],[R]);var Am=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,Fm,cl,wa]})}}return i})();(function(){Q(Am,{declarations:[gl,yl],imports:[ne,oe,ve,Fm,cl,wa]})})();C();var Nm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,gm]})}}return i})();(function(){Q(Nm,{imports:[ne,oe,ve,gm]})})();C();C();C();C();C();C();function hw(i,m){if(i&1){let e=j();r(0,"button",6),_("click",function(){I(e);let t=v();return M(t.apply())}),p(1),d(2,"translate"),a()}if(i&2){let e=v();s("disabled",e.editorControl.invalid||!e.editorControl.dirty),o(),h(" ",c(2,2,"action.apply")," ")}}var gr=(()=>{class i{constructor(e){this.fb=e,this.editorContentApplied=new Dt,this.tinyMceOptions={base_url:"/assets/tinymce",suffix:".min",plugins:["link","table","image","imagetools","lists"],menubar:"edit insert view format",toolbar:["fontfamily fontsize | bold italic underline strikethrough forecolor backcolor","alignleft aligncenter alignright alignjustify | bullist | link table image"],toolbar_mode:"sliding",height:400,autofocus:!1,branding:!1,promotion:!1,resize:!1,setup:n=>{n.on("PostRender",function(){let t=n.getContainer().closest(".tb-popover-content"),l=document.querySelector(".tox.tox-tinymce-aux");t.parentNode.appendChild(l)})},relative_urls:!1,urlconverter_callback:n=>n}}ngOnInit(){this.editorControl=this.fb.control(this.content),this.disabled&&(this.editorControl.disable({emitEvent:!1}),this.tinyMceOptions.toolbar=!1,this.tinyMceOptions.menubar=!1,this.tinyMceOptions.statusbar=!1)}cancel(){this.popover?.hide()}apply(){this.editorControl.valid&&this.editorContentApplied.emit(this.editorControl.value)}static{this.\u0275fac=function(n){return new(n||i)(g(dt))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-release-notes-panel"]],inputs:{disabled:"disabled",content:"content",title:"title",popover:"popover"},outputs:{editorContentApplied:"editorContentApplied"},decls:10,vars:9,consts:[[1,"tb-editor-panel"],[1,"tb-editor-title"],[1,"tb-editor",3,"init","formControl"],[1,"tb-editor-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"div",1),p(2),d(3,"translate"),a(),f(4,"editor",2),r(5,"div",3)(6,"button",4),_("click",function(){return t.cancel()}),p(7),d(8,"translate"),a(),b(9,hw,3,4,"button",5),a()()),n&2&&(o(2),O(c(3,5,t.title)),o(2),s("init",t.tinyMceOptions)("formControl",t.editorControl),o(3),h(" ",c(8,7,"action.cancel")," "),o(2),s("ngIf",!t.disabled))},dependencies:[G,ee,W,ii,Iu,R],styles:[`@charset "UTF-8";.tb-editor-panel{width:600px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-editor-panel{width:90vw}}.tb-editor-panel .tb-editor-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-editor-panel .tb-editor{height:400px;overflow-y:auto}.tb-editor-panel .tb-editor-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2})}}return i})();function bw(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.mobile-package-required")," "))}function vw(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.mobile-package-max-length")," "))}function yw(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.mobile-package-pattern")," "))}function _w(i,m){if(i&1&&(r(0,"mat-option",28),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.platformTypeTranslations.get(e))," ")}}function Cw(i,m){if(i&1){let e=j();r(0,"button",29),d(1,"translate"),_("click",function(t){I(e);let l=v();return M(l.generateAppSecret(t))}),r(2,"tb-icon"),p(3,"cached"),a()()}i&2&&T("matTooltip",c(1,1,"mobile.generate-application-secret"))}function Sw(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.application-secret-required")," "))}function Tw(i,m){if(i&1&&(r(0,"mat-option",28),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.mobileAppStatusTranslations.get(e))," ")}}function xw(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.invalid-version-pattern")," "))}function Ew(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.invalid-version-pattern")," "))}function Iw(i,m){if(i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2){let e=v();o(),h(" ",c(2,1,e.entityForm.get("platformType").value===e.PlatformType.ANDROID?"mobile.google-play-link-required":"mobile.app-store-link-required")," ")}}function Mw(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.invalid-store-link")," "))}function ww(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.sha256-certificate-fingerprints-required")," "))}function Dw(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.sha256-certificate-fingerprints-pattern")," "))}function Pw(i,m){if(i&1&&(r(0,"mat-form-field",15)(1,"mat-label",4),p(2,"mobile.sha256-certificate-fingerprints"),a(),f(3,"input",30)(4,"tb-copy-button",6),d(5,"translate"),b(6,ww,3,3,"mat-error",7)(7,Dw,3,3,"mat-error",7),a()),i&2){let e=v();o(3),s("required",e.entityForm.get("status").value===e.MobileAppStatus.PUBLISHED),o(),T("tooltipText",c(5,5,"mobile.copy-sha256-certificate-fingerprints")),s("copyText",e.entityForm.get("storeInfo.sha256CertFingerprints").value),o(2),s("ngIf",e.entityForm.get("storeInfo.sha256CertFingerprints").hasError("required")),o(),s("ngIf",e.entityForm.get("storeInfo.sha256CertFingerprints").hasError("pattern"))}}function Fw(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.app-id-required")," "))}function Aw(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.app-id-pattern")," "))}function Nw(i,m){if(i&1&&(r(0,"mat-form-field",15)(1,"mat-label",4),p(2,"mobile.app-id"),a(),f(3,"input",31)(4,"tb-copy-button",6),d(5,"translate"),b(6,Fw,3,3,"mat-error",7)(7,Aw,3,3,"mat-error",7),a()),i&2){let e=v();o(3),s("required",e.entityForm.get("status").value===e.MobileAppStatus.PUBLISHED),o(),T("tooltipText",c(5,5,"mobile.copy-app-id")),s("copyText",e.entityForm.get("storeInfo.appId").value),o(2),s("ngIf",e.entityForm.get("storeInfo.appId").hasError("required")),o(),s("ngIf",e.entityForm.get("storeInfo.appId").hasError("pattern"))}}var qa=(()=>{class i extends Bt{constructor(e,n,t,l,u,y,w,x,q){super(e,y,t,l,u),this.store=e,this.translate=n,this.entityValue=t,this.entitiesTableConfigValue=l,this.cd=u,this.fb=y,this.popoverService=w,this.renderer=x,this.viewContainerRef=q,this.entityType=k,this.platformTypes=[ji.ANDROID,ji.IOS],this.MobileAppStatus=ki,this.PlatformType=ji,this.mobileAppStatuses=Object.keys(ki),this.platformTypeTranslations=Kn,this.mobileAppStatusTranslations=xs}buildForm(e){let n=this.fb.group({pkgName:[e?.pkgName?e.pkgName:"",[S.required,S.maxLength(255),S.pattern(/^[a-zA-Z][a-zA-Z\d_]*(?:\.[a-zA-Z][a-zA-Z\d_]*)+$/)]],platformType:[e?.platformType?e.platformType:ji.ANDROID],appSecret:[e?.appSecret?e.appSecret:btoa(Ja(64)),[S.required,this.base64Format]],status:[e?.status?e.status:ki.DRAFT],versionInfo:this.fb.group({minVersion:[e?.versionInfo?.minVersion?e.versionInfo.minVersion:"",S.pattern(/^\d+\.\d+\.\d+(-[a-zA-Z\d-.]+)?(\+[a-zA-Z\d-.]+)?$/)],minVersionReleaseNotes:[e?.versionInfo?.minVersionReleaseNotes?e.versionInfo.minVersionReleaseNotes:""],latestVersion:[e?.versionInfo?.latestVersion?e.versionInfo.latestVersion:"",S.pattern(/^\d+\.\d+\.\d+(-[a-zA-Z\d-.]+)?(\+[a-zA-Z\d-.]+)?$/)],latestVersionReleaseNotes:[e?.versionInfo?.latestVersionReleaseNotes?e.versionInfo.latestVersionReleaseNotes:""]}),storeInfo:this.fb.group({storeLink:[e?.storeInfo?.storeLink?e.storeInfo.storeLink:"",S.pattern(/^https?:\/\/play\.google\.com\/store\/apps\/details\?id=[a-zA-Z0-9._]+(?:&[a-zA-Z0-9._-]+=[a-zA-Z0-9._%-]*)*$/)],sha256CertFingerprints:[e?.storeInfo?.sha256CertFingerprints?e.storeInfo.sha256CertFingerprints:"",S.pattern(/^[A-Fa-f0-9]{2}(:[A-Fa-f0-9]{2}){31}$/)],appId:[e?.storeInfo?.appId?e.storeInfo.appId:"",S.pattern(/^[A-Z0-9]{10}\.[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)*$/)]})});return n.get("platformType").valueChanges.pipe(Ne()).subscribe(t=>{t===ji.ANDROID?(n.get("storeInfo.sha256CertFingerprints").enable({emitEvent:!1}),n.get("storeInfo.appId").disable({emitEvent:!1}),n.get("storeInfo.storeLink").setValidators(S.pattern(/^https?:\/\/play\.google\.com\/store\/apps\/details\?id=[a-zA-Z0-9._]+(?:&[a-zA-Z0-9._-]+=[a-zA-Z0-9._%-]*)*$/))):t===ji.IOS&&(n.get("storeInfo.sha256CertFingerprints").disable({emitEvent:!1}),n.get("storeInfo.appId").enable({emitEvent:!1}),n.get("storeInfo.storeLink").setValidators(S.pattern(/^https?:\/\/apps\.apple\.com\/[a-z]{2}\/app\/[\w-]+\/id\d{7,10}(?:\?[^\s]*)?$/))),n.get("storeInfo.storeLink").setValue("",{emitEvent:!1})}),n.get("status").valueChanges.pipe(Ne()).subscribe(t=>{t===ki.PUBLISHED?(n.get("storeInfo.storeLink").addValidators(S.required),n.get("storeInfo.sha256CertFingerprints").addValidators(S.required),n.get("storeInfo.appId").addValidators(S.required)):(n.get("storeInfo.storeLink").clearValidators(),n.get("storeInfo.sha256CertFingerprints").removeValidators(S.required),n.get("storeInfo.appId").removeValidators(S.required)),n.get("storeInfo.storeLink").updateValueAndValidity({emitEvent:!1}),n.get("storeInfo.sha256CertFingerprints").updateValueAndValidity({emitEvent:!1}),n.get("storeInfo.appId").updateValueAndValidity({emitEvent:!1})}),n}updateForm(e){this.entityForm.patchValue(e,{emitEvent:!1})}updateFormState(){super.updateFormState(),this.isEdit&&this.entityForm&&!this.isAdd&&(this.entityForm.get("status").updateValueAndValidity({onlySelf:!0}),this.entityForm.get("platformType").updateValueAndValidity({onlySelf:!0}),this.entityForm.get("platformType").disable({emitEvent:!1}),this.entityForm.get("platformType").value===ji.ANDROID?this.entityForm.get("storeInfo.appId").disable({emitEvent:!1}):this.entityForm.get("platformType").value===ji.IOS&&this.entityForm.get("storeInfo.sha256CertFingerprints").disable({emitEvent:!1})),this.entityForm&&this.isAdd&&this.entityForm.get("storeInfo.appId").disable({emitEvent:!1})}prepareFormValue(e){return e.storeInfo=this.entityForm.get("storeInfo").value,super.prepareFormValue(e)}generateAppSecret(e){e.stopPropagation(),this.entityForm.get("appSecret").setValue(btoa(Ja(64))),this.entityForm.get("appSecret").markAsDirty()}editReleaseNote(e,n,t){e&&e.stopPropagation();let l=n._elementRef.nativeElement;if(this.popoverService.hasPopover(l))this.popoverService.hidePopover(l);else{let u={disabled:!(this.isAdd||this.isEdit),title:t?"mobile.latest-version-release-notes":"mobile.min-version-release-notes",content:t?this.entityForm.get("versionInfo.latestVersionReleaseNotes").value:this.entityForm.get("versionInfo.minVersionReleaseNotes").value},y=this.popoverService.displayPopover({trigger:l,renderer:this.renderer,hostView:this.viewContainerRef,componentType:gr,preferredPlacement:["leftOnly","leftBottomOnly","leftTopOnly"],context:u,showCloseButton:!1,popoverContentStyle:{padding:"16px 24px"},isModal:!1});y.tbComponentRef.instance.popover=y,y.tbComponentRef.instance.editorContentApplied.subscribe(w=>{y.hide(),t?(this.entityForm.get("versionInfo.latestVersionReleaseNotes").setValue(w),this.entityForm.get("versionInfo.latestVersionReleaseNotes").markAsDirty()):(this.entityForm.get("versionInfo.minVersionReleaseNotes").setValue(w),this.entityForm.get("versionInfo.minVersionReleaseNotes").markAsDirty())})}}base64Format(e){if(e.value==="")return null;try{return atob(e.value).length<64?{minLength:!0}:null}catch{return{base64:!0}}}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(Z),g("entity",8),g("entitiesTableConfig",8),g(Qe),g(dt),g(Pn),g(vn),g(nn))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-mobile-app"]],features:[L],decls:75,vars:39,consts:[["editMinReleaseNotesVersionButton",""],["editLatestReleaseNotesVersionButton",""],[1,"mat-padding","flex","flex-col",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic"],["translate",""],["matInput","","required","","formControlName","pkgName"],["matSuffix","","miniButton","false","tooltipPosition","above","icon","content_copy",3,"copyText","tooltipText"],[4,"ngIf"],["appearance","outline",1,"flex"],["formControlName","platformType"],[3,"value",4,"ngFor","ngForOf"],["matInput","","required","","formControlName","appSecret",3,"placeholder"],["matSuffix","",2,"display","flex","align-items","center"],["mat-icon-button","","type","button","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["miniButton","false","tooltipPosition","above","icon","content_copy",3,"copyText","tooltipText"],["appearance","outline"],["formControlName","status"],["formGroupName","versionInfo",1,"tb-form-panel","stroked","no-padding-bottom",2,"margin-bottom","21px"],["translate","",1,"tb-form-panel-title"],[1,"flex","flex-col"],[1,"flex","flex-row"],["appearance","outline","subscriptSizing","dynamic",1,"flex-1"],["matInput","","formControlName","minVersion"],["mat-icon-button","","type","button","matTooltipPosition","above",2,"margin-top","4px","color","#00000061",3,"click","matTooltip"],["matInput","","formControlName","latestVersion"],["formGroupName","storeInfo",1,"tb-form-panel","stroked","no-padding-bottom"],["matInput","","formControlName","storeLink",3,"required"],["appearance","outline",4,"ngIf"],[3,"value"],["mat-icon-button","","type","button","matTooltipPosition","above",3,"click","matTooltip"],["matInput","","formControlName","sha256CertFingerprints",3,"required"],["matInput","","formControlName","appId",3,"required"]],template:function(n,t){if(n&1){let l=j();r(0,"section",2)(1,"mat-form-field",3)(2,"mat-label",4),p(3,"mobile.mobile-package"),a(),f(4,"input",5)(5,"tb-copy-button",6),d(6,"translate"),f(7,"mat-hint"),b(8,bw,3,3,"mat-error",7)(9,vw,3,3,"mat-error",7)(10,yw,3,3,"mat-error",7),a(),r(11,"mat-form-field",8)(12,"mat-label",4),p(13,"mobile.platform-type"),a(),r(14,"mat-select",9),b(15,_w,3,4,"mat-option",10),a()(),r(16,"mat-form-field",3)(17,"mat-label",4),p(18,"mobile.application-secret"),a(),f(19,"input",11),d(20,"translate"),r(21,"div",12),b(22,Cw,4,3,"button",13),f(23,"tb-copy-button",14),d(24,"translate"),a(),f(25,"mat-hint"),b(26,Sw,3,3,"mat-error",7),a(),r(27,"mat-form-field",15)(28,"mat-label",4),p(29,"mobile.status"),a(),r(30,"mat-select",16),b(31,Tw,3,4,"mat-option",10),a()(),r(32,"section",17)(33,"div",18),p(34,"mobile.version-information"),a(),r(35,"section",19)(36,"section",20)(37,"mat-form-field",21)(38,"mat-label",4),p(39,"mobile.min-version"),a(),f(40,"input",22)(41,"mat-hint"),b(42,xw,3,3,"mat-error",7),a(),r(43,"button",23,0),d(45,"translate"),_("click",function(y){I(l);let w=U(44);return M(t.editReleaseNote(y,w,!1))}),r(46,"tb-icon"),p(47,"mdi:text-box-edit"),a()()(),r(48,"section",20)(49,"mat-form-field",21)(50,"mat-label",4),p(51,"mobile.latest-version"),a(),f(52,"input",24)(53,"mat-hint"),b(54,Ew,3,3,"mat-error",7),a(),r(55,"button",23,1),d(57,"translate"),_("click",function(y){I(l);let w=U(56);return M(t.editReleaseNote(y,w,!0))}),r(58,"tb-icon"),p(59,"mdi:text-box-edit"),a()()()()(),r(60,"section",25)(61,"div",18),p(62,"mobile.store-information"),a(),r(63,"section",19)(64,"mat-form-field",15)(65,"mat-label"),p(66),d(67,"translate"),a(),f(68,"input",26)(69,"tb-copy-button",6),d(70,"translate"),b(71,Iw,3,3,"mat-error",7)(72,Mw,3,3,"mat-error",7),a(),b(73,Pw,8,7,"mat-form-field",27)(74,Nw,8,7,"mat-form-field",27),a()()()}n&2&&(s("formGroup",t.entityForm),o(5),T("tooltipText",c(6,25,"mobile.copy-application-package")),s("copyText",t.entityForm.get("pkgName").value),o(3),s("ngIf",t.entityForm.get("pkgName").hasError("required")),o(),s("ngIf",t.entityForm.get("pkgName").hasError("maxlength")),o(),s("ngIf",t.entityForm.get("pkgName").hasError("pattern")),o(5),s("ngForOf",t.platformTypes),o(4),T("placeholder",c(20,27,"mobile.set")),o(3),s("ngIf",t.isEdit),o(),T("tooltipText",c(24,29,"mobile.copy-application-secret")),s("copyText",t.entityForm.get("appSecret").value),o(3),s("ngIf",t.entityForm.get("appSecret").hasError("required")),o(5),s("ngForOf",t.mobileAppStatuses),o(11),s("ngIf",t.entityForm.get("versionInfo.minVersion").hasError("pattern")),o(),T("matTooltip",c(45,31,"mobile.min-version-release-notes")),o(11),s("ngIf",t.entityForm.get("versionInfo.latestVersion").hasError("pattern")),o(),T("matTooltip",c(57,33,"mobile.latest-version-release-notes")),o(11),O(c(67,35,t.entityForm.get("platformType").value===t.PlatformType.ANDROID?"mobile.google-play-link":"mobile.app-store-link")),o(2),s("required",t.entityForm.get("status").value===t.MobileAppStatus.PUBLISHED),o(),T("tooltipText",c(70,37,t.entityForm.get("platformType").value===t.PlatformType.ANDROID?"mobile.copy-google-play-link":"mobile.copy-app-store-link")),s("copyText",t.entityForm.get("storeInfo.storeLink").value),o(2),s("ngIf",t.entityForm.get("storeInfo.storeLink").hasError("required")),o(),s("ngIf",t.entityForm.get("storeInfo.storeLink").hasError("pattern")),o(),s("ngIf",t.entityForm.get("platformType").value===t.PlatformType.ANDROID),o(),s("ngIf",t.entityForm.get("platformType").value===t.PlatformType.IOS))},dependencies:[Te,G,Ee,he,me,Ce,Kt,Pe,zt,vt,gt,Pt,ge,W,K,ue,ie,se,bt,J,ga,hi,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}']})}}return i})();C();var km=(()=>{class i extends oi{constructor(e){super(e),this.store=e}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-mobile-app-table-header"]],features:[L],decls:4,vars:0,consts:[[1,"flex","items-center"],["tbTruncateWithTooltip","","translate",""],["tb-help","mobileApplication"]],template:function(n,t){n&1&&(r(0,"section",0)(1,"div",1),p(2,"mobile.applications"),a(),f(3,"div",2),a())},dependencies:[wt,an,J],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%}']})}}return i})();C();function Ow(i,m){i&1&&f(0,"mat-progress-bar",13)}function Rw(i,m){i&1&&f(0,"div")}var Rm=(()=>{class i extends nt{constructor(e,n,t,l,u,y,w,x){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.data=l,this.translate=u,this.sanitizer=y,this.fb=w,this.mobileAppService=x,this.deleteVerification=this.fb.control(""),this.deleteVerificationText=this.translate.instant("mobile.delete-application-phrase"),this.deleteApplicationText=this.sanitizer.bypassSecurityTrustHtml(this.translate.instant("mobile.delete-application-text",{phrase:this.deleteVerificationText}))}cancel(){this.dialogRef.close(!1)}suspend(){this.mobileAppService.getMobileAppInfoById(this.data.id).pipe(_t(e=>(e.status=ki.SUSPENDED,this.mobileAppService.saveMobileApp(e)))).subscribe(()=>{this.dialogRef.close(!0)})}delete(){this.mobileAppService.deleteMobileApp(this.data.id).subscribe(()=>{this.dialogRef.close(!0)})}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(it),g(Ot),g(Z),g(Mr),g(dt),g(Nn))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-remove-app-dialog"]],features:[L],decls:24,vars:23,consts:[["color","primary",1,"justify-between"],["translate",""],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],[4,"ngIf"],["mat-dialog-content","",1,"flex","flex-col","gap-4"],[1,"select-none",3,"innerHTML"],["appearance","outline","subscriptSizing","dynamic"],["matInput","",3,"formControl","placeholder"],["mat-dialog-actions","",1,"justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-button","","mat-raised-button","","color","warn","type","button",3,"click","disabled"],["color","warn","mode","indeterminate"]],template:function(n,t){n&1&&(r(0,"mat-toolbar",0)(1,"h2",1),p(2,"mobile.delete-application"),a(),r(3,"button",2),_("click",function(){return t.cancel()}),r(4,"mat-icon",3),p(5,"close"),a()()(),b(6,Ow,1,0,"mat-progress-bar",4),d(7,"async"),b(8,Rw,1,0,"div",5),d(9,"async"),r(10,"div",6),f(11,"div",7),r(12,"mat-form-field",8),f(13,"input",9),d(14,"translate"),a()(),r(15,"div",10)(16,"button",11),d(17,"async"),_("click",function(){return t.suspend()}),p(18),d(19,"translate"),a(),r(20,"button",12),d(21,"async"),_("click",function(){return t.delete()}),p(22),d(23,"translate"),a()()),n&2&&(o(6),s("ngIf",c(7,9,t.isLoading$)),o(2),s("ngIf",!c(9,11,t.isLoading$)),o(3),s("innerHTML",t.deleteApplicationText,zn),o(2),T("placeholder",c(14,13,"mobile.type-here")),s("formControl",t.deleteVerification),o(3),s("disabled",c(17,15,t.isLoading$)),o(2),h(" ",c(19,17,"action.suspend")," "),o(2),s("disabled",c(21,19,t.isLoading$)||t.deleteVerification.invalid||t.deleteVerification.value!==t.deleteVerificationText),o(2),h(" ",c(23,21,"mobile.delete-application-button-text")," "))},dependencies:[G,ee,Ee,ae,qe,he,me,at,Rt,mt,ge,W,ii,J,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:750px;height:100%;max-width:100%;max-height:100vh;display:grid;grid-template-rows:min-content 4px minmax(auto,1fr) min-content;--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}']})}}return i})();var Bm=(()=>{class i{constructor(e,n,t,l,u){this.translate=e,this.datePipe=n,this.mobileAppService=t,this.truncatePipe=l,this.dialog=u,this.config=new Ge,this.config.selectionEnabled=!1,this.config.entityType=k.MOBILE_APP,this.config.addAsTextButton=!0,this.config.entitiesDeleteEnabled=!1,this.config.rowPointer=!0,this.config.entityTranslations=Ue.get(k.MOBILE_APP),this.config.entityResources=tt.get(k.MOBILE_APP),this.config.entityComponent=qa,this.config.headerComponent=km,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:Zt.DESC},this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"170px"),new Y("pkgName","mobile.application-package","20%",y=>y.pkgName??"",()=>({}),!0,()=>({}),()=>{},!1,{name:this.translate.instant("mobile.copy-application-package"),icon:"content_copy",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.54)"},isEnabled:y=>!!y.pkgName,onAction:(y,w)=>w.pkgName,type:fa.COPY_BUTTON}),new Y("appSecret","mobile.application-secret","15%",y=>this.truncatePipe.transform(y.appSecret,!0,10,"\u2026"),()=>({}),!0,()=>({}),()=>{},!1,{name:this.translate.instant("mobile.copy-application-secret"),icon:"content_copy",style:{padding:"4px","font-size":"16px",color:"rgba(0,0,0,.54)"},isEnabled:y=>!!y.appSecret,onAction:(y,w)=>w.appSecret,type:fa.COPY_BUTTON}),new Y("platformType","mobile.platform-type","15%",y=>this.translate.instant(Kn.get(y.platformType))),new Y("status","mobile.status","15%",y=>`<span style="display: flex;">${this.mobileStatus(y.status)}</span>`,y=>this.mobileStatusStyle(y.status)),new Y("minVersion","mobile.min-version","15%",y=>y.versionInfo?.minVersion??"",()=>({}),!1),new Y("latestVersion","mobile.latest-version","15%",y=>y.versionInfo?.latestVersion??"",()=>({}),!1)),this.config.entitiesFetchFunction=y=>this.mobileAppService.getTenantMobileAppInfos(y),this.config.loadEntity=y=>this.mobileAppService.getMobileAppInfoById(y.id),this.config.saveEntity=y=>this.mobileAppService.saveMobileApp(y),this.config.deleteEntityTitle=y=>this.translate.instant("mobile.delete-application-title-short",{name:y.name}),this.config.deleteEntityContent=()=>this.translate.instant("mobile.delete-application-text-short"),this.config.deleteEntity=y=>this.mobileAppService.deleteMobileApp(y.id),this.config.cellActionDescriptors=this.configureCellActions()}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("action.delete"),icon:"delete",isEnabled:()=>!0,onAction:(e,n)=>this.deleteEntity(e,n)}]}deleteEntity(e,n){e&&e.stopPropagation(),n.status===ki.PUBLISHED?this.dialog.open(Rm,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{id:n.id.id}}).afterClosed().subscribe(t=>{t&&this.config.updateData()}):this.config.getTable().deleteEntity(e,n)}mobileStatus(e){let n=xs.get(e),t="rgba(25, 128, 56, 0.06)";switch(e){case ki.DEPRECATED:t="rgba(250, 164, 5, 0.06)";break;case ki.SUSPENDED:t="rgba(209, 39, 48, 0.06)";break;case ki.DRAFT:t="rgba(0, 148, 255, 0.06)";break}return`<div style="border-radius: 14px; height: 28px; line-height: 20px; padding: 4px 10px;
                        width: fit-content; background-color: ${t}">
                ${this.translate.instant(n)}
            </div>`}mobileStatusStyle(e){let n={fontSize:"14px",color:"#198038"};switch(e){case ki.DEPRECATED:n.color="#FAA405";break;case ki.SUSPENDED:n.color="#D12730";break;case ki.DRAFT:n.color="#0094FF";break}return n}static{this.\u0275fac=function(n){return new(n||i)(D(Z),D(ke),D(Nn),D(I0),D(je))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var Gg=[{path:"applications",data:{breadcrumb:{menuId:be.mobile_apps}},children:[{path:"",component:Le,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"mobile.applications"},resolve:{entitiesTableConfig:Bm}},{path:":entityId",component:rt,canDeactivate:[xe],data:{breadcrumb:{labelFunction:st,icon:"list"},auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"mobile.applications"},resolve:{entitiesTableConfig:Bm}}]}],Bw=[{path:"security-settings/oauth2/mobile-applications",pathMatch:"full",redirectTo:"/mobile-center/applications"}],Vm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[Bm],imports:[B.forChild(Bw),B]})}}return i})();(function(){Q(Vm,{imports:[B],exports:[B]})})();C();C();C();var jm=(()=>{class i extends oi{constructor(e){super(e),this.store=e}static{this.\u0275fac=function(n){return new(n||i)(g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-mobile-bundle-table-header"]],features:[L],decls:4,vars:0,consts:[[1,"flex","items-center"],["tbTruncateWithTooltip","","translate",""],["tb-help","mobileBundle"]],template:function(n,t){n&1&&(r(0,"section",0)(1,"div",1),p(2,"mobile.bundles"),a(),f(3,"div",2),a())},dependencies:[wt,an,J],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:100%}']})}}return i})();C();C();var Vw=["mobileAppComponent"];function jw(i,m){i&1&&f(0,"mat-progress-bar",13)}function Lw(i,m){i&1&&f(0,"div")}var hr=(()=>{class i extends nt{constructor(e,n,t,l,u,y){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.mobileAppService=l,this.data=u,this.errorStateMatcher=y,this.submitted=!1}ngAfterViewInit(){setTimeout(()=>{this.mobileAppComponent.entityForm.markAsDirty(),this.mobileAppComponent.entityForm.patchValue({platformType:this.data.platformType}),this.mobileAppComponent.entityForm.get("platformType").disable({emitEvent:!1}),this.mobileAppComponent.isEdit=!0},0)}isErrorState(e,n){let t=this.errorStateMatcher.isErrorState(e,n),l=!!(e&&e.invalid&&this.submitted);return t||l}cancel(){this.dialogRef.close(null)}save(){this.submitted=!0,this.mobileAppComponent.entityForm.valid&&this.mobileAppService.saveMobileApp(this.mobileAppComponent.entityFormValue()).subscribe(e=>this.dialogRef.close(e))}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(it),g(Nn),g(Ot),g(on,4))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-mobile-app-dialog"]],viewQuery:function(n,t){if(n&1&&Ie(Vw,7),n&2){let l;Me(l=we())&&(t.mobileAppComponent=l.first)}},features:[$e([{provide:on,useExisting:i}]),L],decls:26,vars:21,consts:[["mobileAppComponent",""],[2,"width","850px","max-height","100vh","display","grid","grid-template-rows","min-content 4px minmax(auto, 1fr) min-content",3,"ngSubmit"],["color","primary"],[1,"flex-1"],["tb-help","mobileApplication"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],[4,"ngIf"],["mat-dialog-content","",1,"!p-0"],["mat-dialog-actions","",1,"justify-end"],["mat-button","","color","primary","type","button","cdkFocusInitial","",3,"click","disabled"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["color","warn","mode","indeterminate"]],template:function(n,t){if(n&1){let l=j();r(0,"form",1),_("ngSubmit",function(){return I(l),M(t.save())}),r(1,"mat-toolbar",2)(2,"h2"),p(3),d(4,"translate"),a(),f(5,"span",3)(6,"div",4),r(7,"button",5),_("click",function(){return I(l),M(t.cancel())}),r(8,"mat-icon",6),p(9,"close"),a()()(),b(10,jw,1,0,"mat-progress-bar",7),d(11,"async"),b(12,Lw,1,0,"div",8),d(13,"async"),r(14,"div",9),f(15,"tb-mobile-app",null,0),a(),r(17,"div",10)(18,"button",11),d(19,"async"),_("click",function(){return I(l),M(t.cancel())}),p(20),d(21,"translate"),a(),r(22,"button",12),d(23,"async"),p(24),d(25,"translate"),a()()()}if(n&2){let l=U(16);o(3),O(c(4,7,"mobile.add-application")),o(7),s("ngIf",c(11,9,t.isLoading$)),o(2),s("ngIf",!c(13,11,t.isLoading$)),o(6),s("disabled",c(19,13,t.isLoading$)),o(2),h(" ",c(21,15,"action.cancel")," "),o(2),s("disabled",c(23,17,t.isLoading$)||(l.entityForm==null?null:l.entityForm.invalid)||!(l.entityForm!=null&&l.entityForm.dirty)),o(2),h(" ",c(25,19,"action.add")," ")}},dependencies:[G,wt,ee,Ee,ae,qe,at,Rt,mt,ce,K,En,qa,le,R],encapsulation:2})}}return i})();C();C();C();function Gw(i,m){i&1&&(r(0,"mat-icon",13),d(1,"translate"),p(2," warning "),a()),i&2&&T("matTooltip",c(1,1,"mobile.page-name-required"))}function Uw(i,m){i&1&&(r(0,"mat-icon",13),d(1,"translate"),p(2," warning "),a()),i&2&&T("matTooltip",c(1,1,"mobile.page-name-cannot-contain-only-spaces"))}function qw(i,m){i&1&&(r(0,"mat-icon",13),d(1,"translate"),p(2," warning "),a()),i&2&&T("matTooltip",c(1,1,"mobile.page-name-max-length"))}function Ww(i,m){if(i&1&&(r(0,"mat-option",14),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit,n=v();s("value",e),o(),h(" ",c(2,2,n.mobilePageTypeTranslations.get(e))," ")}}function Hw(i,m){i&1&&(Gt(0),f(1,"tb-dashboard-autocomplete",15),d(2,"translate"),d(3,"translate"),Ut()),i&2&&(o(),T("label",c(2,3,"dashboard.dashboard")),T("placeholder",c(3,5,"dashboard.select-dashboard")),s("selectFirstDashboard",!1))}function zw(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.invalid-url-format")," "))}function $w(i,m){if(i&1&&(Gt(0),r(1,"mat-form-field",5)(2,"mat-label",6),p(3,"mobile.url"),a(),f(4,"input",16)(5,"mat-hint"),b(6,zw,3,3,"mat-error",12),a(),Ut()),i&2){let e=v();o(6),s("ngIf",e.customMobilePageForm.get("url").hasError("pattern"))}}function Jw(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.invalid-path-format")," "))}function Qw(i,m){if(i&1&&(Gt(0),r(1,"mat-form-field",5)(2,"mat-label",6),p(3,"mobile.path"),a(),f(4,"input",17)(5,"mat-hint"),b(6,Jw,3,3,"mat-error",12),a(),Ut()),i&2){let e=v();o(6),s("ngIf",e.customMobilePageForm.get("path").hasError("pattern"))}}var Wa=(()=>{class i{constructor(e,n){this.fb=e,this.store=n,this.mobilePagesTypes=[Oi.DASHBOARD,Oi.WEB_VIEW,Oi.CUSTOM],this.MobilePageType=Oi,this.mobilePageTypeTranslations=Es,this.customMobilePageForm=this.fb.group({visible:[!0],icon:["star"],label:["",[S.required,S.pattern(/\S/),S.maxLength(255)]],type:[Oi.DASHBOARD],dashboardId:this.fb.control(null,S.required),url:[{value:"",disabled:!0},[S.required,S.pattern(Sf)]],path:[{value:"",disabled:!0},[S.required,S.pattern(/^(\/[\w\-._~:/?#[\]@!$&'()*+,;=%]*)?$/)]]}),this.propagateChange=t=>{},this.customMobilePageForm.get("type").valueChanges.pipe(Ne()).subscribe(t=>{switch(this.customMobilePageForm.get("dashboardId").disable({emitEvent:!1}),this.customMobilePageForm.get("url").disable({emitEvent:!1}),this.customMobilePageForm.get("path").disable({emitEvent:!1}),t){case Oi.DASHBOARD:this.customMobilePageForm.get("dashboardId").enable({emitEvent:!1});break;case Oi.WEB_VIEW:this.customMobilePageForm.get("url").enable({emitEvent:!1});break;case Oi.CUSTOM:this.customMobilePageForm.get("path").enable({emitEvent:!1});break}}),kt(this.store).authority===E.SYS_ADMIN&&(this.mobilePagesTypes.shift(),this.customMobilePageForm.get("type").setValue(Oi.WEB_VIEW)),this.customMobilePageForm.valueChanges.pipe(Ne()).subscribe(t=>this.propagateChange(t))}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.customMobilePageForm.disable({emitEvent:!1}):(this.customMobilePageForm.enable({emitEvent:!1}),this.customMobilePageForm.get("type").updateValueAndValidity({onlySelf:!0}))}validate(){return this.customMobilePageForm.valid?null:{invalidCustomMobilePageForm:!0}}writeValue(e){this.customMobilePageForm.patchValue(e,{emitEvent:!1})}static{this.\u0275fac=function(n){return new(n||i)(g(dt),g(F))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-mobile-page-item"]],inputs:{disabled:[2,"disabled","disabled",Go]},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}]),jo],decls:22,vars:11,consts:[[1,"mobile-page-form",3,"formGroup"],[1,"tb-form-row","space-between"],["formControlName","visible",1,"mat-slide","fixed-title-width"],[1,"flex","items-center","justify-center","gap-2"],["asBoxInput","","required","","color","#305680","formControlName","icon"],["appearance","outline","subscriptSizing","dynamic",1,"flex-1"],["translate",""],["required","","matInput","","formControlName","label"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip","class","tb-error",3,"matTooltip",4,"ngIf"],["appearance","outline","subscriptSizing","dynamic"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip",1,"tb-error",3,"matTooltip"],[3,"value"],["formControlName","dashboardId","required","","floatLabel","always","appearance","outline","subscriptSizing","dynamic","requiredText","dashboard.dashboard-required",1,"flex-1",3,"label","placeholder","selectFirstDashboard"],["required","","matInput","","formControlName","url"],["required","","matInput","","formControlName","path"]],template:function(n,t){n&1&&(r(0,"section",0)(1,"div",1)(2,"mat-slide-toggle",2),p(3),d(4,"translate"),a()(),r(5,"div",3),f(6,"tb-material-icon-select",4),r(7,"mat-form-field",5)(8,"mat-label",6),p(9,"mobile.page-name"),a(),f(10,"input",7),b(11,Gw,3,3,"mat-icon",8)(12,Uw,3,3,"mat-icon",8)(13,qw,3,3,"mat-icon",8),a()(),r(14,"mat-form-field",9)(15,"mat-label",6),p(16,"mobile.page-type"),a(),r(17,"mat-select",10),b(18,Ww,3,4,"mat-option",11),a()(),b(19,Hw,4,7,"ng-container",12)(20,$w,7,1,"ng-container",12)(21,Qw,7,1,"ng-container",12),a()),n&2&&(s("formGroup",t.customMobilePageForm),o(3),h(" ",c(4,9,"mobile.visible")," "),o(8),s("ngIf",t.customMobilePageForm.get("label").hasError("required")&&t.customMobilePageForm.get("label").touched),o(),s("ngIf",t.customMobilePageForm.get("label").hasError("pattern")&&t.customMobilePageForm.get("label").touched),o(),s("ngIf",t.customMobilePageForm.get("label").hasError("maxlength")&&t.customMobilePageForm.get("label").touched),o(5),s("ngForOf",t.mobilePagesTypes),o(),s("ngIf",t.customMobilePageForm.get("type").value===t.MobilePageType.DASHBOARD),o(),s("ngIf",t.customMobilePageForm.get("type").value===t.MobilePageType.WEB_VIEW),o(),s("ngIf",t.customMobilePageForm.get("type").value===t.MobilePageType.CUSTOM))},dependencies:[Te,G,dn,ae,he,me,Ce,Kt,Pe,zt,vt,gt,Pt,ht,ge,W,K,ue,ie,se,ba,J,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}[_nghost-%COMP%]   .mobile-page-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}']})}}return i})();var Lm=(()=>{class i extends nt{constructor(e,n,t,l){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.fb=l,this.customMobilePage=this.fb.control(null)}cancel(){this.dialogRef.close(null)}save(){if(this.customMobilePage.valid){let e=jn(this.customMobilePage.value);this.dialogRef.close(e)}}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(it),g(dt))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-add-mobile-page-dialog"]],features:[L],decls:17,vars:13,consts:[["color","primary",1,"justify-between"],["translate",""],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content",""],[3,"formControl"],["mat-dialog-actions","",1,"justify-end"],["mat-button","","color","primary","type","button",3,"click","disabled"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){n&1&&(r(0,"mat-toolbar",0)(1,"h2",1),p(2,"mobile.add-specific-page"),a(),r(3,"button",2),_("click",function(){return t.cancel()}),r(4,"mat-icon",3),p(5,"close"),a()()(),r(6,"div",4),f(7,"tb-mobile-page-item",5),a(),r(8,"div",6)(9,"button",7),d(10,"async"),_("click",function(){return t.cancel()}),p(11),d(12,"translate"),a(),r(13,"button",8),d(14,"async"),_("click",function(){return t.save()}),p(15),d(16,"translate"),a()()),n&2&&(o(7),s("formControl",t.customMobilePage),o(2),s("disabled",c(10,5,t.isLoading$)),o(2),h(" ",c(12,7,"action.cancel")," "),o(2),s("disabled",c(14,9,t.isLoading$)||t.customMobilePage.invalid||!t.customMobilePage.dirty),o(2),h(" ",c(16,11,"action.add")," "))},dependencies:[ee,Ee,ae,at,Rt,mt,W,ii,J,Wa,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:600px;height:100%;max-width:100%;max-height:100vh;display:grid;grid-template-rows:min-content minmax(auto,1fr) min-content}[_nghost-%COMP%]   .mobile-page-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}']})}}return i})();C();C();var Gm=(()=>{class i{constructor(e){this.fb=e,this.customMobilePageApplied=new Dt,this.mobilePageControl=this.fb.control(null)}ngOnInit(){this.mobilePageControl.setValue(this.pageItem,{emitEvent:!1}),this.disabled&&this.mobilePageControl.disable({emitEvent:!1})}cancel(){this.popover?.hide()}apply(){if(this.mobilePageControl.valid){let e=this.mobilePageControl.value;this.customMobilePageApplied.emit(e)}}static{this.\u0275fac=function(n){return new(n||i)(g(dt))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-custom-menu-item-panel"]],inputs:{disabled:"disabled",pageItem:"pageItem",popover:"popover"},outputs:{customMobilePageApplied:"customMobilePageApplied"},decls:12,vars:8,consts:[[1,"tb-custom-mobile-page-panel"],["translate","",1,"tb-custom-mobile-page-title"],[1,"tb-custom-mobile-page-panel-content"],[3,"formControl"],[1,"tb-custom-mobile-page-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"div",1),p(2,"mobile.edit-custom-page"),a(),r(3,"div",2),f(4,"tb-mobile-page-item",3),a(),r(5,"div",4)(6,"button",5),_("click",function(){return t.cancel()}),p(7),d(8,"translate"),a(),r(9,"button",6),_("click",function(){return t.apply()}),p(10),d(11,"translate"),a()()()),n&2&&(o(4),s("formControl",t.mobilePageControl),o(3),h(" ",c(8,4,"action.cancel")," "),o(2),s("disabled",t.mobilePageControl.invalid||!t.mobilePageControl.dirty),o(),h(" ",c(11,6,"action.apply")," "))},dependencies:[ee,W,ii,J,Wa,R],styles:[`@charset "UTF-8";.tb-custom-mobile-page-panel{width:500px;display:flex;flex-direction:column;gap:16px}@media screen and (max-width: 959px){.tb-custom-mobile-page-panel{width:90vw}}.tb-custom-mobile-page-panel .tb-custom-mobile-page-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-custom-mobile-page-panel .tb-custom-mobile-page-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-custom-mobile-page-panel .tb-custom-mobile-page-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2})}}return i})();C();function Yw(i,m){if(i&1){let e=j();r(0,"button",16),d(1,"translate"),_("click",function(){I(e);let t=v();return M(t.cleanup())}),r(2,"tb-icon",17),p(3,"mdi:broom"),a()()}if(i&2){let e=v();T("matTooltip",c(1,3,"mobile.reset-to-page-default")),s("disabled",!e.isCleanupEnabled),o(2),s("color",e.isCleanupEnabled?"primary":null)}}function Kw(i,m){i&1&&(r(0,"mat-icon",18),d(1,"translate"),p(2," warning "),a()),i&2&&T("matTooltip",c(1,1,"mobile.page-name-cannot-contain-only-spaces"))}function Xw(i,m){i&1&&(r(0,"mat-icon",18),d(1,"translate"),p(2," warning "),a()),i&2&&T("matTooltip",c(1,1,"mobile.page-name-max-length"))}var Um=(()=>{class i{constructor(e){this.fb=e,this.defaultMobilePageApplied=new Dt,this.mobilePageFormGroup=this.fb.group({visible:[!0],icon:[""],label:["",[S.pattern(/\S/),S.maxLength(255)]]}),this.isCleanupEnabled=!1,this.destroyRef=qt(ft)}ngOnInit(){this.defaultMobilePages=Za.get(this.pageItem.id),this.defaultItemName=this.defaultMobilePages.label,this.mobilePageFormGroup.patchValue({label:this.pageItem.label,icon:this.pageItem.icon?this.pageItem.icon:this.defaultMobilePages.icon,visible:this.pageItem.visible},{emitEvent:!1}),this.disabled?this.mobilePageFormGroup.disable({emitEvent:!1}):(this.mobilePageFormGroup.valueChanges.pipe(Ne(this.destroyRef)).subscribe(()=>{this.updateModel()}),this.updateCleanupState())}cancel(){this.popover?.hide()}apply(){this.defaultMobilePageApplied.emit(this.pageItem)}cleanup(){this.mobilePageFormGroup.patchValue({visible:!Ia.includes(this.pageItem.id),icon:this.defaultMobilePages.icon,label:null},{emitEvent:!1}),this.mobilePageFormGroup.markAsDirty(),this.updateModel()}updateCleanupState(){this.isCleanupEnabled=(Ia.includes(this.pageItem.id)?this.pageItem.visible:!this.pageItem.visible)||!!this.pageItem.label||!!this.pageItem.icon}updateModel(){this.pageItem.visible=this.mobilePageFormGroup.get("visible").value;let e=this.mobilePageFormGroup.get("label").value;e?this.pageItem.label=e:delete this.pageItem.label;let n=this.mobilePageFormGroup.get("icon").value;n!==this.defaultMobilePages.icon?this.pageItem.icon=n:delete this.pageItem.icon,this.updateCleanupState()}static{this.\u0275fac=function(n){return new(n||i)(g(dt))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-default-mobile-page-panel"]],inputs:{disabled:"disabled",pageItem:"pageItem",popover:"popover"},outputs:{defaultMobilePageApplied:"defaultMobilePageApplied"},decls:25,vars:15,consts:[[1,"tb-default-mobile-page-panel",3,"formGroup"],[1,"tb-default-mobile-page-title-container"],["translate","",1,"tb-default-mobile-page-title"],["type","button","mat-stroked-button","","class","tb-box-button","matTooltipPosition","above",3,"disabled","matTooltip","click",4,"ngIf"],[1,"tb-default-mobile-page-panel-content"],[1,"tb-form-row","space-between"],["formControlName","visible",1,"mat-slide","fixed-title-width"],[1,"flex","items-center","justify-center","gap-2"],["asBoxInput","","color","#305680","formControlName","icon"],["appearance","outline","subscriptSizing","dynamic","floatLabel","always",1,"flex-1"],["translate",""],["matInput","","formControlName","label",3,"placeholder"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip","class","tb-error",3,"matTooltip",4,"ngIf"],[1,"tb-default-mobile-page-panel-buttons"],["mat-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"],["type","button","mat-stroked-button","","matTooltipPosition","above",1,"tb-box-button",3,"click","disabled","matTooltip"],["matButtonIcon","",3,"color"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip",1,"tb-error",3,"matTooltip"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),p(3,"mobile.edit-page"),a(),b(4,Yw,4,5,"button",3),a(),r(5,"div",4)(6,"div",5)(7,"mat-slide-toggle",6),p(8),d(9,"translate"),a()(),r(10,"div",7),f(11,"tb-material-icon-select",8),r(12,"mat-form-field",9)(13,"mat-label",10),p(14,"mobile.page-name"),a(),f(15,"input",11),b(16,Kw,3,3,"mat-icon",12)(17,Xw,3,3,"mat-icon",12),a()()(),r(18,"div",13)(19,"button",14),_("click",function(){return t.cancel()}),p(20),d(21,"translate"),a(),r(22,"button",15),_("click",function(){return t.apply()}),p(23),d(24,"translate"),a()()()),n&2&&(s("formGroup",t.mobilePageFormGroup),o(4),s("ngIf",!t.disabled),o(4),h(" ",c(9,9,"mobile.visible")," "),o(7),T("placeholder",t.defaultItemName),o(),s("ngIf",t.mobilePageFormGroup.get("label").hasError("pattern")&&t.mobilePageFormGroup.get("label").touched),o(),s("ngIf",t.mobilePageFormGroup.get("label").hasError("maxlength")&&t.mobilePageFormGroup.get("label").touched),o(3),h(" ",c(21,11,"action.cancel")," "),o(2),s("disabled",t.mobilePageFormGroup.invalid||!t.mobilePageFormGroup.dirty),o(),h(" ",c(24,13,"action.apply")," "))},dependencies:[G,ee,ae,he,me,Ce,zt,Pt,ht,ge,W,K,ie,se,ba,J,hi,R],styles:[`@charset "UTF-8";.tb-default-mobile-page-panel{width:500px;display:flex;flex-direction:column;gap:16px;--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}@media screen and (max-width: 959px){.tb-default-mobile-page-panel{width:90vw}}.tb-default-mobile-page-panel .tb-default-mobile-page-title-container{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.tb-default-mobile-page-panel .tb-default-mobile-page-title{font-size:16px;font-weight:500;line-height:24px;letter-spacing:.25px;color:#000000de}.tb-default-mobile-page-panel .tb-default-mobile-page-panel-content{display:flex;flex-direction:column;gap:16px;overflow:auto;margin:-10px;padding:10px}.tb-default-mobile-page-panel .tb-default-mobile-page-panel-buttons{height:40px;display:flex;flex-direction:row;gap:16px;justify-content:flex-end;align-items:flex-end}
`],encapsulation:2})}}return i})();var Zw=[[["",8,"tb-custom-menu-item-row-prefix"]]],e3=[".tb-custom-menu-item-row-prefix"];function t3(i,m){i&1&&(r(0,"mat-icon",17),d(1,"translate"),p(2," warning "),a()),i&2&&T("matTooltip",c(1,1,"mobile.page-name-required"))}function i3(i,m){i&1&&(r(0,"mat-icon",17),d(1,"translate"),p(2," warning "),a()),i&2&&T("matTooltip",c(1,1,"mobile.page-name-cannot-contain-only-spaces"))}function n3(i,m){i&1&&(r(0,"mat-icon",17),d(1,"translate"),p(2," warning "),a()),i&2&&T("matTooltip",c(1,1,"mobile.page-name-max-length"))}function o3(i,m){if(i&1&&(r(0,"mat-form-field",18),f(1,"input",19),a()),i&2){let e=v();o(),s("placeholder",e.itemInfo)}}function a3(i,m){if(i&1){let e=j();r(0,"button",20,0),d(2,"translate"),_("click",function(t){I(e);let l=U(1),u=v();return M(u.edit(t,l))}),r(3,"mat-icon"),p(4,"edit"),a()()}i&2&&T("matTooltip",c(2,1,"mobile.edit-page"))}function r3(i,m){if(i&1){let e=j();r(0,"button",21),d(1,"translate"),_("click",function(){I(e);let t=v();return M(t.cleanup())}),r(2,"tb-icon"),p(3,"mdi:broom"),a()()}if(i&2){let e=v();T("matTooltip",c(1,2,"mobile.reset-to-page-default")),s("disabled",!e.isCleanupEnabled)}}function s3(i,m){if(i&1){let e=j();r(0,"button",22),d(1,"translate"),_("click",function(){I(e);let t=v();return M(t.delete())}),r(2,"mat-icon"),p(3,"delete"),a()()}i&2&&T("matTooltip",c(1,1,"mobile.delete-page"))}var qm=(()=>{class i{constructor(e,n,t,l,u,y){this.fb=e,this.cd=n,this.popoverService=t,this.renderer=l,this.viewContainerRef=u,this.translate=y,this.maxIconNameBlockWidth=256,this.pageRemoved=new Dt,this.iconNameBlockWidth="256px",this.isDefaultMenuItem=!1,this.isCustomMenuItem=!1,this.isCleanupEnabled=!1,this.mobilePageRowForm=this.fb.group({visible:[!0,[]],icon:["",[]],label:["",[S.pattern(/\S/),S.maxLength(255)]],type:[Oi.DEFAULT]}),this.propagateChange=w=>{},this.destroyRef=qt(ft),this.mobilePageRowForm.valueChanges.pipe(Ne()).subscribe(()=>this.updateModel())}ngOnInit(){this.updateIconNameBlockWidth(),this.hideItems&&this.hideItems.pipe(Ne(this.destroyRef)).subscribe(()=>{!this.disabled&&this.modelValue.visible&&this.mobilePageRowForm.patchValue({visible:!1},{emitEvent:!0})})}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){this.disabled=e,e?this.mobilePageRowForm.disable({emitEvent:!1}):this.mobilePageRowForm.enable({emitEvent:!1})}validate(){return this.mobilePageRowForm.valid?null:{invalidMobileMenuItem:!0}}writeValue(e){if(this.modelValue=e,this.mobilePageRowForm.patchValue({visible:e.visible,icon:e.icon,label:e.label},{emitEvent:!1}),this.modelValue.type===Oi.DEFAULT){this.isDefaultMenuItem=!0;let n=this.modelValue;Za.has(n.id)&&(this.defaultMobilePages=Za.get(n.id),this.defaultItemName=this.defaultMobilePages.label,e.icon||this.mobilePageRowForm.patchValue({icon:this.defaultMobilePages.icon},{emitEvent:!1}))}else this.isCustomMenuItem=!0,this.mobilePageRowForm.get("label").addValidators([S.required]),this.mobilePageRowForm.get("label").updateValueAndValidity({emitEvent:!1});this.updateCleanupState(),this.updateItemInfo(),this.cd.markForCheck()}cleanup(){let e=!Ia.includes(this.modelValue.id);this.mobilePageRowForm.patchValue({visible:e,icon:this.defaultMobilePages.icon,label:null},{emitEvent:!1}),this.modelValue.visible=e,delete this.modelValue.icon,delete this.modelValue.label,this.updateModel()}delete(){this.pageRemoved.emit()}edit(e,n){e&&e.stopPropagation();let t=n._elementRef.nativeElement;if(this.popoverService.hasPopover(t))this.popoverService.hidePopover(t);else{let l={trigger:t,renderer:this.renderer,componentType:void 0,hostView:this.viewContainerRef,preferredPlacement:["right","bottom","top"],context:{disabled:this.disabled,pageItem:Tt(this.modelValue)},showCloseButton:!1,popoverContentStyle:{padding:"16px 24px"},isModal:!0};if(this.isDefaultMenuItem){l.componentType=Um;let u=this.popoverService.displayPopover(l);u.tbComponentRef.instance.popover=u,u.tbComponentRef.instance.defaultMobilePageApplied.subscribe(y=>{u.hide(),this.afterPageEdit(y)})}else{l.componentType=Gm;let u=this.popoverService.displayPopover(l);u.tbComponentRef.instance.popover=u,u.tbComponentRef.instance.customMobilePageApplied.subscribe(y=>{u.hide(),this.afterPageEdit(y)})}}}get itemName(){return this.isDefaultMenuItem?this.defaultItemName:this.mobilePageRowForm.get("label").value}get itemNamePlaceholder(){return this.isDefaultMenuItem?this.defaultItemName:""}updateIconNameBlockWidth(){this.maxIconNameBlockWidth?this.iconNameBlockWidth=`${this.maxIconNameBlockWidth}px`:this.iconNameBlockWidth="100%"}updateModel(){this.modelValue.visible=this.mobilePageRowForm.get("visible").value;let e=this.mobilePageRowForm.get("label").value;e?.trim()?this.modelValue.label=e:delete this.modelValue.label;let n=this.mobilePageRowForm.get("icon").value;this.isDefaultMenuItem&&this.defaultMobilePages.icon===n&&(n=null),n?this.modelValue.icon=n:delete this.modelValue.icon,this.updateCleanupState(),this.updateItemInfo(),this.propagateChange(this.modelValue)}updateCleanupState(){this.isDefaultMenuItem&&(this.isCleanupEnabled=(Ia.includes(this.modelValue.id)?this.modelValue.visible:!this.modelValue.visible)||!!this.modelValue.label||!!this.modelValue.icon)}updateItemInfo(){this.isCustomMenuItem?this.itemInfo=this.translate.instant(Es.get(this.modelValue.type)):this.itemInfo=""}afterPageEdit(e){this.mobilePageRowForm.patchValue({visible:e.visible,icon:e.icon||(this.isDefaultMenuItem?this.defaultMobilePages.icon:null),label:e.label},{emitEvent:!1}),this.isCustomMenuItem&&(this.modelValue=e),this.updateModel()}static{this.\u0275fac=function(n){return new(n||i)(g(dt),g(Qe),g(Pn),g(vn),g(nn),g(Z))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-mobile-menu-item-row"]],inputs:{disabled:[2,"disabled","disabled",Go],maxIconNameBlockWidth:[2,"maxIconNameBlockWidth","maxIconNameBlockWidth",vc],hideItems:"hideItems"},outputs:{pageRemoved:"pageRemoved"},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}]),jo],ngContentSelectors:e3,decls:21,vars:16,consts:[["editButton",""],[1,"tb-mobile-page-item-row-component-container"],[1,"tb-mobile-page-item-row-component"],[1,"tb-form-row",3,"formGroup"],[1,"tb-mobile-page-item-start-block"],[1,"tb-mobile-page-item-icon-name-block"],["matTooltipPosition","above","formControlName","visible",3,"matTooltip"],["asBoxInput","","color","#305680","formControlName","icon"],["tbTruncateWithTooltip",""],[1,"tb-mobile-page-item-input-block","xs:!hidden"],["appearance","outline","subscriptSizing","dynamic",1,"tb-suffix-absolute","flex"],["matInput","","formControlName","label",3,"required","placeholder"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip","class","tb-error",3,"matTooltip",4,"ngIf"],["class","tb-mobile-page-item-info flex","appearance","outline","subscriptSizing","dynamic",4,"ngIf"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"disabled","matTooltip","click",4,"ngIf"],["mat-icon-button","","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip",1,"tb-error",3,"matTooltip"],["appearance","outline","subscriptSizing","dynamic",1,"tb-mobile-page-item-info","flex"],["matInput","","readonly","",3,"placeholder"],["type","button","mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"],["mat-icon-button","","matTooltipPosition","above",3,"click","disabled","matTooltip"],["mat-icon-button","","matTooltipPosition","above",3,"click","matTooltip"]],template:function(n,t){n&1&&(Lo(Zw),r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),Jn(4),r(5,"div",5),f(6,"mat-slide-toggle",6),d(7,"translate"),f(8,"tb-material-icon-select",7),r(9,"div",8),p(10),a()()(),r(11,"div",9)(12,"mat-form-field",10),f(13,"input",11),b(14,t3,3,3,"mat-icon",12)(15,i3,3,3,"mat-icon",12)(16,n3,3,3,"mat-icon",12),a(),b(17,o3,2,1,"mat-form-field",13),a()(),b(18,a3,5,3,"button",14)(19,r3,4,4,"button",15)(20,s3,4,3,"button",16),a()()),n&2&&(o(2),s("formGroup",t.mobilePageRowForm),o(3),Bi("width",t.iconNameBlockWidth),o(),T("matTooltip",c(7,14,t.mobilePageRowForm.get("visible").value?"mobile.visible":"mobile.hidden")),o(4),h(" ",t.itemName," "),o(3),T("placeholder",t.itemNamePlaceholder),s("required",t.isCustomMenuItem),o(),s("ngIf",t.mobilePageRowForm.get("label").hasError("required")&&t.mobilePageRowForm.get("label").touched),o(),s("ngIf",t.mobilePageRowForm.get("label").hasError("pattern")&&t.mobilePageRowForm.get("label").touched),o(),s("ngIf",t.mobilePageRowForm.get("label").hasError("maxlength")&&t.mobilePageRowForm.get("label").touched),o(),s("ngIf",t.isCustomMenuItem),o(),s("ngIf",!t.disabled),o(),s("ngIf",!t.disabled&&t.isDefaultMenuItem),o(),s("ngIf",!t.disabled&&t.isCustomMenuItem))},dependencies:[G,Ee,ae,he,me,zt,Pt,ht,ge,W,K,ue,ie,se,ba,an,hi,R],styles:[`@charset "UTF-8";.tb-mobile-page-item-row-component-container{display:flex;flex-direction:column;gap:0}.tb-mobile-page-item-row-component{display:flex;gap:8px;align-items:center}@media screen and (max-width: 599px){.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle){width:24px;height:24px;line-height:24px;padding:0!important}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle) .mat-icon{display:block;margin:auto}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle) .mat-mdc-button-touch-target{width:24px;height:24px}}@media screen and (min-width: 600px) and (max-width: 959px){.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle){width:32px;height:32px;line-height:32px;padding:0!important}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle) .mat-icon{display:block;margin:auto}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(.tb-drag-handle) .mat-mdc-button-touch-target{width:32px;height:32px}}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:not(:disabled) .mat-icon{color:#0000008a}.tb-mobile-page-item-row-component .mat-mdc-icon-button.mat-mdc-button-base:disabled .mat-icon{color:#0000001f}.tb-mobile-page-item-row-component .tb-form-row{flex:1;min-width:0}.tb-mobile-page-item-row-component .tb-form-row .tb-mobile-page-item-start-block{display:flex;align-items:center;gap:0;min-width:0}.tb-mobile-page-item-row-component .tb-form-row .tb-mobile-page-item-icon-name-block{display:flex;align-items:center;gap:12px;min-width:0}.tb-mobile-page-item-row-component .tb-form-row .tb-mobile-page-item-input-block{display:flex;gap:8px;flex:1}.tb-mobile-page-item-info .mdc-text-field:not(.mdc-text-field--disabled) input.mdc-text-field__input{cursor:default}.tb-mobile-page-item-info .mdc-text-field:not(.mdc-text-field--disabled) input.mdc-text-field__input::placeholder{color:#305680}.tb-mobile-page-item-info .mdc-text-field:not(.mdc-text-field--disabled) input.mdc-text-field__input:-ms-input-placeholder{color:#305680}
`],encapsulation:2})}}return i})();var p3=["mobilePagesContainer"];function m3(i,m){if(i&1){let e=j();r(0,"button",12),_("click",function(){I(e);let t=v();return M(t.hideAll())}),r(1,"tb-icon",13),p(2,"visibility_off"),a(),r(3,"div",14),p(4),d(5,"translate"),a()()}i&2&&(o(4),O(c(5,1,"mobile.hide-all-pages")))}function d3(i,m){if(i&1){let e=j();r(0,"button",12),_("click",function(){I(e);let t=v();return M(t.resetToDefault())}),r(1,"tb-icon",13),p(2,"mdi:broom"),a(),r(3,"div",14),p(4),d(5,"translate"),a()()}i&2&&(o(4),O(c(5,1,"mobile.reset-to-default-pages")))}function c3(i,m){if(i&1){let e=j();r(0,"button",15),d(1,"translate"),_("click",function(){I(e);let t=v();return M(t.hideAll())}),r(2,"tb-icon",16),p(3,"visibility_off"),a()()}i&2&&T("matTooltip",c(1,1,"mobile.hide-all-pages"))}function u3(i,m){if(i&1){let e=j();r(0,"button",15),d(1,"translate"),_("click",function(){I(e);let t=v();return M(t.resetToDefault())}),r(2,"tb-icon",16),p(3,"mdi:broom"),a()()}i&2&&T("matTooltip",c(1,1,"mobile.reset-to-default-pages"))}function f3(i,m){i&1&&(r(0,"div",23),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.custom-page")," "))}function g3(i,m){i&1&&(r(0,"button",24),d(1,"translate"),r(2,"tb-icon"),p(3,"drag_indicator"),a()()),i&2&&T("matTooltip",c(1,1,"action.drag"))}function h3(i,m){if(i&1&&(r(0,"span",29),p(1),d(2,"translate"),a()),i&2){let e=v(2).index,n=v();o(),O(c(2,1,n.getDividerLabel(e)))}}function b3(i,m){if(i&1){let e=j();r(0,"button",25),d(1,"translate"),_("click",function(){I(e);let t=v().index,l=v();return M(l.addCustomMobilePage(t))}),r(2,"div",26)(3,"mat-icon",27),p(4,"add"),a(),b(5,h3,3,3,"span",28),a()()}if(i&2){let e=v().index,n=v();V("divider",n.showMenuDivider(e)),T("matTooltip",c(1,4,"mobile.add-specific-page")),o(5),s("ngIf",n.showMenuDivider(e))}}function v3(i,m){if(i&1){let e=j();r(0,"div",17)(1,"div",18),b(2,f3,3,3,"div",19)(3,g3,4,3,"button",20),r(4,"tb-mobile-menu-item-row",21),_("pageRemoved",function(){let t=I(e).index,l=v();return M(l.removeCustomPage(t))}),a()(),b(5,b3,6,6,"button",22),a()}if(i&2){let e=m.$implicit,n=m.last,t=v();o(),s("cdkDragDisabled",!t.dragEnabled),o(),s("ngIf",t.isCustom(e)),o(),s("ngIf",t.dragEnabled),o(),s("formControl",e)("maxIconNameBlockWidth",t.maxIconNameBlockWidth)("hideItems",t.hideItems$),o(),s("ngIf",!n&&!t.readonly)}}function y3(i,m){if(i&1){let e=j();r(0,"button",30),_("click",function(){I(e);let t=v();return M(t.addCustomMobilePage())}),r(1,"mat-icon",31),p(2,"add"),a(),r(3,"span",32),p(4,"mobile.add-specific-page"),a()()}}var Wm=(()=>{class i{constructor(e,n,t){this.fb=e,this.breakpointObserver=n,this.dialog=t,this.pagesForm=this.fb.group({pages:this.fb.array([])}),this.maxIconNameBlockWidth=256,this.showHiddenPages=new ia(!0),this.hideItemsSubject=new At,this.hideItems$=this.hideItemsSubject.asObservable(),this.propagateChange=l=>{},this.pagesForm.valueChanges.pipe(Ne()).subscribe(()=>this.updateModel()),this.breakpointObserver.observe([Mi.xs,Mi["gt-xs"],Mi["gt-sm"]]).pipe(Ne()).subscribe(()=>{this.computeMaxIconNameBlockWidth()}),this.computeMaxIconNameBlockWidth()}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){}setDisabledState(e){e?this.pagesForm.disable({emitEvent:!1}):this.pagesForm.enable({emitEvent:!1})}writeValue(e){let n=this.prepareMobilePages(e);this.pagesForm.setControl("pages",this.prepareMobilePagesFormArray(n))}validate(e){return this.pagesForm.valid?null:{invalidLayoutForm:!0}}hideAll(){this.hideItemsSubject.next(),this.showHiddenPages.value&&this.showHiddenPages.setValue(!1)}resetToDefault(){if(!Td(this.pagesForm.value.pages)){let e=this.prepareMobilePages(null);this.pagesForm.setControl("pages",this.prepareMobilePagesFormArray(e))}}get dragEnabled(){return!this.readonly&&this.visibleMobilePagesControls().length>1}visibleMobilePagesControls(){return this.pagesFormArray().controls.filter(e=>this.showHiddenPages.value||e.value.visible)}mobileItemDrop(e){let n=this.pagesFormArray(),t=this.visibleMobilePagesControls()[e.previousIndex],l=this.actualMobilePageIndex(e.previousIndex),u=this.actualMobilePageIndex(e.currentIndex);n.removeAt(l),n.insert(u,t),this.pagesForm.markAsDirty()}trackByMenuItem(e,n){return n}addCustomMobilePage(e){this.dialog.open(Lm,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"]}).afterClosed().subscribe(n=>{if(n){let t=this.pagesFormArray(),l=this.fb.control(n,[]);if(Vn(e)){let u=this.actualMobilePageIndex(e)+1;t.insert(u,l)}else t.push(l),setTimeout(()=>{this.mobilePagesContainer.nativeElement.scrollTop=this.mobilePagesContainer.nativeElement.scrollHeight},0);this.pagesForm.markAsDirty()}})}isCustom(e){return e.value.type!==Oi.DEFAULT}removeCustomPage(e){this.pagesFormArray().removeAt(this.actualMobilePageIndex(e)),this.pagesForm.markAsDirty()}showMenuDivider(e){return xd.has(e)}getDividerLabel(e){return xd.get(e)}updateModel(){Td(this.pagesForm.value.pages)?this.propagateChange(null):this.propagateChange(this.pagesForm.value)}prepareMobilePages(e){return e?.pages?.length?e.pages:Ef()}prepareMobilePagesFormArray(e){let n=[];return e.forEach(t=>{n.push(this.fb.control(Tt(t)))}),this.fb.array(n)}computeMaxIconNameBlockWidth(){this.breakpointObserver.isMatched(Mi["gt-sm"])?this.maxIconNameBlockWidth=256:this.breakpointObserver.isMatched(Mi["gt-xs"])?this.maxIconNameBlockWidth=200:this.maxIconNameBlockWidth=0}pagesFormArray(){return this.pagesForm.get("pages")}actualMobilePageIndex(e){let n=this.visibleMobilePagesControls()[e];return this.pagesFormArray().controls.indexOf(n)}static{this.\u0275fac=function(n){return new(n||i)(g(dt),g(Xn),g(je))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-mobile-layout"]],viewQuery:function(n,t){if(n&1&&Ie(p3,5),n&2){let l;Me(l=we())&&(t.mobilePagesContainer=l.first)}},inputs:{readonly:[2,"readonly","readonly",Go]},features:[$e([{provide:ot,useExisting:Re(()=>i),multi:!0},{provide:Ht,useExisting:Re(()=>i),multi:!0}]),jo],decls:17,vars:12,consts:[["mobilePagesContainer",""],[1,"mobile-layout-container"],[1,"header","flex","items-center","gap-2"],[1,"title-section"],["tbTruncateWithTooltip","","translate","",1,"title-container"],[1,"whitespace-nowrap","xs:!hidden",3,"formControl"],[1,"flex-1"],["class","tb-mobile-layout-button lt-lg:!hidden","mat-stroked-button","","color","primary",3,"click",4,"ngIf"],["type","button","mat-stroked-button","","class","tb-box-button gt-md:!hidden","matTooltipPosition","above",3,"matTooltip","click",4,"ngIf"],["cdkDropList","","cdkDropListOrientation","vertical",1,"tb-drop-list","tb-mobile-items-container",3,"cdkDropListDropped","cdkDropListDisabled"],["class","tb-mobile-item-row-container",4,"ngFor","ngForOf","ngForTrackBy"],["mat-button","","color","primary","class","tb-primary-fill","style","min-height: 52px;",3,"click",4,"ngIf"],["mat-stroked-button","","color","primary",1,"tb-mobile-layout-button","lt-lg:!hidden",3,"click"],["matButtonIcon",""],["tbTruncateWithTooltip",""],["type","button","mat-stroked-button","","matTooltipPosition","above",1,"tb-box-button","gt-md:!hidden",3,"click","matTooltip"],["color","primary","matButtonIcon",""],[1,"tb-mobile-item-row-container"],["cdkDrag","",1,"tb-draggable","tb-mobile-item-row",3,"cdkDragDisabled"],["class","tb-mobile-item-label",4,"ngIf"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above","class","tb-mat-40 tb-drag-handle",3,"matTooltip",4,"ngIf"],[2,"flex","1","min-width","0",3,"pageRemoved","formControl","maxIconNameBlockWidth","hideItems"],["class","tb-add-mobile-item-button","mat-button","","matTooltipPosition","above","color","primary",3,"divider","matTooltip","click",4,"ngIf"],[1,"tb-mobile-item-label"],["cdkDragHandle","","mat-icon-button","","matTooltipPosition","above",1,"tb-mat-40","tb-drag-handle",3,"matTooltip"],["mat-button","","matTooltipPosition","above","color","primary",1,"tb-add-mobile-item-button",3,"click","matTooltip"],[1,"tb-add-mobile-label-container","tb-primary-fill"],["color","primary",1,"tb-mat-18"],["class","tb-mobile-divider-label",4,"ngIf"],[1,"tb-mobile-divider-label"],["mat-button","","color","primary",1,"tb-primary-fill",2,"min-height","52px",3,"click"],["color","primary"],["translate",""]],template:function(n,t){if(n&1){let l=j();r(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),p(4,"mobile.pages"),a(),r(5,"mat-slide-toggle",5),p(6),d(7,"translate"),a()(),f(8,"span",6),b(9,m3,6,3,"button",7)(10,d3,6,3,"button",7)(11,c3,4,3,"button",8)(12,u3,4,3,"button",8),a(),r(13,"div",9,0),_("cdkDropListDropped",function(y){return I(l),M(t.mobileItemDrop(y))}),b(15,v3,6,7,"div",10),a(),b(16,y3,5,0,"button",11),a()}n&2&&(o(5),s("formControl",t.showHiddenPages),o(),O(c(7,10,"mobile.show-hidden-pages")),o(3),s("ngIf",!t.readonly),o(),s("ngIf",!t.readonly),o(),s("ngIf",!t.readonly),o(),s("ngIf",!t.readonly),o(),s("cdkDropListDisabled",!t.dragEnabled),o(2),s("ngForOf",t.visibleMobilePagesControls())("ngForTrackBy",t.trackByMenuItem),o(),s("ngIf",!t.readonly))},dependencies:[Te,G,ee,Ee,ae,Pt,ht,_a,ya,va,W,ii,an,J,hi,qm,R],styles:['@charset "UTF-8";[_nghost-%COMP%]   .mobile-layout-container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}[_nghost-%COMP%]   .mobile-layout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title-section[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:24px;min-width:0}[_nghost-%COMP%]   .mobile-layout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title-section[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{font-size:20px;letter-spacing:.1px}[_nghost-%COMP%]   .mobile-layout-container[_ngcontent-%COMP%]   .tb-mobile-items-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;min-height:0;overflow:auto;padding-top:8px;padding-bottom:8px}[_nghost-%COMP%]   .tb-mobile-layout-button.mdc-button[_ngcontent-%COMP%]{min-width:120px}[_nghost-%COMP%]   .tb-mobile-layout-button.mdc-button[_ngcontent-%COMP%]   tb-icon[_ngcontent-%COMP%]{min-width:18px}[_nghost-%COMP%]   .tb-mobile-layout-button.mdc-button[_ngcontent-%COMP%]   .mdc-button__label[_ngcontent-%COMP%]{overflow:hidden}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button{height:24px;opacity:0;transition:all .2s}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider{opacity:1}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .mat-mdc-button-persistent-ripple{border-bottom-style:dashed;border-bottom-width:1px}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .tb-add-mobile-label-container{vertical-align:middle}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .tb-add-mobile-label-container .mat-icon{display:none}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider:hover .mat-mdc-button-persistent-ripple{border-bottom-style:inherit;border-bottom-width:inherit}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider:hover .tb-add-mobile-label-container{vertical-align:sub}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider:hover .tb-add-mobile-label-container .mat-icon{display:inline-block}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider:hover .tb-add-mobile-label-container .tb-mobile-divider-label{display:none}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .mat-mdc-button-persistent-ripple{top:11px;bottom:11px}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button.divider .mat-mdc-button-persistent-ripple:before{opacity:.32}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button:hover{opacity:1}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .mat-mdc-button-persistent-ripple{top:11px;bottom:11px}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .mat-mdc-button-persistent-ripple:before{opacity:.32}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button:active .mat-mdc-button-persistent-ripple:before{opacity:.48}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button:active .tb-add-mobile-label-container:after{opacity:.48}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .tb-add-mobile-label-container{display:inline-flex;padding:3px;vertical-align:sub;border-radius:6px;background:#fff}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .tb-add-mobile-label-container .mat-icon{margin:0}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .tb-add-mobile-label-container .tb-mobile-divider-label{line-height:12px;font-size:10px;font-weight:400;padding:0 6px}[_nghost-%COMP%]     .mat-mdc-button.mat-mdc-button-base.tb-add-mobile-item-button .tb-add-mobile-label-container:after{display:block;height:auto;content:"";position:absolute;inset:0;opacity:.32;border-radius:6px;border:1px solid #305680;pointer-events:none}.tb-mobile-item-row-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.tb-mobile-item-row[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:row;align-items:center;padding:12px 12px 12px 0;background:#fff;gap:0;border-radius:10px;border:1px solid rgba(0,0,0,.05);box-shadow:0 5px 16px #0000000a}.tb-mobile-item-row[_ngcontent-%COMP%]   .tb-mobile-item-label[_ngcontent-%COMP%]{position:absolute;left:8px;top:-8px;padding-left:8px;padding-right:8px;background:#fff;font-size:12px;font-weight:400;line-height:16px;letter-spacing:.4px;color:#0000008a}']})}}return i})();var C3=["addMobileBundle"];function S3(i,m){i&1&&f(0,"mat-progress-bar",31)}function T3(i,m){i&1&&f(0,"div")}function x3(i,m){i&1&&(r(0,"mat-icon"),p(1,"check"),a())}function E3(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"mobile.basic-settings"))}function I3(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.title-required")," "))}function M3(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.title-cannot-contain-only-spaces")," "))}function w3(i,m){i&1&&(r(0,"mat-error"),p(1),d(2,"translate"),a()),i&2&&(o(),h(" ",c(2,1,"mobile.title-max-length")," "))}function D3(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"admin.oauth2.oauth2"))}function P3(i,m){i&1&&(p(0),d(1,"translate")),i&2&&O(c(1,1,"mobile.layout"))}function F3(i,m){if(i&1){let e=j();r(0,"button",32),_("click",function(){I(e);let t=v();return M(t.backStep())}),p(1),d(2,"translate"),a()}i&2&&(o(),O(c(2,1,"action.back")))}var Hm=(()=>{class i extends nt{constructor(e,n,t,l,u,y,w,x){super(e,n,t),this.store=e,this.router=n,this.dialogRef=t,this.data=l,this.breakpointObserver=u,this.fb=y,this.dialog=w,this.mobileAppService=x,this.entityType=k,this.selectedIndex=0,this.dialogTitle="mobile.edit-bundle",this.platformType=ji,this.bundlesForms=this.fb.group({title:["",[S.required,S.pattern(/\S/),S.maxLength(255)]],androidAppId:[null],iosAppId:[null],description:[""]}),this.oauthForms=this.fb.group({oauth2Enabled:[!0],oauth2ClientIds:[null]}),this.layoutForms=this.fb.group({layoutConfig:[null]}),this.isAdd=!1,this.data.isAdd&&(this.dialogTitle="mobile.add-bundle",this.isAdd=!0),this.stepperOrientation=this.breakpointObserver.observe(Mi["gt-xs"]).pipe(ze(({matches:q})=>q?"horizontal":"vertical")),this.oauthForms.get("oauth2Enabled").valueChanges.pipe(Ne()).subscribe(q=>{q?this.oauthForms.get("oauth2ClientIds").enable({emitEvent:!1}):this.oauthForms.get("oauth2ClientIds").disable({emitEvent:!1})}),!this.data.isAdd&&this.data.bundle&&(this.bundlesForms.patchValue(this.data.bundle,{emitEvent:!1}),this.oauthForms.get("oauth2Enabled").setValue(this.data.bundle.oauth2Enabled,{onlySelf:!0}),this.oauthForms.get("oauth2ClientIds").setValue(Tt(this.data.bundle.oauth2ClientInfos.map(q=>q.id.id)),{emitEvent:!1}),this.layoutForms.patchValue(this.data.bundle,{emitEvent:!1}))}cancel(){this.dialogRef.close(null)}backStep(){this.addMobileBundle.previous()}nextStep(){this.selectedIndex>=this.maxStepperIndex?this.add():this.addMobileBundle.next()}nextStepLabel(){return this.selectedIndex>=this.maxStepperIndex?this.data.isAdd?"action.add":"action.save":"action.next"}changeStep(e){this.selectedIndex=e.selectedIndex,e.previouslySelectedIndex>e.selectedIndex&&(e.previouslySelectedStep.interacted=!1)}createApplication(e,n){this.dialog.open(hr,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{platformType:n}}).afterClosed().subscribe(t=>{t&&(this.bundlesForms.get(e).patchValue(t.id),this.bundlesForms.get(e).markAsDirty())})}createClient(e){e&&(e.stopPropagation(),e.preventDefault()),this.dialog.open(ka,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{}}).afterClosed().subscribe(n=>{if(n){let t=this.oauthForms.get("oauth2ClientIds").value?[...this.oauthForms.get("oauth2ClientIds").value]:[];t.push(n.id.id),this.oauthForms.get("oauth2ClientIds").patchValue(t),this.oauthForms.get("oauth2ClientIds").markAsDirty()}})}get maxStepperIndex(){return this.addMobileBundle?._steps?.length-1}add(){if(this.allValid()){let e={mobileBundle:this.mobileAppService.saveMobileAppBundle(this.mobileAppBundleFormValue,this.oauthForms.value.oauth2ClientIds),oath2Clients:null};if(this.data.isAdd)delete e.oath2Clients;else{let n=_e(_e({},this.data.bundle),this.mobileAppBundleFormValue);e.mobileBundle=this.mobileAppService.saveMobileAppBundle(n),e.oath2Clients=this.mobileAppService.updateOauth2Clients(n.id.id,this.oauthForms.get("oauth2ClientIds").value)}Nt(e).subscribe(n=>this.dialogRef.close(n.mobileBundle))}}allValid(){return!this.addMobileBundle.steps.find((e,n)=>e.stepControl?.invalid?(e.interacted=!0,this.addMobileBundle.selectedIndex=n,!0):!1)}get mobileAppBundleFormValue(){let e=jn(this.bundlesForms.value);return e.layoutConfig=jn(this.layoutForms.value.layoutConfig),e.oauth2Enabled=this.oauthForms.value.oauth2Enabled,e}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(it),g(Ot),g(Xn),g(dt),g(je),g(Nn))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-mobile-bundle-dialog"]],viewQuery:function(n,t){if(n&1&&Ie(C3,7),n&2){let l;Me(l=we())&&(t.addMobileBundle=l.first)}},features:[L],decls:58,vars:44,consts:[["addMobileBundle",""],["color","primary"],[1,"flex-1"],["tb-help","mobileBundle"],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["color","warn","mode","indeterminate",4,"ngIf"],[4,"ngIf"],["mat-dialog-content","",1,"xs:!p-0"],["labelPosition","end",3,"selectionChange","linear","orientation"],["matStepperIcon","edit"],[3,"stepControl"],["matStepLabel",""],[2,"margin-top","4px",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic"],["translate",""],["matInput","","required","","formControlName","title"],["allowCreateNew","","useFullEntityId","","appearance","outline","labelText","mobile.android-application","formControlName","androidAppId",3,"createNew","entityType","entitySubtype"],["allowCreateNew","","useFullEntityId","","appearance","outline","labelText","mobile.ios-application","formControlName","iosAppId",3,"createNew","entityType","entitySubtype"],["appearance","outline"],["matInput","","formControlName","description","rows","1"],[2,"margin-top","8px",3,"formGroup"],["formControlName","oauth2Enabled"],["formControlName","oauth2ClientIds","appearance","outline",3,"entityType","labelText","placeholderText"],["mat-button","","color","primary","matSuffix","",3,"click","disabled"],[2,"white-space","nowrap"],[1,"layout-form",3,"formGroup"],["formControlName","layoutConfig"],["mat-dialog-actions",""],["mat-stroked-button","",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],["color","warn","mode","indeterminate"],["mat-stroked-button","",3,"click"]],template:function(n,t){if(n&1){let l=j();r(0,"mat-toolbar",1)(1,"h2"),p(2),d(3,"translate"),a(),f(4,"span",2)(5,"div",3),r(6,"button",4),_("click",function(){return I(l),M(t.cancel())}),r(7,"mat-icon",5),p(8,"close"),a()()(),b(9,S3,1,0,"mat-progress-bar",6),d(10,"async"),b(11,T3,1,0,"div",7),d(12,"async"),r(13,"div",8)(14,"mat-horizontal-stepper",9,0),d(16,"async"),_("selectionChange",function(y){return I(l),M(t.changeStep(y))}),b(17,x3,2,0,"ng-template",10),r(18,"mat-step",11),b(19,E3,2,3,"ng-template",12),r(20,"form",13)(21,"mat-form-field",14)(22,"mat-label",15),p(23,"mobile.title"),a(),f(24,"input",16)(25,"mat-hint"),b(26,I3,3,3,"mat-error",7)(27,M3,3,3,"mat-error",7)(28,w3,3,3,"mat-error",7),a(),r(29,"tb-entity-autocomplete",17),_("createNew",function(){return I(l),M(t.createApplication("androidAppId",t.platformType.ANDROID))}),a(),r(30,"tb-entity-autocomplete",18),_("createNew",function(){return I(l),M(t.createApplication("iosAppId",t.platformType.IOS))}),a(),r(31,"mat-form-field",19)(32,"mat-label",15),p(33,"mobile.description"),a(),f(34,"textarea",20),a()()(),r(35,"mat-step",11),b(36,D3,2,3,"ng-template",12),r(37,"form",21)(38,"mat-slide-toggle",22),p(39),d(40,"translate"),a(),r(41,"tb-entity-list",23),d(42,"translate"),d(43,"translate"),r(44,"button",24),_("click",function(y){return I(l),M(t.createClient(y))}),r(45,"span",25),p(46),d(47,"translate"),a()()()()(),r(48,"mat-step",11),b(49,P3,2,3,"ng-template",12),r(50,"form",26),f(51,"tb-mobile-layout",27),a()()()(),r(52,"div",28),b(53,F3,3,3,"button",29),f(54,"span",2),r(55,"button",30),_("click",function(){return I(l),M(t.nextStep())}),p(56),d(57,"translate"),a()()}n&2&&(o(2),O(c(3,26,t.dialogTitle)),o(7),s("ngIf",c(10,28,t.isLoading$)),o(2),s("ngIf",!c(12,30,t.isLoading$)),o(3),s("linear",t.isAdd)("orientation",c(16,32,t.stepperOrientation)),o(4),s("stepControl",t.bundlesForms),o(2),s("formGroup",t.bundlesForms),o(6),s("ngIf",t.bundlesForms.get("title").hasError("required")),o(),s("ngIf",t.bundlesForms.get("title").hasError("pattern")),o(),s("ngIf",t.bundlesForms.get("title").hasError("maxlength")),o(),s("entityType",t.entityType.MOBILE_APP)("entitySubtype",t.platformType.ANDROID),o(),s("entityType",t.entityType.MOBILE_APP)("entitySubtype",t.platformType.IOS),o(5),s("stepControl",t.oauthForms),o(2),s("formGroup",t.oauthForms),o(2),h(" ",c(40,34,"mobile.enable-oauth")," "),o(2),T("labelText",c(42,36,"admin.oauth2.clients")),T("placeholderText",c(43,38,"admin.oauth2.add-client")),s("entityType",t.entityType.OAUTH2_CLIENT),o(3),s("disabled",t.oauthForms.get("oauth2ClientIds").disabled),o(2),O(c(47,40,"admin.oauth2.create-new")),o(2),s("stepControl",t.layoutForms),o(2),s("formGroup",t.layoutForms),o(3),s("ngIf",t.selectedIndex>0),o(3),O(c(57,42,t.nextStepLabel())))},dependencies:[G,wt,ua,io,ee,Ee,ae,qe,he,me,Ce,Kt,Pe,zt,at,Rt,mt,ht,wn,In,Dn,Mn,ce,ge,W,K,ue,ie,se,J,Wm,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{width:850px;height:100%;max-width:100%;max-height:100vh;display:grid;grid-template-rows:min-content 4px minmax(auto,1fr) min-content;--mdc-outlined-text-field-outline-color: rgba(0,0,0,.12)}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   form.layout-form[_ngcontent-%COMP%]{display:block;height:100%;max-height:100%}[_nghost-%COMP%]     .mat-mdc-dialog-content{display:flex;flex-direction:column;height:100%;padding:0!important;color:#000000de}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal{display:flex;height:100%;overflow:hidden}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-stepper-wrapper{flex:1 1 100%;max-width:100%}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{height:700px;max-height:100%;width:100%;overflow-y:auto;scrollbar-gutter:stable}@media screen and (min-width: 960px){[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container{min-width:500px}}[_nghost-%COMP%]     .mat-mdc-dialog-content .mat-stepper-horizontal .mat-horizontal-content-container .mat-horizontal-stepper-content:not(.mat-horizontal-stepper-content-inactive):nth-child(3){height:100%;max-height:100%;overflow:hidden}']})}}return i})();C();function A3(i,m){if(i&1&&(r(0,"div",5)(1,"div",6),p(2,"mobile.configuration-step.configure-package-title"),a(),r(3,"div",1),p(4,"mobile.configuration-step.configure-package-text"),a(),r(5,"div",1),p(6,"mobile.configuration-step.configure-package-text-install"),a(),f(7,"tb-markdown",11),r(8,"div",1),p(9,"mobile.configuration-step.configure-package-run-commands"),a(),f(10,"tb-markdown",11),a()),i&2){let e=v();o(7),s("data",e.createMarkDownCommand(e.flutterInstallRenameCommand)),o(3),s("data",e.createMarkDownCommand(e.renameCommands))}}var zm=(()=>{class i extends nt{constructor(e,n,t,l){super(e,n,l),this.store=e,this.router=n,this.data=t,this.dialogRef=l,this.notShowAgain=!1,this.setApplication=!1,this.gitRepositoryLink="git clone -b master https://github.com/thingsboard/flutter_thingsboard_app.git",this.pathToConstants="lib/constants/app_constants.dart",this.flutterRunCommand="flutter run",this.flutterInstallRenameCommand="flutter pub global activate rename",this.renameCommands=[],this.showDontShowAgain=this.data.afterAdd,this.setApplication=!!this.data.androidApp||!!this.data.iosApp,this.configureApi=`static const thingsBoardApiEndpoint = '${window.location.origin}';`,this.setApplication&&(this.configureApi+=`
`,this.data.androidApp&&(this.configureApi+=`
static const thingsboardAndroidAppSecret = '${this.data.androidApp.appSecret}';`),this.data.iosApp&&(this.configureApi+=`
static const thingsboardIOSAppSecret = '${this.data.iosApp.appSecret}';`)),this.setApplication&&(this.data.androidApp?.pkgName===this.data.iosApp?.pkgName?this.renameCommands.push(`rename setBundleId --targets android, ios --value "${this.data.androidApp.pkgName}"`):(this.data.androidApp&&this.renameCommands.push(`rename setBundleId --targets android --value "${this.data.androidApp.pkgName}"`),this.data.iosApp&&this.renameCommands.push(`rename setBundleId --targets ios --value "${this.data.iosApp.pkgName}"`)))}close(){this.notShowAgain&&this.showDontShowAgain?(this.store.dispatch(new Qo({notDisplayConfigurationAfterAddMobileBundle:!0})),this.dialogRef.close(null)):this.dialogRef.close(null)}createMarkDownCommand(e){if(Array.isArray(e)){let n=[];return e.forEach(t=>n.push(this.createMarkDownSingleCommand(t))),n.join(`
<br />

`)}else return this.createMarkDownSingleCommand(e)}createMarkDownSingleCommand(e){return"```bash\n"+e+"{:copy-code}\n```"}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(pe),g(Ot),g(it))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-mobile-app-configuration-dialog"]],features:[L],decls:58,vars:23,consts:[["color","primary",1,"justify-between"],["translate",""],["mat-icon-button","","type","button",3,"click"],[1,"material-icons"],["mat-dialog-content","",1,"flex","flex-col","gap-4","xs:gap-2","gt-xs:max-h-[80vh]"],[1,"tb-form-panel","stroked"],["translate","",1,"tb-form-panel-title"],[1,"flex","gap-4"],["translate","",1,"flex-1"],["mat-stroked-button","","color","primary","href","https://docs.flutter.dev/get-started/install","target","_blank"],[1,"tb-mat-24"],["usePlainMarkdown","","containerClass","tb-command-code",3,"data"],["class","tb-form-panel stroked",4,"ngIf"],[1,"flex","items-center","gap-4"],["mat-stroked-button","","color","primary","href","https://docs.flutter.dev/get-started/learn-flutter","target","_blank"],["mat-dialog-actions","",1,"tb-dialog-actions","gap-2"],[3,"ngModelChange","ngModel"],[1,"flex-1"],["mat-button","",3,"click","disabled"]],template:function(n,t){n&1&&(r(0,"mat-toolbar",0)(1,"h2",1),p(2,"mobile.configuration-dialog"),a(),r(3,"button",2),_("click",function(){return t.close()}),r(4,"mat-icon",3),p(5,"close"),a()()(),r(6,"div",4)(7,"div",5)(8,"div",6),p(9,"mobile.configuration-step.prepare-environment-title"),a(),r(10,"div",7)(11,"div",8),p(12,"mobile.configuration-step.prepare-environment-text"),a(),r(13,"a",9)(14,"mat-icon",10),p(15,"description"),a(),p(16),d(17,"translate"),a()()(),r(18,"div",5)(19,"div",6),p(20,"mobile.configuration-step.get-source-code-title"),a(),r(21,"div",1),p(22,"mobile.configuration-step.get-source-code-text"),a(),f(23,"tb-markdown",11),a(),r(24,"div",5)(25,"div",6),p(26,"mobile.configuration-step.configure-api-title"),a(),r(27,"div",1),p(28,"mobile.configuration-step.configure-api-text"),a(),f(29,"tb-markdown",11),r(30,"div",1),p(31,"mobile.configuration-step.configure-api-hint"),a(),f(32,"tb-markdown",11),a(),b(33,A3,11,2,"div",12),r(34,"div",5)(35,"div",6),p(36,"mobile.configuration-step.run-app-title"),a(),r(37,"div",1),p(38,"mobile.configuration-step.run-app-text"),a(),f(39,"tb-markdown",11),a(),r(40,"div",5)(41,"div",13)(42,"div",8),p(43,"mobile.configuration-step.more-information"),a(),r(44,"a",14)(45,"mat-icon",10),p(46,"rocket_launch"),a(),p(47),d(48,"translate"),a()()()(),r(49,"div",15)(50,"mat-slide-toggle",16),et("ngModelChange",function(u){return Ze(t.notShowAgain,u)||(t.notShowAgain=u),u}),p(51),d(52,"translate"),a(),f(53,"span",17),r(54,"button",18),d(55,"async"),_("click",function(){return t.close()}),p(56),d(57,"translate"),a()()),n&2&&(o(16),h("",c(17,13,"common.documentation")," "),o(7),s("data",t.createMarkDownCommand(t.gitRepositoryLink)),o(6),s("data",t.createMarkDownCommand(t.pathToConstants)),o(3),s("data",t.createMarkDownCommand(t.configureApi)),o(),s("ngIf",t.setApplication),o(6),s("data",t.createMarkDownCommand(t.flutterRunCommand)),o(8),h("",c(48,15,"mobile.configuration-step.getting-started")," "),o(3),V("!hidden",!t.showDontShowAgain),Xe("ngModel",t.notShowAgain),o(),O(c(52,17,"action.dont-show-again")),o(3),s("disabled",c(55,19,t.isLoading$)),o(2),O(c(57,21,"action.close")))},dependencies:[G,sa,ea,ee,Ee,ae,at,Rt,mt,ht,W,Ye,J,le,R],styles:['@charset "UTF-8";[_nghost-%COMP%]{height:100%;max-height:100vh;display:grid;width:870px;max-width:100%;grid-template-rows:min-content minmax(auto,1fr) min-content}.mat-mdc-dialog-container[_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%], .mat-mdc-dialog-container   [_nghost-%COMP%]   .tb-dialog-actions[_ngcontent-%COMP%]{padding:8px 16px 8px 24px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper{padding:0}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]{margin:0;font-size:14px;background:#f3f6fa;border-color:#305680;padding-right:38px;overflow:hidden;overflow-x:auto;padding-bottom:4px;min-height:42px;scrollbar-width:thin}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code .code-wrapper pre[class*=language-]::-webkit-scrollbar{width:4px;height:4px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn.multiline{right:-2px}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn.multiline p{color:#305680}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn p, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn.multiline p, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn.multiline div{background-color:#f3f6fa}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div img, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn.multiline div img{display:none}[_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn div:after, [_nghost-%COMP%]     .tb-markdown-view .tb-command-code button.clipboard-btn.multiline div:after{content:"";position:initial;display:block;width:18px;height:18px;background:#305680;mask-image:url(/assets/copy-code-icon.svg);-webkit-mask-image:url(/assets/copy-code-icon.svg);mask-repeat:no-repeat;-webkit-mask-repeat:no-repeat}[_nghost-%COMP%]     .mdc-button__label>span .mat-icon{vertical-align:text-bottom;box-sizing:initial}[_nghost-%COMP%]     .tabs-icon{margin-right:8px}[_nghost-%COMP%]     .tb-form-panel.tb-tab-body{padding:16px 0 0}']})}}return i})();var oc=(()=>{class i{constructor(e,n,t,l,u,y){this.datePipe=e,this.mobileAppService=n,this.translate=t,this.dialog=l,this.router=u,this.store=y,this.config=new Ge,this.openingEditDialog=!1,this.config.selectionEnabled=!1,this.config.entityType=k.MOBILE_APP_BUNDLE,this.config.addAsTextButton=!0,this.config.rowPointer=!0,this.config.detailsPanelEnabled=!1,this.config.entityTranslations=Ue.get(k.MOBILE_APP_BUNDLE),this.config.entityResources=tt.get(k.MOBILE_APP_BUNDLE),this.config.headerComponent=jm,this.config.addDialogStyle={width:"850px",maxHeight:"100vh"},this.config.defaultSortOrder={property:"createdTime",direction:Zt.DESC},this.config.addEntity=()=>this.editBundle(null,!0),this.config.columns.push(new We("createdTime","common.created-time",this.datePipe,"170px"),new Y("title","mobile.title","25%"),new no("oauth2ClientInfos","mobile.oauth-clients","35%"),new no("androidPkg","mobile.android-app","20%"),new no("iosPkg","mobile.ios-app","20%"),new Y("oauth2Enabled","mobile.enable-oauth","140px",w=>Ft(w.oauth2Enabled))),this.config.deleteEnabled=w=>!(w.iosAppId||w.androidAppId),this.config.deleteEntityTitle=w=>this.translate.instant("mobile.delete-applications-bundle-title",{bundleName:w.name}),this.config.deleteEntityContent=()=>this.translate.instant("mobile.delete-applications-bundle-text"),this.config.deleteEntity=w=>this.mobileAppService.deleteMobileAppBundle(w.id),this.config.entitiesFetchFunction=w=>this.mobileAppService.getTenantMobileAppBundleInfos(w).pipe(ze(x=>(x.data.map(q=>{q.androidPkgName&&(q.androidPkg={id:q.androidAppId,name:q.androidPkgName}),q.iosPkgName&&(q.iosPkg={id:q.iosAppId,name:q.iosPkgName})}),x))),this.config.handleRowClick=(w,x)=>(w?.stopPropagation(),this.openingEditDialog||(this.openingEditDialog=!0,this.mobileAppService.getMobileAppBundleInfoById(x.id.id).pipe(tn(q=>this.editBundle(q)),lt(this.router.events.pipe(uc(1))),dc(()=>{this.openingEditDialog=!1})).subscribe(q=>{q&&this.config.updateData()})),!0),this.config.entityAdded=w=>{this.store.pipe(Wt(Yo("notDisplayConfigurationAfterAddMobileBundle"))).pipe(ti(1)).subscribe(x=>{x||this.configurationApp(null,w,!0)})},this.config.cellActionDescriptors=this.configureCellActions()}resolve(e){return this.config}configureCellActions(){return[{name:this.translate.instant("mobile.configuration-app"),icon:"code",isEnabled:()=>!0,onAction:(e,n)=>this.configurationApp(e,n)}]}editBundle(e,n=!1){return this.dialog.open(Hm,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{isAdd:n,bundle:e}}).afterClosed()}configurationApp(e,n,t=!1){e&&e.stopPropagation();let l={androidApp:n.androidAppId?this.mobileAppService.getMobileAppInfoById(n.androidAppId.id):ut(null),iosApp:n.iosAppId?this.mobileAppService.getMobileAppInfoById(n.iosAppId.id):ut(null)};Nt(l).subscribe(u=>{this.dialog.open(zm,{disableClose:!0,panelClass:["tb-dialog","tb-fullscreen-dialog"],data:{afterAdd:t,androidApp:u.androidApp,iosApp:u.iosApp}}).afterClosed().subscribe()})}static{this.\u0275fac=function(n){return new(n||i)(D(ke),D(Nn),D(Z),D(je),D(pe),D(F))}}static{this.\u0275prov=Se({token:i,factory:i.\u0275fac})}}return i})();var Wg=[{path:"bundles",component:Le,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"mobile.bundles",breadcrumb:{menuId:be.mobile_bundles}},resolve:{entitiesTableConfig:oc}}],ac=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({providers:[oc]})}}return i})();C();C();var N3=()=>["flex"];function k3(i,m){i&1&&f(0,"mat-progress-bar",23)}function O3(i,m){i&1&&f(0,"div",24)}function R3(i,m){if(i&1&&(r(0,"div",25)(1,"div",26),p(2),d(3,"translate"),a(),f(4,"tb-entity-autocomplete",27),a()),i&2){let e=v();o(2),O(c(3,3,"mobile.bundle")),o(2),s("additionalClasses",Et(5,N3))("entityType",e.entityType.MOBILE_APP_BUNDLE)}}function B3(i,m){if(i&1&&(r(0,"mat-option",12),p(1),d(2,"translate"),a()),i&2){let e=m.$implicit;s("value",e.key),o(),h(" ",c(2,2,e.value)," ")}}function V3(i,m){if(i&1){let e=j();r(0,"div",28)(1,"div",29)(2,"mat-slide-toggle",30),_("click",function(t){return I(e),M(t.stopPropagation())}),p(3),d(4,"translate"),a(),r(5,"mat-form-field",31)(6,"mat-select",32),b(7,B3,3,4,"mat-option",33),d(8,"keyvalue"),a()()()()}if(i&2){let e=v();o(3),h(" ",c(4,2,"admin.mobile-app.badges")," "),o(4),s("ngForOf",c(8,4,e.badgePositionTranslationsMap))}}function j3(i,m){if(i&1&&(r(0,"mat-icon",37),d(1,"translate"),p(2," warning "),a()),i&2){let e=v(2);s("matTooltip",c(1,1,e.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").hasError("required")?"admin.mobile-app.label-required":"admin.mobile-app.label-max-length"))}}function L3(i,m){if(i&1){let e=j();r(0,"div",28)(1,"div",29)(2,"mat-slide-toggle",34),_("click",function(t){return I(e),M(t.stopPropagation())}),p(3),d(4,"translate"),a(),r(5,"mat-form-field",31),f(6,"input",35),d(7,"translate"),b(8,j3,3,3,"mat-icon",36),a()()()}if(i&2){let e=v();o(3),h(" ",c(4,3,"admin.mobile-app.label")," "),o(3),T("placeholder",c(7,5,"admin.mobile-app.set")),o(2),s("ngIf",!e.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").untouched&&e.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").hasError("required")||e.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").hasError("maxlength"))}}function G3(i,m){if(i&1&&(r(0,"div",38)(1,"div",10),p(2,"admin.mobile-app.preview"),a(),f(3,"tb-mobile-app-qrcode-widget",39),a()),i&2){let e=v();o(3),s("mobileAppSettings",e.mobileAppSettingsForm.getRawValue())}}var $m=(()=>{class i extends Mt{constructor(e,n,t){super(e),this.store=e,this.mobileAppService=n,this.fb=t,this.badgePositionTranslationsMap=xf,this.entityType=k,this.mobileAppSettingsForm=this.fb.group({useDefaultApp:[!0],mobileAppBundleId:[{value:null,disabled:!0},S.required],androidEnabled:[!0],iosEnabled:[!0],qrCodeConfig:this.fb.group({showOnHomePage:[!0],badgeEnabled:[!0],badgePosition:[Tf.RIGHT],qrCodeLabelEnabled:[!0],qrCodeLabel:["",[S.required,S.maxLength(50)]]})}),this.mobileAppService.getMobileAppSettings().subscribe(l=>this.processMobileAppSettings(l)),this.mobileAppSettingsForm.get("useDefaultApp").valueChanges.pipe(Ne()).subscribe(l=>{l?this.mobileAppSettingsForm.get("mobileAppBundleId").disable({emitEvent:!1}):this.mobileAppSettingsForm.get("mobileAppBundleId").enable({emitEvent:!1})}),this.mobileAppSettingsForm.get("androidEnabled").valueChanges.pipe(Ne()).subscribe(()=>{this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").updateValueAndValidity({onlySelf:!0})}),this.mobileAppSettingsForm.get("iosEnabled").valueChanges.pipe(Ne()).subscribe(()=>{this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").updateValueAndValidity({onlySelf:!0})}),this.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").valueChanges.pipe(Ne()).subscribe(l=>{l?this.mobileAppSettingsForm.get("qrCodeConfig").enable({emitEvent:!1}):(this.mobileAppSettingsForm.get("qrCodeConfig").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").enable({emitEvent:!1})),this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").updateValueAndValidity({onlySelf:!0}),this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabelEnabled").updateValueAndValidity({onlySelf:!0})}),this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").valueChanges.pipe(Ne()).subscribe(l=>{if(l){let u=this.mobileAppSettingsForm.getRawValue();u.androidEnabled||u.iosEnabled?(this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").enable({emitEvent:!1}),this.mobileAppSettingsForm.get("qrCodeConfig.badgePosition").enable({emitEvent:!1})):(this.mobileAppSettingsForm.get("qrCodeConfig.badgeEnabled").disable({emitEvent:!1}),this.mobileAppSettingsForm.get("qrCodeConfig.badgePosition").disable({emitEvent:!1}))}else this.mobileAppSettingsForm.get("qrCodeConfig.badgePosition").disable({emitEvent:!1})}),this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabelEnabled").valueChanges.pipe(Ne()).subscribe(l=>{l&&this.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value?this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").enable({emitEvent:!1}):this.mobileAppSettingsForm.get("qrCodeConfig.qrCodeLabel").disable({emitEvent:!1})})}processMobileAppSettings(e){this.mobileAppSettings=_e({},e),this.mobileAppSettingsForm.reset(this.mobileAppSettings)}save(){let e=this.mobileAppSettings.qrCodeConfig.showOnHomePage;this.mobileAppSettings=_e(_e({},this.mobileAppSettings),this.mobileAppSettingsForm.getRawValue()),this.mobileAppService.saveMobileAppSettings(this.mobileAppSettings).subscribe(n=>{let t=n.qrCodeConfig.showOnHomePage;e!==t&&this.store.dispatch(new Lc({mobileQrEnabled:t})),this.processMobileAppSettings(n)})}confirmForm(){return this.mobileAppSettingsForm}static{this.\u0275fac=function(n){return new(n||i)(g(F),g(If),g(dt))}}static{this.\u0275cmp=P({type:i,selectors:[["tb-mobile-qr-code-widget"]],features:[L],decls:51,vars:39,consts:[["appearance","outlined",1,"settings-card"],[1,"items-center"],["translate","",1,"mat-headline-5"],["tb-help","mobileQrCode"],["color","warn","mode","indeterminate",4,"ngIf"],["style","height: 4px;",4,"ngIf"],[2,"padding-top","16px"],[1,"tb-form-panel","no-border","no-padding",3,"formGroup"],[1,"tb-form-panel"],[1,"tb-form-row","column-xs","no-border","no-padding","space-between"],["translate","",1,"tb-form-panel-title"],["formControlName","useDefaultApp"],[3,"value"],["class","tb-form-row column-xs",4,"ngIf"],[1,"tb-form-row","stroked","no-padding-bottom"],["formControlName","androidEnabled",1,"mat-slide",3,"click"],["formControlName","iosEnabled",1,"mat-slide",3,"click"],["formGroupName","qrCodeConfig",1,"tb-form-panel"],["formControlName","showOnHomePage"],["class","tb-form-panel stroked no-padding no-gap",4,"ngIf"],["class","tb-form-panel tb-qrcode-preview",4,"ngIf"],[1,"tb-flex","row","flex-end",2,"margin-top","16px"],["mat-button","","mat-raised-button","","color","primary",3,"click","disabled"],["color","warn","mode","indeterminate"],[2,"height","4px"],[1,"tb-form-row","column-xs"],[1,"fixed-title-width-230"],["useFullEntityId","","appearance","outline","subscriptSizing","dynamic","formControlName","mobileAppBundleId",1,"flex-1",3,"additionalClasses","entityType"],[1,"tb-form-panel","stroked","no-padding","no-gap"],[1,"tb-form-row","space-between","no-border","no-padding-bottom","column-xs"],["formControlName","badgeEnabled",1,"mat-slide","fixed-title-width-230",3,"click"],["appearance","outline","subscriptSizing","dynamic",1,"flex"],["formControlName","badgePosition"],[3,"value",4,"ngFor","ngForOf"],["formControlName","qrCodeLabelEnabled",1,"mat-slide","fixed-title-width-230",3,"click"],["matInput","","formControlName","qrCodeLabel",3,"placeholder"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip","class","tb-error",3,"matTooltip",4,"ngIf"],["matSuffix","","matTooltipPosition","above","matTooltipClass","tb-error-tooltip",1,"tb-error",3,"matTooltip"],[1,"tb-form-panel","tb-qrcode-preview"],[3,"mobileAppSettings"]],template:function(n,t){n&1&&(r(0,"mat-card",0)(1,"mat-card-header",1)(2,"mat-card-title")(3,"span",2),p(4,"admin.mobile-app.mobile-app-qr-code-widget-settings"),a()(),f(5,"div",3),a(),b(6,k3,1,0,"mat-progress-bar",4),d(7,"async"),b(8,O3,1,0,"div",5),d(9,"async"),r(10,"mat-card-content",6)(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10),p(15,"admin.mobile-app.applications"),a(),r(16,"tb-toggle-select",11)(17,"tb-toggle-option",12),p(18),d(19,"translate"),a(),r(20,"tb-toggle-option",12),p(21),d(22,"translate"),a()()(),b(23,R3,5,6,"div",13),r(24,"div",14)(25,"mat-slide-toggle",15),_("click",function(u){return u.stopPropagation()}),p(26),d(27,"translate"),a()(),r(28,"div",14)(29,"mat-slide-toggle",16),_("click",function(u){return u.stopPropagation()}),p(30),d(31,"translate"),a()()(),r(32,"div",17)(33,"div",9)(34,"div",10),p(35,"admin.mobile-app.appearance-on-home-page"),a(),r(36,"tb-toggle-select",18)(37,"tb-toggle-option",12),p(38),d(39,"translate"),a(),r(40,"tb-toggle-option",12),p(41),d(42,"translate"),a()()(),b(43,V3,9,6,"div",19)(44,L3,9,7,"div",19)(45,G3,4,1,"div",20),a()(),r(46,"div",21)(47,"button",22),d(48,"async"),_("click",function(){return t.save()}),p(49),d(50,"translate"),a()()()()),n&2&&(o(6),s("ngIf",c(7,19,t.isLoading$)),o(2),s("ngIf",!c(9,21,t.isLoading$)),o(3),s("formGroup",t.mobileAppSettingsForm),o(6),s("value",!0),o(),O(c(19,23,"admin.mobile-app.default")),o(2),s("value",!1),o(),O(c(22,25,"admin.mobile-app.custom")),o(2),s("ngIf",!t.mobileAppSettingsForm.get("useDefaultApp").value),o(3),h(" ",c(27,27,"admin.mobile-app.android")," "),o(4),h(" ",c(31,29,"admin.mobile-app.ios")," "),o(7),s("value",!0),o(),O(c(39,31,"admin.mobile-app.enabled")),o(2),s("value",!1),o(),O(c(42,33,"admin.mobile-app.disabled")),o(2),s("ngIf",t.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value),o(),s("ngIf",t.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value),o(),s("ngIf",t.mobileAppSettingsForm.get("qrCodeConfig.showOnHomePage").value),o(2),s("disabled",c(48,35,t.isLoading$)||t.mobileAppSettingsForm.invalid||!t.mobileAppSettingsForm.dirty),o(2),h(" ",c(50,37,"action.save")," "))},dependencies:[Te,G,wt,ua,ee,ae,Xt,ni,ci,di,qe,he,me,zt,vt,gt,Pt,ht,ge,W,K,ie,se,bt,J,Di,Pi,Mf,le,xr,R],styles:['@charset "UTF-8";.tb-qrcode-preview[_ngcontent-%COMP%]{background-color:#0000000a;box-shadow:none}.tb-qrcode-preview[_ngcontent-%COMP%]   .tb-form-panel-title[_ngcontent-%COMP%]{color:#00000061}','@charset "UTF-8";[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{margin:8px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   mat-card-header.mat-mdc-card-header[_ngcontent-%COMP%]{align-items:center}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]{padding:0 16px 8px;margin:10px 0;border:1px groove rgba(0,0,0,.25);border-radius:4px}[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]   .fields-group[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000000b3}@media screen and (min-width: 960px) and (max-width: 1279px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:80%}}@media screen and (min-width: 1280px){[_nghost-%COMP%]   .mat-mdc-card.settings-card[_ngcontent-%COMP%]{width:60%}}']})}}return i})();var Hg=[{path:"qr-code-widget",component:$m,canDeactivate:[xe],data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],title:"mobile.qr-code-widget",breadcrumb:{menuId:be.mobile_qr_code_widget}}}],U3=[{path:"settings/mobile-app",pathMatch:"full",redirectTo:"/mobile-center/qr-code-widget"}],Jm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[B.forChild(U3),B]})}}return i})();(function(){Q(Jm,{imports:[B],exports:[B]})})();var q3=[{path:"mobile-center",component:un,data:{auth:[E.TENANT_ADMIN,E.SYS_ADMIN],breadcrumb:{menuId:be.mobile_center}},children:[{path:"",children:[],data:{auth:[E.TENANT_ADMIN,E.CUSTOMER_USER,E.SYS_ADMIN],redirectTo:"/mobile-center/bundles"}},...Gg,...Wg,...Hg]}],Qm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[B.forChild(q3),B]})}}return i})();(function(){Q(Qm,{imports:[B],exports:[B]})})();C();C();var Ym=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe]})}}return i})();(function(){Q(Ym,{declarations:[gr],imports:[ne,oe],exports:[gr]})})();var Km=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,Ym,Vm]})}}return i})();(function(){Q(Km,{declarations:[qa,km,hr,Rm],imports:[ne,oe,ve,Ym,Vm],exports:[hr]})})();C();var Xm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,ac]})}}return i})();(function(){Q(Xm,{declarations:[jm,Hm,Wm,qm,Lm,Wa,Gm,Um,zm],imports:[ne,oe,ve,ac]})})();C();var Zm=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,Ed,Jm]})}}return i})();(function(){Q(Zm,{declarations:[$m],imports:[ne,oe,ve,Ed,Jm]})})();var ed=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[ne,oe,ve,Km,Xm,Zm,Qm]})}}return i})();(function(){Q(ed,{imports:[ne,oe,ve,Km,Xm,Zm,Qm]})})();var W3=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=z({type:i})}static{this.\u0275inj=H({imports:[Ml,Pl,kl,Ul,Jp,Yl,Kp,mm,cm,bm,ym,ed,wm,Dp,Fp,fm,tm,Rp,xp,Up,qp,Wp,Ep,Zp,Nm,am,Mp,sm,Pm,Am]})}}return i})();(function(){Q(W3,{exports:[Ml,Pl,kl,Ul,Jp,Yl,Kp,mm,cm,bm,ym,ed,wm,Dp,Fp,fm,tm,Rp,xp,Up,qp,Wp,Ep,Zp,Nm,am,Mp,sm,Pm,Am]})})();export{W3 as HomePagesModule};
